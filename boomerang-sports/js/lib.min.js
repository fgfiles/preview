(function(){window.visibly={q:document,p:undefined,prefixes:["webkit","ms","o","moz","khtml"],props:["VisibilityState","visibilitychange","Hidden"],m:["focus","blur"],visibleCallbacks:[],hiddenCallbacks:[],genericCallbacks:[],_callbacks:[],cachedPrefix:"",fn:null,onVisible:function(_callback){if(typeof _callback=="function"){this.visibleCallbacks.push(_callback)}},onHidden:function(_callback){if(typeof _callback=="function"){this.hiddenCallbacks.push(_callback)}},getPrefix:function(){if(!this.cachedPrefix){for(var l=0,b;b=this.prefixes[l++];){if(b+this.props[2]in this.q){this.cachedPrefix=b;return this.cachedPrefix}}}},visibilityState:function(){return this._getProp(0)},hidden:function(){return this._getProp(2)},visibilitychange:function(fn){if(typeof fn=="function"){this.genericCallbacks.push(fn)}var n=this.genericCallbacks.length;if(n){if(this.cachedPrefix){while(n--){this.genericCallbacks[n].call(this,this.visibilityState())}}else{while(n--){this.genericCallbacks[n].call(this,arguments[0])}}}},isSupported:function(index){return this._getPropName(2)in this.q},_getPropName:function(index){return this.cachedPrefix==""?this.props[index].substring(0,1).toLowerCase()+this.props[index].substring(1):this.cachedPrefix+this.props[index]},_getProp:function(index){return this.q[this._getPropName(index)]},_execute:function(index){if(index){this._callbacks=index==1?this.visibleCallbacks:this.hiddenCallbacks;var n=this._callbacks.length;while(n--){this._callbacks[n]()}}},_visible:function(){window.visibly._execute(1);window.visibly.visibilitychange.call(window.visibly,"visible")},_hidden:function(){window.visibly._execute(2);window.visibly.visibilitychange.call(window.visibly,"hidden")},_nativeSwitch:function(){this[this._getProp(2)?"_hidden":"_visible"]()},_listen:function(){try{if(!this.isSupported()){if(this.q.addEventListener){window.addEventListener(this.m[0],this._visible,1);window.addEventListener(this.m[1],this._hidden,1)}else{if(this.q.attachEvent){this.q.attachEvent("onfocusin",this._visible);this.q.attachEvent("onfocusout",this._hidden)}}}else{this.q.addEventListener(this._getPropName(1),function(){window.visibly._nativeSwitch.apply(window.visibly,arguments)},1)}}catch(e){}},init:function(){this.getPrefix();this._listen()}};this.visibly.init()})();(function(){function aa(a,b,d){return a.call.apply(a.bind,arguments)}function ba(a,b,d){if(!a)throw Error();if(2<arguments.length){var c=Array.prototype.slice.call(arguments,2);return function(){var d=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(d,c);return a.apply(b,d)}}return function(){return a.apply(b,arguments)}}function p(a,b,d){p=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?aa:ba;return p.apply(null,arguments)}var q=Date.now||function(){return+new Date};function ca(a,b){this.a=a;this.m=b||a;this.c=this.m.document}var da=!!window.FontFace;function t(a,b,d,c){b=a.c.createElement(b);if(d)for(var e in d)d.hasOwnProperty(e)&&("style"==e?b.style.cssText=d[e]:b.setAttribute(e,d[e]));c&&b.appendChild(a.c.createTextNode(c));return b}function u(a,b,d){a=a.c.getElementsByTagName(b)[0];a||(a=document.documentElement);a.insertBefore(d,a.lastChild)}function v(a){a.parentNode&&a.parentNode.removeChild(a)}function w(a,b,d){b=b||[];d=d||[];for(var c=a.className.split(/\s+/),e=0;e<b.length;e+=1){for(var f=!1,g=0;g<c.length;g+=1)if(b[e]===c[g]){f=!0;break}f||c.push(b[e])}b=[];for(e=0;e<c.length;e+=1){f=!1;for(g=0;g<d.length;g+=1)if(c[e]===d[g]){f=!0;break}f||b.push(c[e])}a.className=b.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function y(a,b){for(var d=a.className.split(/\s+/),c=0,e=d.length;c<e;c++)if(d[c]==b)return!0;return!1}function z(a){if("string"===typeof a.f)return a.f;var b=a.m.location.protocol;"about:"==b&&(b=a.a.location.protocol);return"https:"==b?"https:":"http:"}function ea(a){return a.m.location.hostname||a.a.location.hostname}function A(a,b,d){function c(){k&&e&&f&&(k(g),k=null)}b=t(a,"link",{rel:"stylesheet",href:b,media:"all"});var e=!1,f=!0,g=null,k=d||null;da?(b.onload=function(){e=!0;c()},b.onerror=function(){e=!0;g=Error("Stylesheet failed to load");c()}):setTimeout(function(){e=!0;c()},0);u(a,"head",b)}function B(a,b,d,c){var e=a.c.getElementsByTagName("head")[0];if(e){var f=t(a,"script",{src:b}),g=!1;f.onload=f.onreadystatechange=function(){g||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(g=!0,d&&d(null),f.onload=f.onreadystatechange=null,"HEAD"==f.parentNode.tagName&&e.removeChild(f))};e.appendChild(f);setTimeout(function(){g||(g=!0,d&&d(Error("Script load timeout")))},c||5e3);return f}return null}function C(){this.a=0;this.c=null}function D(a){a.a++;return function(){a.a--;E(a)}}function F(a,b){a.c=b;E(a)}function E(a){0==a.a&&a.c&&(a.c(),a.c=null)}function G(a){this.a=a||"-"}G.prototype.c=function(a){for(var b=[],d=0;d<arguments.length;d++)b.push(arguments[d].replace(/[\W_]+/g,"").toLowerCase());return b.join(this.a)};function H(a,b){this.c=a;this.f=4;this.a="n";var d=(b||"n4").match(/^([nio])([1-9])$/i);d&&(this.a=d[1],this.f=parseInt(d[2],10))}function fa(a){return I(a)+" "+(a.f+"00")+" 300px "+J(a.c)}function J(a){var b=[];a=a.split(/,\s*/);for(var d=0;d<a.length;d++){var c=a[d].replace(/['"]/g,"");-1!=c.indexOf(" ")||/^\d/.test(c)?b.push("'"+c+"'"):b.push(c)}return b.join(",")}function K(a){return a.a+a.f}function I(a){var b="normal";"o"===a.a?b="oblique":"i"===a.a&&(b="italic");return b}function ga(a){var b=4,d="n",c=null;a&&((c=a.match(/(normal|oblique|italic)/i))&&c[1]&&(d=c[1].substr(0,1).toLowerCase()),(c=a.match(/([1-9]00|normal|bold)/i))&&c[1]&&(/bold/i.test(c[1])?b=7:/[1-9]00/.test(c[1])&&(b=parseInt(c[1].substr(0,1),10))));return d+b}function ha(a,b){this.c=a;this.f=a.m.document.documentElement;this.h=b;this.a=new G("-");this.j=!1!==b.events;this.g=!1!==b.classes}function ia(a){a.g&&w(a.f,[a.a.c("wf","loading")]);L(a,"loading")}function M(a){if(a.g){var b=y(a.f,a.a.c("wf","active")),d=[],c=[a.a.c("wf","loading")];b||d.push(a.a.c("wf","inactive"));w(a.f,d,c)}L(a,"inactive")}function L(a,b,d){if(a.j&&a.h[b])if(d)a.h[b](d.c,K(d));else a.h[b]()}function ja(){this.c={}}function ka(a,b,d){var c=[],e;for(e in b)if(b.hasOwnProperty(e)){var f=a.c[e];f&&c.push(f(b[e],d))}return c}function N(a,b){this.c=a;this.f=b;this.a=t(this.c,"span",{"aria-hidden":"true"},this.f)}function O(a){u(a.c,"body",a.a)}function P(a){return"display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+J(a.c)+";"+("font-style:"+I(a)+";font-weight:"+(a.f+"00")+";")}function Q(a,b,d,c,e,f){this.g=a;this.j=b;this.a=c;this.c=d;this.f=e||3e3;this.h=f||void 0}Q.prototype.start=function(){var a=this.c.m.document,b=this,d=q(),c=new Promise(function(c,e){function k(){q()-d>=b.f?e():a.fonts.load(fa(b.a),b.h).then(function(a){1<=a.length?c():setTimeout(k,25)},function(){e()})}k()}),e=new Promise(function(a,c){setTimeout(c,b.f)});Promise.race([e,c]).then(function(){b.g(b.a)},function(){b.j(b.a)})};function R(a,b,d,c,e,f,g){this.v=a;this.B=b;this.c=d;this.a=c;this.s=g||"BESbswy";this.f={};this.w=e||3e3;this.u=f||null;this.o=this.j=this.h=this.g=null;this.g=new N(this.c,this.s);this.h=new N(this.c,this.s);this.j=new N(this.c,this.s);this.o=new N(this.c,this.s);a=new H(this.a.c+",serif",K(this.a));a=P(a);this.g.a.style.cssText=a;a=new H(this.a.c+",sans-serif",K(this.a));a=P(a);this.h.a.style.cssText=a;a=new H("serif",K(this.a));a=P(a);this.j.a.style.cssText=a;a=new H("sans-serif",K(this.a));a=P(a);this.o.a.style.cssText=a;O(this.g);O(this.h);O(this.j);O(this.o)}var S={D:"serif",C:"sans-serif"},T=null;function U(){if(null===T){var a=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent);T=!!a&&(536>parseInt(a[1],10)||536===parseInt(a[1],10)&&11>=parseInt(a[2],10))}return T}R.prototype.start=function(){this.f.serif=this.j.a.offsetWidth;this.f["sans-serif"]=this.o.a.offsetWidth;this.A=q();la(this)};function ma(a,b,d){for(var c in S)if(S.hasOwnProperty(c)&&b===a.f[S[c]]&&d===a.f[S[c]])return!0;return!1}function la(a){var b=a.g.a.offsetWidth,d=a.h.a.offsetWidth,c;(c=b===a.f.serif&&d===a.f["sans-serif"])||(c=U()&&ma(a,b,d));c?q()-a.A>=a.w?U()&&ma(a,b,d)&&(null===a.u||a.u.hasOwnProperty(a.a.c))?V(a,a.v):V(a,a.B):na(a):V(a,a.v)}function na(a){setTimeout(p(function(){la(this)},a),50)}function V(a,b){setTimeout(p(function(){v(this.g.a);v(this.h.a);v(this.j.a);v(this.o.a);b(this.a)},a),0)}function W(a,b,d){this.c=a;this.a=b;this.f=0;this.o=this.j=!1;this.s=d}var X=null;W.prototype.g=function(a){var b=this.a;b.g&&w(b.f,[b.a.c("wf",a.c,K(a).toString(),"active")],[b.a.c("wf",a.c,K(a).toString(),"loading"),b.a.c("wf",a.c,K(a).toString(),"inactive")]);L(b,"fontactive",a);this.o=!0;oa(this)};W.prototype.h=function(a){var b=this.a;if(b.g){var d=y(b.f,b.a.c("wf",a.c,K(a).toString(),"active")),c=[],e=[b.a.c("wf",a.c,K(a).toString(),"loading")];d||c.push(b.a.c("wf",a.c,K(a).toString(),"inactive"));w(b.f,c,e)}L(b,"fontinactive",a);oa(this)};function oa(a){0==--a.f&&a.j&&(a.o?(a=a.a,a.g&&w(a.f,[a.a.c("wf","active")],[a.a.c("wf","loading"),a.a.c("wf","inactive")]),L(a,"active")):M(a.a))}function pa(a){this.j=a;this.a=new ja;this.h=0;this.f=this.g=!0}pa.prototype.load=function(a){this.c=new ca(this.j,a.context||this.j);this.g=!1!==a.events;this.f=!1!==a.classes;qa(this,new ha(this.c,a),a)};function ra(a,b,d,c,e){var f=0==--a.h;(a.f||a.g)&&setTimeout(function(){var a=e||null,k=c||null||{};if(0===d.length&&f)M(b.a);else{b.f+=d.length;f&&(b.j=f);var h,m=[];for(h=0;h<d.length;h++){var l=d[h],n=k[l.c],r=b.a,x=l;r.g&&w(r.f,[r.a.c("wf",x.c,K(x).toString(),"loading")]);L(r,"fontloading",x);r=null;null===X&&(X=window.FontFace?(x=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent))?42<parseInt(x[1],10):!0:!1);X?r=new Q(p(b.g,b),p(b.h,b),b.c,l,b.s,n):r=new R(p(b.g,b),p(b.h,b),b.c,l,b.s,a,n);m.push(r)}for(h=0;h<m.length;h++)m[h].start()}},0)}function qa(a,b,d){var c=[],e=d.timeout;ia(b);var c=ka(a.a,d,a.c),f=new W(a.c,b,e);a.h=c.length;b=0;for(d=c.length;b<d;b++)c[b].load(function(b,c,d){ra(a,f,b,c,d)})}function sa(a,b){this.c=a;this.a=b}function ta(a,b,d){var c=z(a.c);a=(a.a.api||"fast.fonts.net/jsapi").replace(/^.*http(s?):(\/\/)?/,"");return c+"//"+a+"/"+b+".js"+(d?"?v="+d:"")}sa.prototype.load=function(a){function b(){if(e["__mti_fntLst"+d]){var c=e["__mti_fntLst"+d](),g=[],k;if(c)for(var h=0;h<c.length;h++){var m=c[h].fontfamily;void 0!=c[h].fontStyle&&void 0!=c[h].fontWeight?(k=c[h].fontStyle+c[h].fontWeight,g.push(new H(m,k))):g.push(new H(m))}a(g)}else setTimeout(function(){b()},50)}var d=this.a.projectId,c=this.a.version;if(d){var e=this.c.m;B(this.c,ta(this,d,c),function(c){c?a([]):b()}).id="__MonotypeAPIScript__"+d}else a([])};function ua(a,b){this.c=a;this.a=b}ua.prototype.load=function(a){var b,d,c=this.a.urls||[],e=this.a.families||[],f=this.a.testStrings||{},g=new C;b=0;for(d=c.length;b<d;b++)A(this.c,c[b],D(g));var k=[];b=0;for(d=e.length;b<d;b++)if(c=e[b].split(":"),c[1])for(var h=c[1].split(","),m=0;m<h.length;m+=1)k.push(new H(c[0],h[m]));else k.push(new H(c[0]));F(g,function(){a(k,f)})};function va(a,b,d){a?this.c=a:this.c=b+wa;this.a=[];this.f=[];this.g=d||""}var wa="//fonts.googleapis.com/css";function xa(a,b){for(var d=b.length,c=0;c<d;c++){var e=b[c].split(":");3==e.length&&a.f.push(e.pop());var f="";2==e.length&&""!=e[1]&&(f=":");a.a.push(e.join(f))}}function ya(a){if(0==a.a.length)throw Error("No fonts to load!");if(-1!=a.c.indexOf("kit="))return a.c;for(var b=a.a.length,d=[],c=0;c<b;c++)d.push(a.a[c].replace(/ /g,"+"));b=a.c+"?family="+d.join("%7C");0<a.f.length&&(b+="&subset="+a.f.join(","));0<a.g.length&&(b+="&text="+encodeURIComponent(a.g));return b}function za(a){this.f=a;this.a=[];this.c={}}var Aa={latin:"BESbswy",cyrillic:"йяЖ",greek:"αβΣ",khmer:"កខគ",Hanuman:"កខគ"},Ba={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},Ca={i:"i",italic:"i",n:"n",normal:"n"},Da=/^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/;function Ea(a){for(var b=a.f.length,d=0;d<b;d++){var c=a.f[d].split(":"),e=c[0].replace(/\+/g," "),f=["n4"];if(2<=c.length){var g;var k=c[1];g=[];if(k)for(var k=k.split(","),h=k.length,m=0;m<h;m++){var l;l=k[m];if(l.match(/^[\w-]+$/)){var n=Da.exec(l.toLowerCase());if(null==n)l="";else{l=n[2];l=null==l||""==l?"n":Ca[l];n=n[1];if(null==n||""==n)n="4";else var r=Ba[n],n=r?r:isNaN(n)?"4":n.substr(0,1);l=[l,n].join("")}}else l="";l&&g.push(l)}0<g.length&&(f=g);3==c.length&&(c=c[2],g=[],c=c?c.split(","):g,0<c.length&&(c=Aa[c[0]])&&(a.c[e]=c))}a.c[e]||(c=Aa[e])&&(a.c[e]=c);for(c=0;c<f.length;c+=1)a.a.push(new H(e,f[c]))}}function Fa(a,b){this.c=a;this.a=b}var Ga={Arimo:!0,Cousine:!0,Tinos:!0};Fa.prototype.load=function(a){var b=new C,d=this.c,c=new va(this.a.api,z(d),this.a.text),e=this.a.families;xa(c,e);var f=new za(e);Ea(f);A(d,ya(c),D(b));F(b,function(){a(f.a,f.c,Ga)})};function Ha(a,b){this.c=a;this.a=b}Ha.prototype.load=function(a){var b=this.a.id,d=this.c.m;b?B(this.c,(this.a.api||"https://use.typekit.net")+"/"+b+".js",function(b){if(b)a([]);else if(d.Typekit&&d.Typekit.config&&d.Typekit.config.fn){b=d.Typekit.config.fn;for(var e=[],f=0;f<b.length;f+=2)for(var g=b[f],k=b[f+1],h=0;h<k.length;h++)e.push(new H(g,k[h]));try{d.Typekit.load({events:!1,classes:!1,async:!0})}catch(m){}a(e)}},2e3):a([])};function Ia(a,b){this.c=a;this.f=b;this.a=[]}Ia.prototype.load=function(a){var b=this.f.id,d=this.c.m,c=this;b?(d.__webfontfontdeckmodule__||(d.__webfontfontdeckmodule__={}),d.__webfontfontdeckmodule__[b]=function(b,d){for(var g=0,k=d.fonts.length;g<k;++g){var h=d.fonts[g];c.a.push(new H(h.name,ga("font-weight:"+h.weight+";font-style:"+h.style)))}a(c.a)},B(this.c,z(this.c)+(this.f.api||"//f.fontdeck.com/s/css/js/")+ea(this.c)+"/"+b+".js",function(b){b&&a([])})):a([])};var Y=new pa(window);Y.a.c.custom=function(a,b){return new ua(b,a)};Y.a.c.fontdeck=function(a,b){return new Ia(b,a)};Y.a.c.monotype=function(a,b){return new sa(b,a)};Y.a.c.typekit=function(a,b){return new Ha(b,a)};Y.a.c.google=function(a,b){return new Fa(b,a)};var Z={load:p(Y.load,Y)};"function"===typeof define&&define.amd?define(function(){return Z}):"undefined"!==typeof module&&module.exports?module.exports=Z:(window.WebFont=Z,window.WebFontConfig&&Y.load(window.WebFontConfig))})();!function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&false)define(e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.p2=e()}}(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){var Scalar=_dereq_("./Scalar");module.exports=Line;function Line(){}Line.lineInt=function(l1,l2,precision){precision=precision||0;var i=[0,0];var a1,b1,c1,a2,b2,c2,det;a1=l1[1][1]-l1[0][1];b1=l1[0][0]-l1[1][0];c1=a1*l1[0][0]+b1*l1[0][1];a2=l2[1][1]-l2[0][1];b2=l2[0][0]-l2[1][0];c2=a2*l2[0][0]+b2*l2[0][1];det=a1*b2-a2*b1;if(!Scalar.eq(det,0,precision)){i[0]=(b2*c1-b1*c2)/det;i[1]=(a1*c2-a2*c1)/det}return i};Line.segmentsIntersect=function(p1,p2,q1,q2){var dx=p2[0]-p1[0];var dy=p2[1]-p1[1];var da=q2[0]-q1[0];var db=q2[1]-q1[1];if(da*dy-db*dx==0)return false;var s=(dx*(q1[1]-p1[1])+dy*(p1[0]-q1[0]))/(da*dy-db*dx);var t=(da*(p1[1]-q1[1])+db*(q1[0]-p1[0]))/(db*dx-da*dy);return s>=0&&s<=1&&t>=0&&t<=1}},{"./Scalar":4}],2:[function(_dereq_,module,exports){module.exports=Point;function Point(){}Point.area=function(a,b,c){return(b[0]-a[0])*(c[1]-a[1])-(c[0]-a[0])*(b[1]-a[1])};Point.left=function(a,b,c){return Point.area(a,b,c)>0};Point.leftOn=function(a,b,c){return Point.area(a,b,c)>=0};Point.right=function(a,b,c){return Point.area(a,b,c)<0};Point.rightOn=function(a,b,c){return Point.area(a,b,c)<=0};var tmpPoint1=[],tmpPoint2=[];Point.collinear=function(a,b,c,thresholdAngle){if(!thresholdAngle)return Point.area(a,b,c)==0;else{var ab=tmpPoint1,bc=tmpPoint2;ab[0]=b[0]-a[0];ab[1]=b[1]-a[1];bc[0]=c[0]-b[0];bc[1]=c[1]-b[1];var dot=ab[0]*bc[0]+ab[1]*bc[1],magA=Math.sqrt(ab[0]*ab[0]+ab[1]*ab[1]),magB=Math.sqrt(bc[0]*bc[0]+bc[1]*bc[1]),angle=Math.acos(dot/(magA*magB));return angle<thresholdAngle}};Point.sqdist=function(a,b){var dx=b[0]-a[0];var dy=b[1]-a[1];return dx*dx+dy*dy}},{}],3:[function(_dereq_,module,exports){var Line=_dereq_("./Line"),Point=_dereq_("./Point"),Scalar=_dereq_("./Scalar");module.exports=Polygon;function Polygon(){this.vertices=[]}Polygon.prototype.at=function(i){var v=this.vertices,s=v.length;return v[i<0?i%s+s:i%s]};Polygon.prototype.first=function(){return this.vertices[0]};Polygon.prototype.last=function(){return this.vertices[this.vertices.length-1]};Polygon.prototype.clear=function(){this.vertices.length=0};Polygon.prototype.append=function(poly,from,to){if(typeof from=="undefined")throw new Error("From is not given!");if(typeof to=="undefined")throw new Error("To is not given!");if(to-1<from)throw new Error("lol1");if(to>poly.vertices.length)throw new Error("lol2");if(from<0)throw new Error("lol3");for(var i=from;i<to;i++){this.vertices.push(poly.vertices[i])}};Polygon.prototype.makeCCW=function(){var br=0,v=this.vertices;for(var i=1;i<this.vertices.length;++i){if(v[i][1]<v[br][1]||v[i][1]==v[br][1]&&v[i][0]>v[br][0]){br=i}}if(!Point.left(this.at(br-1),this.at(br),this.at(br+1))){this.reverse()}};Polygon.prototype.reverse=function(){var tmp=[];for(var i=0,N=this.vertices.length;i!==N;i++){tmp.push(this.vertices.pop())}this.vertices=tmp};Polygon.prototype.isReflex=function(i){return Point.right(this.at(i-1),this.at(i),this.at(i+1))};var tmpLine1=[],tmpLine2=[];Polygon.prototype.canSee=function(a,b){var p,dist,l1=tmpLine1,l2=tmpLine2;if(Point.leftOn(this.at(a+1),this.at(a),this.at(b))&&Point.rightOn(this.at(a-1),this.at(a),this.at(b))){return false}dist=Point.sqdist(this.at(a),this.at(b));for(var i=0;i!==this.vertices.length;++i){if((i+1)%this.vertices.length===a||i===a)continue;if(Point.leftOn(this.at(a),this.at(b),this.at(i+1))&&Point.rightOn(this.at(a),this.at(b),this.at(i))){l1[0]=this.at(a);l1[1]=this.at(b);l2[0]=this.at(i);l2[1]=this.at(i+1);p=Line.lineInt(l1,l2);if(Point.sqdist(this.at(a),p)<dist){return false}}}return true};Polygon.prototype.copy=function(i,j,targetPoly){var p=targetPoly||new Polygon;p.clear();if(i<j){for(var k=i;k<=j;k++)p.vertices.push(this.vertices[k])}else{for(var k=0;k<=j;k++)p.vertices.push(this.vertices[k]);for(var k=i;k<this.vertices.length;k++)p.vertices.push(this.vertices[k])}return p};Polygon.prototype.getCutEdges=function(){var min=[],tmp1=[],tmp2=[],tmpPoly=new Polygon;var nDiags=Number.MAX_VALUE;for(var i=0;i<this.vertices.length;++i){if(this.isReflex(i)){for(var j=0;j<this.vertices.length;++j){if(this.canSee(i,j)){tmp1=this.copy(i,j,tmpPoly).getCutEdges();tmp2=this.copy(j,i,tmpPoly).getCutEdges();for(var k=0;k<tmp2.length;k++)tmp1.push(tmp2[k]);if(tmp1.length<nDiags){min=tmp1;nDiags=tmp1.length;min.push([this.at(i),this.at(j)])}}}}}return min};Polygon.prototype.decomp=function(){var edges=this.getCutEdges();if(edges.length>0)return this.slice(edges);else return[this]};Polygon.prototype.slice=function(cutEdges){if(cutEdges.length==0)return[this];if(cutEdges instanceof Array&&cutEdges.length&&cutEdges[0]instanceof Array&&cutEdges[0].length==2&&cutEdges[0][0]instanceof Array){var polys=[this];for(var i=0;i<cutEdges.length;i++){var cutEdge=cutEdges[i];for(var j=0;j<polys.length;j++){var poly=polys[j];var result=poly.slice(cutEdge);if(result){polys.splice(j,1);polys.push(result[0],result[1]);break}}}return polys}else{var cutEdge=cutEdges;var i=this.vertices.indexOf(cutEdge[0]);var j=this.vertices.indexOf(cutEdge[1]);if(i!=-1&&j!=-1){return[this.copy(i,j),this.copy(j,i)]}else{return false}}};Polygon.prototype.isSimple=function(){var path=this.vertices;for(var i=0;i<path.length-1;i++){for(var j=0;j<i-1;j++){if(Line.segmentsIntersect(path[i],path[i+1],path[j],path[j+1])){return false}}}for(var i=1;i<path.length-2;i++){if(Line.segmentsIntersect(path[0],path[path.length-1],path[i],path[i+1])){return false}}return true};function getIntersectionPoint(p1,p2,q1,q2,delta){delta=delta||0;var a1=p2[1]-p1[1];var b1=p1[0]-p2[0];var c1=a1*p1[0]+b1*p1[1];var a2=q2[1]-q1[1];var b2=q1[0]-q2[0];var c2=a2*q1[0]+b2*q1[1];var det=a1*b2-a2*b1;if(!Scalar.eq(det,0,delta))return[(b2*c1-b1*c2)/det,(a1*c2-a2*c1)/det];else return[0,0]}Polygon.prototype.quickDecomp=function(result,reflexVertices,steinerPoints,delta,maxlevel,level){maxlevel=maxlevel||100;level=level||0;delta=delta||25;result=typeof result!="undefined"?result:[];reflexVertices=reflexVertices||[];steinerPoints=steinerPoints||[];var upperInt=[0,0],lowerInt=[0,0],p=[0,0];var upperDist=0,lowerDist=0,d=0,closestDist=0;var upperIndex=0,lowerIndex=0,closestIndex=0;var lowerPoly=new Polygon,upperPoly=new Polygon;var poly=this,v=this.vertices;if(v.length<3)return result;level++;if(level>maxlevel){console.warn("quickDecomp: max level ("+maxlevel+") reached.");return result}for(var i=0;i<this.vertices.length;++i){if(poly.isReflex(i)){reflexVertices.push(poly.vertices[i]);upperDist=lowerDist=Number.MAX_VALUE;for(var j=0;j<this.vertices.length;++j){if(Point.left(poly.at(i-1),poly.at(i),poly.at(j))&&Point.rightOn(poly.at(i-1),poly.at(i),poly.at(j-1))){p=getIntersectionPoint(poly.at(i-1),poly.at(i),poly.at(j),poly.at(j-1));if(Point.right(poly.at(i+1),poly.at(i),p)){d=Point.sqdist(poly.vertices[i],p);if(d<lowerDist){lowerDist=d;lowerInt=p;lowerIndex=j}}}if(Point.left(poly.at(i+1),poly.at(i),poly.at(j+1))&&Point.rightOn(poly.at(i+1),poly.at(i),poly.at(j))){p=getIntersectionPoint(poly.at(i+1),poly.at(i),poly.at(j),poly.at(j+1));if(Point.left(poly.at(i-1),poly.at(i),p)){d=Point.sqdist(poly.vertices[i],p);if(d<upperDist){upperDist=d;upperInt=p;upperIndex=j}}}}if(lowerIndex==(upperIndex+1)%this.vertices.length){p[0]=(lowerInt[0]+upperInt[0])/2;p[1]=(lowerInt[1]+upperInt[1])/2;steinerPoints.push(p);if(i<upperIndex){lowerPoly.append(poly,i,upperIndex+1);lowerPoly.vertices.push(p);upperPoly.vertices.push(p);if(lowerIndex!=0){upperPoly.append(poly,lowerIndex,poly.vertices.length)}upperPoly.append(poly,0,i+1)}else{if(i!=0){lowerPoly.append(poly,i,poly.vertices.length)}lowerPoly.append(poly,0,upperIndex+1);lowerPoly.vertices.push(p);upperPoly.vertices.push(p);upperPoly.append(poly,lowerIndex,i+1)}}else{if(lowerIndex>upperIndex){upperIndex+=this.vertices.length}closestDist=Number.MAX_VALUE;if(upperIndex<lowerIndex){return result}for(var j=lowerIndex;j<=upperIndex;++j){if(Point.leftOn(poly.at(i-1),poly.at(i),poly.at(j))&&Point.rightOn(poly.at(i+1),poly.at(i),poly.at(j))){d=Point.sqdist(poly.at(i),poly.at(j));if(d<closestDist){closestDist=d;closestIndex=j%this.vertices.length}}}if(i<closestIndex){lowerPoly.append(poly,i,closestIndex+1);if(closestIndex!=0){upperPoly.append(poly,closestIndex,v.length)}upperPoly.append(poly,0,i+1)}else{if(i!=0){lowerPoly.append(poly,i,v.length)}lowerPoly.append(poly,0,closestIndex+1);upperPoly.append(poly,closestIndex,i+1)}}if(lowerPoly.vertices.length<upperPoly.vertices.length){lowerPoly.quickDecomp(result,reflexVertices,steinerPoints,delta,maxlevel,level);upperPoly.quickDecomp(result,reflexVertices,steinerPoints,delta,maxlevel,level)}else{upperPoly.quickDecomp(result,reflexVertices,steinerPoints,delta,maxlevel,level);lowerPoly.quickDecomp(result,reflexVertices,steinerPoints,delta,maxlevel,level)}return result}}result.push(this);return result};Polygon.prototype.removeCollinearPoints=function(precision){var num=0;for(var i=this.vertices.length-1;this.vertices.length>3&&i>=0;--i){if(Point.collinear(this.at(i-1),this.at(i),this.at(i+1),precision)){this.vertices.splice(i%this.vertices.length,1);i--;num++}}return num}},{"./Line":1,"./Point":2,"./Scalar":4}],4:[function(_dereq_,module,exports){module.exports=Scalar;function Scalar(){}Scalar.eq=function(a,b,precision){precision=precision||0;return Math.abs(a-b)<precision}},{}],5:[function(_dereq_,module,exports){module.exports={Polygon:_dereq_("./Polygon"),Point:_dereq_("./Point")}},{"./Point":2,"./Polygon":3}],6:[function(_dereq_,module,exports){module.exports={name:"p2",version:"0.7.1",description:"A JavaScript 2D physics engine.",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["p2.js","p2","physics","engine","2d"],main:"./src/p2.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/p2.js.git"},bugs:{url:"https://github.com/schteppe/p2.js/issues"},licenses:[{type:"MIT"}],devDependencies:{grunt:"^0.4.5","grunt-contrib-jshint":"^0.11.2","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-uglify":"~0.4.0","grunt-contrib-watch":"~0.5.0","grunt-browserify":"~2.0.1","grunt-contrib-concat":"^0.4.0"},dependencies:{"poly-decomp":"0.1.1"}}},{}],7:[function(_dereq_,module,exports){var vec2=_dereq_("../math/vec2"),Utils=_dereq_("../utils/Utils");module.exports=AABB;function AABB(options){this.lowerBound=vec2.create();if(options&&options.lowerBound){vec2.copy(this.lowerBound,options.lowerBound)}this.upperBound=vec2.create();if(options&&options.upperBound){vec2.copy(this.upperBound,options.upperBound)}}var tmp=vec2.create();AABB.prototype.setFromPoints=function(points,position,angle,skinSize){var l=this.lowerBound,u=this.upperBound;if(typeof angle!=="number"){angle=0}if(angle!==0){vec2.rotate(l,points[0],angle)}else{vec2.copy(l,points[0])}vec2.copy(u,l);var cosAngle=Math.cos(angle),sinAngle=Math.sin(angle);for(var i=1;i<points.length;i++){var p=points[i];if(angle!==0){var x=p[0],y=p[1];tmp[0]=cosAngle*x-sinAngle*y;tmp[1]=sinAngle*x+cosAngle*y;p=tmp}for(var j=0;j<2;j++){if(p[j]>u[j]){u[j]=p[j]}if(p[j]<l[j]){l[j]=p[j]}}}if(position){vec2.add(this.lowerBound,this.lowerBound,position);vec2.add(this.upperBound,this.upperBound,position)}if(skinSize){this.lowerBound[0]-=skinSize;this.lowerBound[1]-=skinSize;this.upperBound[0]+=skinSize;this.upperBound[1]+=skinSize}};AABB.prototype.copy=function(aabb){vec2.copy(this.lowerBound,aabb.lowerBound);vec2.copy(this.upperBound,aabb.upperBound)};AABB.prototype.extend=function(aabb){var i=2;while(i--){var l=aabb.lowerBound[i];if(this.lowerBound[i]>l){this.lowerBound[i]=l}var u=aabb.upperBound[i];if(this.upperBound[i]<u){this.upperBound[i]=u}}};AABB.prototype.overlaps=function(aabb){var l1=this.lowerBound,u1=this.upperBound,l2=aabb.lowerBound,u2=aabb.upperBound;return(l2[0]<=u1[0]&&u1[0]<=u2[0]||l1[0]<=u2[0]&&u2[0]<=u1[0])&&(l2[1]<=u1[1]&&u1[1]<=u2[1]||l1[1]<=u2[1]&&u2[1]<=u1[1])};AABB.prototype.containsPoint=function(point){var l=this.lowerBound,u=this.upperBound;return l[0]<=point[0]&&point[0]<=u[0]&&l[1]<=point[1]&&point[1]<=u[1]};AABB.prototype.overlapsRay=function(ray){var t=0;var dirFracX=1/ray.direction[0];var dirFracY=1/ray.direction[1];var t1=(this.lowerBound[0]-ray.from[0])*dirFracX;var t2=(this.upperBound[0]-ray.from[0])*dirFracX;var t3=(this.lowerBound[1]-ray.from[1])*dirFracY;var t4=(this.upperBound[1]-ray.from[1])*dirFracY;var tmin=Math.max(Math.max(Math.min(t1,t2),Math.min(t3,t4)));var tmax=Math.min(Math.min(Math.max(t1,t2),Math.max(t3,t4)));if(tmax<0){return-1}if(tmin>tmax){return-1}return tmin}},{"../math/vec2":30,"../utils/Utils":57}],8:[function(_dereq_,module,exports){var vec2=_dereq_("../math/vec2");var Body=_dereq_("../objects/Body");module.exports=Broadphase;function Broadphase(type){this.type=type;this.result=[];this.world=null;this.boundingVolumeType=Broadphase.AABB}Broadphase.AABB=1;Broadphase.BOUNDING_CIRCLE=2;Broadphase.prototype.setWorld=function(world){this.world=world};Broadphase.prototype.getCollisionPairs=function(world){};var dist=vec2.create();Broadphase.boundingRadiusCheck=function(bodyA,bodyB){vec2.sub(dist,bodyA.position,bodyB.position);var d2=vec2.squaredLength(dist),r=bodyA.boundingRadius+bodyB.boundingRadius;return d2<=r*r};Broadphase.aabbCheck=function(bodyA,bodyB){return bodyA.getAABB().overlaps(bodyB.getAABB())};Broadphase.prototype.boundingVolumeCheck=function(bodyA,bodyB){var result;switch(this.boundingVolumeType){case Broadphase.BOUNDING_CIRCLE:result=Broadphase.boundingRadiusCheck(bodyA,bodyB);break;case Broadphase.AABB:result=Broadphase.aabbCheck(bodyA,bodyB);break;default:throw new Error("Bounding volume type not recognized: "+this.boundingVolumeType)}return result};Broadphase.canCollide=function(bodyA,bodyB){var KINEMATIC=Body.KINEMATIC;var STATIC=Body.STATIC;if(bodyA.type===STATIC&&bodyB.type===STATIC){return false}if(bodyA.type===KINEMATIC&&bodyB.type===STATIC||bodyA.type===STATIC&&bodyB.type===KINEMATIC){return false}if(bodyA.type===KINEMATIC&&bodyB.type===KINEMATIC){return false}if(bodyA.sleepState===Body.SLEEPING&&bodyB.sleepState===Body.SLEEPING){return false}if(bodyA.sleepState===Body.SLEEPING&&bodyB.type===STATIC||bodyB.sleepState===Body.SLEEPING&&bodyA.type===STATIC){return false}return true};Broadphase.NAIVE=1;Broadphase.SAP=2},{"../math/vec2":30,"../objects/Body":31}],9:[function(_dereq_,module,exports){var Circle=_dereq_("../shapes/Circle"),Plane=_dereq_("../shapes/Plane"),Shape=_dereq_("../shapes/Shape"),Particle=_dereq_("../shapes/Particle"),Broadphase=_dereq_("../collision/Broadphase"),vec2=_dereq_("../math/vec2");module.exports=NaiveBroadphase;function NaiveBroadphase(){Broadphase.call(this,Broadphase.NAIVE)}NaiveBroadphase.prototype=new Broadphase;NaiveBroadphase.prototype.constructor=NaiveBroadphase;NaiveBroadphase.prototype.getCollisionPairs=function(world){var bodies=world.bodies,result=this.result;result.length=0;for(var i=0,Ncolliding=bodies.length;i!==Ncolliding;i++){var bi=bodies[i];for(var j=0;j<i;j++){var bj=bodies[j];if(Broadphase.canCollide(bi,bj)&&this.boundingVolumeCheck(bi,bj)){result.push(bi,bj)}}}return result};NaiveBroadphase.prototype.aabbQuery=function(world,aabb,result){result=result||[];var bodies=world.bodies;for(var i=0;i<bodies.length;i++){var b=bodies[i];if(b.aabbNeedsUpdate){b.updateAABB()}if(b.aabb.overlaps(aabb)){result.push(b)}}return result}},{"../collision/Broadphase":8,"../math/vec2":30,"../shapes/Circle":39,"../shapes/Particle":43,"../shapes/Plane":44,"../shapes/Shape":45}],10:[function(_dereq_,module,exports){var vec2=_dereq_("../math/vec2"),sub=vec2.sub,add=vec2.add,dot=vec2.dot,Utils=_dereq_("../utils/Utils"),ContactEquationPool=_dereq_("../utils/ContactEquationPool"),FrictionEquationPool=_dereq_("../utils/FrictionEquationPool"),TupleDictionary=_dereq_("../utils/TupleDictionary"),Equation=_dereq_("../equations/Equation"),ContactEquation=_dereq_("../equations/ContactEquation"),FrictionEquation=_dereq_("../equations/FrictionEquation"),Circle=_dereq_("../shapes/Circle"),Convex=_dereq_("../shapes/Convex"),Shape=_dereq_("../shapes/Shape"),Body=_dereq_("../objects/Body"),Box=_dereq_("../shapes/Box");module.exports=Narrowphase;var yAxis=vec2.fromValues(0,1);var tmp1=vec2.fromValues(0,0),tmp2=vec2.fromValues(0,0),tmp3=vec2.fromValues(0,0),tmp4=vec2.fromValues(0,0),tmp5=vec2.fromValues(0,0),tmp6=vec2.fromValues(0,0),tmp7=vec2.fromValues(0,0),tmp8=vec2.fromValues(0,0),tmp9=vec2.fromValues(0,0),tmp10=vec2.fromValues(0,0),tmp11=vec2.fromValues(0,0),tmp12=vec2.fromValues(0,0),tmp13=vec2.fromValues(0,0),tmp14=vec2.fromValues(0,0),tmp15=vec2.fromValues(0,0),tmp16=vec2.fromValues(0,0),tmp17=vec2.fromValues(0,0),tmp18=vec2.fromValues(0,0),tmpArray=[];function Narrowphase(){this.contactEquations=[];this.frictionEquations=[];this.enableFriction=true;this.enabledEquations=true;this.slipForce=10;this.frictionCoefficient=.3;this.surfaceVelocity=0;this.contactEquationPool=new ContactEquationPool({
size:32});this.frictionEquationPool=new FrictionEquationPool({size:64});this.restitution=0;this.stiffness=Equation.DEFAULT_STIFFNESS;this.relaxation=Equation.DEFAULT_RELAXATION;this.frictionStiffness=Equation.DEFAULT_STIFFNESS;this.frictionRelaxation=Equation.DEFAULT_RELAXATION;this.enableFrictionReduction=true;this.collidingBodiesLastStep=new TupleDictionary;this.contactSkinSize=.01}var bodiesOverlap_shapePositionA=vec2.create();var bodiesOverlap_shapePositionB=vec2.create();Narrowphase.prototype.bodiesOverlap=function(bodyA,bodyB){var shapePositionA=bodiesOverlap_shapePositionA;var shapePositionB=bodiesOverlap_shapePositionB;for(var k=0,Nshapesi=bodyA.shapes.length;k!==Nshapesi;k++){var shapeA=bodyA.shapes[k];bodyA.toWorldFrame(shapePositionA,shapeA.position);for(var l=0,Nshapesj=bodyB.shapes.length;l!==Nshapesj;l++){var shapeB=bodyB.shapes[l];bodyB.toWorldFrame(shapePositionB,shapeB.position);if(this[shapeA.type|shapeB.type](bodyA,shapeA,shapePositionA,shapeA.angle+bodyA.angle,bodyB,shapeB,shapePositionB,shapeB.angle+bodyB.angle,true)){return true}}}return false};Narrowphase.prototype.collidedLastStep=function(bodyA,bodyB){var id1=bodyA.id|0,id2=bodyB.id|0;return!!this.collidingBodiesLastStep.get(id1,id2)};Narrowphase.prototype.reset=function(){this.collidingBodiesLastStep.reset();var eqs=this.contactEquations;var l=eqs.length;while(l--){var eq=eqs[l],id1=eq.bodyA.id,id2=eq.bodyB.id;this.collidingBodiesLastStep.set(id1,id2,true)}var ce=this.contactEquations,fe=this.frictionEquations;for(var i=0;i<ce.length;i++){this.contactEquationPool.release(ce[i])}for(var i=0;i<fe.length;i++){this.frictionEquationPool.release(fe[i])}this.contactEquations.length=this.frictionEquations.length=0};Narrowphase.prototype.createContactEquation=function(bodyA,bodyB,shapeA,shapeB){var c=this.contactEquationPool.get();c.bodyA=bodyA;c.bodyB=bodyB;c.shapeA=shapeA;c.shapeB=shapeB;c.restitution=this.restitution;c.firstImpact=!this.collidedLastStep(bodyA,bodyB);c.stiffness=this.stiffness;c.relaxation=this.relaxation;c.needsUpdate=true;c.enabled=this.enabledEquations;c.offset=this.contactSkinSize;return c};Narrowphase.prototype.createFrictionEquation=function(bodyA,bodyB,shapeA,shapeB){var c=this.frictionEquationPool.get();c.bodyA=bodyA;c.bodyB=bodyB;c.shapeA=shapeA;c.shapeB=shapeB;c.setSlipForce(this.slipForce);c.frictionCoefficient=this.frictionCoefficient;c.relativeVelocity=this.surfaceVelocity;c.enabled=this.enabledEquations;c.needsUpdate=true;c.stiffness=this.frictionStiffness;c.relaxation=this.frictionRelaxation;c.contactEquations.length=0;return c};Narrowphase.prototype.createFrictionFromContact=function(c){var eq=this.createFrictionEquation(c.bodyA,c.bodyB,c.shapeA,c.shapeB);vec2.copy(eq.contactPointA,c.contactPointA);vec2.copy(eq.contactPointB,c.contactPointB);vec2.rotate90cw(eq.t,c.normalA);eq.contactEquations.push(c);return eq};Narrowphase.prototype.createFrictionFromAverage=function(numContacts){var c=this.contactEquations[this.contactEquations.length-1];var eq=this.createFrictionEquation(c.bodyA,c.bodyB,c.shapeA,c.shapeB);var bodyA=c.bodyA;var bodyB=c.bodyB;vec2.set(eq.contactPointA,0,0);vec2.set(eq.contactPointB,0,0);vec2.set(eq.t,0,0);for(var i=0;i!==numContacts;i++){c=this.contactEquations[this.contactEquations.length-1-i];if(c.bodyA===bodyA){vec2.add(eq.t,eq.t,c.normalA);vec2.add(eq.contactPointA,eq.contactPointA,c.contactPointA);vec2.add(eq.contactPointB,eq.contactPointB,c.contactPointB)}else{vec2.sub(eq.t,eq.t,c.normalA);vec2.add(eq.contactPointA,eq.contactPointA,c.contactPointB);vec2.add(eq.contactPointB,eq.contactPointB,c.contactPointA)}eq.contactEquations.push(c)}var invNumContacts=1/numContacts;vec2.scale(eq.contactPointA,eq.contactPointA,invNumContacts);vec2.scale(eq.contactPointB,eq.contactPointB,invNumContacts);vec2.normalize(eq.t,eq.t);vec2.rotate90cw(eq.t,eq.t);return eq};Narrowphase.prototype[Shape.LINE|Shape.CONVEX]=Narrowphase.prototype.convexLine=function(convexBody,convexShape,convexOffset,convexAngle,lineBody,lineShape,lineOffset,lineAngle,justTest){if(justTest){return false}else{return 0}};Narrowphase.prototype[Shape.LINE|Shape.BOX]=Narrowphase.prototype.lineBox=function(lineBody,lineShape,lineOffset,lineAngle,boxBody,boxShape,boxOffset,boxAngle,justTest){if(justTest){return false}else{return 0}};function setConvexToCapsuleShapeMiddle(convexShape,capsuleShape){vec2.set(convexShape.vertices[0],-capsuleShape.length*.5,-capsuleShape.radius);vec2.set(convexShape.vertices[1],capsuleShape.length*.5,-capsuleShape.radius);vec2.set(convexShape.vertices[2],capsuleShape.length*.5,capsuleShape.radius);vec2.set(convexShape.vertices[3],-capsuleShape.length*.5,capsuleShape.radius)}var convexCapsule_tempRect=new Box({width:1,height:1}),convexCapsule_tempVec=vec2.create();Narrowphase.prototype[Shape.CAPSULE|Shape.CONVEX]=Narrowphase.prototype[Shape.CAPSULE|Shape.BOX]=Narrowphase.prototype.convexCapsule=function(convexBody,convexShape,convexPosition,convexAngle,capsuleBody,capsuleShape,capsulePosition,capsuleAngle,justTest){var circlePos=convexCapsule_tempVec;vec2.set(circlePos,capsuleShape.length/2,0);vec2.rotate(circlePos,circlePos,capsuleAngle);vec2.add(circlePos,circlePos,capsulePosition);var result1=this.circleConvex(capsuleBody,capsuleShape,circlePos,capsuleAngle,convexBody,convexShape,convexPosition,convexAngle,justTest,capsuleShape.radius);vec2.set(circlePos,-capsuleShape.length/2,0);vec2.rotate(circlePos,circlePos,capsuleAngle);vec2.add(circlePos,circlePos,capsulePosition);var result2=this.circleConvex(capsuleBody,capsuleShape,circlePos,capsuleAngle,convexBody,convexShape,convexPosition,convexAngle,justTest,capsuleShape.radius);if(justTest&&(result1||result2)){return true}var r=convexCapsule_tempRect;setConvexToCapsuleShapeMiddle(r,capsuleShape);var result=this.convexConvex(convexBody,convexShape,convexPosition,convexAngle,capsuleBody,r,capsulePosition,capsuleAngle,justTest);return result+result1+result2};Narrowphase.prototype[Shape.CAPSULE|Shape.LINE]=Narrowphase.prototype.lineCapsule=function(lineBody,lineShape,linePosition,lineAngle,capsuleBody,capsuleShape,capsulePosition,capsuleAngle,justTest){if(justTest){return false}else{return 0}};var capsuleCapsule_tempVec1=vec2.create();var capsuleCapsule_tempVec2=vec2.create();var capsuleCapsule_tempRect1=new Box({width:1,height:1});Narrowphase.prototype[Shape.CAPSULE|Shape.CAPSULE]=Narrowphase.prototype.capsuleCapsule=function(bi,si,xi,ai,bj,sj,xj,aj,justTest){var enableFrictionBefore;var circlePosi=capsuleCapsule_tempVec1,circlePosj=capsuleCapsule_tempVec2;var numContacts=0;for(var i=0;i<2;i++){vec2.set(circlePosi,(i===0?-1:1)*si.length/2,0);vec2.rotate(circlePosi,circlePosi,ai);vec2.add(circlePosi,circlePosi,xi);for(var j=0;j<2;j++){vec2.set(circlePosj,(j===0?-1:1)*sj.length/2,0);vec2.rotate(circlePosj,circlePosj,aj);vec2.add(circlePosj,circlePosj,xj);if(this.enableFrictionReduction){enableFrictionBefore=this.enableFriction;this.enableFriction=false}var result=this.circleCircle(bi,si,circlePosi,ai,bj,sj,circlePosj,aj,justTest,si.radius,sj.radius);if(this.enableFrictionReduction){this.enableFriction=enableFrictionBefore}if(justTest&&result){return true}numContacts+=result}}if(this.enableFrictionReduction){enableFrictionBefore=this.enableFriction;this.enableFriction=false}var rect=capsuleCapsule_tempRect1;setConvexToCapsuleShapeMiddle(rect,si);var result1=this.convexCapsule(bi,rect,xi,ai,bj,sj,xj,aj,justTest);if(this.enableFrictionReduction){this.enableFriction=enableFrictionBefore}if(justTest&&result1){return true}numContacts+=result1;if(this.enableFrictionReduction){var enableFrictionBefore=this.enableFriction;this.enableFriction=false}setConvexToCapsuleShapeMiddle(rect,sj);var result2=this.convexCapsule(bj,rect,xj,aj,bi,si,xi,ai,justTest);if(this.enableFrictionReduction){this.enableFriction=enableFrictionBefore}if(justTest&&result2){return true}numContacts+=result2;if(this.enableFrictionReduction){if(numContacts&&this.enableFriction){this.frictionEquations.push(this.createFrictionFromAverage(numContacts))}}return numContacts};Narrowphase.prototype[Shape.LINE|Shape.LINE]=Narrowphase.prototype.lineLine=function(bodyA,shapeA,positionA,angleA,bodyB,shapeB,positionB,angleB,justTest){if(justTest){return false}else{return 0}};Narrowphase.prototype[Shape.PLANE|Shape.LINE]=Narrowphase.prototype.planeLine=function(planeBody,planeShape,planeOffset,planeAngle,lineBody,lineShape,lineOffset,lineAngle,justTest){var worldVertex0=tmp1,worldVertex1=tmp2,worldVertex01=tmp3,worldVertex11=tmp4,worldEdge=tmp5,worldEdgeUnit=tmp6,dist=tmp7,worldNormal=tmp8,worldTangent=tmp9,verts=tmpArray,numContacts=0;vec2.set(worldVertex0,-lineShape.length/2,0);vec2.set(worldVertex1,lineShape.length/2,0);vec2.rotate(worldVertex01,worldVertex0,lineAngle);vec2.rotate(worldVertex11,worldVertex1,lineAngle);add(worldVertex01,worldVertex01,lineOffset);add(worldVertex11,worldVertex11,lineOffset);vec2.copy(worldVertex0,worldVertex01);vec2.copy(worldVertex1,worldVertex11);sub(worldEdge,worldVertex1,worldVertex0);vec2.normalize(worldEdgeUnit,worldEdge);vec2.rotate90cw(worldTangent,worldEdgeUnit);vec2.rotate(worldNormal,yAxis,planeAngle);verts[0]=worldVertex0;verts[1]=worldVertex1;for(var i=0;i<verts.length;i++){var v=verts[i];sub(dist,v,planeOffset);var d=dot(dist,worldNormal);if(d<0){if(justTest){return true}var c=this.createContactEquation(planeBody,lineBody,planeShape,lineShape);numContacts++;vec2.copy(c.normalA,worldNormal);vec2.normalize(c.normalA,c.normalA);vec2.scale(dist,worldNormal,d);sub(c.contactPointA,v,dist);sub(c.contactPointA,c.contactPointA,planeBody.position);sub(c.contactPointB,v,lineOffset);add(c.contactPointB,c.contactPointB,lineOffset);sub(c.contactPointB,c.contactPointB,lineBody.position);this.contactEquations.push(c);if(!this.enableFrictionReduction){if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(c))}}}}if(justTest){return false}if(!this.enableFrictionReduction){if(numContacts&&this.enableFriction){this.frictionEquations.push(this.createFrictionFromAverage(numContacts))}}return numContacts};Narrowphase.prototype[Shape.PARTICLE|Shape.CAPSULE]=Narrowphase.prototype.particleCapsule=function(particleBody,particleShape,particlePosition,particleAngle,capsuleBody,capsuleShape,capsulePosition,capsuleAngle,justTest){return this.circleLine(particleBody,particleShape,particlePosition,particleAngle,capsuleBody,capsuleShape,capsulePosition,capsuleAngle,justTest,capsuleShape.radius,0)};Narrowphase.prototype[Shape.CIRCLE|Shape.LINE]=Narrowphase.prototype.circleLine=function(circleBody,circleShape,circleOffset,circleAngle,lineBody,lineShape,lineOffset,lineAngle,justTest,lineRadius,circleRadius){var lineRadius=lineRadius||0,circleRadius=typeof circleRadius!=="undefined"?circleRadius:circleShape.radius,orthoDist=tmp1,lineToCircleOrthoUnit=tmp2,projectedPoint=tmp3,centerDist=tmp4,worldTangent=tmp5,worldEdge=tmp6,worldEdgeUnit=tmp7,worldVertex0=tmp8,worldVertex1=tmp9,worldVertex01=tmp10,worldVertex11=tmp11,dist=tmp12,lineToCircle=tmp13,lineEndToLineRadius=tmp14,verts=tmpArray;vec2.set(worldVertex0,-lineShape.length/2,0);vec2.set(worldVertex1,lineShape.length/2,0);vec2.rotate(worldVertex01,worldVertex0,lineAngle);vec2.rotate(worldVertex11,worldVertex1,lineAngle);add(worldVertex01,worldVertex01,lineOffset);add(worldVertex11,worldVertex11,lineOffset);vec2.copy(worldVertex0,worldVertex01);vec2.copy(worldVertex1,worldVertex11);sub(worldEdge,worldVertex1,worldVertex0);vec2.normalize(worldEdgeUnit,worldEdge);vec2.rotate90cw(worldTangent,worldEdgeUnit);sub(dist,circleOffset,worldVertex0);var d=dot(dist,worldTangent);sub(centerDist,worldVertex0,lineOffset);sub(lineToCircle,circleOffset,lineOffset);var radiusSum=circleRadius+lineRadius;if(Math.abs(d)<radiusSum){vec2.scale(orthoDist,worldTangent,d);sub(projectedPoint,circleOffset,orthoDist);vec2.scale(lineToCircleOrthoUnit,worldTangent,dot(worldTangent,lineToCircle));vec2.normalize(lineToCircleOrthoUnit,lineToCircleOrthoUnit);vec2.scale(lineToCircleOrthoUnit,lineToCircleOrthoUnit,lineRadius);add(projectedPoint,projectedPoint,lineToCircleOrthoUnit);var pos=dot(worldEdgeUnit,projectedPoint);var pos0=dot(worldEdgeUnit,worldVertex0);var pos1=dot(worldEdgeUnit,worldVertex1);if(pos>pos0&&pos<pos1){if(justTest){return true}var c=this.createContactEquation(circleBody,lineBody,circleShape,lineShape);vec2.scale(c.normalA,orthoDist,-1);vec2.normalize(c.normalA,c.normalA);vec2.scale(c.contactPointA,c.normalA,circleRadius);add(c.contactPointA,c.contactPointA,circleOffset);sub(c.contactPointA,c.contactPointA,circleBody.position);sub(c.contactPointB,projectedPoint,lineOffset);add(c.contactPointB,c.contactPointB,lineOffset);sub(c.contactPointB,c.contactPointB,lineBody.position);this.contactEquations.push(c);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(c))}return 1}}verts[0]=worldVertex0;verts[1]=worldVertex1;for(var i=0;i<verts.length;i++){var v=verts[i];sub(dist,v,circleOffset);if(vec2.squaredLength(dist)<Math.pow(radiusSum,2)){if(justTest){return true}var c=this.createContactEquation(circleBody,lineBody,circleShape,lineShape);vec2.copy(c.normalA,dist);vec2.normalize(c.normalA,c.normalA);vec2.scale(c.contactPointA,c.normalA,circleRadius);add(c.contactPointA,c.contactPointA,circleOffset);sub(c.contactPointA,c.contactPointA,circleBody.position);sub(c.contactPointB,v,lineOffset);vec2.scale(lineEndToLineRadius,c.normalA,-lineRadius);add(c.contactPointB,c.contactPointB,lineEndToLineRadius);add(c.contactPointB,c.contactPointB,lineOffset);sub(c.contactPointB,c.contactPointB,lineBody.position);this.contactEquations.push(c);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(c))}return 1}}return 0};Narrowphase.prototype[Shape.CIRCLE|Shape.CAPSULE]=Narrowphase.prototype.circleCapsule=function(bi,si,xi,ai,bj,sj,xj,aj,justTest){return this.circleLine(bi,si,xi,ai,bj,sj,xj,aj,justTest,sj.radius)};Narrowphase.prototype[Shape.CIRCLE|Shape.CONVEX]=Narrowphase.prototype[Shape.CIRCLE|Shape.BOX]=Narrowphase.prototype.circleConvex=function(circleBody,circleShape,circleOffset,circleAngle,convexBody,convexShape,convexOffset,convexAngle,justTest,circleRadius){var circleRadius=typeof circleRadius==="number"?circleRadius:circleShape.radius;var worldVertex0=tmp1,worldVertex1=tmp2,worldEdge=tmp3,worldEdgeUnit=tmp4,worldNormal=tmp5,centerDist=tmp6,convexToCircle=tmp7,orthoDist=tmp8,projectedPoint=tmp9,dist=tmp10,worldVertex=tmp11,closestEdge=-1,closestEdgeDistance=null,closestEdgeOrthoDist=tmp12,closestEdgeProjectedPoint=tmp13,candidate=tmp14,candidateDist=tmp15,minCandidate=tmp16,found=false,minCandidateDistance=Number.MAX_VALUE;var numReported=0;var verts=convexShape.vertices;for(var i=0;i!==verts.length+1;i++){var v0=verts[i%verts.length],v1=verts[(i+1)%verts.length];vec2.rotate(worldVertex0,v0,convexAngle);vec2.rotate(worldVertex1,v1,convexAngle);add(worldVertex0,worldVertex0,convexOffset);add(worldVertex1,worldVertex1,convexOffset);sub(worldEdge,worldVertex1,worldVertex0);vec2.normalize(worldEdgeUnit,worldEdge);vec2.rotate90cw(worldNormal,worldEdgeUnit);vec2.scale(candidate,worldNormal,-circleShape.radius);add(candidate,candidate,circleOffset);if(pointInConvex(candidate,convexShape,convexOffset,convexAngle)){vec2.sub(candidateDist,worldVertex0,candidate);var candidateDistance=Math.abs(vec2.dot(candidateDist,worldNormal));if(candidateDistance<minCandidateDistance){vec2.copy(minCandidate,candidate);minCandidateDistance=candidateDistance;vec2.scale(closestEdgeProjectedPoint,worldNormal,candidateDistance);vec2.add(closestEdgeProjectedPoint,closestEdgeProjectedPoint,candidate);found=true}}}if(found){if(justTest){return true}var c=this.createContactEquation(circleBody,convexBody,circleShape,convexShape);vec2.sub(c.normalA,minCandidate,circleOffset);vec2.normalize(c.normalA,c.normalA);vec2.scale(c.contactPointA,c.normalA,circleRadius);add(c.contactPointA,c.contactPointA,circleOffset);sub(c.contactPointA,c.contactPointA,circleBody.position);sub(c.contactPointB,closestEdgeProjectedPoint,convexOffset);add(c.contactPointB,c.contactPointB,convexOffset);sub(c.contactPointB,c.contactPointB,convexBody.position);this.contactEquations.push(c);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(c))}return 1}if(circleRadius>0){for(var i=0;i<verts.length;i++){var localVertex=verts[i];vec2.rotate(worldVertex,localVertex,convexAngle);add(worldVertex,worldVertex,convexOffset);sub(dist,worldVertex,circleOffset);if(vec2.squaredLength(dist)<Math.pow(circleRadius,2)){if(justTest){return true}var c=this.createContactEquation(circleBody,convexBody,circleShape,convexShape);vec2.copy(c.normalA,dist);vec2.normalize(c.normalA,c.normalA);vec2.scale(c.contactPointA,c.normalA,circleRadius);add(c.contactPointA,c.contactPointA,circleOffset);sub(c.contactPointA,c.contactPointA,circleBody.position);sub(c.contactPointB,worldVertex,convexOffset);add(c.contactPointB,c.contactPointB,convexOffset);sub(c.contactPointB,c.contactPointB,convexBody.position);this.contactEquations.push(c);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(c))}return 1}}}return 0};var pic_worldVertex0=vec2.create(),pic_worldVertex1=vec2.create(),pic_r0=vec2.create(),pic_r1=vec2.create();function pointInConvex(worldPoint,convexShape,convexOffset,convexAngle){var worldVertex0=pic_worldVertex0,worldVertex1=pic_worldVertex1,r0=pic_r0,r1=pic_r1,point=worldPoint,verts=convexShape.vertices,lastCross=null;for(var i=0;i!==verts.length+1;i++){var v0=verts[i%verts.length],v1=verts[(i+1)%verts.length];vec2.rotate(worldVertex0,v0,convexAngle);vec2.rotate(worldVertex1,v1,convexAngle);add(worldVertex0,worldVertex0,convexOffset);add(worldVertex1,worldVertex1,convexOffset);sub(r0,worldVertex0,point);sub(r1,worldVertex1,point);var cross=vec2.crossLength(r0,r1);if(lastCross===null){lastCross=cross}if(cross*lastCross<=0){return false}lastCross=cross}return true}Narrowphase.prototype[Shape.PARTICLE|Shape.CONVEX]=Narrowphase.prototype[Shape.PARTICLE|Shape.BOX]=Narrowphase.prototype.particleConvex=function(particleBody,particleShape,particleOffset,particleAngle,convexBody,convexShape,convexOffset,convexAngle,justTest){var worldVertex0=tmp1,worldVertex1=tmp2,worldEdge=tmp3,worldEdgeUnit=tmp4,worldTangent=tmp5,centerDist=tmp6,convexToparticle=tmp7,orthoDist=tmp8,projectedPoint=tmp9,dist=tmp10,worldVertex=tmp11,closestEdge=-1,closestEdgeDistance=null,closestEdgeOrthoDist=tmp12,closestEdgeProjectedPoint=tmp13,r0=tmp14,r1=tmp15,localPoint=tmp16,candidateDist=tmp17,minEdgeNormal=tmp18,minCandidateDistance=Number.MAX_VALUE;var numReported=0,found=false,verts=convexShape.vertices;if(!pointInConvex(particleOffset,convexShape,convexOffset,convexAngle)){return 0}if(justTest){return true}var lastCross=null;for(var i=0;i!==verts.length+1;i++){var v0=verts[i%verts.length],v1=verts[(i+1)%verts.length];vec2.rotate(worldVertex0,v0,convexAngle);vec2.rotate(worldVertex1,v1,convexAngle);add(worldVertex0,worldVertex0,convexOffset);add(worldVertex1,worldVertex1,convexOffset);sub(worldEdge,worldVertex1,worldVertex0);vec2.normalize(worldEdgeUnit,worldEdge);vec2.rotate90cw(worldTangent,worldEdgeUnit);sub(dist,particleOffset,worldVertex0);var d=dot(dist,worldTangent);sub(centerDist,worldVertex0,convexOffset);sub(convexToparticle,particleOffset,convexOffset);vec2.sub(candidateDist,worldVertex0,particleOffset);var candidateDistance=Math.abs(vec2.dot(candidateDist,worldTangent));if(candidateDistance<minCandidateDistance){minCandidateDistance=candidateDistance;vec2.scale(closestEdgeProjectedPoint,worldTangent,candidateDistance);vec2.add(closestEdgeProjectedPoint,closestEdgeProjectedPoint,particleOffset);vec2.copy(minEdgeNormal,worldTangent);found=true}}if(found){var c=this.createContactEquation(particleBody,convexBody,particleShape,convexShape);vec2.scale(c.normalA,minEdgeNormal,-1);vec2.normalize(c.normalA,c.normalA);vec2.set(c.contactPointA,0,0);add(c.contactPointA,c.contactPointA,particleOffset);sub(c.contactPointA,c.contactPointA,particleBody.position);sub(c.contactPointB,closestEdgeProjectedPoint,convexOffset);add(c.contactPointB,c.contactPointB,convexOffset);sub(c.contactPointB,c.contactPointB,convexBody.position);this.contactEquations.push(c);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(c))}return 1}return 0};Narrowphase.prototype[Shape.CIRCLE]=Narrowphase.prototype.circleCircle=function(bodyA,shapeA,offsetA,angleA,bodyB,shapeB,offsetB,angleB,justTest,radiusA,radiusB){var dist=tmp1,radiusA=radiusA||shapeA.radius,radiusB=radiusB||shapeB.radius;sub(dist,offsetA,offsetB);var r=radiusA+radiusB;if(vec2.squaredLength(dist)>Math.pow(r,2)){return 0}if(justTest){return true}var c=this.createContactEquation(bodyA,bodyB,shapeA,shapeB);sub(c.normalA,offsetB,offsetA);vec2.normalize(c.normalA,c.normalA);vec2.scale(c.contactPointA,c.normalA,radiusA);vec2.scale(c.contactPointB,c.normalA,-radiusB);add(c.contactPointA,c.contactPointA,offsetA);sub(c.contactPointA,c.contactPointA,bodyA.position);add(c.contactPointB,c.contactPointB,offsetB);sub(c.contactPointB,c.contactPointB,bodyB.position);this.contactEquations.push(c);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(c))}return 1};Narrowphase.prototype[Shape.PLANE|Shape.CONVEX]=Narrowphase.prototype[Shape.PLANE|Shape.BOX]=Narrowphase.prototype.planeConvex=function(planeBody,planeShape,planeOffset,planeAngle,convexBody,convexShape,convexOffset,convexAngle,justTest){var worldVertex=tmp1,worldNormal=tmp2,dist=tmp3;var numReported=0;vec2.rotate(worldNormal,yAxis,planeAngle);for(var i=0;i!==convexShape.vertices.length;i++){var v=convexShape.vertices[i];vec2.rotate(worldVertex,v,convexAngle);add(worldVertex,worldVertex,convexOffset);sub(dist,worldVertex,planeOffset);if(dot(dist,worldNormal)<=0){if(justTest){return true}numReported++;var c=this.createContactEquation(planeBody,convexBody,planeShape,convexShape);sub(dist,worldVertex,planeOffset);vec2.copy(c.normalA,worldNormal);var d=dot(dist,c.normalA);vec2.scale(dist,c.normalA,d);sub(c.contactPointB,worldVertex,convexBody.position);sub(c.contactPointA,worldVertex,dist);sub(c.contactPointA,c.contactPointA,planeBody.position);this.contactEquations.push(c);if(!this.enableFrictionReduction){if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(c))}}}}if(this.enableFrictionReduction){if(this.enableFriction&&numReported){this.frictionEquations.push(this.createFrictionFromAverage(numReported))}}return numReported};Narrowphase.prototype[Shape.PARTICLE|Shape.PLANE]=Narrowphase.prototype.particlePlane=function(particleBody,particleShape,particleOffset,particleAngle,planeBody,planeShape,planeOffset,planeAngle,justTest){var dist=tmp1,worldNormal=tmp2;planeAngle=planeAngle||0;sub(dist,particleOffset,planeOffset);vec2.rotate(worldNormal,yAxis,planeAngle);var d=dot(dist,worldNormal);if(d>0){return 0}if(justTest){return true}var c=this.createContactEquation(planeBody,particleBody,planeShape,particleShape);vec2.copy(c.normalA,worldNormal);vec2.scale(dist,c.normalA,d);sub(c.contactPointA,particleOffset,dist);sub(c.contactPointA,c.contactPointA,planeBody.position);sub(c.contactPointB,particleOffset,particleBody.position);this.contactEquations.push(c);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(c))}return 1};Narrowphase.prototype[Shape.CIRCLE|Shape.PARTICLE]=Narrowphase.prototype.circleParticle=function(circleBody,circleShape,circleOffset,circleAngle,particleBody,particleShape,particleOffset,particleAngle,justTest){var dist=tmp1;sub(dist,particleOffset,circleOffset);if(vec2.squaredLength(dist)>Math.pow(circleShape.radius,2)){return 0}if(justTest){return true}var c=this.createContactEquation(circleBody,particleBody,circleShape,particleShape);vec2.copy(c.normalA,dist);vec2.normalize(c.normalA,c.normalA);vec2.scale(c.contactPointA,c.normalA,circleShape.radius);add(c.contactPointA,c.contactPointA,circleOffset);sub(c.contactPointA,c.contactPointA,circleBody.position);sub(c.contactPointB,particleOffset,particleBody.position);this.contactEquations.push(c);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(c))}return 1};var planeCapsule_tmpCircle=new Circle({radius:1}),planeCapsule_tmp1=vec2.create(),planeCapsule_tmp2=vec2.create(),planeCapsule_tmp3=vec2.create();Narrowphase.prototype[Shape.PLANE|Shape.CAPSULE]=Narrowphase.prototype.planeCapsule=function(planeBody,planeShape,planeOffset,planeAngle,capsuleBody,capsuleShape,capsuleOffset,capsuleAngle,justTest){var end1=planeCapsule_tmp1,end2=planeCapsule_tmp2,circle=planeCapsule_tmpCircle,dst=planeCapsule_tmp3;vec2.set(end1,-capsuleShape.length/2,0);vec2.rotate(end1,end1,capsuleAngle);add(end1,end1,capsuleOffset);vec2.set(end2,capsuleShape.length/2,0);vec2.rotate(end2,end2,capsuleAngle);add(end2,end2,capsuleOffset);circle.radius=capsuleShape.radius;var enableFrictionBefore;if(this.enableFrictionReduction){enableFrictionBefore=this.enableFriction;this.enableFriction=false}var numContacts1=this.circlePlane(capsuleBody,circle,end1,0,planeBody,planeShape,planeOffset,planeAngle,justTest),numContacts2=this.circlePlane(capsuleBody,circle,end2,0,planeBody,planeShape,planeOffset,planeAngle,justTest);if(this.enableFrictionReduction){this.enableFriction=enableFrictionBefore}if(justTest){return numContacts1||numContacts2}else{var numTotal=numContacts1+numContacts2;if(this.enableFrictionReduction){if(numTotal){this.frictionEquations.push(this.createFrictionFromAverage(numTotal))}}return numTotal}};Narrowphase.prototype[Shape.CIRCLE|Shape.PLANE]=Narrowphase.prototype.circlePlane=function(bi,si,xi,ai,bj,sj,xj,aj,justTest){var circleBody=bi,circleShape=si,circleOffset=xi,planeBody=bj,shapeB=sj,planeOffset=xj,planeAngle=aj;planeAngle=planeAngle||0;var planeToCircle=tmp1,worldNormal=tmp2,temp=tmp3;sub(planeToCircle,circleOffset,planeOffset);vec2.rotate(worldNormal,yAxis,planeAngle);var d=dot(worldNormal,planeToCircle);if(d>circleShape.radius){return 0}if(justTest){return true}var contact=this.createContactEquation(planeBody,circleBody,sj,si);vec2.copy(contact.normalA,worldNormal);vec2.scale(contact.contactPointB,contact.normalA,-circleShape.radius);add(contact.contactPointB,contact.contactPointB,circleOffset);sub(contact.contactPointB,contact.contactPointB,circleBody.position);vec2.scale(temp,contact.normalA,d);sub(contact.contactPointA,planeToCircle,temp);add(contact.contactPointA,contact.contactPointA,planeOffset);sub(contact.contactPointA,contact.contactPointA,planeBody.position);this.contactEquations.push(contact);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(contact))}return 1};Narrowphase.prototype[Shape.CONVEX]=Narrowphase.prototype[Shape.CONVEX|Shape.BOX]=Narrowphase.prototype[Shape.BOX]=Narrowphase.prototype.convexConvex=function(bi,si,xi,ai,bj,sj,xj,aj,justTest,precision){var sepAxis=tmp1,worldPoint=tmp2,worldPoint0=tmp3,worldPoint1=tmp4,worldEdge=tmp5,projected=tmp6,penetrationVec=tmp7,dist=tmp8,worldNormal=tmp9,numContacts=0,precision=typeof precision==="number"?precision:0;var found=Narrowphase.findSeparatingAxis(si,xi,ai,sj,xj,aj,sepAxis);if(!found){return 0}sub(dist,xj,xi);if(dot(sepAxis,dist)>0){vec2.scale(sepAxis,sepAxis,-1)}var closestEdge1=Narrowphase.getClosestEdge(si,ai,sepAxis,true),closestEdge2=Narrowphase.getClosestEdge(sj,aj,sepAxis);if(closestEdge1===-1||closestEdge2===-1){return 0}for(var k=0;k<2;k++){var closestEdgeA=closestEdge1,closestEdgeB=closestEdge2,shapeA=si,shapeB=sj,offsetA=xi,offsetB=xj,angleA=ai,angleB=aj,bodyA=bi,bodyB=bj;if(k===0){var tmp;tmp=closestEdgeA;closestEdgeA=closestEdgeB;closestEdgeB=tmp;tmp=shapeA;shapeA=shapeB;shapeB=tmp;tmp=offsetA;offsetA=offsetB;offsetB=tmp;tmp=angleA;angleA=angleB;angleB=tmp;tmp=bodyA;bodyA=bodyB;bodyB=tmp}for(var j=closestEdgeB;j<closestEdgeB+2;j++){var v=shapeB.vertices[(j+shapeB.vertices.length)%shapeB.vertices.length];vec2.rotate(worldPoint,v,angleB);add(worldPoint,worldPoint,offsetB);var insideNumEdges=0;for(var i=closestEdgeA-1;i<closestEdgeA+2;i++){var v0=shapeA.vertices[(i+shapeA.vertices.length)%shapeA.vertices.length],v1=shapeA.vertices[(i+1+shapeA.vertices.length)%shapeA.vertices.length];vec2.rotate(worldPoint0,v0,angleA);vec2.rotate(worldPoint1,v1,angleA);add(worldPoint0,worldPoint0,offsetA);add(worldPoint1,worldPoint1,offsetA);sub(worldEdge,worldPoint1,worldPoint0);vec2.rotate90cw(worldNormal,worldEdge);vec2.normalize(worldNormal,worldNormal);sub(dist,worldPoint,worldPoint0);var d=dot(worldNormal,dist);if(i===closestEdgeA&&d<=precision||i!==closestEdgeA&&d<=0){insideNumEdges++}}if(insideNumEdges>=3){if(justTest){return true}var c=this.createContactEquation(bodyA,bodyB,shapeA,shapeB);numContacts++;var v0=shapeA.vertices[closestEdgeA%shapeA.vertices.length],v1=shapeA.vertices[(closestEdgeA+1)%shapeA.vertices.length];vec2.rotate(worldPoint0,v0,angleA);vec2.rotate(worldPoint1,v1,angleA);add(worldPoint0,worldPoint0,offsetA);add(worldPoint1,worldPoint1,offsetA);sub(worldEdge,worldPoint1,worldPoint0);vec2.rotate90cw(c.normalA,worldEdge);vec2.normalize(c.normalA,c.normalA);sub(dist,worldPoint,worldPoint0);var d=dot(c.normalA,dist);vec2.scale(penetrationVec,c.normalA,d);sub(c.contactPointA,worldPoint,offsetA);sub(c.contactPointA,c.contactPointA,penetrationVec);add(c.contactPointA,c.contactPointA,offsetA);sub(c.contactPointA,c.contactPointA,bodyA.position);sub(c.contactPointB,worldPoint,offsetB);add(c.contactPointB,c.contactPointB,offsetB);sub(c.contactPointB,c.contactPointB,bodyB.position);this.contactEquations.push(c);if(!this.enableFrictionReduction){if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(c))}}}}}if(this.enableFrictionReduction){if(this.enableFriction&&numContacts){this.frictionEquations.push(this.createFrictionFromAverage(numContacts))}}return numContacts};var pcoa_tmp1=vec2.fromValues(0,0);Narrowphase.projectConvexOntoAxis=function(convexShape,convexOffset,convexAngle,worldAxis,result){var max=null,min=null,v,value,localAxis=pcoa_tmp1;vec2.rotate(localAxis,worldAxis,-convexAngle);for(var i=0;i<convexShape.vertices.length;i++){v=convexShape.vertices[i];value=dot(v,localAxis);if(max===null||value>max){max=value}if(min===null||value<min){min=value}}if(min>max){var t=min;min=max;max=t}var offset=dot(convexOffset,worldAxis);vec2.set(result,min+offset,max+offset)};var fsa_tmp1=vec2.fromValues(0,0),fsa_tmp2=vec2.fromValues(0,0),fsa_tmp3=vec2.fromValues(0,0),fsa_tmp4=vec2.fromValues(0,0),fsa_tmp5=vec2.fromValues(0,0),fsa_tmp6=vec2.fromValues(0,0);Narrowphase.findSeparatingAxis=function(c1,offset1,angle1,c2,offset2,angle2,sepAxis){var maxDist=null,overlap=false,found=false,edge=fsa_tmp1,worldPoint0=fsa_tmp2,worldPoint1=fsa_tmp3,normal=fsa_tmp4,span1=fsa_tmp5,span2=fsa_tmp6;if(c1 instanceof Box&&c2 instanceof Box){for(var j=0;j!==2;j++){var c=c1,angle=angle1;if(j===1){c=c2;angle=angle2}for(var i=0;i!==2;i++){if(i===0){vec2.set(normal,0,1)}else if(i===1){vec2.set(normal,1,0)}if(angle!==0){vec2.rotate(normal,normal,angle)}Narrowphase.projectConvexOntoAxis(c1,offset1,angle1,normal,span1);Narrowphase.projectConvexOntoAxis(c2,offset2,angle2,normal,span2);var a=span1,b=span2,swapped=false;if(span1[0]>span2[0]){b=span1;a=span2;swapped=true}var dist=b[0]-a[1];overlap=dist<=0;if(maxDist===null||dist>maxDist){vec2.copy(sepAxis,normal);maxDist=dist;found=overlap}}}}else{for(var j=0;j!==2;j++){var c=c1,angle=angle1;if(j===1){c=c2;angle=angle2}for(var i=0;i!==c.vertices.length;i++){vec2.rotate(worldPoint0,c.vertices[i],angle);vec2.rotate(worldPoint1,c.vertices[(i+1)%c.vertices.length],angle);sub(edge,worldPoint1,worldPoint0);vec2.rotate90cw(normal,edge);vec2.normalize(normal,normal);Narrowphase.projectConvexOntoAxis(c1,offset1,angle1,normal,span1);Narrowphase.projectConvexOntoAxis(c2,offset2,angle2,normal,span2);var a=span1,b=span2,swapped=false;if(span1[0]>span2[0]){b=span1;a=span2;swapped=true}var dist=b[0]-a[1];overlap=dist<=0;if(maxDist===null||dist>maxDist){vec2.copy(sepAxis,normal);maxDist=dist;found=overlap}}}}return found};var gce_tmp1=vec2.fromValues(0,0),gce_tmp2=vec2.fromValues(0,0),gce_tmp3=vec2.fromValues(0,0);
Narrowphase.getClosestEdge=function(c,angle,axis,flip){var localAxis=gce_tmp1,edge=gce_tmp2,normal=gce_tmp3;vec2.rotate(localAxis,axis,-angle);if(flip){vec2.scale(localAxis,localAxis,-1)}var closestEdge=-1,N=c.vertices.length,maxDot=-1;for(var i=0;i!==N;i++){sub(edge,c.vertices[(i+1)%N],c.vertices[i%N]);vec2.rotate90cw(normal,edge);vec2.normalize(normal,normal);var d=dot(normal,localAxis);if(closestEdge===-1||d>maxDot){closestEdge=i%N;maxDot=d}}return closestEdge};var circleHeightfield_candidate=vec2.create(),circleHeightfield_dist=vec2.create(),circleHeightfield_v0=vec2.create(),circleHeightfield_v1=vec2.create(),circleHeightfield_minCandidate=vec2.create(),circleHeightfield_worldNormal=vec2.create(),circleHeightfield_minCandidateNormal=vec2.create();Narrowphase.prototype[Shape.CIRCLE|Shape.HEIGHTFIELD]=Narrowphase.prototype.circleHeightfield=function(circleBody,circleShape,circlePos,circleAngle,hfBody,hfShape,hfPos,hfAngle,justTest,radius){var data=hfShape.heights,radius=radius||circleShape.radius,w=hfShape.elementWidth,dist=circleHeightfield_dist,candidate=circleHeightfield_candidate,minCandidate=circleHeightfield_minCandidate,minCandidateNormal=circleHeightfield_minCandidateNormal,worldNormal=circleHeightfield_worldNormal,v0=circleHeightfield_v0,v1=circleHeightfield_v1;var idxA=Math.floor((circlePos[0]-radius-hfPos[0])/w),idxB=Math.ceil((circlePos[0]+radius-hfPos[0])/w);if(idxA<0){idxA=0}if(idxB>=data.length){idxB=data.length-1}var max=data[idxA],min=data[idxB];for(var i=idxA;i<idxB;i++){if(data[i]<min){min=data[i]}if(data[i]>max){max=data[i]}}if(circlePos[1]-radius>max){return justTest?false:0}var found=false;for(var i=idxA;i<idxB;i++){vec2.set(v0,i*w,data[i]);vec2.set(v1,(i+1)*w,data[i+1]);vec2.add(v0,v0,hfPos);vec2.add(v1,v1,hfPos);vec2.sub(worldNormal,v1,v0);vec2.rotate(worldNormal,worldNormal,Math.PI/2);vec2.normalize(worldNormal,worldNormal);vec2.scale(candidate,worldNormal,-radius);vec2.add(candidate,candidate,circlePos);vec2.sub(dist,candidate,v0);var d=vec2.dot(dist,worldNormal);if(candidate[0]>=v0[0]&&candidate[0]<v1[0]&&d<=0){if(justTest){return true}found=true;vec2.scale(dist,worldNormal,-d);vec2.add(minCandidate,candidate,dist);vec2.copy(minCandidateNormal,worldNormal);var c=this.createContactEquation(hfBody,circleBody,hfShape,circleShape);vec2.copy(c.normalA,minCandidateNormal);vec2.scale(c.contactPointB,c.normalA,-radius);add(c.contactPointB,c.contactPointB,circlePos);sub(c.contactPointB,c.contactPointB,circleBody.position);vec2.copy(c.contactPointA,minCandidate);vec2.sub(c.contactPointA,c.contactPointA,hfBody.position);this.contactEquations.push(c);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(c))}}}found=false;if(radius>0){for(var i=idxA;i<=idxB;i++){vec2.set(v0,i*w,data[i]);vec2.add(v0,v0,hfPos);vec2.sub(dist,circlePos,v0);if(vec2.squaredLength(dist)<Math.pow(radius,2)){if(justTest){return true}found=true;var c=this.createContactEquation(hfBody,circleBody,hfShape,circleShape);vec2.copy(c.normalA,dist);vec2.normalize(c.normalA,c.normalA);vec2.scale(c.contactPointB,c.normalA,-radius);add(c.contactPointB,c.contactPointB,circlePos);sub(c.contactPointB,c.contactPointB,circleBody.position);sub(c.contactPointA,v0,hfPos);add(c.contactPointA,c.contactPointA,hfPos);sub(c.contactPointA,c.contactPointA,hfBody.position);this.contactEquations.push(c);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(c))}}}}if(found){return 1}return 0};var convexHeightfield_v0=vec2.create(),convexHeightfield_v1=vec2.create(),convexHeightfield_tilePos=vec2.create(),convexHeightfield_tempConvexShape=new Convex({vertices:[vec2.create(),vec2.create(),vec2.create(),vec2.create()]});Narrowphase.prototype[Shape.BOX|Shape.HEIGHTFIELD]=Narrowphase.prototype[Shape.CONVEX|Shape.HEIGHTFIELD]=Narrowphase.prototype.convexHeightfield=function(convexBody,convexShape,convexPos,convexAngle,hfBody,hfShape,hfPos,hfAngle,justTest){var data=hfShape.heights,w=hfShape.elementWidth,v0=convexHeightfield_v0,v1=convexHeightfield_v1,tilePos=convexHeightfield_tilePos,tileConvex=convexHeightfield_tempConvexShape;var idxA=Math.floor((convexBody.aabb.lowerBound[0]-hfPos[0])/w),idxB=Math.ceil((convexBody.aabb.upperBound[0]-hfPos[0])/w);if(idxA<0){idxA=0}if(idxB>=data.length){idxB=data.length-1}var max=data[idxA],min=data[idxB];for(var i=idxA;i<idxB;i++){if(data[i]<min){min=data[i]}if(data[i]>max){max=data[i]}}if(convexBody.aabb.lowerBound[1]>max){return justTest?false:0}var found=false;var numContacts=0;for(var i=idxA;i<idxB;i++){vec2.set(v0,i*w,data[i]);vec2.set(v1,(i+1)*w,data[i+1]);vec2.add(v0,v0,hfPos);vec2.add(v1,v1,hfPos);var tileHeight=100;vec2.set(tilePos,(v1[0]+v0[0])*.5,(v1[1]+v0[1]-tileHeight)*.5);vec2.sub(tileConvex.vertices[0],v1,tilePos);vec2.sub(tileConvex.vertices[1],v0,tilePos);vec2.copy(tileConvex.vertices[2],tileConvex.vertices[1]);vec2.copy(tileConvex.vertices[3],tileConvex.vertices[0]);tileConvex.vertices[2][1]-=tileHeight;tileConvex.vertices[3][1]-=tileHeight;numContacts+=this.convexConvex(convexBody,convexShape,convexPos,convexAngle,hfBody,tileConvex,tilePos,0,justTest)}return numContacts}},{"../equations/ContactEquation":21,"../equations/Equation":22,"../equations/FrictionEquation":23,"../math/vec2":30,"../objects/Body":31,"../shapes/Box":37,"../shapes/Circle":39,"../shapes/Convex":40,"../shapes/Shape":45,"../utils/ContactEquationPool":48,"../utils/FrictionEquationPool":49,"../utils/TupleDictionary":56,"../utils/Utils":57}],11:[function(_dereq_,module,exports){module.exports=Ray;var vec2=_dereq_("../math/vec2");var RaycastResult=_dereq_("../collision/RaycastResult");var Shape=_dereq_("../shapes/Shape");var AABB=_dereq_("../collision/AABB");function Ray(options){options=options||{};this.from=options.from?vec2.fromValues(options.from[0],options.from[1]):vec2.create();this.to=options.to?vec2.fromValues(options.to[0],options.to[1]):vec2.create();this.checkCollisionResponse=options.checkCollisionResponse!==undefined?options.checkCollisionResponse:true;this.skipBackfaces=!!options.skipBackfaces;this.collisionMask=options.collisionMask!==undefined?options.collisionMask:-1;this.collisionGroup=options.collisionGroup!==undefined?options.collisionGroup:-1;this.mode=options.mode!==undefined?options.mode:Ray.ANY;this.callback=options.callback||function(result){};this.direction=vec2.create();this.length=1;this.update()}Ray.prototype.constructor=Ray;Ray.CLOSEST=1;Ray.ANY=2;Ray.ALL=4;Ray.prototype.update=function(){var d=this.direction;vec2.sub(d,this.to,this.from);this.length=vec2.length(d);vec2.normalize(d,d)};Ray.prototype.intersectBodies=function(result,bodies){for(var i=0,l=bodies.length;!result.shouldStop(this)&&i<l;i++){var body=bodies[i];var aabb=body.getAABB();if(aabb.overlapsRay(this)>=0||aabb.containsPoint(this.from)){this.intersectBody(result,body)}}};var intersectBody_worldPosition=vec2.create();Ray.prototype.intersectBody=function(result,body){var checkCollisionResponse=this.checkCollisionResponse;if(checkCollisionResponse&&!body.collisionResponse){return}var worldPosition=intersectBody_worldPosition;for(var i=0,N=body.shapes.length;i<N;i++){var shape=body.shapes[i];if(checkCollisionResponse&&!shape.collisionResponse){continue}if((this.collisionGroup&shape.collisionMask)===0||(shape.collisionGroup&this.collisionMask)===0){continue}vec2.rotate(worldPosition,shape.position,body.angle);vec2.add(worldPosition,worldPosition,body.position);var worldAngle=shape.angle+body.angle;this.intersectShape(result,shape,worldAngle,worldPosition,body);if(result.shouldStop(this)){break}}};Ray.prototype.intersectShape=function(result,shape,angle,position,body){var from=this.from;var distance=distanceFromIntersectionSquared(from,this.direction,position);if(distance>shape.boundingRadius*shape.boundingRadius){return}this._currentBody=body;this._currentShape=shape;shape.raycast(result,this,position,angle);this._currentBody=this._currentShape=null};Ray.prototype.getAABB=function(result){var to=this.to;var from=this.from;vec2.set(result.lowerBound,Math.min(to[0],from[0]),Math.min(to[1],from[1]));vec2.set(result.upperBound,Math.max(to[0],from[0]),Math.max(to[1],from[1]))};var hitPointWorld=vec2.create();Ray.prototype.reportIntersection=function(result,fraction,normal,faceIndex){var from=this.from;var to=this.to;var shape=this._currentShape;var body=this._currentBody;if(this.skipBackfaces&&vec2.dot(normal,this.direction)>0){return}switch(this.mode){case Ray.ALL:result.set(normal,shape,body,fraction,faceIndex);this.callback(result);break;case Ray.CLOSEST:if(fraction<result.fraction||!result.hasHit()){result.set(normal,shape,body,fraction,faceIndex)}break;case Ray.ANY:result.set(normal,shape,body,fraction,faceIndex);break}};var v0=vec2.create(),intersect=vec2.create();function distanceFromIntersectionSquared(from,direction,position){vec2.sub(v0,position,from);var dot=vec2.dot(v0,direction);vec2.scale(intersect,direction,dot);vec2.add(intersect,intersect,from);return vec2.squaredDistance(position,intersect)}},{"../collision/AABB":7,"../collision/RaycastResult":12,"../math/vec2":30,"../shapes/Shape":45}],12:[function(_dereq_,module,exports){var vec2=_dereq_("../math/vec2");var Ray=_dereq_("../collision/Ray");module.exports=RaycastResult;function RaycastResult(){this.normal=vec2.create();this.shape=null;this.body=null;this.faceIndex=-1;this.fraction=-1;this.isStopped=false}RaycastResult.prototype.reset=function(){vec2.set(this.normal,0,0);this.shape=null;this.body=null;this.faceIndex=-1;this.fraction=-1;this.isStopped=false};RaycastResult.prototype.getHitDistance=function(ray){return vec2.distance(ray.from,ray.to)*this.fraction};RaycastResult.prototype.hasHit=function(){return this.fraction!==-1};RaycastResult.prototype.getHitPoint=function(out,ray){vec2.lerp(out,ray.from,ray.to,this.fraction)};RaycastResult.prototype.stop=function(){this.isStopped=true};RaycastResult.prototype.shouldStop=function(ray){return this.isStopped||this.fraction!==-1&&ray.mode===Ray.ANY};RaycastResult.prototype.set=function(normal,shape,body,fraction,faceIndex){vec2.copy(this.normal,normal);this.shape=shape;this.body=body;this.fraction=fraction;this.faceIndex=faceIndex}},{"../collision/Ray":11,"../math/vec2":30}],13:[function(_dereq_,module,exports){var Utils=_dereq_("../utils/Utils"),Broadphase=_dereq_("../collision/Broadphase");module.exports=SAPBroadphase;function SAPBroadphase(){Broadphase.call(this,Broadphase.SAP);this.axisList=[];this.axisIndex=0;var that=this;this._addBodyHandler=function(e){that.axisList.push(e.body)};this._removeBodyHandler=function(e){var idx=that.axisList.indexOf(e.body);if(idx!==-1){that.axisList.splice(idx,1)}}}SAPBroadphase.prototype=new Broadphase;SAPBroadphase.prototype.constructor=SAPBroadphase;SAPBroadphase.prototype.setWorld=function(world){this.axisList.length=0;Utils.appendArray(this.axisList,world.bodies);world.off("addBody",this._addBodyHandler).off("removeBody",this._removeBodyHandler);world.on("addBody",this._addBodyHandler).on("removeBody",this._removeBodyHandler);this.world=world};SAPBroadphase.sortAxisList=function(a,axisIndex){axisIndex=axisIndex|0;for(var i=1,l=a.length;i<l;i++){var v=a[i];for(var j=i-1;j>=0;j--){if(a[j].aabb.lowerBound[axisIndex]<=v.aabb.lowerBound[axisIndex]){break}a[j+1]=a[j]}a[j+1]=v}return a};SAPBroadphase.prototype.sortList=function(){var bodies=this.axisList,axisIndex=this.axisIndex;SAPBroadphase.sortAxisList(bodies,axisIndex)};SAPBroadphase.prototype.getCollisionPairs=function(world){var bodies=this.axisList,result=this.result,axisIndex=this.axisIndex;result.length=0;var l=bodies.length;while(l--){var b=bodies[l];if(b.aabbNeedsUpdate){b.updateAABB()}}this.sortList();for(var i=0,N=bodies.length|0;i!==N;i++){var bi=bodies[i];for(var j=i+1;j<N;j++){var bj=bodies[j];var overlaps=bj.aabb.lowerBound[axisIndex]<=bi.aabb.upperBound[axisIndex];if(!overlaps){break}if(Broadphase.canCollide(bi,bj)&&this.boundingVolumeCheck(bi,bj)){result.push(bi,bj)}}}return result};SAPBroadphase.prototype.aabbQuery=function(world,aabb,result){result=result||[];this.sortList();var axisIndex=this.axisIndex;var axis="x";if(axisIndex===1){axis="y"}if(axisIndex===2){axis="z"}var axisList=this.axisList;var lower=aabb.lowerBound[axis];var upper=aabb.upperBound[axis];for(var i=0;i<axisList.length;i++){var b=axisList[i];if(b.aabbNeedsUpdate){b.updateAABB()}if(b.aabb.overlaps(aabb)){result.push(b)}}return result}},{"../collision/Broadphase":8,"../utils/Utils":57}],14:[function(_dereq_,module,exports){module.exports=Constraint;var Utils=_dereq_("../utils/Utils");function Constraint(bodyA,bodyB,type,options){this.type=type;options=Utils.defaults(options,{collideConnected:true,wakeUpBodies:true});this.equations=[];this.bodyA=bodyA;this.bodyB=bodyB;this.collideConnected=options.collideConnected;if(options.wakeUpBodies){if(bodyA){bodyA.wakeUp()}if(bodyB){bodyB.wakeUp()}}}Constraint.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")};Constraint.DISTANCE=1;Constraint.GEAR=2;Constraint.LOCK=3;Constraint.PRISMATIC=4;Constraint.REVOLUTE=5;Constraint.prototype.setStiffness=function(stiffness){var eqs=this.equations;for(var i=0;i!==eqs.length;i++){var eq=eqs[i];eq.stiffness=stiffness;eq.needsUpdate=true}};Constraint.prototype.setRelaxation=function(relaxation){var eqs=this.equations;for(var i=0;i!==eqs.length;i++){var eq=eqs[i];eq.relaxation=relaxation;eq.needsUpdate=true}}},{"../utils/Utils":57}],15:[function(_dereq_,module,exports){var Constraint=_dereq_("./Constraint"),Equation=_dereq_("../equations/Equation"),vec2=_dereq_("../math/vec2"),Utils=_dereq_("../utils/Utils");module.exports=DistanceConstraint;function DistanceConstraint(bodyA,bodyB,options){options=Utils.defaults(options,{localAnchorA:[0,0],localAnchorB:[0,0]});Constraint.call(this,bodyA,bodyB,Constraint.DISTANCE,options);this.localAnchorA=vec2.fromValues(options.localAnchorA[0],options.localAnchorA[1]);this.localAnchorB=vec2.fromValues(options.localAnchorB[0],options.localAnchorB[1]);var localAnchorA=this.localAnchorA;var localAnchorB=this.localAnchorB;this.distance=0;if(typeof options.distance==="number"){this.distance=options.distance}else{var worldAnchorA=vec2.create(),worldAnchorB=vec2.create(),r=vec2.create();vec2.rotate(worldAnchorA,localAnchorA,bodyA.angle);vec2.rotate(worldAnchorB,localAnchorB,bodyB.angle);vec2.add(r,bodyB.position,worldAnchorB);vec2.sub(r,r,worldAnchorA);vec2.sub(r,r,bodyA.position);this.distance=vec2.length(r)}var maxForce;if(typeof options.maxForce==="undefined"){maxForce=Number.MAX_VALUE}else{maxForce=options.maxForce}var normal=new Equation(bodyA,bodyB,-maxForce,maxForce);this.equations=[normal];this.maxForce=maxForce;var r=vec2.create();var ri=vec2.create();var rj=vec2.create();var that=this;normal.computeGq=function(){var bodyA=this.bodyA,bodyB=this.bodyB,xi=bodyA.position,xj=bodyB.position;vec2.rotate(ri,localAnchorA,bodyA.angle);vec2.rotate(rj,localAnchorB,bodyB.angle);vec2.add(r,xj,rj);vec2.sub(r,r,ri);vec2.sub(r,r,xi);return vec2.length(r)-that.distance};this.setMaxForce(maxForce);this.upperLimitEnabled=false;this.upperLimit=1;this.lowerLimitEnabled=false;this.lowerLimit=0;this.position=0}DistanceConstraint.prototype=new Constraint;DistanceConstraint.prototype.constructor=DistanceConstraint;var n=vec2.create();var ri=vec2.create();var rj=vec2.create();DistanceConstraint.prototype.update=function(){var normal=this.equations[0],bodyA=this.bodyA,bodyB=this.bodyB,distance=this.distance,xi=bodyA.position,xj=bodyB.position,normalEquation=this.equations[0],G=normal.G;vec2.rotate(ri,this.localAnchorA,bodyA.angle);vec2.rotate(rj,this.localAnchorB,bodyB.angle);vec2.add(n,xj,rj);vec2.sub(n,n,ri);vec2.sub(n,n,xi);this.position=vec2.length(n);var violating=false;if(this.upperLimitEnabled){if(this.position>this.upperLimit){normalEquation.maxForce=0;normalEquation.minForce=-this.maxForce;this.distance=this.upperLimit;violating=true}}if(this.lowerLimitEnabled){if(this.position<this.lowerLimit){normalEquation.maxForce=this.maxForce;normalEquation.minForce=0;this.distance=this.lowerLimit;violating=true}}if((this.lowerLimitEnabled||this.upperLimitEnabled)&&!violating){normalEquation.enabled=false;return}normalEquation.enabled=true;vec2.normalize(n,n);var rixn=vec2.crossLength(ri,n),rjxn=vec2.crossLength(rj,n);G[0]=-n[0];G[1]=-n[1];G[2]=-rixn;G[3]=n[0];G[4]=n[1];G[5]=rjxn};DistanceConstraint.prototype.setMaxForce=function(maxForce){var normal=this.equations[0];normal.minForce=-maxForce;normal.maxForce=maxForce};DistanceConstraint.prototype.getMaxForce=function(){var normal=this.equations[0];return normal.maxForce}},{"../equations/Equation":22,"../math/vec2":30,"../utils/Utils":57,"./Constraint":14}],16:[function(_dereq_,module,exports){var Constraint=_dereq_("./Constraint"),Equation=_dereq_("../equations/Equation"),AngleLockEquation=_dereq_("../equations/AngleLockEquation"),vec2=_dereq_("../math/vec2");module.exports=GearConstraint;function GearConstraint(bodyA,bodyB,options){options=options||{};Constraint.call(this,bodyA,bodyB,Constraint.GEAR,options);this.ratio=options.ratio!==undefined?options.ratio:1;this.angle=options.angle!==undefined?options.angle:bodyB.angle-this.ratio*bodyA.angle;options.angle=this.angle;options.ratio=this.ratio;this.equations=[new AngleLockEquation(bodyA,bodyB,options)];if(options.maxTorque!==undefined){this.setMaxTorque(options.maxTorque)}}GearConstraint.prototype=new Constraint;GearConstraint.prototype.constructor=GearConstraint;GearConstraint.prototype.update=function(){var eq=this.equations[0];if(eq.ratio!==this.ratio){eq.setRatio(this.ratio)}eq.angle=this.angle};GearConstraint.prototype.setMaxTorque=function(torque){this.equations[0].setMaxTorque(torque)};GearConstraint.prototype.getMaxTorque=function(torque){return this.equations[0].maxForce}},{"../equations/AngleLockEquation":20,"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],17:[function(_dereq_,module,exports){var Constraint=_dereq_("./Constraint"),vec2=_dereq_("../math/vec2"),Equation=_dereq_("../equations/Equation");module.exports=LockConstraint;function LockConstraint(bodyA,bodyB,options){options=options||{};Constraint.call(this,bodyA,bodyB,Constraint.LOCK,options);var maxForce=typeof options.maxForce==="undefined"?Number.MAX_VALUE:options.maxForce;var localAngleB=options.localAngleB||0;var x=new Equation(bodyA,bodyB,-maxForce,maxForce),y=new Equation(bodyA,bodyB,-maxForce,maxForce),rot=new Equation(bodyA,bodyB,-maxForce,maxForce);var l=vec2.create(),g=vec2.create(),that=this;x.computeGq=function(){vec2.rotate(l,that.localOffsetB,bodyA.angle);vec2.sub(g,bodyB.position,bodyA.position);vec2.sub(g,g,l);return g[0]};y.computeGq=function(){vec2.rotate(l,that.localOffsetB,bodyA.angle);vec2.sub(g,bodyB.position,bodyA.position);vec2.sub(g,g,l);return g[1]};var r=vec2.create(),t=vec2.create();rot.computeGq=function(){vec2.rotate(r,that.localOffsetB,bodyB.angle-that.localAngleB);vec2.scale(r,r,-1);vec2.sub(g,bodyA.position,bodyB.position);vec2.add(g,g,r);vec2.rotate(t,r,-Math.PI/2);vec2.normalize(t,t);return vec2.dot(g,t)};this.localOffsetB=vec2.create();if(options.localOffsetB){vec2.copy(this.localOffsetB,options.localOffsetB)}else{vec2.sub(this.localOffsetB,bodyB.position,bodyA.position);vec2.rotate(this.localOffsetB,this.localOffsetB,-bodyA.angle)}this.localAngleB=0;if(typeof options.localAngleB==="number"){this.localAngleB=options.localAngleB}else{this.localAngleB=bodyB.angle-bodyA.angle}this.equations.push(x,y,rot);this.setMaxForce(maxForce)}LockConstraint.prototype=new Constraint;LockConstraint.prototype.constructor=LockConstraint;LockConstraint.prototype.setMaxForce=function(force){var eqs=this.equations;for(var i=0;i<this.equations.length;i++){eqs[i].maxForce=force;eqs[i].minForce=-force}};LockConstraint.prototype.getMaxForce=function(){return this.equations[0].maxForce};var l=vec2.create();var r=vec2.create();var t=vec2.create();var xAxis=vec2.fromValues(1,0);var yAxis=vec2.fromValues(0,1);LockConstraint.prototype.update=function(){var x=this.equations[0],y=this.equations[1],rot=this.equations[2],bodyA=this.bodyA,bodyB=this.bodyB;vec2.rotate(l,this.localOffsetB,bodyA.angle);vec2.rotate(r,this.localOffsetB,bodyB.angle-this.localAngleB);vec2.scale(r,r,-1);vec2.rotate(t,r,Math.PI/2);vec2.normalize(t,t);x.G[0]=-1;x.G[1]=0;x.G[2]=-vec2.crossLength(l,xAxis);x.G[3]=1;y.G[0]=0;y.G[1]=-1;y.G[2]=-vec2.crossLength(l,yAxis);y.G[4]=1;rot.G[0]=-t[0];rot.G[1]=-t[1];rot.G[3]=t[0];rot.G[4]=t[1];rot.G[5]=vec2.crossLength(r,t)}},{"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],18:[function(_dereq_,module,exports){var Constraint=_dereq_("./Constraint"),ContactEquation=_dereq_("../equations/ContactEquation"),Equation=_dereq_("../equations/Equation"),vec2=_dereq_("../math/vec2"),RotationalLockEquation=_dereq_("../equations/RotationalLockEquation");module.exports=PrismaticConstraint;function PrismaticConstraint(bodyA,bodyB,options){options=options||{};Constraint.call(this,bodyA,bodyB,Constraint.PRISMATIC,options);var localAnchorA=vec2.fromValues(0,0),localAxisA=vec2.fromValues(1,0),localAnchorB=vec2.fromValues(0,0);if(options.localAnchorA){vec2.copy(localAnchorA,options.localAnchorA)}if(options.localAxisA){vec2.copy(localAxisA,options.localAxisA)}if(options.localAnchorB){vec2.copy(localAnchorB,options.localAnchorB)}this.localAnchorA=localAnchorA;this.localAnchorB=localAnchorB;this.localAxisA=localAxisA;var maxForce=this.maxForce=typeof options.maxForce!=="undefined"?options.maxForce:Number.MAX_VALUE;var trans=new Equation(bodyA,bodyB,-maxForce,maxForce);var ri=new vec2.create,rj=new vec2.create,gg=new vec2.create,t=new vec2.create;trans.computeGq=function(){return vec2.dot(gg,t)};trans.updateJacobian=function(){var G=this.G,xi=bodyA.position,xj=bodyB.position;vec2.rotate(ri,localAnchorA,bodyA.angle);vec2.rotate(rj,localAnchorB,bodyB.angle);vec2.add(gg,xj,rj);vec2.sub(gg,gg,xi);vec2.sub(gg,gg,ri);vec2.rotate(t,localAxisA,bodyA.angle+Math.PI/2);G[0]=-t[0];G[1]=-t[1];G[2]=-vec2.crossLength(ri,t)+vec2.crossLength(t,gg);G[3]=t[0];G[4]=t[1];G[5]=vec2.crossLength(rj,t)};this.equations.push(trans);if(!options.disableRotationalLock){var rot=new RotationalLockEquation(bodyA,bodyB,-maxForce,maxForce);this.equations.push(rot)}this.position=0;this.velocity=0;this.lowerLimitEnabled=typeof options.lowerLimit!=="undefined"?true:false;this.upperLimitEnabled=typeof options.upperLimit!=="undefined"?true:false;this.lowerLimit=typeof options.lowerLimit!=="undefined"?options.lowerLimit:0;this.upperLimit=typeof options.upperLimit!=="undefined"?options.upperLimit:1;this.upperLimitEquation=new ContactEquation(bodyA,bodyB);this.lowerLimitEquation=new ContactEquation(bodyA,bodyB);this.upperLimitEquation.minForce=this.lowerLimitEquation.minForce=0;this.upperLimitEquation.maxForce=this.lowerLimitEquation.maxForce=maxForce;this.motorEquation=new Equation(bodyA,bodyB);this.motorEnabled=false;this.motorSpeed=0;var that=this;var motorEquation=this.motorEquation;var old=motorEquation.computeGW;motorEquation.computeGq=function(){return 0};motorEquation.computeGW=function(){var G=this.G,bi=this.bodyA,bj=this.bodyB,vi=bi.velocity,vj=bj.velocity,wi=bi.angularVelocity,wj=bj.angularVelocity;return this.gmult(G,vi,wi,vj,wj)+that.motorSpeed}}PrismaticConstraint.prototype=new Constraint;PrismaticConstraint.prototype.constructor=PrismaticConstraint;var worldAxisA=vec2.create(),worldAnchorA=vec2.create(),worldAnchorB=vec2.create(),orientedAnchorA=vec2.create(),orientedAnchorB=vec2.create(),tmp=vec2.create();PrismaticConstraint.prototype.update=function(){var eqs=this.equations,trans=eqs[0],upperLimit=this.upperLimit,lowerLimit=this.lowerLimit,upperLimitEquation=this.upperLimitEquation,lowerLimitEquation=this.lowerLimitEquation,bodyA=this.bodyA,bodyB=this.bodyB,localAxisA=this.localAxisA,localAnchorA=this.localAnchorA,localAnchorB=this.localAnchorB;trans.updateJacobian();vec2.rotate(worldAxisA,localAxisA,bodyA.angle);vec2.rotate(orientedAnchorA,localAnchorA,bodyA.angle);vec2.add(worldAnchorA,orientedAnchorA,bodyA.position);vec2.rotate(orientedAnchorB,localAnchorB,bodyB.angle);vec2.add(worldAnchorB,orientedAnchorB,bodyB.position);var relPosition=this.position=vec2.dot(worldAnchorB,worldAxisA)-vec2.dot(worldAnchorA,worldAxisA);if(this.motorEnabled){var G=this.motorEquation.G;G[0]=worldAxisA[0];G[1]=worldAxisA[1];G[2]=vec2.crossLength(worldAxisA,orientedAnchorB);G[3]=-worldAxisA[0];G[4]=-worldAxisA[1];G[5]=-vec2.crossLength(worldAxisA,orientedAnchorA)}if(this.upperLimitEnabled&&relPosition>upperLimit){vec2.scale(upperLimitEquation.normalA,worldAxisA,-1);vec2.sub(upperLimitEquation.contactPointA,worldAnchorA,bodyA.position);vec2.sub(upperLimitEquation.contactPointB,worldAnchorB,bodyB.position);vec2.scale(tmp,worldAxisA,upperLimit);vec2.add(upperLimitEquation.contactPointA,upperLimitEquation.contactPointA,tmp);if(eqs.indexOf(upperLimitEquation)===-1){eqs.push(upperLimitEquation)}}else{var idx=eqs.indexOf(upperLimitEquation);if(idx!==-1){eqs.splice(idx,1)}}if(this.lowerLimitEnabled&&relPosition<lowerLimit){vec2.scale(lowerLimitEquation.normalA,worldAxisA,1);vec2.sub(lowerLimitEquation.contactPointA,worldAnchorA,bodyA.position);vec2.sub(lowerLimitEquation.contactPointB,worldAnchorB,bodyB.position);vec2.scale(tmp,worldAxisA,lowerLimit);vec2.sub(lowerLimitEquation.contactPointB,lowerLimitEquation.contactPointB,tmp);if(eqs.indexOf(lowerLimitEquation)===-1){eqs.push(lowerLimitEquation)}}else{var idx=eqs.indexOf(lowerLimitEquation);if(idx!==-1){eqs.splice(idx,1)}}};PrismaticConstraint.prototype.enableMotor=function(){if(this.motorEnabled){return}this.equations.push(this.motorEquation);this.motorEnabled=true};PrismaticConstraint.prototype.disableMotor=function(){if(!this.motorEnabled){return}var i=this.equations.indexOf(this.motorEquation);this.equations.splice(i,1);this.motorEnabled=false};PrismaticConstraint.prototype.setLimits=function(lower,upper){if(typeof lower==="number"){this.lowerLimit=lower;this.lowerLimitEnabled=true}else{this.lowerLimit=lower;this.lowerLimitEnabled=false}if(typeof upper==="number"){this.upperLimit=upper;this.upperLimitEnabled=true}else{this.upperLimit=upper;this.upperLimitEnabled=false}}},{"../equations/ContactEquation":21,"../equations/Equation":22,"../equations/RotationalLockEquation":24,"../math/vec2":30,"./Constraint":14}],19:[function(_dereq_,module,exports){var Constraint=_dereq_("./Constraint"),Equation=_dereq_("../equations/Equation"),RotationalVelocityEquation=_dereq_("../equations/RotationalVelocityEquation"),RotationalLockEquation=_dereq_("../equations/RotationalLockEquation"),vec2=_dereq_("../math/vec2");module.exports=RevoluteConstraint;var worldPivotA=vec2.create(),worldPivotB=vec2.create(),xAxis=vec2.fromValues(1,0),yAxis=vec2.fromValues(0,1),g=vec2.create();function RevoluteConstraint(bodyA,bodyB,options){options=options||{};Constraint.call(this,bodyA,bodyB,Constraint.REVOLUTE,options);var maxForce=this.maxForce=typeof options.maxForce!=="undefined"?options.maxForce:Number.MAX_VALUE;this.pivotA=vec2.create();this.pivotB=vec2.create();if(options.worldPivot){vec2.sub(this.pivotA,options.worldPivot,bodyA.position);vec2.sub(this.pivotB,options.worldPivot,bodyB.position);vec2.rotate(this.pivotA,this.pivotA,-bodyA.angle);vec2.rotate(this.pivotB,this.pivotB,-bodyB.angle)}else{vec2.copy(this.pivotA,options.localPivotA);vec2.copy(this.pivotB,options.localPivotB)}var eqs=this.equations=[new Equation(bodyA,bodyB,-maxForce,maxForce),new Equation(bodyA,bodyB,-maxForce,maxForce)];var x=eqs[0];var y=eqs[1];var that=this;x.computeGq=function(){vec2.rotate(worldPivotA,that.pivotA,bodyA.angle);vec2.rotate(worldPivotB,that.pivotB,bodyB.angle);vec2.add(g,bodyB.position,worldPivotB);vec2.sub(g,g,bodyA.position);vec2.sub(g,g,worldPivotA);return vec2.dot(g,xAxis)};y.computeGq=function(){vec2.rotate(worldPivotA,that.pivotA,bodyA.angle);vec2.rotate(worldPivotB,that.pivotB,bodyB.angle);vec2.add(g,bodyB.position,worldPivotB);vec2.sub(g,g,bodyA.position);vec2.sub(g,g,worldPivotA);return vec2.dot(g,yAxis)};y.minForce=x.minForce=-maxForce;y.maxForce=x.maxForce=maxForce;this.motorEquation=new RotationalVelocityEquation(bodyA,bodyB);this.motorEnabled=false;this.angle=0;this.lowerLimitEnabled=false;this.upperLimitEnabled=false;this.lowerLimit=0;this.upperLimit=0;this.upperLimitEquation=new RotationalLockEquation(bodyA,bodyB);this.lowerLimitEquation=new RotationalLockEquation(bodyA,bodyB);this.upperLimitEquation.minForce=0;this.lowerLimitEquation.maxForce=0}RevoluteConstraint.prototype=new Constraint;RevoluteConstraint.prototype.constructor=RevoluteConstraint;RevoluteConstraint.prototype.setLimits=function(lower,upper){if(typeof lower==="number"){this.lowerLimit=lower;this.lowerLimitEnabled=true}else{this.lowerLimit=lower;this.lowerLimitEnabled=false}if(typeof upper==="number"){this.upperLimit=upper;this.upperLimitEnabled=true}else{this.upperLimit=upper;this.upperLimitEnabled=false}};RevoluteConstraint.prototype.update=function(){var bodyA=this.bodyA,bodyB=this.bodyB,pivotA=this.pivotA,pivotB=this.pivotB,eqs=this.equations,normal=eqs[0],tangent=eqs[1],x=eqs[0],y=eqs[1],upperLimit=this.upperLimit,lowerLimit=this.lowerLimit,upperLimitEquation=this.upperLimitEquation,lowerLimitEquation=this.lowerLimitEquation;var relAngle=this.angle=bodyB.angle-bodyA.angle;if(this.upperLimitEnabled&&relAngle>upperLimit){upperLimitEquation.angle=upperLimit;if(eqs.indexOf(upperLimitEquation)===-1){eqs.push(upperLimitEquation)}}else{var idx=eqs.indexOf(upperLimitEquation);if(idx!==-1){eqs.splice(idx,1)}}if(this.lowerLimitEnabled&&relAngle<lowerLimit){lowerLimitEquation.angle=lowerLimit;if(eqs.indexOf(lowerLimitEquation)===-1){eqs.push(lowerLimitEquation)}}else{var idx=eqs.indexOf(lowerLimitEquation);if(idx!==-1){eqs.splice(idx,1)}}vec2.rotate(worldPivotA,pivotA,bodyA.angle);vec2.rotate(worldPivotB,pivotB,bodyB.angle);x.G[0]=-1;x.G[1]=0;x.G[2]=-vec2.crossLength(worldPivotA,xAxis);x.G[3]=1;x.G[4]=0;x.G[5]=vec2.crossLength(worldPivotB,xAxis);y.G[0]=0;y.G[1]=-1;y.G[2]=-vec2.crossLength(worldPivotA,yAxis);y.G[3]=0;y.G[4]=1;y.G[5]=vec2.crossLength(worldPivotB,yAxis)};RevoluteConstraint.prototype.enableMotor=function(){if(this.motorEnabled){return}this.equations.push(this.motorEquation);this.motorEnabled=true};RevoluteConstraint.prototype.disableMotor=function(){if(!this.motorEnabled){return}var i=this.equations.indexOf(this.motorEquation);this.equations.splice(i,1);this.motorEnabled=false};RevoluteConstraint.prototype.motorIsEnabled=function(){return!!this.motorEnabled};RevoluteConstraint.prototype.setMotorSpeed=function(speed){if(!this.motorEnabled){return}var i=this.equations.indexOf(this.motorEquation);this.equations[i].relativeVelocity=speed};RevoluteConstraint.prototype.getMotorSpeed=function(){if(!this.motorEnabled){return false}return this.motorEquation.relativeVelocity}},{"../equations/Equation":22,"../equations/RotationalLockEquation":24,"../equations/RotationalVelocityEquation":25,"../math/vec2":30,"./Constraint":14}],20:[function(_dereq_,module,exports){var Equation=_dereq_("./Equation"),vec2=_dereq_("../math/vec2");module.exports=AngleLockEquation;function AngleLockEquation(bodyA,bodyB,options){options=options||{};Equation.call(this,bodyA,bodyB,-Number.MAX_VALUE,Number.MAX_VALUE);this.angle=options.angle||0;this.ratio=typeof options.ratio==="number"?options.ratio:1;this.setRatio(this.ratio)}AngleLockEquation.prototype=new Equation;AngleLockEquation.prototype.constructor=AngleLockEquation;AngleLockEquation.prototype.computeGq=function(){return this.ratio*this.bodyA.angle-this.bodyB.angle+this.angle};AngleLockEquation.prototype.setRatio=function(ratio){var G=this.G;G[2]=ratio;G[5]=-1;this.ratio=ratio};AngleLockEquation.prototype.setMaxTorque=function(torque){this.maxForce=torque;this.minForce=-torque}},{"../math/vec2":30,"./Equation":22}],21:[function(_dereq_,module,exports){var Equation=_dereq_("./Equation"),vec2=_dereq_("../math/vec2");module.exports=ContactEquation;function ContactEquation(bodyA,bodyB){Equation.call(this,bodyA,bodyB,0,Number.MAX_VALUE);this.contactPointA=vec2.create();this.penetrationVec=vec2.create();
this.contactPointB=vec2.create();this.normalA=vec2.create();this.restitution=0;this.firstImpact=false;this.shapeA=null;this.shapeB=null}ContactEquation.prototype=new Equation;ContactEquation.prototype.constructor=ContactEquation;ContactEquation.prototype.computeB=function(a,b,h){var bi=this.bodyA,bj=this.bodyB,ri=this.contactPointA,rj=this.contactPointB,xi=bi.position,xj=bj.position;var penetrationVec=this.penetrationVec,n=this.normalA,G=this.G;var rixn=vec2.crossLength(ri,n),rjxn=vec2.crossLength(rj,n);G[0]=-n[0];G[1]=-n[1];G[2]=-rixn;G[3]=n[0];G[4]=n[1];G[5]=rjxn;vec2.add(penetrationVec,xj,rj);vec2.sub(penetrationVec,penetrationVec,xi);vec2.sub(penetrationVec,penetrationVec,ri);var GW,Gq;if(this.firstImpact&&this.restitution!==0){Gq=0;GW=1/b*(1+this.restitution)*this.computeGW()}else{Gq=vec2.dot(n,penetrationVec)+this.offset;GW=this.computeGW()}var GiMf=this.computeGiMf();var B=-Gq*a-GW*b-h*GiMf;return B};var vi=vec2.create();var vj=vec2.create();var relVel=vec2.create();ContactEquation.prototype.getVelocityAlongNormal=function(){this.bodyA.getVelocityAtPoint(vi,this.contactPointA);this.bodyB.getVelocityAtPoint(vj,this.contactPointB);vec2.subtract(relVel,vi,vj);return vec2.dot(this.normalA,relVel)}},{"../math/vec2":30,"./Equation":22}],22:[function(_dereq_,module,exports){module.exports=Equation;var vec2=_dereq_("../math/vec2"),Utils=_dereq_("../utils/Utils"),Body=_dereq_("../objects/Body");function Equation(bodyA,bodyB,minForce,maxForce){this.minForce=typeof minForce==="undefined"?-Number.MAX_VALUE:minForce;this.maxForce=typeof maxForce==="undefined"?Number.MAX_VALUE:maxForce;this.bodyA=bodyA;this.bodyB=bodyB;this.stiffness=Equation.DEFAULT_STIFFNESS;this.relaxation=Equation.DEFAULT_RELAXATION;this.G=new Utils.ARRAY_TYPE(6);for(var i=0;i<6;i++){this.G[i]=0}this.offset=0;this.a=0;this.b=0;this.epsilon=0;this.timeStep=1/60;this.needsUpdate=true;this.multiplier=0;this.relativeVelocity=0;this.enabled=true}Equation.prototype.constructor=Equation;Equation.DEFAULT_STIFFNESS=1e6;Equation.DEFAULT_RELAXATION=4;Equation.prototype.update=function(){var k=this.stiffness,d=this.relaxation,h=this.timeStep;this.a=4/(h*(1+4*d));this.b=4*d/(1+4*d);this.epsilon=4/(h*h*k*(1+4*d));this.needsUpdate=false};Equation.prototype.gmult=function(G,vi,wi,vj,wj){return G[0]*vi[0]+G[1]*vi[1]+G[2]*wi+G[3]*vj[0]+G[4]*vj[1]+G[5]*wj};Equation.prototype.computeB=function(a,b,h){var GW=this.computeGW();var Gq=this.computeGq();var GiMf=this.computeGiMf();return-Gq*a-GW*b-GiMf*h};var qi=vec2.create(),qj=vec2.create();Equation.prototype.computeGq=function(){var G=this.G,bi=this.bodyA,bj=this.bodyB,xi=bi.position,xj=bj.position,ai=bi.angle,aj=bj.angle;return this.gmult(G,qi,ai,qj,aj)+this.offset};Equation.prototype.computeGW=function(){var G=this.G,bi=this.bodyA,bj=this.bodyB,vi=bi.velocity,vj=bj.velocity,wi=bi.angularVelocity,wj=bj.angularVelocity;return this.gmult(G,vi,wi,vj,wj)+this.relativeVelocity};Equation.prototype.computeGWlambda=function(){var G=this.G,bi=this.bodyA,bj=this.bodyB,vi=bi.vlambda,vj=bj.vlambda,wi=bi.wlambda,wj=bj.wlambda;return this.gmult(G,vi,wi,vj,wj)};var iMfi=vec2.create(),iMfj=vec2.create();Equation.prototype.computeGiMf=function(){var bi=this.bodyA,bj=this.bodyB,fi=bi.force,ti=bi.angularForce,fj=bj.force,tj=bj.angularForce,invMassi=bi.invMassSolve,invMassj=bj.invMassSolve,invIi=bi.invInertiaSolve,invIj=bj.invInertiaSolve,G=this.G;vec2.scale(iMfi,fi,invMassi);vec2.multiply(iMfi,bi.massMultiplier,iMfi);vec2.scale(iMfj,fj,invMassj);vec2.multiply(iMfj,bj.massMultiplier,iMfj);return this.gmult(G,iMfi,ti*invIi,iMfj,tj*invIj)};Equation.prototype.computeGiMGt=function(){var bi=this.bodyA,bj=this.bodyB,invMassi=bi.invMassSolve,invMassj=bj.invMassSolve,invIi=bi.invInertiaSolve,invIj=bj.invInertiaSolve,G=this.G;return G[0]*G[0]*invMassi*bi.massMultiplier[0]+G[1]*G[1]*invMassi*bi.massMultiplier[1]+G[2]*G[2]*invIi+G[3]*G[3]*invMassj*bj.massMultiplier[0]+G[4]*G[4]*invMassj*bj.massMultiplier[1]+G[5]*G[5]*invIj};var addToWlambda_temp=vec2.create(),addToWlambda_Gi=vec2.create(),addToWlambda_Gj=vec2.create(),addToWlambda_ri=vec2.create(),addToWlambda_rj=vec2.create(),addToWlambda_Mdiag=vec2.create();Equation.prototype.addToWlambda=function(deltalambda){var bi=this.bodyA,bj=this.bodyB,temp=addToWlambda_temp,Gi=addToWlambda_Gi,Gj=addToWlambda_Gj,ri=addToWlambda_ri,rj=addToWlambda_rj,invMassi=bi.invMassSolve,invMassj=bj.invMassSolve,invIi=bi.invInertiaSolve,invIj=bj.invInertiaSolve,Mdiag=addToWlambda_Mdiag,G=this.G;Gi[0]=G[0];Gi[1]=G[1];Gj[0]=G[3];Gj[1]=G[4];vec2.scale(temp,Gi,invMassi*deltalambda);vec2.multiply(temp,temp,bi.massMultiplier);vec2.add(bi.vlambda,bi.vlambda,temp);bi.wlambda+=invIi*G[2]*deltalambda;vec2.scale(temp,Gj,invMassj*deltalambda);vec2.multiply(temp,temp,bj.massMultiplier);vec2.add(bj.vlambda,bj.vlambda,temp);bj.wlambda+=invIj*G[5]*deltalambda};Equation.prototype.computeInvC=function(eps){return 1/(this.computeGiMGt()+eps)}},{"../math/vec2":30,"../objects/Body":31,"../utils/Utils":57}],23:[function(_dereq_,module,exports){var vec2=_dereq_("../math/vec2"),Equation=_dereq_("./Equation"),Utils=_dereq_("../utils/Utils");module.exports=FrictionEquation;function FrictionEquation(bodyA,bodyB,slipForce){Equation.call(this,bodyA,bodyB,-slipForce,slipForce);this.contactPointA=vec2.create();this.contactPointB=vec2.create();this.t=vec2.create();this.contactEquations=[];this.shapeA=null;this.shapeB=null;this.frictionCoefficient=.3}FrictionEquation.prototype=new Equation;FrictionEquation.prototype.constructor=FrictionEquation;FrictionEquation.prototype.setSlipForce=function(slipForce){this.maxForce=slipForce;this.minForce=-slipForce};FrictionEquation.prototype.getSlipForce=function(){return this.maxForce};FrictionEquation.prototype.computeB=function(a,b,h){var bi=this.bodyA,bj=this.bodyB,ri=this.contactPointA,rj=this.contactPointB,t=this.t,G=this.G;G[0]=-t[0];G[1]=-t[1];G[2]=-vec2.crossLength(ri,t);G[3]=t[0];G[4]=t[1];G[5]=vec2.crossLength(rj,t);var GW=this.computeGW(),GiMf=this.computeGiMf();var B=-GW*b-h*GiMf;return B}},{"../math/vec2":30,"../utils/Utils":57,"./Equation":22}],24:[function(_dereq_,module,exports){var Equation=_dereq_("./Equation"),vec2=_dereq_("../math/vec2");module.exports=RotationalLockEquation;function RotationalLockEquation(bodyA,bodyB,options){options=options||{};Equation.call(this,bodyA,bodyB,-Number.MAX_VALUE,Number.MAX_VALUE);this.angle=options.angle||0;var G=this.G;G[2]=1;G[5]=-1}RotationalLockEquation.prototype=new Equation;RotationalLockEquation.prototype.constructor=RotationalLockEquation;var worldVectorA=vec2.create(),worldVectorB=vec2.create(),xAxis=vec2.fromValues(1,0),yAxis=vec2.fromValues(0,1);RotationalLockEquation.prototype.computeGq=function(){vec2.rotate(worldVectorA,xAxis,this.bodyA.angle+this.angle);vec2.rotate(worldVectorB,yAxis,this.bodyB.angle);return vec2.dot(worldVectorA,worldVectorB)}},{"../math/vec2":30,"./Equation":22}],25:[function(_dereq_,module,exports){var Equation=_dereq_("./Equation"),vec2=_dereq_("../math/vec2");module.exports=RotationalVelocityEquation;function RotationalVelocityEquation(bodyA,bodyB){Equation.call(this,bodyA,bodyB,-Number.MAX_VALUE,Number.MAX_VALUE);this.relativeVelocity=1;this.ratio=1}RotationalVelocityEquation.prototype=new Equation;RotationalVelocityEquation.prototype.constructor=RotationalVelocityEquation;RotationalVelocityEquation.prototype.computeB=function(a,b,h){var G=this.G;G[2]=-1;G[5]=this.ratio;var GiMf=this.computeGiMf();var GW=this.computeGW();var B=-GW*b-h*GiMf;return B}},{"../math/vec2":30,"./Equation":22}],26:[function(_dereq_,module,exports){var EventEmitter=function(){};module.exports=EventEmitter;EventEmitter.prototype={constructor:EventEmitter,on:function(type,listener,context){listener.context=context||this;if(this._listeners===undefined){this._listeners={}}var listeners=this._listeners;if(listeners[type]===undefined){listeners[type]=[]}if(listeners[type].indexOf(listener)===-1){listeners[type].push(listener)}return this},has:function(type,listener){if(this._listeners===undefined){return false}var listeners=this._listeners;if(listener){if(listeners[type]!==undefined&&listeners[type].indexOf(listener)!==-1){return true}}else{if(listeners[type]!==undefined){return true}}return false},off:function(type,listener){if(this._listeners===undefined){return this}var listeners=this._listeners;var index=listeners[type].indexOf(listener);if(index!==-1){listeners[type].splice(index,1)}return this},emit:function(event){if(this._listeners===undefined){return this}var listeners=this._listeners;var listenerArray=listeners[event.type];if(listenerArray!==undefined){event.target=this;for(var i=0,l=listenerArray.length;i<l;i++){var listener=listenerArray[i];listener.call(listener.context,event)}}return this}}},{}],27:[function(_dereq_,module,exports){var Material=_dereq_("./Material");var Equation=_dereq_("../equations/Equation");module.exports=ContactMaterial;function ContactMaterial(materialA,materialB,options){options=options||{};if(!(materialA instanceof Material)||!(materialB instanceof Material)){throw new Error("First two arguments must be Material instances.")}this.id=ContactMaterial.idCounter++;this.materialA=materialA;this.materialB=materialB;this.friction=typeof options.friction!=="undefined"?Number(options.friction):.3;this.restitution=typeof options.restitution!=="undefined"?Number(options.restitution):0;this.stiffness=typeof options.stiffness!=="undefined"?Number(options.stiffness):Equation.DEFAULT_STIFFNESS;this.relaxation=typeof options.relaxation!=="undefined"?Number(options.relaxation):Equation.DEFAULT_RELAXATION;this.frictionStiffness=typeof options.frictionStiffness!=="undefined"?Number(options.frictionStiffness):Equation.DEFAULT_STIFFNESS;this.frictionRelaxation=typeof options.frictionRelaxation!=="undefined"?Number(options.frictionRelaxation):Equation.DEFAULT_RELAXATION;this.surfaceVelocity=typeof options.surfaceVelocity!=="undefined"?Number(options.surfaceVelocity):0;this.contactSkinSize=.005}ContactMaterial.idCounter=0},{"../equations/Equation":22,"./Material":28}],28:[function(_dereq_,module,exports){module.exports=Material;function Material(id){this.id=id||Material.idCounter++}Material.idCounter=0},{}],29:[function(_dereq_,module,exports){var PolyK={};PolyK.GetArea=function(p){if(p.length<6)return 0;var l=p.length-2;var sum=0;for(var i=0;i<l;i+=2)sum+=(p[i+2]-p[i])*(p[i+1]+p[i+3]);sum+=(p[0]-p[l])*(p[l+1]+p[1]);return-sum*.5};PolyK.Triangulate=function(p){var n=p.length>>1;if(n<3)return[];var tgs=[];var avl=[];for(var i=0;i<n;i++)avl.push(i);var i=0;var al=n;while(al>3){var i0=avl[(i+0)%al];var i1=avl[(i+1)%al];var i2=avl[(i+2)%al];var ax=p[2*i0],ay=p[2*i0+1];var bx=p[2*i1],by=p[2*i1+1];var cx=p[2*i2],cy=p[2*i2+1];var earFound=false;if(PolyK._convex(ax,ay,bx,by,cx,cy)){earFound=true;for(var j=0;j<al;j++){var vi=avl[j];if(vi==i0||vi==i1||vi==i2)continue;if(PolyK._PointInTriangle(p[2*vi],p[2*vi+1],ax,ay,bx,by,cx,cy)){earFound=false;break}}}if(earFound){tgs.push(i0,i1,i2);avl.splice((i+1)%al,1);al--;i=0}else if(i++>3*al)break}tgs.push(avl[0],avl[1],avl[2]);return tgs};PolyK._PointInTriangle=function(px,py,ax,ay,bx,by,cx,cy){var v0x=cx-ax;var v0y=cy-ay;var v1x=bx-ax;var v1y=by-ay;var v2x=px-ax;var v2y=py-ay;var dot00=v0x*v0x+v0y*v0y;var dot01=v0x*v1x+v0y*v1y;var dot02=v0x*v2x+v0y*v2y;var dot11=v1x*v1x+v1y*v1y;var dot12=v1x*v2x+v1y*v2y;var invDenom=1/(dot00*dot11-dot01*dot01);var u=(dot11*dot02-dot01*dot12)*invDenom;var v=(dot00*dot12-dot01*dot02)*invDenom;return u>=0&&v>=0&&u+v<1};PolyK._convex=function(ax,ay,bx,by,cx,cy){return(ay-by)*(cx-bx)+(bx-ax)*(cy-by)>=0};module.exports=PolyK},{}],30:[function(_dereq_,module,exports){var vec2=module.exports={};var Utils=_dereq_("../utils/Utils");vec2.crossLength=function(a,b){return a[0]*b[1]-a[1]*b[0]};vec2.crossVZ=function(out,vec,zcomp){vec2.rotate(out,vec,-Math.PI/2);vec2.scale(out,out,zcomp);return out};vec2.crossZV=function(out,zcomp,vec){vec2.rotate(out,vec,Math.PI/2);vec2.scale(out,out,zcomp);return out};vec2.rotate=function(out,a,angle){if(angle!==0){var c=Math.cos(angle),s=Math.sin(angle),x=a[0],y=a[1];out[0]=c*x-s*y;out[1]=s*x+c*y}else{out[0]=a[0];out[1]=a[1]}};vec2.rotate90cw=function(out,a){var x=a[0];var y=a[1];out[0]=y;out[1]=-x};vec2.toLocalFrame=function(out,worldPoint,framePosition,frameAngle){vec2.copy(out,worldPoint);vec2.sub(out,out,framePosition);vec2.rotate(out,out,-frameAngle)};vec2.toGlobalFrame=function(out,localPoint,framePosition,frameAngle){vec2.copy(out,localPoint);vec2.rotate(out,out,frameAngle);vec2.add(out,out,framePosition)};vec2.vectorToLocalFrame=function(out,worldVector,frameAngle){vec2.rotate(out,worldVector,-frameAngle)};vec2.vectorToGlobalFrame=function(out,localVector,frameAngle){vec2.rotate(out,localVector,frameAngle)};vec2.centroid=function(out,a,b,c){vec2.add(out,a,b);vec2.add(out,out,c);vec2.scale(out,out,1/3);return out};vec2.create=function(){var out=new Utils.ARRAY_TYPE(2);out[0]=0;out[1]=0;return out};vec2.clone=function(a){var out=new Utils.ARRAY_TYPE(2);out[0]=a[0];out[1]=a[1];return out};vec2.fromValues=function(x,y){var out=new Utils.ARRAY_TYPE(2);out[0]=x;out[1]=y;return out};vec2.copy=function(out,a){out[0]=a[0];out[1]=a[1];return out};vec2.set=function(out,x,y){out[0]=x;out[1]=y;return out};vec2.add=function(out,a,b){out[0]=a[0]+b[0];out[1]=a[1]+b[1];return out};vec2.subtract=function(out,a,b){out[0]=a[0]-b[0];out[1]=a[1]-b[1];return out};vec2.sub=vec2.subtract;vec2.multiply=function(out,a,b){out[0]=a[0]*b[0];out[1]=a[1]*b[1];return out};vec2.mul=vec2.multiply;vec2.divide=function(out,a,b){out[0]=a[0]/b[0];out[1]=a[1]/b[1];return out};vec2.div=vec2.divide;vec2.scale=function(out,a,b){out[0]=a[0]*b;out[1]=a[1]*b;return out};vec2.distance=function(a,b){var x=b[0]-a[0],y=b[1]-a[1];return Math.sqrt(x*x+y*y)};vec2.dist=vec2.distance;vec2.squaredDistance=function(a,b){var x=b[0]-a[0],y=b[1]-a[1];return x*x+y*y};vec2.sqrDist=vec2.squaredDistance;vec2.length=function(a){var x=a[0],y=a[1];return Math.sqrt(x*x+y*y)};vec2.len=vec2.length;vec2.squaredLength=function(a){var x=a[0],y=a[1];return x*x+y*y};vec2.sqrLen=vec2.squaredLength;vec2.negate=function(out,a){out[0]=-a[0];out[1]=-a[1];return out};vec2.normalize=function(out,a){var x=a[0],y=a[1];var len=x*x+y*y;if(len>0){len=1/Math.sqrt(len);out[0]=a[0]*len;out[1]=a[1]*len}return out};vec2.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]};vec2.str=function(a){return"vec2("+a[0]+", "+a[1]+")"};vec2.lerp=function(out,a,b,t){var ax=a[0],ay=a[1];out[0]=ax+t*(b[0]-ax);out[1]=ay+t*(b[1]-ay);return out};vec2.reflect=function(out,vector,normal){var dot=vector[0]*normal[0]+vector[1]*normal[1];out[0]=vector[0]-2*normal[0]*dot;out[1]=vector[1]-2*normal[1]*dot};vec2.getLineSegmentsIntersection=function(out,p0,p1,p2,p3){var t=vec2.getLineSegmentsIntersectionFraction(p0,p1,p2,p3);if(t<0){return false}else{out[0]=p0[0]+t*(p1[0]-p0[0]);out[1]=p0[1]+t*(p1[1]-p0[1]);return true}};vec2.getLineSegmentsIntersectionFraction=function(p0,p1,p2,p3){var s1_x=p1[0]-p0[0];var s1_y=p1[1]-p0[1];var s2_x=p3[0]-p2[0];var s2_y=p3[1]-p2[1];var s,t;s=(-s1_y*(p0[0]-p2[0])+s1_x*(p0[1]-p2[1]))/(-s2_x*s1_y+s1_x*s2_y);t=(s2_x*(p0[1]-p2[1])-s2_y*(p0[0]-p2[0]))/(-s2_x*s1_y+s1_x*s2_y);if(s>=0&&s<=1&&t>=0&&t<=1){return t}return-1}},{"../utils/Utils":57}],31:[function(_dereq_,module,exports){var vec2=_dereq_("../math/vec2"),decomp=_dereq_("poly-decomp"),Convex=_dereq_("../shapes/Convex"),RaycastResult=_dereq_("../collision/RaycastResult"),Ray=_dereq_("../collision/Ray"),AABB=_dereq_("../collision/AABB"),EventEmitter=_dereq_("../events/EventEmitter");module.exports=Body;function Body(options){options=options||{};EventEmitter.call(this);this.id=options.id||++Body._idCounter;this.world=null;this.shapes=[];this.mass=options.mass||0;this.invMass=0;this.inertia=0;this.invInertia=0;this.invMassSolve=0;this.invInertiaSolve=0;this.fixedRotation=!!options.fixedRotation;this.fixedX=!!options.fixedX;this.fixedY=!!options.fixedY;this.massMultiplier=vec2.create();this.position=vec2.fromValues(0,0);if(options.position){vec2.copy(this.position,options.position)}this.interpolatedPosition=vec2.fromValues(0,0);this.interpolatedAngle=0;this.previousPosition=vec2.fromValues(0,0);this.previousAngle=0;this.velocity=vec2.fromValues(0,0);if(options.velocity){vec2.copy(this.velocity,options.velocity)}this.vlambda=vec2.fromValues(0,0);this.wlambda=0;this.angle=options.angle||0;this.angularVelocity=options.angularVelocity||0;this.force=vec2.create();if(options.force){vec2.copy(this.force,options.force)}this.angularForce=options.angularForce||0;this.damping=typeof options.damping==="number"?options.damping:.1;this.angularDamping=typeof options.angularDamping==="number"?options.angularDamping:.1;this.type=Body.STATIC;if(typeof options.type!=="undefined"){this.type=options.type}else if(!options.mass){this.type=Body.STATIC}else{this.type=Body.DYNAMIC}this.boundingRadius=0;this.aabb=new AABB;this.aabbNeedsUpdate=true;this.allowSleep=options.allowSleep!==undefined?options.allowSleep:true;this.wantsToSleep=false;this.sleepState=Body.AWAKE;this.sleepSpeedLimit=options.sleepSpeedLimit!==undefined?options.sleepSpeedLimit:.2;this.sleepTimeLimit=options.sleepTimeLimit!==undefined?options.sleepTimeLimit:1;this.gravityScale=options.gravityScale!==undefined?options.gravityScale:1;this.collisionResponse=options.collisionResponse!==undefined?options.collisionResponse:true;this.idleTime=0;this.timeLastSleepy=0;this.ccdSpeedThreshold=options.ccdSpeedThreshold!==undefined?options.ccdSpeedThreshold:-1;this.ccdIterations=options.ccdIterations!==undefined?options.ccdIterations:10;this.concavePath=null;this._wakeUpAfterNarrowphase=false;this.updateMassProperties()}Body.prototype=new EventEmitter;Body.prototype.constructor=Body;Body._idCounter=0;Body.prototype.updateSolveMassProperties=function(){if(this.sleepState===Body.SLEEPING||this.type===Body.KINEMATIC){this.invMassSolve=0;this.invInertiaSolve=0}else{this.invMassSolve=this.invMass;this.invInertiaSolve=this.invInertia}};Body.prototype.setDensity=function(density){var totalArea=this.getArea();this.mass=totalArea*density;this.updateMassProperties()};Body.prototype.getArea=function(){var totalArea=0;for(var i=0;i<this.shapes.length;i++){totalArea+=this.shapes[i].area}return totalArea};Body.prototype.getAABB=function(){if(this.aabbNeedsUpdate){this.updateAABB()}return this.aabb};var shapeAABB=new AABB,tmp=vec2.create();Body.prototype.updateAABB=function(){var shapes=this.shapes,N=shapes.length,offset=tmp,bodyAngle=this.angle;for(var i=0;i!==N;i++){var shape=shapes[i],angle=shape.angle+bodyAngle;vec2.rotate(offset,shape.position,bodyAngle);vec2.add(offset,offset,this.position);shape.computeAABB(shapeAABB,offset,angle);if(i===0){this.aabb.copy(shapeAABB)}else{this.aabb.extend(shapeAABB)}}this.aabbNeedsUpdate=false};Body.prototype.updateBoundingRadius=function(){var shapes=this.shapes,N=shapes.length,radius=0;for(var i=0;i!==N;i++){var shape=shapes[i],offset=vec2.length(shape.position),r=shape.boundingRadius;if(offset+r>radius){radius=offset+r}}this.boundingRadius=radius};Body.prototype.addShape=function(shape,offset,angle){if(shape.body){throw new Error("A shape can only be added to one body.")}shape.body=this;if(offset){vec2.copy(shape.position,offset)}else{vec2.set(shape.position,0,0)}shape.angle=angle||0;this.shapes.push(shape);this.updateMassProperties();this.updateBoundingRadius();this.aabbNeedsUpdate=true};Body.prototype.removeShape=function(shape){var idx=this.shapes.indexOf(shape);if(idx!==-1){this.shapes.splice(idx,1);this.aabbNeedsUpdate=true;shape.body=null;return true}else{return false}};Body.prototype.updateMassProperties=function(){if(this.type===Body.STATIC||this.type===Body.KINEMATIC){this.mass=Number.MAX_VALUE;this.invMass=0;this.inertia=Number.MAX_VALUE;this.invInertia=0}else{var shapes=this.shapes,N=shapes.length,m=this.mass/N,I=0;if(!this.fixedRotation){for(var i=0;i<N;i++){var shape=shapes[i],r2=vec2.squaredLength(shape.position),Icm=shape.computeMomentOfInertia(m);I+=Icm+m*r2}this.inertia=I;this.invInertia=I>0?1/I:0}else{this.inertia=Number.MAX_VALUE;this.invInertia=0}this.invMass=1/this.mass;vec2.set(this.massMultiplier,this.fixedX?0:1,this.fixedY?0:1)}};var Body_applyForce_r=vec2.create();Body.prototype.applyForce=function(force,relativePoint){vec2.add(this.force,this.force,force);if(relativePoint){var rotForce=vec2.crossLength(relativePoint,force);this.angularForce+=rotForce}};var Body_applyForce_forceWorld=vec2.create();var Body_applyForce_pointWorld=vec2.create();var Body_applyForce_pointLocal=vec2.create();Body.prototype.applyForceLocal=function(localForce,localPoint){localPoint=localPoint||Body_applyForce_pointLocal;var worldForce=Body_applyForce_forceWorld;var worldPoint=Body_applyForce_pointWorld;this.vectorToWorldFrame(worldForce,localForce);this.vectorToWorldFrame(worldPoint,localPoint);this.applyForce(worldForce,worldPoint)};var Body_applyImpulse_velo=vec2.create();Body.prototype.applyImpulse=function(impulseVector,relativePoint){if(this.type!==Body.DYNAMIC){return}var velo=Body_applyImpulse_velo;vec2.scale(velo,impulseVector,this.invMass);vec2.multiply(velo,this.massMultiplier,velo);vec2.add(this.velocity,velo,this.velocity);if(relativePoint){var rotVelo=vec2.crossLength(relativePoint,impulseVector);rotVelo*=this.invInertia;this.angularVelocity+=rotVelo}};var Body_applyImpulse_impulseWorld=vec2.create();var Body_applyImpulse_pointWorld=vec2.create();var Body_applyImpulse_pointLocal=vec2.create();Body.prototype.applyImpulseLocal=function(localImpulse,localPoint){localPoint=localPoint||Body_applyImpulse_pointLocal;var worldImpulse=Body_applyImpulse_impulseWorld;var worldPoint=Body_applyImpulse_pointWorld;this.vectorToWorldFrame(worldImpulse,localImpulse);this.vectorToWorldFrame(worldPoint,localPoint);this.applyImpulse(worldImpulse,worldPoint)};Body.prototype.toLocalFrame=function(out,worldPoint){vec2.toLocalFrame(out,worldPoint,this.position,this.angle)};Body.prototype.toWorldFrame=function(out,localPoint){vec2.toGlobalFrame(out,localPoint,this.position,this.angle)};Body.prototype.vectorToLocalFrame=function(out,worldVector){vec2.vectorToLocalFrame(out,worldVector,this.angle)};Body.prototype.vectorToWorldFrame=function(out,localVector){vec2.vectorToGlobalFrame(out,localVector,this.angle)};Body.prototype.fromPolygon=function(path,options){options=options||{};for(var i=this.shapes.length;i>=0;--i){this.removeShape(this.shapes[i])}var p=new decomp.Polygon;p.vertices=path;p.makeCCW();if(typeof options.removeCollinearPoints==="number"){p.removeCollinearPoints(options.removeCollinearPoints)}if(typeof options.skipSimpleCheck==="undefined"){if(!p.isSimple()){return false}}this.concavePath=p.vertices.slice(0);for(var i=0;i<this.concavePath.length;i++){var v=[0,0];vec2.copy(v,this.concavePath[i]);this.concavePath[i]=v}var convexes;if(options.optimalDecomp){convexes=p.decomp()}else{convexes=p.quickDecomp()}var cm=vec2.create();for(var i=0;i!==convexes.length;i++){var c=new Convex({vertices:convexes[i].vertices});for(var j=0;j!==c.vertices.length;j++){var v=c.vertices[j];vec2.sub(v,v,c.centerOfMass)}vec2.scale(cm,c.centerOfMass,1);c.updateTriangles();c.updateCenterOfMass();c.updateBoundingRadius();this.addShape(c,cm)}this.adjustCenterOfMass();this.aabbNeedsUpdate=true;return true};var adjustCenterOfMass_tmp1=vec2.fromValues(0,0),adjustCenterOfMass_tmp2=vec2.fromValues(0,0),adjustCenterOfMass_tmp3=vec2.fromValues(0,0),adjustCenterOfMass_tmp4=vec2.fromValues(0,0);Body.prototype.adjustCenterOfMass=function(){var offset_times_area=adjustCenterOfMass_tmp2,sum=adjustCenterOfMass_tmp3,cm=adjustCenterOfMass_tmp4,totalArea=0;vec2.set(sum,0,0);for(var i=0;i!==this.shapes.length;i++){var s=this.shapes[i];vec2.scale(offset_times_area,s.position,s.area);vec2.add(sum,sum,offset_times_area);totalArea+=s.area}vec2.scale(cm,sum,1/totalArea);for(var i=0;i!==this.shapes.length;i++){var s=this.shapes[i];vec2.sub(s.position,s.position,cm)}vec2.add(this.position,this.position,cm);for(var i=0;this.concavePath&&i<this.concavePath.length;i++){vec2.sub(this.concavePath[i],this.concavePath[i],cm)}this.updateMassProperties();this.updateBoundingRadius()};Body.prototype.setZeroForce=function(){vec2.set(this.force,0,0);this.angularForce=0};Body.prototype.resetConstraintVelocity=function(){var b=this,vlambda=b.vlambda;vec2.set(vlambda,0,0);b.wlambda=0};Body.prototype.addConstraintVelocity=function(){var b=this,v=b.velocity;vec2.add(v,v,b.vlambda);b.angularVelocity+=b.wlambda};Body.prototype.applyDamping=function(dt){if(this.type===Body.DYNAMIC){var v=this.velocity;vec2.scale(v,v,Math.pow(1-this.damping,dt));this.angularVelocity*=Math.pow(1-this.angularDamping,dt)}};Body.prototype.wakeUp=function(){var s=this.sleepState;this.sleepState=Body.AWAKE;this.idleTime=0;if(s!==Body.AWAKE){this.emit(Body.wakeUpEvent)}};Body.prototype.sleep=function(){this.sleepState=Body.SLEEPING;this.angularVelocity=0;this.angularForce=0;vec2.set(this.velocity,0,0);vec2.set(this.force,0,0);this.emit(Body.sleepEvent)};Body.prototype.sleepTick=function(time,dontSleep,dt){if(!this.allowSleep||this.type===Body.SLEEPING){return}this.wantsToSleep=false;var sleepState=this.sleepState,speedSquared=vec2.squaredLength(this.velocity)+Math.pow(this.angularVelocity,2),speedLimitSquared=Math.pow(this.sleepSpeedLimit,2);if(speedSquared>=speedLimitSquared){this.idleTime=0;this.sleepState=Body.AWAKE}else{this.idleTime+=dt;this.sleepState=Body.SLEEPY}if(this.idleTime>this.sleepTimeLimit){if(!dontSleep){this.sleep()}else{this.wantsToSleep=true}}};Body.prototype.overlaps=function(body){return this.world.overlapKeeper.bodiesAreOverlapping(this,body)};var integrate_fhMinv=vec2.create();var integrate_velodt=vec2.create();Body.prototype.integrate=function(dt){var minv=this.invMass,f=this.force,pos=this.position,velo=this.velocity;vec2.copy(this.previousPosition,this.position);this.previousAngle=this.angle;if(!this.fixedRotation){this.angularVelocity+=this.angularForce*this.invInertia*dt}vec2.scale(integrate_fhMinv,f,dt*minv);vec2.multiply(integrate_fhMinv,this.massMultiplier,integrate_fhMinv);vec2.add(velo,integrate_fhMinv,velo);if(!this.integrateToTimeOfImpact(dt)){vec2.scale(integrate_velodt,velo,dt);vec2.add(pos,pos,integrate_velodt);if(!this.fixedRotation){this.angle+=this.angularVelocity*dt}}this.aabbNeedsUpdate=true};var result=new RaycastResult;var ray=new Ray({mode:Ray.ALL});var direction=vec2.create();var end=vec2.create();var startToEnd=vec2.create();var rememberPosition=vec2.create();Body.prototype.integrateToTimeOfImpact=function(dt){if(this.ccdSpeedThreshold<0||vec2.squaredLength(this.velocity)<Math.pow(this.ccdSpeedThreshold,2)){return false}vec2.normalize(direction,this.velocity);vec2.scale(end,this.velocity,dt);vec2.add(end,end,this.position);vec2.sub(startToEnd,end,this.position);var startToEndAngle=this.angularVelocity*dt;var len=vec2.length(startToEnd);var timeOfImpact=1;var hit;var that=this;result.reset();ray.callback=function(result){if(result.body===that){return}hit=result.body;result.getHitPoint(end,ray);vec2.sub(startToEnd,end,that.position);timeOfImpact=vec2.length(startToEnd)/len;result.stop()};vec2.copy(ray.from,this.position);vec2.copy(ray.to,end);ray.update();this.world.raycast(result,ray);if(!hit){return false}var rememberAngle=this.angle;vec2.copy(rememberPosition,this.position);var iter=0;var tmin=0;var tmid=0;var tmax=timeOfImpact;while(tmax>=tmin&&iter<this.ccdIterations){iter++;tmid=(tmax-tmin)/2;vec2.scale(integrate_velodt,startToEnd,timeOfImpact);vec2.add(this.position,rememberPosition,integrate_velodt);this.angle=rememberAngle+startToEndAngle*timeOfImpact;this.updateAABB();var overlaps=this.aabb.overlaps(hit.aabb)&&this.world.narrowphase.bodiesOverlap(this,hit);if(overlaps){tmin=tmid}else{tmax=tmid}}timeOfImpact=tmid;vec2.copy(this.position,rememberPosition);this.angle=rememberAngle;vec2.scale(integrate_velodt,startToEnd,timeOfImpact);vec2.add(this.position,this.position,integrate_velodt);if(!this.fixedRotation){this.angle+=startToEndAngle*timeOfImpact}return true};Body.prototype.getVelocityAtPoint=function(result,relativePoint){vec2.crossVZ(result,relativePoint,this.angularVelocity);vec2.subtract(result,this.velocity,result);return result};Body.sleepyEvent={type:"sleepy"};Body.sleepEvent={type:"sleep"};Body.wakeUpEvent={type:"wakeup"};Body.DYNAMIC=1;Body.STATIC=2;Body.KINEMATIC=4;Body.AWAKE=0;Body.SLEEPY=1;Body.SLEEPING=2},{"../collision/AABB":7,"../collision/Ray":11,"../collision/RaycastResult":12,"../events/EventEmitter":26,"../math/vec2":30,"../shapes/Convex":40,"poly-decomp":5}],32:[function(_dereq_,module,exports){var vec2=_dereq_("../math/vec2");var Spring=_dereq_("./Spring");var Utils=_dereq_("../utils/Utils");module.exports=LinearSpring;function LinearSpring(bodyA,bodyB,options){options=options||{};Spring.call(this,bodyA,bodyB,options);this.localAnchorA=vec2.fromValues(0,0);this.localAnchorB=vec2.fromValues(0,0);if(options.localAnchorA){vec2.copy(this.localAnchorA,options.localAnchorA)}if(options.localAnchorB){vec2.copy(this.localAnchorB,options.localAnchorB)}if(options.worldAnchorA){this.setWorldAnchorA(options.worldAnchorA)}if(options.worldAnchorB){this.setWorldAnchorB(options.worldAnchorB)}var worldAnchorA=vec2.create();var worldAnchorB=vec2.create();this.getWorldAnchorA(worldAnchorA);this.getWorldAnchorB(worldAnchorB);var worldDistance=vec2.distance(worldAnchorA,worldAnchorB);this.restLength=typeof options.restLength==="number"?options.restLength:worldDistance}LinearSpring.prototype=new Spring;LinearSpring.prototype.constructor=LinearSpring;LinearSpring.prototype.setWorldAnchorA=function(worldAnchorA){this.bodyA.toLocalFrame(this.localAnchorA,worldAnchorA)};LinearSpring.prototype.setWorldAnchorB=function(worldAnchorB){this.bodyB.toLocalFrame(this.localAnchorB,worldAnchorB)};LinearSpring.prototype.getWorldAnchorA=function(result){this.bodyA.toWorldFrame(result,this.localAnchorA)};LinearSpring.prototype.getWorldAnchorB=function(result){this.bodyB.toWorldFrame(result,this.localAnchorB)};var applyForce_r=vec2.create(),applyForce_r_unit=vec2.create(),applyForce_u=vec2.create(),applyForce_f=vec2.create(),applyForce_worldAnchorA=vec2.create(),applyForce_worldAnchorB=vec2.create(),applyForce_ri=vec2.create(),applyForce_rj=vec2.create(),applyForce_tmp=vec2.create();LinearSpring.prototype.applyForce=function(){var k=this.stiffness,d=this.damping,l=this.restLength,bodyA=this.bodyA,bodyB=this.bodyB,r=applyForce_r,r_unit=applyForce_r_unit,u=applyForce_u,f=applyForce_f,tmp=applyForce_tmp;var worldAnchorA=applyForce_worldAnchorA,worldAnchorB=applyForce_worldAnchorB,ri=applyForce_ri,rj=applyForce_rj;this.getWorldAnchorA(worldAnchorA);this.getWorldAnchorB(worldAnchorB);vec2.sub(ri,worldAnchorA,bodyA.position);vec2.sub(rj,worldAnchorB,bodyB.position);vec2.sub(r,worldAnchorB,worldAnchorA);var rlen=vec2.len(r);vec2.normalize(r_unit,r);vec2.sub(u,bodyB.velocity,bodyA.velocity);vec2.crossZV(tmp,bodyB.angularVelocity,rj);vec2.add(u,u,tmp);vec2.crossZV(tmp,bodyA.angularVelocity,ri);vec2.sub(u,u,tmp);vec2.scale(f,r_unit,-k*(rlen-l)-d*vec2.dot(u,r_unit));vec2.sub(bodyA.force,bodyA.force,f);vec2.add(bodyB.force,bodyB.force,f);var ri_x_f=vec2.crossLength(ri,f);var rj_x_f=vec2.crossLength(rj,f);bodyA.angularForce-=ri_x_f;bodyB.angularForce+=rj_x_f}},{"../math/vec2":30,"../utils/Utils":57,"./Spring":34}],33:[function(_dereq_,module,exports){var vec2=_dereq_("../math/vec2");var Spring=_dereq_("./Spring");module.exports=RotationalSpring;function RotationalSpring(bodyA,bodyB,options){options=options||{};Spring.call(this,bodyA,bodyB,options);this.restAngle=typeof options.restAngle==="number"?options.restAngle:bodyB.angle-bodyA.angle}RotationalSpring.prototype=new Spring;RotationalSpring.prototype.constructor=RotationalSpring;RotationalSpring.prototype.applyForce=function(){var k=this.stiffness,d=this.damping,l=this.restAngle,bodyA=this.bodyA,bodyB=this.bodyB,x=bodyB.angle-bodyA.angle,u=bodyB.angularVelocity-bodyA.angularVelocity;var torque=-k*(x-l)-d*u*0;bodyA.angularForce-=torque;bodyB.angularForce+=torque}},{"../math/vec2":30,"./Spring":34}],34:[function(_dereq_,module,exports){
var vec2=_dereq_("../math/vec2");var Utils=_dereq_("../utils/Utils");module.exports=Spring;function Spring(bodyA,bodyB,options){options=Utils.defaults(options,{stiffness:100,damping:1});this.stiffness=options.stiffness;this.damping=options.damping;this.bodyA=bodyA;this.bodyB=bodyB}Spring.prototype.applyForce=function(){}},{"../math/vec2":30,"../utils/Utils":57}],35:[function(_dereq_,module,exports){var vec2=_dereq_("../math/vec2");var Utils=_dereq_("../utils/Utils");var Constraint=_dereq_("../constraints/Constraint");var FrictionEquation=_dereq_("../equations/FrictionEquation");var Body=_dereq_("../objects/Body");module.exports=TopDownVehicle;function TopDownVehicle(chassisBody,options){options=options||{};this.chassisBody=chassisBody;this.wheels=[];this.groundBody=new Body({mass:0});this.world=null;var that=this;this.preStepCallback=function(){that.update()}}TopDownVehicle.prototype.addToWorld=function(world){this.world=world;world.addBody(this.groundBody);world.on("preStep",this.preStepCallback);for(var i=0;i<this.wheels.length;i++){var wheel=this.wheels[i];world.addConstraint(wheel)}};TopDownVehicle.prototype.removeFromWorld=function(){var world=this.world;world.removeBody(this.groundBody);world.off("preStep",this.preStepCallback);for(var i=0;i<this.wheels.length;i++){var wheel=this.wheels[i];world.removeConstraint(wheel)}this.world=null};TopDownVehicle.prototype.addWheel=function(wheelOptions){var wheel=new WheelConstraint(this,wheelOptions);this.wheels.push(wheel);return wheel};TopDownVehicle.prototype.update=function(){for(var i=0;i<this.wheels.length;i++){this.wheels[i].update()}};function WheelConstraint(vehicle,options){options=options||{};this.vehicle=vehicle;this.forwardEquation=new FrictionEquation(vehicle.chassisBody,vehicle.groundBody);this.sideEquation=new FrictionEquation(vehicle.chassisBody,vehicle.groundBody);this.steerValue=0;this.engineForce=0;this.setSideFriction(options.sideFriction!==undefined?options.sideFriction:5);this.localForwardVector=vec2.fromValues(0,1);if(options.localForwardVector){vec2.copy(this.localForwardVector,options.localForwardVector)}this.localPosition=vec2.fromValues(0,0);if(options.localPosition){vec2.copy(this.localPosition,options.localPosition)}Constraint.apply(this,vehicle.chassisBody,vehicle.groundBody);this.equations.push(this.forwardEquation,this.sideEquation);this.setBrakeForce(0)}WheelConstraint.prototype=new Constraint;WheelConstraint.prototype.setBrakeForce=function(force){this.forwardEquation.setSlipForce(force)};WheelConstraint.prototype.setSideFriction=function(force){this.sideEquation.setSlipForce(force)};var worldVelocity=vec2.create();var relativePoint=vec2.create();WheelConstraint.prototype.getSpeed=function(){this.vehicle.chassisBody.vectorToWorldFrame(relativePoint,this.localForwardVector);this.vehicle.chassisBody.getVelocityAtPoint(worldVelocity,relativePoint);return vec2.dot(worldVelocity,relativePoint)};var tmpVec=vec2.create();WheelConstraint.prototype.update=function(){this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.t,this.localForwardVector);vec2.rotate(this.sideEquation.t,this.localForwardVector,Math.PI/2);this.vehicle.chassisBody.vectorToWorldFrame(this.sideEquation.t,this.sideEquation.t);vec2.rotate(this.forwardEquation.t,this.forwardEquation.t,this.steerValue);vec2.rotate(this.sideEquation.t,this.sideEquation.t,this.steerValue);this.vehicle.chassisBody.toWorldFrame(this.forwardEquation.contactPointB,this.localPosition);vec2.copy(this.sideEquation.contactPointB,this.forwardEquation.contactPointB);this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.contactPointA,this.localPosition);vec2.copy(this.sideEquation.contactPointA,this.forwardEquation.contactPointA);vec2.normalize(tmpVec,this.forwardEquation.t);vec2.scale(tmpVec,tmpVec,this.engineForce);this.vehicle.chassisBody.applyForce(tmpVec,this.forwardEquation.contactPointA)}},{"../constraints/Constraint":14,"../equations/FrictionEquation":23,"../math/vec2":30,"../objects/Body":31,"../utils/Utils":57}],36:[function(_dereq_,module,exports){var p2=module.exports={AABB:_dereq_("./collision/AABB"),AngleLockEquation:_dereq_("./equations/AngleLockEquation"),Body:_dereq_("./objects/Body"),Broadphase:_dereq_("./collision/Broadphase"),Capsule:_dereq_("./shapes/Capsule"),Circle:_dereq_("./shapes/Circle"),Constraint:_dereq_("./constraints/Constraint"),ContactEquation:_dereq_("./equations/ContactEquation"),ContactEquationPool:_dereq_("./utils/ContactEquationPool"),ContactMaterial:_dereq_("./material/ContactMaterial"),Convex:_dereq_("./shapes/Convex"),DistanceConstraint:_dereq_("./constraints/DistanceConstraint"),Equation:_dereq_("./equations/Equation"),EventEmitter:_dereq_("./events/EventEmitter"),FrictionEquation:_dereq_("./equations/FrictionEquation"),FrictionEquationPool:_dereq_("./utils/FrictionEquationPool"),GearConstraint:_dereq_("./constraints/GearConstraint"),GSSolver:_dereq_("./solver/GSSolver"),Heightfield:_dereq_("./shapes/Heightfield"),Line:_dereq_("./shapes/Line"),LockConstraint:_dereq_("./constraints/LockConstraint"),Material:_dereq_("./material/Material"),Narrowphase:_dereq_("./collision/Narrowphase"),NaiveBroadphase:_dereq_("./collision/NaiveBroadphase"),Particle:_dereq_("./shapes/Particle"),Plane:_dereq_("./shapes/Plane"),Pool:_dereq_("./utils/Pool"),RevoluteConstraint:_dereq_("./constraints/RevoluteConstraint"),PrismaticConstraint:_dereq_("./constraints/PrismaticConstraint"),Ray:_dereq_("./collision/Ray"),RaycastResult:_dereq_("./collision/RaycastResult"),Box:_dereq_("./shapes/Box"),RotationalVelocityEquation:_dereq_("./equations/RotationalVelocityEquation"),SAPBroadphase:_dereq_("./collision/SAPBroadphase"),Shape:_dereq_("./shapes/Shape"),Solver:_dereq_("./solver/Solver"),Spring:_dereq_("./objects/Spring"),TopDownVehicle:_dereq_("./objects/TopDownVehicle"),LinearSpring:_dereq_("./objects/LinearSpring"),RotationalSpring:_dereq_("./objects/RotationalSpring"),Utils:_dereq_("./utils/Utils"),World:_dereq_("./world/World"),vec2:_dereq_("./math/vec2"),version:_dereq_("../package.json").version};Object.defineProperty(p2,"Rectangle",{get:function(){console.warn("The Rectangle class has been renamed to Box.");return this.Box}})},{"../package.json":6,"./collision/AABB":7,"./collision/Broadphase":8,"./collision/NaiveBroadphase":9,"./collision/Narrowphase":10,"./collision/Ray":11,"./collision/RaycastResult":12,"./collision/SAPBroadphase":13,"./constraints/Constraint":14,"./constraints/DistanceConstraint":15,"./constraints/GearConstraint":16,"./constraints/LockConstraint":17,"./constraints/PrismaticConstraint":18,"./constraints/RevoluteConstraint":19,"./equations/AngleLockEquation":20,"./equations/ContactEquation":21,"./equations/Equation":22,"./equations/FrictionEquation":23,"./equations/RotationalVelocityEquation":25,"./events/EventEmitter":26,"./material/ContactMaterial":27,"./material/Material":28,"./math/vec2":30,"./objects/Body":31,"./objects/LinearSpring":32,"./objects/RotationalSpring":33,"./objects/Spring":34,"./objects/TopDownVehicle":35,"./shapes/Box":37,"./shapes/Capsule":38,"./shapes/Circle":39,"./shapes/Convex":40,"./shapes/Heightfield":41,"./shapes/Line":42,"./shapes/Particle":43,"./shapes/Plane":44,"./shapes/Shape":45,"./solver/GSSolver":46,"./solver/Solver":47,"./utils/ContactEquationPool":48,"./utils/FrictionEquationPool":49,"./utils/Pool":55,"./utils/Utils":57,"./world/World":61}],37:[function(_dereq_,module,exports){var vec2=_dereq_("../math/vec2"),Shape=_dereq_("./Shape"),Convex=_dereq_("./Convex");module.exports=Box;function Box(options){if(typeof arguments[0]==="number"&&typeof arguments[1]==="number"){options={width:arguments[0],height:arguments[1]};console.warn("The Rectangle has been renamed to Box and its constructor signature has changed. Please use the following format: new Box({ width: 1, height: 1, ... })")}options=options||{};var width=this.width=options.width||1;var height=this.height=options.height||1;var verts=[vec2.fromValues(-width/2,-height/2),vec2.fromValues(width/2,-height/2),vec2.fromValues(width/2,height/2),vec2.fromValues(-width/2,height/2)];var axes=[vec2.fromValues(1,0),vec2.fromValues(0,1)];options.vertices=verts;options.axes=axes;options.type=Shape.BOX;Convex.call(this,options)}Box.prototype=new Convex;Box.prototype.constructor=Box;Box.prototype.computeMomentOfInertia=function(mass){var w=this.width,h=this.height;return mass*(h*h+w*w)/12};Box.prototype.updateBoundingRadius=function(){var w=this.width,h=this.height;this.boundingRadius=Math.sqrt(w*w+h*h)/2};var corner1=vec2.create(),corner2=vec2.create(),corner3=vec2.create(),corner4=vec2.create();Box.prototype.computeAABB=function(out,position,angle){out.setFromPoints(this.vertices,position,angle,0)};Box.prototype.updateArea=function(){this.area=this.width*this.height}},{"../math/vec2":30,"./Convex":40,"./Shape":45}],38:[function(_dereq_,module,exports){var Shape=_dereq_("./Shape"),vec2=_dereq_("../math/vec2");module.exports=Capsule;function Capsule(options){if(typeof arguments[0]==="number"&&typeof arguments[1]==="number"){options={length:arguments[0],radius:arguments[1]};console.warn("The Capsule constructor signature has changed. Please use the following format: new Capsule({ radius: 1, length: 1 })")}options=options||{};this.length=options.length||1;this.radius=options.radius||1;options.type=Shape.CAPSULE;Shape.call(this,options)}Capsule.prototype=new Shape;Capsule.prototype.constructor=Capsule;Capsule.prototype.computeMomentOfInertia=function(mass){var r=this.radius,w=this.length+r,h=r*2;return mass*(h*h+w*w)/12};Capsule.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius+this.length/2};Capsule.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius+this.radius*2*this.length};var r=vec2.create();Capsule.prototype.computeAABB=function(out,position,angle){var radius=this.radius;vec2.set(r,this.length/2,0);if(angle!==0){vec2.rotate(r,r,angle)}vec2.set(out.upperBound,Math.max(r[0]+radius,-r[0]+radius),Math.max(r[1]+radius,-r[1]+radius));vec2.set(out.lowerBound,Math.min(r[0]-radius,-r[0]-radius),Math.min(r[1]-radius,-r[1]-radius));vec2.add(out.lowerBound,out.lowerBound,position);vec2.add(out.upperBound,out.upperBound,position)};var intersectCapsule_hitPointWorld=vec2.create();var intersectCapsule_normal=vec2.create();var intersectCapsule_l0=vec2.create();var intersectCapsule_l1=vec2.create();var intersectCapsule_unit_y=vec2.fromValues(0,1);Capsule.prototype.raycast=function(result,ray,position,angle){var from=ray.from;var to=ray.to;var direction=ray.direction;var hitPointWorld=intersectCapsule_hitPointWorld;var normal=intersectCapsule_normal;var l0=intersectCapsule_l0;var l1=intersectCapsule_l1;var halfLen=this.length/2;for(var i=0;i<2;i++){var y=this.radius*(i*2-1);vec2.set(l0,-halfLen,y);vec2.set(l1,halfLen,y);vec2.toGlobalFrame(l0,l0,position,angle);vec2.toGlobalFrame(l1,l1,position,angle);var delta=vec2.getLineSegmentsIntersectionFraction(from,to,l0,l1);if(delta>=0){vec2.rotate(normal,intersectCapsule_unit_y,angle);vec2.scale(normal,normal,i*2-1);ray.reportIntersection(result,delta,normal,-1);if(result.shouldStop(ray)){return}}}var diagonalLengthSquared=Math.pow(this.radius,2)+Math.pow(halfLen,2);for(var i=0;i<2;i++){vec2.set(l0,halfLen*(i*2-1),0);vec2.toGlobalFrame(l0,l0,position,angle);var a=Math.pow(to[0]-from[0],2)+Math.pow(to[1]-from[1],2);var b=2*((to[0]-from[0])*(from[0]-l0[0])+(to[1]-from[1])*(from[1]-l0[1]));var c=Math.pow(from[0]-l0[0],2)+Math.pow(from[1]-l0[1],2)-Math.pow(this.radius,2);var delta=Math.pow(b,2)-4*a*c;if(delta<0){continue}else if(delta===0){vec2.lerp(hitPointWorld,from,to,delta);if(vec2.squaredDistance(hitPointWorld,position)>diagonalLengthSquared){vec2.sub(normal,hitPointWorld,l0);vec2.normalize(normal,normal);ray.reportIntersection(result,delta,normal,-1);if(result.shouldStop(ray)){return}}}else{var sqrtDelta=Math.sqrt(delta);var inv2a=1/(2*a);var d1=(-b-sqrtDelta)*inv2a;var d2=(-b+sqrtDelta)*inv2a;if(d1>=0&&d1<=1){vec2.lerp(hitPointWorld,from,to,d1);if(vec2.squaredDistance(hitPointWorld,position)>diagonalLengthSquared){vec2.sub(normal,hitPointWorld,l0);vec2.normalize(normal,normal);ray.reportIntersection(result,d1,normal,-1);if(result.shouldStop(ray)){return}}}if(d2>=0&&d2<=1){vec2.lerp(hitPointWorld,from,to,d2);if(vec2.squaredDistance(hitPointWorld,position)>diagonalLengthSquared){vec2.sub(normal,hitPointWorld,l0);vec2.normalize(normal,normal);ray.reportIntersection(result,d2,normal,-1);if(result.shouldStop(ray)){return}}}}}}},{"../math/vec2":30,"./Shape":45}],39:[function(_dereq_,module,exports){var Shape=_dereq_("./Shape"),vec2=_dereq_("../math/vec2");module.exports=Circle;function Circle(options){if(typeof arguments[0]==="number"){options={radius:arguments[0]};console.warn("The Circle constructor signature has changed. Please use the following format: new Circle({ radius: 1 })")}options=options||{};this.radius=options.radius||1;options.type=Shape.CIRCLE;Shape.call(this,options)}Circle.prototype=new Shape;Circle.prototype.constructor=Circle;Circle.prototype.computeMomentOfInertia=function(mass){var r=this.radius;return mass*r*r/2};Circle.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius};Circle.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius};Circle.prototype.computeAABB=function(out,position,angle){var r=this.radius;vec2.set(out.upperBound,r,r);vec2.set(out.lowerBound,-r,-r);if(position){vec2.add(out.lowerBound,out.lowerBound,position);vec2.add(out.upperBound,out.upperBound,position)}};var Ray_intersectSphere_intersectionPoint=vec2.create();var Ray_intersectSphere_normal=vec2.create();Circle.prototype.raycast=function(result,ray,position,angle){var from=ray.from,to=ray.to,r=this.radius;var a=Math.pow(to[0]-from[0],2)+Math.pow(to[1]-from[1],2);var b=2*((to[0]-from[0])*(from[0]-position[0])+(to[1]-from[1])*(from[1]-position[1]));var c=Math.pow(from[0]-position[0],2)+Math.pow(from[1]-position[1],2)-Math.pow(r,2);var delta=Math.pow(b,2)-4*a*c;var intersectionPoint=Ray_intersectSphere_intersectionPoint;var normal=Ray_intersectSphere_normal;if(delta<0){return}else if(delta===0){vec2.lerp(intersectionPoint,from,to,delta);vec2.sub(normal,intersectionPoint,position);vec2.normalize(normal,normal);ray.reportIntersection(result,delta,normal,-1)}else{var sqrtDelta=Math.sqrt(delta);var inv2a=1/(2*a);var d1=(-b-sqrtDelta)*inv2a;var d2=(-b+sqrtDelta)*inv2a;if(d1>=0&&d1<=1){vec2.lerp(intersectionPoint,from,to,d1);vec2.sub(normal,intersectionPoint,position);vec2.normalize(normal,normal);ray.reportIntersection(result,d1,normal,-1);if(result.shouldStop(ray)){return}}if(d2>=0&&d2<=1){vec2.lerp(intersectionPoint,from,to,d2);vec2.sub(normal,intersectionPoint,position);vec2.normalize(normal,normal);ray.reportIntersection(result,d2,normal,-1)}}}},{"../math/vec2":30,"./Shape":45}],40:[function(_dereq_,module,exports){var Shape=_dereq_("./Shape"),vec2=_dereq_("../math/vec2"),polyk=_dereq_("../math/polyk"),decomp=_dereq_("poly-decomp");module.exports=Convex;function Convex(options){if(Array.isArray(arguments[0])){options={vertices:arguments[0],axes:arguments[1]};console.warn("The Convex constructor signature has changed. Please use the following format: new Convex({ vertices: [...], ... })")}options=options||{};this.vertices=[];var vertices=options.vertices!==undefined?options.vertices:[];for(var i=0;i<vertices.length;i++){var v=vec2.create();vec2.copy(v,vertices[i]);this.vertices.push(v)}this.axes=[];if(options.axes){for(var i=0;i<options.axes.length;i++){var axis=vec2.create();vec2.copy(axis,options.axes[i]);this.axes.push(axis)}}else{for(var i=0;i<this.vertices.length;i++){var worldPoint0=this.vertices[i];var worldPoint1=this.vertices[(i+1)%this.vertices.length];var normal=vec2.create();vec2.sub(normal,worldPoint1,worldPoint0);vec2.rotate90cw(normal,normal);vec2.normalize(normal,normal);this.axes.push(normal)}}this.centerOfMass=vec2.fromValues(0,0);this.triangles=[];if(this.vertices.length){this.updateTriangles();this.updateCenterOfMass()}this.boundingRadius=0;options.type=Shape.CONVEX;Shape.call(this,options);this.updateBoundingRadius();this.updateArea();if(this.area<0){throw new Error("Convex vertices must be given in conter-clockwise winding.")}}Convex.prototype=new Shape;Convex.prototype.constructor=Convex;var tmpVec1=vec2.create();var tmpVec2=vec2.create();Convex.prototype.projectOntoLocalAxis=function(localAxis,result){var max=null,min=null,v,value,localAxis=tmpVec1;for(var i=0;i<this.vertices.length;i++){v=this.vertices[i];value=vec2.dot(v,localAxis);if(max===null||value>max){max=value}if(min===null||value<min){min=value}}if(min>max){var t=min;min=max;max=t}vec2.set(result,min,max)};Convex.prototype.projectOntoWorldAxis=function(localAxis,shapeOffset,shapeAngle,result){var worldAxis=tmpVec2;this.projectOntoLocalAxis(localAxis,result);if(shapeAngle!==0){vec2.rotate(worldAxis,localAxis,shapeAngle)}else{worldAxis=localAxis}var offset=vec2.dot(shapeOffset,worldAxis);vec2.set(result,result[0]+offset,result[1]+offset)};Convex.prototype.updateTriangles=function(){this.triangles.length=0;var polykVerts=[];for(var i=0;i<this.vertices.length;i++){var v=this.vertices[i];polykVerts.push(v[0],v[1])}var triangles=polyk.Triangulate(polykVerts);for(var i=0;i<triangles.length;i+=3){var id1=triangles[i],id2=triangles[i+1],id3=triangles[i+2];this.triangles.push([id1,id2,id3])}};var updateCenterOfMass_centroid=vec2.create(),updateCenterOfMass_centroid_times_mass=vec2.create(),updateCenterOfMass_a=vec2.create(),updateCenterOfMass_b=vec2.create(),updateCenterOfMass_c=vec2.create(),updateCenterOfMass_ac=vec2.create(),updateCenterOfMass_ca=vec2.create(),updateCenterOfMass_cb=vec2.create(),updateCenterOfMass_n=vec2.create();Convex.prototype.updateCenterOfMass=function(){var triangles=this.triangles,verts=this.vertices,cm=this.centerOfMass,centroid=updateCenterOfMass_centroid,n=updateCenterOfMass_n,a=updateCenterOfMass_a,b=updateCenterOfMass_b,c=updateCenterOfMass_c,ac=updateCenterOfMass_ac,ca=updateCenterOfMass_ca,cb=updateCenterOfMass_cb,centroid_times_mass=updateCenterOfMass_centroid_times_mass;vec2.set(cm,0,0);var totalArea=0;for(var i=0;i!==triangles.length;i++){var t=triangles[i],a=verts[t[0]],b=verts[t[1]],c=verts[t[2]];vec2.centroid(centroid,a,b,c);var m=Convex.triangleArea(a,b,c);totalArea+=m;vec2.scale(centroid_times_mass,centroid,m);vec2.add(cm,cm,centroid_times_mass)}vec2.scale(cm,cm,1/totalArea)};Convex.prototype.computeMomentOfInertia=function(mass){var denom=0,numer=0,N=this.vertices.length;for(var j=N-1,i=0;i<N;j=i,i++){var p0=this.vertices[j];var p1=this.vertices[i];var a=Math.abs(vec2.crossLength(p0,p1));var b=vec2.dot(p1,p1)+vec2.dot(p1,p0)+vec2.dot(p0,p0);denom+=a*b;numer+=a}return mass/6*(denom/numer)};Convex.prototype.updateBoundingRadius=function(){var verts=this.vertices,r2=0;for(var i=0;i!==verts.length;i++){var l2=vec2.squaredLength(verts[i]);if(l2>r2){r2=l2}}this.boundingRadius=Math.sqrt(r2)};Convex.triangleArea=function(a,b,c){return((b[0]-a[0])*(c[1]-a[1])-(c[0]-a[0])*(b[1]-a[1]))*.5};Convex.prototype.updateArea=function(){this.updateTriangles();this.area=0;var triangles=this.triangles,verts=this.vertices;for(var i=0;i!==triangles.length;i++){var t=triangles[i],a=verts[t[0]],b=verts[t[1]],c=verts[t[2]];var m=Convex.triangleArea(a,b,c);this.area+=m}};Convex.prototype.computeAABB=function(out,position,angle){out.setFromPoints(this.vertices,position,angle,0)};var intersectConvex_rayStart=vec2.create();var intersectConvex_rayEnd=vec2.create();var intersectConvex_normal=vec2.create();Convex.prototype.raycast=function(result,ray,position,angle){var rayStart=intersectConvex_rayStart;var rayEnd=intersectConvex_rayEnd;var normal=intersectConvex_normal;var vertices=this.vertices;vec2.toLocalFrame(rayStart,ray.from,position,angle);vec2.toLocalFrame(rayEnd,ray.to,position,angle);var n=vertices.length;for(var i=0;i<n&&!result.shouldStop(ray);i++){var q1=vertices[i];var q2=vertices[(i+1)%n];var delta=vec2.getLineSegmentsIntersectionFraction(rayStart,rayEnd,q1,q2);if(delta>=0){vec2.sub(normal,q2,q1);vec2.rotate(normal,normal,-Math.PI/2+angle);vec2.normalize(normal,normal);ray.reportIntersection(result,delta,normal,i)}}}},{"../math/polyk":29,"../math/vec2":30,"./Shape":45,"poly-decomp":5}],41:[function(_dereq_,module,exports){var Shape=_dereq_("./Shape"),vec2=_dereq_("../math/vec2"),Utils=_dereq_("../utils/Utils");module.exports=Heightfield;function Heightfield(options){if(Array.isArray(arguments[0])){options={heights:arguments[0]};if(typeof arguments[1]==="object"){for(var key in arguments[1]){options[key]=arguments[1][key]}}console.warn("The Heightfield constructor signature has changed. Please use the following format: new Heightfield({ heights: [...], ... })")}options=options||{};this.heights=options.heights?options.heights.slice(0):[];this.maxValue=options.maxValue||null;this.minValue=options.minValue||null;this.elementWidth=options.elementWidth||.1;if(options.maxValue===undefined||options.minValue===undefined){this.updateMaxMinValues()}options.type=Shape.HEIGHTFIELD;Shape.call(this,options)}Heightfield.prototype=new Shape;Heightfield.prototype.constructor=Heightfield;Heightfield.prototype.updateMaxMinValues=function(){var data=this.heights;var maxValue=data[0];var minValue=data[0];for(var i=0;i!==data.length;i++){var v=data[i];if(v>maxValue){maxValue=v}if(v<minValue){minValue=v}}this.maxValue=maxValue;this.minValue=minValue};Heightfield.prototype.computeMomentOfInertia=function(mass){return Number.MAX_VALUE};Heightfield.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE};Heightfield.prototype.updateArea=function(){var data=this.heights,area=0;for(var i=0;i<data.length-1;i++){area+=(data[i]+data[i+1])/2*this.elementWidth}this.area=area};var points=[vec2.create(),vec2.create(),vec2.create(),vec2.create()];Heightfield.prototype.computeAABB=function(out,position,angle){vec2.set(points[0],0,this.maxValue);vec2.set(points[1],this.elementWidth*this.heights.length,this.maxValue);vec2.set(points[2],this.elementWidth*this.heights.length,this.minValue);vec2.set(points[3],0,this.minValue);out.setFromPoints(points,position,angle)};Heightfield.prototype.getLineSegment=function(start,end,i){var data=this.heights;var width=this.elementWidth;vec2.set(start,i*width,data[i]);vec2.set(end,(i+1)*width,data[i+1])};Heightfield.prototype.getSegmentIndex=function(position){return Math.floor(position[0]/this.elementWidth)};Heightfield.prototype.getClampedSegmentIndex=function(position){var i=this.getSegmentIndex(position);i=Math.min(this.heights.length,Math.max(i,0));return i};var intersectHeightfield_hitPointWorld=vec2.create();var intersectHeightfield_worldNormal=vec2.create();var intersectHeightfield_l0=vec2.create();var intersectHeightfield_l1=vec2.create();var intersectHeightfield_localFrom=vec2.create();var intersectHeightfield_localTo=vec2.create();var intersectHeightfield_unit_y=vec2.fromValues(0,1);function getLineSegmentsIntersection(out,p0,p1,p2,p3){var s1_x,s1_y,s2_x,s2_y;s1_x=p1[0]-p0[0];s1_y=p1[1]-p0[1];s2_x=p3[0]-p2[0];s2_y=p3[1]-p2[1];var s,t;s=(-s1_y*(p0[0]-p2[0])+s1_x*(p0[1]-p2[1]))/(-s2_x*s1_y+s1_x*s2_y);t=(s2_x*(p0[1]-p2[1])-s2_y*(p0[0]-p2[0]))/(-s2_x*s1_y+s1_x*s2_y);if(s>=0&&s<=1&&t>=0&&t<=1){var intX=p0[0]+t*s1_x;var intY=p0[1]+t*s1_y;out[0]=intX;out[1]=intY;return t}return-1}Heightfield.prototype.raycast=function(result,ray,position,angle){var from=ray.from;var to=ray.to;var direction=ray.direction;var hitPointWorld=intersectHeightfield_hitPointWorld;var worldNormal=intersectHeightfield_worldNormal;var l0=intersectHeightfield_l0;var l1=intersectHeightfield_l1;var localFrom=intersectHeightfield_localFrom;var localTo=intersectHeightfield_localTo;vec2.toLocalFrame(localFrom,from,position,angle);vec2.toLocalFrame(localTo,to,position,angle);var i0=this.getClampedSegmentIndex(localFrom);var i1=this.getClampedSegmentIndex(localTo);if(i0>i1){var tmp=i0;i0=i1;i1=tmp}for(var i=0;i<this.heights.length-1;i++){this.getLineSegment(l0,l1,i);var t=vec2.getLineSegmentsIntersectionFraction(localFrom,localTo,l0,l1);if(t>=0){vec2.sub(worldNormal,l1,l0);vec2.rotate(worldNormal,worldNormal,angle+Math.PI/2);vec2.normalize(worldNormal,worldNormal);ray.reportIntersection(result,t,worldNormal,-1);if(result.shouldStop(ray)){return}}}}},{"../math/vec2":30,"../utils/Utils":57,"./Shape":45}],42:[function(_dereq_,module,exports){var Shape=_dereq_("./Shape"),vec2=_dereq_("../math/vec2");module.exports=Line;function Line(options){if(typeof arguments[0]==="number"){options={length:arguments[0]};console.warn("The Line constructor signature has changed. Please use the following format: new Line({ length: 1, ... })")}options=options||{};this.length=options.length||1;options.type=Shape.LINE;Shape.call(this,options)}Line.prototype=new Shape;Line.prototype.constructor=Line;Line.prototype.computeMomentOfInertia=function(mass){return mass*Math.pow(this.length,2)/12};Line.prototype.updateBoundingRadius=function(){this.boundingRadius=this.length/2};var points=[vec2.create(),vec2.create()];Line.prototype.computeAABB=function(out,position,angle){var l2=this.length/2;vec2.set(points[0],-l2,0);vec2.set(points[1],l2,0);out.setFromPoints(points,position,angle,0)};var raycast_hitPoint=vec2.create();var raycast_normal=vec2.create();var raycast_l0=vec2.create();var raycast_l1=vec2.create();var raycast_unit_y=vec2.fromValues(0,1);Line.prototype.raycast=function(result,ray,position,angle){var from=ray.from;var to=ray.to;var l0=raycast_l0;var l1=raycast_l1;var halfLen=this.length/2;vec2.set(l0,-halfLen,0);vec2.set(l1,halfLen,0);vec2.toGlobalFrame(l0,l0,position,angle);vec2.toGlobalFrame(l1,l1,position,angle);var fraction=vec2.getLineSegmentsIntersectionFraction(l0,l1,from,to);if(fraction>=0){var normal=raycast_normal;vec2.rotate(normal,raycast_unit_y,angle);ray.reportIntersection(result,fraction,normal,-1)}}},{"../math/vec2":30,"./Shape":45}],43:[function(_dereq_,module,exports){var Shape=_dereq_("./Shape"),vec2=_dereq_("../math/vec2");module.exports=Particle;function Particle(options){options=options||{};options.type=Shape.PARTICLE;Shape.call(this,options)}Particle.prototype=new Shape;Particle.prototype.constructor=Particle;Particle.prototype.computeMomentOfInertia=function(mass){return 0};Particle.prototype.updateBoundingRadius=function(){this.boundingRadius=0};Particle.prototype.computeAABB=function(out,position,angle){vec2.copy(out.lowerBound,position);vec2.copy(out.upperBound,position)}},{"../math/vec2":30,"./Shape":45}],44:[function(_dereq_,module,exports){var Shape=_dereq_("./Shape"),vec2=_dereq_("../math/vec2"),Utils=_dereq_("../utils/Utils");module.exports=Plane;function Plane(options){options=options||{};options.type=Shape.PLANE;Shape.call(this,options)}Plane.prototype=new Shape;Plane.prototype.constructor=Plane;Plane.prototype.computeMomentOfInertia=function(mass){return 0};Plane.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE};Plane.prototype.computeAABB=function(out,position,angle){var a=angle%(2*Math.PI);var set=vec2.set;var max=1e7;var lowerBound=out.lowerBound;var upperBound=out.upperBound;set(lowerBound,-max,-max);set(upperBound,max,max);if(a===0){upperBound[1]=0}else if(a===Math.PI/2){lowerBound[0]=0}else if(a===Math.PI){lowerBound[1]=0}else if(a===3*Math.PI/2){upperBound[0]=0}};Plane.prototype.updateArea=function(){this.area=Number.MAX_VALUE};var intersectPlane_planePointToFrom=vec2.create();var intersectPlane_dir_scaled_with_t=vec2.create();var intersectPlane_hitPoint=vec2.create();var intersectPlane_normal=vec2.create();var intersectPlane_len=vec2.create();Plane.prototype.raycast=function(result,ray,position,angle){var from=ray.from;var to=ray.to;var direction=ray.direction;var planePointToFrom=intersectPlane_planePointToFrom;var dir_scaled_with_t=intersectPlane_dir_scaled_with_t;var hitPoint=intersectPlane_hitPoint;var normal=intersectPlane_normal;var len=intersectPlane_len;vec2.set(normal,0,1);vec2.rotate(normal,normal,angle);vec2.sub(len,from,position);var planeToFrom=vec2.dot(len,normal);vec2.sub(len,to,position);var planeToTo=vec2.dot(len,normal);if(planeToFrom*planeToTo>0){return}if(vec2.squaredDistance(from,to)<planeToFrom*planeToFrom){return}var n_dot_dir=vec2.dot(normal,direction);vec2.sub(planePointToFrom,from,position);var t=-vec2.dot(normal,planePointToFrom)/n_dot_dir/ray.length;ray.reportIntersection(result,t,normal,-1)}},{"../math/vec2":30,"../utils/Utils":57,"./Shape":45}],45:[function(_dereq_,module,exports){module.exports=Shape;var vec2=_dereq_("../math/vec2");function Shape(options){options=options||{};this.body=null;this.position=vec2.fromValues(0,0);if(options.position){vec2.copy(this.position,options.position)}this.angle=options.angle||0;this.type=options.type||0;this.id=Shape.idCounter++;this.boundingRadius=0;this.collisionGroup=options.collisionGroup!==undefined?options.collisionGroup:1;this.collisionResponse=options.collisionResponse!==undefined?options.collisionResponse:true;this.collisionMask=options.collisionMask!==undefined?options.collisionMask:1;this.material=options.material||null;this.area=0;this.sensor=options.sensor!==undefined?options.sensor:false;if(this.type){this.updateBoundingRadius()}this.updateArea()}Shape.idCounter=0;Shape.CIRCLE=1;Shape.PARTICLE=2;Shape.PLANE=4;Shape.CONVEX=8;Shape.LINE=16;Shape.BOX=32;Object.defineProperty(Shape,"RECTANGLE",{get:function(){console.warn("Shape.RECTANGLE is deprecated, use Shape.BOX instead.");return Shape.BOX}});Shape.CAPSULE=64;Shape.HEIGHTFIELD=128;Shape.prototype.computeMomentOfInertia=function(mass){};Shape.prototype.updateBoundingRadius=function(){};Shape.prototype.updateArea=function(){};Shape.prototype.computeAABB=function(out,position,angle){};Shape.prototype.raycast=function(result,ray,position,angle){}},{"../math/vec2":30}],46:[function(_dereq_,module,exports){var vec2=_dereq_("../math/vec2"),Solver=_dereq_("./Solver"),Utils=_dereq_("../utils/Utils"),FrictionEquation=_dereq_("../equations/FrictionEquation");module.exports=GSSolver;function GSSolver(options){Solver.call(this,options,Solver.GS);options=options||{};this.iterations=options.iterations||10;this.tolerance=options.tolerance||1e-7;this.arrayStep=30;this.lambda=new Utils.ARRAY_TYPE(this.arrayStep);this.Bs=new Utils.ARRAY_TYPE(this.arrayStep);this.invCs=new Utils.ARRAY_TYPE(this.arrayStep);this.useZeroRHS=false;this.frictionIterations=options.frictionIterations!==undefined?0:options.frictionIterations;this.usedIterations=0}GSSolver.prototype=new Solver;GSSolver.prototype.constructor=GSSolver;function setArrayZero(array){var l=array.length;while(l--){array[l]=+0}}GSSolver.prototype.solve=function(h,world){this.sortEquations();var iter=0,maxIter=this.iterations,maxFrictionIter=this.frictionIterations,equations=this.equations,Neq=equations.length,tolSquared=Math.pow(this.tolerance*Neq,2),bodies=world.bodies,Nbodies=world.bodies.length,add=vec2.add,set=vec2.set,useZeroRHS=this.useZeroRHS,lambda=this.lambda;this.usedIterations=0;if(Neq){for(var i=0;i!==Nbodies;i++){var b=bodies[i];b.updateSolveMassProperties()}}if(lambda.length<Neq){lambda=this.lambda=new Utils.ARRAY_TYPE(Neq+this.arrayStep);this.Bs=new Utils.ARRAY_TYPE(Neq+this.arrayStep);this.invCs=new Utils.ARRAY_TYPE(Neq+this.arrayStep)}setArrayZero(lambda);var invCs=this.invCs,Bs=this.Bs,lambda=this.lambda;for(var i=0;i!==equations.length;i++){var c=equations[i];if(c.timeStep!==h||c.needsUpdate){c.timeStep=h;c.update()}Bs[i]=c.computeB(c.a,c.b,h);invCs[i]=c.computeInvC(c.epsilon)}var q,B,c,deltalambdaTot,i,j;if(Neq!==0){for(i=0;i!==Nbodies;i++){var b=bodies[i];b.resetConstraintVelocity()}if(maxFrictionIter){for(iter=0;iter!==maxFrictionIter;iter++){deltalambdaTot=0;for(j=0;j!==Neq;j++){c=equations[j];var deltalambda=GSSolver.iterateEquation(j,c,c.epsilon,Bs,invCs,lambda,useZeroRHS,h,iter);deltalambdaTot+=Math.abs(deltalambda)}this.usedIterations++;if(deltalambdaTot*deltalambdaTot<=tolSquared){break}}GSSolver.updateMultipliers(equations,lambda,1/h);for(j=0;j!==Neq;j++){var eq=equations[j];if(eq instanceof FrictionEquation){var f=0;for(var k=0;k!==eq.contactEquations.length;k++){
f+=eq.contactEquations[k].multiplier}f*=eq.frictionCoefficient/eq.contactEquations.length;eq.maxForce=f;eq.minForce=-f}}}for(iter=0;iter!==maxIter;iter++){deltalambdaTot=0;for(j=0;j!==Neq;j++){c=equations[j];var deltalambda=GSSolver.iterateEquation(j,c,c.epsilon,Bs,invCs,lambda,useZeroRHS,h,iter);deltalambdaTot+=Math.abs(deltalambda)}this.usedIterations++;if(deltalambdaTot*deltalambdaTot<=tolSquared){break}}for(i=0;i!==Nbodies;i++){bodies[i].addConstraintVelocity()}GSSolver.updateMultipliers(equations,lambda,1/h)}};GSSolver.updateMultipliers=function(equations,lambda,invDt){var l=equations.length;while(l--){equations[l].multiplier=lambda[l]*invDt}};GSSolver.iterateEquation=function(j,eq,eps,Bs,invCs,lambda,useZeroRHS,dt,iter){var B=Bs[j],invC=invCs[j],lambdaj=lambda[j],GWlambda=eq.computeGWlambda();var maxForce=eq.maxForce,minForce=eq.minForce;if(useZeroRHS){B=0}var deltalambda=invC*(B-GWlambda-eps*lambdaj);var lambdaj_plus_deltalambda=lambdaj+deltalambda;if(lambdaj_plus_deltalambda<minForce*dt){deltalambda=minForce*dt-lambdaj}else if(lambdaj_plus_deltalambda>maxForce*dt){deltalambda=maxForce*dt-lambdaj}lambda[j]+=deltalambda;eq.addToWlambda(deltalambda);return deltalambda}},{"../equations/FrictionEquation":23,"../math/vec2":30,"../utils/Utils":57,"./Solver":47}],47:[function(_dereq_,module,exports){var Utils=_dereq_("../utils/Utils"),EventEmitter=_dereq_("../events/EventEmitter");module.exports=Solver;function Solver(options,type){options=options||{};EventEmitter.call(this);this.type=type;this.equations=[];this.equationSortFunction=options.equationSortFunction||false}Solver.prototype=new EventEmitter;Solver.prototype.constructor=Solver;Solver.prototype.solve=function(dt,world){throw new Error("Solver.solve should be implemented by subclasses!")};var mockWorld={bodies:[]};Solver.prototype.solveIsland=function(dt,island){this.removeAllEquations();if(island.equations.length){this.addEquations(island.equations);mockWorld.bodies.length=0;island.getBodies(mockWorld.bodies);if(mockWorld.bodies.length){this.solve(dt,mockWorld)}}};Solver.prototype.sortEquations=function(){if(this.equationSortFunction){this.equations.sort(this.equationSortFunction)}};Solver.prototype.addEquation=function(eq){if(eq.enabled){this.equations.push(eq)}};Solver.prototype.addEquations=function(eqs){for(var i=0,N=eqs.length;i!==N;i++){var eq=eqs[i];if(eq.enabled){this.equations.push(eq)}}};Solver.prototype.removeEquation=function(eq){var i=this.equations.indexOf(eq);if(i!==-1){this.equations.splice(i,1)}};Solver.prototype.removeAllEquations=function(){this.equations.length=0};Solver.GS=1;Solver.ISLAND=2},{"../events/EventEmitter":26,"../utils/Utils":57}],48:[function(_dereq_,module,exports){var ContactEquation=_dereq_("../equations/ContactEquation");var Pool=_dereq_("./Pool");module.exports=ContactEquationPool;function ContactEquationPool(){Pool.apply(this,arguments)}ContactEquationPool.prototype=new Pool;ContactEquationPool.prototype.constructor=ContactEquationPool;ContactEquationPool.prototype.create=function(){return new ContactEquation};ContactEquationPool.prototype.destroy=function(equation){equation.bodyA=equation.bodyB=null;return this}},{"../equations/ContactEquation":21,"./Pool":55}],49:[function(_dereq_,module,exports){var FrictionEquation=_dereq_("../equations/FrictionEquation");var Pool=_dereq_("./Pool");module.exports=FrictionEquationPool;function FrictionEquationPool(){Pool.apply(this,arguments)}FrictionEquationPool.prototype=new Pool;FrictionEquationPool.prototype.constructor=FrictionEquationPool;FrictionEquationPool.prototype.create=function(){return new FrictionEquation};FrictionEquationPool.prototype.destroy=function(equation){equation.bodyA=equation.bodyB=null;return this}},{"../equations/FrictionEquation":23,"./Pool":55}],50:[function(_dereq_,module,exports){var IslandNode=_dereq_("../world/IslandNode");var Pool=_dereq_("./Pool");module.exports=IslandNodePool;function IslandNodePool(){Pool.apply(this,arguments)}IslandNodePool.prototype=new Pool;IslandNodePool.prototype.constructor=IslandNodePool;IslandNodePool.prototype.create=function(){return new IslandNode};IslandNodePool.prototype.destroy=function(node){node.reset();return this}},{"../world/IslandNode":60,"./Pool":55}],51:[function(_dereq_,module,exports){var Island=_dereq_("../world/Island");var Pool=_dereq_("./Pool");module.exports=IslandPool;function IslandPool(){Pool.apply(this,arguments)}IslandPool.prototype=new Pool;IslandPool.prototype.constructor=IslandPool;IslandPool.prototype.create=function(){return new Island};IslandPool.prototype.destroy=function(island){island.reset();return this}},{"../world/Island":58,"./Pool":55}],52:[function(_dereq_,module,exports){var TupleDictionary=_dereq_("./TupleDictionary");var OverlapKeeperRecord=_dereq_("./OverlapKeeperRecord");var OverlapKeeperRecordPool=_dereq_("./OverlapKeeperRecordPool");var Utils=_dereq_("./Utils");module.exports=OverlapKeeper;function OverlapKeeper(){this.overlappingShapesLastState=new TupleDictionary;this.overlappingShapesCurrentState=new TupleDictionary;this.recordPool=new OverlapKeeperRecordPool({size:16});this.tmpDict=new TupleDictionary;this.tmpArray1=[]}OverlapKeeper.prototype.tick=function(){var last=this.overlappingShapesLastState;var current=this.overlappingShapesCurrentState;var l=last.keys.length;while(l--){var key=last.keys[l];var lastObject=last.getByKey(key);var currentObject=current.getByKey(key);if(lastObject){this.recordPool.release(lastObject)}}last.reset();last.copy(current);current.reset()};OverlapKeeper.prototype.setOverlapping=function(bodyA,shapeA,bodyB,shapeB){var last=this.overlappingShapesLastState;var current=this.overlappingShapesCurrentState;if(!current.get(shapeA.id,shapeB.id)){var data=this.recordPool.get();data.set(bodyA,shapeA,bodyB,shapeB);current.set(shapeA.id,shapeB.id,data)}};OverlapKeeper.prototype.getNewOverlaps=function(result){return this.getDiff(this.overlappingShapesLastState,this.overlappingShapesCurrentState,result)};OverlapKeeper.prototype.getEndOverlaps=function(result){return this.getDiff(this.overlappingShapesCurrentState,this.overlappingShapesLastState,result)};OverlapKeeper.prototype.bodiesAreOverlapping=function(bodyA,bodyB){var current=this.overlappingShapesCurrentState;var l=current.keys.length;while(l--){var key=current.keys[l];var data=current.data[key];if(data.bodyA===bodyA&&data.bodyB===bodyB||data.bodyA===bodyB&&data.bodyB===bodyA){return true}}return false};OverlapKeeper.prototype.getDiff=function(dictA,dictB,result){var result=result||[];var last=dictA;var current=dictB;result.length=0;var l=current.keys.length;while(l--){var key=current.keys[l];var data=current.data[key];if(!data){throw new Error("Key "+key+" had no data!")}var lastData=last.data[key];if(!lastData){result.push(data)}}return result};OverlapKeeper.prototype.isNewOverlap=function(shapeA,shapeB){var idA=shapeA.id|0,idB=shapeB.id|0;var last=this.overlappingShapesLastState;var current=this.overlappingShapesCurrentState;return!!!last.get(idA,idB)&&!!current.get(idA,idB)};OverlapKeeper.prototype.getNewBodyOverlaps=function(result){this.tmpArray1.length=0;var overlaps=this.getNewOverlaps(this.tmpArray1);return this.getBodyDiff(overlaps,result)};OverlapKeeper.prototype.getEndBodyOverlaps=function(result){this.tmpArray1.length=0;var overlaps=this.getEndOverlaps(this.tmpArray1);return this.getBodyDiff(overlaps,result)};OverlapKeeper.prototype.getBodyDiff=function(overlaps,result){result=result||[];var accumulator=this.tmpDict;var l=overlaps.length;while(l--){var data=overlaps[l];accumulator.set(data.bodyA.id|0,data.bodyB.id|0,data)}l=accumulator.keys.length;while(l--){var data=accumulator.getByKey(accumulator.keys[l]);if(data){result.push(data.bodyA,data.bodyB)}}accumulator.reset();return result}},{"./OverlapKeeperRecord":53,"./OverlapKeeperRecordPool":54,"./TupleDictionary":56,"./Utils":57}],53:[function(_dereq_,module,exports){module.exports=OverlapKeeperRecord;function OverlapKeeperRecord(bodyA,shapeA,bodyB,shapeB){this.shapeA=shapeA;this.shapeB=shapeB;this.bodyA=bodyA;this.bodyB=bodyB}OverlapKeeperRecord.prototype.set=function(bodyA,shapeA,bodyB,shapeB){OverlapKeeperRecord.call(this,bodyA,shapeA,bodyB,shapeB)}},{}],54:[function(_dereq_,module,exports){var OverlapKeeperRecord=_dereq_("./OverlapKeeperRecord");var Pool=_dereq_("./Pool");module.exports=OverlapKeeperRecordPool;function OverlapKeeperRecordPool(){Pool.apply(this,arguments)}OverlapKeeperRecordPool.prototype=new Pool;OverlapKeeperRecordPool.prototype.constructor=OverlapKeeperRecordPool;OverlapKeeperRecordPool.prototype.create=function(){return new OverlapKeeperRecord};OverlapKeeperRecordPool.prototype.destroy=function(record){record.bodyA=record.bodyB=record.shapeA=record.shapeB=null;return this}},{"./OverlapKeeperRecord":53,"./Pool":55}],55:[function(_dereq_,module,exports){module.exports=Pool;function Pool(options){options=options||{};this.objects=[];if(options.size!==undefined){this.resize(options.size)}}Pool.prototype.resize=function(size){var objects=this.objects;while(objects.length>size){objects.pop()}while(objects.length<size){objects.push(this.create())}return this};Pool.prototype.get=function(){var objects=this.objects;return objects.length?objects.pop():this.create()};Pool.prototype.release=function(object){this.destroy(object);this.objects.push(object);return this}},{}],56:[function(_dereq_,module,exports){var Utils=_dereq_("./Utils");module.exports=TupleDictionary;function TupleDictionary(){this.data={};this.keys=[]}TupleDictionary.prototype.getKey=function(id1,id2){id1=id1|0;id2=id2|0;if((id1|0)===(id2|0)){return-1}return((id1|0)>(id2|0)?id1<<16|id2&65535:id2<<16|id1&65535)|0};TupleDictionary.prototype.getByKey=function(key){key=key|0;return this.data[key]};TupleDictionary.prototype.get=function(i,j){return this.data[this.getKey(i,j)]};TupleDictionary.prototype.set=function(i,j,value){if(!value){throw new Error("No data!")}var key=this.getKey(i,j);if(!this.data[key]){this.keys.push(key)}this.data[key]=value;return key};TupleDictionary.prototype.reset=function(){var data=this.data,keys=this.keys;var l=keys.length;while(l--){delete data[keys[l]]}keys.length=0};TupleDictionary.prototype.copy=function(dict){this.reset();Utils.appendArray(this.keys,dict.keys);var l=dict.keys.length;while(l--){var key=dict.keys[l];this.data[key]=dict.data[key]}}},{"./Utils":57}],57:[function(_dereq_,module,exports){module.exports=Utils;function Utils(){}Utils.appendArray=function(a,b){if(b.length<15e4){a.push.apply(a,b)}else{for(var i=0,len=b.length;i!==len;++i){a.push(b[i])}}};Utils.splice=function(array,index,howmany){howmany=howmany||1;for(var i=index,len=array.length-howmany;i<len;i++){array[i]=array[i+howmany]}array.length=len};if(typeof P2_ARRAY_TYPE!=="undefined"){Utils.ARRAY_TYPE=P2_ARRAY_TYPE}else if(typeof Float32Array!=="undefined"){Utils.ARRAY_TYPE=Float32Array}else{Utils.ARRAY_TYPE=Array}Utils.extend=function(a,b){for(var key in b){a[key]=b[key]}};Utils.defaults=function(options,defaults){options=options||{};for(var key in defaults){if(!(key in options)){options[key]=defaults[key]}}return options}},{}],58:[function(_dereq_,module,exports){var Body=_dereq_("../objects/Body");module.exports=Island;function Island(){this.equations=[];this.bodies=[]}Island.prototype.reset=function(){this.equations.length=this.bodies.length=0};var bodyIds=[];Island.prototype.getBodies=function(result){var bodies=result||[],eqs=this.equations;bodyIds.length=0;for(var i=0;i!==eqs.length;i++){var eq=eqs[i];if(bodyIds.indexOf(eq.bodyA.id)===-1){bodies.push(eq.bodyA);bodyIds.push(eq.bodyA.id)}if(bodyIds.indexOf(eq.bodyB.id)===-1){bodies.push(eq.bodyB);bodyIds.push(eq.bodyB.id)}}return bodies};Island.prototype.wantsToSleep=function(){for(var i=0;i<this.bodies.length;i++){var b=this.bodies[i];if(b.type===Body.DYNAMIC&&!b.wantsToSleep){return false}}return true};Island.prototype.sleep=function(){for(var i=0;i<this.bodies.length;i++){var b=this.bodies[i];b.sleep()}return true}},{"../objects/Body":31}],59:[function(_dereq_,module,exports){var vec2=_dereq_("../math/vec2"),Island=_dereq_("./Island"),IslandNode=_dereq_("./IslandNode"),IslandNodePool=_dereq_("./../utils/IslandNodePool"),IslandPool=_dereq_("./../utils/IslandPool"),Body=_dereq_("../objects/Body");module.exports=IslandManager;function IslandManager(options){this.nodePool=new IslandNodePool({size:16});this.islandPool=new IslandPool({size:8});this.equations=[];this.islands=[];this.nodes=[];this.queue=[]}IslandManager.getUnvisitedNode=function(nodes){var Nnodes=nodes.length;for(var i=0;i!==Nnodes;i++){var node=nodes[i];if(!node.visited&&node.body.type===Body.DYNAMIC){return node}}return false};IslandManager.prototype.visit=function(node,bds,eqs){bds.push(node.body);var Neqs=node.equations.length;for(var i=0;i!==Neqs;i++){var eq=node.equations[i];if(eqs.indexOf(eq)===-1){eqs.push(eq)}}};IslandManager.prototype.bfs=function(root,bds,eqs){var queue=this.queue;queue.length=0;queue.push(root);root.visited=true;this.visit(root,bds,eqs);while(queue.length){var node=queue.pop();var child;while(child=IslandManager.getUnvisitedNode(node.neighbors)){child.visited=true;this.visit(child,bds,eqs);if(child.body.type===Body.DYNAMIC){queue.push(child)}}}};IslandManager.prototype.split=function(world){var bodies=world.bodies,nodes=this.nodes,equations=this.equations;while(nodes.length){this.nodePool.release(nodes.pop())}for(var i=0;i!==bodies.length;i++){var node=this.nodePool.get();node.body=bodies[i];nodes.push(node)}for(var k=0;k!==equations.length;k++){var eq=equations[k],i=bodies.indexOf(eq.bodyA),j=bodies.indexOf(eq.bodyB),ni=nodes[i],nj=nodes[j];ni.neighbors.push(nj);nj.neighbors.push(ni);ni.equations.push(eq);nj.equations.push(eq)}var islands=this.islands;for(var i=0;i<islands.length;i++){this.islandPool.release(islands[i])}islands.length=0;var child;while(child=IslandManager.getUnvisitedNode(nodes)){var island=this.islandPool.get();this.bfs(child,island.bodies,island.equations);islands.push(island)}return islands}},{"../math/vec2":30,"../objects/Body":31,"./../utils/IslandNodePool":50,"./../utils/IslandPool":51,"./Island":58,"./IslandNode":60}],60:[function(_dereq_,module,exports){module.exports=IslandNode;function IslandNode(body){this.body=body;this.neighbors=[];this.equations=[];this.visited=false}IslandNode.prototype.reset=function(){this.equations.length=0;this.neighbors.length=0;this.visited=false;this.body=null}},{}],61:[function(_dereq_,module,exports){var GSSolver=_dereq_("../solver/GSSolver"),Solver=_dereq_("../solver/Solver"),Ray=_dereq_("../collision/Ray"),vec2=_dereq_("../math/vec2"),Circle=_dereq_("../shapes/Circle"),Convex=_dereq_("../shapes/Convex"),Line=_dereq_("../shapes/Line"),Plane=_dereq_("../shapes/Plane"),Capsule=_dereq_("../shapes/Capsule"),Particle=_dereq_("../shapes/Particle"),EventEmitter=_dereq_("../events/EventEmitter"),Body=_dereq_("../objects/Body"),Shape=_dereq_("../shapes/Shape"),LinearSpring=_dereq_("../objects/LinearSpring"),Material=_dereq_("../material/Material"),ContactMaterial=_dereq_("../material/ContactMaterial"),DistanceConstraint=_dereq_("../constraints/DistanceConstraint"),Constraint=_dereq_("../constraints/Constraint"),LockConstraint=_dereq_("../constraints/LockConstraint"),RevoluteConstraint=_dereq_("../constraints/RevoluteConstraint"),PrismaticConstraint=_dereq_("../constraints/PrismaticConstraint"),GearConstraint=_dereq_("../constraints/GearConstraint"),pkg=_dereq_("../../package.json"),Broadphase=_dereq_("../collision/Broadphase"),AABB=_dereq_("../collision/AABB"),SAPBroadphase=_dereq_("../collision/SAPBroadphase"),Narrowphase=_dereq_("../collision/Narrowphase"),Utils=_dereq_("../utils/Utils"),OverlapKeeper=_dereq_("../utils/OverlapKeeper"),IslandManager=_dereq_("./IslandManager"),RotationalSpring=_dereq_("../objects/RotationalSpring");module.exports=World;function World(options){EventEmitter.apply(this);options=options||{};this.springs=[];this.bodies=[];this.disabledBodyCollisionPairs=[];this.solver=options.solver||new GSSolver;this.narrowphase=new Narrowphase(this);this.islandManager=new IslandManager;this.gravity=vec2.fromValues(0,-9.78);if(options.gravity){vec2.copy(this.gravity,options.gravity)}this.frictionGravity=vec2.length(this.gravity)||10;this.useWorldGravityAsFrictionGravity=true;this.useFrictionGravityOnZeroGravity=true;this.broadphase=options.broadphase||new SAPBroadphase;this.broadphase.setWorld(this);this.constraints=[];this.defaultMaterial=new Material;this.defaultContactMaterial=new ContactMaterial(this.defaultMaterial,this.defaultMaterial);this.lastTimeStep=1/60;this.applySpringForces=true;this.applyDamping=true;this.applyGravity=true;this.solveConstraints=true;this.contactMaterials=[];this.time=0;this.accumulator=0;this.stepping=false;this.bodiesToBeRemoved=[];this.islandSplit=typeof options.islandSplit!=="undefined"?!!options.islandSplit:true;this.emitImpactEvent=true;this._constraintIdCounter=0;this._bodyIdCounter=0;this.postStepEvent={type:"postStep"};this.addBodyEvent={type:"addBody",body:null};this.removeBodyEvent={type:"removeBody",body:null};this.addSpringEvent={type:"addSpring",spring:null};this.impactEvent={type:"impact",bodyA:null,bodyB:null,shapeA:null,shapeB:null,contactEquation:null};this.postBroadphaseEvent={type:"postBroadphase",pairs:null};this.sleepMode=World.NO_SLEEPING;this.beginContactEvent={type:"beginContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null,contactEquations:[]};this.endContactEvent={type:"endContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null};this.preSolveEvent={type:"preSolve",contactEquations:null,frictionEquations:null};this.overlappingShapesLastState={keys:[]};this.overlappingShapesCurrentState={keys:[]};this.overlapKeeper=new OverlapKeeper}World.prototype=new Object(EventEmitter.prototype);World.prototype.constructor=World;World.NO_SLEEPING=1;World.BODY_SLEEPING=2;World.ISLAND_SLEEPING=4;World.prototype.addConstraint=function(constraint){this.constraints.push(constraint)};World.prototype.addContactMaterial=function(contactMaterial){this.contactMaterials.push(contactMaterial)};World.prototype.removeContactMaterial=function(cm){var idx=this.contactMaterials.indexOf(cm);if(idx!==-1){Utils.splice(this.contactMaterials,idx,1)}};World.prototype.getContactMaterial=function(materialA,materialB){var cmats=this.contactMaterials;for(var i=0,N=cmats.length;i!==N;i++){var cm=cmats[i];if(cm.materialA.id===materialA.id&&cm.materialB.id===materialB.id||cm.materialA.id===materialB.id&&cm.materialB.id===materialA.id){return cm}}return false};World.prototype.removeConstraint=function(constraint){var idx=this.constraints.indexOf(constraint);if(idx!==-1){Utils.splice(this.constraints,idx,1)}};var step_r=vec2.create(),step_runit=vec2.create(),step_u=vec2.create(),step_f=vec2.create(),step_fhMinv=vec2.create(),step_velodt=vec2.create(),step_mg=vec2.create(),xiw=vec2.fromValues(0,0),xjw=vec2.fromValues(0,0),zero=vec2.fromValues(0,0),interpvelo=vec2.fromValues(0,0);World.prototype.step=function(dt,timeSinceLastCalled,maxSubSteps){maxSubSteps=maxSubSteps||10;timeSinceLastCalled=timeSinceLastCalled||0;if(timeSinceLastCalled===0){this.internalStep(dt);this.time+=dt}else{this.accumulator+=timeSinceLastCalled;var substeps=0;while(this.accumulator>=dt&&substeps<maxSubSteps){this.internalStep(dt);this.time+=dt;this.accumulator-=dt;substeps++}var t=this.accumulator%dt/dt;for(var j=0;j!==this.bodies.length;j++){var b=this.bodies[j];vec2.lerp(b.interpolatedPosition,b.previousPosition,b.position,t);b.interpolatedAngle=b.previousAngle+t*(b.angle-b.previousAngle)}}};var endOverlaps=[];World.prototype.internalStep=function(dt){this.stepping=true;var that=this,Nsprings=this.springs.length,springs=this.springs,bodies=this.bodies,g=this.gravity,solver=this.solver,Nbodies=this.bodies.length,broadphase=this.broadphase,np=this.narrowphase,constraints=this.constraints,t0,t1,fhMinv=step_fhMinv,velodt=step_velodt,mg=step_mg,scale=vec2.scale,add=vec2.add,rotate=vec2.rotate,islandManager=this.islandManager;this.overlapKeeper.tick();this.lastTimeStep=dt;if(this.useWorldGravityAsFrictionGravity){var gravityLen=vec2.length(this.gravity);if(!(gravityLen===0&&this.useFrictionGravityOnZeroGravity)){this.frictionGravity=gravityLen}}if(this.applyGravity){for(var i=0;i!==Nbodies;i++){var b=bodies[i],fi=b.force;if(b.type!==Body.DYNAMIC||b.sleepState===Body.SLEEPING){continue}vec2.scale(mg,g,b.mass*b.gravityScale);add(fi,fi,mg)}}if(this.applySpringForces){for(var i=0;i!==Nsprings;i++){var s=springs[i];s.applyForce()}}if(this.applyDamping){for(var i=0;i!==Nbodies;i++){var b=bodies[i];if(b.type===Body.DYNAMIC){b.applyDamping(dt)}}}var result=broadphase.getCollisionPairs(this);var ignoredPairs=this.disabledBodyCollisionPairs;for(var i=ignoredPairs.length-2;i>=0;i-=2){for(var j=result.length-2;j>=0;j-=2){if(ignoredPairs[i]===result[j]&&ignoredPairs[i+1]===result[j+1]||ignoredPairs[i+1]===result[j]&&ignoredPairs[i]===result[j+1]){result.splice(j,2)}}}var Nconstraints=constraints.length;for(i=0;i!==Nconstraints;i++){var c=constraints[i];if(!c.collideConnected){for(var j=result.length-2;j>=0;j-=2){if(c.bodyA===result[j]&&c.bodyB===result[j+1]||c.bodyB===result[j]&&c.bodyA===result[j+1]){result.splice(j,2)}}}}this.postBroadphaseEvent.pairs=result;this.emit(this.postBroadphaseEvent);this.postBroadphaseEvent.pairs=null;np.reset(this);for(var i=0,Nresults=result.length;i!==Nresults;i+=2){var bi=result[i],bj=result[i+1];for(var k=0,Nshapesi=bi.shapes.length;k!==Nshapesi;k++){var si=bi.shapes[k],xi=si.position,ai=si.angle;for(var l=0,Nshapesj=bj.shapes.length;l!==Nshapesj;l++){var sj=bj.shapes[l],xj=sj.position,aj=sj.angle;var cm=this.defaultContactMaterial;if(si.material&&sj.material){var tmp=this.getContactMaterial(si.material,sj.material);if(tmp){cm=tmp}}this.runNarrowphase(np,bi,si,xi,ai,bj,sj,xj,aj,cm,this.frictionGravity)}}}for(var i=0;i!==Nbodies;i++){var body=bodies[i];if(body._wakeUpAfterNarrowphase){body.wakeUp();body._wakeUpAfterNarrowphase=false}}if(this.has("endContact")){this.overlapKeeper.getEndOverlaps(endOverlaps);var e=this.endContactEvent;var l=endOverlaps.length;while(l--){var data=endOverlaps[l];e.shapeA=data.shapeA;e.shapeB=data.shapeB;e.bodyA=data.bodyA;e.bodyB=data.bodyB;this.emit(e)}endOverlaps.length=0}var preSolveEvent=this.preSolveEvent;preSolveEvent.contactEquations=np.contactEquations;preSolveEvent.frictionEquations=np.frictionEquations;this.emit(preSolveEvent);preSolveEvent.contactEquations=preSolveEvent.frictionEquations=null;var Nconstraints=constraints.length;for(i=0;i!==Nconstraints;i++){constraints[i].update()}if(np.contactEquations.length||np.frictionEquations.length||Nconstraints){if(this.islandSplit){islandManager.equations.length=0;Utils.appendArray(islandManager.equations,np.contactEquations);Utils.appendArray(islandManager.equations,np.frictionEquations);for(i=0;i!==Nconstraints;i++){Utils.appendArray(islandManager.equations,constraints[i].equations)}islandManager.split(this);for(var i=0;i!==islandManager.islands.length;i++){var island=islandManager.islands[i];if(island.equations.length){solver.solveIsland(dt,island)}}}else{solver.addEquations(np.contactEquations);solver.addEquations(np.frictionEquations);for(i=0;i!==Nconstraints;i++){solver.addEquations(constraints[i].equations)}if(this.solveConstraints){solver.solve(dt,this)}solver.removeAllEquations()}}for(var i=0;i!==Nbodies;i++){var body=bodies[i];body.integrate(dt)}for(var i=0;i!==Nbodies;i++){bodies[i].setZeroForce()}if(this.emitImpactEvent&&this.has("impact")){var ev=this.impactEvent;for(var i=0;i!==np.contactEquations.length;i++){var eq=np.contactEquations[i];if(eq.firstImpact){ev.bodyA=eq.bodyA;ev.bodyB=eq.bodyB;ev.shapeA=eq.shapeA;ev.shapeB=eq.shapeB;ev.contactEquation=eq;this.emit(ev)}}}if(this.sleepMode===World.BODY_SLEEPING){for(i=0;i!==Nbodies;i++){bodies[i].sleepTick(this.time,false,dt)}}else if(this.sleepMode===World.ISLAND_SLEEPING&&this.islandSplit){for(i=0;i!==Nbodies;i++){bodies[i].sleepTick(this.time,true,dt)}for(var i=0;i<this.islandManager.islands.length;i++){var island=this.islandManager.islands[i];if(island.wantsToSleep()){island.sleep()}}}this.stepping=false;var bodiesToBeRemoved=this.bodiesToBeRemoved;for(var i=0;i!==bodiesToBeRemoved.length;i++){this.removeBody(bodiesToBeRemoved[i])}bodiesToBeRemoved.length=0;this.emit(this.postStepEvent)};World.prototype.runNarrowphase=function(np,bi,si,xi,ai,bj,sj,xj,aj,cm,glen){if(!((si.collisionGroup&sj.collisionMask)!==0&&(sj.collisionGroup&si.collisionMask)!==0)){return}vec2.rotate(xiw,xi,bi.angle);vec2.rotate(xjw,xj,bj.angle);vec2.add(xiw,xiw,bi.position);vec2.add(xjw,xjw,bj.position);var aiw=ai+bi.angle;var ajw=aj+bj.angle;np.enableFriction=cm.friction>0;np.frictionCoefficient=cm.friction;var reducedMass;if(bi.type===Body.STATIC||bi.type===Body.KINEMATIC){reducedMass=bj.mass}else if(bj.type===Body.STATIC||bj.type===Body.KINEMATIC){reducedMass=bi.mass}else{reducedMass=bi.mass*bj.mass/(bi.mass+bj.mass)}np.slipForce=cm.friction*glen*reducedMass;np.restitution=cm.restitution;np.surfaceVelocity=cm.surfaceVelocity;np.frictionStiffness=cm.frictionStiffness;np.frictionRelaxation=cm.frictionRelaxation;np.stiffness=cm.stiffness;np.relaxation=cm.relaxation;np.contactSkinSize=cm.contactSkinSize;np.enabledEquations=bi.collisionResponse&&bj.collisionResponse&&si.collisionResponse&&sj.collisionResponse;var resolver=np[si.type|sj.type],numContacts=0;if(resolver){var sensor=si.sensor||sj.sensor;var numFrictionBefore=np.frictionEquations.length;if(si.type<sj.type){numContacts=resolver.call(np,bi,si,xiw,aiw,bj,sj,xjw,ajw,sensor)}else{numContacts=resolver.call(np,bj,sj,xjw,ajw,bi,si,xiw,aiw,sensor)}var numFrictionEquations=np.frictionEquations.length-numFrictionBefore;if(numContacts){if(bi.allowSleep&&bi.type===Body.DYNAMIC&&bi.sleepState===Body.SLEEPING&&bj.sleepState===Body.AWAKE&&bj.type!==Body.STATIC){var speedSquaredB=vec2.squaredLength(bj.velocity)+Math.pow(bj.angularVelocity,2);var speedLimitSquaredB=Math.pow(bj.sleepSpeedLimit,2);if(speedSquaredB>=speedLimitSquaredB*2){bi._wakeUpAfterNarrowphase=true}}if(bj.allowSleep&&bj.type===Body.DYNAMIC&&bj.sleepState===Body.SLEEPING&&bi.sleepState===Body.AWAKE&&bi.type!==Body.STATIC){var speedSquaredA=vec2.squaredLength(bi.velocity)+Math.pow(bi.angularVelocity,2);var speedLimitSquaredA=Math.pow(bi.sleepSpeedLimit,2);if(speedSquaredA>=speedLimitSquaredA*2){bj._wakeUpAfterNarrowphase=true}}this.overlapKeeper.setOverlapping(bi,si,bj,sj);if(this.has("beginContact")&&this.overlapKeeper.isNewOverlap(si,sj)){var e=this.beginContactEvent;e.shapeA=si;e.shapeB=sj;e.bodyA=bi;e.bodyB=bj;e.contactEquations.length=0;if(typeof numContacts==="number"){for(var i=np.contactEquations.length-numContacts;i<np.contactEquations.length;i++){e.contactEquations.push(np.contactEquations[i])}}this.emit(e)}if(typeof numContacts==="number"&&numFrictionEquations>1){for(var i=np.frictionEquations.length-numFrictionEquations;i<np.frictionEquations.length;i++){var f=np.frictionEquations[i];f.setSlipForce(f.getSlipForce()/numFrictionEquations)}}}}};World.prototype.addSpring=function(spring){this.springs.push(spring);var evt=this.addSpringEvent;evt.spring=spring;this.emit(evt);evt.spring=null};World.prototype.removeSpring=function(spring){var idx=this.springs.indexOf(spring);if(idx!==-1){Utils.splice(this.springs,idx,1)}};World.prototype.addBody=function(body){if(this.bodies.indexOf(body)===-1){this.bodies.push(body);body.world=this;var evt=this.addBodyEvent;evt.body=body;this.emit(evt);evt.body=null}};World.prototype.removeBody=function(body){if(this.stepping){this.bodiesToBeRemoved.push(body)}else{body.world=null;var idx=this.bodies.indexOf(body);if(idx!==-1){Utils.splice(this.bodies,idx,1);this.removeBodyEvent.body=body;body.resetConstraintVelocity();this.emit(this.removeBodyEvent);this.removeBodyEvent.body=null}}};World.prototype.getBodyById=function(id){var bodies=this.bodies;for(var i=0;i<bodies.length;i++){var b=bodies[i];if(b.id===id){return b}}return false};World.prototype.disableBodyCollision=function(bodyA,bodyB){this.disabledBodyCollisionPairs.push(bodyA,bodyB)};World.prototype.enableBodyCollision=function(bodyA,bodyB){var pairs=this.disabledBodyCollisionPairs;for(var i=0;i<pairs.length;i+=2){if(pairs[i]===bodyA&&pairs[i+1]===bodyB||pairs[i+1]===bodyA&&pairs[i]===bodyB){pairs.splice(i,2);return}}};World.prototype.clear=function(){this.time=0;if(this.solver&&this.solver.equations.length){this.solver.removeAllEquations()}var cs=this.constraints;for(var i=cs.length-1;i>=0;i--){this.removeConstraint(cs[i])}var bodies=this.bodies;for(var i=bodies.length-1;i>=0;i--){this.removeBody(bodies[i])}var springs=this.springs;for(var i=springs.length-1;i>=0;i--){this.removeSpring(springs[i])}var cms=this.contactMaterials;for(var i=cms.length-1;i>=0;i--){this.removeContactMaterial(cms[i])}World.apply(this)};var hitTest_tmp1=vec2.create(),hitTest_zero=vec2.fromValues(0,0),hitTest_tmp2=vec2.fromValues(0,0);World.prototype.hitTest=function(worldPoint,bodies,precision){precision=precision||0;var pb=new Body({position:worldPoint}),ps=new Particle,px=worldPoint,pa=0,x=hitTest_tmp1,zero=hitTest_zero,tmp=hitTest_tmp2;pb.addShape(ps);var n=this.narrowphase,result=[];for(var i=0,N=bodies.length;i!==N;i++){var b=bodies[i];for(var j=0,NS=b.shapes.length;j!==NS;j++){var s=b.shapes[j];vec2.rotate(x,s.position,b.angle);vec2.add(x,x,b.position);var a=s.angle+b.angle;if(s instanceof Circle&&n.circleParticle(b,s,x,a,pb,ps,px,pa,true)||s instanceof Convex&&n.particleConvex(pb,ps,px,pa,b,s,x,a,true)||s instanceof Plane&&n.particlePlane(pb,ps,px,pa,b,s,x,a,true)||s instanceof Capsule&&n.particleCapsule(pb,ps,px,pa,b,s,x,a,true)||s instanceof Particle&&vec2.squaredLength(vec2.sub(tmp,x,worldPoint))<precision*precision){result.push(b)}}}return result};World.prototype.setGlobalStiffness=function(stiffness){var constraints=this.constraints;for(var i=0;i!==constraints.length;i++){var c=constraints[i];for(var j=0;j!==c.equations.length;j++){var eq=c.equations[j];eq.stiffness=stiffness;eq.needsUpdate=true}}var contactMaterials=this.contactMaterials;for(var i=0;i!==contactMaterials.length;i++){var c=contactMaterials[i];c.stiffness=c.frictionStiffness=stiffness}var c=this.defaultContactMaterial;c.stiffness=c.frictionStiffness=stiffness};World.prototype.setGlobalRelaxation=function(relaxation){for(var i=0;i!==this.constraints.length;i++){var c=this.constraints[i];for(var j=0;j!==c.equations.length;j++){var eq=c.equations[j];eq.relaxation=relaxation;eq.needsUpdate=true}}for(var i=0;i!==this.contactMaterials.length;i++){var c=this.contactMaterials[i];c.relaxation=c.frictionRelaxation=relaxation}var c=this.defaultContactMaterial;c.relaxation=c.frictionRelaxation=relaxation};var tmpAABB=new AABB;var tmpArray=[];World.prototype.raycast=function(result,ray){ray.getAABB(tmpAABB);this.broadphase.aabbQuery(this,tmpAABB,tmpArray);ray.intersectBodies(result,tmpArray);tmpArray.length=0;return result.hasHit()}},{"../../package.json":6,"../collision/AABB":7,"../collision/Broadphase":8,"../collision/Narrowphase":10,"../collision/Ray":11,"../collision/SAPBroadphase":13,"../constraints/Constraint":14,"../constraints/DistanceConstraint":15,"../constraints/GearConstraint":16,"../constraints/LockConstraint":17,"../constraints/PrismaticConstraint":18,"../constraints/RevoluteConstraint":19,"../events/EventEmitter":26,"../material/ContactMaterial":27,"../material/Material":28,"../math/vec2":30,"../objects/Body":31,"../objects/LinearSpring":32,"../objects/RotationalSpring":33,"../shapes/Capsule":38,"../shapes/Circle":39,"../shapes/Convex":40,"../shapes/Line":42,"../shapes/Particle":43,"../shapes/Plane":44,"../shapes/Shape":45,"../solver/GSSolver":46,"../solver/Solver":47,"../utils/OverlapKeeper":52,"../utils/Utils":57,"./IslandManager":59}]},{},[36])(36)});if(typeof CC==="undefined"){var CC={dummy:"dummy"};CC.isMobile=navigator.userAgent.match(/BlackBerry|IEMobile|Windows Phone|Android|iPad|iPhone|Silk|iPod|Kindle|Nexus/i)!==null}CC.isNexus=navigator.userAgent.match(/Nexus/i)!==null;CC.isKindle=navigator.userAgent.match(/Silk|Kindle/i)!==null;
CC.isNotIOS=navigator.userAgent.match(/iPhone|iPod|iPad/i)===null;CC.isBookTrust=navigator.userAgent.match(/Android/i)!==null&&navigator.userAgent.match(/Chrome/i)!==null;CC.Sound=function(audioData){CC.Sound._setUpCCSound();this._url=CC.Sound._findValidUrl(audioData.urls||audioData.src);if(audioData.sprite!==undefined){this._sprites=audioData.sprite}if(audioData.sprites!==undefined){this._sprites=audioData.sprites}this._sprite=this._sprites;this._src=this._url;if(audioData.milliseconds){for(var key in this._sprites){this._sprites[key][0]*=.001;this._sprites[key][1]*=.001}}if(audioData.endTimes){for(var key in this._sprites){this._sprites[key][1]-=this._sprites[key][0]}}if(audioData.looping!==undefined){this._looping=audioData.looping}if(audioData.autoPlay!==undefined){this._autoPlay=audioData.autoPlay}this.callBackCalled=false;this.soundLoadedCallback=function(){if(window.soundLoaded){window.soundLoaded()}};if(CC.Sound._GLOBAL_IS_WEB_AUDIO_SUPPORTED){this._preLoadWebAudio(this._url)}else{var self=this;this._audioHtml=new Audio(this._url);this._audioHtml.addEventListener("loadstart",function(){},false);this._audioHtml.addEventListener("durationchange",function(){},false);this._audioHtml.addEventListener("loadedmetadata",function(){},false);this._audioHtml.addEventListener("loadeddata",function(){},false);this._audioHtml.addEventListener("progress",function(){},false);this._audioHtml.addEventListener("canplay",function(){},false);this._audioHtml.addEventListener("canplaythrough",function(){if(!self.callBackCalled){self.soundLoadedCallback()}self.callBackCalled=true;self._loaded=true;self._onload()},false);this._audioHtml.addEventListener("error",function(){},false);setInterval(function(){if(self._currentSprite!==null&&self._currentSprite!=="default"){self._intervals++;var currentTime=Number(self._audioHtml.currentTime);if(currentTime<Number(self._currentSprite[0]-1)){self._audioHtml.currentTime=self._currentSprite[0]}if(currentTime>self._currentSprite[0]+self._currentSprite[1]){self.stop()}}else{self.stop()}},100);if(navigator.userAgent.match(/(iPhone|iPod|iPad|Silk|Kindle)/i)!==null){if(!self.callBackCalled){self.soundLoadedCallback();self.callBackCalled=true}var touchEvent=function(event){var reloadInverval=setInterval(function(){if(isNaN(self._audioHtml.duration)){self._audioHtml.load()}else{clearInterval(reloadInverval)}},3e3);event.preventDefault();self._audioHtml.play();self._touched=true;self._currentSprite=[0,3];window.removeEventListener("touchstart",touchEvent,false)};window.addEventListener("touchstart",touchEvent,false);self._primed=true}else{if(!CC.isKindle){this._audioHtml.load()}}}};CC.Sound._GLOBAL_AUDIO_CONTEXT="unassigned";CC.Sound._GLOBAL_MIME_TYPE="unassigned";CC.Sound._GLOBAL_EXSTENTIONS=[];CC.Sound._GLOBAL_IS_WEB_AUDIO_SUPPORTED=false;CC.Sound._GLOBAL_SOUND_IS_NOT_SET_UP=true;CC.Sound.exstentionsTypePairs=[{ext:".m4a",mime:"audio/mp4"},{ext:".mp4",mime:"audio/mp4"},{ext:".aac",mime:"audio/aac"},{ext:".ogg",mime:"audio/ogg"},{ext:".mp3",mime:"audio/mpeg"}];CC.Sound.readyState=["HAVE_NOTHING","HAVE_METADATA","HAVE_CURRENT_DATA","HAVE_FUTURE_DATA","HAVE_ENOUGH_DATA"];CC.Sound._findValidUrl=function(urls){var returnUrl=urls[0];for(var i=urls.length-1;i>=0;--i){var currentUrl=urls[i];var exstention=currentUrl.substring(currentUrl.length-4,currentUrl.length);for(var j=0;j<CC.Sound._GLOBAL_EXSTENTIONS.length;++j){if(exstention===CC.Sound._GLOBAL_EXSTENTIONS[j]){returnUrl=currentUrl}}}return returnUrl};CC.Sound.prototype={_webAudioEnabled:false,_isMute:false,_isFocused:true,_url:"unassigned",_isHot:false,_isPlaying:false,_looping:false,_autoPlay:false,_isStopped:true,_isPaused:true,_loaded:false,_isBuffering:false,_audioHtml:null,_currentSprite:null,_queuedSprite:[0,2],_audioWebApi:null,_activeSoundSources:[],_sprites:null,_spritesPlaying:{},_intervals:0,play:function(spriteString,priority,noDuplicate,loop){if(priority||!!CC.Sound._GLOBAL_IS_WEB_AUDIO_SUPPORTED){if(!this._sprites[spriteString]){}var playDuplicate=true;if(CC.Sound._GLOBAL_IS_WEB_AUDIO_SUPPORTED){if(this._sprites!==null&&this._sprites[spriteString]!==undefined&&!this._spritesPlaying[spriteString]){playDuplicate=!(noDuplicate&&!!this._spritesPlaying[spriteString])}}if(this._loaded&&!this._isMute&&this._isFocused&&playDuplicate&&this._sprites[spriteString]!==undefined){var startSeconds=0;var durationSeconds=-1;this._loopMode=!!loop;if(this._sprites!==null&&this._sprites[spriteString]!==undefined){startSeconds=this._sprites[spriteString][0];durationSeconds=this._sprites[spriteString][1]}if(CC.Sound._GLOBAL_IS_WEB_AUDIO_SUPPORTED){var source=CC.Sound._GLOBAL_AUDIO_CONTEXT.createBufferSource();source.buffer=this._audioWebApi;source.connect(CC.Sound._GLOBAL_AUDIO_CONTEXT.destination);source.soundName=spriteString;this._spritesPlaying[spriteString]=true;this._activeSoundSources.push(source);var self=this;source.onended=function(value){var targetSrc=value.target;for(var i=0;i<self._activeSoundSources.length;++i){if(targetSrc===self._activeSoundSources[i]){self.onComplete(targetSrc.soundName);self._spritesPlaying[targetSrc.soundName]=false;self._activeSoundSources.splice(i,1)}}};if(source.start){source.start(0,startSeconds,durationSeconds)}else{source.noteGrainOn(0,startSeconds,durationSeconds)}}else{this._currentSprite="NO_SPRITE";if(this._sprites!==undefined&&this._sprites[spriteString]!==undefined){this._currentSprite=this._sprites[spriteString]}this._audioHtml.currentTime=this._currentSprite[0];this._audioHtml.play()}}return this._sprites[spriteString]}},onComplete:function(){},reload:function(){if(!CC.Sound._GLOBAL_IS_WEB_AUDIO_SUPPORTED){this._audioHtml.load()}},focus:function(){if(!this._isFocused){this._isFocused=true}},blur:function(){if(this._isFocused){this._isFocused=false;this.stop()}},unmute:function(){if(this._isMute){this._isMute=false}},mute:function(){if(!this._isMute){this._isMute=true;this.stop()}},_onloadCalled:false,_onload:function(){this._onloadCalled=true;var that=this;setTimeout(function(){that.onload()},1e3)},onload:function(){},pos:function(){var returnPos=-1;if(CC.Sound._GLOBAL_IS_WEB_AUDIO_SUPPORTED){returnPos=-2;returnPos=0}else{returnPos=-3;returnPos=this._audioHtml.currentTime}return returnPos},stop:function(){this._loopMode=false;var self=this;if(this._loaded){if(CC.Sound._GLOBAL_IS_WEB_AUDIO_SUPPORTED){var length=this._activeSoundSources.length;for(var i=0;i<length;++i){var currentSource=this._activeSoundSources.pop();if(currentSource.stop){try{currentSource.stop(0)}catch(err){}}else{currentSource.noteOff(0)}}}else{this._audioHtml.pause();self._currentSprite=null}}},pause:function(){if(this._loaded){if(CC.Sound._GLOBAL_IS_WEB_AUDIO_SUPPORTED){}else{this._audioHtml.pause()}}},_preLoadWebAudio:function(url){var request=new XMLHttpRequest;request.open("GET",url,true);request.responseType="arraybuffer";var self=this;request.onload=function(){CC.Sound._GLOBAL_AUDIO_CONTEXT.decodeAudioData(request.response,function(buffer){self._audioWebApi=buffer;if(navigator.userAgent.match(/(iPhone|iPod|iPad|Silk|Kindle)/)!==null){if(!self.callBackCalled){self.soundLoadedCallback();self.callBackCalled=true}var touchEvent=function(){var source=CC.Sound._GLOBAL_AUDIO_CONTEXT.createBufferSource();source.buffer=buffer;source.connect(CC.Sound._GLOBAL_AUDIO_CONTEXT.destination);if(source.start){source.start(0,self._queuedSprite[0],self._queuedSprite[1])}else{source.noteGrainOn(0,self._queuedSprite[0],self._queuedSprite[1])}self._loaded=true;self._touched=true;self._onload();window.removeEventListener("touchstart",touchEvent,false)};window.addEventListener("touchstart",touchEvent,false);self._primed=true}else{self._loaded=true;self._onload();if(!self.callBackCalled){self.soundLoadedCallback();self.callBackCalled=true}}},function(){})};request.send()}};CC.Sound._setUpCCSound=function(){if(CC.Sound._GLOBAL_SOUND_IS_NOT_SET_UP){CC.Sound._GLOBAL_SOUND_IS_NOT_SET_UP=true;CC.Sound._GLOBAL_IS_WEB_AUDIO_SUPPORTED=!!(window.AudioContext||window.webkitAudioContext);if(navigator.userAgent.match(/(iPhone|iPod|iPad|Silk|Kindle)/)===null&&CC.isMobile){}if(CC.isNexus||CC.isKindle){}if(CC.Sound._GLOBAL_IS_WEB_AUDIO_SUPPORTED){window.AudioContext=window.AudioContext||window.webkitAudioContext;CC.Sound._GLOBAL_AUDIO_CONTEXT=new AudioContext}var testAudio=document.createElement("audio");for(var i=0;i<CC.Sound.exstentionsTypePairs.length;++i){var testPair=CC.Sound.exstentionsTypePairs[i];var result=testAudio.canPlayType(testPair.mime);if(result==="probably"){CC.Sound._GLOBAL_EXSTENTIONS.push(testPair.ext)}}if(CC.Sound._GLOBAL_EXSTENTIONS.length===0){for(var i=0;i<CC.Sound.exstentionsTypePairs.length;++i){var testPair=CC.Sound.exstentionsTypePairs[i];var result=testAudio.canPlayType(testPair.mime);if(result==="maybe"){CC.Sound._GLOBAL_EXSTENTIONS.push(testPair.ext)}}}}};(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.PIXI=f()}})(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){(function(process,global){(function(){var async={};function noop(){}function identity(v){return v}function toBool(v){return!!v}function notId(v){return!v}var previous_async;var root=typeof self==="object"&&self.self===self&&self||typeof global==="object"&&global.global===global&&global||this;if(root!=null){previous_async=root.async}async.noConflict=function(){root.async=previous_async;return async};function only_once(fn){return function(){if(fn===null)throw new Error("Callback was already called.");fn.apply(this,arguments);fn=null}}function _once(fn){return function(){if(fn===null)return;fn.apply(this,arguments);fn=null}}var _toString=Object.prototype.toString;var _isArray=Array.isArray||function(obj){return _toString.call(obj)==="[object Array]"};var _isObject=function(obj){var type=typeof obj;return type==="function"||type==="object"&&!!obj};function _isArrayLike(arr){return _isArray(arr)||typeof arr.length==="number"&&arr.length>=0&&arr.length%1===0}function _arrayEach(arr,iterator){var index=-1,length=arr.length;while(++index<length){iterator(arr[index],index,arr)}}function _map(arr,iterator){var index=-1,length=arr.length,result=Array(length);while(++index<length){result[index]=iterator(arr[index],index,arr)}return result}function _range(count){return _map(Array(count),function(v,i){return i})}function _reduce(arr,iterator,memo){_arrayEach(arr,function(x,i,a){memo=iterator(memo,x,i,a)});return memo}function _forEachOf(object,iterator){_arrayEach(_keys(object),function(key){iterator(object[key],key)})}function _indexOf(arr,item){for(var i=0;i<arr.length;i++){if(arr[i]===item)return i}return-1}var _keys=Object.keys||function(obj){var keys=[];for(var k in obj){if(obj.hasOwnProperty(k)){keys.push(k)}}return keys};function _keyIterator(coll){var i=-1;var len;var keys;if(_isArrayLike(coll)){len=coll.length;return function next(){i++;return i<len?i:null}}else{keys=_keys(coll);len=keys.length;return function next(){i++;return i<len?keys[i]:null}}}function _restParam(func,startIndex){startIndex=startIndex==null?func.length-1:+startIndex;return function(){var length=Math.max(arguments.length-startIndex,0);var rest=Array(length);for(var index=0;index<length;index++){rest[index]=arguments[index+startIndex]}switch(startIndex){case 0:return func.call(this,rest);case 1:return func.call(this,arguments[0],rest)}}}function _withoutIndex(iterator){return function(value,index,callback){return iterator(value,callback)}}var _setImmediate=typeof setImmediate==="function"&&setImmediate;var _delay=_setImmediate?function(fn){_setImmediate(fn)}:function(fn){setTimeout(fn,0)};if(typeof process==="object"&&typeof process.nextTick==="function"){async.nextTick=process.nextTick}else{async.nextTick=_delay}async.setImmediate=_setImmediate?_delay:async.nextTick;async.forEach=async.each=function(arr,iterator,callback){return async.eachOf(arr,_withoutIndex(iterator),callback)};async.forEachSeries=async.eachSeries=function(arr,iterator,callback){return async.eachOfSeries(arr,_withoutIndex(iterator),callback)};async.forEachLimit=async.eachLimit=function(arr,limit,iterator,callback){return _eachOfLimit(limit)(arr,_withoutIndex(iterator),callback)};async.forEachOf=async.eachOf=function(object,iterator,callback){callback=_once(callback||noop);object=object||[];var iter=_keyIterator(object);var key,completed=0;while((key=iter())!=null){completed+=1;iterator(object[key],key,only_once(done))}if(completed===0)callback(null);function done(err){completed--;if(err){callback(err)}else if(key===null&&completed<=0){callback(null)}}};async.forEachOfSeries=async.eachOfSeries=function(obj,iterator,callback){callback=_once(callback||noop);obj=obj||[];var nextKey=_keyIterator(obj);var key=nextKey();function iterate(){var sync=true;if(key===null){return callback(null)}iterator(obj[key],key,only_once(function(err){if(err){callback(err)}else{key=nextKey();if(key===null){return callback(null)}else{if(sync){async.setImmediate(iterate)}else{iterate()}}}}));sync=false}iterate()};async.forEachOfLimit=async.eachOfLimit=function(obj,limit,iterator,callback){_eachOfLimit(limit)(obj,iterator,callback)};function _eachOfLimit(limit){return function(obj,iterator,callback){callback=_once(callback||noop);obj=obj||[];var nextKey=_keyIterator(obj);if(limit<=0){return callback(null)}var done=false;var running=0;var errored=false;(function replenish(){if(done&&running<=0){return callback(null)}while(running<limit&&!errored){var key=nextKey();if(key===null){done=true;if(running<=0){callback(null)}return}running+=1;iterator(obj[key],key,only_once(function(err){running-=1;if(err){callback(err);errored=true}else{replenish()}}))}})()}}function doParallel(fn){return function(obj,iterator,callback){return fn(async.eachOf,obj,iterator,callback)}}function doParallelLimit(fn){return function(obj,limit,iterator,callback){return fn(_eachOfLimit(limit),obj,iterator,callback)}}function doSeries(fn){return function(obj,iterator,callback){return fn(async.eachOfSeries,obj,iterator,callback)}}function _asyncMap(eachfn,arr,iterator,callback){callback=_once(callback||noop);arr=arr||[];var results=_isArrayLike(arr)?[]:{};eachfn(arr,function(value,index,callback){iterator(value,function(err,v){results[index]=v;callback(err)})},function(err){callback(err,results)})}async.map=doParallel(_asyncMap);async.mapSeries=doSeries(_asyncMap);async.mapLimit=doParallelLimit(_asyncMap);async.inject=async.foldl=async.reduce=function(arr,memo,iterator,callback){async.eachOfSeries(arr,function(x,i,callback){iterator(memo,x,function(err,v){memo=v;callback(err)})},function(err){callback(err,memo)})};async.foldr=async.reduceRight=function(arr,memo,iterator,callback){var reversed=_map(arr,identity).reverse();async.reduce(reversed,memo,iterator,callback)};async.transform=function(arr,memo,iterator,callback){if(arguments.length===3){callback=iterator;iterator=memo;memo=_isArray(arr)?[]:{}}async.eachOf(arr,function(v,k,cb){iterator(memo,v,k,cb)},function(err){callback(err,memo)})};function _filter(eachfn,arr,iterator,callback){var results=[];eachfn(arr,function(x,index,callback){iterator(x,function(v){if(v){results.push({index:index,value:x})}callback()})},function(){callback(_map(results.sort(function(a,b){return a.index-b.index}),function(x){return x.value}))})}async.select=async.filter=doParallel(_filter);async.selectLimit=async.filterLimit=doParallelLimit(_filter);async.selectSeries=async.filterSeries=doSeries(_filter);function _reject(eachfn,arr,iterator,callback){_filter(eachfn,arr,function(value,cb){iterator(value,function(v){cb(!v)})},callback)}async.reject=doParallel(_reject);async.rejectLimit=doParallelLimit(_reject);async.rejectSeries=doSeries(_reject);function _createTester(eachfn,check,getResult){return function(arr,limit,iterator,cb){function done(){if(cb)cb(getResult(false,void 0))}function iteratee(x,_,callback){if(!cb)return callback();iterator(x,function(v){if(cb&&check(v)){cb(getResult(true,x));cb=iterator=false}callback()})}if(arguments.length>3){eachfn(arr,limit,iteratee,done)}else{cb=iterator;iterator=limit;eachfn(arr,iteratee,done)}}}async.any=async.some=_createTester(async.eachOf,toBool,identity);async.someLimit=_createTester(async.eachOfLimit,toBool,identity);async.all=async.every=_createTester(async.eachOf,notId,notId);async.everyLimit=_createTester(async.eachOfLimit,notId,notId);function _findGetResult(v,x){return x}async.detect=_createTester(async.eachOf,identity,_findGetResult);async.detectSeries=_createTester(async.eachOfSeries,identity,_findGetResult);async.detectLimit=_createTester(async.eachOfLimit,identity,_findGetResult);async.sortBy=function(arr,iterator,callback){async.map(arr,function(x,callback){iterator(x,function(err,criteria){if(err){callback(err)}else{callback(null,{value:x,criteria:criteria})}})},function(err,results){if(err){return callback(err)}else{callback(null,_map(results.sort(comparator),function(x){return x.value}))}});function comparator(left,right){var a=left.criteria,b=right.criteria;return a<b?-1:a>b?1:0}};async.auto=function(tasks,concurrency,callback){if(typeof arguments[1]==="function"){callback=concurrency;concurrency=null}callback=_once(callback||noop);var keys=_keys(tasks);var remainingTasks=keys.length;if(!remainingTasks){return callback(null)}if(!concurrency){concurrency=remainingTasks}var results={};var runningTasks=0;var hasError=false;var listeners=[];function addListener(fn){listeners.unshift(fn)}function removeListener(fn){var idx=_indexOf(listeners,fn);if(idx>=0)listeners.splice(idx,1)}function taskComplete(){remainingTasks--;_arrayEach(listeners.slice(0),function(fn){fn()})}addListener(function(){if(!remainingTasks){callback(null,results)}});_arrayEach(keys,function(k){if(hasError)return;var task=_isArray(tasks[k])?tasks[k]:[tasks[k]];var taskCallback=_restParam(function(err,args){runningTasks--;if(args.length<=1){args=args[0]}if(err){var safeResults={};_forEachOf(results,function(val,rkey){safeResults[rkey]=val});safeResults[k]=args;hasError=true;callback(err,safeResults)}else{results[k]=args;async.setImmediate(taskComplete)}});var requires=task.slice(0,task.length-1);var len=requires.length;var dep;while(len--){if(!(dep=tasks[requires[len]])){throw new Error("Has nonexistent dependency in "+requires.join(", "))}if(_isArray(dep)&&_indexOf(dep,k)>=0){throw new Error("Has cyclic dependencies")}}function ready(){return runningTasks<concurrency&&_reduce(requires,function(a,x){return a&&results.hasOwnProperty(x)},true)&&!results.hasOwnProperty(k)}if(ready()){runningTasks++;task[task.length-1](taskCallback,results)}else{addListener(listener)}function listener(){if(ready()){runningTasks++;removeListener(listener);task[task.length-1](taskCallback,results)}}})};async.retry=function(times,task,callback){var DEFAULT_TIMES=5;var DEFAULT_INTERVAL=0;var attempts=[];var opts={times:DEFAULT_TIMES,interval:DEFAULT_INTERVAL};function parseTimes(acc,t){if(typeof t==="number"){acc.times=parseInt(t,10)||DEFAULT_TIMES}else if(typeof t==="object"){acc.times=parseInt(t.times,10)||DEFAULT_TIMES;acc.interval=parseInt(t.interval,10)||DEFAULT_INTERVAL}else{throw new Error("Unsupported argument type for 'times': "+typeof t)}}var length=arguments.length;if(length<1||length>3){throw new Error("Invalid arguments - must be either (task), (task, callback), (times, task) or (times, task, callback)")}else if(length<=2&&typeof times==="function"){callback=task;task=times}if(typeof times!=="function"){parseTimes(opts,times)}opts.callback=callback;opts.task=task;function wrappedTask(wrappedCallback,wrappedResults){function retryAttempt(task,finalAttempt){return function(seriesCallback){task(function(err,result){seriesCallback(!err||finalAttempt,{err:err,result:result})},wrappedResults)}}function retryInterval(interval){return function(seriesCallback){setTimeout(function(){seriesCallback(null)},interval)}}while(opts.times){var finalAttempt=!(opts.times-=1);attempts.push(retryAttempt(opts.task,finalAttempt));if(!finalAttempt&&opts.interval>0){attempts.push(retryInterval(opts.interval))}}async.series(attempts,function(done,data){data=data[data.length-1];(wrappedCallback||opts.callback)(data.err,data.result)})}return opts.callback?wrappedTask():wrappedTask};async.waterfall=function(tasks,callback){callback=_once(callback||noop);if(!_isArray(tasks)){var err=new Error("First argument to waterfall must be an array of functions");return callback(err)}if(!tasks.length){return callback()}function wrapIterator(iterator){return _restParam(function(err,args){if(err){callback.apply(null,[err].concat(args))}else{var next=iterator.next();if(next){args.push(wrapIterator(next))}else{args.push(callback)}ensureAsync(iterator).apply(null,args)}})}wrapIterator(async.iterator(tasks))()};function _parallel(eachfn,tasks,callback){callback=callback||noop;var results=_isArrayLike(tasks)?[]:{};eachfn(tasks,function(task,key,callback){task(_restParam(function(err,args){if(args.length<=1){args=args[0]}results[key]=args;callback(err)}))},function(err){callback(err,results)})}async.parallel=function(tasks,callback){_parallel(async.eachOf,tasks,callback)};async.parallelLimit=function(tasks,limit,callback){_parallel(_eachOfLimit(limit),tasks,callback)};async.series=function(tasks,callback){_parallel(async.eachOfSeries,tasks,callback)};async.iterator=function(tasks){function makeCallback(index){function fn(){if(tasks.length){tasks[index].apply(null,arguments)}return fn.next()}fn.next=function(){return index<tasks.length-1?makeCallback(index+1):null};return fn}return makeCallback(0)};async.apply=_restParam(function(fn,args){return _restParam(function(callArgs){return fn.apply(null,args.concat(callArgs))})});function _concat(eachfn,arr,fn,callback){var result=[];eachfn(arr,function(x,index,cb){fn(x,function(err,y){result=result.concat(y||[]);cb(err)})},function(err){callback(err,result)})}async.concat=doParallel(_concat);async.concatSeries=doSeries(_concat);async.whilst=function(test,iterator,callback){callback=callback||noop;if(test()){var next=_restParam(function(err,args){if(err){callback(err)}else if(test.apply(this,args)){iterator(next)}else{callback.apply(null,[null].concat(args))}});iterator(next)}else{callback(null)}};async.doWhilst=function(iterator,test,callback){var calls=0;return async.whilst(function(){return++calls<=1||test.apply(this,arguments)},iterator,callback)};async.until=function(test,iterator,callback){return async.whilst(function(){return!test.apply(this,arguments)},iterator,callback)};async.doUntil=function(iterator,test,callback){return async.doWhilst(iterator,function(){return!test.apply(this,arguments)},callback)};async.during=function(test,iterator,callback){callback=callback||noop;var next=_restParam(function(err,args){if(err){callback(err)}else{args.push(check);test.apply(this,args)}});var check=function(err,truth){if(err){callback(err)}else if(truth){iterator(next)}else{callback(null)}};test(check)};async.doDuring=function(iterator,test,callback){var calls=0;async.during(function(next){if(calls++<1){next(null,true)}else{test.apply(this,arguments)}},iterator,callback)};function _queue(worker,concurrency,payload){if(concurrency==null){concurrency=1}else if(concurrency===0){throw new Error("Concurrency must not be zero")}function _insert(q,data,pos,callback){if(callback!=null&&typeof callback!=="function"){throw new Error("task callback must be a function")}q.started=true;if(!_isArray(data)){data=[data]}if(data.length===0&&q.idle()){return async.setImmediate(function(){q.drain()})}_arrayEach(data,function(task){var item={data:task,callback:callback||noop};if(pos){q.tasks.unshift(item)}else{q.tasks.push(item)}if(q.tasks.length===q.concurrency){q.saturated()}});async.setImmediate(q.process)}function _next(q,tasks){return function(){workers-=1;var removed=false;var args=arguments;_arrayEach(tasks,function(task){_arrayEach(workersList,function(worker,index){if(worker===task&&!removed){workersList.splice(index,1);removed=true}});task.callback.apply(task,args)});if(q.tasks.length+workers===0){q.drain()}q.process()}}var workers=0;var workersList=[];var q={tasks:[],concurrency:concurrency,payload:payload,saturated:noop,empty:noop,drain:noop,started:false,paused:false,push:function(data,callback){_insert(q,data,false,callback)},kill:function(){q.drain=noop;q.tasks=[]},unshift:function(data,callback){_insert(q,data,true,callback)},process:function(){while(!q.paused&&workers<q.concurrency&&q.tasks.length){var tasks=q.payload?q.tasks.splice(0,q.payload):q.tasks.splice(0,q.tasks.length);var data=_map(tasks,function(task){return task.data});if(q.tasks.length===0){q.empty()}workers+=1;workersList.push(tasks[0]);var cb=only_once(_next(q,tasks));worker(data,cb)}},length:function(){return q.tasks.length},running:function(){return workers},workersList:function(){return workersList},idle:function(){return q.tasks.length+workers===0},pause:function(){q.paused=true},resume:function(){if(q.paused===false){return}q.paused=false;var resumeCount=Math.min(q.concurrency,q.tasks.length);for(var w=1;w<=resumeCount;w++){async.setImmediate(q.process)}}};return q}async.queue=function(worker,concurrency){var q=_queue(function(items,cb){worker(items[0],cb)},concurrency,1);return q};async.priorityQueue=function(worker,concurrency){function _compareTasks(a,b){return a.priority-b.priority}function _binarySearch(sequence,item,compare){var beg=-1,end=sequence.length-1;while(beg<end){var mid=beg+(end-beg+1>>>1);if(compare(item,sequence[mid])>=0){beg=mid}else{end=mid-1}}return beg}function _insert(q,data,priority,callback){if(callback!=null&&typeof callback!=="function"){throw new Error("task callback must be a function")}q.started=true;if(!_isArray(data)){data=[data]}if(data.length===0){return async.setImmediate(function(){q.drain()})}_arrayEach(data,function(task){var item={data:task,priority:priority,callback:typeof callback==="function"?callback:noop};q.tasks.splice(_binarySearch(q.tasks,item,_compareTasks)+1,0,item);if(q.tasks.length===q.concurrency){q.saturated()}async.setImmediate(q.process)})}var q=async.queue(worker,concurrency);q.push=function(data,priority,callback){_insert(q,data,priority,callback)};delete q.unshift;return q};async.cargo=function(worker,payload){return _queue(worker,1,payload)};function _console_fn(name){return _restParam(function(fn,args){fn.apply(null,args.concat([_restParam(function(err,args){if(typeof console==="object"){if(err){if(console.error){console.error(err)}}else if(console[name]){_arrayEach(args,function(x){console[name](x)})}}})]))})}async.log=_console_fn("log");async.dir=_console_fn("dir");async.memoize=function(fn,hasher){var memo={};var queues={};var has=Object.prototype.hasOwnProperty;hasher=hasher||identity;var memoized=_restParam(function memoized(args){var callback=args.pop();var key=hasher.apply(null,args);if(has.call(memo,key)){async.setImmediate(function(){callback.apply(null,memo[key])})}else if(has.call(queues,key)){queues[key].push(callback)}else{queues[key]=[callback];fn.apply(null,args.concat([_restParam(function(args){memo[key]=args;var q=queues[key];delete queues[key];for(var i=0,l=q.length;i<l;i++){q[i].apply(null,args)}})]))}});memoized.memo=memo;memoized.unmemoized=fn;return memoized};async.unmemoize=function(fn){return function(){return(fn.unmemoized||fn).apply(null,arguments)}};function _times(mapper){return function(count,iterator,callback){mapper(_range(count),iterator,callback)}}async.times=_times(async.map);async.timesSeries=_times(async.mapSeries);async.timesLimit=function(count,limit,iterator,callback){return async.mapLimit(_range(count),limit,iterator,callback)};async.seq=function(){var fns=arguments;return _restParam(function(args){var that=this;var callback=args[args.length-1];if(typeof callback=="function"){args.pop()}else{callback=noop}async.reduce(fns,args,function(newargs,fn,cb){fn.apply(that,newargs.concat([_restParam(function(err,nextargs){cb(err,nextargs)})]))},function(err,results){callback.apply(that,[err].concat(results))})})};async.compose=function(){return async.seq.apply(null,Array.prototype.reverse.call(arguments))};function _applyEach(eachfn){return _restParam(function(fns,args){var go=_restParam(function(args){var that=this;var callback=args.pop();return eachfn(fns,function(fn,_,cb){fn.apply(that,args.concat([cb]))},callback)});if(args.length){return go.apply(this,args)}else{return go}})}async.applyEach=_applyEach(async.eachOf);async.applyEachSeries=_applyEach(async.eachOfSeries);async.forever=function(fn,callback){var done=only_once(callback||noop);var task=ensureAsync(fn);function next(err){if(err){return done(err)}task(next)}next()};function ensureAsync(fn){return _restParam(function(args){var callback=args.pop();args.push(function(){var innerArgs=arguments;if(sync){async.setImmediate(function(){callback.apply(null,innerArgs)})}else{callback.apply(null,innerArgs)}});var sync=true;fn.apply(this,args);sync=false})}async.ensureAsync=ensureAsync;async.constant=_restParam(function(values){var args=[null].concat(values);return function(callback){return callback.apply(this,args)}});async.wrapSync=async.asyncify=function asyncify(func){return _restParam(function(args){var callback=args.pop();var result;try{result=func.apply(this,args)}catch(e){return callback(e)}if(_isObject(result)&&typeof result.then==="function"){result.then(function(value){callback(null,value)})["catch"](function(err){callback(err.message?err:new Error(err))})}else{callback(null,result)}})};if(typeof module==="object"&&module.exports){module.exports=async}else if(typeof define==="function"&&define.amd){define([],function(){return async})}else{root.async=async}})()}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{_process:3}],2:[function(require,module,exports){(function(process){function normalizeArray(parts,allowAboveRoot){var up=0;for(var i=parts.length-1;i>=0;i--){var last=parts[i];if(last==="."){parts.splice(i,1)}else if(last===".."){parts.splice(i,1);up++}else if(up){parts.splice(i,1);up--}}if(allowAboveRoot){for(;up--;up){parts.unshift("..")}}return parts}var splitPathRe=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;var splitPath=function(filename){return splitPathRe.exec(filename).slice(1)};exports.resolve=function(){var resolvedPath="",resolvedAbsolute=false;for(var i=arguments.length-1;i>=-1&&!resolvedAbsolute;i--){var path=i>=0?arguments[i]:process.cwd();if(typeof path!=="string"){throw new TypeError("Arguments to path.resolve must be strings")}else if(!path){continue}resolvedPath=path+"/"+resolvedPath;resolvedAbsolute=path.charAt(0)==="/"}resolvedPath=normalizeArray(filter(resolvedPath.split("/"),function(p){return!!p}),!resolvedAbsolute).join("/");return(resolvedAbsolute?"/":"")+resolvedPath||"."};exports.normalize=function(path){var isAbsolute=exports.isAbsolute(path),trailingSlash=substr(path,-1)==="/";path=normalizeArray(filter(path.split("/"),function(p){return!!p}),!isAbsolute).join("/");if(!path&&!isAbsolute){path="."}if(path&&trailingSlash){path+="/"}return(isAbsolute?"/":"")+path};exports.isAbsolute=function(path){return path.charAt(0)==="/"};exports.join=function(){var paths=Array.prototype.slice.call(arguments,0);return exports.normalize(filter(paths,function(p,index){if(typeof p!=="string"){throw new TypeError("Arguments to path.join must be strings")}return p}).join("/"))};exports.relative=function(from,to){
from=exports.resolve(from).substr(1);to=exports.resolve(to).substr(1);function trim(arr){var start=0;for(;start<arr.length;start++){if(arr[start]!=="")break}var end=arr.length-1;for(;end>=0;end--){if(arr[end]!=="")break}if(start>end)return[];return arr.slice(start,end-start+1)}var fromParts=trim(from.split("/"));var toParts=trim(to.split("/"));var length=Math.min(fromParts.length,toParts.length);var samePartsLength=length;for(var i=0;i<length;i++){if(fromParts[i]!==toParts[i]){samePartsLength=i;break}}var outputParts=[];for(var i=samePartsLength;i<fromParts.length;i++){outputParts.push("..")}outputParts=outputParts.concat(toParts.slice(samePartsLength));return outputParts.join("/")};exports.sep="/";exports.delimiter=":";exports.dirname=function(path){var result=splitPath(path),root=result[0],dir=result[1];if(!root&&!dir){return"."}if(dir){dir=dir.substr(0,dir.length-1)}return root+dir};exports.basename=function(path,ext){var f=splitPath(path)[2];if(ext&&f.substr(-1*ext.length)===ext){f=f.substr(0,f.length-ext.length)}return f};exports.extname=function(path){return splitPath(path)[3]};function filter(xs,f){if(xs.filter)return xs.filter(f);var res=[];for(var i=0;i<xs.length;i++){if(f(xs[i],i,xs))res.push(xs[i])}return res}var substr="ab".substr(-1)==="b"?function(str,start,len){return str.substr(start,len)}:function(str,start,len){if(start<0)start=str.length+start;return str.substr(start,len)}}).call(this,require("_process"))},{_process:3}],3:[function(require,module,exports){var process=module.exports={};var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){draining=false;if(currentQueue.length){queue=currentQueue.concat(queue)}else{queueIndex=-1}if(queue.length){drainQueue()}}function drainQueue(){if(draining){return}var timeout=setTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){if(currentQueue){currentQueue[queueIndex].run()}}queueIndex=-1;len=queue.length}currentQueue=null;draining=false;clearTimeout(timeout)}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}}queue.push(new Item(fun,args));if(queue.length===1&&!draining){setTimeout(drainQueue,0)}};function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},{}],4:[function(require,module,exports){(function(global){(function(root){var freeExports=typeof exports=="object"&&exports&&!exports.nodeType&&exports;var freeModule=typeof module=="object"&&module&&!module.nodeType&&module;var freeGlobal=typeof global=="object"&&global;if(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal||freeGlobal.self===freeGlobal){root=freeGlobal}var punycode,maxInt=2147483647,base=36,tMin=1,tMax=26,skew=38,damp=700,initialBias=72,initialN=128,delimiter="-",regexPunycode=/^xn--/,regexNonASCII=/[^\x20-\x7E]/,regexSeparators=/[\x2E\u3002\uFF0E\uFF61]/g,errors={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},baseMinusTMin=base-tMin,floor=Math.floor,stringFromCharCode=String.fromCharCode,key;function error(type){throw new RangeError(errors[type])}function map(array,fn){var length=array.length;var result=[];while(length--){result[length]=fn(array[length])}return result}function mapDomain(string,fn){var parts=string.split("@");var result="";if(parts.length>1){result=parts[0]+"@";string=parts[1]}string=string.replace(regexSeparators,".");var labels=string.split(".");var encoded=map(labels,fn).join(".");return result+encoded}function ucs2decode(string){var output=[],counter=0,length=string.length,value,extra;while(counter<length){value=string.charCodeAt(counter++);if(value>=55296&&value<=56319&&counter<length){extra=string.charCodeAt(counter++);if((extra&64512)==56320){output.push(((value&1023)<<10)+(extra&1023)+65536)}else{output.push(value);counter--}}else{output.push(value)}}return output}function ucs2encode(array){return map(array,function(value){var output="";if(value>65535){value-=65536;output+=stringFromCharCode(value>>>10&1023|55296);value=56320|value&1023}output+=stringFromCharCode(value);return output}).join("")}function basicToDigit(codePoint){if(codePoint-48<10){return codePoint-22}if(codePoint-65<26){return codePoint-65}if(codePoint-97<26){return codePoint-97}return base}function digitToBasic(digit,flag){return digit+22+75*(digit<26)-((flag!=0)<<5)}function adapt(delta,numPoints,firstTime){var k=0;delta=firstTime?floor(delta/damp):delta>>1;delta+=floor(delta/numPoints);for(;delta>baseMinusTMin*tMax>>1;k+=base){delta=floor(delta/baseMinusTMin)}return floor(k+(baseMinusTMin+1)*delta/(delta+skew))}function decode(input){var output=[],inputLength=input.length,out,i=0,n=initialN,bias=initialBias,basic,j,index,oldi,w,k,digit,t,baseMinusT;basic=input.lastIndexOf(delimiter);if(basic<0){basic=0}for(j=0;j<basic;++j){if(input.charCodeAt(j)>=128){error("not-basic")}output.push(input.charCodeAt(j))}for(index=basic>0?basic+1:0;index<inputLength;){for(oldi=i,w=1,k=base;;k+=base){if(index>=inputLength){error("invalid-input")}digit=basicToDigit(input.charCodeAt(index++));if(digit>=base||digit>floor((maxInt-i)/w)){error("overflow")}i+=digit*w;t=k<=bias?tMin:k>=bias+tMax?tMax:k-bias;if(digit<t){break}baseMinusT=base-t;if(w>floor(maxInt/baseMinusT)){error("overflow")}w*=baseMinusT}out=output.length+1;bias=adapt(i-oldi,out,oldi==0);if(floor(i/out)>maxInt-n){error("overflow")}n+=floor(i/out);i%=out;output.splice(i++,0,n)}return ucs2encode(output)}function encode(input){var n,delta,handledCPCount,basicLength,bias,j,m,q,k,t,currentValue,output=[],inputLength,handledCPCountPlusOne,baseMinusT,qMinusT;input=ucs2decode(input);inputLength=input.length;n=initialN;delta=0;bias=initialBias;for(j=0;j<inputLength;++j){currentValue=input[j];if(currentValue<128){output.push(stringFromCharCode(currentValue))}}handledCPCount=basicLength=output.length;if(basicLength){output.push(delimiter)}while(handledCPCount<inputLength){for(m=maxInt,j=0;j<inputLength;++j){currentValue=input[j];if(currentValue>=n&&currentValue<m){m=currentValue}}handledCPCountPlusOne=handledCPCount+1;if(m-n>floor((maxInt-delta)/handledCPCountPlusOne)){error("overflow")}delta+=(m-n)*handledCPCountPlusOne;n=m;for(j=0;j<inputLength;++j){currentValue=input[j];if(currentValue<n&&++delta>maxInt){error("overflow")}if(currentValue==n){for(q=delta,k=base;;k+=base){t=k<=bias?tMin:k>=bias+tMax?tMax:k-bias;if(q<t){break}qMinusT=q-t;baseMinusT=base-t;output.push(stringFromCharCode(digitToBasic(t+qMinusT%baseMinusT,0)));q=floor(qMinusT/baseMinusT)}output.push(stringFromCharCode(digitToBasic(q,0)));bias=adapt(delta,handledCPCountPlusOne,handledCPCount==basicLength);delta=0;++handledCPCount}}++delta;++n}return output.join("")}function toUnicode(input){return mapDomain(input,function(string){return regexPunycode.test(string)?decode(string.slice(4).toLowerCase()):string})}function toASCII(input){return mapDomain(input,function(string){return regexNonASCII.test(string)?"xn--"+encode(string):string})}punycode={version:"1.3.2",ucs2:{decode:ucs2decode,encode:ucs2encode},decode:decode,encode:encode,toASCII:toASCII,toUnicode:toUnicode};if(typeof define=="function"&&typeof define.amd=="object"&&define.amd){define("punycode",function(){return punycode})}else if(freeExports&&freeModule){if(module.exports==freeExports){freeModule.exports=punycode}else{for(key in punycode){punycode.hasOwnProperty(key)&&(freeExports[key]=punycode[key])}}}else{root.punycode=punycode}})(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],5:[function(require,module,exports){"use strict";function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}module.exports=function(qs,sep,eq,options){sep=sep||"&";eq=eq||"=";var obj={};if(typeof qs!=="string"||qs.length===0){return obj}var regexp=/\+/g;qs=qs.split(sep);var maxKeys=1e3;if(options&&typeof options.maxKeys==="number"){maxKeys=options.maxKeys}var len=qs.length;if(maxKeys>0&&len>maxKeys){len=maxKeys}for(var i=0;i<len;++i){var x=qs[i].replace(regexp,"%20"),idx=x.indexOf(eq),kstr,vstr,k,v;if(idx>=0){kstr=x.substr(0,idx);vstr=x.substr(idx+1)}else{kstr=x;vstr=""}k=decodeURIComponent(kstr);v=decodeURIComponent(vstr);if(!hasOwnProperty(obj,k)){obj[k]=v}else if(isArray(obj[k])){obj[k].push(v)}else{obj[k]=[obj[k],v]}}return obj};var isArray=Array.isArray||function(xs){return Object.prototype.toString.call(xs)==="[object Array]"}},{}],6:[function(require,module,exports){"use strict";var stringifyPrimitive=function(v){switch(typeof v){case"string":return v;case"boolean":return v?"true":"false";case"number":return isFinite(v)?v:"";default:return""}};module.exports=function(obj,sep,eq,name){sep=sep||"&";eq=eq||"=";if(obj===null){obj=undefined}if(typeof obj==="object"){return map(objectKeys(obj),function(k){var ks=encodeURIComponent(stringifyPrimitive(k))+eq;if(isArray(obj[k])){return map(obj[k],function(v){return ks+encodeURIComponent(stringifyPrimitive(v))}).join(sep)}else{return ks+encodeURIComponent(stringifyPrimitive(obj[k]))}}).join(sep)}if(!name)return"";return encodeURIComponent(stringifyPrimitive(name))+eq+encodeURIComponent(stringifyPrimitive(obj))};var isArray=Array.isArray||function(xs){return Object.prototype.toString.call(xs)==="[object Array]"};function map(xs,f){if(xs.map)return xs.map(f);var res=[];for(var i=0;i<xs.length;i++){res.push(f(xs[i],i))}return res}var objectKeys=Object.keys||function(obj){var res=[];for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))res.push(key)}return res}},{}],7:[function(require,module,exports){"use strict";exports.decode=exports.parse=require("./decode");exports.encode=exports.stringify=require("./encode")},{"./decode":5,"./encode":6}],8:[function(require,module,exports){var punycode=require("punycode");exports.parse=urlParse;exports.resolve=urlResolve;exports.resolveObject=urlResolveObject;exports.format=urlFormat;exports.Url=Url;function Url(){this.protocol=null;this.slashes=null;this.auth=null;this.host=null;this.port=null;this.hostname=null;this.hash=null;this.search=null;this.query=null;this.pathname=null;this.path=null;this.href=null}var protocolPattern=/^([a-z0-9.+-]+:)/i,portPattern=/:[0-9]*$/,delims=["<",">",'"',"`"," ","\r","\n","	"],unwise=["{","}","|","\\","^","`"].concat(delims),autoEscape=["'"].concat(unwise),nonHostChars=["%","/","?",";","#"].concat(autoEscape),hostEndingChars=["/","?","#"],hostnameMaxLen=255,hostnamePartPattern=/^[a-z0-9A-Z_-]{0,63}$/,hostnamePartStart=/^([a-z0-9A-Z_-]{0,63})(.*)$/,unsafeProtocol={javascript:true,"javascript:":true},hostlessProtocol={javascript:true,"javascript:":true},slashedProtocol={http:true,https:true,ftp:true,gopher:true,file:true,"http:":true,"https:":true,"ftp:":true,"gopher:":true,"file:":true},querystring=require("querystring");function urlParse(url,parseQueryString,slashesDenoteHost){if(url&&isObject(url)&&url instanceof Url)return url;var u=new Url;u.parse(url,parseQueryString,slashesDenoteHost);return u}Url.prototype.parse=function(url,parseQueryString,slashesDenoteHost){if(!isString(url)){throw new TypeError("Parameter 'url' must be a string, not "+typeof url)}var rest=url;rest=rest.trim();var proto=protocolPattern.exec(rest);if(proto){proto=proto[0];var lowerProto=proto.toLowerCase();this.protocol=lowerProto;rest=rest.substr(proto.length)}if(slashesDenoteHost||proto||rest.match(/^\/\/[^@\/]+@[^@\/]+/)){var slashes=rest.substr(0,2)==="//";if(slashes&&!(proto&&hostlessProtocol[proto])){rest=rest.substr(2);this.slashes=true}}if(!hostlessProtocol[proto]&&(slashes||proto&&!slashedProtocol[proto])){var hostEnd=-1;for(var i=0;i<hostEndingChars.length;i++){var hec=rest.indexOf(hostEndingChars[i]);if(hec!==-1&&(hostEnd===-1||hec<hostEnd))hostEnd=hec}var auth,atSign;if(hostEnd===-1){atSign=rest.lastIndexOf("@")}else{atSign=rest.lastIndexOf("@",hostEnd)}if(atSign!==-1){auth=rest.slice(0,atSign);rest=rest.slice(atSign+1);this.auth=decodeURIComponent(auth)}hostEnd=-1;for(var i=0;i<nonHostChars.length;i++){var hec=rest.indexOf(nonHostChars[i]);if(hec!==-1&&(hostEnd===-1||hec<hostEnd))hostEnd=hec}if(hostEnd===-1)hostEnd=rest.length;this.host=rest.slice(0,hostEnd);rest=rest.slice(hostEnd);this.parseHost();this.hostname=this.hostname||"";var ipv6Hostname=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!ipv6Hostname){var hostparts=this.hostname.split(/\./);for(var i=0,l=hostparts.length;i<l;i++){var part=hostparts[i];if(!part)continue;if(!part.match(hostnamePartPattern)){var newpart="";for(var j=0,k=part.length;j<k;j++){if(part.charCodeAt(j)>127){newpart+="x"}else{newpart+=part[j]}}if(!newpart.match(hostnamePartPattern)){var validParts=hostparts.slice(0,i);var notHost=hostparts.slice(i+1);var bit=part.match(hostnamePartStart);if(bit){validParts.push(bit[1]);notHost.unshift(bit[2])}if(notHost.length){rest="/"+notHost.join(".")+rest}this.hostname=validParts.join(".");break}}}}if(this.hostname.length>hostnameMaxLen){this.hostname=""}else{this.hostname=this.hostname.toLowerCase()}if(!ipv6Hostname){var domainArray=this.hostname.split(".");var newOut=[];for(var i=0;i<domainArray.length;++i){var s=domainArray[i];newOut.push(s.match(/[^A-Za-z0-9_-]/)?"xn--"+punycode.encode(s):s)}this.hostname=newOut.join(".")}var p=this.port?":"+this.port:"";var h=this.hostname||"";this.host=h+p;this.href+=this.host;if(ipv6Hostname){this.hostname=this.hostname.substr(1,this.hostname.length-2);if(rest[0]!=="/"){rest="/"+rest}}}if(!unsafeProtocol[lowerProto]){for(var i=0,l=autoEscape.length;i<l;i++){var ae=autoEscape[i];var esc=encodeURIComponent(ae);if(esc===ae){esc=escape(ae)}rest=rest.split(ae).join(esc)}}var hash=rest.indexOf("#");if(hash!==-1){this.hash=rest.substr(hash);rest=rest.slice(0,hash)}var qm=rest.indexOf("?");if(qm!==-1){this.search=rest.substr(qm);this.query=rest.substr(qm+1);if(parseQueryString){this.query=querystring.parse(this.query)}rest=rest.slice(0,qm)}else if(parseQueryString){this.search="";this.query={}}if(rest)this.pathname=rest;if(slashedProtocol[lowerProto]&&this.hostname&&!this.pathname){this.pathname="/"}if(this.pathname||this.search){var p=this.pathname||"";var s=this.search||"";this.path=p+s}this.href=this.format();return this};function urlFormat(obj){if(isString(obj))obj=urlParse(obj);if(!(obj instanceof Url))return Url.prototype.format.call(obj);return obj.format()}Url.prototype.format=function(){var auth=this.auth||"";if(auth){auth=encodeURIComponent(auth);auth=auth.replace(/%3A/i,":");auth+="@"}var protocol=this.protocol||"",pathname=this.pathname||"",hash=this.hash||"",host=false,query="";if(this.host){host=auth+this.host}else if(this.hostname){host=auth+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]");if(this.port){host+=":"+this.port}}if(this.query&&isObject(this.query)&&Object.keys(this.query).length){query=querystring.stringify(this.query)}var search=this.search||query&&"?"+query||"";if(protocol&&protocol.substr(-1)!==":")protocol+=":";if(this.slashes||(!protocol||slashedProtocol[protocol])&&host!==false){host="//"+(host||"");if(pathname&&pathname.charAt(0)!=="/")pathname="/"+pathname}else if(!host){host=""}if(hash&&hash.charAt(0)!=="#")hash="#"+hash;if(search&&search.charAt(0)!=="?")search="?"+search;pathname=pathname.replace(/[?#]/g,function(match){return encodeURIComponent(match)});search=search.replace("#","%23");return protocol+host+pathname+search+hash};function urlResolve(source,relative){return urlParse(source,false,true).resolve(relative)}Url.prototype.resolve=function(relative){return this.resolveObject(urlParse(relative,false,true)).format()};function urlResolveObject(source,relative){if(!source)return relative;return urlParse(source,false,true).resolveObject(relative)}Url.prototype.resolveObject=function(relative){if(isString(relative)){var rel=new Url;rel.parse(relative,false,true);relative=rel}var result=new Url;Object.keys(this).forEach(function(k){result[k]=this[k]},this);result.hash=relative.hash;if(relative.href===""){result.href=result.format();return result}if(relative.slashes&&!relative.protocol){Object.keys(relative).forEach(function(k){if(k!=="protocol")result[k]=relative[k]});if(slashedProtocol[result.protocol]&&result.hostname&&!result.pathname){result.path=result.pathname="/"}result.href=result.format();return result}if(relative.protocol&&relative.protocol!==result.protocol){if(!slashedProtocol[relative.protocol]){Object.keys(relative).forEach(function(k){result[k]=relative[k]});result.href=result.format();return result}result.protocol=relative.protocol;if(!relative.host&&!hostlessProtocol[relative.protocol]){var relPath=(relative.pathname||"").split("/");while(relPath.length&&!(relative.host=relPath.shift()));if(!relative.host)relative.host="";if(!relative.hostname)relative.hostname="";if(relPath[0]!=="")relPath.unshift("");if(relPath.length<2)relPath.unshift("");result.pathname=relPath.join("/")}else{result.pathname=relative.pathname}result.search=relative.search;result.query=relative.query;result.host=relative.host||"";result.auth=relative.auth;result.hostname=relative.hostname||relative.host;result.port=relative.port;if(result.pathname||result.search){var p=result.pathname||"";var s=result.search||"";result.path=p+s}result.slashes=result.slashes||relative.slashes;result.href=result.format();return result}var isSourceAbs=result.pathname&&result.pathname.charAt(0)==="/",isRelAbs=relative.host||relative.pathname&&relative.pathname.charAt(0)==="/",mustEndAbs=isRelAbs||isSourceAbs||result.host&&relative.pathname,removeAllDots=mustEndAbs,srcPath=result.pathname&&result.pathname.split("/")||[],relPath=relative.pathname&&relative.pathname.split("/")||[],psychotic=result.protocol&&!slashedProtocol[result.protocol];if(psychotic){result.hostname="";result.port=null;if(result.host){if(srcPath[0]==="")srcPath[0]=result.host;else srcPath.unshift(result.host)}result.host="";if(relative.protocol){relative.hostname=null;relative.port=null;if(relative.host){if(relPath[0]==="")relPath[0]=relative.host;else relPath.unshift(relative.host)}relative.host=null}mustEndAbs=mustEndAbs&&(relPath[0]===""||srcPath[0]==="")}if(isRelAbs){result.host=relative.host||relative.host===""?relative.host:result.host;result.hostname=relative.hostname||relative.hostname===""?relative.hostname:result.hostname;result.search=relative.search;result.query=relative.query;srcPath=relPath}else if(relPath.length){if(!srcPath)srcPath=[];srcPath.pop();srcPath=srcPath.concat(relPath);result.search=relative.search;result.query=relative.query}else if(!isNullOrUndefined(relative.search)){if(psychotic){result.hostname=result.host=srcPath.shift();var authInHost=result.host&&result.host.indexOf("@")>0?result.host.split("@"):false;if(authInHost){result.auth=authInHost.shift();result.host=result.hostname=authInHost.shift()}}result.search=relative.search;result.query=relative.query;if(!isNull(result.pathname)||!isNull(result.search)){result.path=(result.pathname?result.pathname:"")+(result.search?result.search:"")}result.href=result.format();return result}if(!srcPath.length){result.pathname=null;if(result.search){result.path="/"+result.search}else{result.path=null}result.href=result.format();return result}var last=srcPath.slice(-1)[0];var hasTrailingSlash=(result.host||relative.host)&&(last==="."||last==="..")||last==="";var up=0;for(var i=srcPath.length;i>=0;i--){last=srcPath[i];if(last=="."){srcPath.splice(i,1)}else if(last===".."){srcPath.splice(i,1);up++}else if(up){srcPath.splice(i,1);up--}}if(!mustEndAbs&&!removeAllDots){for(;up--;up){srcPath.unshift("..")}}if(mustEndAbs&&srcPath[0]!==""&&(!srcPath[0]||srcPath[0].charAt(0)!=="/")){srcPath.unshift("")}if(hasTrailingSlash&&srcPath.join("/").substr(-1)!=="/"){srcPath.push("")}var isAbsolute=srcPath[0]===""||srcPath[0]&&srcPath[0].charAt(0)==="/";if(psychotic){result.hostname=result.host=isAbsolute?"":srcPath.length?srcPath.shift():"";var authInHost=result.host&&result.host.indexOf("@")>0?result.host.split("@"):false;if(authInHost){result.auth=authInHost.shift();result.host=result.hostname=authInHost.shift()}}mustEndAbs=mustEndAbs||result.host&&srcPath.length;if(mustEndAbs&&!isAbsolute){srcPath.unshift("")}if(!srcPath.length){result.pathname=null;result.path=null}else{result.pathname=srcPath.join("/")}if(!isNull(result.pathname)||!isNull(result.search)){result.path=(result.pathname?result.pathname:"")+(result.search?result.search:"")}result.auth=relative.auth||result.auth;result.slashes=result.slashes||relative.slashes;result.href=result.format();return result};Url.prototype.parseHost=function(){var host=this.host;var port=portPattern.exec(host);if(port){port=port[0];if(port!==":"){this.port=port.substr(1)}host=host.substr(0,host.length-port.length)}if(host)this.hostname=host};function isString(arg){return typeof arg==="string"}function isObject(arg){return typeof arg==="object"&&arg!==null}function isNull(arg){return arg===null}function isNullOrUndefined(arg){return arg==null}},{punycode:4,querystring:7}],9:[function(require,module,exports){"use strict";module.exports=earcut;function earcut(data,holeIndices,dim){dim=dim||2;var hasHoles=holeIndices&&holeIndices.length,outerLen=hasHoles?holeIndices[0]*dim:data.length,outerNode=linkedList(data,0,outerLen,dim,true),triangles=[];if(!outerNode)return triangles;var minX,minY,maxX,maxY,x,y,size;if(hasHoles)outerNode=eliminateHoles(data,holeIndices,outerNode,dim);if(data.length>80*dim){minX=maxX=data[0];minY=maxY=data[1];for(var i=dim;i<outerLen;i+=dim){x=data[i];y=data[i+1];if(x<minX)minX=x;if(y<minY)minY=y;if(x>maxX)maxX=x;if(y>maxY)maxY=y}size=Math.max(maxX-minX,maxY-minY)}earcutLinked(outerNode,triangles,dim,minX,minY,size);return triangles}function linkedList(data,start,end,dim,clockwise){var sum=0,i,j,last;for(i=start,j=end-dim;i<end;i+=dim){sum+=(data[j]-data[i])*(data[i+1]+data[j+1]);j=i}if(clockwise===sum>0){for(i=start;i<end;i+=dim)last=insertNode(i,data[i],data[i+1],last)}else{for(i=end-dim;i>=start;i-=dim)last=insertNode(i,data[i],data[i+1],last)}return last}function filterPoints(start,end){if(!start)return start;if(!end)end=start;var p=start,again;do{again=false;if(!p.steiner&&(equals(p,p.next)||area(p.prev,p,p.next)===0)){removeNode(p);p=end=p.prev;if(p===p.next)return null;again=true}else{p=p.next}}while(again||p!==end);return end}function earcutLinked(ear,triangles,dim,minX,minY,size,pass){if(!ear)return;if(!pass&&size)indexCurve(ear,minX,minY,size);var stop=ear,prev,next;while(ear.prev!==ear.next){prev=ear.prev;next=ear.next;if(size?isEarHashed(ear,minX,minY,size):isEar(ear)){triangles.push(prev.i/dim);triangles.push(ear.i/dim);triangles.push(next.i/dim);removeNode(ear);ear=next.next;stop=next.next;continue}ear=next;if(ear===stop){if(!pass){earcutLinked(filterPoints(ear),triangles,dim,minX,minY,size,1)}else if(pass===1){ear=cureLocalIntersections(ear,triangles,dim);earcutLinked(ear,triangles,dim,minX,minY,size,2)}else if(pass===2){splitEarcut(ear,triangles,dim,minX,minY,size)}break}}}function isEar(ear){var a=ear.prev,b=ear,c=ear.next;if(area(a,b,c)>=0)return false;var p=ear.next.next;while(p!==ear.prev){if(pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return false;p=p.next}return true}function isEarHashed(ear,minX,minY,size){var a=ear.prev,b=ear,c=ear.next;if(area(a,b,c)>=0)return false;var minTX=a.x<b.x?a.x<c.x?a.x:c.x:b.x<c.x?b.x:c.x,minTY=a.y<b.y?a.y<c.y?a.y:c.y:b.y<c.y?b.y:c.y,maxTX=a.x>b.x?a.x>c.x?a.x:c.x:b.x>c.x?b.x:c.x,maxTY=a.y>b.y?a.y>c.y?a.y:c.y:b.y>c.y?b.y:c.y;var minZ=zOrder(minTX,minTY,minX,minY,size),maxZ=zOrder(maxTX,maxTY,minX,minY,size);var p=ear.nextZ;while(p&&p.z<=maxZ){if(p!==ear.prev&&p!==ear.next&&pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return false;p=p.nextZ}p=ear.prevZ;while(p&&p.z>=minZ){if(p!==ear.prev&&p!==ear.next&&pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return false;p=p.prevZ}return true}function cureLocalIntersections(start,triangles,dim){var p=start;do{var a=p.prev,b=p.next.next;if(intersects(a,p,p.next,b)&&locallyInside(a,b)&&locallyInside(b,a)){triangles.push(a.i/dim);triangles.push(p.i/dim);triangles.push(b.i/dim);removeNode(p);removeNode(p.next);p=start=b}p=p.next}while(p!==start);return p}function splitEarcut(start,triangles,dim,minX,minY,size){var a=start;do{var b=a.next.next;while(b!==a.prev){if(a.i!==b.i&&isValidDiagonal(a,b)){var c=splitPolygon(a,b);a=filterPoints(a,a.next);c=filterPoints(c,c.next);earcutLinked(a,triangles,dim,minX,minY,size);earcutLinked(c,triangles,dim,minX,minY,size);return}b=b.next}a=a.next}while(a!==start)}function eliminateHoles(data,holeIndices,outerNode,dim){var queue=[],i,len,start,end,list;for(i=0,len=holeIndices.length;i<len;i++){start=holeIndices[i]*dim;end=i<len-1?holeIndices[i+1]*dim:data.length;list=linkedList(data,start,end,dim,false);if(list===list.next)list.steiner=true;queue.push(getLeftmost(list))}queue.sort(compareX);for(i=0;i<queue.length;i++){eliminateHole(queue[i],outerNode);outerNode=filterPoints(outerNode,outerNode.next)}return outerNode}function compareX(a,b){return a.x-b.x}function eliminateHole(hole,outerNode){outerNode=findHoleBridge(hole,outerNode);if(outerNode){var b=splitPolygon(outerNode,hole);filterPoints(b,b.next)}}function findHoleBridge(hole,outerNode){var p=outerNode,hx=hole.x,hy=hole.y,qx=-Infinity,m;do{if(hy<=p.y&&hy>=p.next.y){var x=p.x+(hy-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(x<=hx&&x>qx){qx=x;m=p.x<p.next.x?p:p.next}}p=p.next}while(p!==outerNode);if(!m)return null;if(hole.x===m.x)return m.prev;var stop=m,tanMin=Infinity,tan;p=m.next;while(p!==stop){if(hx>=p.x&&p.x>=m.x&&pointInTriangle(hy<m.y?hx:qx,hy,m.x,m.y,hy<m.y?qx:hx,hy,p.x,p.y)){tan=Math.abs(hy-p.y)/(hx-p.x);if((tan<tanMin||tan===tanMin&&p.x>m.x)&&locallyInside(p,hole)){m=p;tanMin=tan}}p=p.next}return m}function indexCurve(start,minX,minY,size){var p=start;do{if(p.z===null)p.z=zOrder(p.x,p.y,minX,minY,size);p.prevZ=p.prev;p.nextZ=p.next;p=p.next}while(p!==start);p.prevZ.nextZ=null;p.prevZ=null;sortLinked(p)}function sortLinked(list){var i,p,q,e,tail,numMerges,pSize,qSize,inSize=1;do{p=list;list=null;tail=null;numMerges=0;while(p){numMerges++;q=p;pSize=0;for(i=0;i<inSize;i++){pSize++;q=q.nextZ;if(!q)break}qSize=inSize;while(pSize>0||qSize>0&&q){if(pSize===0){e=q;q=q.nextZ;qSize--}else if(qSize===0||!q){e=p;p=p.nextZ;pSize--}else if(p.z<=q.z){e=p;p=p.nextZ;pSize--}else{e=q;q=q.nextZ;qSize--}if(tail)tail.nextZ=e;else list=e;e.prevZ=tail;tail=e}p=q}tail.nextZ=null;inSize*=2}while(numMerges>1);return list}function zOrder(x,y,minX,minY,size){x=32767*(x-minX)/size;y=32767*(y-minY)/size;x=(x|x<<8)&16711935;x=(x|x<<4)&252645135;x=(x|x<<2)&858993459;x=(x|x<<1)&1431655765;y=(y|y<<8)&16711935;y=(y|y<<4)&252645135;y=(y|y<<2)&858993459;y=(y|y<<1)&1431655765;return x|y<<1}function getLeftmost(start){var p=start,leftmost=start;do{if(p.x<leftmost.x)leftmost=p;p=p.next}while(p!==start);return leftmost}function pointInTriangle(ax,ay,bx,by,cx,cy,px,py){return(cx-px)*(ay-py)-(ax-px)*(cy-py)>=0&&(ax-px)*(by-py)-(bx-px)*(ay-py)>=0&&(bx-px)*(cy-py)-(cx-px)*(by-py)>=0}function isValidDiagonal(a,b){return equals(a,b)||a.next.i!==b.i&&a.prev.i!==b.i&&!intersectsPolygon(a,b)&&locallyInside(a,b)&&locallyInside(b,a)&&middleInside(a,b)}function area(p,q,r){return(q.y-p.y)*(r.x-q.x)-(q.x-p.x)*(r.y-q.y)}function equals(p1,p2){return p1.x===p2.x&&p1.y===p2.y}function intersects(p1,q1,p2,q2){return area(p1,q1,p2)>0!==area(p1,q1,q2)>0&&area(p2,q2,p1)>0!==area(p2,q2,q1)>0}function intersectsPolygon(a,b){var p=a;do{if(p.i!==a.i&&p.next.i!==a.i&&p.i!==b.i&&p.next.i!==b.i&&intersects(p,p.next,a,b))return true;p=p.next}while(p!==a);return false}function locallyInside(a,b){return area(a.prev,a,a.next)<0?area(a,b,a.next)>=0&&area(a,a.prev,b)>=0:area(a,b,a.prev)<0||area(a,a.next,b)<0}function middleInside(a,b){var p=a,inside=false,px=(a.x+b.x)/2,py=(a.y+b.y)/2;do{if(p.y>py!==p.next.y>py&&px<(p.next.x-p.x)*(py-p.y)/(p.next.y-p.y)+p.x)inside=!inside;p=p.next}while(p!==a);return inside}function splitPolygon(a,b){var a2=new Node(a.i,a.x,a.y),b2=new Node(b.i,b.x,b.y),an=a.next,bp=b.prev;a.next=b;b.prev=a;a2.next=an;an.prev=a2;b2.next=a2;a2.prev=b2;bp.next=b2;b2.prev=bp;return b2}function insertNode(i,x,y,last){var p=new Node(i,x,y);if(!last){p.prev=p;p.next=p}else{p.next=last.next;p.prev=last;last.next.prev=p;last.next=p}return p}function removeNode(p){p.next.prev=p.prev;p.prev.next=p.next;if(p.prevZ)p.prevZ.nextZ=p.nextZ;if(p.nextZ)p.nextZ.prevZ=p.prevZ}function Node(i,x,y){this.i=i;this.x=x;this.y=y;this.prev=null;this.next=null;this.z=null;this.prevZ=null;this.nextZ=null;this.steiner=false}},{}],10:[function(require,module,exports){"use strict";var prefix=typeof Object.create!=="function"?"~":false;function EE(fn,context,once){this.fn=fn;this.context=context;this.once=once||false}function EventEmitter(){}EventEmitter.prototype._events=undefined;EventEmitter.prototype.listeners=function listeners(event,exists){var evt=prefix?prefix+event:event,available=this._events&&this._events[evt];if(exists)return!!available;if(!available)return[];if(available.fn)return[available.fn];for(var i=0,l=available.length,ee=new Array(l);i<l;i++){ee[i]=available[i].fn}return ee};EventEmitter.prototype.emit=function emit(event,a1,a2,a3,a4,a5){var evt=prefix?prefix+event:event;if(!this._events||!this._events[evt])return false;var listeners=this._events[evt],len=arguments.length,args,i;if("function"===typeof listeners.fn){if(listeners.once)this.removeListener(event,listeners.fn,undefined,true);switch(len){case 1:return listeners.fn.call(listeners.context),true;case 2:return listeners.fn.call(listeners.context,a1),true;case 3:return listeners.fn.call(listeners.context,a1,a2),true;case 4:return listeners.fn.call(listeners.context,a1,a2,a3),true;case 5:return listeners.fn.call(listeners.context,a1,a2,a3,a4),true;case 6:return listeners.fn.call(listeners.context,a1,a2,a3,a4,a5),true}for(i=1,args=new Array(len-1);i<len;i++){args[i-1]=arguments[i]}listeners.fn.apply(listeners.context,args)}else{var length=listeners.length,j;for(i=0;i<length;i++){if(listeners[i].once)this.removeListener(event,listeners[i].fn,undefined,true);switch(len){case 1:listeners[i].fn.call(listeners[i].context);break;case 2:listeners[i].fn.call(listeners[i].context,a1);break;case 3:listeners[i].fn.call(listeners[i].context,a1,a2);break;default:if(!args)for(j=1,args=new Array(len-1);j<len;j++){args[j-1]=arguments[j]}listeners[i].fn.apply(listeners[i].context,args)}}}return true};EventEmitter.prototype.on=function on(event,fn,context){var listener=new EE(fn,context||this),evt=prefix?prefix+event:event;if(!this._events)this._events=prefix?{}:Object.create(null);if(!this._events[evt])this._events[evt]=listener;else{if(!this._events[evt].fn)this._events[evt].push(listener);else this._events[evt]=[this._events[evt],listener]}return this};EventEmitter.prototype.once=function once(event,fn,context){var listener=new EE(fn,context||this,true),evt=prefix?prefix+event:event;if(!this._events)this._events=prefix?{}:Object.create(null);if(!this._events[evt])this._events[evt]=listener;else{if(!this._events[evt].fn)this._events[evt].push(listener);else this._events[evt]=[this._events[evt],listener]}return this};EventEmitter.prototype.removeListener=function removeListener(event,fn,context,once){var evt=prefix?prefix+event:event;if(!this._events||!this._events[evt])return this;
var listeners=this._events[evt],events=[];if(fn){if(listeners.fn){if(listeners.fn!==fn||once&&!listeners.once||context&&listeners.context!==context){events.push(listeners)}}else{for(var i=0,length=listeners.length;i<length;i++){if(listeners[i].fn!==fn||once&&!listeners[i].once||context&&listeners[i].context!==context){events.push(listeners[i])}}}}if(events.length){this._events[evt]=events.length===1?events[0]:events}else{delete this._events[evt]}return this};EventEmitter.prototype.removeAllListeners=function removeAllListeners(event){if(!this._events)return this;if(event)delete this._events[prefix?prefix+event:event];else this._events=prefix?{}:Object.create(null);return this};EventEmitter.prototype.off=EventEmitter.prototype.removeListener;EventEmitter.prototype.addListener=EventEmitter.prototype.on;EventEmitter.prototype.setMaxListeners=function setMaxListeners(){return this};EventEmitter.prefixed=prefix;if("undefined"!==typeof module){module.exports=EventEmitter}},{}],11:[function(require,module,exports){"use strict";var hasOwnProperty=Object.prototype.hasOwnProperty;var propIsEnumerable=Object.prototype.propertyIsEnumerable;function toObject(val){if(val===null||val===undefined){throw new TypeError("Object.assign cannot be called with null or undefined")}return Object(val)}module.exports=Object.assign||function(target,source){var from;var to=toObject(target);var symbols;for(var s=1;s<arguments.length;s++){from=Object(arguments[s]);for(var key in from){if(hasOwnProperty.call(from,key)){to[key]=from[key]}}if(Object.getOwnPropertySymbols){symbols=Object.getOwnPropertySymbols(from);for(var i=0;i<symbols.length;i++){if(propIsEnumerable.call(from,symbols[i])){to[symbols[i]]=from[symbols[i]]}}}}return to}},{}],12:[function(require,module,exports){(function(process){(function(){var async={};var root,previous_async;root=this;if(root!=null){previous_async=root.async}async.noConflict=function(){root.async=previous_async;return async};function only_once(fn){var called=false;return function(){if(called)throw new Error("Callback was already called.");called=true;fn.apply(root,arguments)}}var _toString=Object.prototype.toString;var _isArray=Array.isArray||function(obj){return _toString.call(obj)==="[object Array]"};var _each=function(arr,iterator){for(var i=0;i<arr.length;i+=1){iterator(arr[i],i,arr)}};var _map=function(arr,iterator){if(arr.map){return arr.map(iterator)}var results=[];_each(arr,function(x,i,a){results.push(iterator(x,i,a))});return results};var _reduce=function(arr,iterator,memo){if(arr.reduce){return arr.reduce(iterator,memo)}_each(arr,function(x,i,a){memo=iterator(memo,x,i,a)});return memo};var _keys=function(obj){if(Object.keys){return Object.keys(obj)}var keys=[];for(var k in obj){if(obj.hasOwnProperty(k)){keys.push(k)}}return keys};if(typeof process==="undefined"||!process.nextTick){if(typeof setImmediate==="function"){async.nextTick=function(fn){setImmediate(fn)};async.setImmediate=async.nextTick}else{async.nextTick=function(fn){setTimeout(fn,0)};async.setImmediate=async.nextTick}}else{async.nextTick=process.nextTick;if(typeof setImmediate!=="undefined"){async.setImmediate=function(fn){setImmediate(fn)}}else{async.setImmediate=async.nextTick}}async.each=function(arr,iterator,callback){callback=callback||function(){};if(!arr.length){return callback()}var completed=0;_each(arr,function(x){iterator(x,only_once(done))});function done(err){if(err){callback(err);callback=function(){}}else{completed+=1;if(completed>=arr.length){callback()}}}};async.forEach=async.each;async.eachSeries=function(arr,iterator,callback){callback=callback||function(){};if(!arr.length){return callback()}var completed=0;var iterate=function(){iterator(arr[completed],function(err){if(err){callback(err);callback=function(){}}else{completed+=1;if(completed>=arr.length){callback()}else{iterate()}}})};iterate()};async.forEachSeries=async.eachSeries;async.eachLimit=function(arr,limit,iterator,callback){var fn=_eachLimit(limit);fn.apply(null,[arr,iterator,callback])};async.forEachLimit=async.eachLimit;var _eachLimit=function(limit){return function(arr,iterator,callback){callback=callback||function(){};if(!arr.length||limit<=0){return callback()}var completed=0;var started=0;var running=0;(function replenish(){if(completed>=arr.length){return callback()}while(running<limit&&started<arr.length){started+=1;running+=1;iterator(arr[started-1],function(err){if(err){callback(err);callback=function(){}}else{completed+=1;running-=1;if(completed>=arr.length){callback()}else{replenish()}}})}})()}};var doParallel=function(fn){return function(){var args=Array.prototype.slice.call(arguments);return fn.apply(null,[async.each].concat(args))}};var doParallelLimit=function(limit,fn){return function(){var args=Array.prototype.slice.call(arguments);return fn.apply(null,[_eachLimit(limit)].concat(args))}};var doSeries=function(fn){return function(){var args=Array.prototype.slice.call(arguments);return fn.apply(null,[async.eachSeries].concat(args))}};var _asyncMap=function(eachfn,arr,iterator,callback){arr=_map(arr,function(x,i){return{index:i,value:x}});if(!callback){eachfn(arr,function(x,callback){iterator(x.value,function(err){callback(err)})})}else{var results=[];eachfn(arr,function(x,callback){iterator(x.value,function(err,v){results[x.index]=v;callback(err)})},function(err){callback(err,results)})}};async.map=doParallel(_asyncMap);async.mapSeries=doSeries(_asyncMap);async.mapLimit=function(arr,limit,iterator,callback){return _mapLimit(limit)(arr,iterator,callback)};var _mapLimit=function(limit){return doParallelLimit(limit,_asyncMap)};async.reduce=function(arr,memo,iterator,callback){async.eachSeries(arr,function(x,callback){iterator(memo,x,function(err,v){memo=v;callback(err)})},function(err){callback(err,memo)})};async.inject=async.reduce;async.foldl=async.reduce;async.reduceRight=function(arr,memo,iterator,callback){var reversed=_map(arr,function(x){return x}).reverse();async.reduce(reversed,memo,iterator,callback)};async.foldr=async.reduceRight;var _filter=function(eachfn,arr,iterator,callback){var results=[];arr=_map(arr,function(x,i){return{index:i,value:x}});eachfn(arr,function(x,callback){iterator(x.value,function(v){if(v){results.push(x)}callback()})},function(err){callback(_map(results.sort(function(a,b){return a.index-b.index}),function(x){return x.value}))})};async.filter=doParallel(_filter);async.filterSeries=doSeries(_filter);async.select=async.filter;async.selectSeries=async.filterSeries;var _reject=function(eachfn,arr,iterator,callback){var results=[];arr=_map(arr,function(x,i){return{index:i,value:x}});eachfn(arr,function(x,callback){iterator(x.value,function(v){if(!v){results.push(x)}callback()})},function(err){callback(_map(results.sort(function(a,b){return a.index-b.index}),function(x){return x.value}))})};async.reject=doParallel(_reject);async.rejectSeries=doSeries(_reject);var _detect=function(eachfn,arr,iterator,main_callback){eachfn(arr,function(x,callback){iterator(x,function(result){if(result){main_callback(x);main_callback=function(){}}else{callback()}})},function(err){main_callback()})};async.detect=doParallel(_detect);async.detectSeries=doSeries(_detect);async.some=function(arr,iterator,main_callback){async.each(arr,function(x,callback){iterator(x,function(v){if(v){main_callback(true);main_callback=function(){}}callback()})},function(err){main_callback(false)})};async.any=async.some;async.every=function(arr,iterator,main_callback){async.each(arr,function(x,callback){iterator(x,function(v){if(!v){main_callback(false);main_callback=function(){}}callback()})},function(err){main_callback(true)})};async.all=async.every;async.sortBy=function(arr,iterator,callback){async.map(arr,function(x,callback){iterator(x,function(err,criteria){if(err){callback(err)}else{callback(null,{value:x,criteria:criteria})}})},function(err,results){if(err){return callback(err)}else{var fn=function(left,right){var a=left.criteria,b=right.criteria;return a<b?-1:a>b?1:0};callback(null,_map(results.sort(fn),function(x){return x.value}))}})};async.auto=function(tasks,callback){callback=callback||function(){};var keys=_keys(tasks);var remainingTasks=keys.length;if(!remainingTasks){return callback()}var results={};var listeners=[];var addListener=function(fn){listeners.unshift(fn)};var removeListener=function(fn){for(var i=0;i<listeners.length;i+=1){if(listeners[i]===fn){listeners.splice(i,1);return}}};var taskComplete=function(){remainingTasks--;_each(listeners.slice(0),function(fn){fn()})};addListener(function(){if(!remainingTasks){var theCallback=callback;callback=function(){};theCallback(null,results)}});_each(keys,function(k){var task=_isArray(tasks[k])?tasks[k]:[tasks[k]];var taskCallback=function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0]}if(err){var safeResults={};_each(_keys(results),function(rkey){safeResults[rkey]=results[rkey]});safeResults[k]=args;callback(err,safeResults);callback=function(){}}else{results[k]=args;async.setImmediate(taskComplete)}};var requires=task.slice(0,Math.abs(task.length-1))||[];var ready=function(){return _reduce(requires,function(a,x){return a&&results.hasOwnProperty(x)},true)&&!results.hasOwnProperty(k)};if(ready()){task[task.length-1](taskCallback,results)}else{var listener=function(){if(ready()){removeListener(listener);task[task.length-1](taskCallback,results)}};addListener(listener)}})};async.retry=function(times,task,callback){var DEFAULT_TIMES=5;var attempts=[];if(typeof times==="function"){callback=task;task=times;times=DEFAULT_TIMES}times=parseInt(times,10)||DEFAULT_TIMES;var wrappedTask=function(wrappedCallback,wrappedResults){var retryAttempt=function(task,finalAttempt){return function(seriesCallback){task(function(err,result){seriesCallback(!err||finalAttempt,{err:err,result:result})},wrappedResults)}};while(times){attempts.push(retryAttempt(task,!(times-=1)))}async.series(attempts,function(done,data){data=data[data.length-1];(wrappedCallback||callback)(data.err,data.result)})};return callback?wrappedTask():wrappedTask};async.waterfall=function(tasks,callback){callback=callback||function(){};if(!_isArray(tasks)){var err=new Error("First argument to waterfall must be an array of functions");return callback(err)}if(!tasks.length){return callback()}var wrapIterator=function(iterator){return function(err){if(err){callback.apply(null,arguments);callback=function(){}}else{var args=Array.prototype.slice.call(arguments,1);var next=iterator.next();if(next){args.push(wrapIterator(next))}else{args.push(callback)}async.setImmediate(function(){iterator.apply(null,args)})}}};wrapIterator(async.iterator(tasks))()};var _parallel=function(eachfn,tasks,callback){callback=callback||function(){};if(_isArray(tasks)){eachfn.map(tasks,function(fn,callback){if(fn){fn(function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0]}callback.call(null,err,args)})}},callback)}else{var results={};eachfn.each(_keys(tasks),function(k,callback){tasks[k](function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0]}results[k]=args;callback(err)})},function(err){callback(err,results)})}};async.parallel=function(tasks,callback){_parallel({map:async.map,each:async.each},tasks,callback)};async.parallelLimit=function(tasks,limit,callback){_parallel({map:_mapLimit(limit),each:_eachLimit(limit)},tasks,callback)};async.series=function(tasks,callback){callback=callback||function(){};if(_isArray(tasks)){async.mapSeries(tasks,function(fn,callback){if(fn){fn(function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0]}callback.call(null,err,args)})}},callback)}else{var results={};async.eachSeries(_keys(tasks),function(k,callback){tasks[k](function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0]}results[k]=args;callback(err)})},function(err){callback(err,results)})}};async.iterator=function(tasks){var makeCallback=function(index){var fn=function(){if(tasks.length){tasks[index].apply(null,arguments)}return fn.next()};fn.next=function(){return index<tasks.length-1?makeCallback(index+1):null};return fn};return makeCallback(0)};async.apply=function(fn){var args=Array.prototype.slice.call(arguments,1);return function(){return fn.apply(null,args.concat(Array.prototype.slice.call(arguments)))}};var _concat=function(eachfn,arr,fn,callback){var r=[];eachfn(arr,function(x,cb){fn(x,function(err,y){r=r.concat(y||[]);cb(err)})},function(err){callback(err,r)})};async.concat=doParallel(_concat);async.concatSeries=doSeries(_concat);async.whilst=function(test,iterator,callback){if(test()){iterator(function(err){if(err){return callback(err)}async.whilst(test,iterator,callback)})}else{callback()}};async.doWhilst=function(iterator,test,callback){iterator(function(err){if(err){return callback(err)}var args=Array.prototype.slice.call(arguments,1);if(test.apply(null,args)){async.doWhilst(iterator,test,callback)}else{callback()}})};async.until=function(test,iterator,callback){if(!test()){iterator(function(err){if(err){return callback(err)}async.until(test,iterator,callback)})}else{callback()}};async.doUntil=function(iterator,test,callback){iterator(function(err){if(err){return callback(err)}var args=Array.prototype.slice.call(arguments,1);if(!test.apply(null,args)){async.doUntil(iterator,test,callback)}else{callback()}})};async.queue=function(worker,concurrency){if(concurrency===undefined){concurrency=1}function _insert(q,data,pos,callback){if(!q.started){q.started=true}if(!_isArray(data)){data=[data]}if(data.length==0){return async.setImmediate(function(){if(q.drain){q.drain()}})}_each(data,function(task){var item={data:task,callback:typeof callback==="function"?callback:null};if(pos){q.tasks.unshift(item)}else{q.tasks.push(item)}if(q.saturated&&q.tasks.length===q.concurrency){q.saturated()}async.setImmediate(q.process)})}var workers=0;var q={tasks:[],concurrency:concurrency,saturated:null,empty:null,drain:null,started:false,paused:false,push:function(data,callback){_insert(q,data,false,callback)},kill:function(){q.drain=null;q.tasks=[]},unshift:function(data,callback){_insert(q,data,true,callback)},process:function(){if(!q.paused&&workers<q.concurrency&&q.tasks.length){var task=q.tasks.shift();if(q.empty&&q.tasks.length===0){q.empty()}workers+=1;var next=function(){workers-=1;if(task.callback){task.callback.apply(task,arguments)}if(q.drain&&q.tasks.length+workers===0){q.drain()}q.process()};var cb=only_once(next);worker(task.data,cb)}},length:function(){return q.tasks.length},running:function(){return workers},idle:function(){return q.tasks.length+workers===0},pause:function(){if(q.paused===true){return}q.paused=true},resume:function(){if(q.paused===false){return}q.paused=false;for(var w=1;w<=q.concurrency;w++){async.setImmediate(q.process)}}};return q};async.priorityQueue=function(worker,concurrency){function _compareTasks(a,b){return a.priority-b.priority}function _binarySearch(sequence,item,compare){var beg=-1,end=sequence.length-1;while(beg<end){var mid=beg+(end-beg+1>>>1);if(compare(item,sequence[mid])>=0){beg=mid}else{end=mid-1}}return beg}function _insert(q,data,priority,callback){if(!q.started){q.started=true}if(!_isArray(data)){data=[data]}if(data.length==0){return async.setImmediate(function(){if(q.drain){q.drain()}})}_each(data,function(task){var item={data:task,priority:priority,callback:typeof callback==="function"?callback:null};q.tasks.splice(_binarySearch(q.tasks,item,_compareTasks)+1,0,item);if(q.saturated&&q.tasks.length===q.concurrency){q.saturated()}async.setImmediate(q.process)})}var q=async.queue(worker,concurrency);q.push=function(data,priority,callback){_insert(q,data,priority,callback)};delete q.unshift;return q};async.cargo=function(worker,payload){var working=false,tasks=[];var cargo={tasks:tasks,payload:payload,saturated:null,empty:null,drain:null,drained:true,push:function(data,callback){if(!_isArray(data)){data=[data]}_each(data,function(task){tasks.push({data:task,callback:typeof callback==="function"?callback:null});cargo.drained=false;if(cargo.saturated&&tasks.length===payload){cargo.saturated()}});async.setImmediate(cargo.process)},process:function process(){if(working)return;if(tasks.length===0){if(cargo.drain&&!cargo.drained)cargo.drain();cargo.drained=true;return}var ts=typeof payload==="number"?tasks.splice(0,payload):tasks.splice(0,tasks.length);var ds=_map(ts,function(task){return task.data});if(cargo.empty)cargo.empty();working=true;worker(ds,function(){working=false;var args=arguments;_each(ts,function(data){if(data.callback){data.callback.apply(null,args)}});process()})},length:function(){return tasks.length},running:function(){return working}};return cargo};var _console_fn=function(name){return function(fn){var args=Array.prototype.slice.call(arguments,1);fn.apply(null,args.concat([function(err){var args=Array.prototype.slice.call(arguments,1);if(typeof console!=="undefined"){if(err){if(console.error){console.error(err)}}else if(console[name]){_each(args,function(x){console[name](x)})}}}]))}};async.log=_console_fn("log");async.dir=_console_fn("dir");async.memoize=function(fn,hasher){var memo={};var queues={};hasher=hasher||function(x){return x};var memoized=function(){var args=Array.prototype.slice.call(arguments);var callback=args.pop();var key=hasher.apply(null,args);if(key in memo){async.nextTick(function(){callback.apply(null,memo[key])})}else if(key in queues){queues[key].push(callback)}else{queues[key]=[callback];fn.apply(null,args.concat([function(){memo[key]=arguments;var q=queues[key];delete queues[key];for(var i=0,l=q.length;i<l;i++){q[i].apply(null,arguments)}}]))}};memoized.memo=memo;memoized.unmemoized=fn;return memoized};async.unmemoize=function(fn){return function(){return(fn.unmemoized||fn).apply(null,arguments)}};async.times=function(count,iterator,callback){var counter=[];for(var i=0;i<count;i++){counter.push(i)}return async.map(counter,iterator,callback)};async.timesSeries=function(count,iterator,callback){var counter=[];for(var i=0;i<count;i++){counter.push(i)}return async.mapSeries(counter,iterator,callback)};async.seq=function(){var fns=arguments;return function(){var that=this;var args=Array.prototype.slice.call(arguments);var callback=args.pop();async.reduce(fns,args,function(newargs,fn,cb){fn.apply(that,newargs.concat([function(){var err=arguments[0];var nextargs=Array.prototype.slice.call(arguments,1);cb(err,nextargs)}]))},function(err,results){callback.apply(that,[err].concat(results))})}};async.compose=function(){return async.seq.apply(null,Array.prototype.reverse.call(arguments))};var _applyEach=function(eachfn,fns){var go=function(){var that=this;var args=Array.prototype.slice.call(arguments);var callback=args.pop();return eachfn(fns,function(fn,cb){fn.apply(that,args.concat([cb]))},callback)};if(arguments.length>2){var args=Array.prototype.slice.call(arguments,2);return go.apply(this,args)}else{return go}};async.applyEach=doParallel(_applyEach);async.applyEachSeries=doSeries(_applyEach);async.forever=function(fn,callback){function next(err){if(err){if(callback){return callback(err)}throw err}fn(next)}next()};if(typeof module!=="undefined"&&module.exports){module.exports=async}else if(typeof define!=="undefined"&&define.amd){define([],function(){return async})}else{root.async=async}})()}).call(this,require("_process"))},{_process:3}],13:[function(require,module,exports){var async=require("async"),urlParser=require("url"),Resource=require("./Resource"),EventEmitter=require("eventemitter3");function Loader(baseUrl,concurrency){EventEmitter.call(this);concurrency=concurrency||10;this.baseUrl=baseUrl||"";this.progress=0;this.loading=false;this._progressChunk=0;this._beforeMiddleware=[];this._afterMiddleware=[];this._boundLoadResource=this._loadResource.bind(this);this._boundOnLoad=this._onLoad.bind(this);this._buffer=[];this._numToLoad=0;this._queue=async.queue(this._boundLoadResource,concurrency);this.resources={}}Loader.prototype=Object.create(EventEmitter.prototype);Loader.prototype.constructor=Loader;module.exports=Loader;Loader.prototype.add=Loader.prototype.enqueue=function(name,url,options,cb){if(Array.isArray(name)){for(var i=0;i<name.length;++i){this.add(name[i])}return this}if(typeof name==="object"){cb=url||name.callback||name.onComplete;options=name;url=name.url;name=name.name||name.key||name.url}if(typeof url!=="string"){cb=options;options=url;url=name}if(typeof url!=="string"){throw new Error("No url passed to add resource to loader.")}if(typeof options==="function"){cb=options;options=null}if(this.resources[name]){throw new Error('Resource with name "'+name+'" already exists.')}url=this._handleBaseUrl(url);this.resources[name]=new Resource(name,url,options);if(typeof cb==="function"){this.resources[name].once("afterMiddleware",cb)}this._numToLoad++;if(this._queue.started){this._queue.push(this.resources[name]);this._progressChunk=(100-this.progress)/(this._queue.length()+this._queue.running())}else{this._buffer.push(this.resources[name]);this._progressChunk=100/this._buffer.length}return this};Loader.prototype._handleBaseUrl=function(url){var parsedUrl=urlParser.parse(url);if(parsedUrl.protocol||parsedUrl.pathname.indexOf("//")===0){return url}if(this.baseUrl.length&&this.baseUrl.lastIndexOf("/")!==this.baseUrl.length-1&&url.charAt(0)!=="/"){return this.baseUrl+"/"+url}else{return this.baseUrl+url}};Loader.prototype.before=Loader.prototype.pre=function(fn){this._beforeMiddleware.push(fn);return this};Loader.prototype.after=Loader.prototype.use=function(fn){this._afterMiddleware.push(fn);return this};Loader.prototype.reset=function(){this.progress=0;this.loading=false;this._progressChunk=0;this._buffer.length=0;this._numToLoad=0;this._queue.kill();this._queue.started=false;this.resources={}};Loader.prototype.load=function(cb){if(typeof cb==="function"){this.once("complete",cb)}if(this._queue.started){return this}this.emit("start",this);for(var i=0;i<this._buffer.length;++i){this._queue.push(this._buffer[i])}this._buffer.length=0;return this};Loader.prototype._loadResource=function(resource,dequeue){var self=this;resource._dequeue=dequeue;this._runMiddleware(resource,this._beforeMiddleware,function(){resource.load(self._boundOnLoad)})};Loader.prototype._onComplete=function(){this.emit("complete",this,this.resources)};Loader.prototype._onLoad=function(resource){this.progress+=this._progressChunk;this.emit("progress",this,resource);this._runMiddleware(resource,this._afterMiddleware,function(){resource.emit("afterMiddleware",resource);this._numToLoad--;if(this._numToLoad===0){this.progress=100;this._onComplete()}if(resource.error){this.emit("error",resource.error,this,resource)}else{this.emit("load",this,resource)}});resource._dequeue()};Loader.prototype._runMiddleware=function(resource,fns,cb){var self=this;async.eachSeries(fns,function(fn,next){fn.call(self,resource,next)},cb.bind(this,resource))};Loader.LOAD_TYPE=Resource.LOAD_TYPE;Loader.XHR_READY_STATE=Resource.XHR_READY_STATE;Loader.XHR_RESPONSE_TYPE=Resource.XHR_RESPONSE_TYPE},{"./Resource":14,async:12,eventemitter3:10,url:8}],14:[function(require,module,exports){var EventEmitter=require("eventemitter3"),_url=require("url"),useXdr=!!(window.XDomainRequest&&!("withCredentials"in new XMLHttpRequest)),tempAnchor=null;function Resource(name,url,options){EventEmitter.call(this);options=options||{};if(typeof name!=="string"||typeof url!=="string"){throw new Error("Both name and url are required for constructing a resource.")}this.name=name;this.url=url;this.isDataUrl=this.url.indexOf("data:")===0;this.data=null;this.crossOrigin=options.crossOrigin===true?"anonymous":options.crossOrigin;this.loadType=options.loadType||this._determineLoadType();this.xhrType=options.xhrType;this.metadata=options.metadata||{};this.error=null;this.xhr=null;this.isJson=false;this.isXml=false;this.isImage=false;this.isAudio=false;this.isVideo=false;this._dequeue=null;this._boundComplete=this.complete.bind(this);this._boundOnError=this._onError.bind(this);this._boundOnProgress=this._onProgress.bind(this);this._boundXhrOnError=this._xhrOnError.bind(this);this._boundXhrOnAbort=this._xhrOnAbort.bind(this);this._boundXhrOnLoad=this._xhrOnLoad.bind(this);this._boundXdrOnTimeout=this._xdrOnTimeout.bind(this)}Resource.prototype=Object.create(EventEmitter.prototype);Resource.prototype.constructor=Resource;module.exports=Resource;Resource.prototype.complete=function(){if(this.data&&this.data.removeEventListener){this.data.removeEventListener("error",this._boundOnError);this.data.removeEventListener("load",this._boundComplete);this.data.removeEventListener("progress",this._boundOnProgress);this.data.removeEventListener("canplaythrough",this._boundComplete)}if(this.xhr){if(this.xhr.removeEventListener){this.xhr.removeEventListener("error",this._boundXhrOnError);this.xhr.removeEventListener("abort",this._boundXhrOnAbort);this.xhr.removeEventListener("progress",this._boundOnProgress);this.xhr.removeEventListener("load",this._boundXhrOnLoad)}else{this.xhr.onerror=null;this.xhr.ontimeout=null;this.xhr.onprogress=null;this.xhr.onload=null}}this.emit("complete",this)};Resource.prototype.load=function(cb){this.emit("start",this);if(cb){this.once("complete",cb)}if(this.crossOrigin===false||typeof this.crossOrigin!=="string"){this.crossOrigin=this._determineCrossOrigin(this.url)}switch(this.loadType){case Resource.LOAD_TYPE.IMAGE:this._loadImage();break;case Resource.LOAD_TYPE.AUDIO:this._loadElement("audio");break;case Resource.LOAD_TYPE.VIDEO:this._loadElement("video");break;case Resource.LOAD_TYPE.XHR:default:if(useXdr&&this.crossOrigin){this._loadXdr()}else{this._loadXhr()}break}};Resource.prototype._loadImage=function(){this.data=new Image;if(this.crossOrigin){this.data.crossOrigin=this.crossOrigin}this.data.src=this.url;this.isImage=true;this.data.addEventListener("error",this._boundOnError,false);this.data.addEventListener("load",this._boundComplete,false);this.data.addEventListener("progress",this._boundOnProgress,false)};Resource.prototype._loadElement=function(type){if(type==="audio"&&typeof Audio!=="undefined"){this.data=new Audio}else{this.data=document.createElement(type)}if(this.data===null){this.error=new Error("Unsupported element "+type);this.complete();return}if(navigator.isCocoonJS){this.data.src=Array.isArray(this.url)?this.url[0]:this.url}else{if(Array.isArray(this.url)){for(var i=0;i<this.url.length;++i){this.data.appendChild(this._createSource(type,this.url[i]))}}else{this.data.appendChild(this._createSource(type,this.url))}}this["is"+type[0].toUpperCase()+type.substring(1)]=true;this.data.addEventListener("error",this._boundOnError,false);this.data.addEventListener("load",this._boundComplete,false);this.data.addEventListener("progress",this._boundOnProgress,false);this.data.addEventListener("canplaythrough",this._boundComplete,false);this.data.load()};Resource.prototype._loadXhr=function(){if(typeof this.xhrType!=="string"){this.xhrType=this._determineXhrType()}var xhr=this.xhr=new XMLHttpRequest;xhr.open("GET",this.url,true);if(this.xhrType===Resource.XHR_RESPONSE_TYPE.JSON||this.xhrType===Resource.XHR_RESPONSE_TYPE.DOCUMENT){xhr.responseType=Resource.XHR_RESPONSE_TYPE.TEXT}else{xhr.responseType=this.xhrType}xhr.addEventListener("error",this._boundXhrOnError,false);xhr.addEventListener("abort",this._boundXhrOnAbort,false);xhr.addEventListener("progress",this._boundOnProgress,false);xhr.addEventListener("load",this._boundXhrOnLoad,false);xhr.send()};Resource.prototype._loadXdr=function(){if(typeof this.xhrType!=="string"){this.xhrType=this._determineXhrType()}var xdr=this.xhr=new XDomainRequest;xdr.timeout=5e3;xdr.onerror=this._boundXhrOnError;xdr.ontimeout=this._boundXdrOnTimeout;xdr.onprogress=this._boundOnProgress;xdr.onload=this._boundXhrOnLoad;xdr.open("GET",this.url,true);setTimeout(function(){xdr.send()},0)};Resource.prototype._createSource=function(type,url,mime){if(!mime){mime=type+"/"+url.substr(url.lastIndexOf(".")+1)}var source=document.createElement("source");source.src=url;source.type=mime;return source};Resource.prototype._onError=function(event){this.error=new Error("Failed to load element using "+event.target.nodeName);this.complete()};Resource.prototype._onProgress=function(event){if(event&&event.lengthComputable){this.emit("progress",this,event.loaded/event.total)}};Resource.prototype._xhrOnError=function(){this.error=new Error(reqType(this.xhr)+" Request failed. "+"Status: "+this.xhr.status+', text: "'+this.xhr.statusText+'"');this.complete()};Resource.prototype._xhrOnAbort=function(){this.error=new Error(reqType(this.xhr)+" Request was aborted by the user.");this.complete()};Resource.prototype._xdrOnTimeout=function(){this.error=new Error(reqType(this.xhr)+" Request timed out.");this.complete()};Resource.prototype._xhrOnLoad=function(){var xhr=this.xhr,status=xhr.status!==undefined?xhr.status:200;if(status===200||status===204||status===0&&xhr.responseText.length>0){if(this.xhrType===Resource.XHR_RESPONSE_TYPE.TEXT){this.data=xhr.responseText}else if(this.xhrType===Resource.XHR_RESPONSE_TYPE.JSON){try{this.data=JSON.parse(xhr.responseText);this.isJson=true}catch(e){this.error=new Error("Error trying to parse loaded json:",e)}}else if(this.xhrType===Resource.XHR_RESPONSE_TYPE.DOCUMENT){try{if(window.DOMParser){var domparser=new DOMParser;this.data=domparser.parseFromString(xhr.responseText,"text/xml")}else{var div=document.createElement("div");div.innerHTML=xhr.responseText;this.data=div}this.isXml=true}catch(e){this.error=new Error("Error trying to parse loaded xml:",e)}}else{this.data=xhr.response||xhr.responseText}}else{this.error=new Error("["+xhr.status+"]"+xhr.statusText+":"+xhr.responseURL)}this.complete()};function reqType(xhr){return xhr.toString().replace("object ","")}Resource.prototype._determineCrossOrigin=function(url,loc){if(url.indexOf("data:")===0){return""}loc=loc||window.location;if(!tempAnchor){tempAnchor=document.createElement("a")}tempAnchor.href=url;url=_url.parse(tempAnchor.href);var samePort=!url.port&&loc.port===""||url.port===loc.port;if(url.hostname!==loc.hostname||!samePort||url.protocol!==loc.protocol){return"anonymous"}return""};Resource.prototype._determineXhrType=function(){return Resource._xhrTypeMap[this._getExtension()]||Resource.XHR_RESPONSE_TYPE.TEXT};Resource.prototype._determineLoadType=function(){return Resource._loadTypeMap[this._getExtension()]||Resource.LOAD_TYPE.XHR};Resource.prototype._getExtension=function(){var url=this.url,ext;if(this.isDataUrl){var slashIndex=url.indexOf("/");ext=url.substring(slashIndex+1,url.indexOf(";",slashIndex))}else{var queryStart=url.indexOf("?");if(queryStart!==-1){url=url.substring(0,queryStart)}ext=url.substring(url.lastIndexOf(".")+1)}return ext};Resource.prototype._getMimeFromXhrType=function(type){switch(type){case Resource.XHR_RESPONSE_TYPE.BUFFER:return"application/octet-binary";case Resource.XHR_RESPONSE_TYPE.BLOB:return"application/blob";case Resource.XHR_RESPONSE_TYPE.DOCUMENT:return"application/xml";case Resource.XHR_RESPONSE_TYPE.JSON:return"application/json";case Resource.XHR_RESPONSE_TYPE.DEFAULT:case Resource.XHR_RESPONSE_TYPE.TEXT:default:return"text/plain"}};Resource.LOAD_TYPE={XHR:1,IMAGE:2,AUDIO:3,VIDEO:4};Resource.XHR_READY_STATE={UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4};Resource.XHR_RESPONSE_TYPE={DEFAULT:"text",BUFFER:"arraybuffer",BLOB:"blob",DOCUMENT:"document",JSON:"json",TEXT:"text"};Resource._loadTypeMap={gif:Resource.LOAD_TYPE.IMAGE,png:Resource.LOAD_TYPE.IMAGE,bmp:Resource.LOAD_TYPE.IMAGE,jpg:Resource.LOAD_TYPE.IMAGE,jpeg:Resource.LOAD_TYPE.IMAGE,tif:Resource.LOAD_TYPE.IMAGE,tiff:Resource.LOAD_TYPE.IMAGE,webp:Resource.LOAD_TYPE.IMAGE,tga:Resource.LOAD_TYPE.IMAGE};Resource._xhrTypeMap={xhtml:Resource.XHR_RESPONSE_TYPE.DOCUMENT,html:Resource.XHR_RESPONSE_TYPE.DOCUMENT,htm:Resource.XHR_RESPONSE_TYPE.DOCUMENT,xml:Resource.XHR_RESPONSE_TYPE.DOCUMENT,tmx:Resource.XHR_RESPONSE_TYPE.DOCUMENT,tsx:Resource.XHR_RESPONSE_TYPE.DOCUMENT,svg:Resource.XHR_RESPONSE_TYPE.DOCUMENT,
gif:Resource.XHR_RESPONSE_TYPE.BLOB,png:Resource.XHR_RESPONSE_TYPE.BLOB,bmp:Resource.XHR_RESPONSE_TYPE.BLOB,jpg:Resource.XHR_RESPONSE_TYPE.BLOB,jpeg:Resource.XHR_RESPONSE_TYPE.BLOB,tif:Resource.XHR_RESPONSE_TYPE.BLOB,tiff:Resource.XHR_RESPONSE_TYPE.BLOB,webp:Resource.XHR_RESPONSE_TYPE.BLOB,tga:Resource.XHR_RESPONSE_TYPE.BLOB,json:Resource.XHR_RESPONSE_TYPE.JSON,text:Resource.XHR_RESPONSE_TYPE.TEXT,txt:Resource.XHR_RESPONSE_TYPE.TEXT};Resource.setExtensionLoadType=function(extname,loadType){setExtMap(Resource._loadTypeMap,extname,loadType)};Resource.setExtensionXhrType=function(extname,xhrType){setExtMap(Resource._xhrTypeMap,extname,xhrType)};function setExtMap(map,extname,val){if(extname&&extname.indexOf(".")===0){extname=extname.substring(1)}if(!extname){return}map[extname]=val}},{eventemitter3:10,url:8}],15:[function(require,module,exports){module.exports={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encodeBinary:function(input){var output="";var bytebuffer;var encodedCharIndexes=new Array(4);var inx=0;var jnx=0;var paddingBytes=0;while(inx<input.length){bytebuffer=new Array(3);for(jnx=0;jnx<bytebuffer.length;jnx++){if(inx<input.length){bytebuffer[jnx]=input.charCodeAt(inx++)&255}else{bytebuffer[jnx]=0}}encodedCharIndexes[0]=bytebuffer[0]>>2;encodedCharIndexes[1]=(bytebuffer[0]&3)<<4|bytebuffer[1]>>4;encodedCharIndexes[2]=(bytebuffer[1]&15)<<2|bytebuffer[2]>>6;encodedCharIndexes[3]=bytebuffer[2]&63;paddingBytes=inx-(input.length-1);switch(paddingBytes){case 2:encodedCharIndexes[3]=64;encodedCharIndexes[2]=64;break;case 1:encodedCharIndexes[3]=64;break;default:break}for(jnx=0;jnx<encodedCharIndexes.length;jnx++){output+=this._keyStr.charAt(encodedCharIndexes[jnx])}}return output}}},{}],16:[function(require,module,exports){module.exports=require("./Loader");module.exports.Resource=require("./Resource");module.exports.middleware={caching:{memory:require("./middlewares/caching/memory")},parsing:{blob:require("./middlewares/parsing/blob")}}},{"./Loader":13,"./Resource":14,"./middlewares/caching/memory":17,"./middlewares/parsing/blob":18}],17:[function(require,module,exports){var cache={};module.exports=function(){return function(resource,next){if(cache[resource.url]){resource.data=cache[resource.url];resource.complete()}else{resource.once("complete",function(){cache[this.url]=this.data})}next()}}},{}],18:[function(require,module,exports){var Resource=require("../../Resource"),b64=require("../../b64");window.URL=window.URL||window.webkitURL;module.exports=function(){return function(resource,next){if(!resource.data){return next()}if(resource.xhr&&resource.xhrType===Resource.XHR_RESPONSE_TYPE.BLOB){if(!window.Blob||typeof resource.data==="string"){var type=resource.xhr.getResponseHeader("content-type");if(type&&type.indexOf("image")===0){resource.data=new Image;resource.data.src="data:"+type+";base64,"+b64.encodeBinary(resource.xhr.responseText);resource.isImage=true;resource.data.onload=function(){resource.data.onload=null;next()}}}else if(resource.data.type.indexOf("image")===0){var src=URL.createObjectURL(resource.data);resource.blob=resource.data;resource.data=new Image;resource.data.src=src;resource.isImage=true;resource.data.onload=function(){URL.revokeObjectURL(src);resource.data.onload=null;next()}}}else{next()}}}},{"../../Resource":14,"../../b64":15}],19:[function(require,module,exports){var core=require("../core");Object.assign(core.DisplayObject.prototype,require("./accessibleTarget"));function AccessibilityManager(renderer){var div=document.createElement("div");div.style.width=100+"px";div.style.height=100+"px";div.style.position="absolute";div.style.top=0;div.style.left=0;div.style.zIndex=2;this.div=div;this.pool=[];this.renderId=0;this.debug=false;this.renderer=renderer;this.children=[];this._onKeyDown=this._onKeyDown.bind(this);this._onMouseMove=this._onMouseMove.bind(this);this.isActive=false;window.addEventListener("keydown",this._onKeyDown,false)}AccessibilityManager.prototype.constructor=AccessibilityManager;module.exports=AccessibilityManager;AccessibilityManager.prototype.activate=function(){if(this.isActive){return}this.isActive=true;window.document.addEventListener("mousemove",this._onMouseMove,true);window.removeEventListener("keydown",this._onKeyDown,false);this.renderer.on("postrender",this.update,this);this.renderer.view.parentNode.appendChild(this.div)};AccessibilityManager.prototype.deactivate=function(){if(!this.isActive){return}this.isActive=false;window.document.removeEventListener("mousemove",this._onMouseMove);window.addEventListener("keydown",this._onKeyDown,false);this.renderer.off("postrender",this.update);this.div.parentNode.removeChild(this.div)};AccessibilityManager.prototype.updateAccessibleObjects=function(displayObject){if(!displayObject.visible){return}if(displayObject.accessible&&displayObject.interactive){if(!displayObject._accessibleActive){this.addChild(displayObject)}displayObject.renderId=this.renderId}if(displayObject.interactiveChildren){var children=displayObject.children;for(var i=children.length-1;i>=0;i--){this.updateAccessibleObjects(children[i])}}};AccessibilityManager.prototype.update=function(){this.updateAccessibleObjects(this.renderer._lastObjectRendered);var rect=this.renderer.view.getBoundingClientRect();var sx=rect.width/this.renderer.width;var sy=rect.height/this.renderer.height;var div=this.div;div.style.left=rect.left+"px";div.style.top=rect.top+"px";div.style.width=this.renderer.width+"px";div.style.height=this.renderer.height+"px";for(var i=0;i<this.children.length;i++){var child=this.children[i];if(child.renderId!==this.renderId){child._accessibleActive=false;core.utils.removeItems(this.children,i,1);this.div.removeChild(child._accessibleDiv);this.pool.push(child._accessibleDiv);child._accessibleDiv=null;i--;if(this.children.length===0){this.deactivate()}}else{div=child._accessibleDiv;var hitArea=child.hitArea;var wt=child.worldTransform;if(child.hitArea){div.style.left=(wt.tx+hitArea.x*wt.a)*sx+"px";div.style.top=(wt.ty+hitArea.y*wt.d)*sy+"px";div.style.width=hitArea.width*wt.a*sx+"px";div.style.height=hitArea.height*wt.d*sy+"px"}else{hitArea=child.getBounds();this.capHitArea(hitArea);div.style.left=hitArea.x*sx+"px";div.style.top=hitArea.y*sy+"px";div.style.width=hitArea.width*sx+"px";div.style.height=hitArea.height*sy+"px"}}}this.renderId++};AccessibilityManager.prototype.capHitArea=function(hitArea){if(hitArea.x<0){hitArea.width+=hitArea.x;hitArea.x=0}if(hitArea.y<0){hitArea.height+=hitArea.y;hitArea.y=0}if(hitArea.x+hitArea.width>this.renderer.width){hitArea.width=this.renderer.width-hitArea.x}if(hitArea.y+hitArea.height>this.renderer.height){hitArea.height=this.renderer.height-hitArea.y}};AccessibilityManager.prototype.addChild=function(displayObject){var div=this.pool.pop();if(!div){div=document.createElement("button");div.style.width=100+"px";div.style.height=100+"px";div.style.backgroundColor=this.debug?"rgba(255,0,0,0.5)":"transparent";div.style.position="absolute";div.style.zIndex=2;div.style.borderStyle="none";div.addEventListener("click",this._onClick.bind(this));div.addEventListener("focus",this._onFocus.bind(this));div.addEventListener("focusout",this._onFocusOut.bind(this))}div.title=displayObject.accessibleTitle||"displayObject "+this.tabIndex;displayObject._accessibleActive=true;displayObject._accessibleDiv=div;div.displayObject=displayObject;this.children.push(displayObject);this.div.appendChild(displayObject._accessibleDiv);displayObject._accessibleDiv.tabIndex=displayObject.tabIndex};AccessibilityManager.prototype._onClick=function(e){var interactionManager=this.renderer.plugins.interaction;interactionManager.dispatchEvent(e.target.displayObject,"click",interactionManager.eventData)};AccessibilityManager.prototype._onFocus=function(e){var interactionManager=this.renderer.plugins.interaction;interactionManager.dispatchEvent(e.target.displayObject,"mouseover",interactionManager.eventData)};AccessibilityManager.prototype._onFocusOut=function(e){var interactionManager=this.renderer.plugins.interaction;interactionManager.dispatchEvent(e.target.displayObject,"mouseout",interactionManager.eventData)};AccessibilityManager.prototype._onKeyDown=function(e){if(e.keyCode!==9){return}this.activate()};AccessibilityManager.prototype._onMouseMove=function(){this.deactivate()};AccessibilityManager.prototype.destroy=function(){this.div=null;for(var i=0;i<this.children.length;i++){this.children[i].div=null}window.document.removeEventListener("mousemove",this._onMouseMove);window.removeEventListener("keydown",this._onKeyDown);this.pool=null;this.children=null;this.renderer=null};core.WebGLRenderer.registerPlugin("accessibility",AccessibilityManager);core.CanvasRenderer.registerPlugin("accessibility",AccessibilityManager)},{"../core":29,"./accessibleTarget":20}],20:[function(require,module,exports){var accessibleTarget={accessible:false,accessibleTitle:null,tabIndex:0,_accessibleActive:false,_accessibleDiv:false};module.exports=accessibleTarget},{}],21:[function(require,module,exports){module.exports={accessibleTarget:require("./accessibleTarget"),AccessibilityManager:require("./AccessibilityManager")}},{"./AccessibilityManager":19,"./accessibleTarget":20}],22:[function(require,module,exports){var CONST={VERSION:"3.0.10",PI_2:Math.PI*2,RAD_TO_DEG:180/Math.PI,DEG_TO_RAD:Math.PI/180,TARGET_FPMS:.06,RENDERER_TYPE:{UNKNOWN:0,WEBGL:1,CANVAS:2},BLEND_MODES:{NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},DRAW_MODES:{POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},SCALE_MODES:{DEFAULT:0,LINEAR:0,NEAREST:1},RETINA_PREFIX:/@(.+)x/,RESOLUTION:1,FILTER_RESOLUTION:1,DEFAULT_RENDER_OPTIONS:{view:null,resolution:1,antialias:false,forceFXAA:false,autoResize:false,transparent:false,backgroundColor:0,clearBeforeRender:true,preserveDrawingBuffer:false,roundPixels:false},SHAPES:{POLY:0,RECT:1,CIRC:2,ELIP:3,RREC:4},SPRITE_BATCH_SIZE:2e3};module.exports=CONST},{}],23:[function(require,module,exports){var math=require("../math"),utils=require("../utils"),DisplayObject=require("./DisplayObject"),RenderTexture=require("../textures/RenderTexture"),_tempMatrix=new math.Matrix;function Container(){DisplayObject.call(this);this.children=[]}Container.prototype=Object.create(DisplayObject.prototype);Container.prototype.constructor=Container;module.exports=Container;Object.defineProperties(Container.prototype,{width:{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(value){var width=this.getLocalBounds().width;if(width!==0){this.scale.x=value/width}else{this.scale.x=1}this._width=value}},height:{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(value){var height=this.getLocalBounds().height;if(height!==0){this.scale.y=value/height}else{this.scale.y=1}this._height=value}}});Container.prototype.onChildrenChange=function(){};Container.prototype.addChild=function(child){var argumentsLength=arguments.length;if(argumentsLength>1){for(var i=0;i<argumentsLength;i++){this.addChild(arguments[i])}}else{if(child.parent){child.parent.removeChild(child)}child.parent=this;this.children.push(child);this.onChildrenChange(this.children.length-1);child.emit("added",this)}return child};Container.prototype.addChildAt=function(child,index){if(index>=0&&index<=this.children.length){if(child.parent){child.parent.removeChild(child)}child.parent=this;this.children.splice(index,0,child);this.onChildrenChange(index);child.emit("added",this);return child}else{throw new Error(child+"addChildAt: The index "+index+" supplied is out of bounds "+this.children.length)}};Container.prototype.swapChildren=function(child,child2){if(child===child2){return}var index1=this.getChildIndex(child);var index2=this.getChildIndex(child2);if(index1<0||index2<0){throw new Error("swapChildren: Both the supplied DisplayObjects must be children of the caller.")}this.children[index1]=child2;this.children[index2]=child;this.onChildrenChange(index1<index2?index1:index2)};Container.prototype.getChildIndex=function(child){var index=this.children.indexOf(child);if(index===-1){throw new Error("The supplied DisplayObject must be a child of the caller")}return index};Container.prototype.setChildIndex=function(child,index){if(index<0||index>=this.children.length){throw new Error("The supplied index is out of bounds")}var currentIndex=this.getChildIndex(child);utils.removeItems(this.children,currentIndex,1);this.children.splice(index,0,child);this.onChildrenChange(index)};Container.prototype.getChildAt=function(index){if(index<0||index>=this.children.length){throw new Error("getChildAt: Supplied index "+index+" does not exist in the child list, or the supplied DisplayObject is not a child of the caller")}return this.children[index]};Container.prototype.removeChild=function(child){var argumentsLength=arguments.length;if(argumentsLength>1){for(var i=0;i<argumentsLength;i++){this.removeChild(arguments[i])}}else{var index=this.children.indexOf(child);if(index===-1){return}child.parent=null;utils.removeItems(this.children,index,1);this.onChildrenChange(index);child.emit("removed",this)}return child};Container.prototype.removeChildAt=function(index){var child=this.getChildAt(index);child.parent=null;utils.removeItems(this.children,index,1);this.onChildrenChange(index);child.emit("removed",this);return child};Container.prototype.removeChildren=function(beginIndex,endIndex){var begin=beginIndex||0;var end=typeof endIndex==="number"?endIndex:this.children.length;var range=end-begin;var removed,i;if(range>0&&range<=end){removed=this.children.splice(begin,range);for(i=0;i<removed.length;++i){removed[i].parent=null}this.onChildrenChange(beginIndex);for(i=0;i<removed.length;++i){removed[i].emit("removed",this)}return removed}else if(range===0&&this.children.length===0){return[]}else{throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}};Container.prototype.generateTexture=function(renderer,resolution,scaleMode){var bounds=this.getLocalBounds();var renderTexture=new RenderTexture(renderer,bounds.width|0,bounds.height|0,scaleMode,resolution);_tempMatrix.tx=-bounds.x;_tempMatrix.ty=-bounds.y;renderTexture.render(this,_tempMatrix);return renderTexture};Container.prototype.updateTransform=function(){if(!this.visible){return}this.displayObjectUpdateTransform();for(var i=0,j=this.children.length;i<j;++i){this.children[i].updateTransform()}};Container.prototype.containerUpdateTransform=Container.prototype.updateTransform;Container.prototype.getBounds=function(){if(!this._currentBounds){if(this.children.length===0){return math.Rectangle.EMPTY}var minX=Infinity;var minY=Infinity;var maxX=-Infinity;var maxY=-Infinity;var childBounds;var childMaxX;var childMaxY;var childVisible=false;for(var i=0,j=this.children.length;i<j;++i){var child=this.children[i];if(!child.visible){continue}childVisible=true;childBounds=this.children[i].getBounds();minX=minX<childBounds.x?minX:childBounds.x;minY=minY<childBounds.y?minY:childBounds.y;childMaxX=childBounds.width+childBounds.x;childMaxY=childBounds.height+childBounds.y;maxX=maxX>childMaxX?maxX:childMaxX;maxY=maxY>childMaxY?maxY:childMaxY}if(!childVisible){return math.Rectangle.EMPTY}var bounds=this._bounds;bounds.x=minX;bounds.y=minY;bounds.width=maxX-minX;bounds.height=maxY-minY;this._currentBounds=bounds}return this._currentBounds};Container.prototype.containerGetBounds=Container.prototype.getBounds;Container.prototype.getLocalBounds=function(){var matrixCache=this.worldTransform;this.worldTransform=math.Matrix.IDENTITY;for(var i=0,j=this.children.length;i<j;++i){this.children[i].updateTransform()}this.worldTransform=matrixCache;this._currentBounds=null;return this.getBounds(math.Matrix.IDENTITY)};Container.prototype.renderWebGL=function(renderer){if(!this.visible||this.worldAlpha<=0||!this.renderable){return}var i,j;if(this._mask||this._filters){renderer.currentRenderer.flush();if(this._filters&&this._filters.length){renderer.filterManager.pushFilter(this,this._filters)}if(this._mask){renderer.maskManager.pushMask(this,this._mask)}renderer.currentRenderer.start();this._renderWebGL(renderer);for(i=0,j=this.children.length;i<j;i++){this.children[i].renderWebGL(renderer)}renderer.currentRenderer.flush();if(this._mask){renderer.maskManager.popMask(this,this._mask)}if(this._filters){renderer.filterManager.popFilter()}renderer.currentRenderer.start()}else{this._renderWebGL(renderer);for(i=0,j=this.children.length;i<j;++i){this.children[i].renderWebGL(renderer)}}};Container.prototype._renderWebGL=function(renderer){};Container.prototype._renderCanvas=function(renderer){};Container.prototype.renderCanvas=function(renderer){if(!this.visible||this.alpha<=0||!this.renderable){return}if(this._mask){renderer.maskManager.pushMask(this._mask,renderer)}this._renderCanvas(renderer);for(var i=0,j=this.children.length;i<j;++i){this.children[i].renderCanvas(renderer)}if(this._mask){renderer.maskManager.popMask(renderer)}};Container.prototype.destroy=function(destroyChildren){DisplayObject.prototype.destroy.call(this);if(destroyChildren){for(var i=0,j=this.children.length;i<j;++i){this.children[i].destroy(destroyChildren)}}this.removeChildren();this.children=null}},{"../math":33,"../textures/RenderTexture":71,"../utils":77,"./DisplayObject":24}],24:[function(require,module,exports){var math=require("../math"),RenderTexture=require("../textures/RenderTexture"),EventEmitter=require("eventemitter3"),CONST=require("../const"),_tempMatrix=new math.Matrix,_tempDisplayObjectParent={worldTransform:new math.Matrix,worldAlpha:1,children:[]};function DisplayObject(){EventEmitter.call(this);this.position=new math.Point;this.scale=new math.Point(1,1);this.pivot=new math.Point(0,0);this.skew=new math.Point(0,0);this.rotation=0;this.alpha=1;this.visible=true;this.renderable=true;this.parent=null;this.worldAlpha=1;this.worldTransform=new math.Matrix;this.filterArea=null;this._sr=0;this._cr=1;this._bounds=new math.Rectangle(0,0,1,1);this._currentBounds=null;this._mask=null}DisplayObject.prototype=Object.create(EventEmitter.prototype);DisplayObject.prototype.constructor=DisplayObject;module.exports=DisplayObject;Object.defineProperties(DisplayObject.prototype,{x:{get:function(){return this.position.x},set:function(value){this.position.x=value}},y:{get:function(){return this.position.y},set:function(value){this.position.y=value}},worldVisible:{get:function(){var item=this;do{if(!item.visible){return false}item=item.parent}while(item);return true}},mask:{get:function(){return this._mask},set:function(value){if(this._mask){this._mask.renderable=true}this._mask=value;if(this._mask){this._mask.renderable=false}}},filters:{get:function(){return this._filters&&this._filters.slice()},set:function(value){this._filters=value&&value.slice()}}});DisplayObject.prototype.updateTransform=function(){var pt=this.parent.worldTransform;var wt=this.worldTransform;var a,b,c,d,tx,ty;if(this.skew.x||this.skew.y){_tempMatrix.setTransform(this.position.x,this.position.y,this.pivot.x,this.pivot.y,this.scale.x,this.scale.y,this.rotation,this.skew.x,this.skew.y);wt.a=_tempMatrix.a*pt.a+_tempMatrix.b*pt.c;wt.b=_tempMatrix.a*pt.b+_tempMatrix.b*pt.d;wt.c=_tempMatrix.c*pt.a+_tempMatrix.d*pt.c;wt.d=_tempMatrix.c*pt.b+_tempMatrix.d*pt.d;wt.tx=_tempMatrix.tx*pt.a+_tempMatrix.ty*pt.c+pt.tx;wt.ty=_tempMatrix.tx*pt.b+_tempMatrix.ty*pt.d+pt.ty}else{if(this.rotation%CONST.PI_2){if(this.rotation!==this.rotationCache){this.rotationCache=this.rotation;this._sr=Math.sin(this.rotation);this._cr=Math.cos(this.rotation)}a=this._cr*this.scale.x;b=this._sr*this.scale.x;c=-this._sr*this.scale.y;d=this._cr*this.scale.y;tx=this.position.x;ty=this.position.y;if(this.pivot.x||this.pivot.y){tx-=this.pivot.x*a+this.pivot.y*c;ty-=this.pivot.x*b+this.pivot.y*d}wt.a=a*pt.a+b*pt.c;wt.b=a*pt.b+b*pt.d;wt.c=c*pt.a+d*pt.c;wt.d=c*pt.b+d*pt.d;wt.tx=tx*pt.a+ty*pt.c+pt.tx;wt.ty=tx*pt.b+ty*pt.d+pt.ty}else{a=this.scale.x;d=this.scale.y;tx=this.position.x-this.pivot.x*a;ty=this.position.y-this.pivot.y*d;wt.a=a*pt.a;wt.b=a*pt.b;wt.c=d*pt.c;wt.d=d*pt.d;wt.tx=tx*pt.a+ty*pt.c+pt.tx;wt.ty=tx*pt.b+ty*pt.d+pt.ty}}this.worldAlpha=this.alpha*this.parent.worldAlpha;this._currentBounds=null};DisplayObject.prototype.displayObjectUpdateTransform=DisplayObject.prototype.updateTransform;DisplayObject.prototype.getBounds=function(matrix){return math.Rectangle.EMPTY};DisplayObject.prototype.getLocalBounds=function(){return this.getBounds(math.Matrix.IDENTITY)};DisplayObject.prototype.toGlobal=function(position){if(!this.parent){this.parent=_tempDisplayObjectParent;this.displayObjectUpdateTransform();this.parent=null}else{this.displayObjectUpdateTransform()}return this.worldTransform.apply(position)};DisplayObject.prototype.toLocal=function(position,from,point){if(from){position=from.toGlobal(position)}if(!this.parent){this.parent=_tempDisplayObjectParent;this.displayObjectUpdateTransform();this.parent=null}else{this.displayObjectUpdateTransform()}return this.worldTransform.applyInverse(position,point)};DisplayObject.prototype.renderWebGL=function(renderer){};DisplayObject.prototype.renderCanvas=function(renderer){};DisplayObject.prototype.generateTexture=function(renderer,scaleMode,resolution){var bounds=this.getLocalBounds();var renderTexture=new RenderTexture(renderer,bounds.width|0,bounds.height|0,scaleMode,resolution);_tempMatrix.tx=-bounds.x;_tempMatrix.ty=-bounds.y;renderTexture.render(this,_tempMatrix);return renderTexture};DisplayObject.prototype.setParent=function(container){if(!container||!container.addChild){throw new Error("setParent: Argument must be a Container")}container.addChild(this);return container};DisplayObject.prototype.setTransform=function(x,y,scaleX,scaleY,rotation,skewX,skewY,pivotX,pivotY){this.position.x=x||0;this.position.y=y||0;this.scale.x=!scaleX?1:scaleX;this.scale.y=!scaleY?1:scaleY;this.rotation=rotation||0;this.skew.x=skewX||0;this.skew.y=skewY||0;this.pivot.x=pivotX||0;this.pivot.y=pivotY||0;return this};DisplayObject.prototype.destroy=function(){this.position=null;this.scale=null;this.pivot=null;this.skew=null;this.parent=null;this._bounds=null;this._currentBounds=null;this._mask=null;this.worldTransform=null;this.filterArea=null}},{"../const":22,"../math":33,"../textures/RenderTexture":71,eventemitter3:10}],25:[function(require,module,exports){var Container=require("../display/Container"),Texture=require("../textures/Texture"),CanvasBuffer=require("../renderers/canvas/utils/CanvasBuffer"),CanvasGraphics=require("../renderers/canvas/utils/CanvasGraphics"),GraphicsData=require("./GraphicsData"),math=require("../math"),CONST=require("../const"),tempPoint=new math.Point;function Graphics(){Container.call(this);this.fillAlpha=1;this.lineWidth=0;this.lineColor=0;this.graphicsData=[];this.tint=16777215;this._prevTint=16777215;this.blendMode=CONST.BLEND_MODES.NORMAL;this.currentPath=null;this._webGL={};this.isMask=false;this.boundsPadding=0;this._localBounds=new math.Rectangle(0,0,1,1);this.dirty=true;this.glDirty=false;this.boundsDirty=true;this.cachedSpriteDirty=false}Graphics.prototype=Object.create(Container.prototype);Graphics.prototype.constructor=Graphics;module.exports=Graphics;Graphics.prototype.clone=function(){var clone=new Graphics;clone.renderable=this.renderable;clone.fillAlpha=this.fillAlpha;clone.lineWidth=this.lineWidth;clone.lineColor=this.lineColor;clone.tint=this.tint;clone.blendMode=this.blendMode;clone.isMask=this.isMask;clone.boundsPadding=this.boundsPadding;clone.dirty=true;clone.glDirty=true;clone.cachedSpriteDirty=this.cachedSpriteDirty;for(var i=0;i<this.graphicsData.length;++i){clone.graphicsData.push(this.graphicsData[i].clone())}clone.currentPath=clone.graphicsData[clone.graphicsData.length-1];clone.updateLocalBounds();return clone};Graphics.prototype.lineStyle=function(lineWidth,color,alpha){this.lineWidth=lineWidth||0;this.lineColor=color||0;this.lineAlpha=alpha===undefined?1:alpha;if(this.currentPath){if(this.currentPath.shape.points.length){var shape=new math.Polygon(this.currentPath.shape.points.slice(-2));shape.closed=false;this.drawShape(shape)}else{this.currentPath.lineWidth=this.lineWidth;this.currentPath.lineColor=this.lineColor;this.currentPath.lineAlpha=this.lineAlpha}}return this};Graphics.prototype.moveTo=function(x,y){var shape=new math.Polygon([x,y]);shape.closed=false;this.drawShape(shape);return this};Graphics.prototype.lineTo=function(x,y){this.currentPath.shape.points.push(x,y);this.dirty=true;return this};Graphics.prototype.quadraticCurveTo=function(cpX,cpY,toX,toY){if(this.currentPath){if(this.currentPath.shape.points.length===0){this.currentPath.shape.points=[0,0]}}else{this.moveTo(0,0)}var xa,ya,n=20,points=this.currentPath.shape.points;if(points.length===0){this.moveTo(0,0)}var fromX=points[points.length-2];var fromY=points[points.length-1];var j=0;for(var i=1;i<=n;++i){j=i/n;xa=fromX+(cpX-fromX)*j;ya=fromY+(cpY-fromY)*j;points.push(xa+(cpX+(toX-cpX)*j-xa)*j,ya+(cpY+(toY-cpY)*j-ya)*j)}this.dirty=this.boundsDirty=true;return this};Graphics.prototype.bezierCurveTo=function(cpX,cpY,cpX2,cpY2,toX,toY){if(this.currentPath){if(this.currentPath.shape.points.length===0){this.currentPath.shape.points=[0,0]}}else{this.moveTo(0,0)}var n=20,dt,dt2,dt3,t2,t3,points=this.currentPath.shape.points;var fromX=points[points.length-2];var fromY=points[points.length-1];var j=0;for(var i=1;i<=n;++i){j=i/n;dt=1-j;dt2=dt*dt;dt3=dt2*dt;t2=j*j;t3=t2*j;points.push(dt3*fromX+3*dt2*j*cpX+3*dt*t2*cpX2+t3*toX,dt3*fromY+3*dt2*j*cpY+3*dt*t2*cpY2+t3*toY)}this.dirty=this.boundsDirty=true;return this};Graphics.prototype.arcTo=function(x1,y1,x2,y2,radius){if(this.currentPath){if(this.currentPath.shape.points.length===0){this.currentPath.shape.points.push(x1,y1)}}else{this.moveTo(x1,y1)}var points=this.currentPath.shape.points,fromX=points[points.length-2],fromY=points[points.length-1],a1=fromY-y1,b1=fromX-x1,a2=y2-y1,b2=x2-x1,mm=Math.abs(a1*b2-b1*a2);if(mm<1e-8||radius===0){if(points[points.length-2]!==x1||points[points.length-1]!==y1){points.push(x1,y1)}}else{var dd=a1*a1+b1*b1,cc=a2*a2+b2*b2,tt=a1*a2+b1*b2,k1=radius*Math.sqrt(dd)/mm,k2=radius*Math.sqrt(cc)/mm,j1=k1*tt/dd,j2=k2*tt/cc,cx=k1*b2+k2*b1,cy=k1*a2+k2*a1,px=b1*(k2+j1),py=a1*(k2+j1),qx=b2*(k1+j2),qy=a2*(k1+j2),startAngle=Math.atan2(py-cy,px-cx),endAngle=Math.atan2(qy-cy,qx-cx);this.arc(cx+x1,cy+y1,radius,startAngle,endAngle,b1*a2>b2*a1)}this.dirty=this.boundsDirty=true;return this};Graphics.prototype.arc=function(cx,cy,radius,startAngle,endAngle,anticlockwise){anticlockwise=anticlockwise||false;if(startAngle===endAngle){return this}if(!anticlockwise&&endAngle<=startAngle){endAngle+=Math.PI*2}else if(anticlockwise&&startAngle<=endAngle){startAngle+=Math.PI*2}var sweep=anticlockwise?(startAngle-endAngle)*-1:endAngle-startAngle;var segs=Math.ceil(Math.abs(sweep)/(Math.PI*2))*40;if(sweep===0){return this}var startX=cx+Math.cos(startAngle)*radius;var startY=cy+Math.sin(startAngle)*radius;if(this.currentPath){this.currentPath.shape.points.push(startX,startY)}else{this.moveTo(startX,startY)}var points=this.currentPath.shape.points;var theta=sweep/(segs*2);var theta2=theta*2;var cTheta=Math.cos(theta);var sTheta=Math.sin(theta);var segMinus=segs-1;var remainder=segMinus%1/segMinus;for(var i=0;i<=segMinus;i++){var real=i+remainder*i;var angle=theta+startAngle+theta2*real;var c=Math.cos(angle);var s=-Math.sin(angle);points.push((cTheta*c+sTheta*s)*radius+cx,(cTheta*-s+sTheta*c)*radius+cy)}this.dirty=this.boundsDirty=true;return this};Graphics.prototype.beginFill=function(color,alpha){this.filling=true;this.fillColor=color||0;this.fillAlpha=alpha===undefined?1:alpha;if(this.currentPath){if(this.currentPath.shape.points.length<=2){this.currentPath.fill=this.filling;this.currentPath.fillColor=this.fillColor;this.currentPath.fillAlpha=this.fillAlpha}}return this};Graphics.prototype.endFill=function(){this.filling=false;this.fillColor=null;this.fillAlpha=1;return this};Graphics.prototype.drawRect=function(x,y,width,height){this.drawShape(new math.Rectangle(x,y,width,height));return this};Graphics.prototype.drawRoundedRect=function(x,y,width,height,radius){this.drawShape(new math.RoundedRectangle(x,y,width,height,radius));return this};Graphics.prototype.drawCircle=function(x,y,radius){this.drawShape(new math.Circle(x,y,radius));return this};Graphics.prototype.drawEllipse=function(x,y,width,height){this.drawShape(new math.Ellipse(x,y,width,height));return this};Graphics.prototype.drawPolygon=function(path){var points=path;var closed=true;if(points instanceof math.Polygon){closed=points.closed;points=points.points}if(!Array.isArray(points)){points=new Array(arguments.length);for(var i=0;i<points.length;++i){points[i]=arguments[i]}}var shape=new math.Polygon(points);shape.closed=closed;this.drawShape(shape);return this};Graphics.prototype.clear=function(){this.lineWidth=0;this.filling=false;this.dirty=true;this.clearDirty=true;this.graphicsData=[];return this};Graphics.prototype.generateTexture=function(renderer,resolution,scaleMode){resolution=resolution||1;var bounds=this.getLocalBounds();var canvasBuffer=new CanvasBuffer(bounds.width*resolution,bounds.height*resolution);var texture=Texture.fromCanvas(canvasBuffer.canvas,scaleMode);texture.baseTexture.resolution=resolution;canvasBuffer.context.scale(resolution,resolution);canvasBuffer.context.translate(-bounds.x,-bounds.y);CanvasGraphics.renderGraphics(this,canvasBuffer.context);return texture};Graphics.prototype._renderWebGL=function(renderer){if(this.glDirty){this.dirty=true;this.glDirty=false}renderer.setObjectRenderer(renderer.plugins.graphics);renderer.plugins.graphics.render(this)};Graphics.prototype._renderCanvas=function(renderer){if(this.isMask===true){return}if(this._prevTint!==this.tint){this.dirty=true}var context=renderer.context;var transform=this.worldTransform;var compositeOperation=renderer.blendModes[this.blendMode];if(compositeOperation!==context.globalCompositeOperation){context.globalCompositeOperation=compositeOperation}var resolution=renderer.resolution;context.setTransform(transform.a*resolution,transform.b*resolution,transform.c*resolution,transform.d*resolution,transform.tx*resolution,transform.ty*resolution);CanvasGraphics.renderGraphics(this,context)};Graphics.prototype.getBounds=function(matrix){if(!this._currentBounds){if(!this.renderable){return math.Rectangle.EMPTY}if(this.boundsDirty){this.updateLocalBounds();this.glDirty=true;this.cachedSpriteDirty=true;this.boundsDirty=false}var bounds=this._localBounds;var w0=bounds.x;var w1=bounds.width+bounds.x;var h0=bounds.y;var h1=bounds.height+bounds.y;var worldTransform=matrix||this.worldTransform;var a=worldTransform.a;var b=worldTransform.b;var c=worldTransform.c;var d=worldTransform.d;var tx=worldTransform.tx;var ty=worldTransform.ty;var x1=a*w1+c*h1+tx;var y1=d*h1+b*w1+ty;var x2=a*w0+c*h1+tx;var y2=d*h1+b*w0+ty;var x3=a*w0+c*h0+tx;var y3=d*h0+b*w0+ty;var x4=a*w1+c*h0+tx;var y4=d*h0+b*w1+ty;var maxX=x1;var maxY=y1;var minX=x1;var minY=y1;minX=x2<minX?x2:minX;minX=x3<minX?x3:minX;minX=x4<minX?x4:minX;minY=y2<minY?y2:minY;minY=y3<minY?y3:minY;minY=y4<minY?y4:minY;maxX=x2>maxX?x2:maxX;maxX=x3>maxX?x3:maxX;maxX=x4>maxX?x4:maxX;maxY=y2>maxY?y2:maxY;maxY=y3>maxY?y3:maxY;maxY=y4>maxY?y4:maxY;this._bounds.x=minX;this._bounds.width=maxX-minX;this._bounds.y=minY;this._bounds.height=maxY-minY;this._currentBounds=this._bounds}return this._currentBounds};Graphics.prototype.containsPoint=function(point){this.worldTransform.applyInverse(point,tempPoint);var graphicsData=this.graphicsData;for(var i=0;i<graphicsData.length;i++){var data=graphicsData[i];if(!data.fill){continue}if(data.shape){if(data.shape.contains(tempPoint.x,tempPoint.y)){return true}}}return false};Graphics.prototype.updateLocalBounds=function(){var minX=Infinity;var maxX=-Infinity;var minY=Infinity;var maxY=-Infinity;if(this.graphicsData.length){var shape,points,x,y,w,h;
for(var i=0;i<this.graphicsData.length;i++){var data=this.graphicsData[i];var type=data.type;var lineWidth=data.lineWidth;shape=data.shape;if(type===CONST.SHAPES.RECT||type===CONST.SHAPES.RREC){x=shape.x-lineWidth/2;y=shape.y-lineWidth/2;w=shape.width+lineWidth;h=shape.height+lineWidth;minX=x<minX?x:minX;maxX=x+w>maxX?x+w:maxX;minY=y<minY?y:minY;maxY=y+h>maxY?y+h:maxY}else if(type===CONST.SHAPES.CIRC){x=shape.x;y=shape.y;w=shape.radius+lineWidth/2;h=shape.radius+lineWidth/2;minX=x-w<minX?x-w:minX;maxX=x+w>maxX?x+w:maxX;minY=y-h<minY?y-h:minY;maxY=y+h>maxY?y+h:maxY}else if(type===CONST.SHAPES.ELIP){x=shape.x;y=shape.y;w=shape.width+lineWidth/2;h=shape.height+lineWidth/2;minX=x-w<minX?x-w:minX;maxX=x+w>maxX?x+w:maxX;minY=y-h<minY?y-h:minY;maxY=y+h>maxY?y+h:maxY}else{points=shape.points;for(var j=0;j<points.length;j+=2){x=points[j];y=points[j+1];minX=x-lineWidth<minX?x-lineWidth:minX;maxX=x+lineWidth>maxX?x+lineWidth:maxX;minY=y-lineWidth<minY?y-lineWidth:minY;maxY=y+lineWidth>maxY?y+lineWidth:maxY}}}}else{minX=0;maxX=0;minY=0;maxY=0}var padding=this.boundsPadding;this._localBounds.x=minX-padding;this._localBounds.width=maxX-minX+padding*2;this._localBounds.y=minY-padding;this._localBounds.height=maxY-minY+padding*2};Graphics.prototype.drawShape=function(shape){if(this.currentPath){if(this.currentPath.shape.points.length<=2){this.graphicsData.pop()}}this.currentPath=null;var data=new GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.filling,shape);this.graphicsData.push(data);if(data.type===CONST.SHAPES.POLY){data.shape.closed=data.shape.closed||this.filling;this.currentPath=data}this.dirty=this.boundsDirty=true;return data};Graphics.prototype.destroy=function(){Container.prototype.destroy.apply(this,arguments);for(var i=0;i<this.graphicsData.length;++i){this.graphicsData[i].destroy()}for(var id in this._webgl){for(var j=0;j<this._webgl[id].data.length;++j){this._webgl[id].data[j].destroy()}}this.graphicsData=null;this.currentPath=null;this._webgl=null;this._localBounds=null}},{"../const":22,"../display/Container":23,"../math":33,"../renderers/canvas/utils/CanvasBuffer":45,"../renderers/canvas/utils/CanvasGraphics":46,"../textures/Texture":72,"./GraphicsData":26}],26:[function(require,module,exports){function GraphicsData(lineWidth,lineColor,lineAlpha,fillColor,fillAlpha,fill,shape){this.lineWidth=lineWidth;this.lineColor=lineColor;this.lineAlpha=lineAlpha;this._lineTint=lineColor;this.fillColor=fillColor;this.fillAlpha=fillAlpha;this._fillTint=fillColor;this.fill=fill;this.shape=shape;this.type=shape.type}GraphicsData.prototype.constructor=GraphicsData;module.exports=GraphicsData;GraphicsData.prototype.clone=function(){return new GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)};GraphicsData.prototype.destroy=function(){this.shape=null}},{}],27:[function(require,module,exports){var utils=require("../../utils"),math=require("../../math"),CONST=require("../../const"),ObjectRenderer=require("../../renderers/webgl/utils/ObjectRenderer"),WebGLRenderer=require("../../renderers/webgl/WebGLRenderer"),WebGLGraphicsData=require("./WebGLGraphicsData"),earcut=require("earcut");function GraphicsRenderer(renderer){ObjectRenderer.call(this,renderer);this.graphicsDataPool=[];this.primitiveShader=null;this.complexPrimitiveShader=null;this.maximumSimplePolySize=200}GraphicsRenderer.prototype=Object.create(ObjectRenderer.prototype);GraphicsRenderer.prototype.constructor=GraphicsRenderer;module.exports=GraphicsRenderer;WebGLRenderer.registerPlugin("graphics",GraphicsRenderer);GraphicsRenderer.prototype.onContextChange=function(){};GraphicsRenderer.prototype.destroy=function(){ObjectRenderer.prototype.destroy.call(this);for(var i=0;i<this.graphicsDataPool.length;++i){this.graphicsDataPool[i].destroy()}this.graphicsDataPool=null};GraphicsRenderer.prototype.render=function(graphics){var renderer=this.renderer;var gl=renderer.gl;var shader=renderer.shaderManager.plugins.primitiveShader,webGLData;if(graphics.dirty||!graphics._webGL[gl.id]){this.updateGraphics(graphics)}var webGL=graphics._webGL[gl.id];renderer.blendModeManager.setBlendMode(graphics.blendMode);for(var i=0,n=webGL.data.length;i<n;i++){webGLData=webGL.data[i];if(webGL.data[i].mode===1){renderer.stencilManager.pushStencil(graphics,webGLData);gl.uniform1f(renderer.shaderManager.complexPrimitiveShader.uniforms.alpha._location,graphics.worldAlpha*webGLData.alpha);gl.drawElements(gl.TRIANGLE_FAN,4,gl.UNSIGNED_SHORT,(webGLData.indices.length-4)*2);renderer.stencilManager.popStencil(graphics,webGLData)}else{shader=renderer.shaderManager.primitiveShader;renderer.shaderManager.setShader(shader);gl.uniformMatrix3fv(shader.uniforms.translationMatrix._location,false,graphics.worldTransform.toArray(true));gl.uniformMatrix3fv(shader.uniforms.projectionMatrix._location,false,renderer.currentRenderTarget.projectionMatrix.toArray(true));gl.uniform3fv(shader.uniforms.tint._location,utils.hex2rgb(graphics.tint));gl.uniform1f(shader.uniforms.alpha._location,graphics.worldAlpha);gl.bindBuffer(gl.ARRAY_BUFFER,webGLData.buffer);gl.vertexAttribPointer(shader.attributes.aVertexPosition,2,gl.FLOAT,false,4*6,0);gl.vertexAttribPointer(shader.attributes.aColor,4,gl.FLOAT,false,4*6,2*4);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,webGLData.indexBuffer);gl.drawElements(gl.TRIANGLE_STRIP,webGLData.indices.length,gl.UNSIGNED_SHORT,0)}renderer.drawCount++}};GraphicsRenderer.prototype.updateGraphics=function(graphics){var gl=this.renderer.gl;var webGL=graphics._webGL[gl.id];if(!webGL){webGL=graphics._webGL[gl.id]={lastIndex:0,data:[],gl:gl}}graphics.dirty=false;var i;if(graphics.clearDirty){graphics.clearDirty=false;for(i=0;i<webGL.data.length;i++){var graphicsData=webGL.data[i];graphicsData.reset();this.graphicsDataPool.push(graphicsData)}webGL.data=[];webGL.lastIndex=0}var webGLData;for(i=webGL.lastIndex;i<graphics.graphicsData.length;i++){var data=graphics.graphicsData[i];if(data.type===CONST.SHAPES.POLY){data.points=data.shape.points.slice();if(data.shape.closed){if(data.points[0]!==data.points[data.points.length-2]||data.points[1]!==data.points[data.points.length-1]){data.points.push(data.points[0],data.points[1])}}if(data.fill){if(data.points.length>=6){if(data.points.length<this.maximumSimplePolySize*2){webGLData=this.switchMode(webGL,0);var canDrawUsingSimple=this.buildPoly(data,webGLData);if(!canDrawUsingSimple){webGLData=this.switchMode(webGL,1);this.buildComplexPoly(data,webGLData)}}else{webGLData=this.switchMode(webGL,1);this.buildComplexPoly(data,webGLData)}}}if(data.lineWidth>0){webGLData=this.switchMode(webGL,0);this.buildLine(data,webGLData)}}else{webGLData=this.switchMode(webGL,0);if(data.type===CONST.SHAPES.RECT){this.buildRectangle(data,webGLData)}else if(data.type===CONST.SHAPES.CIRC||data.type===CONST.SHAPES.ELIP){this.buildCircle(data,webGLData)}else if(data.type===CONST.SHAPES.RREC){this.buildRoundedRectangle(data,webGLData)}}webGL.lastIndex++}for(i=0;i<webGL.data.length;i++){webGLData=webGL.data[i];if(webGLData.dirty){webGLData.upload()}}};GraphicsRenderer.prototype.switchMode=function(webGL,type){var webGLData;if(!webGL.data.length){webGLData=this.graphicsDataPool.pop()||new WebGLGraphicsData(webGL.gl);webGLData.mode=type;webGL.data.push(webGLData)}else{webGLData=webGL.data[webGL.data.length-1];if(webGLData.points.length>32e4||webGLData.mode!==type||type===1){webGLData=this.graphicsDataPool.pop()||new WebGLGraphicsData(webGL.gl);webGLData.mode=type;webGL.data.push(webGLData)}}webGLData.dirty=true;return webGLData};GraphicsRenderer.prototype.buildRectangle=function(graphicsData,webGLData){var rectData=graphicsData.shape;var x=rectData.x;var y=rectData.y;var width=rectData.width;var height=rectData.height;if(graphicsData.fill){var color=utils.hex2rgb(graphicsData.fillColor);var alpha=graphicsData.fillAlpha;var r=color[0]*alpha;var g=color[1]*alpha;var b=color[2]*alpha;var verts=webGLData.points;var indices=webGLData.indices;var vertPos=verts.length/6;verts.push(x,y);verts.push(r,g,b,alpha);verts.push(x+width,y);verts.push(r,g,b,alpha);verts.push(x,y+height);verts.push(r,g,b,alpha);verts.push(x+width,y+height);verts.push(r,g,b,alpha);indices.push(vertPos,vertPos,vertPos+1,vertPos+2,vertPos+3,vertPos+3)}if(graphicsData.lineWidth){var tempPoints=graphicsData.points;graphicsData.points=[x,y,x+width,y,x+width,y+height,x,y+height,x,y];this.buildLine(graphicsData,webGLData);graphicsData.points=tempPoints}};GraphicsRenderer.prototype.buildRoundedRectangle=function(graphicsData,webGLData){var rrectData=graphicsData.shape;var x=rrectData.x;var y=rrectData.y;var width=rrectData.width;var height=rrectData.height;var radius=rrectData.radius;var recPoints=[];recPoints.push(x,y+radius);this.quadraticBezierCurve(x,y+height-radius,x,y+height,x+radius,y+height,recPoints);this.quadraticBezierCurve(x+width-radius,y+height,x+width,y+height,x+width,y+height-radius,recPoints);this.quadraticBezierCurve(x+width,y+radius,x+width,y,x+width-radius,y,recPoints);this.quadraticBezierCurve(x+radius,y,x,y,x,y+radius+1e-10,recPoints);if(graphicsData.fill){var color=utils.hex2rgb(graphicsData.fillColor);var alpha=graphicsData.fillAlpha;var r=color[0]*alpha;var g=color[1]*alpha;var b=color[2]*alpha;var verts=webGLData.points;var indices=webGLData.indices;var vecPos=verts.length/6;var triangles=earcut(recPoints,null,2);var i=0;for(i=0;i<triangles.length;i+=3){indices.push(triangles[i]+vecPos);indices.push(triangles[i]+vecPos);indices.push(triangles[i+1]+vecPos);indices.push(triangles[i+2]+vecPos);indices.push(triangles[i+2]+vecPos)}for(i=0;i<recPoints.length;i++){verts.push(recPoints[i],recPoints[++i],r,g,b,alpha)}}if(graphicsData.lineWidth){var tempPoints=graphicsData.points;graphicsData.points=recPoints;this.buildLine(graphicsData,webGLData);graphicsData.points=tempPoints}};GraphicsRenderer.prototype.quadraticBezierCurve=function(fromX,fromY,cpX,cpY,toX,toY,out){var xa,ya,xb,yb,x,y,n=20,points=out||[];function getPt(n1,n2,perc){var diff=n2-n1;return n1+diff*perc}var j=0;for(var i=0;i<=n;i++){j=i/n;xa=getPt(fromX,cpX,j);ya=getPt(fromY,cpY,j);xb=getPt(cpX,toX,j);yb=getPt(cpY,toY,j);x=getPt(xa,xb,j);y=getPt(ya,yb,j);points.push(x,y)}return points};GraphicsRenderer.prototype.buildCircle=function(graphicsData,webGLData){var circleData=graphicsData.shape;var x=circleData.x;var y=circleData.y;var width;var height;if(graphicsData.type===CONST.SHAPES.CIRC){width=circleData.radius;height=circleData.radius}else{width=circleData.width;height=circleData.height}var totalSegs=Math.floor(30*Math.sqrt(circleData.radius))||Math.floor(15*Math.sqrt(circleData.width+circleData.height));var seg=Math.PI*2/totalSegs;var i=0;if(graphicsData.fill){var color=utils.hex2rgb(graphicsData.fillColor);var alpha=graphicsData.fillAlpha;var r=color[0]*alpha;var g=color[1]*alpha;var b=color[2]*alpha;var verts=webGLData.points;var indices=webGLData.indices;var vecPos=verts.length/6;indices.push(vecPos);for(i=0;i<totalSegs+1;i++){verts.push(x,y,r,g,b,alpha);verts.push(x+Math.sin(seg*i)*width,y+Math.cos(seg*i)*height,r,g,b,alpha);indices.push(vecPos++,vecPos++)}indices.push(vecPos-1)}if(graphicsData.lineWidth){var tempPoints=graphicsData.points;graphicsData.points=[];for(i=0;i<totalSegs+1;i++){graphicsData.points.push(x+Math.sin(seg*i)*width,y+Math.cos(seg*i)*height)}this.buildLine(graphicsData,webGLData);graphicsData.points=tempPoints}};GraphicsRenderer.prototype.buildLine=function(graphicsData,webGLData){var i=0;var points=graphicsData.points;if(points.length===0){return}var firstPoint=new math.Point(points[0],points[1]);var lastPoint=new math.Point(points[points.length-2],points[points.length-1]);if(firstPoint.x===lastPoint.x&&firstPoint.y===lastPoint.y){points=points.slice();points.pop();points.pop();lastPoint=new math.Point(points[points.length-2],points[points.length-1]);var midPointX=lastPoint.x+(firstPoint.x-lastPoint.x)*.5;var midPointY=lastPoint.y+(firstPoint.y-lastPoint.y)*.5;points.unshift(midPointX,midPointY);points.push(midPointX,midPointY)}var verts=webGLData.points;var indices=webGLData.indices;var length=points.length/2;var indexCount=points.length;var indexStart=verts.length/6;var width=graphicsData.lineWidth/2;var color=utils.hex2rgb(graphicsData.lineColor);var alpha=graphicsData.lineAlpha;var r=color[0]*alpha;var g=color[1]*alpha;var b=color[2]*alpha;var px,py,p1x,p1y,p2x,p2y,p3x,p3y;var perpx,perpy,perp2x,perp2y,perp3x,perp3y;var a1,b1,c1,a2,b2,c2;var denom,pdist,dist;p1x=points[0];p1y=points[1];p2x=points[2];p2y=points[3];perpx=-(p1y-p2y);perpy=p1x-p2x;dist=Math.sqrt(perpx*perpx+perpy*perpy);perpx/=dist;perpy/=dist;perpx*=width;perpy*=width;verts.push(p1x-perpx,p1y-perpy,r,g,b,alpha);verts.push(p1x+perpx,p1y+perpy,r,g,b,alpha);for(i=1;i<length-1;i++){p1x=points[(i-1)*2];p1y=points[(i-1)*2+1];p2x=points[i*2];p2y=points[i*2+1];p3x=points[(i+1)*2];p3y=points[(i+1)*2+1];perpx=-(p1y-p2y);perpy=p1x-p2x;dist=Math.sqrt(perpx*perpx+perpy*perpy);perpx/=dist;perpy/=dist;perpx*=width;perpy*=width;perp2x=-(p2y-p3y);perp2y=p2x-p3x;dist=Math.sqrt(perp2x*perp2x+perp2y*perp2y);perp2x/=dist;perp2y/=dist;perp2x*=width;perp2y*=width;a1=-perpy+p1y-(-perpy+p2y);b1=-perpx+p2x-(-perpx+p1x);c1=(-perpx+p1x)*(-perpy+p2y)-(-perpx+p2x)*(-perpy+p1y);a2=-perp2y+p3y-(-perp2y+p2y);b2=-perp2x+p2x-(-perp2x+p3x);c2=(-perp2x+p3x)*(-perp2y+p2y)-(-perp2x+p2x)*(-perp2y+p3y);denom=a1*b2-a2*b1;if(Math.abs(denom)<.1){denom+=10.1;verts.push(p2x-perpx,p2y-perpy,r,g,b,alpha);verts.push(p2x+perpx,p2y+perpy,r,g,b,alpha);continue}px=(b1*c2-b2*c1)/denom;py=(a2*c1-a1*c2)/denom;pdist=(px-p2x)*(px-p2x)+(py-p2y)*(py-p2y);if(pdist>140*140){perp3x=perpx-perp2x;perp3y=perpy-perp2y;dist=Math.sqrt(perp3x*perp3x+perp3y*perp3y);perp3x/=dist;perp3y/=dist;perp3x*=width;perp3y*=width;verts.push(p2x-perp3x,p2y-perp3y);verts.push(r,g,b,alpha);verts.push(p2x+perp3x,p2y+perp3y);verts.push(r,g,b,alpha);verts.push(p2x-perp3x,p2y-perp3y);verts.push(r,g,b,alpha);indexCount++}else{verts.push(px,py);verts.push(r,g,b,alpha);verts.push(p2x-(px-p2x),p2y-(py-p2y));verts.push(r,g,b,alpha)}}p1x=points[(length-2)*2];p1y=points[(length-2)*2+1];p2x=points[(length-1)*2];p2y=points[(length-1)*2+1];perpx=-(p1y-p2y);perpy=p1x-p2x;dist=Math.sqrt(perpx*perpx+perpy*perpy);perpx/=dist;perpy/=dist;perpx*=width;perpy*=width;verts.push(p2x-perpx,p2y-perpy);verts.push(r,g,b,alpha);verts.push(p2x+perpx,p2y+perpy);verts.push(r,g,b,alpha);indices.push(indexStart);for(i=0;i<indexCount;i++){indices.push(indexStart++)}indices.push(indexStart-1)};GraphicsRenderer.prototype.buildComplexPoly=function(graphicsData,webGLData){var points=graphicsData.points.slice();if(points.length<6){return}var indices=webGLData.indices;webGLData.points=points;webGLData.alpha=graphicsData.fillAlpha;webGLData.color=utils.hex2rgb(graphicsData.fillColor);var minX=Infinity;var maxX=-Infinity;var minY=Infinity;var maxY=-Infinity;var x,y;for(var i=0;i<points.length;i+=2){x=points[i];y=points[i+1];minX=x<minX?x:minX;maxX=x>maxX?x:maxX;minY=y<minY?y:minY;maxY=y>maxY?y:maxY}points.push(minX,minY,maxX,minY,maxX,maxY,minX,maxY);var length=points.length/2;for(i=0;i<length;i++){indices.push(i)}};GraphicsRenderer.prototype.buildPoly=function(graphicsData,webGLData){var points=graphicsData.points;if(points.length<6){return}var verts=webGLData.points;var indices=webGLData.indices;var length=points.length/2;var color=utils.hex2rgb(graphicsData.fillColor);var alpha=graphicsData.fillAlpha;var r=color[0]*alpha;var g=color[1]*alpha;var b=color[2]*alpha;var triangles=earcut(points,null,2);if(!triangles){return false}var vertPos=verts.length/6;var i=0;for(i=0;i<triangles.length;i+=3){indices.push(triangles[i]+vertPos);indices.push(triangles[i]+vertPos);indices.push(triangles[i+1]+vertPos);indices.push(triangles[i+2]+vertPos);indices.push(triangles[i+2]+vertPos)}for(i=0;i<length;i++){verts.push(points[i*2],points[i*2+1],r,g,b,alpha)}return true}},{"../../const":22,"../../math":33,"../../renderers/webgl/WebGLRenderer":49,"../../renderers/webgl/utils/ObjectRenderer":63,"../../utils":77,"./WebGLGraphicsData":28,earcut:9}],28:[function(require,module,exports){function WebGLGraphicsData(gl){this.gl=gl;this.color=[0,0,0];this.points=[];this.indices=[];this.buffer=gl.createBuffer();this.indexBuffer=gl.createBuffer();this.mode=1;this.alpha=1;this.dirty=true;this.glPoints=null;this.glIndices=null}WebGLGraphicsData.prototype.constructor=WebGLGraphicsData;module.exports=WebGLGraphicsData;WebGLGraphicsData.prototype.reset=function(){this.points.length=0;this.indices.length=0};WebGLGraphicsData.prototype.upload=function(){var gl=this.gl;this.glPoints=new Float32Array(this.points);gl.bindBuffer(gl.ARRAY_BUFFER,this.buffer);gl.bufferData(gl.ARRAY_BUFFER,this.glPoints,gl.STATIC_DRAW);this.glIndices=new Uint16Array(this.indices);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer);gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,this.glIndices,gl.STATIC_DRAW);this.dirty=false};WebGLGraphicsData.prototype.destroy=function(){this.color=null;this.points=null;this.indices=null;this.gl.deleteBuffer(this.buffer);this.gl.deleteBuffer(this.indexBuffer);this.gl=null;this.buffer=null;this.indexBuffer=null;this.glPoints=null;this.glIndices=null}},{}],29:[function(require,module,exports){var core=module.exports=Object.assign(require("./const"),require("./math"),{utils:require("./utils"),ticker:require("./ticker"),DisplayObject:require("./display/DisplayObject"),Container:require("./display/Container"),Sprite:require("./sprites/Sprite"),ParticleContainer:require("./particles/ParticleContainer"),SpriteRenderer:require("./sprites/webgl/SpriteRenderer"),ParticleRenderer:require("./particles/webgl/ParticleRenderer"),Text:require("./text/Text"),Graphics:require("./graphics/Graphics"),GraphicsData:require("./graphics/GraphicsData"),GraphicsRenderer:require("./graphics/webgl/GraphicsRenderer"),Texture:require("./textures/Texture"),BaseTexture:require("./textures/BaseTexture"),RenderTexture:require("./textures/RenderTexture"),VideoBaseTexture:require("./textures/VideoBaseTexture"),TextureUvs:require("./textures/TextureUvs"),CanvasRenderer:require("./renderers/canvas/CanvasRenderer"),CanvasGraphics:require("./renderers/canvas/utils/CanvasGraphics"),CanvasBuffer:require("./renderers/canvas/utils/CanvasBuffer"),WebGLRenderer:require("./renderers/webgl/WebGLRenderer"),WebGLManager:require("./renderers/webgl/managers/WebGLManager"),ShaderManager:require("./renderers/webgl/managers/ShaderManager"),Shader:require("./renderers/webgl/shaders/Shader"),TextureShader:require("./renderers/webgl/shaders/TextureShader"),PrimitiveShader:require("./renderers/webgl/shaders/PrimitiveShader"),ComplexPrimitiveShader:require("./renderers/webgl/shaders/ComplexPrimitiveShader"),ObjectRenderer:require("./renderers/webgl/utils/ObjectRenderer"),RenderTarget:require("./renderers/webgl/utils/RenderTarget"),AbstractFilter:require("./renderers/webgl/filters/AbstractFilter"),FXAAFilter:require("./renderers/webgl/filters/FXAAFilter"),SpriteMaskFilter:require("./renderers/webgl/filters/SpriteMaskFilter"),autoDetectRenderer:function(width,height,options,noWebGL){width=width||800;height=height||600;if(!noWebGL&&core.utils.isWebGLSupported()){return new core.WebGLRenderer(width,height,options)}return new core.CanvasRenderer(width,height,options)}})},{"./const":22,"./display/Container":23,"./display/DisplayObject":24,"./graphics/Graphics":25,"./graphics/GraphicsData":26,"./graphics/webgl/GraphicsRenderer":27,"./math":33,"./particles/ParticleContainer":39,"./particles/webgl/ParticleRenderer":41,"./renderers/canvas/CanvasRenderer":44,"./renderers/canvas/utils/CanvasBuffer":45,"./renderers/canvas/utils/CanvasGraphics":46,"./renderers/webgl/WebGLRenderer":49,"./renderers/webgl/filters/AbstractFilter":50,"./renderers/webgl/filters/FXAAFilter":51,"./renderers/webgl/filters/SpriteMaskFilter":52,"./renderers/webgl/managers/ShaderManager":56,"./renderers/webgl/managers/WebGLManager":58,"./renderers/webgl/shaders/ComplexPrimitiveShader":59,"./renderers/webgl/shaders/PrimitiveShader":60,"./renderers/webgl/shaders/Shader":61,"./renderers/webgl/shaders/TextureShader":62,"./renderers/webgl/utils/ObjectRenderer":63,"./renderers/webgl/utils/RenderTarget":65,"./sprites/Sprite":67,"./sprites/webgl/SpriteRenderer":68,"./text/Text":69,"./textures/BaseTexture":70,"./textures/RenderTexture":71,"./textures/Texture":72,"./textures/TextureUvs":73,"./textures/VideoBaseTexture":74,"./ticker":76,"./utils":77}],30:[function(require,module,exports){var ux=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1];var uy=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1];var vx=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1];var vy=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1];var tempMatrices=[];var Matrix=require("./Matrix");var mul=[];function signum(x){if(x<0){return-1}if(x>0){return 1}return 0}function init(){for(var i=0;i<16;i++){var row=[];mul.push(row);for(var j=0;j<16;j++){var _ux=signum(ux[i]*ux[j]+vx[i]*uy[j]);var _uy=signum(uy[i]*ux[j]+vy[i]*uy[j]);var _vx=signum(ux[i]*vx[j]+vx[i]*vy[j]);var _vy=signum(uy[i]*vx[j]+vy[i]*vy[j]);for(var k=0;k<16;k++){if(ux[k]===_ux&&uy[k]===_uy&&vx[k]===_vx&&vy[k]===_vy){row.push(k);break}}}}for(i=0;i<16;i++){var mat=new Matrix;mat.set(ux[i],uy[i],vx[i],vy[i],0,0);tempMatrices.push(mat)}}init();var GroupD8={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MIRROR_HORIZONTAL:12,uX:function(ind){return ux[ind]},uY:function(ind){return uy[ind]},vX:function(ind){return vx[ind]},vY:function(ind){return vy[ind]},inv:function(rotation){if(rotation&8){return rotation&15}return-rotation&7},add:function(rotationSecond,rotationFirst){return mul[rotationSecond][rotationFirst]},sub:function(rotationSecond,rotationFirst){return mul[rotationSecond][GroupD8.inv(rotationFirst)]},rotate180:function(rotation){return rotation^4},isSwapWidthHeight:function(rotation){return(rotation&3)===2},byDirection:function(dx,dy){if(Math.abs(dx)*2<=Math.abs(dy)){if(dy>=0){return GroupD8.S}else{return GroupD8.N}}else if(Math.abs(dy)*2<=Math.abs(dx)){if(dx>0){return GroupD8.E}else{return GroupD8.W}}else{if(dy>0){if(dx>0){return GroupD8.SE}else{return GroupD8.SW}}else if(dx>0){return GroupD8.NE}else{return GroupD8.NW}}},matrixAppendRotationInv:function(matrix,rotation,tx,ty){var mat=tempMatrices[GroupD8.inv(rotation)];tx=tx||0;ty=ty||0;mat.tx=tx;mat.ty=ty;matrix.append(mat)}};module.exports=GroupD8},{"./Matrix":31}],31:[function(require,module,exports){var Point=require("./Point");function Matrix(){this.a=1;this.b=0;this.c=0;this.d=1;this.tx=0;this.ty=0}Matrix.prototype.constructor=Matrix;module.exports=Matrix;Matrix.prototype.fromArray=function(array){this.a=array[0];this.b=array[1];this.c=array[3];this.d=array[4];this.tx=array[2];this.ty=array[5]};Matrix.prototype.set=function(a,b,c,d,tx,ty){this.a=a;this.b=b;this.c=c;this.d=d;this.tx=tx;this.ty=ty;return this};Matrix.prototype.toArray=function(transpose,out){if(!this.array){this.array=new Float32Array(9)}var array=out||this.array;if(transpose){array[0]=this.a;array[1]=this.b;array[2]=0;array[3]=this.c;array[4]=this.d;array[5]=0;array[6]=this.tx;array[7]=this.ty;array[8]=1}else{array[0]=this.a;array[1]=this.c;array[2]=this.tx;array[3]=this.b;array[4]=this.d;array[5]=this.ty;array[6]=0;array[7]=0;array[8]=1}return array};Matrix.prototype.apply=function(pos,newPos){newPos=newPos||new Point;var x=pos.x;var y=pos.y;newPos.x=this.a*x+this.c*y+this.tx;newPos.y=this.b*x+this.d*y+this.ty;return newPos};Matrix.prototype.applyInverse=function(pos,newPos){newPos=newPos||new Point;var id=1/(this.a*this.d+this.c*-this.b);var x=pos.x;var y=pos.y;newPos.x=this.d*id*x+-this.c*id*y+(this.ty*this.c-this.tx*this.d)*id;newPos.y=this.a*id*y+-this.b*id*x+(-this.ty*this.a+this.tx*this.b)*id;return newPos};Matrix.prototype.translate=function(x,y){this.tx+=x;this.ty+=y;return this};Matrix.prototype.scale=function(x,y){this.a*=x;this.d*=y;this.c*=x;this.b*=y;this.tx*=x;this.ty*=y;return this};Matrix.prototype.rotate=function(angle){var cos=Math.cos(angle);var sin=Math.sin(angle);var a1=this.a;var c1=this.c;var tx1=this.tx;this.a=a1*cos-this.b*sin;this.b=a1*sin+this.b*cos;this.c=c1*cos-this.d*sin;this.d=c1*sin+this.d*cos;this.tx=tx1*cos-this.ty*sin;this.ty=tx1*sin+this.ty*cos;return this};Matrix.prototype.append=function(matrix){var a1=this.a;var b1=this.b;var c1=this.c;var d1=this.d;this.a=matrix.a*a1+matrix.b*c1;this.b=matrix.a*b1+matrix.b*d1;this.c=matrix.c*a1+matrix.d*c1;this.d=matrix.c*b1+matrix.d*d1;this.tx=matrix.tx*a1+matrix.ty*c1+this.tx;this.ty=matrix.tx*b1+matrix.ty*d1+this.ty;return this};Matrix.prototype.setTransform=function(x,y,pivotX,pivotY,scaleX,scaleY,rotation,skewX,skewY){var a,b,c,d,sr,cr,cy,sy,nsx,cx;sr=Math.sin(rotation);cr=Math.cos(rotation);cy=Math.cos(skewY);sy=Math.sin(skewY);nsx=-Math.sin(skewX);cx=Math.cos(skewX);a=cr*scaleX;b=sr*scaleX;c=-sr*scaleY;d=cr*scaleY;this.a=cy*a+sy*c;this.b=cy*b+sy*d;this.c=nsx*a+cx*c;this.d=nsx*b+cx*d;this.tx=x+(pivotX*a+pivotY*c);this.ty=y+(pivotX*b+pivotY*d);return this};Matrix.prototype.prepend=function(matrix){var tx1=this.tx;if(matrix.a!==1||matrix.b!==0||matrix.c!==0||matrix.d!==1){var a1=this.a;var c1=this.c;this.a=a1*matrix.a+this.b*matrix.c;this.b=a1*matrix.b+this.b*matrix.d;this.c=c1*matrix.a+this.d*matrix.c;this.d=c1*matrix.b+this.d*matrix.d}this.tx=tx1*matrix.a+this.ty*matrix.c+matrix.tx;this.ty=tx1*matrix.b+this.ty*matrix.d+matrix.ty;return this};Matrix.prototype.invert=function(){var a1=this.a;var b1=this.b;var c1=this.c;var d1=this.d;var tx1=this.tx;var n=a1*d1-b1*c1;this.a=d1/n;this.b=-b1/n;this.c=-c1/n;this.d=a1/n;this.tx=(c1*this.ty-d1*tx1)/n;this.ty=-(a1*this.ty-b1*tx1)/n;return this};Matrix.prototype.identity=function(){this.a=1;this.b=0;this.c=0;this.d=1;this.tx=0;this.ty=0;return this};Matrix.prototype.clone=function(){var matrix=new Matrix;matrix.a=this.a;matrix.b=this.b;matrix.c=this.c;matrix.d=this.d;matrix.tx=this.tx;matrix.ty=this.ty;return matrix};Matrix.prototype.copy=function(matrix){matrix.a=this.a;matrix.b=this.b;matrix.c=this.c;matrix.d=this.d;matrix.tx=this.tx;matrix.ty=this.ty;return matrix};Matrix.IDENTITY=new Matrix;Matrix.TEMP_MATRIX=new Matrix},{"./Point":32}],32:[function(require,module,exports){function Point(x,y){this.x=x||0;this.y=y||0}Point.prototype.constructor=Point;module.exports=Point;Point.prototype.clone=function(){return new Point(this.x,this.y)};Point.prototype.copy=function(p){this.set(p.x,p.y)};Point.prototype.equals=function(p){return p.x===this.x&&p.y===this.y};Point.prototype.set=function(x,y){this.x=x||0;this.y=y||(y!==0?this.x:0)}},{}],33:[function(require,module,exports){module.exports={Point:require("./Point"),Matrix:require("./Matrix"),GroupD8:require("./GroupD8"),Circle:require("./shapes/Circle"),Ellipse:require("./shapes/Ellipse"),Polygon:require("./shapes/Polygon"),Rectangle:require("./shapes/Rectangle"),RoundedRectangle:require("./shapes/RoundedRectangle")}},{"./GroupD8":30,"./Matrix":31,"./Point":32,"./shapes/Circle":34,"./shapes/Ellipse":35,"./shapes/Polygon":36,"./shapes/Rectangle":37,"./shapes/RoundedRectangle":38}],34:[function(require,module,exports){var Rectangle=require("./Rectangle"),CONST=require("../../const");function Circle(x,y,radius){this.x=x||0;this.y=y||0;this.radius=radius||0;this.type=CONST.SHAPES.CIRC}Circle.prototype.constructor=Circle;module.exports=Circle;Circle.prototype.clone=function(){return new Circle(this.x,this.y,this.radius)};Circle.prototype.contains=function(x,y){if(this.radius<=0){return false}var dx=this.x-x,dy=this.y-y,r2=this.radius*this.radius;dx*=dx;dy*=dy;return dx+dy<=r2};Circle.prototype.getBounds=function(){return new Rectangle(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)}},{"../../const":22,"./Rectangle":37}],35:[function(require,module,exports){var Rectangle=require("./Rectangle"),CONST=require("../../const");function Ellipse(x,y,width,height){this.x=x||0;this.y=y||0;this.width=width||0;this.height=height||0;this.type=CONST.SHAPES.ELIP}Ellipse.prototype.constructor=Ellipse;module.exports=Ellipse;Ellipse.prototype.clone=function(){return new Ellipse(this.x,this.y,this.width,this.height)};Ellipse.prototype.contains=function(x,y){if(this.width<=0||this.height<=0){return false}var normx=(x-this.x)/this.width,normy=(y-this.y)/this.height;normx*=normx;normy*=normy;return normx+normy<=1};Ellipse.prototype.getBounds=function(){return new Rectangle(this.x-this.width,this.y-this.height,this.width,this.height)}},{"../../const":22,"./Rectangle":37}],36:[function(require,module,exports){var Point=require("../Point"),CONST=require("../../const");function Polygon(points_){var points=points_;if(!Array.isArray(points)){points=new Array(arguments.length);for(var a=0;a<points.length;++a){points[a]=arguments[a]}}if(points[0]instanceof Point){var p=[];for(var i=0,il=points.length;i<il;i++){p.push(points[i].x,points[i].y)}points=p}this.closed=true;this.points=points;this.type=CONST.SHAPES.POLY}Polygon.prototype.constructor=Polygon;module.exports=Polygon;Polygon.prototype.clone=function(){return new Polygon(this.points.slice())};Polygon.prototype.contains=function(x,y){var inside=false;var length=this.points.length/2;for(var i=0,j=length-1;i<length;j=i++){var xi=this.points[i*2],yi=this.points[i*2+1],xj=this.points[j*2],yj=this.points[j*2+1],intersect=yi>y!==yj>y&&x<(xj-xi)*(y-yi)/(yj-yi)+xi;if(intersect){inside=!inside}}return inside}},{"../../const":22,"../Point":32}],37:[function(require,module,exports){var CONST=require("../../const");function Rectangle(x,y,width,height){this.x=x||0;this.y=y||0;this.width=width||0;this.height=height||0;this.type=CONST.SHAPES.RECT}Rectangle.prototype.constructor=Rectangle;module.exports=Rectangle;Rectangle.EMPTY=new Rectangle(0,0,0,0);Rectangle.prototype.clone=function(){return new Rectangle(this.x,this.y,this.width,this.height)};Rectangle.prototype.contains=function(x,y){if(this.width<=0||this.height<=0){return false}if(x>=this.x&&x<this.x+this.width){if(y>=this.y&&y<this.y+this.height){return true}}return false}},{"../../const":22}],38:[function(require,module,exports){var CONST=require("../../const");function RoundedRectangle(x,y,width,height,radius){this.x=x||0;this.y=y||0;this.width=width||0;this.height=height||0;this.radius=radius||20;this.type=CONST.SHAPES.RREC}RoundedRectangle.prototype.constructor=RoundedRectangle;module.exports=RoundedRectangle;RoundedRectangle.prototype.clone=function(){return new RoundedRectangle(this.x,this.y,this.width,this.height,this.radius)};RoundedRectangle.prototype.contains=function(x,y){if(this.width<=0||this.height<=0){return false}if(x>=this.x&&x<=this.x+this.width){if(y>=this.y&&y<=this.y+this.height){return true}}return false}},{"../../const":22}],39:[function(require,module,exports){var Container=require("../display/Container"),CONST=require("../const");function ParticleContainer(maxSize,properties,batchSize){Container.call(this);batchSize=batchSize||15e3;maxSize=maxSize||15e3;var maxBatchSize=16384;if(batchSize>maxBatchSize){batchSize=maxBatchSize}if(batchSize>maxSize){batchSize=maxSize}this._properties=[false,true,false,false,false];this._maxSize=maxSize;this._batchSize=batchSize;this._buffers=null;this._bufferToUpdate=0;this.interactiveChildren=false;this.blendMode=CONST.BLEND_MODES.NORMAL;this.roundPixels=true;this.setProperties(properties)}ParticleContainer.prototype=Object.create(Container.prototype);ParticleContainer.prototype.constructor=ParticleContainer;module.exports=ParticleContainer;ParticleContainer.prototype.setProperties=function(properties){if(properties){this._properties[0]="scale"in properties?!!properties.scale:this._properties[0];this._properties[1]="position"in properties?!!properties.position:this._properties[1];this._properties[2]="rotation"in properties?!!properties.rotation:this._properties[2];this._properties[3]="uvs"in properties?!!properties.uvs:this._properties[3];this._properties[4]="alpha"in properties?!!properties.alpha:this._properties[4]}};ParticleContainer.prototype.updateTransform=function(){this.displayObjectUpdateTransform()};ParticleContainer.prototype.renderWebGL=function(renderer){if(!this.visible||this.worldAlpha<=0||!this.children.length||!this.renderable){
return}renderer.setObjectRenderer(renderer.plugins.particle);renderer.plugins.particle.render(this)};ParticleContainer.prototype.onChildrenChange=function(smallestChildIndex){var bufferIndex=Math.floor(smallestChildIndex/this._batchSize);if(bufferIndex<this._bufferToUpdate){this._bufferToUpdate=bufferIndex}};ParticleContainer.prototype.renderCanvas=function(renderer){if(!this.visible||this.worldAlpha<=0||!this.children.length||!this.renderable){return}var context=renderer.context;var transform=this.worldTransform;var isRotated=true;var positionX=0;var positionY=0;var finalWidth=0;var finalHeight=0;var compositeOperation=renderer.blendModes[this.blendMode];if(compositeOperation!==context.globalCompositeOperation){context.globalCompositeOperation=compositeOperation}context.globalAlpha=this.worldAlpha;this.displayObjectUpdateTransform();for(var i=0;i<this.children.length;++i){var child=this.children[i];if(!child.visible){continue}var frame=child.texture.frame;context.globalAlpha=this.worldAlpha*child.alpha;if(child.rotation%(Math.PI*2)===0){if(isRotated){context.setTransform(transform.a,transform.b,transform.c,transform.d,transform.tx,transform.ty);isRotated=false}positionX=child.anchor.x*(-frame.width*child.scale.x)+child.position.x+.5;positionY=child.anchor.y*(-frame.height*child.scale.y)+child.position.y+.5;finalWidth=frame.width*child.scale.x;finalHeight=frame.height*child.scale.y}else{if(!isRotated){isRotated=true}child.displayObjectUpdateTransform();var childTransform=child.worldTransform;if(renderer.roundPixels){context.setTransform(childTransform.a,childTransform.b,childTransform.c,childTransform.d,childTransform.tx|0,childTransform.ty|0)}else{context.setTransform(childTransform.a,childTransform.b,childTransform.c,childTransform.d,childTransform.tx,childTransform.ty)}positionX=child.anchor.x*-frame.width+.5;positionY=child.anchor.y*-frame.height+.5;finalWidth=frame.width;finalHeight=frame.height}context.drawImage(child.texture.baseTexture.source,frame.x,frame.y,frame.width,frame.height,positionX,positionY,finalWidth,finalHeight)}};ParticleContainer.prototype.destroy=function(){Container.prototype.destroy.apply(this,arguments);if(this._buffers){for(var i=0;i<this._buffers.length;++i){this._buffers[i].destroy()}}this._properties=null;this._buffers=null}},{"../const":22,"../display/Container":23}],40:[function(require,module,exports){function ParticleBuffer(gl,properties,dynamicPropertyFlags,size){this.gl=gl;this.vertSize=2;this.vertByteSize=this.vertSize*4;this.size=size;this.dynamicProperties=[];this.staticProperties=[];for(var i=0;i<properties.length;i++){var property=properties[i];if(dynamicPropertyFlags[i]){this.dynamicProperties.push(property)}else{this.staticProperties.push(property)}}this.staticStride=0;this.staticBuffer=null;this.staticData=null;this.dynamicStride=0;this.dynamicBuffer=null;this.dynamicData=null;this.initBuffers()}ParticleBuffer.prototype.constructor=ParticleBuffer;module.exports=ParticleBuffer;ParticleBuffer.prototype.initBuffers=function(){var gl=this.gl;var i;var property;var dynamicOffset=0;this.dynamicStride=0;for(i=0;i<this.dynamicProperties.length;i++){property=this.dynamicProperties[i];property.offset=dynamicOffset;dynamicOffset+=property.size;this.dynamicStride+=property.size}this.dynamicData=new Float32Array(this.size*this.dynamicStride*4);this.dynamicBuffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,this.dynamicBuffer);gl.bufferData(gl.ARRAY_BUFFER,this.dynamicData,gl.DYNAMIC_DRAW);var staticOffset=0;this.staticStride=0;for(i=0;i<this.staticProperties.length;i++){property=this.staticProperties[i];property.offset=staticOffset;staticOffset+=property.size;this.staticStride+=property.size}this.staticData=new Float32Array(this.size*this.staticStride*4);this.staticBuffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,this.staticBuffer);gl.bufferData(gl.ARRAY_BUFFER,this.staticData,gl.DYNAMIC_DRAW)};ParticleBuffer.prototype.uploadDynamic=function(children,startIndex,amount){var gl=this.gl;for(var i=0;i<this.dynamicProperties.length;i++){var property=this.dynamicProperties[i];property.uploadFunction(children,startIndex,amount,this.dynamicData,this.dynamicStride,property.offset)}gl.bindBuffer(gl.ARRAY_BUFFER,this.dynamicBuffer);gl.bufferSubData(gl.ARRAY_BUFFER,0,this.dynamicData)};ParticleBuffer.prototype.uploadStatic=function(children,startIndex,amount){var gl=this.gl;for(var i=0;i<this.staticProperties.length;i++){var property=this.staticProperties[i];property.uploadFunction(children,startIndex,amount,this.staticData,this.staticStride,property.offset)}gl.bindBuffer(gl.ARRAY_BUFFER,this.staticBuffer);gl.bufferSubData(gl.ARRAY_BUFFER,0,this.staticData)};ParticleBuffer.prototype.bind=function(){var gl=this.gl;var i,property;gl.bindBuffer(gl.ARRAY_BUFFER,this.dynamicBuffer);for(i=0;i<this.dynamicProperties.length;i++){property=this.dynamicProperties[i];gl.vertexAttribPointer(property.attribute,property.size,gl.FLOAT,false,this.dynamicStride*4,property.offset*4)}gl.bindBuffer(gl.ARRAY_BUFFER,this.staticBuffer);for(i=0;i<this.staticProperties.length;i++){property=this.staticProperties[i];gl.vertexAttribPointer(property.attribute,property.size,gl.FLOAT,false,this.staticStride*4,property.offset*4)}};ParticleBuffer.prototype.destroy=function(){this.dynamicProperties=null;this.dynamicData=null;this.gl.deleteBuffer(this.dynamicBuffer);this.staticProperties=null;this.staticData=null;this.gl.deleteBuffer(this.staticBuffer)}},{}],41:[function(require,module,exports){var ObjectRenderer=require("../../renderers/webgl/utils/ObjectRenderer"),WebGLRenderer=require("../../renderers/webgl/WebGLRenderer"),ParticleShader=require("./ParticleShader"),ParticleBuffer=require("./ParticleBuffer"),math=require("../../math");function ParticleRenderer(renderer){ObjectRenderer.call(this,renderer);var numIndices=98304;this.indices=new Uint16Array(numIndices);for(var i=0,j=0;i<numIndices;i+=6,j+=4){this.indices[i+0]=j+0;this.indices[i+1]=j+1;this.indices[i+2]=j+2;this.indices[i+3]=j+0;this.indices[i+4]=j+2;this.indices[i+5]=j+3}this.shader=null;this.indexBuffer=null;this.properties=null;this.tempMatrix=new math.Matrix}ParticleRenderer.prototype=Object.create(ObjectRenderer.prototype);ParticleRenderer.prototype.constructor=ParticleRenderer;module.exports=ParticleRenderer;WebGLRenderer.registerPlugin("particle",ParticleRenderer);ParticleRenderer.prototype.onContextChange=function(){var gl=this.renderer.gl;this.shader=new ParticleShader(this.renderer.shaderManager);this.indexBuffer=gl.createBuffer();gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer);gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,this.indices,gl.STATIC_DRAW);this.properties=[{attribute:this.shader.attributes.aVertexPosition,size:2,uploadFunction:this.uploadVertices,offset:0},{attribute:this.shader.attributes.aPositionCoord,size:2,uploadFunction:this.uploadPosition,offset:0},{attribute:this.shader.attributes.aRotation,size:1,uploadFunction:this.uploadRotation,offset:0},{attribute:this.shader.attributes.aTextureCoord,size:2,uploadFunction:this.uploadUvs,offset:0},{attribute:this.shader.attributes.aColor,size:1,uploadFunction:this.uploadAlpha,offset:0}]};ParticleRenderer.prototype.start=function(){var gl=this.renderer.gl;gl.activeTexture(gl.TEXTURE0);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var shader=this.shader;this.renderer.shaderManager.setShader(shader)};ParticleRenderer.prototype.render=function(container){var children=container.children,totalChildren=children.length,maxSize=container._maxSize,batchSize=container._batchSize;if(totalChildren===0){return}else if(totalChildren>maxSize){totalChildren=maxSize}if(!container._buffers){container._buffers=this.generateBuffers(container)}this.renderer.blendModeManager.setBlendMode(container.blendMode);var gl=this.renderer.gl;var m=container.worldTransform.copy(this.tempMatrix);m.prepend(this.renderer.currentRenderTarget.projectionMatrix);gl.uniformMatrix3fv(this.shader.uniforms.projectionMatrix._location,false,m.toArray(true));gl.uniform1f(this.shader.uniforms.uAlpha._location,container.worldAlpha);var baseTexture=children[0]._texture.baseTexture;if(!baseTexture._glTextures[gl.id]){if(!this.renderer.updateTexture(baseTexture)){return}if(!container._properties[0]||!container._properties[3]){container._bufferToUpdate=0}}else{gl.bindTexture(gl.TEXTURE_2D,baseTexture._glTextures[gl.id])}for(var i=0,j=0;i<totalChildren;i+=batchSize,j+=1){var amount=totalChildren-i;if(amount>batchSize){amount=batchSize}var buffer=container._buffers[j];buffer.uploadDynamic(children,i,amount);if(container._bufferToUpdate===j){buffer.uploadStatic(children,i,amount);container._bufferToUpdate=j+1}buffer.bind(this.shader);gl.drawElements(gl.TRIANGLES,amount*6,gl.UNSIGNED_SHORT,0);this.renderer.drawCount++}};ParticleRenderer.prototype.generateBuffers=function(container){var gl=this.renderer.gl,buffers=[],size=container._maxSize,batchSize=container._batchSize,dynamicPropertyFlags=container._properties,i;for(i=0;i<size;i+=batchSize){buffers.push(new ParticleBuffer(gl,this.properties,dynamicPropertyFlags,batchSize))}return buffers};ParticleRenderer.prototype.uploadVertices=function(children,startIndex,amount,array,stride,offset){var sprite,texture,trim,sx,sy,w0,w1,h0,h1;for(var i=0;i<amount;i++){sprite=children[startIndex+i];texture=sprite._texture;sx=sprite.scale.x;sy=sprite.scale.y;if(texture.trim){trim=texture.trim;w1=trim.x-sprite.anchor.x*trim.width;w0=w1+texture.crop.width;h1=trim.y-sprite.anchor.y*trim.height;h0=h1+texture.crop.height}else{w0=texture._frame.width*(1-sprite.anchor.x);w1=texture._frame.width*-sprite.anchor.x;h0=texture._frame.height*(1-sprite.anchor.y);h1=texture._frame.height*-sprite.anchor.y}array[offset]=w1*sx;array[offset+1]=h1*sy;array[offset+stride]=w0*sx;array[offset+stride+1]=h1*sy;array[offset+stride*2]=w0*sx;array[offset+stride*2+1]=h0*sy;array[offset+stride*3]=w1*sx;array[offset+stride*3+1]=h0*sy;offset+=stride*4}};ParticleRenderer.prototype.uploadPosition=function(children,startIndex,amount,array,stride,offset){for(var i=0;i<amount;i++){var spritePosition=children[startIndex+i].position;array[offset]=spritePosition.x;array[offset+1]=spritePosition.y;array[offset+stride]=spritePosition.x;array[offset+stride+1]=spritePosition.y;array[offset+stride*2]=spritePosition.x;array[offset+stride*2+1]=spritePosition.y;array[offset+stride*3]=spritePosition.x;array[offset+stride*3+1]=spritePosition.y;offset+=stride*4}};ParticleRenderer.prototype.uploadRotation=function(children,startIndex,amount,array,stride,offset){for(var i=0;i<amount;i++){var spriteRotation=children[startIndex+i].rotation;array[offset]=spriteRotation;array[offset+stride]=spriteRotation;array[offset+stride*2]=spriteRotation;array[offset+stride*3]=spriteRotation;offset+=stride*4}};ParticleRenderer.prototype.uploadUvs=function(children,startIndex,amount,array,stride,offset){for(var i=0;i<amount;i++){var textureUvs=children[startIndex+i]._texture._uvs;if(textureUvs){array[offset]=textureUvs.x0;array[offset+1]=textureUvs.y0;array[offset+stride]=textureUvs.x1;array[offset+stride+1]=textureUvs.y1;array[offset+stride*2]=textureUvs.x2;array[offset+stride*2+1]=textureUvs.y2;array[offset+stride*3]=textureUvs.x3;array[offset+stride*3+1]=textureUvs.y3;offset+=stride*4}else{array[offset]=0;array[offset+1]=0;array[offset+stride]=0;array[offset+stride+1]=0;array[offset+stride*2]=0;array[offset+stride*2+1]=0;array[offset+stride*3]=0;array[offset+stride*3+1]=0;offset+=stride*4}}};ParticleRenderer.prototype.uploadAlpha=function(children,startIndex,amount,array,stride,offset){for(var i=0;i<amount;i++){var spriteAlpha=children[startIndex+i].alpha;array[offset]=spriteAlpha;array[offset+stride]=spriteAlpha;array[offset+stride*2]=spriteAlpha;array[offset+stride*3]=spriteAlpha;offset+=stride*4}};ParticleRenderer.prototype.destroy=function(){if(this.renderer.gl){this.renderer.gl.deleteBuffer(this.indexBuffer)}ObjectRenderer.prototype.destroy.apply(this,arguments);this.shader.destroy();this.indices=null;this.tempMatrix=null}},{"../../math":33,"../../renderers/webgl/WebGLRenderer":49,"../../renderers/webgl/utils/ObjectRenderer":63,"./ParticleBuffer":40,"./ParticleShader":42}],42:[function(require,module,exports){var TextureShader=require("../../renderers/webgl/shaders/TextureShader");function ParticleShader(shaderManager){TextureShader.call(this,shaderManager,["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute float aColor;","attribute vec2 aPositionCoord;","attribute vec2 aScale;","attribute float aRotation;","uniform mat3 projectionMatrix;","varying vec2 vTextureCoord;","varying float vColor;","void main(void){","   vec2 v = aVertexPosition;","   v.x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);","   v.y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);","   v = v + aPositionCoord;","   gl_Position = vec4((projectionMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor;","}"].join("\n"),["precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","uniform float uAlpha;","void main(void){","  vec4 color = texture2D(uSampler, vTextureCoord) * vColor * uAlpha;","  if (color.a == 0.0) discard;","  gl_FragColor = color;","}"].join("\n"),{uAlpha:{type:"1f",value:1}},{aPositionCoord:0,aRotation:0})}ParticleShader.prototype=Object.create(TextureShader.prototype);ParticleShader.prototype.constructor=ParticleShader;module.exports=ParticleShader},{"../../renderers/webgl/shaders/TextureShader":62}],43:[function(require,module,exports){var utils=require("../utils"),math=require("../math"),CONST=require("../const"),EventEmitter=require("eventemitter3");function SystemRenderer(system,width,height,options){EventEmitter.call(this);utils.sayHello(system);if(options){for(var i in CONST.DEFAULT_RENDER_OPTIONS){if(typeof options[i]==="undefined"){options[i]=CONST.DEFAULT_RENDER_OPTIONS[i]}}}else{options=CONST.DEFAULT_RENDER_OPTIONS}this.type=CONST.RENDERER_TYPE.UNKNOWN;this.width=width||800;this.height=height||600;this.view=options.view||document.createElement("canvas");this.resolution=options.resolution;this.transparent=options.transparent;this.autoResize=options.autoResize||false;this.blendModes=null;this.preserveDrawingBuffer=options.preserveDrawingBuffer;this.clearBeforeRender=options.clearBeforeRender;this.roundPixels=options.roundPixels;this._backgroundColor=0;this._backgroundColorRgb=[0,0,0];this._backgroundColorString="#000000";this.backgroundColor=options.backgroundColor||this._backgroundColor;this._tempDisplayObjectParent={worldTransform:new math.Matrix,worldAlpha:1,children:[]};this._lastObjectRendered=this._tempDisplayObjectParent}SystemRenderer.prototype=Object.create(EventEmitter.prototype);SystemRenderer.prototype.constructor=SystemRenderer;module.exports=SystemRenderer;Object.defineProperties(SystemRenderer.prototype,{backgroundColor:{get:function(){return this._backgroundColor},set:function(val){this._backgroundColor=val;this._backgroundColorString=utils.hex2string(val);utils.hex2rgb(val,this._backgroundColorRgb)}}});SystemRenderer.prototype.resize=function(width,height){this.width=width*this.resolution;this.height=height*this.resolution;this.view.width=this.width;this.view.height=this.height;if(this.autoResize){this.view.style.width=this.width/this.resolution+"px";this.view.style.height=this.height/this.resolution+"px"}};SystemRenderer.prototype.destroy=function(removeView){if(removeView&&this.view.parentNode){this.view.parentNode.removeChild(this.view)}this.type=CONST.RENDERER_TYPE.UNKNOWN;this.width=0;this.height=0;this.view=null;this.resolution=0;this.transparent=false;this.autoResize=false;this.blendModes=null;this.preserveDrawingBuffer=false;this.clearBeforeRender=false;this.roundPixels=false;this._backgroundColor=0;this._backgroundColorRgb=null;this._backgroundColorString=null}},{"../const":22,"../math":33,"../utils":77,eventemitter3:10}],44:[function(require,module,exports){var SystemRenderer=require("../SystemRenderer"),CanvasMaskManager=require("./utils/CanvasMaskManager"),utils=require("../../utils"),math=require("../../math"),CONST=require("../../const");function CanvasRenderer(width,height,options){options=options||{};SystemRenderer.call(this,"Canvas",width,height,options);this.type=CONST.RENDERER_TYPE.CANVAS;this.context=this.view.getContext("2d",{alpha:this.transparent});this.refresh=true;this.maskManager=new CanvasMaskManager;this.smoothProperty="imageSmoothingEnabled";if(!this.context.imageSmoothingEnabled){if(this.context.webkitImageSmoothingEnabled){this.smoothProperty="webkitImageSmoothingEnabled"}else if(this.context.mozImageSmoothingEnabled){this.smoothProperty="mozImageSmoothingEnabled"}else if(this.context.oImageSmoothingEnabled){this.smoothProperty="oImageSmoothingEnabled"}else if(this.context.msImageSmoothingEnabled){this.smoothProperty="msImageSmoothingEnabled"}}this.initPlugins();this._mapBlendModes();this._tempDisplayObjectParent={worldTransform:new math.Matrix,worldAlpha:1};this.resize(width,height)}CanvasRenderer.prototype=Object.create(SystemRenderer.prototype);CanvasRenderer.prototype.constructor=CanvasRenderer;module.exports=CanvasRenderer;utils.pluginTarget.mixin(CanvasRenderer);CanvasRenderer.prototype.render=function(object){this.emit("prerender");var cacheParent=object.parent;this._lastObjectRendered=object;object.parent=this._tempDisplayObjectParent;object.updateTransform();object.parent=cacheParent;this.context.setTransform(1,0,0,1,0,0);this.context.globalAlpha=1;this.context.globalCompositeOperation=this.blendModes[CONST.BLEND_MODES.NORMAL];if(navigator.isCocoonJS&&this.view.screencanvas){this.context.fillStyle="black";this.context.clear()}if(this.clearBeforeRender){if(this.transparent){this.context.clearRect(0,0,this.width,this.height)}else{this.context.fillStyle=this._backgroundColorString;this.context.fillRect(0,0,this.width,this.height)}}this.renderDisplayObject(object,this.context);this.emit("postrender")};CanvasRenderer.prototype.destroy=function(removeView){this.destroyPlugins();SystemRenderer.prototype.destroy.call(this,removeView);this.context=null;this.refresh=true;this.maskManager.destroy();this.maskManager=null;this.smoothProperty=null};CanvasRenderer.prototype.renderDisplayObject=function(displayObject,context){var tempContext=this.context;this.context=context;displayObject.renderCanvas(this);this.context=tempContext};CanvasRenderer.prototype.resize=function(w,h){SystemRenderer.prototype.resize.call(this,w,h);if(this.smoothProperty){this.context[this.smoothProperty]=CONST.SCALE_MODES.DEFAULT===CONST.SCALE_MODES.LINEAR}};CanvasRenderer.prototype._mapBlendModes=function(){if(!this.blendModes){this.blendModes={};if(utils.canUseNewCanvasBlendModes()){this.blendModes[CONST.BLEND_MODES.NORMAL]="source-over";this.blendModes[CONST.BLEND_MODES.ADD]="lighter";this.blendModes[CONST.BLEND_MODES.MULTIPLY]="multiply";this.blendModes[CONST.BLEND_MODES.SCREEN]="screen";this.blendModes[CONST.BLEND_MODES.OVERLAY]="overlay";this.blendModes[CONST.BLEND_MODES.DARKEN]="darken";this.blendModes[CONST.BLEND_MODES.LIGHTEN]="lighten";this.blendModes[CONST.BLEND_MODES.COLOR_DODGE]="color-dodge";this.blendModes[CONST.BLEND_MODES.COLOR_BURN]="color-burn";this.blendModes[CONST.BLEND_MODES.HARD_LIGHT]="hard-light";this.blendModes[CONST.BLEND_MODES.SOFT_LIGHT]="soft-light";this.blendModes[CONST.BLEND_MODES.DIFFERENCE]="difference";this.blendModes[CONST.BLEND_MODES.EXCLUSION]="exclusion";this.blendModes[CONST.BLEND_MODES.HUE]="hue";this.blendModes[CONST.BLEND_MODES.SATURATION]="saturate";this.blendModes[CONST.BLEND_MODES.COLOR]="color";this.blendModes[CONST.BLEND_MODES.LUMINOSITY]="luminosity"}else{this.blendModes[CONST.BLEND_MODES.NORMAL]="source-over";this.blendModes[CONST.BLEND_MODES.ADD]="lighter";this.blendModes[CONST.BLEND_MODES.MULTIPLY]="source-over";this.blendModes[CONST.BLEND_MODES.SCREEN]="source-over";this.blendModes[CONST.BLEND_MODES.OVERLAY]="source-over";this.blendModes[CONST.BLEND_MODES.DARKEN]="source-over";this.blendModes[CONST.BLEND_MODES.LIGHTEN]="source-over";this.blendModes[CONST.BLEND_MODES.COLOR_DODGE]="source-over";this.blendModes[CONST.BLEND_MODES.COLOR_BURN]="source-over";this.blendModes[CONST.BLEND_MODES.HARD_LIGHT]="source-over";this.blendModes[CONST.BLEND_MODES.SOFT_LIGHT]="source-over";this.blendModes[CONST.BLEND_MODES.DIFFERENCE]="source-over";this.blendModes[CONST.BLEND_MODES.EXCLUSION]="source-over";this.blendModes[CONST.BLEND_MODES.HUE]="source-over";this.blendModes[CONST.BLEND_MODES.SATURATION]="source-over";this.blendModes[CONST.BLEND_MODES.COLOR]="source-over";this.blendModes[CONST.BLEND_MODES.LUMINOSITY]="source-over"}}}},{"../../const":22,"../../math":33,"../../utils":77,"../SystemRenderer":43,"./utils/CanvasMaskManager":47}],45:[function(require,module,exports){function CanvasBuffer(width,height){this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d");this.canvas.width=width;this.canvas.height=height}CanvasBuffer.prototype.constructor=CanvasBuffer;module.exports=CanvasBuffer;Object.defineProperties(CanvasBuffer.prototype,{width:{get:function(){return this.canvas.width},set:function(val){this.canvas.width=val}},height:{get:function(){return this.canvas.height},set:function(val){this.canvas.height=val}}});CanvasBuffer.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0);this.context.clearRect(0,0,this.canvas.width,this.canvas.height)};CanvasBuffer.prototype.resize=function(width,height){this.canvas.width=width;this.canvas.height=height};CanvasBuffer.prototype.destroy=function(){this.context=null;this.canvas=null}},{}],46:[function(require,module,exports){var CONST=require("../../../const");var CanvasGraphics={};module.exports=CanvasGraphics;CanvasGraphics.renderGraphics=function(graphics,context){var worldAlpha=graphics.worldAlpha;if(graphics.dirty){this.updateGraphicsTint(graphics);graphics.dirty=false}for(var i=0;i<graphics.graphicsData.length;i++){var data=graphics.graphicsData[i];var shape=data.shape;var fillColor=data._fillTint;var lineColor=data._lineTint;context.lineWidth=data.lineWidth;if(data.type===CONST.SHAPES.POLY){context.beginPath();var points=shape.points;context.moveTo(points[0],points[1]);for(var j=1;j<points.length/2;j++){context.lineTo(points[j*2],points[j*2+1])}if(shape.closed){context.lineTo(points[0],points[1])}if(points[0]===points[points.length-2]&&points[1]===points[points.length-1]){context.closePath()}if(data.fill){context.globalAlpha=data.fillAlpha*worldAlpha;context.fillStyle="#"+("00000"+(fillColor|0).toString(16)).substr(-6);context.fill()}if(data.lineWidth){context.globalAlpha=data.lineAlpha*worldAlpha;context.strokeStyle="#"+("00000"+(lineColor|0).toString(16)).substr(-6);context.stroke()}}else if(data.type===CONST.SHAPES.RECT){if(data.fillColor||data.fillColor===0){context.globalAlpha=data.fillAlpha*worldAlpha;context.fillStyle="#"+("00000"+(fillColor|0).toString(16)).substr(-6);context.fillRect(shape.x,shape.y,shape.width,shape.height)}if(data.lineWidth){context.globalAlpha=data.lineAlpha*worldAlpha;context.strokeStyle="#"+("00000"+(lineColor|0).toString(16)).substr(-6);context.strokeRect(shape.x,shape.y,shape.width,shape.height)}}else if(data.type===CONST.SHAPES.CIRC){context.beginPath();context.arc(shape.x,shape.y,shape.radius,0,2*Math.PI);context.closePath();if(data.fill){context.globalAlpha=data.fillAlpha*worldAlpha;context.fillStyle="#"+("00000"+(fillColor|0).toString(16)).substr(-6);context.fill()}if(data.lineWidth){context.globalAlpha=data.lineAlpha*worldAlpha;context.strokeStyle="#"+("00000"+(lineColor|0).toString(16)).substr(-6);context.stroke()}}else if(data.type===CONST.SHAPES.ELIP){var w=shape.width*2;var h=shape.height*2;var x=shape.x-w/2;var y=shape.y-h/2;context.beginPath();var kappa=.5522848,ox=w/2*kappa,oy=h/2*kappa,xe=x+w,ye=y+h,xm=x+w/2,ym=y+h/2;context.moveTo(x,ym);context.bezierCurveTo(x,ym-oy,xm-ox,y,xm,y);context.bezierCurveTo(xm+ox,y,xe,ym-oy,xe,ym);context.bezierCurveTo(xe,ym+oy,xm+ox,ye,xm,ye);context.bezierCurveTo(xm-ox,ye,x,ym+oy,x,ym);context.closePath();if(data.fill){context.globalAlpha=data.fillAlpha*worldAlpha;context.fillStyle="#"+("00000"+(fillColor|0).toString(16)).substr(-6);context.fill()}if(data.lineWidth){context.globalAlpha=data.lineAlpha*worldAlpha;context.strokeStyle="#"+("00000"+(lineColor|0).toString(16)).substr(-6);context.stroke()}}else if(data.type===CONST.SHAPES.RREC){var rx=shape.x;var ry=shape.y;var width=shape.width;var height=shape.height;var radius=shape.radius;var maxRadius=Math.min(width,height)/2|0;radius=radius>maxRadius?maxRadius:radius;context.beginPath();context.moveTo(rx,ry+radius);context.lineTo(rx,ry+height-radius);context.quadraticCurveTo(rx,ry+height,rx+radius,ry+height);context.lineTo(rx+width-radius,ry+height);context.quadraticCurveTo(rx+width,ry+height,rx+width,ry+height-radius);context.lineTo(rx+width,ry+radius);context.quadraticCurveTo(rx+width,ry,rx+width-radius,ry);context.lineTo(rx+radius,ry);context.quadraticCurveTo(rx,ry,rx,ry+radius);context.closePath();if(data.fillColor||data.fillColor===0){context.globalAlpha=data.fillAlpha*worldAlpha;context.fillStyle="#"+("00000"+(fillColor|0).toString(16)).substr(-6);context.fill()}if(data.lineWidth){context.globalAlpha=data.lineAlpha*worldAlpha;context.strokeStyle="#"+("00000"+(lineColor|0).toString(16)).substr(-6);context.stroke()}}}};CanvasGraphics.renderGraphicsMask=function(graphics,context){var len=graphics.graphicsData.length;if(len===0){return}context.beginPath();for(var i=0;i<len;i++){var data=graphics.graphicsData[i];var shape=data.shape;if(data.type===CONST.SHAPES.POLY){var points=shape.points;context.moveTo(points[0],points[1]);for(var j=1;j<points.length/2;j++){context.lineTo(points[j*2],points[j*2+1])}if(points[0]===points[points.length-2]&&points[1]===points[points.length-1]){context.closePath()}}else if(data.type===CONST.SHAPES.RECT){context.rect(shape.x,shape.y,shape.width,shape.height);context.closePath()}else if(data.type===CONST.SHAPES.CIRC){context.arc(shape.x,shape.y,shape.radius,0,2*Math.PI);context.closePath()}else if(data.type===CONST.SHAPES.ELIP){var w=shape.width*2;var h=shape.height*2;var x=shape.x-w/2;var y=shape.y-h/2;var kappa=.5522848,ox=w/2*kappa,oy=h/2*kappa,xe=x+w,ye=y+h,xm=x+w/2,ym=y+h/2;context.moveTo(x,ym);context.bezierCurveTo(x,ym-oy,xm-ox,y,xm,y);context.bezierCurveTo(xm+ox,y,xe,ym-oy,xe,ym);context.bezierCurveTo(xe,ym+oy,xm+ox,ye,xm,ye);context.bezierCurveTo(xm-ox,ye,x,ym+oy,x,ym);context.closePath()}else if(data.type===CONST.SHAPES.RREC){var rx=shape.x;var ry=shape.y;var width=shape.width;var height=shape.height;var radius=shape.radius;var maxRadius=Math.min(width,height)/2|0;radius=radius>maxRadius?maxRadius:radius;context.moveTo(rx,ry+radius);context.lineTo(rx,ry+height-radius);context.quadraticCurveTo(rx,ry+height,rx+radius,ry+height);context.lineTo(rx+width-radius,ry+height);context.quadraticCurveTo(rx+width,ry+height,rx+width,ry+height-radius);context.lineTo(rx+width,ry+radius);context.quadraticCurveTo(rx+width,ry,rx+width-radius,ry);context.lineTo(rx+radius,ry);context.quadraticCurveTo(rx,ry,rx,ry+radius);context.closePath()}}};CanvasGraphics.updateGraphicsTint=function(graphics){if(graphics.tint===16777215&&graphics._prevTint===graphics.tint){return}graphics._prevTint=graphics.tint;var tintR=(graphics.tint>>16&255)/255;var tintG=(graphics.tint>>8&255)/255;var tintB=(graphics.tint&255)/255;for(var i=0;i<graphics.graphicsData.length;i++){var data=graphics.graphicsData[i];var fillColor=data.fillColor|0;var lineColor=data.lineColor|0;data._fillTint=((fillColor>>16&255)/255*tintR*255<<16)+((fillColor>>8&255)/255*tintG*255<<8)+(fillColor&255)/255*tintB*255;data._lineTint=((lineColor>>16&255)/255*tintR*255<<16)+((lineColor>>8&255)/255*tintG*255<<8)+(lineColor&255)/255*tintB*255}}},{"../../../const":22}],47:[function(require,module,exports){var CanvasGraphics=require("./CanvasGraphics");function CanvasMaskManager(){}CanvasMaskManager.prototype.constructor=CanvasMaskManager;module.exports=CanvasMaskManager;CanvasMaskManager.prototype.pushMask=function(maskData,renderer){renderer.context.save();var cacheAlpha=maskData.alpha;var transform=maskData.worldTransform;var resolution=renderer.resolution;renderer.context.setTransform(transform.a*resolution,transform.b*resolution,transform.c*resolution,transform.d*resolution,transform.tx*resolution,transform.ty*resolution);if(!maskData.texture){CanvasGraphics.renderGraphicsMask(maskData,renderer.context);renderer.context.clip()}maskData.worldAlpha=cacheAlpha};CanvasMaskManager.prototype.popMask=function(renderer){renderer.context.restore()};CanvasMaskManager.prototype.destroy=function(){}},{"./CanvasGraphics":46}],48:[function(require,module,exports){var utils=require("../../../utils");var CanvasTinter={};module.exports=CanvasTinter;CanvasTinter.getTintedTexture=function(sprite,color){var texture=sprite.texture;color=CanvasTinter.roundColor(color);var stringColor="#"+("00000"+(color|0).toString(16)).substr(-6);texture.tintCache=texture.tintCache||{};if(texture.tintCache[stringColor]){return texture.tintCache[stringColor]}var canvas=CanvasTinter.canvas||document.createElement("canvas");CanvasTinter.tintMethod(texture,color,canvas);if(CanvasTinter.convertTintToImage){var tintImage=new Image;tintImage.src=canvas.toDataURL();texture.tintCache[stringColor]=tintImage}else{texture.tintCache[stringColor]=canvas;CanvasTinter.canvas=null}return canvas};CanvasTinter.tintWithMultiply=function(texture,color,canvas){var context=canvas.getContext("2d");var resolution=texture.baseTexture.resolution;var crop=texture.crop.clone();crop.x*=resolution;crop.y*=resolution;crop.width*=resolution;crop.height*=resolution;canvas.width=crop.width;canvas.height=crop.height;context.fillStyle="#"+("00000"+(color|0).toString(16)).substr(-6);context.fillRect(0,0,crop.width,crop.height);context.globalCompositeOperation="multiply";context.drawImage(texture.baseTexture.source,crop.x,crop.y,crop.width,crop.height,0,0,crop.width,crop.height);context.globalCompositeOperation="destination-atop";context.drawImage(texture.baseTexture.source,crop.x,crop.y,crop.width,crop.height,0,0,crop.width,crop.height)};CanvasTinter.tintWithOverlay=function(texture,color,canvas){var context=canvas.getContext("2d");var resolution=texture.baseTexture.resolution;var crop=texture.crop.clone();crop.x*=resolution;crop.y*=resolution;crop.width*=resolution;crop.height*=resolution;canvas.width=crop.width;canvas.height=crop.height;context.globalCompositeOperation="copy";context.fillStyle="#"+("00000"+(color|0).toString(16)).substr(-6);context.fillRect(0,0,crop.width,crop.height);context.globalCompositeOperation="destination-atop";context.drawImage(texture.baseTexture.source,crop.x,crop.y,crop.width,crop.height,0,0,crop.width,crop.height)};CanvasTinter.tintWithPerPixel=function(texture,color,canvas){var context=canvas.getContext("2d");var resolution=texture.baseTexture.resolution;var crop=texture.crop.clone();crop.x*=resolution;crop.y*=resolution;crop.width*=resolution;crop.height*=resolution;canvas.width=crop.width;canvas.height=crop.height;context.globalCompositeOperation="copy";context.drawImage(texture.baseTexture.source,crop.x,crop.y,crop.width,crop.height,0,0,crop.width,crop.height);var rgbValues=utils.hex2rgb(color);var r=rgbValues[0],g=rgbValues[1],b=rgbValues[2];var pixelData=context.getImageData(0,0,crop.width,crop.height);var pixels=pixelData.data;for(var i=0;i<pixels.length;i+=4){pixels[i+0]*=r;pixels[i+1]*=g;pixels[i+2]*=b}context.putImageData(pixelData,0,0)};CanvasTinter.roundColor=function(color){var step=CanvasTinter.cacheStepsPerColorChannel;var rgbValues=utils.hex2rgb(color);rgbValues[0]=Math.min(255,rgbValues[0]/step*step);rgbValues[1]=Math.min(255,rgbValues[1]/step*step);rgbValues[2]=Math.min(255,rgbValues[2]/step*step);return utils.rgb2hex(rgbValues)};CanvasTinter.cacheStepsPerColorChannel=8;CanvasTinter.convertTintToImage=false;CanvasTinter.canUseMultiply=utils.canUseNewCanvasBlendModes();
CanvasTinter.tintMethod=CanvasTinter.canUseMultiply?CanvasTinter.tintWithMultiply:CanvasTinter.tintWithPerPixel},{"../../../utils":77}],49:[function(require,module,exports){var SystemRenderer=require("../SystemRenderer"),ShaderManager=require("./managers/ShaderManager"),MaskManager=require("./managers/MaskManager"),StencilManager=require("./managers/StencilManager"),FilterManager=require("./managers/FilterManager"),BlendModeManager=require("./managers/BlendModeManager"),RenderTarget=require("./utils/RenderTarget"),ObjectRenderer=require("./utils/ObjectRenderer"),FXAAFilter=require("./filters/FXAAFilter"),utils=require("../../utils"),CONST=require("../../const");function WebGLRenderer(width,height,options){options=options||{};SystemRenderer.call(this,"WebGL",width,height,options);this.type=CONST.RENDERER_TYPE.WEBGL;this.handleContextLost=this.handleContextLost.bind(this);this.handleContextRestored=this.handleContextRestored.bind(this);this.view.addEventListener("webglcontextlost",this.handleContextLost,false);this.view.addEventListener("webglcontextrestored",this.handleContextRestored,false);this._useFXAA=!!options.forceFXAA&&options.antialias;this._FXAAFilter=null;this._contextOptions={alpha:this.transparent,antialias:options.antialias,premultipliedAlpha:this.transparent&&this.transparent!=="notMultiplied",stencil:true,preserveDrawingBuffer:options.preserveDrawingBuffer};this.drawCount=0;this.shaderManager=new ShaderManager(this);this.maskManager=new MaskManager(this);this.stencilManager=new StencilManager(this);this.filterManager=new FilterManager(this);this.blendModeManager=new BlendModeManager(this);this.currentRenderTarget=null;this.currentRenderer=new ObjectRenderer(this);this.initPlugins();this._createContext();this._initContext();this._mapGlModes();this._managedTextures=[];this._renderTargetStack=[]}WebGLRenderer.prototype=Object.create(SystemRenderer.prototype);WebGLRenderer.prototype.constructor=WebGLRenderer;module.exports=WebGLRenderer;utils.pluginTarget.mixin(WebGLRenderer);WebGLRenderer.glContextId=0;WebGLRenderer.prototype._createContext=function(){var gl=this.view.getContext("webgl",this._contextOptions)||this.view.getContext("experimental-webgl",this._contextOptions);this.gl=gl;if(!gl){throw new Error("This browser does not support webGL. Try using the canvas renderer")}this.glContextId=WebGLRenderer.glContextId++;gl.id=this.glContextId;gl.renderer=this};WebGLRenderer.prototype._initContext=function(){var gl=this.gl;gl.disable(gl.DEPTH_TEST);gl.disable(gl.CULL_FACE);gl.enable(gl.BLEND);this.renderTarget=new RenderTarget(gl,this.width,this.height,null,this.resolution,true);this.setRenderTarget(this.renderTarget);this.emit("context",gl);this.resize(this.width,this.height);if(!this._useFXAA){this._useFXAA=this._contextOptions.antialias&&!gl.getContextAttributes().antialias}if(this._useFXAA){window.console.warn("FXAA antialiasing being used instead of native antialiasing");this._FXAAFilter=[new FXAAFilter]}};WebGLRenderer.prototype.render=function(object){this.emit("prerender");if(this.gl.isContextLost()){return}this.drawCount=0;this._lastObjectRendered=object;if(this._useFXAA){this._FXAAFilter[0].uniforms.resolution.value.x=this.width;this._FXAAFilter[0].uniforms.resolution.value.y=this.height;object.filterArea=this.renderTarget.size;object.filters=this._FXAAFilter}var cacheParent=object.parent;object.parent=this._tempDisplayObjectParent;object.updateTransform();object.parent=cacheParent;var gl=this.gl;this.setRenderTarget(this.renderTarget);if(this.clearBeforeRender){if(this.transparent){gl.clearColor(0,0,0,0)}else{gl.clearColor(this._backgroundColorRgb[0],this._backgroundColorRgb[1],this._backgroundColorRgb[2],1)}gl.clear(gl.COLOR_BUFFER_BIT)}this.renderDisplayObject(object,this.renderTarget);this.emit("postrender")};WebGLRenderer.prototype.renderDisplayObject=function(displayObject,renderTarget,clear){this.setRenderTarget(renderTarget);if(clear){renderTarget.clear()}this.filterManager.setFilterStack(renderTarget.filterStack);displayObject.renderWebGL(this);this.currentRenderer.flush()};WebGLRenderer.prototype.setObjectRenderer=function(objectRenderer){if(this.currentRenderer===objectRenderer){return}this.currentRenderer.stop();this.currentRenderer=objectRenderer;this.currentRenderer.start()};WebGLRenderer.prototype.setRenderTarget=function(renderTarget){if(this.currentRenderTarget===renderTarget){return}this.currentRenderTarget=renderTarget;this.currentRenderTarget.activate();this.stencilManager.setMaskStack(renderTarget.stencilMaskStack)};WebGLRenderer.prototype.resize=function(width,height){SystemRenderer.prototype.resize.call(this,width,height);this.filterManager.resize(width,height);this.renderTarget.resize(width,height);if(this.currentRenderTarget===this.renderTarget){this.renderTarget.activate();this.gl.viewport(0,0,this.width,this.height)}};WebGLRenderer.prototype.updateTexture=function(texture){texture=texture.baseTexture||texture;if(!texture.hasLoaded){return}var gl=this.gl;if(!texture._glTextures[gl.id]){texture._glTextures[gl.id]=gl.createTexture();texture.on("update",this.updateTexture,this);texture.on("dispose",this.destroyTexture,this);this._managedTextures.push(texture)}gl.bindTexture(gl.TEXTURE_2D,texture._glTextures[gl.id]);gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,texture.premultipliedAlpha);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,texture.source);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,texture.scaleMode===CONST.SCALE_MODES.LINEAR?gl.LINEAR:gl.NEAREST);if(texture.mipmap&&texture.isPowerOfTwo){gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,texture.scaleMode===CONST.SCALE_MODES.LINEAR?gl.LINEAR_MIPMAP_LINEAR:gl.NEAREST_MIPMAP_NEAREST);gl.generateMipmap(gl.TEXTURE_2D)}else{gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,texture.scaleMode===CONST.SCALE_MODES.LINEAR?gl.LINEAR:gl.NEAREST)}if(!texture.isPowerOfTwo){gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE)}else{gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.REPEAT);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.REPEAT)}return texture._glTextures[gl.id]};WebGLRenderer.prototype.destroyTexture=function(texture,_skipRemove){texture=texture.baseTexture||texture;if(!texture.hasLoaded){return}if(texture._glTextures[this.gl.id]){this.gl.deleteTexture(texture._glTextures[this.gl.id]);delete texture._glTextures[this.gl.id];if(!_skipRemove){var i=this._managedTextures.indexOf(texture);if(i!==-1){utils.removeItems(this._managedTextures,i,1)}}}};WebGLRenderer.prototype.handleContextLost=function(event){event.preventDefault()};WebGLRenderer.prototype.handleContextRestored=function(){this._initContext();for(var i=0;i<this._managedTextures.length;++i){var texture=this._managedTextures[i];if(texture._glTextures[this.gl.id]){delete texture._glTextures[this.gl.id]}}};WebGLRenderer.prototype.destroy=function(removeView){this.destroyPlugins();this.view.removeEventListener("webglcontextlost",this.handleContextLost);this.view.removeEventListener("webglcontextrestored",this.handleContextRestored);for(var i=0;i<this._managedTextures.length;++i){var texture=this._managedTextures[i];this.destroyTexture(texture,true);texture.off("update",this.updateTexture,this);texture.off("dispose",this.destroyTexture,this)}SystemRenderer.prototype.destroy.call(this,removeView);this.uid=0;this.shaderManager.destroy();this.maskManager.destroy();this.stencilManager.destroy();this.filterManager.destroy();this.blendModeManager.destroy();this.shaderManager=null;this.maskManager=null;this.filterManager=null;this.blendModeManager=null;this.currentRenderer=null;this.handleContextLost=null;this.handleContextRestored=null;this._contextOptions=null;this._managedTextures=null;this.drawCount=0;this.gl.useProgram(null);this.gl.flush();this.gl=null};WebGLRenderer.prototype._mapGlModes=function(){var gl=this.gl;if(!this.blendModes){this.blendModes={};this.blendModes[CONST.BLEND_MODES.NORMAL]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];this.blendModes[CONST.BLEND_MODES.ADD]=[gl.ONE,gl.DST_ALPHA];this.blendModes[CONST.BLEND_MODES.MULTIPLY]=[gl.DST_COLOR,gl.ONE_MINUS_SRC_ALPHA];this.blendModes[CONST.BLEND_MODES.SCREEN]=[gl.ONE,gl.ONE_MINUS_SRC_COLOR];this.blendModes[CONST.BLEND_MODES.OVERLAY]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];this.blendModes[CONST.BLEND_MODES.DARKEN]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];this.blendModes[CONST.BLEND_MODES.LIGHTEN]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];this.blendModes[CONST.BLEND_MODES.COLOR_DODGE]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];this.blendModes[CONST.BLEND_MODES.COLOR_BURN]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];this.blendModes[CONST.BLEND_MODES.HARD_LIGHT]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];this.blendModes[CONST.BLEND_MODES.SOFT_LIGHT]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];this.blendModes[CONST.BLEND_MODES.DIFFERENCE]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];this.blendModes[CONST.BLEND_MODES.EXCLUSION]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];this.blendModes[CONST.BLEND_MODES.HUE]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];this.blendModes[CONST.BLEND_MODES.SATURATION]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];this.blendModes[CONST.BLEND_MODES.COLOR]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];this.blendModes[CONST.BLEND_MODES.LUMINOSITY]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA]}if(!this.drawModes){this.drawModes={};this.drawModes[CONST.DRAW_MODES.POINTS]=gl.POINTS;this.drawModes[CONST.DRAW_MODES.LINES]=gl.LINES;this.drawModes[CONST.DRAW_MODES.LINE_LOOP]=gl.LINE_LOOP;this.drawModes[CONST.DRAW_MODES.LINE_STRIP]=gl.LINE_STRIP;this.drawModes[CONST.DRAW_MODES.TRIANGLES]=gl.TRIANGLES;this.drawModes[CONST.DRAW_MODES.TRIANGLE_STRIP]=gl.TRIANGLE_STRIP;this.drawModes[CONST.DRAW_MODES.TRIANGLE_FAN]=gl.TRIANGLE_FAN}}},{"../../const":22,"../../utils":77,"../SystemRenderer":43,"./filters/FXAAFilter":51,"./managers/BlendModeManager":53,"./managers/FilterManager":54,"./managers/MaskManager":55,"./managers/ShaderManager":56,"./managers/StencilManager":57,"./utils/ObjectRenderer":63,"./utils/RenderTarget":65}],50:[function(require,module,exports){var DefaultShader=require("../shaders/TextureShader");function AbstractFilter(vertexSrc,fragmentSrc,uniforms){this.shaders=[];this.padding=0;this.uniforms=uniforms||{};this.vertexSrc=vertexSrc||DefaultShader.defaultVertexSrc;this.fragmentSrc=fragmentSrc||DefaultShader.defaultFragmentSrc}AbstractFilter.prototype.constructor=AbstractFilter;module.exports=AbstractFilter;AbstractFilter.prototype.getShader=function(renderer){var gl=renderer.gl;var shader=this.shaders[gl.id];if(!shader){shader=new DefaultShader(renderer.shaderManager,this.vertexSrc,this.fragmentSrc,this.uniforms,this.attributes);this.shaders[gl.id]=shader}return shader};AbstractFilter.prototype.applyFilter=function(renderer,input,output,clear){var shader=this.getShader(renderer);renderer.filterManager.applyFilter(shader,input,output,clear)};AbstractFilter.prototype.syncUniform=function(uniform){for(var i=0,j=this.shaders.length;i<j;++i){this.shaders[i].syncUniform(uniform)}}},{"../shaders/TextureShader":62}],51:[function(require,module,exports){var AbstractFilter=require("./AbstractFilter");function FXAAFilter(){AbstractFilter.call(this,"\nprecision mediump float;\n\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform mat3 projectionMatrix;\nuniform vec2 resolution;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvarying vec2 vResolution;\n\n//texcoords computed in vertex step\n//to avoid dependent texture reads\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\n\nvoid texcoords(vec2 fragCoord, vec2 resolution,\n            out vec2 v_rgbNW, out vec2 v_rgbNE,\n            out vec2 v_rgbSW, out vec2 v_rgbSE,\n            out vec2 v_rgbM) {\n    vec2 inverseVP = 1.0 / resolution.xy;\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n   vColor = vec4(aColor.rgb * aColor.a, aColor.a);\n   vResolution = resolution;\n\n   //compute the texture coords and send them to varyings\n   texcoords(aTextureCoord * resolution, resolution, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}\n",'precision lowp float;\n\n\n/**\nBasic FXAA implementation based on the code on geeks3d.com with the\nmodification that the texture2DLod stuff was removed since it\'s\nunsupported by WebGL.\n\n--\n\nFrom:\nhttps://github.com/mitsuhiko/webgl-meincraft\n\nCopyright (c) 2011 by Armin Ronacher.\n\nSome rights reserved.\n\nRedistribution and use in source and binary forms, with or without\nmodification, are permitted provided that the following conditions are\nmet:\n\n    * Redistributions of source code must retain the above copyright\n      notice, this list of conditions and the following disclaimer.\n\n    * Redistributions in binary form must reproduce the above\n      copyright notice, this list of conditions and the following\n      disclaimer in the documentation and/or other materials provided\n      with the distribution.\n\n    * The names of the contributors may not be used to endorse or\n      promote products derived from this software without specific\n      prior written permission.\n\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n"AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\nLIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\nA PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\nOWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\nSPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\nLIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\nDATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\nTHEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\nOF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n#ifndef FXAA_REDUCE_MIN\n    #define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n    #define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n    #define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 resolution,\n            vec2 v_rgbNW, vec2 v_rgbNE,\n            vec2 v_rgbSW, vec2 v_rgbSE,\n            vec2 v_rgbM) {\n    vec4 color;\n    mediump vec2 inverseVP = vec2(1.0 / resolution.x, 1.0 / resolution.y);\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n              dir * rcpDirMin)) * inverseVP;\n\n    vec3 rgbA = 0.5 * (\n        texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n        texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n        texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n        texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n\n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying vec2 vResolution;\n\n//texcoords computed in vertex step\n//to avoid dependent texture reads\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nuniform sampler2D uSampler;\n\n\nvoid main(void){\n\n    gl_FragColor = fxaa(uSampler, vTextureCoord * vResolution, vResolution, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n}\n',{resolution:{type:"v2",value:{x:1,y:1}}})}FXAAFilter.prototype=Object.create(AbstractFilter.prototype);FXAAFilter.prototype.constructor=FXAAFilter;module.exports=FXAAFilter;FXAAFilter.prototype.applyFilter=function(renderer,input,output){var filterManager=renderer.filterManager;var shader=this.getShader(renderer);filterManager.applyFilter(shader,input,output)}},{"./AbstractFilter":50}],52:[function(require,module,exports){var AbstractFilter=require("./AbstractFilter"),math=require("../../../math");function SpriteMaskFilter(sprite){var maskMatrix=new math.Matrix;AbstractFilter.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n    vColor = vec4(aColor.rgb * aColor.a, aColor.a);\n}\n","precision lowp float;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\nuniform float alpha;\nuniform sampler2D mask;\n\nvoid main(void)\n{\n    // check clip! this will stop the mask bleeding out from the edges\n    vec2 text = abs( vMaskCoord - 0.5 );\n    text = step(0.5, text);\n    float clip = 1.0 - max(text.y, text.x);\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    original *= (masky.r * masky.a * alpha * clip);\n    gl_FragColor = original;\n}\n",{mask:{type:"sampler2D",value:sprite._texture},alpha:{type:"f",value:1},otherMatrix:{type:"mat3",value:maskMatrix.toArray(true)}});this.maskSprite=sprite;this.maskMatrix=maskMatrix}SpriteMaskFilter.prototype=Object.create(AbstractFilter.prototype);SpriteMaskFilter.prototype.constructor=SpriteMaskFilter;module.exports=SpriteMaskFilter;SpriteMaskFilter.prototype.applyFilter=function(renderer,input,output){var filterManager=renderer.filterManager;this.uniforms.mask.value=this.maskSprite._texture;filterManager.calculateMappedMatrix(input.frame,this.maskSprite,this.maskMatrix);this.uniforms.otherMatrix.value=this.maskMatrix.toArray(true);this.uniforms.alpha.value=this.maskSprite.worldAlpha;var shader=this.getShader(renderer);filterManager.applyFilter(shader,input,output)};Object.defineProperties(SpriteMaskFilter.prototype,{map:{get:function(){return this.uniforms.mask.value},set:function(value){this.uniforms.mask.value=value}},offset:{get:function(){return this.uniforms.offset.value},set:function(value){this.uniforms.offset.value=value}}})},{"../../../math":33,"./AbstractFilter":50}],53:[function(require,module,exports){var WebGLManager=require("./WebGLManager");function BlendModeManager(renderer){WebGLManager.call(this,renderer);this.currentBlendMode=99999}BlendModeManager.prototype=Object.create(WebGLManager.prototype);BlendModeManager.prototype.constructor=BlendModeManager;module.exports=BlendModeManager;BlendModeManager.prototype.setBlendMode=function(blendMode){if(this.currentBlendMode===blendMode){return false}this.currentBlendMode=blendMode;var mode=this.renderer.blendModes[this.currentBlendMode];this.renderer.gl.blendFunc(mode[0],mode[1]);return true}},{"./WebGLManager":58}],54:[function(require,module,exports){var WebGLManager=require("./WebGLManager"),RenderTarget=require("../utils/RenderTarget"),CONST=require("../../../const"),Quad=require("../utils/Quad"),math=require("../../../math");function FilterManager(renderer){WebGLManager.call(this,renderer);this.filterStack=[];this.filterStack.push({renderTarget:renderer.currentRenderTarget,filter:[],bounds:null});this.texturePool=[];this.textureSize=new math.Rectangle(0,0,renderer.width,renderer.height);this.currentFrame=null}FilterManager.prototype=Object.create(WebGLManager.prototype);FilterManager.prototype.constructor=FilterManager;module.exports=FilterManager;FilterManager.prototype.onContextChange=function(){this.texturePool.length=0;var gl=this.renderer.gl;this.quad=new Quad(gl)};FilterManager.prototype.setFilterStack=function(filterStack){this.filterStack=filterStack};FilterManager.prototype.pushFilter=function(target,filters){var bounds=target.filterArea?target.filterArea.clone():target.getBounds();bounds.x=bounds.x|0;bounds.y=bounds.y|0;bounds.width=bounds.width|0;bounds.height=bounds.height|0;var padding=filters[0].padding|0;bounds.x-=padding;bounds.y-=padding;bounds.width+=padding*2;bounds.height+=padding*2;if(this.renderer.currentRenderTarget.transform){var transform=this.renderer.currentRenderTarget.transform;bounds.x+=transform.tx;bounds.y+=transform.ty;this.capFilterArea(bounds);bounds.x-=transform.tx;bounds.y-=transform.ty}else{this.capFilterArea(bounds)}if(bounds.width>0&&bounds.height>0){this.currentFrame=bounds;var texture=this.getRenderTarget();this.renderer.setRenderTarget(texture);texture.clear();this.filterStack.push({renderTarget:texture,filter:filters})}else{this.filterStack.push({renderTarget:null,filter:filters})}};FilterManager.prototype.popFilter=function(){var filterData=this.filterStack.pop();var previousFilterData=this.filterStack[this.filterStack.length-1];var input=filterData.renderTarget;if(!filterData.renderTarget){return}var output=previousFilterData.renderTarget;var gl=this.renderer.gl;this.currentFrame=input.frame;this.quad.map(this.textureSize,input.frame);gl.bindBuffer(gl.ARRAY_BUFFER,this.quad.vertexBuffer);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.quad.indexBuffer);var filters=filterData.filter;gl.vertexAttribPointer(this.renderer.shaderManager.defaultShader.attributes.aVertexPosition,2,gl.FLOAT,false,0,0);gl.vertexAttribPointer(this.renderer.shaderManager.defaultShader.attributes.aTextureCoord,2,gl.FLOAT,false,0,2*4*4);gl.vertexAttribPointer(this.renderer.shaderManager.defaultShader.attributes.aColor,4,gl.FLOAT,false,0,4*4*4);this.renderer.blendModeManager.setBlendMode(CONST.BLEND_MODES.NORMAL);if(filters.length===1){if(filters[0].uniforms.dimensions){filters[0].uniforms.dimensions.value[0]=this.renderer.width;filters[0].uniforms.dimensions.value[1]=this.renderer.height;filters[0].uniforms.dimensions.value[2]=this.quad.vertices[0];filters[0].uniforms.dimensions.value[3]=this.quad.vertices[5]}filters[0].applyFilter(this.renderer,input,output);this.returnRenderTarget(input)}else{var flipTexture=input;var flopTexture=this.getRenderTarget(true);for(var i=0;i<filters.length-1;i++){var filter=filters[i];if(filter.uniforms.dimensions){filter.uniforms.dimensions.value[0]=this.renderer.width;filter.uniforms.dimensions.value[1]=this.renderer.height;filter.uniforms.dimensions.value[2]=this.quad.vertices[0];filter.uniforms.dimensions.value[3]=this.quad.vertices[5]}filter.applyFilter(this.renderer,flipTexture,flopTexture);var temp=flipTexture;flipTexture=flopTexture;flopTexture=temp}filters[filters.length-1].applyFilter(this.renderer,flipTexture,output);this.returnRenderTarget(flipTexture);this.returnRenderTarget(flopTexture)}return filterData.filter};FilterManager.prototype.getRenderTarget=function(clear){var renderTarget=this.texturePool.pop()||new RenderTarget(this.renderer.gl,this.textureSize.width,this.textureSize.height,CONST.SCALE_MODES.LINEAR,this.renderer.resolution*CONST.FILTER_RESOLUTION);renderTarget.frame=this.currentFrame;if(clear){renderTarget.clear(true)}return renderTarget};FilterManager.prototype.returnRenderTarget=function(renderTarget){this.texturePool.push(renderTarget)};FilterManager.prototype.applyFilter=function(shader,inputTarget,outputTarget,clear){var gl=this.renderer.gl;this.renderer.setRenderTarget(outputTarget);if(clear){outputTarget.clear()}this.renderer.shaderManager.setShader(shader);shader.uniforms.projectionMatrix.value=this.renderer.currentRenderTarget.projectionMatrix.toArray(true);shader.syncUniforms();gl.activeTexture(gl.TEXTURE0);gl.bindTexture(gl.TEXTURE_2D,inputTarget.texture);gl.drawElements(gl.TRIANGLES,6,gl.UNSIGNED_SHORT,0);this.renderer.drawCount++};FilterManager.prototype.calculateMappedMatrix=function(filterArea,sprite,outputMatrix){var worldTransform=sprite.worldTransform.copy(math.Matrix.TEMP_MATRIX),texture=sprite._texture.baseTexture;var mappedMatrix=outputMatrix.identity();var ratio=this.textureSize.height/this.textureSize.width;mappedMatrix.translate(filterArea.x/this.textureSize.width,filterArea.y/this.textureSize.height);mappedMatrix.scale(1,ratio);var translateScaleX=this.textureSize.width/texture.width;var translateScaleY=this.textureSize.height/texture.height;worldTransform.tx/=texture.width*translateScaleX;worldTransform.ty/=texture.width*translateScaleX;worldTransform.invert();mappedMatrix.prepend(worldTransform);mappedMatrix.scale(1,1/ratio);mappedMatrix.scale(translateScaleX,translateScaleY);mappedMatrix.translate(sprite.anchor.x,sprite.anchor.y);return mappedMatrix};FilterManager.prototype.capFilterArea=function(filterArea){if(filterArea.x<0){filterArea.width+=filterArea.x;filterArea.x=0}if(filterArea.y<0){filterArea.height+=filterArea.y;filterArea.y=0}if(filterArea.x+filterArea.width>this.textureSize.width){filterArea.width=this.textureSize.width-filterArea.x}if(filterArea.y+filterArea.height>this.textureSize.height){filterArea.height=this.textureSize.height-filterArea.y}};FilterManager.prototype.resize=function(width,height){this.textureSize.width=width;this.textureSize.height=height;for(var i=0;i<this.texturePool.length;i++){this.texturePool[i].resize(width,height)}};FilterManager.prototype.destroy=function(){this.quad.destroy();WebGLManager.prototype.destroy.call(this);this.filterStack=null;this.offsetY=0;for(var i=0;i<this.texturePool.length;i++){this.texturePool[i].destroy()}this.texturePool=null}},{"../../../const":22,"../../../math":33,"../utils/Quad":64,"../utils/RenderTarget":65,"./WebGLManager":58}],55:[function(require,module,exports){var WebGLManager=require("./WebGLManager"),AlphaMaskFilter=require("../filters/SpriteMaskFilter");function MaskManager(renderer){WebGLManager.call(this,renderer);this.stencilStack=[];this.reverse=true;this.count=0;this.alphaMaskPool=[]}MaskManager.prototype=Object.create(WebGLManager.prototype);MaskManager.prototype.constructor=MaskManager;module.exports=MaskManager;MaskManager.prototype.pushMask=function(target,maskData){if(maskData.texture){this.pushSpriteMask(target,maskData)}else{this.pushStencilMask(target,maskData)}};MaskManager.prototype.popMask=function(target,maskData){if(maskData.texture){this.popSpriteMask(target,maskData)}else{this.popStencilMask(target,maskData)}};MaskManager.prototype.pushSpriteMask=function(target,maskData){var alphaMaskFilter=this.alphaMaskPool.pop();if(!alphaMaskFilter){alphaMaskFilter=[new AlphaMaskFilter(maskData)]}alphaMaskFilter[0].maskSprite=maskData;this.renderer.filterManager.pushFilter(target,alphaMaskFilter)};MaskManager.prototype.popSpriteMask=function(){var filters=this.renderer.filterManager.popFilter();this.alphaMaskPool.push(filters)};MaskManager.prototype.pushStencilMask=function(target,maskData){this.renderer.stencilManager.pushMask(maskData)};MaskManager.prototype.popStencilMask=function(target,maskData){this.renderer.stencilManager.popMask(maskData)}},{"../filters/SpriteMaskFilter":52,"./WebGLManager":58}],56:[function(require,module,exports){var WebGLManager=require("./WebGLManager"),TextureShader=require("../shaders/TextureShader"),ComplexPrimitiveShader=require("../shaders/ComplexPrimitiveShader"),PrimitiveShader=require("../shaders/PrimitiveShader"),utils=require("../../../utils");function ShaderManager(renderer){WebGLManager.call(this,renderer);this.maxAttibs=10;this.attribState=[];this.tempAttribState=[];for(var i=0;i<this.maxAttibs;i++){this.attribState[i]=false}this.stack=[];this._currentId=-1;this.currentShader=null}ShaderManager.prototype=Object.create(WebGLManager.prototype);ShaderManager.prototype.constructor=ShaderManager;utils.pluginTarget.mixin(ShaderManager);module.exports=ShaderManager;ShaderManager.prototype.onContextChange=function(){this.initPlugins();var gl=this.renderer.gl;this.maxAttibs=gl.getParameter(gl.MAX_VERTEX_ATTRIBS);this.attribState=[];for(var i=0;i<this.maxAttibs;i++){this.attribState[i]=false}this.defaultShader=new TextureShader(this);this.primitiveShader=new PrimitiveShader(this);this.complexPrimitiveShader=new ComplexPrimitiveShader(this)};ShaderManager.prototype.setAttribs=function(attribs){var i;for(i=0;i<this.tempAttribState.length;i++){this.tempAttribState[i]=false}for(var a in attribs){this.tempAttribState[attribs[a]]=true}var gl=this.renderer.gl;for(i=0;i<this.attribState.length;i++){if(this.attribState[i]!==this.tempAttribState[i]){this.attribState[i]=this.tempAttribState[i];if(this.attribState[i]){gl.enableVertexAttribArray(i)}else{gl.disableVertexAttribArray(i)}}}};ShaderManager.prototype.setShader=function(shader){if(this._currentId===shader.uid){return false}this._currentId=shader.uid;this.currentShader=shader;this.renderer.gl.useProgram(shader.program);this.setAttribs(shader.attributes);return true};ShaderManager.prototype.destroy=function(){this.primitiveShader.destroy();this.complexPrimitiveShader.destroy();WebGLManager.prototype.destroy.call(this);this.destroyPlugins();this.attribState=null;this.tempAttribState=null}},{"../../../utils":77,"../shaders/ComplexPrimitiveShader":59,"../shaders/PrimitiveShader":60,"../shaders/TextureShader":62,"./WebGLManager":58}],57:[function(require,module,exports){var WebGLManager=require("./WebGLManager"),utils=require("../../../utils");function WebGLMaskManager(renderer){WebGLManager.call(this,renderer);this.stencilMaskStack=null}WebGLMaskManager.prototype=Object.create(WebGLManager.prototype);WebGLMaskManager.prototype.constructor=WebGLMaskManager;module.exports=WebGLMaskManager;WebGLMaskManager.prototype.setMaskStack=function(stencilMaskStack){this.stencilMaskStack=stencilMaskStack;var gl=this.renderer.gl;if(stencilMaskStack.stencilStack.length===0){gl.disable(gl.STENCIL_TEST)}else{gl.enable(gl.STENCIL_TEST)}};WebGLMaskManager.prototype.pushStencil=function(graphics,webGLData){this.renderer.currentRenderTarget.attachStencilBuffer();var gl=this.renderer.gl,sms=this.stencilMaskStack;this.bindGraphics(graphics,webGLData);if(sms.stencilStack.length===0){gl.enable(gl.STENCIL_TEST);gl.clear(gl.STENCIL_BUFFER_BIT);sms.reverse=true;sms.count=0}sms.stencilStack.push(webGLData);var level=sms.count;gl.colorMask(false,false,false,false);gl.stencilFunc(gl.ALWAYS,0,255);gl.stencilOp(gl.KEEP,gl.KEEP,gl.INVERT);if(webGLData.mode===1){gl.drawElements(gl.TRIANGLE_FAN,webGLData.indices.length-4,gl.UNSIGNED_SHORT,0);if(sms.reverse){gl.stencilFunc(gl.EQUAL,255-level,255);gl.stencilOp(gl.KEEP,gl.KEEP,gl.DECR)}else{gl.stencilFunc(gl.EQUAL,level,255);gl.stencilOp(gl.KEEP,gl.KEEP,gl.INCR)}gl.drawElements(gl.TRIANGLE_FAN,4,gl.UNSIGNED_SHORT,(webGLData.indices.length-4)*2);if(sms.reverse){gl.stencilFunc(gl.EQUAL,255-(level+1),255)}else{gl.stencilFunc(gl.EQUAL,level+1,255);
}sms.reverse=!sms.reverse}else{if(!sms.reverse){gl.stencilFunc(gl.EQUAL,255-level,255);gl.stencilOp(gl.KEEP,gl.KEEP,gl.DECR)}else{gl.stencilFunc(gl.EQUAL,level,255);gl.stencilOp(gl.KEEP,gl.KEEP,gl.INCR)}gl.drawElements(gl.TRIANGLE_STRIP,webGLData.indices.length,gl.UNSIGNED_SHORT,0);if(!sms.reverse){gl.stencilFunc(gl.EQUAL,255-(level+1),255)}else{gl.stencilFunc(gl.EQUAL,level+1,255)}}gl.colorMask(true,true,true,true);gl.stencilOp(gl.KEEP,gl.KEEP,gl.KEEP);sms.count++};WebGLMaskManager.prototype.bindGraphics=function(graphics,webGLData){var gl=this.renderer.gl;var shader;if(webGLData.mode===1){shader=this.renderer.shaderManager.complexPrimitiveShader;this.renderer.shaderManager.setShader(shader);gl.uniformMatrix3fv(shader.uniforms.translationMatrix._location,false,graphics.worldTransform.toArray(true));gl.uniformMatrix3fv(shader.uniforms.projectionMatrix._location,false,this.renderer.currentRenderTarget.projectionMatrix.toArray(true));gl.uniform3fv(shader.uniforms.tint._location,utils.hex2rgb(graphics.tint));gl.uniform3fv(shader.uniforms.color._location,webGLData.color);gl.uniform1f(shader.uniforms.alpha._location,graphics.worldAlpha);gl.bindBuffer(gl.ARRAY_BUFFER,webGLData.buffer);gl.vertexAttribPointer(shader.attributes.aVertexPosition,2,gl.FLOAT,false,4*2,0);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,webGLData.indexBuffer)}else{shader=this.renderer.shaderManager.primitiveShader;this.renderer.shaderManager.setShader(shader);gl.uniformMatrix3fv(shader.uniforms.translationMatrix._location,false,graphics.worldTransform.toArray(true));gl.uniformMatrix3fv(shader.uniforms.projectionMatrix._location,false,this.renderer.currentRenderTarget.projectionMatrix.toArray(true));gl.uniform3fv(shader.uniforms.tint._location,utils.hex2rgb(graphics.tint));gl.uniform1f(shader.uniforms.alpha._location,graphics.worldAlpha);gl.bindBuffer(gl.ARRAY_BUFFER,webGLData.buffer);gl.vertexAttribPointer(shader.attributes.aVertexPosition,2,gl.FLOAT,false,4*6,0);gl.vertexAttribPointer(shader.attributes.aColor,4,gl.FLOAT,false,4*6,2*4);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,webGLData.indexBuffer)}};WebGLMaskManager.prototype.popStencil=function(graphics,webGLData){var gl=this.renderer.gl,sms=this.stencilMaskStack;sms.stencilStack.pop();sms.count--;if(sms.stencilStack.length===0){gl.disable(gl.STENCIL_TEST)}else{var level=sms.count;this.bindGraphics(graphics,webGLData);gl.colorMask(false,false,false,false);if(webGLData.mode===1){sms.reverse=!sms.reverse;if(sms.reverse){gl.stencilFunc(gl.EQUAL,255-(level+1),255);gl.stencilOp(gl.KEEP,gl.KEEP,gl.INCR)}else{gl.stencilFunc(gl.EQUAL,level+1,255);gl.stencilOp(gl.KEEP,gl.KEEP,gl.DECR)}gl.drawElements(gl.TRIANGLE_FAN,4,gl.UNSIGNED_SHORT,(webGLData.indices.length-4)*2);gl.stencilFunc(gl.ALWAYS,0,255);gl.stencilOp(gl.KEEP,gl.KEEP,gl.INVERT);gl.drawElements(gl.TRIANGLE_FAN,webGLData.indices.length-4,gl.UNSIGNED_SHORT,0);this.renderer.drawCount+=2;if(!sms.reverse){gl.stencilFunc(gl.EQUAL,255-level,255)}else{gl.stencilFunc(gl.EQUAL,level,255)}}else{if(!sms.reverse){gl.stencilFunc(gl.EQUAL,255-(level+1),255);gl.stencilOp(gl.KEEP,gl.KEEP,gl.INCR)}else{gl.stencilFunc(gl.EQUAL,level+1,255);gl.stencilOp(gl.KEEP,gl.KEEP,gl.DECR)}gl.drawElements(gl.TRIANGLE_STRIP,webGLData.indices.length,gl.UNSIGNED_SHORT,0);this.renderer.drawCount++;if(!sms.reverse){gl.stencilFunc(gl.EQUAL,255-level,255)}else{gl.stencilFunc(gl.EQUAL,level,255)}}gl.colorMask(true,true,true,true);gl.stencilOp(gl.KEEP,gl.KEEP,gl.KEEP)}};WebGLMaskManager.prototype.destroy=function(){WebGLManager.prototype.destroy.call(this);this.stencilMaskStack.stencilStack=null};WebGLMaskManager.prototype.pushMask=function(maskData){this.renderer.setObjectRenderer(this.renderer.plugins.graphics);if(maskData.dirty){this.renderer.plugins.graphics.updateGraphics(maskData,this.renderer.gl)}if(!maskData._webGL[this.renderer.gl.id].data.length){return}this.pushStencil(maskData,maskData._webGL[this.renderer.gl.id].data[0])};WebGLMaskManager.prototype.popMask=function(maskData){this.renderer.setObjectRenderer(this.renderer.plugins.graphics);this.popStencil(maskData,maskData._webGL[this.renderer.gl.id].data[0])}},{"../../../utils":77,"./WebGLManager":58}],58:[function(require,module,exports){function WebGLManager(renderer){this.renderer=renderer;this.renderer.on("context",this.onContextChange,this)}WebGLManager.prototype.constructor=WebGLManager;module.exports=WebGLManager;WebGLManager.prototype.onContextChange=function(){};WebGLManager.prototype.destroy=function(){this.renderer.off("context",this.onContextChange,this);this.renderer=null}},{}],59:[function(require,module,exports){var Shader=require("./Shader");function ComplexPrimitiveShader(shaderManager){Shader.call(this,shaderManager,["attribute vec2 aVertexPosition;","uniform mat3 translationMatrix;","uniform mat3 projectionMatrix;","uniform vec3 tint;","uniform float alpha;","uniform vec3 color;","varying vec4 vColor;","void main(void){","   gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);","   vColor = vec4(color * alpha * tint, alpha);","}"].join("\n"),["precision mediump float;","varying vec4 vColor;","void main(void){","   gl_FragColor = vColor;","}"].join("\n"),{tint:{type:"3f",value:[0,0,0]},alpha:{type:"1f",value:0},color:{type:"3f",value:[0,0,0]},translationMatrix:{type:"mat3",value:new Float32Array(9)},projectionMatrix:{type:"mat3",value:new Float32Array(9)}},{aVertexPosition:0})}ComplexPrimitiveShader.prototype=Object.create(Shader.prototype);ComplexPrimitiveShader.prototype.constructor=ComplexPrimitiveShader;module.exports=ComplexPrimitiveShader},{"./Shader":61}],60:[function(require,module,exports){var Shader=require("./Shader");function PrimitiveShader(shaderManager){Shader.call(this,shaderManager,["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform mat3 projectionMatrix;","uniform float alpha;","uniform float flipY;","uniform vec3 tint;","varying vec4 vColor;","void main(void){","   gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"].join("\n"),["precision mediump float;","varying vec4 vColor;","void main(void){","   gl_FragColor = vColor;","}"].join("\n"),{tint:{type:"3f",value:[0,0,0]},alpha:{type:"1f",value:0},translationMatrix:{type:"mat3",value:new Float32Array(9)},projectionMatrix:{type:"mat3",value:new Float32Array(9)}},{aVertexPosition:0,aColor:0})}PrimitiveShader.prototype=Object.create(Shader.prototype);PrimitiveShader.prototype.constructor=PrimitiveShader;module.exports=PrimitiveShader},{"./Shader":61}],61:[function(require,module,exports){var utils=require("../../../utils");function Shader(shaderManager,vertexSrc,fragmentSrc,uniforms,attributes){if(!vertexSrc||!fragmentSrc){throw new Error("Pixi.js Error. Shader requires vertexSrc and fragmentSrc")}this.uid=utils.uid();this.gl=shaderManager.renderer.gl;this.shaderManager=shaderManager;this.program=null;this.uniforms=uniforms||{};this.attributes=attributes||{};this.textureCount=1;this.vertexSrc=vertexSrc;this.fragmentSrc=fragmentSrc;this.init()}Shader.prototype.constructor=Shader;module.exports=Shader;Shader.prototype.init=function(){this.compile();this.gl.useProgram(this.program);this.cacheUniformLocations(Object.keys(this.uniforms));this.cacheAttributeLocations(Object.keys(this.attributes))};Shader.prototype.cacheUniformLocations=function(keys){for(var i=0;i<keys.length;++i){this.uniforms[keys[i]]._location=this.gl.getUniformLocation(this.program,keys[i])}};Shader.prototype.cacheAttributeLocations=function(keys){for(var i=0;i<keys.length;++i){this.attributes[keys[i]]=this.gl.getAttribLocation(this.program,keys[i])}};Shader.prototype.compile=function(){var gl=this.gl;var glVertShader=this._glCompile(gl.VERTEX_SHADER,this.vertexSrc);var glFragShader=this._glCompile(gl.FRAGMENT_SHADER,this.fragmentSrc);var program=gl.createProgram();gl.attachShader(program,glVertShader);gl.attachShader(program,glFragShader);gl.linkProgram(program);if(!gl.getProgramParameter(program,gl.LINK_STATUS)){console.error("Pixi.js Error: Could not initialize shader.");console.error("gl.VALIDATE_STATUS",gl.getProgramParameter(program,gl.VALIDATE_STATUS));console.error("gl.getError()",gl.getError());if(gl.getProgramInfoLog(program)!==""){console.warn("Pixi.js Warning: gl.getProgramInfoLog()",gl.getProgramInfoLog(program))}gl.deleteProgram(program);program=null}gl.deleteShader(glVertShader);gl.deleteShader(glFragShader);return this.program=program};Shader.prototype.syncUniform=function(uniform){var location=uniform._location,value=uniform.value,gl=this.gl,i,il;switch(uniform.type){case"b":case"bool":case"boolean":gl.uniform1i(location,value?1:0);break;case"i":case"1i":gl.uniform1i(location,value);break;case"f":case"1f":gl.uniform1f(location,value);break;case"2f":gl.uniform2f(location,value[0],value[1]);break;case"3f":gl.uniform3f(location,value[0],value[1],value[2]);break;case"4f":gl.uniform4f(location,value[0],value[1],value[2],value[3]);break;case"v2":gl.uniform2f(location,value.x,value.y);break;case"v3":gl.uniform3f(location,value.x,value.y,value.z);break;case"v4":gl.uniform4f(location,value.x,value.y,value.z,value.w);break;case"1iv":gl.uniform1iv(location,value);break;case"2iv":gl.uniform2iv(location,value);break;case"3iv":gl.uniform3iv(location,value);break;case"4iv":gl.uniform4iv(location,value);break;case"1fv":gl.uniform1fv(location,value);break;case"2fv":gl.uniform2fv(location,value);break;case"3fv":gl.uniform3fv(location,value);break;case"4fv":gl.uniform4fv(location,value);break;case"m2":case"mat2":case"Matrix2fv":gl.uniformMatrix2fv(location,uniform.transpose,value);break;case"m3":case"mat3":case"Matrix3fv":gl.uniformMatrix3fv(location,uniform.transpose,value);break;case"m4":case"mat4":case"Matrix4fv":gl.uniformMatrix4fv(location,uniform.transpose,value);break;case"c":if(typeof value==="number"){value=utils.hex2rgb(value)}gl.uniform3f(location,value[0],value[1],value[2]);break;case"iv1":gl.uniform1iv(location,value);break;case"iv":gl.uniform3iv(location,value);break;case"fv1":gl.uniform1fv(location,value);break;case"fv":gl.uniform3fv(location,value);break;case"v2v":if(!uniform._array){uniform._array=new Float32Array(2*value.length)}for(i=0,il=value.length;i<il;++i){uniform._array[i*2]=value[i].x;uniform._array[i*2+1]=value[i].y}gl.uniform2fv(location,uniform._array);break;case"v3v":if(!uniform._array){uniform._array=new Float32Array(3*value.length)}for(i=0,il=value.length;i<il;++i){uniform._array[i*3]=value[i].x;uniform._array[i*3+1]=value[i].y;uniform._array[i*3+2]=value[i].z}gl.uniform3fv(location,uniform._array);break;case"v4v":if(!uniform._array){uniform._array=new Float32Array(4*value.length)}for(i=0,il=value.length;i<il;++i){uniform._array[i*4]=value[i].x;uniform._array[i*4+1]=value[i].y;uniform._array[i*4+2]=value[i].z;uniform._array[i*4+3]=value[i].w}gl.uniform4fv(location,uniform._array);break;case"t":case"sampler2D":if(!uniform.value||!uniform.value.baseTexture.hasLoaded){break}gl.activeTexture(gl["TEXTURE"+this.textureCount]);var texture=uniform.value.baseTexture._glTextures[gl.id];if(!texture){this.initSampler2D(uniform);texture=uniform.value.baseTexture._glTextures[gl.id]}gl.bindTexture(gl.TEXTURE_2D,texture);gl.uniform1i(uniform._location,this.textureCount);this.textureCount++;break;default:console.warn("Pixi.js Shader Warning: Unknown uniform type: "+uniform.type)}};Shader.prototype.syncUniforms=function(){this.textureCount=1;for(var key in this.uniforms){this.syncUniform(this.uniforms[key])}};Shader.prototype.initSampler2D=function(uniform){var gl=this.gl;var texture=uniform.value.baseTexture;if(!texture.hasLoaded){return}if(uniform.textureData){var data=uniform.textureData;texture._glTextures[gl.id]=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,texture._glTextures[gl.id]);gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,texture.premultipliedAlpha);gl.texImage2D(gl.TEXTURE_2D,0,data.luminance?gl.LUMINANCE:gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,texture.source);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,data.magFilter?data.magFilter:gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,data.wrapS?data.wrapS:gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,data.wrapS?data.wrapS:gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,data.wrapT?data.wrapT:gl.CLAMP_TO_EDGE)}else{this.shaderManager.renderer.updateTexture(texture)}};Shader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.gl=null;this.uniforms=null;this.attributes=null;this.vertexSrc=null;this.fragmentSrc=null};Shader.prototype._glCompile=function(type,src){var shader=this.gl.createShader(type);this.gl.shaderSource(shader,src);this.gl.compileShader(shader);if(!this.gl.getShaderParameter(shader,this.gl.COMPILE_STATUS)){console.log(this.gl.getShaderInfoLog(shader));return null}return shader}},{"../../../utils":77}],62:[function(require,module,exports){var Shader=require("./Shader");function TextureShader(shaderManager,vertexSrc,fragmentSrc,customUniforms,customAttributes){var uniforms={uSampler:{type:"sampler2D",value:0},projectionMatrix:{type:"mat3",value:new Float32Array([1,0,0,0,1,0,0,0,1])}};if(customUniforms){for(var u in customUniforms){uniforms[u]=customUniforms[u]}}var attributes={aVertexPosition:0,aTextureCoord:0,aColor:0};if(customAttributes){for(var a in customAttributes){attributes[a]=customAttributes[a]}}vertexSrc=vertexSrc||TextureShader.defaultVertexSrc;fragmentSrc=fragmentSrc||TextureShader.defaultFragmentSrc;Shader.call(this,shaderManager,vertexSrc,fragmentSrc,uniforms,attributes)}TextureShader.prototype=Object.create(Shader.prototype);TextureShader.prototype.constructor=TextureShader;module.exports=TextureShader;TextureShader.defaultVertexSrc=["precision lowp float;","attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","uniform mat3 projectionMatrix;","varying vec2 vTextureCoord;","varying vec4 vColor;","void main(void){","   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","}"].join("\n");TextureShader.defaultFragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void){","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"].join("\n")},{"./Shader":61}],63:[function(require,module,exports){var WebGLManager=require("../managers/WebGLManager");function ObjectRenderer(renderer){WebGLManager.call(this,renderer)}ObjectRenderer.prototype=Object.create(WebGLManager.prototype);ObjectRenderer.prototype.constructor=ObjectRenderer;module.exports=ObjectRenderer;ObjectRenderer.prototype.start=function(){};ObjectRenderer.prototype.stop=function(){this.flush()};ObjectRenderer.prototype.flush=function(){};ObjectRenderer.prototype.render=function(object){}},{"../managers/WebGLManager":58}],64:[function(require,module,exports){function Quad(gl){this.gl=gl;this.vertices=new Float32Array([0,0,200,0,200,200,0,200]);this.uvs=new Float32Array([0,0,1,0,1,1,0,1]);this.colors=new Float32Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]);this.indices=new Uint16Array([0,1,2,0,3,2]);this.vertexBuffer=gl.createBuffer();this.indexBuffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,this.vertexBuffer);gl.bufferData(gl.ARRAY_BUFFER,(8+8+16)*4,gl.DYNAMIC_DRAW);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer);gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,this.indices,gl.STATIC_DRAW);this.upload()}Quad.prototype.constructor=Quad;Quad.prototype.map=function(rect,rect2){var x=0;var y=0;this.uvs[0]=x;this.uvs[1]=y;this.uvs[2]=x+rect2.width/rect.width;this.uvs[3]=y;this.uvs[4]=x+rect2.width/rect.width;this.uvs[5]=y+rect2.height/rect.height;this.uvs[6]=x;this.uvs[7]=y+rect2.height/rect.height;x=rect2.x;y=rect2.y;this.vertices[0]=x;this.vertices[1]=y;this.vertices[2]=x+rect2.width;this.vertices[3]=y;this.vertices[4]=x+rect2.width;this.vertices[5]=y+rect2.height;this.vertices[6]=x;this.vertices[7]=y+rect2.height;this.upload()};Quad.prototype.upload=function(){var gl=this.gl;gl.bindBuffer(gl.ARRAY_BUFFER,this.vertexBuffer);gl.bufferSubData(gl.ARRAY_BUFFER,0,this.vertices);gl.bufferSubData(gl.ARRAY_BUFFER,8*4,this.uvs);gl.bufferSubData(gl.ARRAY_BUFFER,(8+8)*4,this.colors)};Quad.prototype.destroy=function(){var gl=this.gl;gl.deleteBuffer(this.vertexBuffer);gl.deleteBuffer(this.indexBuffer)};module.exports=Quad},{}],65:[function(require,module,exports){var math=require("../../../math"),utils=require("../../../utils"),CONST=require("../../../const"),StencilMaskStack=require("./StencilMaskStack");var RenderTarget=function(gl,width,height,scaleMode,resolution,root){this.gl=gl;this.frameBuffer=null;this.texture=null;this.size=new math.Rectangle(0,0,1,1);this.resolution=resolution||CONST.RESOLUTION;this.projectionMatrix=new math.Matrix;this.transform=null;this.frame=null;this.stencilBuffer=null;this.stencilMaskStack=new StencilMaskStack;this.filterStack=[{renderTarget:this,filter:[],bounds:this.size}];this.scaleMode=scaleMode||CONST.SCALE_MODES.DEFAULT;this.root=root;if(!this.root){this.frameBuffer=gl.createFramebuffer();this.texture=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,this.texture);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,scaleMode===CONST.SCALE_MODES.LINEAR?gl.LINEAR:gl.NEAREST);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,scaleMode===CONST.SCALE_MODES.LINEAR?gl.LINEAR:gl.NEAREST);var isPowerOfTwo=utils.isPowerOfTwo(width,height);if(!isPowerOfTwo){gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE)}else{gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.REPEAT);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.REPEAT)}gl.bindFramebuffer(gl.FRAMEBUFFER,this.frameBuffer);gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,this.texture,0)}this.resize(width,height)};RenderTarget.prototype.constructor=RenderTarget;module.exports=RenderTarget;RenderTarget.prototype.clear=function(bind){var gl=this.gl;if(bind){gl.bindFramebuffer(gl.FRAMEBUFFER,this.frameBuffer)}gl.clearColor(0,0,0,0);gl.clear(gl.COLOR_BUFFER_BIT)};RenderTarget.prototype.attachStencilBuffer=function(){if(this.stencilBuffer){return}if(!this.root){var gl=this.gl;this.stencilBuffer=gl.createRenderbuffer();gl.bindRenderbuffer(gl.RENDERBUFFER,this.stencilBuffer);gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.DEPTH_STENCIL_ATTACHMENT,gl.RENDERBUFFER,this.stencilBuffer);gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_STENCIL,this.size.width*this.resolution,this.size.height*this.resolution)}};RenderTarget.prototype.activate=function(){var gl=this.gl;gl.bindFramebuffer(gl.FRAMEBUFFER,this.frameBuffer);var projectionFrame=this.frame||this.size;this.calculateProjection(projectionFrame);if(this.transform){this.projectionMatrix.append(this.transform)}gl.viewport(0,0,projectionFrame.width*this.resolution,projectionFrame.height*this.resolution)};RenderTarget.prototype.calculateProjection=function(projectionFrame){var pm=this.projectionMatrix;pm.identity();if(!this.root){pm.a=1/projectionFrame.width*2;pm.d=1/projectionFrame.height*2;pm.tx=-1-projectionFrame.x*pm.a;pm.ty=-1-projectionFrame.y*pm.d}else{pm.a=1/projectionFrame.width*2;pm.d=-1/projectionFrame.height*2;pm.tx=-1-projectionFrame.x*pm.a;pm.ty=1-projectionFrame.y*pm.d}};RenderTarget.prototype.resize=function(width,height){width=width|0;height=height|0;if(this.size.width===width&&this.size.height===height){return}this.size.width=width;this.size.height=height;if(!this.root){var gl=this.gl;gl.bindTexture(gl.TEXTURE_2D,this.texture);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,width*this.resolution,height*this.resolution,0,gl.RGBA,gl.UNSIGNED_BYTE,null);if(this.stencilBuffer){gl.bindRenderbuffer(gl.RENDERBUFFER,this.stencilBuffer);gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_STENCIL,width*this.resolution,height*this.resolution)}}var projectionFrame=this.frame||this.size;this.calculateProjection(projectionFrame)};RenderTarget.prototype.destroy=function(){var gl=this.gl;gl.deleteRenderbuffer(this.stencilBuffer);gl.deleteFramebuffer(this.frameBuffer);gl.deleteTexture(this.texture);this.frameBuffer=null;this.texture=null}},{"../../../const":22,"../../../math":33,"../../../utils":77,"./StencilMaskStack":66}],66:[function(require,module,exports){function StencilMaskStack(){this.stencilStack=[];this.reverse=true;this.count=0}StencilMaskStack.prototype.constructor=StencilMaskStack;module.exports=StencilMaskStack},{}],67:[function(require,module,exports){var math=require("../math"),Texture=require("../textures/Texture"),Container=require("../display/Container"),CanvasTinter=require("../renderers/canvas/utils/CanvasTinter"),utils=require("../utils"),CONST=require("../const"),tempPoint=new math.Point,GroupD8=math.GroupD8,canvasRenderWorldTransform=new math.Matrix;function Sprite(texture){Container.call(this);this.anchor=new math.Point;this._texture=null;this._width=0;this._height=0;this.tint=16777215;this.blendMode=CONST.BLEND_MODES.NORMAL;this.shader=null;this.cachedTint=16777215;this.texture=texture||Texture.EMPTY}Sprite.prototype=Object.create(Container.prototype);Sprite.prototype.constructor=Sprite;module.exports=Sprite;Object.defineProperties(Sprite.prototype,{width:{get:function(){return Math.abs(this.scale.x)*this.texture._frame.width},set:function(value){var sign=utils.sign(this.scale.x)||1;this.scale.x=sign*value/this.texture._frame.width;this._width=value}},height:{get:function(){return Math.abs(this.scale.y)*this.texture._frame.height},set:function(value){var sign=utils.sign(this.scale.y)||1;this.scale.y=sign*value/this.texture._frame.height;this._height=value}},texture:{get:function(){return this._texture},set:function(value){if(this._texture===value){return}this._texture=value;this.cachedTint=16777215;if(value){if(value.baseTexture.hasLoaded){this._onTextureUpdate()}else{value.once("update",this._onTextureUpdate,this)}}}}});Sprite.prototype._onTextureUpdate=function(){if(this._width){this.scale.x=utils.sign(this.scale.x)*this._width/this.texture.frame.width}if(this._height){this.scale.y=utils.sign(this.scale.y)*this._height/this.texture.frame.height}};Sprite.prototype._renderWebGL=function(renderer){renderer.setObjectRenderer(renderer.plugins.sprite);renderer.plugins.sprite.render(this)};Sprite.prototype.getBounds=function(matrix){if(!this._currentBounds){var width=this._texture._frame.width;var height=this._texture._frame.height;var w0=width*(1-this.anchor.x);var w1=width*-this.anchor.x;var h0=height*(1-this.anchor.y);var h1=height*-this.anchor.y;var worldTransform=matrix||this.worldTransform;var a=worldTransform.a;var b=worldTransform.b;var c=worldTransform.c;var d=worldTransform.d;var tx=worldTransform.tx;var ty=worldTransform.ty;var minX,maxX,minY,maxY;var x1=a*w1+c*h1+tx;var y1=d*h1+b*w1+ty;var x2=a*w0+c*h1+tx;var y2=d*h1+b*w0+ty;var x3=a*w0+c*h0+tx;var y3=d*h0+b*w0+ty;var x4=a*w1+c*h0+tx;var y4=d*h0+b*w1+ty;minX=x1;minX=x2<minX?x2:minX;minX=x3<minX?x3:minX;minX=x4<minX?x4:minX;minY=y1;minY=y2<minY?y2:minY;minY=y3<minY?y3:minY;minY=y4<minY?y4:minY;maxX=x1;maxX=x2>maxX?x2:maxX;maxX=x3>maxX?x3:maxX;maxX=x4>maxX?x4:maxX;maxY=y1;maxY=y2>maxY?y2:maxY;maxY=y3>maxY?y3:maxY;maxY=y4>maxY?y4:maxY;if(this.children.length){var childBounds=this.containerGetBounds();w0=childBounds.x;w1=childBounds.x+childBounds.width;h0=childBounds.y;h1=childBounds.y+childBounds.height;minX=minX<w0?minX:w0;minY=minY<h0?minY:h0;maxX=maxX>w1?maxX:w1;maxY=maxY>h1?maxY:h1}var bounds=this._bounds;bounds.x=minX;bounds.width=maxX-minX;bounds.y=minY;bounds.height=maxY-minY;this._currentBounds=bounds}return this._currentBounds};Sprite.prototype.getLocalBounds=function(){this._bounds.x=-this._texture._frame.width*this.anchor.x;this._bounds.y=-this._texture._frame.height*this.anchor.y;this._bounds.width=this._texture._frame.width;this._bounds.height=this._texture._frame.height;return this._bounds};Sprite.prototype.containsPoint=function(point){this.worldTransform.applyInverse(point,tempPoint);var width=this._texture._frame.width;var height=this._texture._frame.height;var x1=-width*this.anchor.x;var y1;if(tempPoint.x>x1&&tempPoint.x<x1+width){y1=-height*this.anchor.y;if(tempPoint.y>y1&&tempPoint.y<y1+height){return true}}return false};Sprite.prototype._renderCanvas=function(renderer){if(this.texture.crop.width<=0||this.texture.crop.height<=0){return}var compositeOperation=renderer.blendModes[this.blendMode];if(compositeOperation!==renderer.context.globalCompositeOperation){renderer.context.globalCompositeOperation=compositeOperation}if(this.texture.valid){var texture=this._texture,wt=this.worldTransform,dx,dy,width=texture.crop.width,height=texture.crop.height;renderer.context.globalAlpha=this.worldAlpha;var smoothingEnabled=texture.baseTexture.scaleMode===CONST.SCALE_MODES.LINEAR;if(renderer.smoothProperty&&renderer.context[renderer.smoothProperty]!==smoothingEnabled){renderer.context[renderer.smoothProperty]=smoothingEnabled}if((texture.rotate&3)===2){width=texture.crop.height;height=texture.crop.width}if(texture.trim){dx=texture.crop.width/2+texture.trim.x-this.anchor.x*texture.trim.width;dy=texture.crop.height/2+texture.trim.y-this.anchor.y*texture.trim.height}else{dx=(.5-this.anchor.x)*texture._frame.width;dy=(.5-this.anchor.y)*texture._frame.height}if(texture.rotate){wt.copy(canvasRenderWorldTransform);wt=canvasRenderWorldTransform;GroupD8.matrixAppendRotationInv(wt,texture.rotate,dx,dy);dx=0;dy=0}dx-=width/2;dy-=height/2;if(renderer.roundPixels){renderer.context.setTransform(wt.a,wt.b,wt.c,wt.d,wt.tx*renderer.resolution|0,wt.ty*renderer.resolution|0);dx=dx|0;dy=dy|0}else{renderer.context.setTransform(wt.a,wt.b,wt.c,wt.d,wt.tx*renderer.resolution,wt.ty*renderer.resolution)}var resolution=texture.baseTexture.resolution;if(this.tint!==16777215){if(this.cachedTint!==this.tint){this.cachedTint=this.tint;this.tintedTexture=CanvasTinter.getTintedTexture(this,this.tint)}renderer.context.drawImage(this.tintedTexture,0,0,width*resolution,height*resolution,dx*renderer.resolution,dy*renderer.resolution,width*renderer.resolution,height*renderer.resolution)}else{renderer.context.drawImage(texture.baseTexture.source,texture.crop.x*resolution,texture.crop.y*resolution,width*resolution,height*resolution,dx*renderer.resolution,dy*renderer.resolution,width*renderer.resolution,height*renderer.resolution)}}};Sprite.prototype.destroy=function(destroyTexture,destroyBaseTexture){Container.prototype.destroy.call(this);this.anchor=null;if(destroyTexture){this._texture.destroy(destroyBaseTexture)}this._texture=null;this.shader=null};Sprite.fromFrame=function(frameId){var texture=utils.TextureCache[frameId];if(!texture){throw new Error('The frameId "'+frameId+'" does not exist in the texture cache')}return new Sprite(texture)};Sprite.fromImage=function(imageId,crossorigin,scaleMode){return new Sprite(Texture.fromImage(imageId,crossorigin,scaleMode))}},{"../const":22,"../display/Container":23,"../math":33,"../renderers/canvas/utils/CanvasTinter":48,"../textures/Texture":72,"../utils":77}],68:[function(require,module,exports){var ObjectRenderer=require("../../renderers/webgl/utils/ObjectRenderer"),WebGLRenderer=require("../../renderers/webgl/WebGLRenderer"),CONST=require("../../const");function SpriteRenderer(renderer){ObjectRenderer.call(this,renderer);this.vertSize=5;this.vertByteSize=this.vertSize*4;this.size=CONST.SPRITE_BATCH_SIZE;var numVerts=this.size*4*this.vertByteSize;var numIndices=this.size*6;this.vertices=new ArrayBuffer(numVerts);this.positions=new Float32Array(this.vertices);this.colors=new Uint32Array(this.vertices);this.indices=new Uint16Array(numIndices);for(var i=0,j=0;i<numIndices;i+=6,j+=4){this.indices[i+0]=j+0;this.indices[i+1]=j+1;this.indices[i+2]=j+2;this.indices[i+3]=j+0;this.indices[i+4]=j+2;this.indices[i+5]=j+3}this.currentBatchSize=0;this.sprites=[];this.shader=null}SpriteRenderer.prototype=Object.create(ObjectRenderer.prototype);SpriteRenderer.prototype.constructor=SpriteRenderer;module.exports=SpriteRenderer;WebGLRenderer.registerPlugin("sprite",SpriteRenderer);SpriteRenderer.prototype.onContextChange=function(){var gl=this.renderer.gl;this.shader=this.renderer.shaderManager.defaultShader;this.vertexBuffer=gl.createBuffer();this.indexBuffer=gl.createBuffer();gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer);gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,this.indices,gl.STATIC_DRAW);gl.bindBuffer(gl.ARRAY_BUFFER,this.vertexBuffer);gl.bufferData(gl.ARRAY_BUFFER,this.vertices,gl.DYNAMIC_DRAW);this.currentBlendMode=99999};SpriteRenderer.prototype.render=function(sprite){var texture=sprite._texture;if(this.currentBatchSize>=this.size){this.flush()}var uvs=texture._uvs;if(!uvs){return}var aX=sprite.anchor.x;var aY=sprite.anchor.y;var w0,w1,h0,h1;if(texture.trim&&sprite.tileScale===undefined){var trim=texture.trim;w1=trim.x-aX*trim.width;w0=w1+texture.crop.width;h1=trim.y-aY*trim.height;h0=h1+texture.crop.height}else{w0=texture._frame.width*(1-aX);w1=texture._frame.width*-aX;h0=texture._frame.height*(1-aY);h1=texture._frame.height*-aY}var index=this.currentBatchSize*this.vertByteSize;var worldTransform=sprite.worldTransform;var a=worldTransform.a;var b=worldTransform.b;var c=worldTransform.c;var d=worldTransform.d;var tx=worldTransform.tx;var ty=worldTransform.ty;var colors=this.colors;var positions=this.positions;if(this.renderer.roundPixels){var resolution=this.renderer.resolution;positions[index]=((a*w1+c*h1+tx)*resolution|0)/resolution;positions[index+1]=((d*h1+b*w1+ty)*resolution|0)/resolution;positions[index+5]=((a*w0+c*h1+tx)*resolution|0)/resolution;positions[index+6]=((d*h1+b*w0+ty)*resolution|0)/resolution;positions[index+10]=((a*w0+c*h0+tx)*resolution|0)/resolution;positions[index+11]=((d*h0+b*w0+ty)*resolution|0)/resolution;positions[index+15]=((a*w1+c*h0+tx)*resolution|0)/resolution;positions[index+16]=((d*h0+b*w1+ty)*resolution|0)/resolution}else{positions[index]=a*w1+c*h1+tx;positions[index+1]=d*h1+b*w1+ty;positions[index+5]=a*w0+c*h1+tx;positions[index+6]=d*h1+b*w0+ty;positions[index+10]=a*w0+c*h0+tx;positions[index+11]=d*h0+b*w0+ty;positions[index+15]=a*w1+c*h0+tx;positions[index+16]=d*h0+b*w1+ty}positions[index+2]=uvs.x0;positions[index+3]=uvs.y0;positions[index+7]=uvs.x1;positions[index+8]=uvs.y1;positions[index+12]=uvs.x2;positions[index+13]=uvs.y2;positions[index+17]=uvs.x3;positions[index+18]=uvs.y3;var tint=sprite.tint;colors[index+4]=colors[index+9]=colors[index+14]=colors[index+19]=(tint>>16)+(tint&65280)+((tint&255)<<16)+(sprite.worldAlpha*255<<24);this.sprites[this.currentBatchSize++]=sprite};SpriteRenderer.prototype.flush=function(){if(this.currentBatchSize===0){return}var gl=this.renderer.gl;var shader;if(this.currentBatchSize>this.size*.5){gl.bufferSubData(gl.ARRAY_BUFFER,0,this.vertices)}else{var view=this.positions.subarray(0,this.currentBatchSize*this.vertByteSize);gl.bufferSubData(gl.ARRAY_BUFFER,0,view)}var nextTexture,nextBlendMode,nextShader;var batchSize=0;var start=0;var currentBaseTexture=null;var currentBlendMode=this.renderer.blendModeManager.currentBlendMode;var currentShader=null;var blendSwap=false;var shaderSwap=false;var sprite;for(var i=0,j=this.currentBatchSize;i<j;i++){sprite=this.sprites[i];nextTexture=sprite._texture.baseTexture;nextBlendMode=sprite.blendMode;nextShader=sprite.shader||this.shader;blendSwap=currentBlendMode!==nextBlendMode;shaderSwap=currentShader!==nextShader;if(currentBaseTexture!==nextTexture||blendSwap||shaderSwap){this.renderBatch(currentBaseTexture,batchSize,start);start=i;batchSize=0;currentBaseTexture=nextTexture;if(blendSwap){currentBlendMode=nextBlendMode;this.renderer.blendModeManager.setBlendMode(currentBlendMode)}if(shaderSwap){currentShader=nextShader;shader=currentShader.shaders?currentShader.shaders[gl.id]:currentShader;if(!shader){shader=currentShader.getShader(this.renderer)}this.renderer.shaderManager.setShader(shader);
shader.uniforms.projectionMatrix.value=this.renderer.currentRenderTarget.projectionMatrix.toArray(true);shader.syncUniforms();gl.activeTexture(gl.TEXTURE0)}}batchSize++}this.renderBatch(currentBaseTexture,batchSize,start);this.currentBatchSize=0};SpriteRenderer.prototype.renderBatch=function(texture,size,startIndex){if(size===0){return}var gl=this.renderer.gl;if(!texture._glTextures[gl.id]){this.renderer.updateTexture(texture)}else{gl.bindTexture(gl.TEXTURE_2D,texture._glTextures[gl.id])}gl.drawElements(gl.TRIANGLES,size*6,gl.UNSIGNED_SHORT,startIndex*6*2);this.renderer.drawCount++};SpriteRenderer.prototype.start=function(){var gl=this.renderer.gl;gl.bindBuffer(gl.ARRAY_BUFFER,this.vertexBuffer);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var stride=this.vertByteSize;gl.vertexAttribPointer(this.shader.attributes.aVertexPosition,2,gl.FLOAT,false,stride,0);gl.vertexAttribPointer(this.shader.attributes.aTextureCoord,2,gl.FLOAT,false,stride,2*4);gl.vertexAttribPointer(this.shader.attributes.aColor,4,gl.UNSIGNED_BYTE,true,stride,4*4)};SpriteRenderer.prototype.destroy=function(){this.renderer.gl.deleteBuffer(this.vertexBuffer);this.renderer.gl.deleteBuffer(this.indexBuffer);ObjectRenderer.prototype.destroy.call(this);this.shader.destroy();this.renderer=null;this.vertices=null;this.positions=null;this.colors=null;this.indices=null;this.vertexBuffer=null;this.indexBuffer=null;this.sprites=null;this.shader=null}},{"../../const":22,"../../renderers/webgl/WebGLRenderer":49,"../../renderers/webgl/utils/ObjectRenderer":63}],69:[function(require,module,exports){var Sprite=require("../sprites/Sprite"),Texture=require("../textures/Texture"),math=require("../math"),utils=require("../utils"),CONST=require("../const");function Text(text,style,resolution){this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d");this.resolution=resolution||CONST.RESOLUTION;this._text=null;this._style=null;var texture=Texture.fromCanvas(this.canvas);texture.trim=new math.Rectangle;Sprite.call(this,texture);this.text=text;this.style=style}Text.prototype=Object.create(Sprite.prototype);Text.prototype.constructor=Text;module.exports=Text;Text.fontPropertiesCache={};Text.fontPropertiesCanvas=document.createElement("canvas");Text.fontPropertiesContext=Text.fontPropertiesCanvas.getContext("2d");Object.defineProperties(Text.prototype,{width:{get:function(){if(this.dirty){this.updateText()}return this.scale.x*this._texture._frame.width},set:function(value){this.scale.x=value/this._texture._frame.width;this._width=value}},height:{get:function(){if(this.dirty){this.updateText()}return this.scale.y*this._texture._frame.height},set:function(value){this.scale.y=value/this._texture._frame.height;this._height=value}},style:{get:function(){return this._style},set:function(style){style=style||{};if(typeof style.fill==="number"){style.fill=utils.hex2string(style.fill)}if(typeof style.stroke==="number"){style.stroke=utils.hex2string(style.stroke)}if(typeof style.dropShadowColor==="number"){style.dropShadowColor=utils.hex2string(style.dropShadowColor)}style.font=style.font||"bold 20pt Arial";style.fill=style.fill||"black";style.align=style.align||"left";style.stroke=style.stroke||"black";style.strokeThickness=style.strokeThickness||0;style.wordWrap=style.wordWrap||false;style.wordWrapWidth=style.wordWrapWidth||100;style.breakWords=style.breakWords||false;style.letterSpacing=style.letterSpacing||0;style.dropShadow=style.dropShadow||false;style.dropShadowColor=style.dropShadowColor||"#000000";style.dropShadowAngle=style.dropShadowAngle!==undefined?style.dropShadowAngle:Math.PI/6;style.dropShadowDistance=style.dropShadowDistance!==undefined?style.dropShadowDistance:5;style.dropShadowBlur=style.dropShadowBlur!==undefined?style.dropShadowBlur:0;style.padding=style.padding||0;style.textBaseline=style.textBaseline||"alphabetic";style.lineJoin=style.lineJoin||"miter";style.miterLimit=style.miterLimit||10;this._style=style;this.dirty=true}},text:{get:function(){return this._text},set:function(text){text=text.toString()||" ";if(this._text===text){return}this._text=text;this.dirty=true}}});Text.prototype.updateText=function(){var style=this._style;this.context.font=style.font;var outputText=style.wordWrap?this.wordWrap(this._text):this._text;var lines=outputText.split(/(?:\r\n|\r|\n)/);var lineWidths=new Array(lines.length);var maxLineWidth=0;var fontProperties=this.determineFontProperties(style.font);for(var i=0;i<lines.length;i++){var lineWidth=this.context.measureText(lines[i]).width+(lines[i].length-1)*style.letterSpacing;lineWidths[i]=lineWidth;maxLineWidth=Math.max(maxLineWidth,lineWidth)}var width=maxLineWidth+style.strokeThickness;if(style.dropShadow){width+=style.dropShadowDistance}this.canvas.width=Math.ceil((width+this.context.lineWidth)*this.resolution);var lineHeight=this.style.lineHeight||fontProperties.fontSize+style.strokeThickness;var height=lineHeight*lines.length;if(style.dropShadow){height+=style.dropShadowDistance}this.canvas.height=Math.ceil((height+this._style.padding*2)*this.resolution);this.context.scale(this.resolution,this.resolution);if(navigator.isCocoonJS){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}this.context.font=style.font;this.context.strokeStyle=style.stroke;this.context.lineWidth=style.strokeThickness;this.context.textBaseline=style.textBaseline;this.context.lineJoin=style.lineJoin;this.context.miterLimit=style.miterLimit;var linePositionX;var linePositionY;if(style.dropShadow){if(style.dropShadowBlur>0){this.context.shadowColor=style.dropShadowColor;this.context.shadowBlur=style.dropShadowBlur}else{this.context.fillStyle=style.dropShadowColor}var xShadowOffset=Math.cos(style.dropShadowAngle)*style.dropShadowDistance;var yShadowOffset=Math.sin(style.dropShadowAngle)*style.dropShadowDistance;for(i=0;i<lines.length;i++){linePositionX=style.strokeThickness/2;linePositionY=style.strokeThickness/2+i*lineHeight+fontProperties.ascent;if(style.align==="right"){linePositionX+=maxLineWidth-lineWidths[i]}else if(style.align==="center"){linePositionX+=(maxLineWidth-lineWidths[i])/2}if(style.fill){this.drawLetterSpacing(lines[i],linePositionX+xShadowOffset,linePositionY+yShadowOffset+style.padding)}}}this.context.fillStyle=style.fill;for(i=0;i<lines.length;i++){linePositionX=style.strokeThickness/2;linePositionY=style.strokeThickness/2+i*lineHeight+fontProperties.ascent;if(style.align==="right"){linePositionX+=maxLineWidth-lineWidths[i]}else if(style.align==="center"){linePositionX+=(maxLineWidth-lineWidths[i])/2}if(style.stroke&&style.strokeThickness){this.drawLetterSpacing(lines[i],linePositionX,linePositionY+style.padding,true)}if(style.fill){this.drawLetterSpacing(lines[i],linePositionX,linePositionY+style.padding)}}this.updateTexture()};Text.prototype.drawLetterSpacing=function(text,x,y,isStroke){var style=this._style;var letterSpacing=style.letterSpacing;if(letterSpacing===0){if(isStroke){this.context.strokeText(text,x,y)}else{this.context.fillText(text,x,y)}return}var characters=String.prototype.split.call(text,""),index=0,current,currentPosition=x;while(index<text.length){current=characters[index++];if(isStroke){this.context.strokeText(current,currentPosition,y)}else{this.context.fillText(current,currentPosition,y)}currentPosition+=this.context.measureText(current).width+letterSpacing}};Text.prototype.updateTexture=function(){var texture=this._texture;var style=this._style;texture.baseTexture.hasLoaded=true;texture.baseTexture.resolution=this.resolution;texture.baseTexture.width=this.canvas.width/this.resolution;texture.baseTexture.height=this.canvas.height/this.resolution;texture.crop.width=texture._frame.width=this.canvas.width/this.resolution;texture.crop.height=texture._frame.height=this.canvas.height/this.resolution;texture.trim.x=0;texture.trim.y=-style.padding;texture.trim.width=texture._frame.width;texture.trim.height=texture._frame.height-style.padding*2;this._width=this.canvas.width/this.resolution;this._height=this.canvas.height/this.resolution;texture.baseTexture.emit("update",texture.baseTexture);this.dirty=false};Text.prototype.renderWebGL=function(renderer){if(this.dirty){this.updateText()}Sprite.prototype.renderWebGL.call(this,renderer)};Text.prototype._renderCanvas=function(renderer){if(this.dirty){this.updateText()}Sprite.prototype._renderCanvas.call(this,renderer)};Text.prototype.determineFontProperties=function(fontStyle){var properties=Text.fontPropertiesCache[fontStyle];if(!properties){properties={};var canvas=Text.fontPropertiesCanvas;var context=Text.fontPropertiesContext;context.font=fontStyle;var width=Math.ceil(context.measureText("|MÉq").width);var baseline=Math.ceil(context.measureText("M").width);var height=2*baseline;baseline=baseline*1.4|0;canvas.width=width;canvas.height=height;context.fillStyle="#f00";context.fillRect(0,0,width,height);context.font=fontStyle;context.textBaseline="alphabetic";context.fillStyle="#000";context.fillText("|MÉq",0,baseline);var imagedata=context.getImageData(0,0,width,height).data;var pixels=imagedata.length;var line=width*4;var i,j;var idx=0;var stop=false;for(i=0;i<baseline;i++){for(j=0;j<line;j+=4){if(imagedata[idx+j]!==255){stop=true;break}}if(!stop){idx+=line}else{break}}properties.ascent=baseline-i;idx=pixels-line;stop=false;for(i=height;i>baseline;i--){for(j=0;j<line;j+=4){if(imagedata[idx+j]!==255){stop=true;break}}if(!stop){idx-=line}else{break}}properties.descent=i-baseline;properties.fontSize=properties.ascent+properties.descent;Text.fontPropertiesCache[fontStyle]=properties}return properties};Text.prototype.wordWrap=function(text){var result="";var lines=text.split("\n");var wordWrapWidth=this._style.wordWrapWidth;for(var i=0;i<lines.length;i++){var spaceLeft=wordWrapWidth;var words=lines[i].split(" ");for(var j=0;j<words.length;j++){var wordWidth=this.context.measureText(words[j]).width;if(this._style.breakWords&&wordWidth>wordWrapWidth){var characters=words[j].split("");for(var c=0;c<characters.length;c++){var characterWidth=this.context.measureText(characters[c]).width;if(characterWidth>spaceLeft){result+="\n"+characters[c];spaceLeft=wordWrapWidth-characterWidth}else{if(c===0){result+=" "}result+=characters[c];spaceLeft-=characterWidth}}}else{var wordWidthWithSpace=wordWidth+this.context.measureText(" ").width;if(j===0||wordWidthWithSpace>spaceLeft){if(j>0){result+="\n"}result+=words[j];spaceLeft=wordWrapWidth-wordWidth}else{spaceLeft-=wordWidthWithSpace;result+=" "+words[j]}}}if(i<lines.length-1){result+="\n"}}return result};Text.prototype.getBounds=function(matrix){if(this.dirty){this.updateText()}return Sprite.prototype.getBounds.call(this,matrix)};Text.prototype.destroy=function(destroyBaseTexture){this.context=null;this.canvas=null;this._style=null;this._texture.destroy(destroyBaseTexture===undefined?true:destroyBaseTexture)}},{"../const":22,"../math":33,"../sprites/Sprite":67,"../textures/Texture":72,"../utils":77}],70:[function(require,module,exports){var utils=require("../utils"),CONST=require("../const"),EventEmitter=require("eventemitter3");function BaseTexture(source,scaleMode,resolution){EventEmitter.call(this);this.uid=utils.uid();this.resolution=resolution||1;this.width=100;this.height=100;this.realWidth=100;this.realHeight=100;this.scaleMode=scaleMode||CONST.SCALE_MODES.DEFAULT;this.hasLoaded=false;this.isLoading=false;this.source=null;this.premultipliedAlpha=true;this.imageUrl=null;this.isPowerOfTwo=false;this.mipmap=false;this._glTextures={};if(source){this.loadSource(source)}}BaseTexture.prototype=Object.create(EventEmitter.prototype);BaseTexture.prototype.constructor=BaseTexture;module.exports=BaseTexture;BaseTexture.prototype.update=function(){this.realWidth=this.source.naturalWidth||this.source.width;this.realHeight=this.source.naturalHeight||this.source.height;this.width=this.realWidth/this.resolution;this.height=this.realHeight/this.resolution;this.isPowerOfTwo=utils.isPowerOfTwo(this.realWidth,this.realHeight);this.emit("update",this)};BaseTexture.prototype.loadSource=function(source){var wasLoading=this.isLoading;this.hasLoaded=false;this.isLoading=false;if(wasLoading&&this.source){this.source.onload=null;this.source.onerror=null}this.source=source;if((this.source.complete||this.source.getContext)&&this.source.width&&this.source.height){this._sourceLoaded()}else if(!source.getContext){this.isLoading=true;var scope=this;source.onload=function(){source.onload=null;source.onerror=null;if(!scope.isLoading){return}scope.isLoading=false;scope._sourceLoaded();scope.emit("loaded",scope)};source.onerror=function(){source.onload=null;source.onerror=null;if(!scope.isLoading){return}scope.isLoading=false;scope.emit("error",scope)};if(source.complete&&source.src){this.isLoading=false;source.onload=null;source.onerror=null;if(source.width&&source.height){this._sourceLoaded();if(wasLoading){this.emit("loaded",this)}}else{if(wasLoading){this.emit("error",this)}}}}};BaseTexture.prototype._sourceLoaded=function(){this.hasLoaded=true;this.update()};BaseTexture.prototype.destroy=function(){if(this.imageUrl){delete utils.BaseTextureCache[this.imageUrl];delete utils.TextureCache[this.imageUrl];this.imageUrl=null;if(!navigator.isCocoonJS){this.source.src=""}}else if(this.source&&this.source._pixiId){delete utils.BaseTextureCache[this.source._pixiId]}this.source=null;this.dispose()};BaseTexture.prototype.dispose=function(){this.emit("dispose",this)};BaseTexture.prototype.updateSourceImage=function(newSrc){this.source.src=newSrc;this.loadSource(this.source)};BaseTexture.fromImage=function(imageUrl,crossorigin,scaleMode){var baseTexture=utils.BaseTextureCache[imageUrl];if(crossorigin===undefined&&imageUrl.indexOf("data:")!==0){crossorigin=true}if(!baseTexture){var image=new Image;if(crossorigin){image.crossOrigin=""}baseTexture=new BaseTexture(image,scaleMode);baseTexture.imageUrl=imageUrl;image.src=imageUrl;utils.BaseTextureCache[imageUrl]=baseTexture;baseTexture.resolution=utils.getResolutionOfUrl(imageUrl)}return baseTexture};BaseTexture.fromCanvas=function(canvas,scaleMode){if(!canvas._pixiId){canvas._pixiId="canvas_"+utils.uid()}var baseTexture=utils.BaseTextureCache[canvas._pixiId];if(!baseTexture){baseTexture=new BaseTexture(canvas,scaleMode);utils.BaseTextureCache[canvas._pixiId]=baseTexture}return baseTexture}},{"../const":22,"../utils":77,eventemitter3:10}],71:[function(require,module,exports){var BaseTexture=require("./BaseTexture"),Texture=require("./Texture"),RenderTarget=require("../renderers/webgl/utils/RenderTarget"),FilterManager=require("../renderers/webgl/managers/FilterManager"),CanvasBuffer=require("../renderers/canvas/utils/CanvasBuffer"),math=require("../math"),CONST=require("../const"),tempMatrix=new math.Matrix;function RenderTexture(renderer,width,height,scaleMode,resolution){if(!renderer){throw new Error("Unable to create RenderTexture, you must pass a renderer into the constructor.")}width=width||100;height=height||100;resolution=resolution||CONST.RESOLUTION;var baseTexture=new BaseTexture;baseTexture.width=width;baseTexture.height=height;baseTexture.resolution=resolution;baseTexture.scaleMode=scaleMode||CONST.SCALE_MODES.DEFAULT;baseTexture.hasLoaded=true;Texture.call(this,baseTexture,new math.Rectangle(0,0,width,height));this.width=width;this.height=height;this.resolution=resolution;this.render=null;this.renderer=renderer;if(this.renderer.type===CONST.RENDERER_TYPE.WEBGL){var gl=this.renderer.gl;this.textureBuffer=new RenderTarget(gl,this.width,this.height,baseTexture.scaleMode,this.resolution);this.baseTexture._glTextures[gl.id]=this.textureBuffer.texture;this.filterManager=new FilterManager(this.renderer);this.filterManager.onContextChange();this.filterManager.resize(width,height);this.render=this.renderWebGL;this.renderer.currentRenderer.start();this.renderer.currentRenderTarget.activate()}else{this.render=this.renderCanvas;this.textureBuffer=new CanvasBuffer(this.width*this.resolution,this.height*this.resolution);this.baseTexture.source=this.textureBuffer.canvas}this.valid=true;this._updateUvs()}RenderTexture.prototype=Object.create(Texture.prototype);RenderTexture.prototype.constructor=RenderTexture;module.exports=RenderTexture;RenderTexture.prototype.resize=function(width,height,updateBase){if(width===this.width&&height===this.height){return}this.valid=width>0&&height>0;this.width=this._frame.width=this.crop.width=width;this.height=this._frame.height=this.crop.height=height;if(updateBase){this.baseTexture.width=this.width;this.baseTexture.height=this.height}if(!this.valid){return}this.textureBuffer.resize(this.width,this.height);if(this.filterManager){this.filterManager.resize(this.width,this.height)}};RenderTexture.prototype.clear=function(){if(!this.valid){return}if(this.renderer.type===CONST.RENDERER_TYPE.WEBGL){this.renderer.gl.bindFramebuffer(this.renderer.gl.FRAMEBUFFER,this.textureBuffer.frameBuffer)}this.textureBuffer.clear()};RenderTexture.prototype.renderWebGL=function(displayObject,matrix,clear,updateTransform){if(!this.valid){return}updateTransform=updateTransform!==undefined?updateTransform:true;this.textureBuffer.transform=matrix;this.textureBuffer.activate();displayObject.worldAlpha=1;if(updateTransform){displayObject.worldTransform.identity();displayObject.currentBounds=null;var children=displayObject.children;var i,j;for(i=0,j=children.length;i<j;++i){children[i].updateTransform()}}var temp=this.renderer.filterManager;this.renderer.filterManager=this.filterManager;this.renderer.renderDisplayObject(displayObject,this.textureBuffer,clear);this.renderer.filterManager=temp};RenderTexture.prototype.renderCanvas=function(displayObject,matrix,clear,updateTransform){if(!this.valid){return}updateTransform=!!updateTransform;var wt=tempMatrix;wt.identity();if(matrix){wt.append(matrix)}var cachedWt=displayObject.worldTransform;displayObject.worldTransform=wt;displayObject.worldAlpha=1;var children=displayObject.children;var i,j;for(i=0,j=children.length;i<j;++i){children[i].updateTransform()}if(clear){this.textureBuffer.clear()}var context=this.textureBuffer.context;var realResolution=this.renderer.resolution;this.renderer.resolution=this.resolution;this.renderer.renderDisplayObject(displayObject,context);this.renderer.resolution=realResolution;if(displayObject.worldTransform===wt){displayObject.worldTransform=cachedWt}};RenderTexture.prototype.destroy=function(){Texture.prototype.destroy.call(this,true);this.textureBuffer.destroy();if(this.filterManager){this.filterManager.destroy()}this.renderer=null};RenderTexture.prototype.getImage=function(){var image=new Image;image.src=this.getBase64();return image};RenderTexture.prototype.getBase64=function(){return this.getCanvas().toDataURL()};RenderTexture.prototype.getCanvas=function(){if(this.renderer.type===CONST.RENDERER_TYPE.WEBGL){var gl=this.renderer.gl;var width=this.textureBuffer.size.width;var height=this.textureBuffer.size.height;var webGLPixels=new Uint8Array(4*width*height);gl.bindFramebuffer(gl.FRAMEBUFFER,this.textureBuffer.frameBuffer);gl.readPixels(0,0,width,height,gl.RGBA,gl.UNSIGNED_BYTE,webGLPixels);gl.bindFramebuffer(gl.FRAMEBUFFER,null);var tempCanvas=new CanvasBuffer(width,height);var canvasData=tempCanvas.context.getImageData(0,0,width,height);canvasData.data.set(webGLPixels);tempCanvas.context.putImageData(canvasData,0,0);return tempCanvas.canvas}else{return this.textureBuffer.canvas}};RenderTexture.prototype.getPixels=function(){var width,height;if(this.renderer.type===CONST.RENDERER_TYPE.WEBGL){var gl=this.renderer.gl;width=this.textureBuffer.size.width;height=this.textureBuffer.size.height;var webGLPixels=new Uint8Array(4*width*height);gl.bindFramebuffer(gl.FRAMEBUFFER,this.textureBuffer.frameBuffer);gl.readPixels(0,0,width,height,gl.RGBA,gl.UNSIGNED_BYTE,webGLPixels);gl.bindFramebuffer(gl.FRAMEBUFFER,null);return webGLPixels}else{width=this.textureBuffer.canvas.width;height=this.textureBuffer.canvas.height;return this.textureBuffer.canvas.getContext("2d").getImageData(0,0,width,height).data}};RenderTexture.prototype.getPixel=function(x,y){if(this.renderer.type===CONST.RENDERER_TYPE.WEBGL){var gl=this.renderer.gl;var webGLPixels=new Uint8Array(4);gl.bindFramebuffer(gl.FRAMEBUFFER,this.textureBuffer.frameBuffer);gl.readPixels(x,y,1,1,gl.RGBA,gl.UNSIGNED_BYTE,webGLPixels);gl.bindFramebuffer(gl.FRAMEBUFFER,null);return webGLPixels}else{return this.textureBuffer.canvas.getContext("2d").getImageData(x,y,1,1).data}}},{"../const":22,"../math":33,"../renderers/canvas/utils/CanvasBuffer":45,"../renderers/webgl/managers/FilterManager":54,"../renderers/webgl/utils/RenderTarget":65,"./BaseTexture":70,"./Texture":72}],72:[function(require,module,exports){var BaseTexture=require("./BaseTexture"),VideoBaseTexture=require("./VideoBaseTexture"),TextureUvs=require("./TextureUvs"),EventEmitter=require("eventemitter3"),math=require("../math"),utils=require("../utils");function Texture(baseTexture,frame,crop,trim,rotate){EventEmitter.call(this);this.noFrame=false;if(!frame){this.noFrame=true;frame=new math.Rectangle(0,0,1,1)}if(baseTexture instanceof Texture){baseTexture=baseTexture.baseTexture}this.baseTexture=baseTexture;this._frame=frame;this.trim=trim;this.valid=false;this.requiresUpdate=false;this._uvs=null;this.width=0;this.height=0;this.crop=crop||frame;this._rotate=+(rotate||0);if(rotate===true){this._rotate=2}else{if(this._rotate%2!==0){throw"attempt to use diamond-shaped UVs. If you are sure, set rotation manually"}}if(baseTexture.hasLoaded){if(this.noFrame){frame=new math.Rectangle(0,0,baseTexture.width,baseTexture.height);baseTexture.on("update",this.onBaseTextureUpdated,this)}this.frame=frame}else{baseTexture.once("loaded",this.onBaseTextureLoaded,this)}}Texture.prototype=Object.create(EventEmitter.prototype);Texture.prototype.constructor=Texture;module.exports=Texture;Object.defineProperties(Texture.prototype,{frame:{get:function(){return this._frame},set:function(frame){this._frame=frame;this.noFrame=false;this.width=frame.width;this.height=frame.height;if(!this.trim&&!this.rotate&&(frame.x+frame.width>this.baseTexture.width||frame.y+frame.height>this.baseTexture.height)){throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this)}this.valid=frame&&frame.width&&frame.height&&this.baseTexture.hasLoaded;if(this.trim){this.width=this.trim.width;this.height=this.trim.height;this._frame.width=this.trim.width;this._frame.height=this.trim.height}else{this.crop=frame}if(this.valid){this._updateUvs()}}},rotate:{get:function(){return this._rotate},set:function(rotate){this._rotate=rotate;if(this.valid){this._updateUvs()}}}});Texture.prototype.update=function(){this.baseTexture.update()};Texture.prototype.onBaseTextureLoaded=function(baseTexture){if(this.noFrame){this.frame=new math.Rectangle(0,0,baseTexture.width,baseTexture.height)}else{this.frame=this._frame}this.emit("update",this)};Texture.prototype.onBaseTextureUpdated=function(baseTexture){this._frame.width=baseTexture.width;this._frame.height=baseTexture.height;this.emit("update",this)};Texture.prototype.destroy=function(destroyBase){if(this.baseTexture){if(destroyBase){this.baseTexture.destroy()}this.baseTexture.off("update",this.onBaseTextureUpdated,this);this.baseTexture.off("loaded",this.onBaseTextureLoaded,this);this.baseTexture=null}this._frame=null;this._uvs=null;this.trim=null;this.crop=null;this.valid=false;this.off("dispose",this.dispose,this);this.off("update",this.update,this)};Texture.prototype.clone=function(){return new Texture(this.baseTexture,this.frame,this.crop,this.trim,this.rotate)};Texture.prototype._updateUvs=function(){if(!this._uvs){this._uvs=new TextureUvs}this._uvs.set(this.crop,this.baseTexture,this.rotate)};Texture.fromImage=function(imageUrl,crossorigin,scaleMode){var texture=utils.TextureCache[imageUrl];if(!texture){texture=new Texture(BaseTexture.fromImage(imageUrl,crossorigin,scaleMode));utils.TextureCache[imageUrl]=texture}return texture};Texture.fromFrame=function(frameId){var texture=utils.TextureCache[frameId];if(!texture){throw new Error('The frameId "'+frameId+'" does not exist in the texture cache')}return texture};Texture.fromCanvas=function(canvas,scaleMode){return new Texture(BaseTexture.fromCanvas(canvas,scaleMode))};Texture.fromVideo=function(video,scaleMode){if(typeof video==="string"){return Texture.fromVideoUrl(video,scaleMode)}else{return new Texture(VideoBaseTexture.fromVideo(video,scaleMode))}};Texture.fromVideoUrl=function(videoUrl,scaleMode){return new Texture(VideoBaseTexture.fromUrl(videoUrl,scaleMode))};Texture.addTextureToCache=function(texture,id){utils.TextureCache[id]=texture};Texture.removeTextureFromCache=function(id){var texture=utils.TextureCache[id];delete utils.TextureCache[id];delete utils.BaseTextureCache[id];return texture};Texture.EMPTY=new Texture(new BaseTexture)},{"../math":33,"../utils":77,"./BaseTexture":70,"./TextureUvs":73,"./VideoBaseTexture":74,eventemitter3:10}],73:[function(require,module,exports){function TextureUvs(){this.x0=0;this.y0=0;this.x1=1;this.y1=0;this.x2=1;this.y2=1;this.x3=0;this.y3=1}module.exports=TextureUvs;var GroupD8=require("../math/GroupD8");TextureUvs.prototype.set=function(frame,baseFrame,rotate){var tw=baseFrame.width;var th=baseFrame.height;if(rotate){var swapWidthHeight=GroupD8.isSwapWidthHeight(rotate);var w2=(swapWidthHeight?frame.height:frame.width)/2/tw;var h2=(swapWidthHeight?frame.width:frame.height)/2/th;var cX=frame.x/tw+w2;var cY=frame.y/th+h2;rotate=GroupD8.add(rotate,GroupD8.NW);this.x0=cX+w2*GroupD8.uX(rotate);this.y0=cY+h2*GroupD8.uY(rotate);rotate=GroupD8.add(rotate,2);this.x1=cX+w2*GroupD8.uX(rotate);this.y1=cY+h2*GroupD8.uY(rotate);rotate=GroupD8.add(rotate,2);this.x2=cX+w2*GroupD8.uX(rotate);this.y2=cY+h2*GroupD8.uY(rotate);rotate=GroupD8.add(rotate,2);this.x3=cX+w2*GroupD8.uX(rotate);this.y3=cY+h2*GroupD8.uY(rotate)}else{this.x0=frame.x/tw;this.y0=frame.y/th;this.x1=(frame.x+frame.width)/tw;this.y1=frame.y/th;this.x2=(frame.x+frame.width)/tw;this.y2=(frame.y+frame.height)/th;this.x3=frame.x/tw;this.y3=(frame.y+frame.height)/th}}},{"../math/GroupD8":30}],74:[function(require,module,exports){var BaseTexture=require("./BaseTexture"),utils=require("../utils");function VideoBaseTexture(source,scaleMode){if(!source){throw new Error("No video source element specified.")}if((source.readyState===source.HAVE_ENOUGH_DATA||source.readyState===source.HAVE_FUTURE_DATA)&&source.width&&source.height){source.complete=true}BaseTexture.call(this,source,scaleMode);this.autoUpdate=false;this._onUpdate=this._onUpdate.bind(this);this._onCanPlay=this._onCanPlay.bind(this);if(!source.complete){source.addEventListener("canplay",this._onCanPlay);source.addEventListener("canplaythrough",this._onCanPlay);source.addEventListener("play",this._onPlayStart.bind(this));source.addEventListener("pause",this._onPlayStop.bind(this))}this.__loaded=false}VideoBaseTexture.prototype=Object.create(BaseTexture.prototype);VideoBaseTexture.prototype.constructor=VideoBaseTexture;module.exports=VideoBaseTexture;VideoBaseTexture.prototype._onUpdate=function(){if(this.autoUpdate){window.requestAnimationFrame(this._onUpdate);this.update()}};VideoBaseTexture.prototype._onPlayStart=function(){if(!this.autoUpdate){window.requestAnimationFrame(this._onUpdate);this.autoUpdate=true}};VideoBaseTexture.prototype._onPlayStop=function(){this.autoUpdate=false};VideoBaseTexture.prototype._onCanPlay=function(){this.hasLoaded=true;if(this.source){this.source.removeEventListener("canplay",this._onCanPlay);this.source.removeEventListener("canplaythrough",this._onCanPlay);this.width=this.source.videoWidth;this.height=this.source.videoHeight;this.source.play();if(!this.__loaded){this.__loaded=true;this.emit("loaded",this)}}};VideoBaseTexture.prototype.destroy=function(){if(this.source&&this.source._pixiId){delete utils.BaseTextureCache[this.source._pixiId];delete this.source._pixiId}BaseTexture.prototype.destroy.call(this)};VideoBaseTexture.fromVideo=function(video,scaleMode){if(!video._pixiId){video._pixiId="video_"+utils.uid()}var baseTexture=utils.BaseTextureCache[video._pixiId];if(!baseTexture){baseTexture=new VideoBaseTexture(video,scaleMode);utils.BaseTextureCache[video._pixiId]=baseTexture}return baseTexture};VideoBaseTexture.fromUrl=function(videoSrc,scaleMode){var video=document.createElement("video");if(Array.isArray(videoSrc)){for(var i=0;i<videoSrc.length;++i){video.appendChild(createSource(videoSrc[i].src||videoSrc[i],videoSrc[i].mime))}}else{video.appendChild(createSource(videoSrc.src||videoSrc,videoSrc.mime))}video.load();video.play();return VideoBaseTexture.fromVideo(video,scaleMode)};VideoBaseTexture.fromUrls=VideoBaseTexture.fromUrl;function createSource(path,type){if(!type){type="video/"+path.substr(path.lastIndexOf(".")+1)}var source=document.createElement("source");source.src=path;source.type=type;return source}},{"../utils":77,"./BaseTexture":70}],75:[function(require,module,exports){var CONST=require("../const"),EventEmitter=require("eventemitter3"),TICK="tick";function Ticker(){var _this=this;this._tick=function _tick(time){_this._requestId=null;if(_this.started){_this.update(time);if(_this.started&&_this._requestId===null&&_this._emitter.listeners(TICK,true)){_this._requestId=requestAnimationFrame(_this._tick)}}};this._emitter=new EventEmitter;this._requestId=null;this._maxElapsedMS=100;this.autoStart=false;this.deltaTime=1;this.elapsedMS=1/CONST.TARGET_FPMS;this.lastTime=0;this.speed=1;this.started=false}Object.defineProperties(Ticker.prototype,{FPS:{get:function(){return 1e3/this.elapsedMS}},minFPS:{get:function(){return 1e3/this._maxElapsedMS},set:function(fps){var minFPMS=Math.min(Math.max(0,fps)/1e3,CONST.TARGET_FPMS);this._maxElapsedMS=1/minFPMS}}});Ticker.prototype._requestIfNeeded=function _requestIfNeeded(){if(this._requestId===null&&this._emitter.listeners(TICK,true)){this.lastTime=performance.now();this._requestId=requestAnimationFrame(this._tick)}};Ticker.prototype._cancelIfNeeded=function _cancelIfNeeded(){if(this._requestId!==null){cancelAnimationFrame(this._requestId);this._requestId=null}};Ticker.prototype._startIfPossible=function _startIfPossible(){if(this.started){this._requestIfNeeded()}else if(this.autoStart){this.start()}};Ticker.prototype.add=function add(fn,context){this._emitter.on(TICK,fn,context);this._startIfPossible();return this};Ticker.prototype.addOnce=function addOnce(fn,context){this._emitter.once(TICK,fn,context);this._startIfPossible();return this};Ticker.prototype.remove=function remove(fn,context){this._emitter.off(TICK,fn,context);if(!this._emitter.listeners(TICK,true)){this._cancelIfNeeded()}return this};Ticker.prototype.start=function start(){if(!this.started){this.started=true;this._requestIfNeeded()}};Ticker.prototype.stop=function stop(){if(this.started){this.started=false;this._cancelIfNeeded()}};Ticker.prototype.update=function update(currentTime){var elapsedMS;currentTime=currentTime||performance.now();elapsedMS=this.elapsedMS=currentTime-this.lastTime;if(elapsedMS>this._maxElapsedMS){elapsedMS=this._maxElapsedMS}this.deltaTime=elapsedMS*CONST.TARGET_FPMS*this.speed;this._emitter.emit(TICK,this.deltaTime);this.lastTime=currentTime};module.exports=Ticker},{"../const":22,eventemitter3:10}],76:[function(require,module,exports){var Ticker=require("./Ticker");var shared=new Ticker;shared.autoStart=true;module.exports={shared:shared,Ticker:Ticker}},{"./Ticker":75}],77:[function(require,module,exports){var CONST=require("../const");var utils=module.exports={_uid:0,_saidHello:false,EventEmitter:require("eventemitter3"),pluginTarget:require("./pluginTarget"),async:require("async"),uid:function(){return++utils._uid},hex2rgb:function(hex,out){out=out||[];out[0]=(hex>>16&255)/255;out[1]=(hex>>8&255)/255;out[2]=(hex&255)/255;return out},hex2string:function(hex){hex=hex.toString(16);hex="000000".substr(0,6-hex.length)+hex;return"#"+hex},rgb2hex:function(rgb){return(rgb[0]*255<<16)+(rgb[1]*255<<8)+rgb[2]*255},canUseNewCanvasBlendModes:function(){if(typeof document==="undefined"){return false;
}var pngHead="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAABAQMAAADD8p2OAAAAA1BMVEX/";var pngEnd="AAAACklEQVQI12NgAAAAAgAB4iG8MwAAAABJRU5ErkJggg==";var magenta=new Image;magenta.src=pngHead+"AP804Oa6"+pngEnd;var yellow=new Image;yellow.src=pngHead+"/wCKxvRF"+pngEnd;var canvas=document.createElement("canvas");canvas.width=6;canvas.height=1;var context=canvas.getContext("2d");context.globalCompositeOperation="multiply";context.drawImage(magenta,0,0);context.drawImage(yellow,2,0);var data=context.getImageData(2,0,1,1).data;return data[0]===255&&data[1]===0&&data[2]===0},getNextPowerOfTwo:function(number){if(number>0&&(number&number-1)===0){return number}else{var result=1;while(result<number){result<<=1}return result}},isPowerOfTwo:function(width,height){return width>0&&(width&width-1)===0&&height>0&&(height&height-1)===0},getResolutionOfUrl:function(url){var resolution=CONST.RETINA_PREFIX.exec(url);if(resolution){return parseFloat(resolution[1])}return 1},sayHello:function(type){if(utils._saidHello){return}if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var args=["\n %c %c %c Pixi.js "+CONST.VERSION+" - ✰ "+type+" ✰  %c "+" %c "+" http://www.pixijs.com/  %c %c ♥%c♥%c♥ \n\n","background: #ff66a5; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff66a5; background: #030307; padding:5px 0;","background: #ff66a5; padding:5px 0;","background: #ffc3dc; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;"];window.console.log.apply(console,args)}else if(window.console){window.console.log("Pixi.js "+CONST.VERSION+" - "+type+" - http://www.pixijs.com/")}utils._saidHello=true},isWebGLSupported:function(){var contextOptions={stencil:true};try{if(!window.WebGLRenderingContext){return false}var canvas=document.createElement("canvas"),gl=canvas.getContext("webgl",contextOptions)||canvas.getContext("experimental-webgl",contextOptions);return!!(gl&&gl.getContextAttributes().stencil)}catch(e){return false}},sign:function(n){return n?n<0?-1:1:0},removeItems:function(arr,startIdx,removeCount){var length=arr.length;if(startIdx>=length||removeCount===0){return}removeCount=startIdx+removeCount>length?length-startIdx:removeCount;for(var i=startIdx,len=length-removeCount;i<len;++i){arr[i]=arr[i+removeCount]}arr.length=len},TextureCache:{},BaseTextureCache:{}}},{"../const":22,"./pluginTarget":78,async:1,eventemitter3:10}],78:[function(require,module,exports){function pluginTarget(obj){obj.__plugins={};obj.registerPlugin=function(pluginName,ctor){obj.__plugins[pluginName]=ctor};obj.prototype.initPlugins=function(){this.plugins=this.plugins||{};for(var o in obj.__plugins){this.plugins[o]=new obj.__plugins[o](this)}};obj.prototype.destroyPlugins=function(){for(var o in this.plugins){this.plugins[o].destroy();this.plugins[o]=null}this.plugins=null}}module.exports={mixin:function mixin(obj){pluginTarget(obj)}}},{}],79:[function(require,module,exports){var core=require("./core"),mesh=require("./mesh"),extras=require("./extras"),filters=require("./filters");core.SpriteBatch=function(){throw new ReferenceError("SpriteBatch does not exist any more, please use the new ParticleContainer instead.")};core.AssetLoader=function(){throw new ReferenceError("The loader system was overhauled in pixi v3, please see the new PIXI.loaders.Loader class.")};Object.defineProperties(core,{Stage:{get:function(){console.warn("You do not need to use a PIXI Stage any more, you can simply render any container.");return core.Container}},DisplayObjectContainer:{get:function(){console.warn("DisplayObjectContainer has been shortened to Container, please use Container from now on.");return core.Container}},Strip:{get:function(){console.warn("The Strip class has been renamed to Mesh and moved to mesh.Mesh, please use mesh.Mesh from now on.");return mesh.Mesh}},Rope:{get:function(){console.warn("The Rope class has been moved to mesh.Rope, please use mesh.Rope from now on.");return mesh.Rope}},MovieClip:{get:function(){console.warn("The MovieClip class has been moved to extras.MovieClip, please use extras.MovieClip from now on.");return extras.MovieClip}},TilingSprite:{get:function(){console.warn("The TilingSprite class has been moved to extras.TilingSprite, please use extras.TilingSprite from now on.");return extras.TilingSprite}},BitmapText:{get:function(){console.warn("The BitmapText class has been moved to extras.BitmapText, please use extras.BitmapText from now on.");return extras.BitmapText}},blendModes:{get:function(){console.warn("The blendModes has been moved to BLEND_MODES, please use BLEND_MODES from now on.");return core.BLEND_MODES}},scaleModes:{get:function(){console.warn("The scaleModes has been moved to SCALE_MODES, please use SCALE_MODES from now on.");return core.SCALE_MODES}},BaseTextureCache:{get:function(){console.warn("The BaseTextureCache class has been moved to utils.BaseTextureCache, please use utils.BaseTextureCache from now on.");return core.utils.BaseTextureCache}},TextureCache:{get:function(){console.warn("The TextureCache class has been moved to utils.TextureCache, please use utils.TextureCache from now on.");return core.utils.TextureCache}},math:{get:function(){console.warn("The math namespace is deprecated, please access members already accessible on PIXI.");return core}}});core.Sprite.prototype.setTexture=function(texture){this.texture=texture;console.warn("setTexture is now deprecated, please use the texture property, e.g : sprite.texture = texture;")};extras.BitmapText.prototype.setText=function(text){this.text=text;console.warn("setText is now deprecated, please use the text property, e.g : myBitmapText.text = 'my text';")};core.Text.prototype.setText=function(text){this.text=text;console.warn("setText is now deprecated, please use the text property, e.g : myText.text = 'my text';")};core.Text.prototype.setStyle=function(style){this.style=style;console.warn("setStyle is now deprecated, please use the style property, e.g : myText.style = style;")};core.Texture.prototype.setFrame=function(frame){this.frame=frame;console.warn("setFrame is now deprecated, please use the frame property, e.g : myTexture.frame = frame;")};Object.defineProperties(filters,{AbstractFilter:{get:function(){console.warn("filters.AbstractFilter is an undocumented alias, please use AbstractFilter from now on.");return core.AbstractFilter}},FXAAFilter:{get:function(){console.warn("filters.FXAAFilter is an undocumented alias, please use FXAAFilter from now on.");return core.FXAAFilter}},SpriteMaskFilter:{get:function(){console.warn("filters.SpriteMaskFilter is an undocumented alias, please use SpriteMaskFilter from now on.");return core.SpriteMaskFilter}}});core.utils.uuid=function(){console.warn("utils.uuid() is deprecated, please use utils.uid() from now on.");return core.utils.uid()}},{"./core":29,"./extras":86,"./filters":103,"./mesh":128}],80:[function(require,module,exports){var core=require("../core");function BitmapText(text,style){core.Container.call(this);style=style||{};this.textWidth=0;this.textHeight=0;this._glyphs=[];this._font={tint:style.tint!==undefined?style.tint:16777215,align:style.align||"left",name:null,size:0};this.font=style.font;this._text=text;this.maxWidth=0;this.maxLineHeight=0;this.dirty=false;this.updateText()}BitmapText.prototype=Object.create(core.Container.prototype);BitmapText.prototype.constructor=BitmapText;module.exports=BitmapText;Object.defineProperties(BitmapText.prototype,{tint:{get:function(){return this._font.tint},set:function(value){this._font.tint=typeof value==="number"&&value>=0?value:16777215;this.dirty=true}},align:{get:function(){return this._font.align},set:function(value){this._font.align=value||"left";this.dirty=true}},font:{get:function(){return this._font},set:function(value){if(!value){return}if(typeof value==="string"){value=value.split(" ");this._font.name=value.length===1?value[0]:value.slice(1).join(" ");this._font.size=value.length>=2?parseInt(value[0],10):BitmapText.fonts[this._font.name].size}else{this._font.name=value.name;this._font.size=typeof value.size==="number"?value.size:parseInt(value.size,10)}this.dirty=true}},text:{get:function(){return this._text},set:function(value){value=value.toString()||" ";if(this._text===value){return}this._text=value;this.dirty=true}}});BitmapText.prototype.updateText=function(){var data=BitmapText.fonts[this._font.name];var pos=new core.Point;var prevCharCode=null;var chars=[];var lastLineWidth=0;var maxLineWidth=0;var lineWidths=[];var line=0;var scale=this._font.size/data.size;var lastSpace=-1;var maxLineHeight=0;for(var i=0;i<this.text.length;i++){var charCode=this.text.charCodeAt(i);lastSpace=/(\s)/.test(this.text.charAt(i))?i:lastSpace;if(/(?:\r\n|\r|\n)/.test(this.text.charAt(i))){lineWidths.push(lastLineWidth);maxLineWidth=Math.max(maxLineWidth,lastLineWidth);line++;pos.x=0;pos.y+=data.lineHeight;prevCharCode=null;continue}if(lastSpace!==-1&&this.maxWidth>0&&pos.x*scale>this.maxWidth){core.utils.removeItems(chars,lastSpace,i-lastSpace);i=lastSpace;lastSpace=-1;lineWidths.push(lastLineWidth);maxLineWidth=Math.max(maxLineWidth,lastLineWidth);line++;pos.x=0;pos.y+=data.lineHeight;prevCharCode=null;continue}var charData=data.chars[charCode];if(!charData){continue}if(prevCharCode&&charData.kerning[prevCharCode]){pos.x+=charData.kerning[prevCharCode]}chars.push({texture:charData.texture,line:line,charCode:charCode,position:new core.Point(pos.x+charData.xOffset,pos.y+charData.yOffset)});lastLineWidth=pos.x+(charData.texture.width+charData.xOffset);pos.x+=charData.xAdvance;maxLineHeight=Math.max(maxLineHeight,charData.yOffset+charData.texture.height);prevCharCode=charCode}lineWidths.push(lastLineWidth);maxLineWidth=Math.max(maxLineWidth,lastLineWidth);var lineAlignOffsets=[];for(i=0;i<=line;i++){var alignOffset=0;if(this._font.align==="right"){alignOffset=maxLineWidth-lineWidths[i]}else if(this._font.align==="center"){alignOffset=(maxLineWidth-lineWidths[i])/2}lineAlignOffsets.push(alignOffset)}var lenChars=chars.length;var tint=this.tint;for(i=0;i<lenChars;i++){var c=this._glyphs[i];if(c){c.texture=chars[i].texture}else{c=new core.Sprite(chars[i].texture);this._glyphs.push(c)}c.position.x=(chars[i].position.x+lineAlignOffsets[chars[i].line])*scale;c.position.y=chars[i].position.y*scale;c.scale.x=c.scale.y=scale;c.tint=tint;if(!c.parent){this.addChild(c)}}for(i=lenChars;i<this._glyphs.length;++i){this.removeChild(this._glyphs[i])}this.textWidth=maxLineWidth*scale;this.textHeight=(pos.y+data.lineHeight)*scale;this.maxLineHeight=maxLineHeight*scale};BitmapText.prototype.updateTransform=function(){this.validate();this.containerUpdateTransform()};BitmapText.prototype.getLocalBounds=function(){this.validate();return core.Container.prototype.getLocalBounds.call(this)};BitmapText.prototype.validate=function(){if(this.dirty){this.updateText();this.dirty=false}};BitmapText.fonts={}},{"../core":29}],81:[function(require,module,exports){var core=require("../core");function MovieClip(textures){core.Sprite.call(this,textures[0]instanceof core.Texture?textures[0]:textures[0].texture);this._textures=null;this._durations=null;this.textures=textures;this.animationSpeed=1;this.loop=true;this.onComplete=null;this._currentTime=0;this.playing=false}MovieClip.prototype=Object.create(core.Sprite.prototype);MovieClip.prototype.constructor=MovieClip;module.exports=MovieClip;Object.defineProperties(MovieClip.prototype,{totalFrames:{get:function(){return this._textures.length}},textures:{get:function(){return this._textures},set:function(value){if(value[0]instanceof core.Texture){this._textures=value;this._durations=null}else{this._textures=[];this._durations=[];for(var i=0;i<value.length;i++){this._textures.push(value[i].texture);this._durations.push(value[i].time)}}}},currentFrame:{get:function(){var currentFrame=Math.floor(this._currentTime)%this._textures.length;if(currentFrame<0){currentFrame+=this._textures.length}return currentFrame}}});MovieClip.prototype.stop=function(){if(!this.playing){return}this.playing=false;core.ticker.shared.remove(this.update,this)};MovieClip.prototype.play=function(){if(this.playing){return}this.playing=true;core.ticker.shared.add(this.update,this)};MovieClip.prototype.gotoAndStop=function(frameNumber){this.stop();this._currentTime=frameNumber;this._texture=this._textures[this.currentFrame]};MovieClip.prototype.gotoAndPlay=function(frameNumber){this._currentTime=frameNumber;this.play()};MovieClip.prototype.update=function(deltaTime){var elapsed=this.animationSpeed*deltaTime;if(this._durations!==null){var lag=this._currentTime%1*this._durations[this.currentFrame];lag+=elapsed/60*1e3;while(lag<0){this._currentTime--;lag+=this._durations[this.currentFrame]}var sign=Math.sign(this.animationSpeed*deltaTime);this._currentTime=Math.floor(this._currentTime);while(lag>=this._durations[this.currentFrame]){lag-=this._durations[this.currentFrame]*sign;this._currentTime+=sign}this._currentTime+=lag/this._durations[this.currentFrame]}else{this._currentTime+=elapsed}if(this._currentTime<0&&!this.loop){this.gotoAndStop(0);if(this.onComplete){this.onComplete()}}else if(this._currentTime>=this._textures.length&&!this.loop){this.gotoAndStop(this._textures.length-1);if(this.onComplete){this.onComplete()}}else{this._texture=this._textures[this.currentFrame]}};MovieClip.prototype.destroy=function(){this.stop();core.Sprite.prototype.destroy.call(this)};MovieClip.fromFrames=function(frames){var textures=[];for(var i=0;i<frames.length;++i){textures.push(new core.Texture.fromFrame(frames[i]))}return new MovieClip(textures)};MovieClip.fromImages=function(images){var textures=[];for(var i=0;i<images.length;++i){textures.push(new core.Texture.fromImage(images[i]))}return new MovieClip(textures)}},{"../core":29}],82:[function(require,module,exports){var core=require("../core"),tempPoint=new core.Point,CanvasTinter=require("../core/renderers/canvas/utils/CanvasTinter");function TilingSprite(texture,width,height){core.Sprite.call(this,texture);this.tileScale=new core.Point(1,1);this.tilePosition=new core.Point(0,0);this._width=width||100;this._height=height||100;this._uvs=new core.TextureUvs;this._canvasPattern=null;this.shader=new core.AbstractFilter(["precision lowp float;","attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","uniform mat3 projectionMatrix;","uniform vec4 uFrame;","uniform vec4 uTransform;","varying vec2 vTextureCoord;","varying vec4 vColor;","void main(void){","   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);","   vec2 coord = aTextureCoord;","   coord -= uTransform.xy;","   coord /= uTransform.zw;","   vTextureCoord = coord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","}"].join("\n"),["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform vec4 uFrame;","uniform vec2 uPixelSize;","void main(void){","   vec2 coord = mod(vTextureCoord, uFrame.zw);","   coord = clamp(coord, uPixelSize, uFrame.zw - uPixelSize);","   coord += uFrame.xy;","   gl_FragColor =  texture2D(uSampler, coord) * vColor ;","}"].join("\n"),{uFrame:{type:"4fv",value:[0,0,1,1]},uTransform:{type:"4fv",value:[0,0,1,1]},uPixelSize:{type:"2fv",value:[1,1]}})}TilingSprite.prototype=Object.create(core.Sprite.prototype);TilingSprite.prototype.constructor=TilingSprite;module.exports=TilingSprite;Object.defineProperties(TilingSprite.prototype,{width:{get:function(){return this._width},set:function(value){this._width=value}},height:{get:function(){return this._height},set:function(value){this._height=value}}});TilingSprite.prototype._onTextureUpdate=function(){return};TilingSprite.prototype._renderWebGL=function(renderer){var texture=this._texture;if(!texture||!texture._uvs){return}var tempUvs=texture._uvs,tempWidth=texture._frame.width,tempHeight=texture._frame.height,tw=texture.baseTexture.width,th=texture.baseTexture.height;texture._uvs=this._uvs;texture._frame.width=this.width;texture._frame.height=this.height;this.shader.uniforms.uPixelSize.value[0]=1/tw;this.shader.uniforms.uPixelSize.value[1]=1/th;this.shader.uniforms.uFrame.value[0]=tempUvs.x0;this.shader.uniforms.uFrame.value[1]=tempUvs.y0;this.shader.uniforms.uFrame.value[2]=tempUvs.x1-tempUvs.x0;this.shader.uniforms.uFrame.value[3]=tempUvs.y2-tempUvs.y0;this.shader.uniforms.uTransform.value[0]=this.tilePosition.x%(tempWidth*this.tileScale.x)/this._width;this.shader.uniforms.uTransform.value[1]=this.tilePosition.y%(tempHeight*this.tileScale.y)/this._height;this.shader.uniforms.uTransform.value[2]=tw/this._width*this.tileScale.x;this.shader.uniforms.uTransform.value[3]=th/this._height*this.tileScale.y;renderer.setObjectRenderer(renderer.plugins.sprite);renderer.plugins.sprite.render(this);texture._uvs=tempUvs;texture._frame.width=tempWidth;texture._frame.height=tempHeight};TilingSprite.prototype._renderCanvas=function(renderer){var texture=this._texture;if(!texture.baseTexture.hasLoaded){return}var context=renderer.context,transform=this.worldTransform,resolution=renderer.resolution,baseTexture=texture.baseTexture,modX=this.tilePosition.x/this.tileScale.x%texture._frame.width,modY=this.tilePosition.y/this.tileScale.y%texture._frame.height;if(!this._canvasPattern){var tempCanvas=new core.CanvasBuffer(texture._frame.width*resolution,texture._frame.height*resolution);if(this.tint!==16777215){if(this.cachedTint!==this.tint){this.cachedTint=this.tint;this.tintedTexture=CanvasTinter.getTintedTexture(this,this.tint)}tempCanvas.context.drawImage(this.tintedTexture,0,0)}else{tempCanvas.context.drawImage(baseTexture.source,-texture._frame.x*resolution,-texture._frame.y*resolution)}this._canvasPattern=tempCanvas.context.createPattern(tempCanvas.canvas,"repeat")}context.globalAlpha=this.worldAlpha;context.setTransform(transform.a*resolution,transform.b*resolution,transform.c*resolution,transform.d*resolution,transform.tx*resolution,transform.ty*resolution);context.scale(this.tileScale.x/resolution,this.tileScale.y/resolution);context.translate(modX+this.anchor.x*-this._width,modY+this.anchor.y*-this._height);var compositeOperation=renderer.blendModes[this.blendMode];if(compositeOperation!==renderer.context.globalCompositeOperation){context.globalCompositeOperation=compositeOperation}context.fillStyle=this._canvasPattern;context.fillRect(-modX,-modY,this._width*resolution/this.tileScale.x,this._height*resolution/this.tileScale.y)};TilingSprite.prototype.getBounds=function(){var width=this._width;var height=this._height;var w0=width*(1-this.anchor.x);var w1=width*-this.anchor.x;var h0=height*(1-this.anchor.y);var h1=height*-this.anchor.y;var worldTransform=this.worldTransform;var a=worldTransform.a;var b=worldTransform.b;var c=worldTransform.c;var d=worldTransform.d;var tx=worldTransform.tx;var ty=worldTransform.ty;var x1=a*w1+c*h1+tx;var y1=d*h1+b*w1+ty;var x2=a*w0+c*h1+tx;var y2=d*h1+b*w0+ty;var x3=a*w0+c*h0+tx;var y3=d*h0+b*w0+ty;var x4=a*w1+c*h0+tx;var y4=d*h0+b*w1+ty;var minX,maxX,minY,maxY;minX=x1;minX=x2<minX?x2:minX;minX=x3<minX?x3:minX;minX=x4<minX?x4:minX;minY=y1;minY=y2<minY?y2:minY;minY=y3<minY?y3:minY;minY=y4<minY?y4:minY;maxX=x1;maxX=x2>maxX?x2:maxX;maxX=x3>maxX?x3:maxX;maxX=x4>maxX?x4:maxX;maxY=y1;maxY=y2>maxY?y2:maxY;maxY=y3>maxY?y3:maxY;maxY=y4>maxY?y4:maxY;var bounds=this._bounds;bounds.x=minX;bounds.width=maxX-minX;bounds.y=minY;bounds.height=maxY-minY;this._currentBounds=bounds;return bounds};TilingSprite.prototype.containsPoint=function(point){this.worldTransform.applyInverse(point,tempPoint);var width=this._width;var height=this._height;var x1=-width*this.anchor.x;var y1;if(tempPoint.x>x1&&tempPoint.x<x1+width){y1=-height*this.anchor.y;if(tempPoint.y>y1&&tempPoint.y<y1+height){return true}}return false};TilingSprite.prototype.destroy=function(){core.Sprite.prototype.destroy.call(this);this.tileScale=null;this._tileScaleOffset=null;this.tilePosition=null;this._uvs=null};TilingSprite.fromFrame=function(frameId,width,height){var texture=core.utils.TextureCache[frameId];if(!texture){throw new Error('The frameId "'+frameId+'" does not exist in the texture cache '+this)}return new TilingSprite(texture,width,height)};TilingSprite.fromImage=function(imageId,width,height,crossorigin,scaleMode){return new TilingSprite(core.Texture.fromImage(imageId,crossorigin,scaleMode),width,height)}},{"../core":29,"../core/renderers/canvas/utils/CanvasTinter":48}],83:[function(require,module,exports){var core=require("../core"),DisplayObject=core.DisplayObject,_tempMatrix=new core.Matrix;DisplayObject.prototype._cacheAsBitmap=false;DisplayObject.prototype._originalRenderWebGL=null;DisplayObject.prototype._originalRenderCanvas=null;DisplayObject.prototype._originalUpdateTransform=null;DisplayObject.prototype._originalHitTest=null;DisplayObject.prototype._originalDestroy=null;DisplayObject.prototype._cachedSprite=null;Object.defineProperties(DisplayObject.prototype,{cacheAsBitmap:{get:function(){return this._cacheAsBitmap},set:function(value){if(this._cacheAsBitmap===value){return}this._cacheAsBitmap=value;if(value){this._originalRenderWebGL=this.renderWebGL;this._originalRenderCanvas=this.renderCanvas;this._originalUpdateTransform=this.updateTransform;this._originalGetBounds=this.getBounds;this._originalDestroy=this.destroy;this._originalContainsPoint=this.containsPoint;this.renderWebGL=this._renderCachedWebGL;this.renderCanvas=this._renderCachedCanvas;this.destroy=this._cacheAsBitmapDestroy}else{if(this._cachedSprite){this._destroyCachedDisplayObject()}this.renderWebGL=this._originalRenderWebGL;this.renderCanvas=this._originalRenderCanvas;this.getBounds=this._originalGetBounds;this.destroy=this._originalDestroy;this.updateTransform=this._originalUpdateTransform;this.containsPoint=this._originalContainsPoint}}}});DisplayObject.prototype._renderCachedWebGL=function(renderer){if(!this.visible||this.worldAlpha<=0||!this.renderable){return}this._initCachedDisplayObject(renderer);this._cachedSprite.worldAlpha=this.worldAlpha;renderer.setObjectRenderer(renderer.plugins.sprite);renderer.plugins.sprite.render(this._cachedSprite)};DisplayObject.prototype._initCachedDisplayObject=function(renderer){if(this._cachedSprite){return}renderer.currentRenderer.flush();var bounds=this.getLocalBounds().clone();if(this._filters){var padding=this._filters[0].padding;bounds.x-=padding;bounds.y-=padding;bounds.width+=padding*2;bounds.height+=padding*2}var cachedRenderTarget=renderer.currentRenderTarget;var stack=renderer.filterManager.filterStack;var renderTexture=new core.RenderTexture(renderer,bounds.width|0,bounds.height|0);var m=_tempMatrix;m.tx=-bounds.x;m.ty=-bounds.y;this.renderWebGL=this._originalRenderWebGL;renderTexture.render(this,m,true,true);renderer.setRenderTarget(cachedRenderTarget);renderer.filterManager.filterStack=stack;this.renderWebGL=this._renderCachedWebGL;this.updateTransform=this.displayObjectUpdateTransform;this.getBounds=this._getCachedBounds;this._cachedSprite=new core.Sprite(renderTexture);this._cachedSprite.worldTransform=this.worldTransform;this._cachedSprite.anchor.x=-(bounds.x/bounds.width);this._cachedSprite.anchor.y=-(bounds.y/bounds.height);this.updateTransform();this.containsPoint=this._cachedSprite.containsPoint.bind(this._cachedSprite)};DisplayObject.prototype._renderCachedCanvas=function(renderer){if(!this.visible||this.worldAlpha<=0||!this.renderable){return}this._initCachedDisplayObjectCanvas(renderer);this._cachedSprite.worldAlpha=this.worldAlpha;this._cachedSprite.renderCanvas(renderer)};DisplayObject.prototype._initCachedDisplayObjectCanvas=function(renderer){if(this._cachedSprite){return}var bounds=this.getLocalBounds();var cachedRenderTarget=renderer.context;var renderTexture=new core.RenderTexture(renderer,bounds.width|0,bounds.height|0);var m=_tempMatrix;m.tx=-bounds.x;m.ty=-bounds.y;this.renderCanvas=this._originalRenderCanvas;renderTexture.render(this,m,true);renderer.context=cachedRenderTarget;this.renderCanvas=this._renderCachedCanvas;this.updateTransform=this.displayObjectUpdateTransform;this.getBounds=this._getCachedBounds;this._cachedSprite=new core.Sprite(renderTexture);this._cachedSprite.worldTransform=this.worldTransform;this._cachedSprite.anchor.x=-(bounds.x/bounds.width);this._cachedSprite.anchor.y=-(bounds.y/bounds.height);this.updateTransform();this.containsPoint=this._cachedSprite.containsPoint.bind(this._cachedSprite)};DisplayObject.prototype._getCachedBounds=function(){this._cachedSprite._currentBounds=null;return this._cachedSprite.getBounds()};DisplayObject.prototype._destroyCachedDisplayObject=function(){this._cachedSprite._texture.destroy();this._cachedSprite=null};DisplayObject.prototype._cacheAsBitmapDestroy=function(){this.cacheAsBitmap=false;this._originalDestroy()}},{"../core":29}],84:[function(require,module,exports){var core=require("../core");core.DisplayObject.prototype.name=null;core.Container.prototype.getChildByName=function(name){for(var i=0;i<this.children.length;i++){if(this.children[i].name===name){return this.children[i]}}return null}},{"../core":29}],85:[function(require,module,exports){var core=require("../core");core.DisplayObject.prototype.getGlobalPosition=function(point){point=point||new core.Point;if(this.parent){this.displayObjectUpdateTransform();point.x=this.worldTransform.tx;point.y=this.worldTransform.ty}else{point.x=this.position.x;point.y=this.position.y}return point}},{"../core":29}],86:[function(require,module,exports){require("./cacheAsBitmap");require("./getChildByName");require("./getGlobalPosition");module.exports={MovieClip:require("./MovieClip"),TilingSprite:require("./TilingSprite"),BitmapText:require("./BitmapText")}},{"./BitmapText":80,"./MovieClip":81,"./TilingSprite":82,"./cacheAsBitmap":83,"./getChildByName":84,"./getGlobalPosition":85}],87:[function(require,module,exports){var core=require("../../core");function AsciiFilter(){core.AbstractFilter.call(this,null,"precision mediump float;\n\nuniform vec4 dimensions;\nuniform float pixelSize;\nuniform sampler2D uSampler;\n\nfloat character(float n, vec2 p)\n{\n    p = floor(p*vec2(4.0, -4.0) + 2.5);\n    if (clamp(p.x, 0.0, 4.0) == p.x && clamp(p.y, 0.0, 4.0) == p.y)\n    {\n        if (int(mod(n/exp2(p.x + 5.0*p.y), 2.0)) == 1) return 1.0;\n    }\n    return 0.0;\n}\n\nvoid main()\n{\n    vec2 uv = gl_FragCoord.xy;\n\n    vec3 col = texture2D(uSampler, floor( uv / pixelSize ) * pixelSize / dimensions.xy).rgb;\n\n    float gray = (col.r + col.g + col.b) / 3.0;\n\n    float n =  65536.0;             // .\n    if (gray > 0.2) n = 65600.0;    // :\n    if (gray > 0.3) n = 332772.0;   // *\n    if (gray > 0.4) n = 15255086.0; // o\n    if (gray > 0.5) n = 23385164.0; // &\n    if (gray > 0.6) n = 15252014.0; // 8\n    if (gray > 0.7) n = 13199452.0; // @\n    if (gray > 0.8) n = 11512810.0; // #\n\n    vec2 p = mod( uv / ( pixelSize * 0.5 ), 2.0) - vec2(1.0);\n    col = col * character(n, p);\n\n    gl_FragColor = vec4(col, 1.0);\n}\n",{dimensions:{type:"4fv",value:new Float32Array([0,0,0,0])},pixelSize:{type:"1f",value:8}})}AsciiFilter.prototype=Object.create(core.AbstractFilter.prototype);AsciiFilter.prototype.constructor=AsciiFilter;module.exports=AsciiFilter;Object.defineProperties(AsciiFilter.prototype,{size:{get:function(){return this.uniforms.pixelSize.value},set:function(value){this.uniforms.pixelSize.value=value}}})},{"../../core":29}],88:[function(require,module,exports){var core=require("../../core"),BlurXFilter=require("../blur/BlurXFilter"),BlurYFilter=require("../blur/BlurYFilter");function BloomFilter(){core.AbstractFilter.call(this);this.blurXFilter=new BlurXFilter;this.blurYFilter=new BlurYFilter;this.defaultFilter=new core.AbstractFilter}BloomFilter.prototype=Object.create(core.AbstractFilter.prototype);BloomFilter.prototype.constructor=BloomFilter;module.exports=BloomFilter;BloomFilter.prototype.applyFilter=function(renderer,input,output){var renderTarget=renderer.filterManager.getRenderTarget(true);this.defaultFilter.applyFilter(renderer,input,output);this.blurXFilter.applyFilter(renderer,input,renderTarget);renderer.blendModeManager.setBlendMode(core.BLEND_MODES.SCREEN);this.blurYFilter.applyFilter(renderer,renderTarget,output);renderer.blendModeManager.setBlendMode(core.BLEND_MODES.NORMAL);renderer.filterManager.returnRenderTarget(renderTarget)};Object.defineProperties(BloomFilter.prototype,{blur:{get:function(){return this.blurXFilter.blur},set:function(value){this.blurXFilter.blur=this.blurYFilter.blur=value}},blurX:{get:function(){return this.blurXFilter.blur},set:function(value){this.blurXFilter.blur=value}},blurY:{get:function(){return this.blurYFilter.blur},set:function(value){this.blurYFilter.blur=value}}})},{"../../core":29,"../blur/BlurXFilter":91,"../blur/BlurYFilter":92}],89:[function(require,module,exports){var core=require("../../core");function BlurDirFilter(dirX,dirY){core.AbstractFilter.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform float strength;\nuniform float dirX;\nuniform float dirY;\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying vec2 vBlurTexCoords[3];\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3((aVertexPosition), 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n\n    vBlurTexCoords[0] = aTextureCoord + vec2( (0.004 * strength) * dirX, (0.004 * strength) * dirY );\n    vBlurTexCoords[1] = aTextureCoord + vec2( (0.008 * strength) * dirX, (0.008 * strength) * dirY );\n    vBlurTexCoords[2] = aTextureCoord + vec2( (0.012 * strength) * dirX, (0.012 * strength) * dirY );\n\n    vColor = vec4(aColor.rgb * aColor.a, aColor.a);\n}\n","precision lowp float;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vBlurTexCoords[3];\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = vec4(0.0);\n\n    gl_FragColor += texture2D(uSampler, vTextureCoord     ) * 0.3989422804014327;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 0]) * 0.2419707245191454;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 1]) * 0.05399096651318985;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 2]) * 0.004431848411938341;\n}\n",{strength:{type:"1f",value:1},dirX:{type:"1f",value:dirX||0},dirY:{type:"1f",value:dirY||0}});this.defaultFilter=new core.AbstractFilter;this.passes=1;this.dirX=dirX||0;this.dirY=dirY||0;this.strength=4}BlurDirFilter.prototype=Object.create(core.AbstractFilter.prototype);BlurDirFilter.prototype.constructor=BlurDirFilter;module.exports=BlurDirFilter;BlurDirFilter.prototype.applyFilter=function(renderer,input,output,clear){var shader=this.getShader(renderer);this.uniforms.strength.value=this.strength/4/this.passes*(input.frame.width/input.size.width);if(this.passes===1){renderer.filterManager.applyFilter(shader,input,output,clear)}else{var renderTarget=renderer.filterManager.getRenderTarget(true);renderer.filterManager.applyFilter(shader,input,renderTarget,clear);for(var i=0;i<this.passes-2;i++){renderer.filterManager.applyFilter(shader,renderTarget,renderTarget,clear)}renderer.filterManager.applyFilter(shader,renderTarget,output,clear);renderer.filterManager.returnRenderTarget(renderTarget)}};Object.defineProperties(BlurDirFilter.prototype,{blur:{get:function(){return this.strength},set:function(value){this.padding=value*.5;this.strength=value}},dirX:{get:function(){return this.dirX},set:function(value){this.uniforms.dirX.value=value}},dirY:{get:function(){return this.dirY},set:function(value){this.uniforms.dirY.value=value}}})},{"../../core":29}],90:[function(require,module,exports){var core=require("../../core"),BlurXFilter=require("./BlurXFilter"),BlurYFilter=require("./BlurYFilter");function BlurFilter(){core.AbstractFilter.call(this);this.blurXFilter=new BlurXFilter;this.blurYFilter=new BlurYFilter}BlurFilter.prototype=Object.create(core.AbstractFilter.prototype);
BlurFilter.prototype.constructor=BlurFilter;module.exports=BlurFilter;BlurFilter.prototype.applyFilter=function(renderer,input,output){var renderTarget=renderer.filterManager.getRenderTarget(true);this.blurXFilter.applyFilter(renderer,input,renderTarget);this.blurYFilter.applyFilter(renderer,renderTarget,output);renderer.filterManager.returnRenderTarget(renderTarget)};Object.defineProperties(BlurFilter.prototype,{blur:{get:function(){return this.blurXFilter.blur},set:function(value){this.padding=Math.abs(value)*.5;this.blurXFilter.blur=this.blurYFilter.blur=value}},passes:{get:function(){return this.blurXFilter.passes},set:function(value){this.blurXFilter.passes=this.blurYFilter.passes=value}},blurX:{get:function(){return this.blurXFilter.blur},set:function(value){this.blurXFilter.blur=value}},blurY:{get:function(){return this.blurYFilter.blur},set:function(value){this.blurYFilter.blur=value}}})},{"../../core":29,"./BlurXFilter":91,"./BlurYFilter":92}],91:[function(require,module,exports){var core=require("../../core");function BlurXFilter(){core.AbstractFilter.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform float strength;\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying vec2 vBlurTexCoords[6];\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3((aVertexPosition), 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n\n    vBlurTexCoords[ 0] = aTextureCoord + vec2(-0.012 * strength, 0.0);\n    vBlurTexCoords[ 1] = aTextureCoord + vec2(-0.008 * strength, 0.0);\n    vBlurTexCoords[ 2] = aTextureCoord + vec2(-0.004 * strength, 0.0);\n    vBlurTexCoords[ 3] = aTextureCoord + vec2( 0.004 * strength, 0.0);\n    vBlurTexCoords[ 4] = aTextureCoord + vec2( 0.008 * strength, 0.0);\n    vBlurTexCoords[ 5] = aTextureCoord + vec2( 0.012 * strength, 0.0);\n\n    vColor = vec4(aColor.rgb * aColor.a, aColor.a);\n}\n","precision lowp float;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vBlurTexCoords[6];\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = vec4(0.0);\n\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 0])*0.004431848411938341;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 1])*0.05399096651318985;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 2])*0.2419707245191454;\n    gl_FragColor += texture2D(uSampler, vTextureCoord     )*0.3989422804014327;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 3])*0.2419707245191454;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 4])*0.05399096651318985;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 5])*0.004431848411938341;\n}\n",{strength:{type:"1f",value:1}});this.passes=1;this.strength=4}BlurXFilter.prototype=Object.create(core.AbstractFilter.prototype);BlurXFilter.prototype.constructor=BlurXFilter;module.exports=BlurXFilter;BlurXFilter.prototype.applyFilter=function(renderer,input,output,clear){var shader=this.getShader(renderer);this.uniforms.strength.value=this.strength/4/this.passes*(input.frame.width/input.size.width);if(this.passes===1){renderer.filterManager.applyFilter(shader,input,output,clear)}else{var renderTarget=renderer.filterManager.getRenderTarget(true);var flip=input;var flop=renderTarget;for(var i=0;i<this.passes-1;i++){renderer.filterManager.applyFilter(shader,flip,flop,true);var temp=flop;flop=flip;flip=temp}renderer.filterManager.applyFilter(shader,flip,output,clear);renderer.filterManager.returnRenderTarget(renderTarget)}};Object.defineProperties(BlurXFilter.prototype,{blur:{get:function(){return this.strength},set:function(value){this.padding=Math.abs(value)*.5;this.strength=value}}})},{"../../core":29}],92:[function(require,module,exports){var core=require("../../core");function BlurYFilter(){core.AbstractFilter.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform float strength;\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying vec2 vBlurTexCoords[6];\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3((aVertexPosition), 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n\n    vBlurTexCoords[ 0] = aTextureCoord + vec2(0.0, -0.012 * strength);\n    vBlurTexCoords[ 1] = aTextureCoord + vec2(0.0, -0.008 * strength);\n    vBlurTexCoords[ 2] = aTextureCoord + vec2(0.0, -0.004 * strength);\n    vBlurTexCoords[ 3] = aTextureCoord + vec2(0.0,  0.004 * strength);\n    vBlurTexCoords[ 4] = aTextureCoord + vec2(0.0,  0.008 * strength);\n    vBlurTexCoords[ 5] = aTextureCoord + vec2(0.0,  0.012 * strength);\n\n   vColor = vec4(aColor.rgb * aColor.a, aColor.a);\n}\n","precision lowp float;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vBlurTexCoords[6];\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = vec4(0.0);\n\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 0])*0.004431848411938341;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 1])*0.05399096651318985;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 2])*0.2419707245191454;\n    gl_FragColor += texture2D(uSampler, vTextureCoord     )*0.3989422804014327;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 3])*0.2419707245191454;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 4])*0.05399096651318985;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 5])*0.004431848411938341;\n}\n",{strength:{type:"1f",value:1}});this.passes=1;this.strength=4}BlurYFilter.prototype=Object.create(core.AbstractFilter.prototype);BlurYFilter.prototype.constructor=BlurYFilter;module.exports=BlurYFilter;BlurYFilter.prototype.applyFilter=function(renderer,input,output,clear){var shader=this.getShader(renderer);this.uniforms.strength.value=Math.abs(this.strength)/4/this.passes*(input.frame.height/input.size.height);if(this.passes===1){renderer.filterManager.applyFilter(shader,input,output,clear)}else{var renderTarget=renderer.filterManager.getRenderTarget(true);var flip=input;var flop=renderTarget;for(var i=0;i<this.passes-1;i++){renderer.filterManager.applyFilter(shader,flip,flop,true);var temp=flop;flop=flip;flip=temp}renderer.filterManager.applyFilter(shader,flip,output,clear);renderer.filterManager.returnRenderTarget(renderTarget)}};Object.defineProperties(BlurYFilter.prototype,{blur:{get:function(){return this.strength},set:function(value){this.padding=Math.abs(value)*.5;this.strength=value}}})},{"../../core":29}],93:[function(require,module,exports){var core=require("../../core");function SmartBlurFilter(){core.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec2 delta;\n\nfloat random(vec3 scale, float seed)\n{\n    return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\n}\n\nvoid main(void)\n{\n    vec4 color = vec4(0.0);\n    float total = 0.0;\n\n    float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\n\n    for (float t = -30.0; t <= 30.0; t++)\n    {\n        float percent = (t + offset - 0.5) / 30.0;\n        float weight = 1.0 - abs(percent);\n        vec4 sample = texture2D(uSampler, vTextureCoord + delta * percent);\n        sample.rgb *= sample.a;\n        color += sample * weight;\n        total += weight;\n    }\n\n    gl_FragColor = color / total;\n    gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\n}\n",{delta:{type:"v2",value:{x:.1,y:0}}})}SmartBlurFilter.prototype=Object.create(core.AbstractFilter.prototype);SmartBlurFilter.prototype.constructor=SmartBlurFilter;module.exports=SmartBlurFilter},{"../../core":29}],94:[function(require,module,exports){var core=require("../../core");function ColorMatrixFilter(){core.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[25];\n\nvoid main(void)\n{\n\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    gl_FragColor.r = (m[0] * c.r);\n        gl_FragColor.r += (m[1] * c.g);\n        gl_FragColor.r += (m[2] * c.b);\n        gl_FragColor.r += (m[3] * c.a);\n        gl_FragColor.r += m[4] * c.a;\n\n    gl_FragColor.g = (m[5] * c.r);\n        gl_FragColor.g += (m[6] * c.g);\n        gl_FragColor.g += (m[7] * c.b);\n        gl_FragColor.g += (m[8] * c.a);\n        gl_FragColor.g += m[9] * c.a;\n\n     gl_FragColor.b = (m[10] * c.r);\n        gl_FragColor.b += (m[11] * c.g);\n        gl_FragColor.b += (m[12] * c.b);\n        gl_FragColor.b += (m[13] * c.a);\n        gl_FragColor.b += m[14] * c.a;\n\n     gl_FragColor.a = (m[15] * c.r);\n        gl_FragColor.a += (m[16] * c.g);\n        gl_FragColor.a += (m[17] * c.b);\n        gl_FragColor.a += (m[18] * c.a);\n        gl_FragColor.a += m[19] * c.a;\n\n}\n",{m:{type:"1fv",value:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]}})}ColorMatrixFilter.prototype=Object.create(core.AbstractFilter.prototype);ColorMatrixFilter.prototype.constructor=ColorMatrixFilter;module.exports=ColorMatrixFilter;ColorMatrixFilter.prototype._loadMatrix=function(matrix,multiply){multiply=!!multiply;var newMatrix=matrix;if(multiply){this._multiply(newMatrix,this.uniforms.m.value,matrix);newMatrix=this._colorMatrix(newMatrix)}this.uniforms.m.value=newMatrix};ColorMatrixFilter.prototype._multiply=function(out,a,b){out[0]=a[0]*b[0]+a[1]*b[5]+a[2]*b[10]+a[3]*b[15];out[1]=a[0]*b[1]+a[1]*b[6]+a[2]*b[11]+a[3]*b[16];out[2]=a[0]*b[2]+a[1]*b[7]+a[2]*b[12]+a[3]*b[17];out[3]=a[0]*b[3]+a[1]*b[8]+a[2]*b[13]+a[3]*b[18];out[4]=a[0]*b[4]+a[1]*b[9]+a[2]*b[14]+a[3]*b[19];out[5]=a[5]*b[0]+a[6]*b[5]+a[7]*b[10]+a[8]*b[15];out[6]=a[5]*b[1]+a[6]*b[6]+a[7]*b[11]+a[8]*b[16];out[7]=a[5]*b[2]+a[6]*b[7]+a[7]*b[12]+a[8]*b[17];out[8]=a[5]*b[3]+a[6]*b[8]+a[7]*b[13]+a[8]*b[18];out[9]=a[5]*b[4]+a[6]*b[9]+a[7]*b[14]+a[8]*b[19];out[10]=a[10]*b[0]+a[11]*b[5]+a[12]*b[10]+a[13]*b[15];out[11]=a[10]*b[1]+a[11]*b[6]+a[12]*b[11]+a[13]*b[16];out[12]=a[10]*b[2]+a[11]*b[7]+a[12]*b[12]+a[13]*b[17];out[13]=a[10]*b[3]+a[11]*b[8]+a[12]*b[13]+a[13]*b[18];out[14]=a[10]*b[4]+a[11]*b[9]+a[12]*b[14]+a[13]*b[19];out[15]=a[15]*b[0]+a[16]*b[5]+a[17]*b[10]+a[18]*b[15];out[16]=a[15]*b[1]+a[16]*b[6]+a[17]*b[11]+a[18]*b[16];out[17]=a[15]*b[2]+a[16]*b[7]+a[17]*b[12]+a[18]*b[17];out[18]=a[15]*b[3]+a[16]*b[8]+a[17]*b[13]+a[18]*b[18];out[19]=a[15]*b[4]+a[16]*b[9]+a[17]*b[14]+a[18]*b[19];return out};ColorMatrixFilter.prototype._colorMatrix=function(matrix){var m=new Float32Array(matrix);m[4]/=255;m[9]/=255;m[14]/=255;m[19]/=255;return m};ColorMatrixFilter.prototype.brightness=function(b,multiply){var matrix=[b,0,0,0,0,0,b,0,0,0,0,0,b,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter.prototype.greyscale=function(scale,multiply){var matrix=[scale,scale,scale,0,0,scale,scale,scale,0,0,scale,scale,scale,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter.prototype.grayscale=ColorMatrixFilter.prototype.greyscale;ColorMatrixFilter.prototype.blackAndWhite=function(multiply){var matrix=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter.prototype.hue=function(rotation,multiply){rotation=(rotation||0)/180*Math.PI;var cos=Math.cos(rotation),sin=Math.sin(rotation);var lumR=.213,lumG=.715,lumB=.072;var matrix=[lumR+cos*(1-lumR)+sin*-lumR,lumG+cos*-lumG+sin*-lumG,lumB+cos*-lumB+sin*(1-lumB),0,0,lumR+cos*-lumR+sin*.143,lumG+cos*(1-lumG)+sin*.14,lumB+cos*-lumB+sin*-.283,0,0,lumR+cos*-lumR+sin*-(1-lumR),lumG+cos*-lumG+sin*lumG,lumB+cos*(1-lumB)+sin*lumB,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter.prototype.contrast=function(amount,multiply){var v=(amount||0)+1;var o=-128*(v-1);var matrix=[v,0,0,0,o,0,v,0,0,o,0,0,v,0,o,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter.prototype.saturate=function(amount,multiply){var x=(amount||0)*2/3+1;var y=(x-1)*-.5;var matrix=[x,y,y,0,0,y,x,y,0,0,y,y,x,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter.prototype.desaturate=function(multiply){this.saturate(-1)};ColorMatrixFilter.prototype.negative=function(multiply){var matrix=[0,1,1,0,0,1,0,1,0,0,1,1,0,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter.prototype.sepia=function(multiply){var matrix=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter.prototype.technicolor=function(multiply){var matrix=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter.prototype.polaroid=function(multiply){var matrix=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter.prototype.toBGR=function(multiply){var matrix=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter.prototype.kodachrome=function(multiply){var matrix=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter.prototype.browni=function(multiply){var matrix=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter.prototype.vintage=function(multiply){var matrix=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter.prototype.colorTone=function(desaturation,toned,lightColor,darkColor,multiply){desaturation=desaturation||.2;toned=toned||.15;lightColor=lightColor||16770432;darkColor=darkColor||3375104;var lR=(lightColor>>16&255)/255;var lG=(lightColor>>8&255)/255;var lB=(lightColor&255)/255;var dR=(darkColor>>16&255)/255;var dG=(darkColor>>8&255)/255;var dB=(darkColor&255)/255;var matrix=[.3,.59,.11,0,0,lR,lG,lB,desaturation,0,dR,dG,dB,toned,0,lR-dR,lG-dG,lB-dB,0,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter.prototype.night=function(intensity,multiply){intensity=intensity||.1;var matrix=[intensity*-2,-intensity,0,0,0,-intensity,0,intensity,0,0,0,intensity,intensity*2,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter.prototype.predator=function(amount,multiply){var matrix=[11.224130630493164*amount,-4.794486999511719*amount,-2.8746118545532227*amount,0*amount,.40342438220977783*amount,-3.6330697536468506*amount,9.193157196044922*amount,-2.951810836791992*amount,0*amount,-1.316135048866272*amount,-3.2184197902679443*amount,-4.2375030517578125*amount,7.476448059082031*amount,0*amount,.8044459223747253*amount,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter.prototype.lsd=function(multiply){var matrix=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)};ColorMatrixFilter.prototype.reset=function(){var matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(matrix,false)};Object.defineProperties(ColorMatrixFilter.prototype,{matrix:{get:function(){return this.uniforms.m.value},set:function(value){this.uniforms.m.value=value}}})},{"../../core":29}],95:[function(require,module,exports){var core=require("../../core");function ColorStepFilter(){core.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float step;\n\nvoid main(void)\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n\n    color = floor(color * step) / step;\n\n    gl_FragColor = color;\n}\n",{step:{type:"1f",value:5}})}ColorStepFilter.prototype=Object.create(core.AbstractFilter.prototype);ColorStepFilter.prototype.constructor=ColorStepFilter;module.exports=ColorStepFilter;Object.defineProperties(ColorStepFilter.prototype,{step:{get:function(){return this.uniforms.step.value},set:function(value){this.uniforms.step.value=value}}})},{"../../core":29}],96:[function(require,module,exports){var core=require("../../core");function ConvolutionFilter(matrix,width,height){core.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying mediump vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec2 texelSize;\nuniform float matrix[9];\n\nvoid main(void)\n{\n   vec4 c11 = texture2D(uSampler, vTextureCoord - texelSize); // top left\n   vec4 c12 = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - texelSize.y)); // top center\n   vec4 c13 = texture2D(uSampler, vec2(vTextureCoord.x + texelSize.x, vTextureCoord.y - texelSize.y)); // top right\n\n   vec4 c21 = texture2D(uSampler, vec2(vTextureCoord.x - texelSize.x, vTextureCoord.y)); // mid left\n   vec4 c22 = texture2D(uSampler, vTextureCoord); // mid center\n   vec4 c23 = texture2D(uSampler, vec2(vTextureCoord.x + texelSize.x, vTextureCoord.y)); // mid right\n\n   vec4 c31 = texture2D(uSampler, vec2(vTextureCoord.x - texelSize.x, vTextureCoord.y + texelSize.y)); // bottom left\n   vec4 c32 = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + texelSize.y)); // bottom center\n   vec4 c33 = texture2D(uSampler, vTextureCoord + texelSize); // bottom right\n\n   gl_FragColor =\n       c11 * matrix[0] + c12 * matrix[1] + c13 * matrix[2] +\n       c21 * matrix[3] + c22 * matrix[4] + c23 * matrix[5] +\n       c31 * matrix[6] + c32 * matrix[7] + c33 * matrix[8];\n\n   gl_FragColor.a = c22.a;\n}\n",{matrix:{type:"1fv",value:new Float32Array(matrix)},texelSize:{type:"v2",value:{x:1/width,y:1/height}}})}ConvolutionFilter.prototype=Object.create(core.AbstractFilter.prototype);ConvolutionFilter.prototype.constructor=ConvolutionFilter;module.exports=ConvolutionFilter;Object.defineProperties(ConvolutionFilter.prototype,{matrix:{get:function(){return this.uniforms.matrix.value},set:function(value){this.uniforms.matrix.value=new Float32Array(value)}},width:{get:function(){return 1/this.uniforms.texelSize.value.x},set:function(value){this.uniforms.texelSize.value.x=1/value}},height:{get:function(){return 1/this.uniforms.texelSize.value.y},set:function(value){this.uniforms.texelSize.value.y=1/value}}})},{"../../core":29}],97:[function(require,module,exports){var core=require("../../core");function CrossHatchFilter(){core.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    float lum = length(texture2D(uSampler, vTextureCoord.xy).rgb);\n\n    gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);\n\n    if (lum < 1.00)\n    {\n        if (mod(gl_FragCoord.x + gl_FragCoord.y, 10.0) == 0.0)\n        {\n            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n        }\n    }\n\n    if (lum < 0.75)\n    {\n        if (mod(gl_FragCoord.x - gl_FragCoord.y, 10.0) == 0.0)\n        {\n            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n        }\n    }\n\n    if (lum < 0.50)\n    {\n        if (mod(gl_FragCoord.x + gl_FragCoord.y - 5.0, 10.0) == 0.0)\n        {\n            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n        }\n    }\n\n    if (lum < 0.3)\n    {\n        if (mod(gl_FragCoord.x - gl_FragCoord.y - 5.0, 10.0) == 0.0)\n        {\n            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n        }\n    }\n}\n")}CrossHatchFilter.prototype=Object.create(core.AbstractFilter.prototype);CrossHatchFilter.prototype.constructor=CrossHatchFilter;module.exports=CrossHatchFilter},{"../../core":29}],98:[function(require,module,exports){var core=require("../../core");function DisplacementFilter(sprite,scale){var maskMatrix=new core.Matrix;sprite.renderable=false;core.AbstractFilter.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMapCoord;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void)\n{\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n   vMapCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n   vColor = vec4(aColor.rgb * aColor.a, aColor.a);\n}\n","precision mediump float;\n\nvarying vec2 vMapCoord;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform vec2 scale;\n\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nvoid main(void)\n{\n   vec4 map =  texture2D(mapSampler, vMapCoord);\n\n   map -= 0.5;\n   map.xy *= scale;\n\n   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y));\n}\n",{mapSampler:{type:"sampler2D",value:sprite.texture},otherMatrix:{type:"mat3",value:maskMatrix.toArray(true)},scale:{type:"v2",value:{x:1,y:1}}});this.maskSprite=sprite;this.maskMatrix=maskMatrix;if(scale===null||scale===undefined){scale=20}this.scale=new core.Point(scale,scale)}DisplacementFilter.prototype=Object.create(core.AbstractFilter.prototype);DisplacementFilter.prototype.constructor=DisplacementFilter;module.exports=DisplacementFilter;DisplacementFilter.prototype.applyFilter=function(renderer,input,output){var filterManager=renderer.filterManager;filterManager.calculateMappedMatrix(input.frame,this.maskSprite,this.maskMatrix);this.uniforms.otherMatrix.value=this.maskMatrix.toArray(true);this.uniforms.scale.value.x=this.scale.x*(1/input.frame.width);this.uniforms.scale.value.y=this.scale.y*(1/input.frame.height);var shader=this.getShader(renderer);filterManager.applyFilter(shader,input,output)};Object.defineProperties(DisplacementFilter.prototype,{map:{get:function(){return this.uniforms.mapSampler.value},set:function(value){this.uniforms.mapSampler.value=value}}})},{"../../core":29}],99:[function(require,module,exports){var core=require("../../core");function DotScreenFilter(){core.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform vec4 dimensions;\nuniform sampler2D uSampler;\n\nuniform float angle;\nuniform float scale;\n\nfloat pattern()\n{\n   float s = sin(angle), c = cos(angle);\n   vec2 tex = vTextureCoord * dimensions.xy;\n   vec2 point = vec2(\n       c * tex.x - s * tex.y,\n       s * tex.x + c * tex.y\n   ) * scale;\n   return (sin(point.x) * sin(point.y)) * 4.0;\n}\n\nvoid main()\n{\n   vec4 color = texture2D(uSampler, vTextureCoord);\n   float average = (color.r + color.g + color.b) / 3.0;\n   gl_FragColor = vec4(vec3(average * 10.0 - 5.0 + pattern()), color.a);\n}\n",{scale:{type:"1f",value:1},angle:{type:"1f",value:5},dimensions:{type:"4fv",value:[0,0,0,0]}})}DotScreenFilter.prototype=Object.create(core.AbstractFilter.prototype);DotScreenFilter.prototype.constructor=DotScreenFilter;module.exports=DotScreenFilter;Object.defineProperties(DotScreenFilter.prototype,{scale:{get:function(){return this.uniforms.scale.value},set:function(value){this.uniforms.scale.value=value}},angle:{get:function(){return this.uniforms.angle.value},set:function(value){this.uniforms.angle.value=value}}})},{"../../core":29}],100:[function(require,module,exports){var core=require("../../core");function BlurYTintFilter(){core.AbstractFilter.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform float strength;\nuniform vec2 offset;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying vec2 vBlurTexCoords[6];\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3((aVertexPosition+offset), 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n\n    vBlurTexCoords[ 0] = aTextureCoord + vec2(0.0, -0.012 * strength);\n    vBlurTexCoords[ 1] = aTextureCoord + vec2(0.0, -0.008 * strength);\n    vBlurTexCoords[ 2] = aTextureCoord + vec2(0.0, -0.004 * strength);\n    vBlurTexCoords[ 3] = aTextureCoord + vec2(0.0,  0.004 * strength);\n    vBlurTexCoords[ 4] = aTextureCoord + vec2(0.0,  0.008 * strength);\n    vBlurTexCoords[ 5] = aTextureCoord + vec2(0.0,  0.012 * strength);\n\n   vColor = vec4(aColor.rgb * aColor.a, aColor.a);\n}\n","precision lowp float;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vBlurTexCoords[6];\nvarying vec4 vColor;\n\nuniform vec3 color;\nuniform float alpha;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    vec4 sum = vec4(0.0);\n\n    sum += texture2D(uSampler, vBlurTexCoords[ 0])*0.004431848411938341;\n    sum += texture2D(uSampler, vBlurTexCoords[ 1])*0.05399096651318985;\n    sum += texture2D(uSampler, vBlurTexCoords[ 2])*0.2419707245191454;\n    sum += texture2D(uSampler, vTextureCoord     )*0.3989422804014327;\n    sum += texture2D(uSampler, vBlurTexCoords[ 3])*0.2419707245191454;\n    sum += texture2D(uSampler, vBlurTexCoords[ 4])*0.05399096651318985;\n    sum += texture2D(uSampler, vBlurTexCoords[ 5])*0.004431848411938341;\n\n    gl_FragColor = vec4( color.rgb * sum.a * alpha, sum.a * alpha );\n}\n",{blur:{type:"1f",value:1/512},color:{type:"c",value:[0,0,0]},alpha:{type:"1f",value:.7},offset:{type:"2f",value:[5,5]},strength:{type:"1f",value:1}});this.passes=1;this.strength=4}BlurYTintFilter.prototype=Object.create(core.AbstractFilter.prototype);BlurYTintFilter.prototype.constructor=BlurYTintFilter;module.exports=BlurYTintFilter;BlurYTintFilter.prototype.applyFilter=function(renderer,input,output,clear){var shader=this.getShader(renderer);this.uniforms.strength.value=this.strength/4/this.passes*(input.frame.height/input.size.height);if(this.passes===1){renderer.filterManager.applyFilter(shader,input,output,clear)}else{var renderTarget=renderer.filterManager.getRenderTarget(true);var flip=input;var flop=renderTarget;for(var i=0;i<this.passes-1;i++){renderer.filterManager.applyFilter(shader,flip,flop,clear);var temp=flop;flop=flip;flip=temp}renderer.filterManager.applyFilter(shader,flip,output,clear);renderer.filterManager.returnRenderTarget(renderTarget)}};Object.defineProperties(BlurYTintFilter.prototype,{blur:{get:function(){return this.strength},set:function(value){this.padding=value*.5;this.strength=value}}})},{"../../core":29}],101:[function(require,module,exports){var core=require("../../core"),BlurXFilter=require("../blur/BlurXFilter"),BlurYTintFilter=require("./BlurYTintFilter");function DropShadowFilter(){core.AbstractFilter.call(this);this.blurXFilter=new BlurXFilter;this.blurYTintFilter=new BlurYTintFilter;this.defaultFilter=new core.AbstractFilter;this.padding=30;this._dirtyPosition=true;this._angle=45*Math.PI/180;this._distance=10;this.alpha=.75;this.hideObject=false;this.blendMode=core.BLEND_MODES.MULTIPLY}DropShadowFilter.prototype=Object.create(core.AbstractFilter.prototype);DropShadowFilter.prototype.constructor=DropShadowFilter;module.exports=DropShadowFilter;DropShadowFilter.prototype.applyFilter=function(renderer,input,output){var renderTarget=renderer.filterManager.getRenderTarget(true);if(this._dirtyPosition){this._dirtyPosition=false;this.blurYTintFilter.uniforms.offset.value[0]=Math.sin(this._angle)*this._distance;this.blurYTintFilter.uniforms.offset.value[1]=Math.cos(this._angle)*this._distance}this.blurXFilter.applyFilter(renderer,input,renderTarget);renderer.blendModeManager.setBlendMode(this.blendMode);this.blurYTintFilter.applyFilter(renderer,renderTarget,output);renderer.blendModeManager.setBlendMode(core.BLEND_MODES.NORMAL);if(!this.hideObject){this.defaultFilter.applyFilter(renderer,input,output)}renderer.filterManager.returnRenderTarget(renderTarget)};Object.defineProperties(DropShadowFilter.prototype,{blur:{get:function(){return this.blurXFilter.blur},set:function(value){this.blurXFilter.blur=this.blurYTintFilter.blur=value}},blurX:{get:function(){return this.blurXFilter.blur},set:function(value){this.blurXFilter.blur=value}},blurY:{get:function(){return this.blurYTintFilter.blur},set:function(value){this.blurYTintFilter.blur=value}},color:{get:function(){return core.utils.rgb2hex(this.blurYTintFilter.uniforms.color.value)},set:function(value){this.blurYTintFilter.uniforms.color.value=core.utils.hex2rgb(value)}},alpha:{get:function(){return this.blurYTintFilter.uniforms.alpha.value},set:function(value){this.blurYTintFilter.uniforms.alpha.value=value}},distance:{get:function(){return this._distance},set:function(value){this._dirtyPosition=true;this._distance=value}},angle:{get:function(){return this._angle},set:function(value){this._dirtyPosition=true;this._angle=value}}})},{"../../core":29,"../blur/BlurXFilter":91,"./BlurYTintFilter":100}],102:[function(require,module,exports){var core=require("../../core");function GrayFilter(){core.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\nuniform float gray;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n   gl_FragColor.rgb = mix(gl_FragColor.rgb, vec3(0.2126*gl_FragColor.r + 0.7152*gl_FragColor.g + 0.0722*gl_FragColor.b), gray);\n}\n",{gray:{type:"1f",value:1}})}GrayFilter.prototype=Object.create(core.AbstractFilter.prototype);GrayFilter.prototype.constructor=GrayFilter;module.exports=GrayFilter;Object.defineProperties(GrayFilter.prototype,{gray:{get:function(){return this.uniforms.gray.value},set:function(value){this.uniforms.gray.value=value}}})},{"../../core":29}],103:[function(require,module,exports){module.exports={AsciiFilter:require("./ascii/AsciiFilter"),BloomFilter:require("./bloom/BloomFilter"),BlurFilter:require("./blur/BlurFilter"),BlurXFilter:require("./blur/BlurXFilter"),BlurYFilter:require("./blur/BlurYFilter"),BlurDirFilter:require("./blur/BlurDirFilter"),ColorMatrixFilter:require("./color/ColorMatrixFilter"),ColorStepFilter:require("./color/ColorStepFilter"),ConvolutionFilter:require("./convolution/ConvolutionFilter"),CrossHatchFilter:require("./crosshatch/CrossHatchFilter"),DisplacementFilter:require("./displacement/DisplacementFilter"),DotScreenFilter:require("./dot/DotScreenFilter"),GrayFilter:require("./gray/GrayFilter"),DropShadowFilter:require("./dropshadow/DropShadowFilter"),InvertFilter:require("./invert/InvertFilter"),NoiseFilter:require("./noise/NoiseFilter"),PixelateFilter:require("./pixelate/PixelateFilter"),RGBSplitFilter:require("./rgb/RGBSplitFilter"),ShockwaveFilter:require("./shockwave/ShockwaveFilter"),SepiaFilter:require("./sepia/SepiaFilter"),SmartBlurFilter:require("./blur/SmartBlurFilter"),TiltShiftFilter:require("./tiltshift/TiltShiftFilter"),TiltShiftXFilter:require("./tiltshift/TiltShiftXFilter"),TiltShiftYFilter:require("./tiltshift/TiltShiftYFilter"),TwistFilter:require("./twist/TwistFilter")}},{"./ascii/AsciiFilter":87,"./bloom/BloomFilter":88,"./blur/BlurDirFilter":89,"./blur/BlurFilter":90,"./blur/BlurXFilter":91,"./blur/BlurYFilter":92,"./blur/SmartBlurFilter":93,"./color/ColorMatrixFilter":94,"./color/ColorStepFilter":95,"./convolution/ConvolutionFilter":96,"./crosshatch/CrossHatchFilter":97,"./displacement/DisplacementFilter":98,"./dot/DotScreenFilter":99,"./dropshadow/DropShadowFilter":101,"./gray/GrayFilter":102,"./invert/InvertFilter":104,"./noise/NoiseFilter":105,"./pixelate/PixelateFilter":106,"./rgb/RGBSplitFilter":107,"./sepia/SepiaFilter":108,"./shockwave/ShockwaveFilter":109,"./tiltshift/TiltShiftFilter":111,"./tiltshift/TiltShiftXFilter":112,"./tiltshift/TiltShiftYFilter":113,"./twist/TwistFilter":114}],104:[function(require,module,exports){var core=require("../../core");function InvertFilter(){core.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform float invert;\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord);\n\n    gl_FragColor.rgb = mix( (vec3(1)-gl_FragColor.rgb) * gl_FragColor.a, gl_FragColor.rgb, 1.0 - invert);\n}\n",{
invert:{type:"1f",value:1}})}InvertFilter.prototype=Object.create(core.AbstractFilter.prototype);InvertFilter.prototype.constructor=InvertFilter;module.exports=InvertFilter;Object.defineProperties(InvertFilter.prototype,{invert:{get:function(){return this.uniforms.invert.value},set:function(value){this.uniforms.invert.value=value}}})},{"../../core":29}],105:[function(require,module,exports){var core=require("../../core");function NoiseFilter(){core.AbstractFilter.call(this,null,"precision highp float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float noise;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n\n    float diff = (rand(vTextureCoord) - 0.5) * noise;\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    gl_FragColor = color;\n}\n",{noise:{type:"1f",value:.5}})}NoiseFilter.prototype=Object.create(core.AbstractFilter.prototype);NoiseFilter.prototype.constructor=NoiseFilter;module.exports=NoiseFilter;Object.defineProperties(NoiseFilter.prototype,{noise:{get:function(){return this.uniforms.noise.value},set:function(value){this.uniforms.noise.value=value}}})},{"../../core":29}],106:[function(require,module,exports){var core=require("../../core");function PixelateFilter(){core.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 dimensions;\nuniform vec2 pixelSize;\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord;\n\n    vec2 size = dimensions.xy / pixelSize;\n\n    vec2 color = floor( ( vTextureCoord * size ) ) / size + pixelSize/dimensions.xy * 0.5;\n\n    gl_FragColor = texture2D(uSampler, color);\n}\n",{dimensions:{type:"4fv",value:new Float32Array([0,0,0,0])},pixelSize:{type:"v2",value:{x:10,y:10}}})}PixelateFilter.prototype=Object.create(core.AbstractFilter.prototype);PixelateFilter.prototype.constructor=PixelateFilter;module.exports=PixelateFilter;Object.defineProperties(PixelateFilter.prototype,{size:{get:function(){return this.uniforms.pixelSize.value},set:function(value){this.uniforms.pixelSize.value=value}}})},{"../../core":29}],107:[function(require,module,exports){var core=require("../../core");function RGBSplitFilter(){core.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 dimensions;\nuniform vec2 red;\nuniform vec2 green;\nuniform vec2 blue;\n\nvoid main(void)\n{\n   gl_FragColor.r = texture2D(uSampler, vTextureCoord + red/dimensions.xy).r;\n   gl_FragColor.g = texture2D(uSampler, vTextureCoord + green/dimensions.xy).g;\n   gl_FragColor.b = texture2D(uSampler, vTextureCoord + blue/dimensions.xy).b;\n   gl_FragColor.a = texture2D(uSampler, vTextureCoord).a;\n}\n",{red:{type:"v2",value:{x:20,y:20}},green:{type:"v2",value:{x:-20,y:20}},blue:{type:"v2",value:{x:20,y:-20}},dimensions:{type:"4fv",value:[0,0,0,0]}})}RGBSplitFilter.prototype=Object.create(core.AbstractFilter.prototype);RGBSplitFilter.prototype.constructor=RGBSplitFilter;module.exports=RGBSplitFilter;Object.defineProperties(RGBSplitFilter.prototype,{red:{get:function(){return this.uniforms.red.value},set:function(value){this.uniforms.red.value=value}},green:{get:function(){return this.uniforms.green.value},set:function(value){this.uniforms.green.value=value}},blue:{get:function(){return this.uniforms.blue.value},set:function(value){this.uniforms.blue.value=value}}})},{"../../core":29}],108:[function(require,module,exports){var core=require("../../core");function SepiaFilter(){core.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float sepia;\n\nconst mat3 sepiaMatrix = mat3(0.3588, 0.7044, 0.1368, 0.2990, 0.5870, 0.1140, 0.2392, 0.4696, 0.0912);\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n   gl_FragColor.rgb = mix( gl_FragColor.rgb, gl_FragColor.rgb * sepiaMatrix, sepia);\n}\n",{sepia:{type:"1f",value:1}})}SepiaFilter.prototype=Object.create(core.AbstractFilter.prototype);SepiaFilter.prototype.constructor=SepiaFilter;module.exports=SepiaFilter;Object.defineProperties(SepiaFilter.prototype,{sepia:{get:function(){return this.uniforms.sepia.value},set:function(value){this.uniforms.sepia.value=value}}})},{"../../core":29}],109:[function(require,module,exports){var core=require("../../core");function ShockwaveFilter(){core.AbstractFilter.call(this,null,"precision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nuniform vec2 center;\nuniform vec3 params; // 10.0, 0.8, 0.1\nuniform float time;\n\nvoid main()\n{\n    vec2 uv = vTextureCoord;\n    vec2 texCoord = uv;\n\n    float dist = distance(uv, center);\n\n    if ( (dist <= (time + params.z)) && (dist >= (time - params.z)) )\n    {\n        float diff = (dist - time);\n        float powDiff = 1.0 - pow(abs(diff*params.x), params.y);\n\n        float diffTime = diff  * powDiff;\n        vec2 diffUV = normalize(uv - center);\n        texCoord = uv + (diffUV * diffTime);\n    }\n\n    gl_FragColor = texture2D(uSampler, texCoord);\n}\n",{center:{type:"v2",value:{x:.5,y:.5}},params:{type:"v3",value:{x:10,y:.8,z:.1}},time:{type:"1f",value:0}})}ShockwaveFilter.prototype=Object.create(core.AbstractFilter.prototype);ShockwaveFilter.prototype.constructor=ShockwaveFilter;module.exports=ShockwaveFilter;Object.defineProperties(ShockwaveFilter.prototype,{center:{get:function(){return this.uniforms.center.value},set:function(value){this.uniforms.center.value=value}},params:{get:function(){return this.uniforms.params.value},set:function(value){this.uniforms.params.value=value}},time:{get:function(){return this.uniforms.time.value},set:function(value){this.uniforms.time.value=value}}})},{"../../core":29}],110:[function(require,module,exports){var core=require("../../core");function TiltShiftAxisFilter(){core.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float blur;\nuniform float gradientBlur;\nuniform vec2 start;\nuniform vec2 end;\nuniform vec2 delta;\nuniform vec2 texSize;\n\nfloat random(vec3 scale, float seed)\n{\n    return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\n}\n\nvoid main(void)\n{\n    vec4 color = vec4(0.0);\n    float total = 0.0;\n\n    float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\n    vec2 normal = normalize(vec2(start.y - end.y, end.x - start.x));\n    float radius = smoothstep(0.0, 1.0, abs(dot(vTextureCoord * texSize - start, normal)) / gradientBlur) * blur;\n\n    for (float t = -30.0; t <= 30.0; t++)\n    {\n        float percent = (t + offset - 0.5) / 30.0;\n        float weight = 1.0 - abs(percent);\n        vec4 sample = texture2D(uSampler, vTextureCoord + delta / texSize * percent * radius);\n        sample.rgb *= sample.a;\n        color += sample * weight;\n        total += weight;\n    }\n\n    gl_FragColor = color / total;\n    gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\n}\n",{blur:{type:"1f",value:100},gradientBlur:{type:"1f",value:600},start:{type:"v2",value:{x:0,y:window.innerHeight/2}},end:{type:"v2",value:{x:600,y:window.innerHeight/2}},delta:{type:"v2",value:{x:30,y:30}},texSize:{type:"v2",value:{x:window.innerWidth,y:window.innerHeight}}});this.updateDelta()}TiltShiftAxisFilter.prototype=Object.create(core.AbstractFilter.prototype);TiltShiftAxisFilter.prototype.constructor=TiltShiftAxisFilter;module.exports=TiltShiftAxisFilter;TiltShiftAxisFilter.prototype.updateDelta=function(){this.uniforms.delta.value.x=0;this.uniforms.delta.value.y=0};Object.defineProperties(TiltShiftAxisFilter.prototype,{blur:{get:function(){return this.uniforms.blur.value},set:function(value){this.uniforms.blur.value=value}},gradientBlur:{get:function(){return this.uniforms.gradientBlur.value},set:function(value){this.uniforms.gradientBlur.value=value}},start:{get:function(){return this.uniforms.start.value},set:function(value){this.uniforms.start.value=value;this.updateDelta()}},end:{get:function(){return this.uniforms.end.value},set:function(value){this.uniforms.end.value=value;this.updateDelta()}}})},{"../../core":29}],111:[function(require,module,exports){var core=require("../../core"),TiltShiftXFilter=require("./TiltShiftXFilter"),TiltShiftYFilter=require("./TiltShiftYFilter");function TiltShiftFilter(){core.AbstractFilter.call(this);this.tiltShiftXFilter=new TiltShiftXFilter;this.tiltShiftYFilter=new TiltShiftYFilter}TiltShiftFilter.prototype=Object.create(core.AbstractFilter.prototype);TiltShiftFilter.prototype.constructor=TiltShiftFilter;module.exports=TiltShiftFilter;TiltShiftFilter.prototype.applyFilter=function(renderer,input,output){var renderTarget=renderer.filterManager.getRenderTarget(true);this.tiltShiftXFilter.applyFilter(renderer,input,renderTarget);this.tiltShiftYFilter.applyFilter(renderer,renderTarget,output);renderer.filterManager.returnRenderTarget(renderTarget)};Object.defineProperties(TiltShiftFilter.prototype,{blur:{get:function(){return this.tiltShiftXFilter.blur},set:function(value){this.tiltShiftXFilter.blur=this.tiltShiftYFilter.blur=value}},gradientBlur:{get:function(){return this.tiltShiftXFilter.gradientBlur},set:function(value){this.tiltShiftXFilter.gradientBlur=this.tiltShiftYFilter.gradientBlur=value}},start:{get:function(){return this.tiltShiftXFilter.start},set:function(value){this.tiltShiftXFilter.start=this.tiltShiftYFilter.start=value}},end:{get:function(){return this.tiltShiftXFilter.end},set:function(value){this.tiltShiftXFilter.end=this.tiltShiftYFilter.end=value}}})},{"../../core":29,"./TiltShiftXFilter":112,"./TiltShiftYFilter":113}],112:[function(require,module,exports){var TiltShiftAxisFilter=require("./TiltShiftAxisFilter");function TiltShiftXFilter(){TiltShiftAxisFilter.call(this)}TiltShiftXFilter.prototype=Object.create(TiltShiftAxisFilter.prototype);TiltShiftXFilter.prototype.constructor=TiltShiftXFilter;module.exports=TiltShiftXFilter;TiltShiftXFilter.prototype.updateDelta=function(){var dx=this.uniforms.end.value.x-this.uniforms.start.value.x;var dy=this.uniforms.end.value.y-this.uniforms.start.value.y;var d=Math.sqrt(dx*dx+dy*dy);this.uniforms.delta.value.x=dx/d;this.uniforms.delta.value.y=dy/d}},{"./TiltShiftAxisFilter":110}],113:[function(require,module,exports){var TiltShiftAxisFilter=require("./TiltShiftAxisFilter");function TiltShiftYFilter(){TiltShiftAxisFilter.call(this)}TiltShiftYFilter.prototype=Object.create(TiltShiftAxisFilter.prototype);TiltShiftYFilter.prototype.constructor=TiltShiftYFilter;module.exports=TiltShiftYFilter;TiltShiftYFilter.prototype.updateDelta=function(){var dx=this.uniforms.end.value.x-this.uniforms.start.value.x;var dy=this.uniforms.end.value.y-this.uniforms.start.value.y;var d=Math.sqrt(dx*dx+dy*dy);this.uniforms.delta.value.x=-dy/d;this.uniforms.delta.value.y=dx/d}},{"./TiltShiftAxisFilter":110}],114:[function(require,module,exports){var core=require("../../core");function TwistFilter(){core.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float radius;\nuniform float angle;\nuniform vec2 offset;\n\nvoid main(void)\n{\n   vec2 coord = vTextureCoord - offset;\n   float dist = length(coord);\n\n   if (dist < radius)\n   {\n       float ratio = (radius - dist) / radius;\n       float angleMod = ratio * ratio * angle;\n       float s = sin(angleMod);\n       float c = cos(angleMod);\n       coord = vec2(coord.x * c - coord.y * s, coord.x * s + coord.y * c);\n   }\n\n   gl_FragColor = texture2D(uSampler, coord+offset);\n}\n",{radius:{type:"1f",value:.5},angle:{type:"1f",value:5},offset:{type:"v2",value:{x:.5,y:.5}}})}TwistFilter.prototype=Object.create(core.AbstractFilter.prototype);TwistFilter.prototype.constructor=TwistFilter;module.exports=TwistFilter;Object.defineProperties(TwistFilter.prototype,{offset:{get:function(){return this.uniforms.offset.value},set:function(value){this.uniforms.offset.value=value}},radius:{get:function(){return this.uniforms.radius.value},set:function(value){this.uniforms.radius.value=value}},angle:{get:function(){return this.uniforms.angle.value},set:function(value){this.uniforms.angle.value=value}}})},{"../../core":29}],115:[function(require,module,exports){(function(global){require("./polyfill");var core=module.exports=require("./core");core.extras=require("./extras");core.filters=require("./filters");core.interaction=require("./interaction");core.loaders=require("./loaders");core.mesh=require("./mesh");core.accessibility=require("./accessibility");core.loader=new core.loaders.Loader;Object.assign(core,require("./deprecation"));global.PIXI=core}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./accessibility":21,"./core":29,"./deprecation":79,"./extras":86,"./filters":103,"./interaction":118,"./loaders":121,"./mesh":128,"./polyfill":133}],116:[function(require,module,exports){var core=require("../core");function InteractionData(){this.global=new core.Point;this.target=null;this.originalEvent=null}InteractionData.prototype.constructor=InteractionData;module.exports=InteractionData;InteractionData.prototype.getLocalPosition=function(displayObject,point,globalPos){return displayObject.worldTransform.applyInverse(globalPos||this.global,point)}},{"../core":29}],117:[function(require,module,exports){var core=require("../core"),InteractionData=require("./InteractionData");Object.assign(core.DisplayObject.prototype,require("./interactiveTarget"));function InteractionManager(renderer,options){options=options||{};this.renderer=renderer;this.autoPreventDefault=options.autoPreventDefault!==undefined?options.autoPreventDefault:true;this.interactionFrequency=options.interactionFrequency||10;this.mouse=new InteractionData;this.eventData={stopped:false,target:null,type:null,data:this.mouse,stopPropagation:function(){this.stopped=true}};this.interactiveDataPool=[];this.interactionDOMElement=null;this.moveWhenInside=false;this.eventsAdded=false;this.onMouseUp=this.onMouseUp.bind(this);this.processMouseUp=this.processMouseUp.bind(this);this.onMouseDown=this.onMouseDown.bind(this);this.processMouseDown=this.processMouseDown.bind(this);this.onMouseMove=this.onMouseMove.bind(this);this.processMouseMove=this.processMouseMove.bind(this);this.onMouseOut=this.onMouseOut.bind(this);this.processMouseOverOut=this.processMouseOverOut.bind(this);this.onTouchStart=this.onTouchStart.bind(this);this.processTouchStart=this.processTouchStart.bind(this);this.onTouchEnd=this.onTouchEnd.bind(this);this.processTouchEnd=this.processTouchEnd.bind(this);this.onTouchMove=this.onTouchMove.bind(this);this.processTouchMove=this.processTouchMove.bind(this);this.last=0;this.currentCursorStyle="inherit";this._tempPoint=new core.Point;this.resolution=1;this.setTargetElement(this.renderer.view,this.renderer.resolution)}InteractionManager.prototype.constructor=InteractionManager;module.exports=InteractionManager;InteractionManager.prototype.setTargetElement=function(element,resolution){this.removeEvents();this.interactionDOMElement=element;this.resolution=resolution||1;this.addEvents()};InteractionManager.prototype.addEvents=function(){if(!this.interactionDOMElement){return}core.ticker.shared.add(this.update,this);if(window.navigator.msPointerEnabled){this.interactionDOMElement.style["-ms-content-zooming"]="none";this.interactionDOMElement.style["-ms-touch-action"]="none"}window.document.addEventListener("mousemove",this.onMouseMove,true);this.interactionDOMElement.addEventListener("mousedown",this.onMouseDown,true);this.interactionDOMElement.addEventListener("mouseout",this.onMouseOut,true);this.interactionDOMElement.addEventListener("touchstart",this.onTouchStart,true);this.interactionDOMElement.addEventListener("touchend",this.onTouchEnd,true);this.interactionDOMElement.addEventListener("touchmove",this.onTouchMove,true);window.addEventListener("mouseup",this.onMouseUp,true);this.eventsAdded=true};InteractionManager.prototype.removeEvents=function(){if(!this.interactionDOMElement){return}core.ticker.shared.remove(this.update);if(window.navigator.msPointerEnabled){this.interactionDOMElement.style["-ms-content-zooming"]="";this.interactionDOMElement.style["-ms-touch-action"]=""}window.document.removeEventListener("mousemove",this.onMouseMove,true);this.interactionDOMElement.removeEventListener("mousedown",this.onMouseDown,true);this.interactionDOMElement.removeEventListener("mouseout",this.onMouseOut,true);this.interactionDOMElement.removeEventListener("touchstart",this.onTouchStart,true);this.interactionDOMElement.removeEventListener("touchend",this.onTouchEnd,true);this.interactionDOMElement.removeEventListener("touchmove",this.onTouchMove,true);this.interactionDOMElement=null;window.removeEventListener("mouseup",this.onMouseUp,true);this.eventsAdded=false};InteractionManager.prototype.update=function(deltaTime){this._deltaTime+=deltaTime;if(this._deltaTime<this.interactionFrequency){return}this._deltaTime=0;if(!this.interactionDOMElement){return}if(this.didMove){this.didMove=false;return}this.cursor="inherit";this.processInteractive(this.mouse.global,this.renderer._lastObjectRendered,this.processMouseOverOut,true);if(this.currentCursorStyle!==this.cursor){this.currentCursorStyle=this.cursor;this.interactionDOMElement.style.cursor=this.cursor}};InteractionManager.prototype.dispatchEvent=function(displayObject,eventString,eventData){if(!eventData.stopped){eventData.target=displayObject;eventData.type=eventString;displayObject.emit(eventString,eventData);if(displayObject[eventString]){displayObject[eventString](eventData)}}};InteractionManager.prototype.mapPositionToPoint=function(point,x,y){var rect=this.interactionDOMElement.getBoundingClientRect();point.x=(x-rect.left)*(this.interactionDOMElement.width/rect.width)/this.resolution;point.y=(y-rect.top)*(this.interactionDOMElement.height/rect.height)/this.resolution};InteractionManager.prototype.processInteractive=function(point,displayObject,func,hitTest,interactive){if(!displayObject||!displayObject.visible){return false}var hit=false,interactiveParent=interactive=displayObject.interactive||interactive;if(displayObject.hitArea){interactiveParent=false}if(displayObject.interactiveChildren){var children=displayObject.children;for(var i=children.length-1;i>=0;i--){var child=children[i];if(this.processInteractive(point,child,func,hitTest,interactiveParent)){if(!child.parent){continue}hit=true;interactiveParent=false;hitTest=false}}}if(interactive){if(hitTest&&!hit){if(displayObject.hitArea){displayObject.worldTransform.applyInverse(point,this._tempPoint);hit=displayObject.hitArea.contains(this._tempPoint.x,this._tempPoint.y)}else if(displayObject.containsPoint){hit=displayObject.containsPoint(point)}}if(displayObject.interactive){func(displayObject,hit)}}return hit};InteractionManager.prototype.onMouseDown=function(event){this.mouse.originalEvent=event;this.eventData.data=this.mouse;this.eventData.stopped=false;this.mapPositionToPoint(this.mouse.global,event.clientX,event.clientY);if(this.autoPreventDefault){this.mouse.originalEvent.preventDefault()}this.processInteractive(this.mouse.global,this.renderer._lastObjectRendered,this.processMouseDown,true)};InteractionManager.prototype.processMouseDown=function(displayObject,hit){var e=this.mouse.originalEvent;var isRightButton=e.button===2||e.which===3;if(hit){displayObject[isRightButton?"_isRightDown":"_isLeftDown"]=true;this.dispatchEvent(displayObject,isRightButton?"rightdown":"mousedown",this.eventData)}};InteractionManager.prototype.onMouseUp=function(event){this.mouse.originalEvent=event;this.eventData.data=this.mouse;this.eventData.stopped=false;this.mapPositionToPoint(this.mouse.global,event.clientX,event.clientY);this.processInteractive(this.mouse.global,this.renderer._lastObjectRendered,this.processMouseUp,true)};InteractionManager.prototype.processMouseUp=function(displayObject,hit){var e=this.mouse.originalEvent;var isRightButton=e.button===2||e.which===3;var isDown=isRightButton?"_isRightDown":"_isLeftDown";if(hit){this.dispatchEvent(displayObject,isRightButton?"rightup":"mouseup",this.eventData);if(displayObject[isDown]){displayObject[isDown]=false;this.dispatchEvent(displayObject,isRightButton?"rightclick":"click",this.eventData)}}else{if(displayObject[isDown]){displayObject[isDown]=false;this.dispatchEvent(displayObject,isRightButton?"rightupoutside":"mouseupoutside",this.eventData)}}};InteractionManager.prototype.onMouseMove=function(event){this.mouse.originalEvent=event;this.eventData.data=this.mouse;this.eventData.stopped=false;this.mapPositionToPoint(this.mouse.global,event.clientX,event.clientY);this.didMove=true;this.cursor="inherit";this.processInteractive(this.mouse.global,this.renderer._lastObjectRendered,this.processMouseMove,true);if(this.currentCursorStyle!==this.cursor){this.currentCursorStyle=this.cursor;this.interactionDOMElement.style.cursor=this.cursor}};InteractionManager.prototype.processMouseMove=function(displayObject,hit){this.processMouseOverOut(displayObject,hit);if(!this.moveWhenInside||hit){this.dispatchEvent(displayObject,"mousemove",this.eventData)}};InteractionManager.prototype.onMouseOut=function(event){this.mouse.originalEvent=event;this.eventData.stopped=false;this.mapPositionToPoint(this.mouse.global,event.clientX,event.clientY);this.interactionDOMElement.style.cursor="inherit";this.mapPositionToPoint(this.mouse.global,event.clientX,event.clientY);this.processInteractive(this.mouse.global,this.renderer._lastObjectRendered,this.processMouseOverOut,false)};InteractionManager.prototype.processMouseOverOut=function(displayObject,hit){if(hit){if(!displayObject._over){displayObject._over=true;this.dispatchEvent(displayObject,"mouseover",this.eventData)}if(displayObject.buttonMode){this.cursor=displayObject.defaultCursor}}else{if(displayObject._over){displayObject._over=false;this.dispatchEvent(displayObject,"mouseout",this.eventData)}}};InteractionManager.prototype.onTouchStart=function(event){if(this.autoPreventDefault){event.preventDefault()}var changedTouches=event.changedTouches;var cLength=changedTouches.length;for(var i=0;i<cLength;i++){var touchEvent=changedTouches[i];var touchData=this.getTouchData(touchEvent);touchData.originalEvent=event;this.eventData.data=touchData;this.eventData.stopped=false;this.processInteractive(touchData.global,this.renderer._lastObjectRendered,this.processTouchStart,true);this.returnTouchData(touchData)}};InteractionManager.prototype.processTouchStart=function(displayObject,hit){if(hit){displayObject._touchDown=true;this.dispatchEvent(displayObject,"touchstart",this.eventData)}};InteractionManager.prototype.onTouchEnd=function(event){if(this.autoPreventDefault){event.preventDefault()}var changedTouches=event.changedTouches;var cLength=changedTouches.length;for(var i=0;i<cLength;i++){var touchEvent=changedTouches[i];var touchData=this.getTouchData(touchEvent);touchData.originalEvent=event;this.eventData.data=touchData;this.eventData.stopped=false;this.processInteractive(touchData.global,this.renderer._lastObjectRendered,this.processTouchEnd,true);this.returnTouchData(touchData)}};InteractionManager.prototype.processTouchEnd=function(displayObject,hit){if(hit){this.dispatchEvent(displayObject,"touchend",this.eventData);if(displayObject._touchDown){displayObject._touchDown=false;this.dispatchEvent(displayObject,"tap",this.eventData)}}else{if(displayObject._touchDown){displayObject._touchDown=false;this.dispatchEvent(displayObject,"touchendoutside",this.eventData)}}};InteractionManager.prototype.onTouchMove=function(event){if(this.autoPreventDefault){event.preventDefault()}var changedTouches=event.changedTouches;var cLength=changedTouches.length;for(var i=0;i<cLength;i++){var touchEvent=changedTouches[i];var touchData=this.getTouchData(touchEvent);touchData.originalEvent=event;this.eventData.data=touchData;this.eventData.stopped=false;this.processInteractive(touchData.global,this.renderer._lastObjectRendered,this.processTouchMove,this.moveWhenInside);this.returnTouchData(touchData)}};InteractionManager.prototype.processTouchMove=function(displayObject,hit){if(!this.moveWhenInside||hit){this.dispatchEvent(displayObject,"touchmove",this.eventData)}};InteractionManager.prototype.getTouchData=function(touchEvent){var touchData=this.interactiveDataPool.pop();if(!touchData){touchData=new InteractionData}touchData.identifier=touchEvent.identifier;this.mapPositionToPoint(touchData.global,touchEvent.clientX,touchEvent.clientY);if(navigator.isCocoonJS){touchData.global.x=touchData.global.x/this.resolution;touchData.global.y=touchData.global.y/this.resolution}touchEvent.globalX=touchData.global.x;touchEvent.globalY=touchData.global.y;return touchData};InteractionManager.prototype.returnTouchData=function(touchData){this.interactiveDataPool.push(touchData)};InteractionManager.prototype.destroy=function(){this.removeEvents();this.renderer=null;this.mouse=null;this.eventData=null;this.interactiveDataPool=null;this.interactionDOMElement=null;this.onMouseUp=null;this.processMouseUp=null;this.onMouseDown=null;this.processMouseDown=null;this.onMouseMove=null;this.processMouseMove=null;this.onMouseOut=null;this.processMouseOverOut=null;this.onTouchStart=null;this.processTouchStart=null;this.onTouchEnd=null;this.processTouchEnd=null;this.onTouchMove=null;this.processTouchMove=null;this._tempPoint=null};core.WebGLRenderer.registerPlugin("interaction",InteractionManager);core.CanvasRenderer.registerPlugin("interaction",InteractionManager)},{"../core":29,"./InteractionData":116,"./interactiveTarget":119}],118:[function(require,module,exports){module.exports={InteractionData:require("./InteractionData"),InteractionManager:require("./InteractionManager"),interactiveTarget:require("./interactiveTarget")}},{"./InteractionData":116,"./InteractionManager":117,"./interactiveTarget":119}],119:[function(require,module,exports){var interactiveTarget={interactive:false,buttonMode:false,interactiveChildren:true,defaultCursor:"pointer",_over:false,_touchDown:false};module.exports=interactiveTarget},{}],120:[function(require,module,exports){var Resource=require("resource-loader").Resource,core=require("../core"),extras=require("../extras"),path=require("path");function parse(resource,texture){var data={};var info=resource.data.getElementsByTagName("info")[0];var common=resource.data.getElementsByTagName("common")[0];data.font=info.getAttribute("face");data.size=parseInt(info.getAttribute("size"),10);data.lineHeight=parseInt(common.getAttribute("lineHeight"),10);data.chars={};var letters=resource.data.getElementsByTagName("char");for(var i=0;i<letters.length;i++){var charCode=parseInt(letters[i].getAttribute("id"),10);var textureRect=new core.Rectangle(parseInt(letters[i].getAttribute("x"),10)+texture.frame.x,parseInt(letters[i].getAttribute("y"),10)+texture.frame.y,parseInt(letters[i].getAttribute("width"),10),parseInt(letters[i].getAttribute("height"),10));data.chars[charCode]={xOffset:parseInt(letters[i].getAttribute("xoffset"),10),yOffset:parseInt(letters[i].getAttribute("yoffset"),10),xAdvance:parseInt(letters[i].getAttribute("xadvance"),10),kerning:{},texture:new core.Texture(texture.baseTexture,textureRect)}}var kernings=resource.data.getElementsByTagName("kerning");for(i=0;i<kernings.length;i++){var first=parseInt(kernings[i].getAttribute("first"),10);var second=parseInt(kernings[i].getAttribute("second"),10);var amount=parseInt(kernings[i].getAttribute("amount"),10);if(data.chars[second]){data.chars[second].kerning[first]=amount}}resource.bitmapFont=data;extras.BitmapText.fonts[data.font]=data}module.exports=function(){return function(resource,next){if(!resource.data||!resource.isXml){return next()}if(resource.data.getElementsByTagName("page").length===0||resource.data.getElementsByTagName("info").length===0||resource.data.getElementsByTagName("info")[0].getAttribute("face")===null){return next()}var xmlUrl=path.dirname(resource.url);if(xmlUrl==="."){xmlUrl=""}if(this.baseUrl&&xmlUrl){if(this.baseUrl.charAt(this.baseUrl.length-1)==="/"){xmlUrl+="/"}xmlUrl=xmlUrl.replace(this.baseUrl,"")}if(xmlUrl&&xmlUrl.charAt(xmlUrl.length-1)!=="/"){xmlUrl+="/"}var textureUrl=xmlUrl+resource.data.getElementsByTagName("page")[0].getAttribute("file");if(core.utils.TextureCache[textureUrl]){parse(resource,core.utils.TextureCache[textureUrl]);next()}else{var loadOptions={crossOrigin:resource.crossOrigin,loadType:Resource.LOAD_TYPE.IMAGE,metadata:resource.metadata.imageMetadata};this.add(resource.name+"_image",textureUrl,loadOptions,function(res){parse(resource,res.texture);next()})}}}},{"../core":29,"../extras":86,path:2,"resource-loader":16}],121:[function(require,module,exports){module.exports={Loader:require("./loader"),bitmapFontParser:require("./bitmapFontParser"),spritesheetParser:require("./spritesheetParser"),textureParser:require("./textureParser"),Resource:require("resource-loader").Resource}},{"./bitmapFontParser":120,"./loader":122,"./spritesheetParser":123,"./textureParser":124,"resource-loader":16}],122:[function(require,module,exports){var ResourceLoader=require("resource-loader"),textureParser=require("./textureParser"),spritesheetParser=require("./spritesheetParser"),bitmapFontParser=require("./bitmapFontParser");function Loader(baseUrl,concurrency){ResourceLoader.call(this,baseUrl,concurrency);for(var i=0;i<Loader._pixiMiddleware.length;++i){this.use(Loader._pixiMiddleware[i]())}}Loader.prototype=Object.create(ResourceLoader.prototype);Loader.prototype.constructor=Loader;module.exports=Loader;Loader._pixiMiddleware=[ResourceLoader.middleware.parsing.blob,textureParser,spritesheetParser,bitmapFontParser];Loader.addPixiMiddleware=function(fn){Loader._pixiMiddleware.push(fn)};var Resource=ResourceLoader.Resource;Resource.setExtensionXhrType("fnt",Resource.XHR_RESPONSE_TYPE.DOCUMENT)},{"./bitmapFontParser":120,"./spritesheetParser":123,"./textureParser":124,"resource-loader":16}],123:[function(require,module,exports){var Resource=require("resource-loader").Resource,path=require("path"),core=require("../core"),async=require("async");var BATCH_SIZE=1e3;module.exports=function(){return function(resource,next){var imageResourceName=resource.name+"_image";if(!resource.data||!resource.isJson||!resource.data.frames||this.resources[imageResourceName]){return next()}var loadOptions={crossOrigin:resource.crossOrigin,loadType:Resource.LOAD_TYPE.IMAGE,metadata:resource.metadata.imageMetadata};var route=path.dirname(resource.url.replace(this.baseUrl,""));this.add(imageResourceName,route+"/"+resource.data.meta.image,loadOptions,function(res){resource.textures={};var frames=resource.data.frames;var frameKeys=Object.keys(frames);var resolution=core.utils.getResolutionOfUrl(resource.url);var batchIndex=0;function processFrames(initialFrameIndex,maxFrames){var frameIndex=initialFrameIndex;while(frameIndex-initialFrameIndex<maxFrames&&frameIndex<frameKeys.length){var frame=frames[frameKeys[frameIndex]];var rect=frame.frame;if(rect){var size=null;var trim=null;if(frame.rotated){size=new core.Rectangle(rect.x,rect.y,rect.h,rect.w)}else{size=new core.Rectangle(rect.x,rect.y,rect.w,rect.h)}if(frame.trimmed){trim=new core.Rectangle(frame.spriteSourceSize.x/resolution,frame.spriteSourceSize.y/resolution,frame.sourceSize.w/resolution,frame.sourceSize.h/resolution)}if(frame.rotated){var temp=size.width;size.width=size.height;size.height=temp}size.x/=resolution;size.y/=resolution;size.width/=resolution;size.height/=resolution;resource.textures[frameKeys[frameIndex]]=new core.Texture(res.texture.baseTexture,size,size.clone(),trim,frame.rotated);core.utils.TextureCache[frameKeys[frameIndex]]=resource.textures[frameKeys[frameIndex]]}frameIndex++}}function shouldProcessNextBatch(){return batchIndex*BATCH_SIZE<frameKeys.length}function processNextBatch(done){
processFrames(batchIndex*BATCH_SIZE,BATCH_SIZE);batchIndex++;setTimeout(done,0)}if(frameKeys.length<=BATCH_SIZE){processFrames(0,BATCH_SIZE);next()}else{async.whilst(shouldProcessNextBatch,processNextBatch,next)}})}}},{"../core":29,async:1,path:2,"resource-loader":16}],124:[function(require,module,exports){var core=require("../core");module.exports=function(){return function(resource,next){if(resource.data&&resource.isImage){var baseTexture=new core.BaseTexture(resource.data,null,core.utils.getResolutionOfUrl(resource.url));baseTexture.imageUrl=resource.url;resource.texture=new core.Texture(baseTexture);core.utils.BaseTextureCache[resource.url]=baseTexture;core.utils.TextureCache[resource.url]=resource.texture}next()}}},{"../core":29}],125:[function(require,module,exports){var core=require("../core"),tempPoint=new core.Point,tempPolygon=new core.Polygon;function Mesh(texture,vertices,uvs,indices,drawMode){core.Container.call(this);this._texture=null;this.uvs=uvs||new Float32Array([0,0,1,0,1,1,0,1]);this.vertices=vertices||new Float32Array([0,0,100,0,100,100,0,100]);this.indices=indices||new Uint16Array([0,1,3,2]);this.dirty=true;this.blendMode=core.BLEND_MODES.NORMAL;this.canvasPadding=0;this.drawMode=drawMode||Mesh.DRAW_MODES.TRIANGLE_MESH;this.texture=texture;this.shader=null}Mesh.prototype=Object.create(core.Container.prototype);Mesh.prototype.constructor=Mesh;module.exports=Mesh;Object.defineProperties(Mesh.prototype,{texture:{get:function(){return this._texture},set:function(value){if(this._texture===value){return}this._texture=value;if(value){if(value.baseTexture.hasLoaded){this._onTextureUpdate()}else{value.once("update",this._onTextureUpdate,this)}}}}});Mesh.prototype._renderWebGL=function(renderer){renderer.setObjectRenderer(renderer.plugins.mesh);renderer.plugins.mesh.render(this)};Mesh.prototype._renderCanvas=function(renderer){var context=renderer.context;var transform=this.worldTransform;var res=renderer.resolution;if(renderer.roundPixels){context.setTransform(transform.a*res,transform.b*res,transform.c*res,transform.d*res,transform.tx*res|0,transform.ty*res|0)}else{context.setTransform(transform.a*res,transform.b*res,transform.c*res,transform.d*res,transform.tx*res,transform.ty*res)}if(this.drawMode===Mesh.DRAW_MODES.TRIANGLE_MESH){this._renderCanvasTriangleMesh(context)}else{this._renderCanvasTriangles(context)}};Mesh.prototype._renderCanvasTriangleMesh=function(context){var vertices=this.vertices;var uvs=this.uvs;var length=vertices.length/2;for(var i=0;i<length-2;i++){var index=i*2;this._renderCanvasDrawTriangle(context,vertices,uvs,index,index+2,index+4)}};Mesh.prototype._renderCanvasTriangles=function(context){var vertices=this.vertices;var uvs=this.uvs;var indices=this.indices;var length=indices.length;for(var i=0;i<length;i+=3){var index0=indices[i]*2,index1=indices[i+1]*2,index2=indices[i+2]*2;this._renderCanvasDrawTriangle(context,vertices,uvs,index0,index1,index2)}};Mesh.prototype._renderCanvasDrawTriangle=function(context,vertices,uvs,index0,index1,index2){var base=this._texture.baseTexture;var textureSource=base.source;var textureWidth=base.width;var textureHeight=base.height;var x0=vertices[index0],x1=vertices[index1],x2=vertices[index2];var y0=vertices[index0+1],y1=vertices[index1+1],y2=vertices[index2+1];var u0=uvs[index0]*base.width,u1=uvs[index1]*base.width,u2=uvs[index2]*base.width;var v0=uvs[index0+1]*base.height,v1=uvs[index1+1]*base.height,v2=uvs[index2+1]*base.height;if(this.canvasPadding>0){var paddingX=this.canvasPadding/this.worldTransform.a;var paddingY=this.canvasPadding/this.worldTransform.d;var centerX=(x0+x1+x2)/3;var centerY=(y0+y1+y2)/3;var normX=x0-centerX;var normY=y0-centerY;var dist=Math.sqrt(normX*normX+normY*normY);x0=centerX+normX/dist*(dist+paddingX);y0=centerY+normY/dist*(dist+paddingY);normX=x1-centerX;normY=y1-centerY;dist=Math.sqrt(normX*normX+normY*normY);x1=centerX+normX/dist*(dist+paddingX);y1=centerY+normY/dist*(dist+paddingY);normX=x2-centerX;normY=y2-centerY;dist=Math.sqrt(normX*normX+normY*normY);x2=centerX+normX/dist*(dist+paddingX);y2=centerY+normY/dist*(dist+paddingY)}context.save();context.beginPath();context.moveTo(x0,y0);context.lineTo(x1,y1);context.lineTo(x2,y2);context.closePath();context.clip();var delta=u0*v1+v0*u2+u1*v2-v1*u2-v0*u1-u0*v2;var deltaA=x0*v1+v0*x2+x1*v2-v1*x2-v0*x1-x0*v2;var deltaB=u0*x1+x0*u2+u1*x2-x1*u2-x0*u1-u0*x2;var deltaC=u0*v1*x2+v0*x1*u2+x0*u1*v2-x0*v1*u2-v0*u1*x2-u0*x1*v2;var deltaD=y0*v1+v0*y2+y1*v2-v1*y2-v0*y1-y0*v2;var deltaE=u0*y1+y0*u2+u1*y2-y1*u2-y0*u1-u0*y2;var deltaF=u0*v1*y2+v0*y1*u2+y0*u1*v2-y0*v1*u2-v0*u1*y2-u0*y1*v2;context.transform(deltaA/delta,deltaD/delta,deltaB/delta,deltaE/delta,deltaC/delta,deltaF/delta);context.drawImage(textureSource,0,0,textureWidth*base.resolution,textureHeight*base.resolution,0,0,textureWidth,textureHeight);context.restore()};Mesh.prototype.renderMeshFlat=function(Mesh){var context=this.context;var vertices=Mesh.vertices;var length=vertices.length/2;context.beginPath();for(var i=1;i<length-2;i++){var index=i*2;var x0=vertices[index],x1=vertices[index+2],x2=vertices[index+4];var y0=vertices[index+1],y1=vertices[index+3],y2=vertices[index+5];context.moveTo(x0,y0);context.lineTo(x1,y1);context.lineTo(x2,y2)}context.fillStyle="#FF0000";context.fill();context.closePath()};Mesh.prototype._onTextureUpdate=function(){this.updateFrame=true};Mesh.prototype.getBounds=function(matrix){if(!this._currentBounds){var worldTransform=matrix||this.worldTransform;var a=worldTransform.a;var b=worldTransform.b;var c=worldTransform.c;var d=worldTransform.d;var tx=worldTransform.tx;var ty=worldTransform.ty;var maxX=-Infinity;var maxY=-Infinity;var minX=Infinity;var minY=Infinity;var vertices=this.vertices;for(var i=0,n=vertices.length;i<n;i+=2){var rawX=vertices[i],rawY=vertices[i+1];var x=a*rawX+c*rawY+tx;var y=d*rawY+b*rawX+ty;minX=x<minX?x:minX;minY=y<minY?y:minY;maxX=x>maxX?x:maxX;maxY=y>maxY?y:maxY}if(minX===-Infinity||maxY===Infinity){return core.Rectangle.EMPTY}var bounds=this._bounds;bounds.x=minX;bounds.width=maxX-minX;bounds.y=minY;bounds.height=maxY-minY;this._currentBounds=bounds}return this._currentBounds};Mesh.prototype.containsPoint=function(point){if(!this.getBounds().contains(point.x,point.y)){return false}this.worldTransform.applyInverse(point,tempPoint);var vertices=this.vertices;var points=tempPolygon.points;var i,len;if(this.drawMode===Mesh.DRAW_MODES.TRIANGLES){var indices=this.indices;len=this.indices.length;for(i=0;i<len;i+=3){var ind0=indices[i]*2,ind1=indices[i+1]*2,ind2=indices[i+2]*2;points[0]=vertices[ind0];points[1]=vertices[ind0+1];points[2]=vertices[ind1];points[3]=vertices[ind1+1];points[4]=vertices[ind2];points[5]=vertices[ind2+1];if(tempPolygon.contains(tempPoint.x,tempPoint.y)){return true}}}else{len=vertices.length;for(i=0;i<len;i+=6){points[0]=vertices[i];points[1]=vertices[i+1];points[2]=vertices[i+2];points[3]=vertices[i+3];points[4]=vertices[i+4];points[5]=vertices[i+5];if(tempPolygon.contains(tempPoint.x,tempPoint.y)){return true}}}return false};Mesh.DRAW_MODES={TRIANGLE_MESH:0,TRIANGLES:1}},{"../core":29}],126:[function(require,module,exports){var Mesh=require("./Mesh");function Plane(texture,segmentsX,segmentsY){Mesh.call(this,texture);this._ready=true;this.segmentsX=segmentsX||10;this.segmentsY=segmentsY||10;this.drawMode=Mesh.DRAW_MODES.TRIANGLES;this.refresh()}Plane.prototype=Object.create(Mesh.prototype);Plane.prototype.constructor=Plane;module.exports=Plane;Plane.prototype.refresh=function(){var total=this.segmentsX*this.segmentsY;var verts=[];var colors=[];var uvs=[];var indices=[];var texture=this.texture;var segmentsXSub=this.segmentsX-1;var segmentsYSub=this.segmentsY-1;var i=0;var sizeX=texture.width/segmentsXSub;var sizeY=texture.height/segmentsYSub;for(i=0;i<total;i++){var x=i%this.segmentsX;var y=i/this.segmentsX|0;verts.push(x*sizeX,y*sizeY);uvs.push(texture._uvs.x0+(texture._uvs.x1-texture._uvs.x0)*(x/(this.segmentsX-1)),texture._uvs.y0+(texture._uvs.y3-texture._uvs.y0)*(y/(this.segmentsY-1)))}var totalSub=segmentsXSub*segmentsYSub;for(i=0;i<totalSub;i++){var xpos=i%segmentsXSub;var ypos=i/segmentsXSub|0;var value=ypos*this.segmentsX+xpos;var value2=ypos*this.segmentsX+xpos+1;var value3=(ypos+1)*this.segmentsX+xpos;var value4=(ypos+1)*this.segmentsX+xpos+1;indices.push(value,value2,value3);indices.push(value2,value4,value3)}this.vertices=new Float32Array(verts);this.uvs=new Float32Array(uvs);this.colors=new Float32Array(colors);this.indices=new Uint16Array(indices)};Plane.prototype._onTextureUpdate=function(){Mesh.prototype._onTextureUpdate.call(this);if(this._ready){this.refresh()}}},{"./Mesh":125}],127:[function(require,module,exports){var Mesh=require("./Mesh");var core=require("../core");function Rope(texture,points){Mesh.call(this,texture);this.points=points;this.vertices=new Float32Array(points.length*4);this.uvs=new Float32Array(points.length*4);this.colors=new Float32Array(points.length*2);this.indices=new Uint16Array(points.length*2);this._ready=true;this.refresh()}Rope.prototype=Object.create(Mesh.prototype);Rope.prototype.constructor=Rope;module.exports=Rope;Rope.prototype.refresh=function(){var points=this.points;if(points.length<1||!this._texture._uvs){return}var uvs=this.uvs;var indices=this.indices;var colors=this.colors;var textureUvs=this._texture._uvs;var offset=new core.Point(textureUvs.x0,textureUvs.y0);var factor=new core.Point(textureUvs.x2-textureUvs.x0,textureUvs.y2-textureUvs.y0);uvs[0]=0+offset.x;uvs[1]=0+offset.y;uvs[2]=0+offset.x;uvs[3]=1*factor.y+offset.y;colors[0]=1;colors[1]=1;indices[0]=0;indices[1]=1;var total=points.length,point,index,amount;for(var i=1;i<total;i++){point=points[i];index=i*4;amount=i/(total-1);uvs[index]=amount*factor.x+offset.x;uvs[index+1]=0+offset.y;uvs[index+2]=amount*factor.x+offset.x;uvs[index+3]=1*factor.y+offset.y;index=i*2;colors[index]=1;colors[index+1]=1;index=i*2;indices[index]=index;indices[index+1]=index+1}this.dirty=true};Rope.prototype._onTextureUpdate=function(){Mesh.prototype._onTextureUpdate.call(this);if(this._ready){this.refresh()}};Rope.prototype.updateTransform=function(){var points=this.points;if(points.length<1){return}var lastPoint=points[0];var nextPoint;var perpX=0;var perpY=0;var vertices=this.vertices;var total=points.length,point,index,ratio,perpLength,num;for(var i=0;i<total;i++){point=points[i];index=i*4;if(i<points.length-1){nextPoint=points[i+1]}else{nextPoint=point}perpY=-(nextPoint.x-lastPoint.x);perpX=nextPoint.y-lastPoint.y;ratio=(1-i/(total-1))*10;if(ratio>1){ratio=1}perpLength=Math.sqrt(perpX*perpX+perpY*perpY);num=this._texture.height/2;perpX/=perpLength;perpY/=perpLength;perpX*=num;perpY*=num;vertices[index]=point.x+perpX;vertices[index+1]=point.y+perpY;vertices[index+2]=point.x-perpX;vertices[index+3]=point.y-perpY;lastPoint=point}this.containerUpdateTransform()}},{"../core":29,"./Mesh":125}],128:[function(require,module,exports){module.exports={Mesh:require("./Mesh"),Plane:require("./Plane"),Rope:require("./Rope"),MeshRenderer:require("./webgl/MeshRenderer"),MeshShader:require("./webgl/MeshShader")}},{"./Mesh":125,"./Plane":126,"./Rope":127,"./webgl/MeshRenderer":129,"./webgl/MeshShader":130}],129:[function(require,module,exports){var core=require("../../core"),Mesh=require("../Mesh");function MeshRenderer(renderer){core.ObjectRenderer.call(this,renderer);this.indices=new Uint16Array(15e3);for(var i=0,j=0;i<15e3;i+=6,j+=4){this.indices[i+0]=j+0;this.indices[i+1]=j+1;this.indices[i+2]=j+2;this.indices[i+3]=j+0;this.indices[i+4]=j+2;this.indices[i+5]=j+3}this.currentShader=null}MeshRenderer.prototype=Object.create(core.ObjectRenderer.prototype);MeshRenderer.prototype.constructor=MeshRenderer;module.exports=MeshRenderer;core.WebGLRenderer.registerPlugin("mesh",MeshRenderer);MeshRenderer.prototype.onContextChange=function(){};MeshRenderer.prototype.render=function(mesh){if(!mesh._vertexBuffer){this._initWebGL(mesh)}var renderer=this.renderer,gl=renderer.gl,texture=mesh._texture.baseTexture,shader=mesh.shader;var drawMode=mesh.drawMode===Mesh.DRAW_MODES.TRIANGLE_MESH?gl.TRIANGLE_STRIP:gl.TRIANGLES;renderer.blendModeManager.setBlendMode(mesh.blendMode);if(!shader){shader=renderer.shaderManager.plugins.meshShader}else{shader=shader.shaders[gl.id]||shader.getShader(renderer)}this.renderer.shaderManager.setShader(shader);shader.uniforms.translationMatrix.value=mesh.worldTransform.toArray(true);shader.uniforms.projectionMatrix.value=renderer.currentRenderTarget.projectionMatrix.toArray(true);shader.uniforms.alpha.value=mesh.worldAlpha;shader.syncUniforms();if(!mesh.dirty){gl.bindBuffer(gl.ARRAY_BUFFER,mesh._vertexBuffer);gl.bufferSubData(gl.ARRAY_BUFFER,0,mesh.vertices);gl.vertexAttribPointer(shader.attributes.aVertexPosition,2,gl.FLOAT,false,0,0);gl.bindBuffer(gl.ARRAY_BUFFER,mesh._uvBuffer);gl.vertexAttribPointer(shader.attributes.aTextureCoord,2,gl.FLOAT,false,0,0);gl.activeTexture(gl.TEXTURE0);if(!texture._glTextures[gl.id]){this.renderer.updateTexture(texture)}else{gl.bindTexture(gl.TEXTURE_2D,texture._glTextures[gl.id])}gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,mesh._indexBuffer);gl.bufferSubData(gl.ELEMENT_ARRAY_BUFFER,0,mesh.indices)}else{mesh.dirty=false;gl.bindBuffer(gl.ARRAY_BUFFER,mesh._vertexBuffer);gl.bufferData(gl.ARRAY_BUFFER,mesh.vertices,gl.STATIC_DRAW);gl.vertexAttribPointer(shader.attributes.aVertexPosition,2,gl.FLOAT,false,0,0);gl.bindBuffer(gl.ARRAY_BUFFER,mesh._uvBuffer);gl.bufferData(gl.ARRAY_BUFFER,mesh.uvs,gl.STATIC_DRAW);gl.vertexAttribPointer(shader.attributes.aTextureCoord,2,gl.FLOAT,false,0,0);gl.activeTexture(gl.TEXTURE0);if(!texture._glTextures[gl.id]){this.renderer.updateTexture(texture)}else{gl.bindTexture(gl.TEXTURE_2D,texture._glTextures[gl.id])}gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,mesh._indexBuffer);gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,mesh.indices,gl.STATIC_DRAW)}gl.drawElements(drawMode,mesh.indices.length,gl.UNSIGNED_SHORT,0)};MeshRenderer.prototype._initWebGL=function(mesh){var gl=this.renderer.gl;mesh._vertexBuffer=gl.createBuffer();mesh._indexBuffer=gl.createBuffer();mesh._uvBuffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,mesh._vertexBuffer);gl.bufferData(gl.ARRAY_BUFFER,mesh.vertices,gl.DYNAMIC_DRAW);gl.bindBuffer(gl.ARRAY_BUFFER,mesh._uvBuffer);gl.bufferData(gl.ARRAY_BUFFER,mesh.uvs,gl.STATIC_DRAW);if(mesh.colors){mesh._colorBuffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,mesh._colorBuffer);gl.bufferData(gl.ARRAY_BUFFER,mesh.colors,gl.STATIC_DRAW)}gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,mesh._indexBuffer);gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,mesh.indices,gl.STATIC_DRAW)};MeshRenderer.prototype.flush=function(){};MeshRenderer.prototype.start=function(){this.currentShader=null};MeshRenderer.prototype.destroy=function(){core.ObjectRenderer.prototype.destroy.call(this)}},{"../../core":29,"../Mesh":125}],130:[function(require,module,exports){var core=require("../../core");function MeshShader(shaderManager){core.Shader.call(this,shaderManager,["precision lowp float;","attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 translationMatrix;","uniform mat3 projectionMatrix;","varying vec2 vTextureCoord;","void main(void){","   gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);","   vTextureCoord = aTextureCoord;","}"].join("\n"),["precision lowp float;","varying vec2 vTextureCoord;","uniform float alpha;","uniform sampler2D uSampler;","void main(void){","   gl_FragColor = texture2D(uSampler, vTextureCoord) * alpha ;","}"].join("\n"),{alpha:{type:"1f",value:0},translationMatrix:{type:"mat3",value:new Float32Array(9)},projectionMatrix:{type:"mat3",value:new Float32Array(9)}},{aVertexPosition:0,aTextureCoord:0})}MeshShader.prototype=Object.create(core.Shader.prototype);MeshShader.prototype.constructor=MeshShader;module.exports=MeshShader;core.ShaderManager.registerPlugin("meshShader",MeshShader)},{"../../core":29}],131:[function(require,module,exports){if(!Math.sign){Math.sign=function(x){x=+x;if(x===0||isNaN(x)){return x}return x>0?1:-1}}},{}],132:[function(require,module,exports){if(!Object.assign){Object.assign=require("object-assign")}},{"object-assign":11}],133:[function(require,module,exports){require("./Object.assign");require("./requestAnimationFrame");require("./Math.sign")},{"./Math.sign":131,"./Object.assign":132,"./requestAnimationFrame":134}],134:[function(require,module,exports){(function(global){if(!(Date.now&&Date.prototype.getTime)){Date.now=function now(){return(new Date).getTime()}}if(!(global.performance&&global.performance.now)){var startTime=Date.now();if(!global.performance){global.performance={}}global.performance.now=function(){return Date.now()-startTime}}var lastTime=Date.now();var vendors=["ms","moz","webkit","o"];for(var x=0;x<vendors.length&&!global.requestAnimationFrame;++x){global.requestAnimationFrame=global[vendors[x]+"RequestAnimationFrame"];global.cancelAnimationFrame=global[vendors[x]+"CancelAnimationFrame"]||global[vendors[x]+"CancelRequestAnimationFrame"]}if(!global.requestAnimationFrame){global.requestAnimationFrame=function(callback){if(typeof callback!=="function"){throw new TypeError(callback+"is not a function")}var currentTime=Date.now(),delay=16+lastTime-currentTime;if(delay<0){delay=0}lastTime=currentTime;return setTimeout(function(){lastTime=Date.now();callback(performance.now())},delay)}}if(!global.cancelAnimationFrame){global.cancelAnimationFrame=function(id){clearTimeout(id)}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}]},{},[115])(115)});(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){module.exports=PIXI.spine={Spine:require("./Spine"),SpineRuntime:require("./SpineRuntime"),loaders:require("./loaders")}},{"./Spine":43,"./SpineRuntime":41,"./loaders":47}],2:[function(require,module,exports){var spine=require("../SpineUtil");spine.Animation=function(name,timelines,duration){this.name=name;this.timelines=timelines;this.duration=duration};spine.Animation.prototype={apply:function(skeleton,lastTime,time,loop,events){if(loop&&this.duration!=0){time%=this.duration;lastTime%=this.duration}var timelines=this.timelines;for(var i=0,n=timelines.length;i<n;i++)timelines[i].apply(skeleton,lastTime,time,events,1)},mix:function(skeleton,lastTime,time,loop,events,alpha){if(loop&&this.duration!=0){time%=this.duration;lastTime%=this.duration}var timelines=this.timelines;for(var i=0,n=timelines.length;i<n;i++)timelines[i].apply(skeleton,lastTime,time,events,alpha)}};spine.Animation.binarySearch=function(values,target,step){var low=0;var high=Math.floor(values.length/step)-2;if(!high)return step;var current=high>>>1;while(true){if(values[(current+1)*step]<=target)low=current+1;else high=current;if(low==high)return(low+1)*step;current=low+high>>>1}};spine.Animation.binarySearch1=function(values,target){var low=0;var high=values.length-2;if(!high)return 1;var current=high>>>1;while(true){if(values[current+1]<=target)low=current+1;else high=current;if(low==high)return low+1;current=low+high>>>1}};spine.Animation.linearSearch=function(values,target,step){for(var i=0,last=values.length-step;i<=last;i+=step)if(values[i]>target)return i;return-1};module.exports=spine.Animation},{"../SpineUtil":42}],3:[function(require,module,exports){var spine=require("../SpineUtil");spine.TrackEntry=require("./TrackEntry");spine.AnimationState=function(stateData){this.data=stateData;this.tracks=[];this.events=[]};spine.AnimationState.prototype={onStart:null,onEnd:null,onComplete:null,onEvent:null,timeScale:1,update:function(delta){delta*=this.timeScale;for(var i=0;i<this.tracks.length;i++){var current=this.tracks[i];if(!current)continue;current.time+=delta*current.timeScale;if(current.previous){var previousDelta=delta*current.previous.timeScale;current.previous.time+=previousDelta;current.mixTime+=previousDelta}var next=current.next;if(next){next.time=current.lastTime-next.delay;if(next.time>=0)this.setCurrent(i,next)}else{if(!current.loop&&current.lastTime>=current.endTime)this.clearTrack(i)}}},apply:function(skeleton){skeleton.resetDrawOrder();for(var i=0;i<this.tracks.length;i++){var current=this.tracks[i];if(!current)continue;this.events.length=0;var time=current.time;var lastTime=current.lastTime;var endTime=current.endTime;var loop=current.loop;if(!loop&&time>endTime)time=endTime;var previous=current.previous;if(!previous){if(current.mix==1)current.animation.apply(skeleton,current.lastTime,time,loop,this.events);else current.animation.mix(skeleton,current.lastTime,time,loop,this.events,current.mix)}else{var previousTime=previous.time;if(!previous.loop&&previousTime>previous.endTime)previousTime=previous.endTime;previous.animation.apply(skeleton,previousTime,previousTime,previous.loop,null);var alpha=current.mixTime/current.mixDuration*current.mix;if(alpha>=1){alpha=1;current.previous=null}current.animation.mix(skeleton,current.lastTime,time,loop,this.events,alpha)}for(var ii=0,nn=this.events.length;ii<nn;ii++){var event=this.events[ii];if(current.onEvent)current.onEvent(i,event);if(this.onEvent)this.onEvent(i,event)}if(loop?lastTime%endTime>time%endTime:lastTime<endTime&&time>=endTime){var count=Math.floor(time/endTime);if(current.onComplete)current.onComplete(i,count);if(this.onComplete)this.onComplete(i,count)}current.lastTime=current.time}},clearTracks:function(){for(var i=0,n=this.tracks.length;i<n;i++)this.clearTrack(i);this.tracks.length=0},clearTrack:function(trackIndex){if(trackIndex>=this.tracks.length)return;var current=this.tracks[trackIndex];if(!current)return;if(current.onEnd)current.onEnd(trackIndex);if(this.onEnd)this.onEnd(trackIndex);this.tracks[trackIndex]=null},_expandToIndex:function(index){if(index<this.tracks.length)return this.tracks[index];while(index>=this.tracks.length)this.tracks.push(null);return null},setCurrent:function(index,entry){var current=this._expandToIndex(index);if(current){var previous=current.previous;current.previous=null;if(current.onEnd)current.onEnd(index);if(this.onEnd)this.onEnd(index);entry.mixDuration=this.data.getMix(current.animation,entry.animation);if(entry.mixDuration>0){entry.mixTime=0;if(previous&&current.mixTime/current.mixDuration<.5)entry.previous=previous;else entry.previous=current}}this.tracks[index]=entry;if(entry.onStart)entry.onStart(index);if(this.onStart)this.onStart(index)},setAnimationByName:function(trackIndex,animationName,loop){var animation=this.data.skeletonData.findAnimation(animationName);if(!animation)throw"Animation not found: "+animationName;return this.setAnimation(trackIndex,animation,loop)},setAnimation:function(trackIndex,animation,loop){var entry=new spine.TrackEntry;entry.animation=animation;entry.loop=loop;entry.endTime=animation.duration;this.setCurrent(trackIndex,entry);return entry},addAnimationByName:function(trackIndex,animationName,loop,delay){var animation=this.data.skeletonData.findAnimation(animationName);if(!animation)throw"Animation not found: "+animationName;return this.addAnimation(trackIndex,animation,loop,delay)},addAnimation:function(trackIndex,animation,loop,delay){var entry=new spine.TrackEntry;entry.animation=animation;entry.loop=loop;entry.endTime=animation.duration;var last=this._expandToIndex(trackIndex);if(last){while(last.next)last=last.next;last.next=entry}else this.tracks[trackIndex]=entry;if(delay<=0){if(last)delay+=last.endTime-this.data.getMix(last.animation,animation);else delay=0}entry.delay=delay;return entry},getCurrent:function(trackIndex){if(trackIndex>=this.tracks.length)return null;return this.tracks[trackIndex]}};module.exports=spine.AnimationState},{"../SpineUtil":42,"./TrackEntry":39}],4:[function(require,module,exports){var spine=require("../SpineUtil");spine.AnimationStateData=function(skeletonData){this.skeletonData=skeletonData;this.animationToMixTime={}};spine.AnimationStateData.prototype={defaultMix:0,setMixByName:function(fromName,toName,duration){var from=this.skeletonData.findAnimation(fromName);if(!from)throw"Animation not found: "+fromName;var to=this.skeletonData.findAnimation(toName);if(!to)throw"Animation not found: "+toName;this.setMix(from,to,duration)},setMix:function(from,to,duration){this.animationToMixTime[from.name+":"+to.name]=duration},getMix:function(from,to){var key=from.name+":"+to.name;return this.animationToMixTime.hasOwnProperty(key)?this.animationToMixTime[key]:this.defaultMix}};module.exports=spine.AnimationStateData},{"../SpineUtil":42}],5:[function(require,module,exports){var spine=require("../SpineUtil");spine.AtlasReader=require("./AtlasReader");spine.AtlasPage=require("./AtlasPage");spine.AtlasRegion=require("./AtlasRegion");var syncImageLoaderAdapter=require("../loaders/syncImageLoaderAdapter.js");spine.Atlas=function(atlasText,loaderFunction,callback){if(typeof loaderFunction!=="function"){var baseUrl=loaderFunction;var crossOrigin=callback;loaderFunction=syncImageLoaderAdapter(baseUrl,crossOrigin);callback=null}this.pages=[];this.regions=[];this.texturesLoading=0;var self=this;var reader=new spine.AtlasReader(atlasText);var tuple=[];tuple.length=4;var page=null;iterateParser();function iterateParser(){while(true){var line=reader.readLine();if(line===null){return callback&&callback(self)}line=reader.trim(line);if(!line.length)page=null;else if(!page){page=new spine.AtlasPage;page.name=line;if(reader.readTuple(tuple)==2){page.width=parseInt(tuple[0]);page.height=parseInt(tuple[1]);reader.readTuple(tuple)}else{}page.format=spine.Atlas.Format[tuple[0]];reader.readTuple(tuple);page.minFilter=spine.Atlas.TextureFilter[tuple[0]];page.magFilter=spine.Atlas.TextureFilter[tuple[1]];var direction=reader.readValue();page.uWrap=spine.Atlas.TextureWrap.clampToEdge;page.vWrap=spine.Atlas.TextureWrap.clampToEdge;if(direction=="x")page.uWrap=spine.Atlas.TextureWrap.repeat;else if(direction=="y")page.vWrap=spine.Atlas.TextureWrap.repeat;else if(direction=="xy")page.uWrap=page.vWrap=spine.Atlas.TextureWrap.repeat;loaderFunction(line,function(texture){page.rendererObject=texture;self.pages.push(page);if(!page.width||!page.height){page.width=texture.width;page.height=texture.height;if(!page.width||!page.height){console.log("ERROR spine atlas page "+page.name+": meshes wont work if you dont specify size in atlas (http://www.html5gamedevs.com/topic/18888-pixi-spines-and-meshes/?p=107121)")}}iterateParser()});break}else{var region=new spine.AtlasRegion;region.name=line;region.page=page;region.rotate=reader.readValue()=="true";reader.readTuple(tuple);var x=parseInt(tuple[0]);var y=parseInt(tuple[1]);reader.readTuple(tuple);var width=parseInt(tuple[0]);var height=parseInt(tuple[1]);region.u=x/page.width;region.v=y/page.height;if(region.rotate){region.u2=(x+height)/page.width;region.v2=(y+width)/page.height}else{region.u2=(x+width)/page.width;region.v2=(y+height)/page.height}var resolution=page.rendererObject.resolution;region.x=x/resolution;region.y=y/resolution;region.width=Math.abs(width)/resolution;region.height=Math.abs(height)/resolution;if(reader.readTuple(tuple)==4){region.splits=[parseInt(tuple[0]),parseInt(tuple[1]),parseInt(tuple[2]),parseInt(tuple[3])];if(reader.readTuple(tuple)==4){region.pads=[parseInt(tuple[0]),parseInt(tuple[1]),parseInt(tuple[2]),parseInt(tuple[3])];reader.readTuple(tuple)}}region.originalWidth=parseInt(tuple[0])/resolution;region.originalHeight=parseInt(tuple[1])/resolution;reader.readTuple(tuple);region.offsetX=parseInt(tuple[0])/resolution;region.offsetY=parseInt(tuple[1])/resolution;region.index=parseInt(reader.readValue());self.regions.push(region)}}}};spine.Atlas.prototype={findRegion:function(name){var regions=this.regions;for(var i=0,n=regions.length;i<n;i++)if(regions[i].name==name)return regions[i];return null},dispose:function(){var pages=this.pages;for(var i=0,n=pages.length;i<n;i++)pages[i].rendererObject.destroy(true)},updateUVs:function(page){var regions=this.regions;for(var i=0,n=regions.length;i<n;i++){var region=regions[i];if(region.page!=page)continue;region.u=region.x/page.width;region.v=region.y/page.height;if(region.rotate){region.u2=(region.x+region.height)/page.width;region.v2=(region.y+region.width)/page.height}else{region.u2=(region.x+region.width)/page.width;region.v2=(region.y+region.height)/page.height}}}};spine.Atlas.Format={alpha:0,intensity:1,luminanceAlpha:2,rgb565:3,rgba4444:4,rgb888:5,rgba8888:6};spine.Atlas.TextureFilter={nearest:0,linear:1,mipMap:2,mipMapNearestNearest:3,mipMapLinearNearest:4,mipMapNearestLinear:5,mipMapLinearLinear:6};spine.Atlas.TextureWrap={mirroredRepeat:0,clampToEdge:1,repeat:2};module.exports=spine.Atlas},{"../SpineUtil":42,"../loaders/syncImageLoaderAdapter.js":48,"./AtlasPage":7,"./AtlasReader":8,"./AtlasRegion":9}],6:[function(require,module,exports){var spine=require("../SpineUtil");spine.RegionAttachment=require("./RegionAttachment");spine.MeshAttachment=require("./MeshAttachment");spine.SkinnedMeshAttachment=require("./SkinnedMeshAttachment");spine.BoundingBoxAttachment=require("./BoundingBoxAttachment");spine.AtlasAttachmentParser=function(atlas){this.atlas=atlas};spine.AtlasAttachmentParser.prototype={newRegionAttachment:function(skin,name,path){var region=this.atlas.findRegion(path);if(!region)throw"Region not found in atlas: "+path+" (region attachment: "+name+")";var attachment=new spine.RegionAttachment(name);attachment.rendererObject=region;attachment.setUVs(region.u,region.v,region.u2,region.v2,region.rotate);attachment.regionOffsetX=region.offsetX;attachment.regionOffsetY=region.offsetY;attachment.regionWidth=region.width;attachment.regionHeight=region.height;attachment.regionOriginalWidth=region.originalWidth;attachment.regionOriginalHeight=region.originalHeight;return attachment},newMeshAttachment:function(skin,name,path){var region=this.atlas.findRegion(path);if(!region)throw"Region not found in atlas: "+path+" (mesh attachment: "+name+")";var attachment=new spine.MeshAttachment(name);attachment.rendererObject=region;attachment.regionU=region.u;attachment.regionV=region.v;attachment.regionU2=region.u2;attachment.regionV2=region.v2;attachment.regionRotate=region.rotate;attachment.regionOffsetX=region.offsetX;attachment.regionOffsetY=region.offsetY;attachment.regionWidth=region.width;attachment.regionHeight=region.height;attachment.regionOriginalWidth=region.originalWidth;attachment.regionOriginalHeight=region.originalHeight;return attachment},newSkinnedMeshAttachment:function(skin,name,path){var region=this.atlas.findRegion(path);if(!region)throw"Region not found in atlas: "+path+" (skinned mesh attachment: "+name+")";var attachment=new spine.SkinnedMeshAttachment(name);attachment.rendererObject=region;attachment.regionU=region.u;attachment.regionV=region.v;attachment.regionU2=region.u2;attachment.regionV2=region.v2;attachment.regionRotate=region.rotate;attachment.regionOffsetX=region.offsetX;attachment.regionOffsetY=region.offsetY;attachment.regionWidth=region.width;attachment.regionHeight=region.height;attachment.regionOriginalWidth=region.originalWidth;attachment.regionOriginalHeight=region.originalHeight;return attachment},newBoundingBoxAttachment:function(skin,name){return new spine.BoundingBoxAttachment(name)}};module.exports=spine.AtlasAttachmentParser},{"../SpineUtil":42,"./BoundingBoxAttachment":14,"./MeshAttachment":27,"./RegionAttachment":28,"./SkinnedMeshAttachment":36}],7:[function(require,module,exports){var spine=require("../SpineUtil");spine.AtlasPage=function(){};spine.AtlasPage.prototype={name:null,format:null,minFilter:null,magFilter:null,uWrap:null,vWrap:null,rendererObject:null,width:0,height:0};module.exports=spine.AtlasPage},{
"../SpineUtil":42}],8:[function(require,module,exports){var spine=require("../SpineUtil");spine.AtlasReader=function(text){this.lines=text.split(/\r\n|\r|\n/)};spine.AtlasReader.prototype={index:0,trim:function(value){return value.replace(/^\s+|\s+$/g,"")},readLine:function(){if(this.index>=this.lines.length)return null;return this.lines[this.index++]},readValue:function(){var line=this.readLine();var colon=line.indexOf(":");if(colon==-1)throw"Invalid line: "+line;return this.trim(line.substring(colon+1))},readTuple:function(tuple){var line=this.readLine();var colon=line.indexOf(":");if(colon==-1)throw"Invalid line: "+line;var i=0,lastMatch=colon+1;for(;i<3;i++){var comma=line.indexOf(",",lastMatch);if(comma==-1)break;tuple[i]=this.trim(line.substr(lastMatch,comma-lastMatch));lastMatch=comma+1}tuple[i]=this.trim(line.substring(lastMatch));return i+1}};module.exports=spine.AtlasReader},{"../SpineUtil":42}],9:[function(require,module,exports){var spine=require("../SpineUtil");spine.AtlasRegion=function(){};spine.AtlasRegion.prototype={page:null,name:null,x:0,y:0,width:0,height:0,u:0,v:0,u2:0,v2:0,offsetX:0,offsetY:0,originalWidth:0,originalHeight:0,index:0,rotate:false,splits:null,pads:null};module.exports=spine.AtlasRegion},{"../SpineUtil":42}],10:[function(require,module,exports){var spine=require("../SpineUtil");spine.Curves=require("./Curves");spine.Animation=require("./Animation");spine.AttachmentTimeline=function(frameCount){this.curves=new spine.Curves(frameCount);this.frames=[];this.frames.length=frameCount;this.attachmentNames=[];this.attachmentNames.length=frameCount};spine.AttachmentTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length},setFrame:function(frameIndex,time,attachmentName){this.frames[frameIndex]=time;this.attachmentNames[frameIndex]=attachmentName},apply:function(skeleton,lastTime,time,firedEvents,alpha){var frames=this.frames;if(time<frames[0]){if(lastTime>time)this.apply(skeleton,lastTime,Number.MAX_VALUE,null,0);return}else if(lastTime>time)lastTime=-1;var frameIndex=time>=frames[frames.length-1]?frames.length-1:spine.Animation.binarySearch1(frames,time)-1;if(frames[frameIndex]<lastTime)return;var attachmentName=this.attachmentNames[frameIndex];skeleton.slots[this.slotIndex].setAttachment(!attachmentName?null:skeleton.getAttachmentBySlotIndex(this.slotIndex,attachmentName))}};module.exports=spine.AttachmentTimeline},{"../SpineUtil":42,"./Animation":2,"./Curves":16}],11:[function(require,module,exports){var spine=require("../SpineUtil");spine.AttachmentType={region:0,boundingbox:1,mesh:2,skinnedmesh:3};module.exports=spine.AttachmentType},{"../SpineUtil":42}],12:[function(require,module,exports){var spine=require("../SpineUtil");spine.Bone=function(boneData,skeleton,parent){this.data=boneData;this.skeleton=skeleton;this.parent=parent;this.setToSetupPose()};spine.Bone.yDown=false;spine.Bone.prototype={x:0,y:0,rotation:0,rotationIK:0,scaleX:1,scaleY:1,flipX:false,flipY:false,m00:0,m01:0,worldX:0,m10:0,m11:0,worldY:0,worldRotation:0,worldScaleX:1,worldScaleY:1,worldFlipX:false,worldFlipY:false,updateWorldTransform:function(){var parent=this.parent;if(parent){this.worldX=this.x*parent.m00+this.y*parent.m01+parent.worldX;this.worldY=this.x*parent.m10+this.y*parent.m11+parent.worldY;if(this.data.inheritScale){this.worldScaleX=parent.worldScaleX*this.scaleX;this.worldScaleY=parent.worldScaleY*this.scaleY}else{this.worldScaleX=this.scaleX;this.worldScaleY=this.scaleY}this.worldRotation=this.data.inheritRotation?parent.worldRotation+this.rotationIK:this.rotationIK;this.worldFlipX=parent.worldFlipX!=this.flipX;this.worldFlipY=parent.worldFlipY!=this.flipY}else{var skeletonFlipX=this.skeleton.flipX,skeletonFlipY=this.skeleton.flipY;this.worldX=skeletonFlipX?-this.x:this.x;this.worldY=skeletonFlipY!=spine.Bone.yDown?-this.y:this.y;this.worldScaleX=this.scaleX;this.worldScaleY=this.scaleY;this.worldRotation=this.rotationIK;this.worldFlipX=skeletonFlipX!=this.flipX;this.worldFlipY=skeletonFlipY!=this.flipY}var radians=this.worldRotation*spine.degRad;var cos=Math.cos(radians);var sin=Math.sin(radians);if(this.worldFlipX){this.m00=-cos*this.worldScaleX;this.m01=sin*this.worldScaleY}else{this.m00=cos*this.worldScaleX;this.m01=-sin*this.worldScaleY}if(this.worldFlipY!=spine.Bone.yDown){this.m10=-sin*this.worldScaleX;this.m11=-cos*this.worldScaleY}else{this.m10=sin*this.worldScaleX;this.m11=cos*this.worldScaleY}},setToSetupPose:function(){var data=this.data;this.x=data.x;this.y=data.y;this.rotation=data.rotation;this.rotationIK=this.rotation;this.scaleX=data.scaleX;this.scaleY=data.scaleY;this.flipX=data.flipX;this.flipY=data.flipY},worldToLocal:function(world){var dx=world[0]-this.worldX,dy=world[1]-this.worldY;var m00=this.m00,m10=this.m10,m01=this.m01,m11=this.m11;if(this.worldFlipX!=(this.worldFlipY!=spine.Bone.yDown)){m00=-m00;m11=-m11}var invDet=1/(m00*m11-m01*m10);world[0]=dx*m00*invDet-dy*m01*invDet;world[1]=dy*m11*invDet-dx*m10*invDet},localToWorld:function(local){var localX=local[0],localY=local[1];local[0]=localX*this.m00+localY*this.m01+this.worldX;local[1]=localX*this.m10+localY*this.m11+this.worldY}};module.exports=spine.Bone},{"../SpineUtil":42}],13:[function(require,module,exports){var spine=require("../SpineUtil");spine.BoneData=function(name,parent){this.name=name;this.parent=parent};spine.BoneData.prototype={length:0,x:0,y:0,rotation:0,scaleX:1,scaleY:1,inheritScale:true,inheritRotation:true,flipX:false,flipY:false};module.exports=spine.BoneData},{"../SpineUtil":42}],14:[function(require,module,exports){var spine=require("../SpineUtil");spine.AttachmentType=require("./AttachmentType");spine.BoundingBoxAttachment=function(name){this.name=name;this.vertices=[]};spine.BoundingBoxAttachment.prototype={type:spine.AttachmentType.boundingbox,computeWorldVertices:function(x,y,bone,worldVertices){x+=bone.worldX;y+=bone.worldY;var m00=bone.m00,m01=bone.m01,m10=bone.m10,m11=bone.m11;var vertices=this.vertices;for(var i=0,n=vertices.length;i<n;i+=2){var px=vertices[i];var py=vertices[i+1];worldVertices[i]=px*m00+py*m01+x;worldVertices[i+1]=px*m10+py*m11+y}}};module.exports=spine.BoundingBoxAttachment},{"../SpineUtil":42,"./AttachmentType":11}],15:[function(require,module,exports){var spine=require("../SpineUtil");spine.Animation=require("./Animation");spine.Curves=require("./Curves");spine.ColorTimeline=function(frameCount){this.curves=new spine.Curves(frameCount);this.frames=[];this.frames.length=frameCount*5};spine.ColorTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length/5},setFrame:function(frameIndex,time,r,g,b,a){frameIndex*=5;this.frames[frameIndex]=time;this.frames[frameIndex+1]=r;this.frames[frameIndex+2]=g;this.frames[frameIndex+3]=b;this.frames[frameIndex+4]=a},apply:function(skeleton,lastTime,time,firedEvents,alpha){var frames=this.frames;if(time<frames[0])return;var r,g,b,a;if(time>=frames[frames.length-5]){var i=frames.length-1;r=frames[i-3];g=frames[i-2];b=frames[i-1];a=frames[i]}else{var frameIndex=spine.Animation.binarySearch(frames,time,5);var prevFrameR=frames[frameIndex-4];var prevFrameG=frames[frameIndex-3];var prevFrameB=frames[frameIndex-2];var prevFrameA=frames[frameIndex-1];var frameTime=frames[frameIndex];var percent=1-(time-frameTime)/(frames[frameIndex-5]-frameTime);percent=this.curves.getCurvePercent(frameIndex/5-1,percent);r=prevFrameR+(frames[frameIndex+1]-prevFrameR)*percent;g=prevFrameG+(frames[frameIndex+2]-prevFrameG)*percent;b=prevFrameB+(frames[frameIndex+3]-prevFrameB)*percent;a=prevFrameA+(frames[frameIndex+4]-prevFrameA)*percent}var slot=skeleton.slots[this.slotIndex];if(alpha<1){slot.r+=(r-slot.r)*alpha;slot.g+=(g-slot.g)*alpha;slot.b+=(b-slot.b)*alpha;slot.a+=(a-slot.a)*alpha}else{slot.r=r;slot.g=g;slot.b=b;slot.a=a}}};module.exports=spine.ColorTimeline},{"../SpineUtil":42,"./Animation":2,"./Curves":16}],16:[function(require,module,exports){var spine=require("../SpineUtil");spine.Curves=function(frameCount){this.curves=[]};spine.Curves.prototype={setLinear:function(frameIndex){this.curves[frameIndex*19]=0},setStepped:function(frameIndex){this.curves[frameIndex*19]=1},setCurve:function(frameIndex,cx1,cy1,cx2,cy2){var subdiv1=1/10,subdiv2=subdiv1*subdiv1,subdiv3=subdiv2*subdiv1;var pre1=3*subdiv1,pre2=3*subdiv2,pre4=6*subdiv2,pre5=6*subdiv3;var tmp1x=-cx1*2+cx2,tmp1y=-cy1*2+cy2,tmp2x=(cx1-cx2)*3+1,tmp2y=(cy1-cy2)*3+1;var dfx=cx1*pre1+tmp1x*pre2+tmp2x*subdiv3,dfy=cy1*pre1+tmp1y*pre2+tmp2y*subdiv3;var ddfx=tmp1x*pre4+tmp2x*pre5,ddfy=tmp1y*pre4+tmp2y*pre5;var dddfx=tmp2x*pre5,dddfy=tmp2y*pre5;var i=frameIndex*19;var curves=this.curves;curves[i++]=2;var x=dfx,y=dfy;for(var n=i+19-1;i<n;i+=2){curves[i]=x;curves[i+1]=y;dfx+=ddfx;dfy+=ddfy;ddfx+=dddfx;ddfy+=dddfy;x+=dfx;y+=dfy}},getCurvePercent:function(frameIndex,percent){percent=percent<0?0:percent>1?1:percent;var curves=this.curves;var i=frameIndex*19;var type=curves[i];if(type===0)return percent;if(type==1)return 0;i++;var x=0;for(var start=i,n=i+19-1;i<n;i+=2){x=curves[i];if(x>=percent){var prevX,prevY;if(i==start){prevX=0;prevY=0}else{prevX=curves[i-2];prevY=curves[i-1]}return prevY+(curves[i+1]-prevY)*(percent-prevX)/(x-prevX)}}var y=curves[i-1];return y+(1-y)*(percent-x)/(1-x)}};module.exports=spine.Curves},{"../SpineUtil":42}],17:[function(require,module,exports){var spine=require("../SpineUtil");spine.Animation=require("./Animation");spine.DrawOrderTimeline=function(frameCount){this.frames=[];this.frames.length=frameCount;this.drawOrders=[];this.drawOrders.length=frameCount};spine.DrawOrderTimeline.prototype={getFrameCount:function(){return this.frames.length},setFrame:function(frameIndex,time,drawOrder){this.frames[frameIndex]=time;this.drawOrders[frameIndex]=drawOrder},apply:function(skeleton,lastTime,time,firedEvents,alpha){var frames=this.frames;if(time<frames[0])return;var frameIndex;if(time>=frames[frames.length-1])frameIndex=frames.length-1;else frameIndex=spine.Animation.binarySearch1(frames,time)-1;var drawOrder=skeleton.drawOrder;var slots=skeleton.slots;var drawOrderToSetupIndex=this.drawOrders[frameIndex];if(drawOrderToSetupIndex){for(var i=0,n=drawOrderToSetupIndex.length;i<n;i++){drawOrder[i]=drawOrderToSetupIndex[i]}}}};module.exports=spine.DrawOrderTimeline},{"../SpineUtil":42,"./Animation":2}],18:[function(require,module,exports){var spine=require("../SpineUtil");spine.Event=function(data){this.data=data};spine.Event.prototype={intValue:0,floatValue:0,stringValue:null};module.exports=spine.Event},{"../SpineUtil":42}],19:[function(require,module,exports){var spine=require("../SpineUtil");spine.EventData=function(name){this.name=name};spine.EventData.prototype={intValue:0,floatValue:0,stringValue:null};module.exports=spine.EventData},{"../SpineUtil":42}],20:[function(require,module,exports){var spine=require("../SpineUtil");spine.Animation=require("./Animation");spine.EventTimeline=function(frameCount){this.frames=[];this.frames.length=frameCount;this.events=[];this.events.length=frameCount};spine.EventTimeline.prototype={getFrameCount:function(){return this.frames.length},setFrame:function(frameIndex,time,event){this.frames[frameIndex]=time;this.events[frameIndex]=event},apply:function(skeleton,lastTime,time,firedEvents,alpha){if(!firedEvents)return;var frames=this.frames;var frameCount=frames.length;if(lastTime>time){this.apply(skeleton,lastTime,Number.MAX_VALUE,firedEvents,alpha);lastTime=-1}else if(lastTime>=frames[frameCount-1])return;if(time<frames[0])return;var frameIndex;if(lastTime<frames[0])frameIndex=0;else{frameIndex=spine.Animation.binarySearch1(frames,lastTime);var frame=frames[frameIndex];while(frameIndex>0){if(frames[frameIndex-1]!=frame)break;frameIndex--}}var events=this.events;for(;frameIndex<frameCount&&time>=frames[frameIndex];frameIndex++)firedEvents.push(events[frameIndex])}};module.exports=spine.EventTimeline},{"../SpineUtil":42,"./Animation":2}],21:[function(require,module,exports){var spine=require("../SpineUtil");spine.Animation=require("./Animation");spine.Curves=require("./Curves");spine.FfdTimeline=function(frameCount){this.curves=new spine.Curves(frameCount);this.frames=[];this.frames.length=frameCount;this.frameVertices=[];this.frameVertices.length=frameCount};spine.FfdTimeline.prototype={slotIndex:0,attachment:0,getFrameCount:function(){return this.frames.length},setFrame:function(frameIndex,time,vertices){this.frames[frameIndex]=time;this.frameVertices[frameIndex]=vertices},apply:function(skeleton,lastTime,time,firedEvents,alpha){var slot=skeleton.slots[this.slotIndex];if(slot.attachment!=this.attachment)return;var frames=this.frames;if(time<frames[0])return;var frameVertices=this.frameVertices;var vertexCount=frameVertices[0].length;var vertices=slot.attachmentVertices;if(vertices.length!=vertexCount){vertices=slot.attachmentVertices=[];for(var k=0;k<vertexCount;k++)vertices.push(0);alpha=1}if(time>=frames[frames.length-1]){var lastVertices=frameVertices[frames.length-1];if(alpha<1){for(var i=0;i<vertexCount;i++)vertices[i]+=(lastVertices[i]-vertices[i])*alpha}else{for(var i=0;i<vertexCount;i++)vertices[i]=lastVertices[i]}return}var frameIndex=spine.Animation.binarySearch1(frames,time);var frameTime=frames[frameIndex];var percent=1-(time-frameTime)/(frames[frameIndex-1]-frameTime);percent=this.curves.getCurvePercent(frameIndex-1,percent<0?0:percent>1?1:percent);var prevVertices=frameVertices[frameIndex-1];var nextVertices=frameVertices[frameIndex];if(alpha<1){for(var i=0;i<vertexCount;i++){var prev=prevVertices[i];vertices[i]+=(prev+(nextVertices[i]-prev)*percent-vertices[i])*alpha}}else{for(var i=0;i<vertexCount;i++){var prev=prevVertices[i];vertices[i]=prev+(nextVertices[i]-prev)*percent}}}};module.exports=spine.FfdTimeline},{"../SpineUtil":42,"./Animation":2,"./Curves":16}],22:[function(require,module,exports){var spine=require("../SpineUtil");spine.Animation=require("./Animation");spine.Curves=require("./Curves");spine.FlipXTimeline=function(frameCount){this.curves=new spine.Curves(frameCount);this.frames=[];this.frames.length=frameCount*2};spine.FlipXTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(frameIndex,time,flip){frameIndex*=2;this.frames[frameIndex]=time;this.frames[frameIndex+1]=flip?1:0},apply:function(skeleton,lastTime,time,firedEvents,alpha){var frames=this.frames;if(time<frames[0]){if(lastTime>time)this.apply(skeleton,lastTime,Number.MAX_VALUE,null,0);return}else if(lastTime>time)lastTime=-1;var frameIndex=(time>=frames[frames.length-2]?frames.length:spine.Animation.binarySearch(frames,time,2))-2;if(frames[frameIndex]<lastTime)return;skeleton.bones[this.boneIndex].flipX=frames[frameIndex+1]!=0}};module.exports=spine.FlipXTimeline},{"../SpineUtil":42,"./Animation":2,"./Curves":16}],23:[function(require,module,exports){var spine=require("../SpineUtil");spine.Animation=require("./Animation");spine.Curves=require("./Curves");spine.FlipYTimeline=function(frameCount){this.curves=new spine.Curves(frameCount);this.frames=[];this.frames.length=frameCount*2};spine.FlipYTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(frameIndex,time,flip){frameIndex*=2;this.frames[frameIndex]=time;this.frames[frameIndex+1]=flip?1:0},apply:function(skeleton,lastTime,time,firedEvents,alpha){var frames=this.frames;if(time<frames[0]){if(lastTime>time)this.apply(skeleton,lastTime,Number.MAX_VALUE,null,0);return}else if(lastTime>time)lastTime=-1;var frameIndex=(time>=frames[frames.length-2]?frames.length:spine.Animation.binarySearch(frames,time,2))-2;if(frames[frameIndex]<lastTime)return;skeleton.bones[this.boneIndex].flipY=frames[frameIndex+1]!=0}};module.exports=spine.FlipYTimeline},{"../SpineUtil":42,"./Animation":2,"./Curves":16}],24:[function(require,module,exports){var spine=require("../SpineUtil");spine.IkConstraint=function(data,skeleton){this.data=data;this.mix=data.mix;this.bendDirection=data.bendDirection;this.bones=[];for(var i=0,n=data.bones.length;i<n;i++)this.bones.push(skeleton.findBone(data.bones[i].name));this.target=skeleton.findBone(data.target.name)};spine.IkConstraint.prototype={apply:function(){var target=this.target;var bones=this.bones;switch(bones.length){case 1:spine.IkConstraint.apply1(bones[0],target.worldX,target.worldY,this.mix);break;case 2:spine.IkConstraint.apply2(bones[0],bones[1],target.worldX,target.worldY,this.bendDirection,this.mix);break}}};spine.IkConstraint.apply1=function(bone,targetX,targetY,alpha){var parentRotation=!bone.data.inheritRotation||!bone.parent?0:bone.parent.worldRotation;var rotation=bone.rotation;var rotationIK=(spine.Bone.yDown?-spine.radDeg:spine.radDeg)*Math.atan2(targetY-bone.worldY,targetX-bone.worldX)-parentRotation;bone.rotationIK=rotation+(rotationIK-rotation)*alpha};spine.IkConstraint.apply2=function(parent,child,targetX,targetY,bendDirection,alpha){var childRotation=child.rotation,parentRotation=parent.rotation;if(!alpha){child.rotationIK=childRotation;parent.rotationIK=parentRotation;return}var positionX,positionY,tempPosition=spine.temp;var parentParent=parent.parent;if(parentParent){tempPosition[0]=targetX;tempPosition[1]=targetY;parentParent.worldToLocal(tempPosition);targetX=(tempPosition[0]-parent.x)*parentParent.worldScaleX;targetY=(tempPosition[1]-parent.y)*parentParent.worldScaleY}else{targetX-=parent.x;targetY-=parent.y}if(child.parent==parent){positionX=child.x;positionY=child.y}else{tempPosition[0]=child.x;tempPosition[1]=child.y;child.parent.localToWorld(tempPosition);parent.worldToLocal(tempPosition);positionX=tempPosition[0];positionY=tempPosition[1]}var childX=positionX*parent.worldScaleX,childY=positionY*parent.worldScaleY;var offset=Math.atan2(childY,childX);var len1=Math.sqrt(childX*childX+childY*childY),len2=child.data.length*child.worldScaleX;var cosDenom=2*len1*len2;if(cosDenom<1e-4){child.rotationIK=childRotation+(Math.atan2(targetY,targetX)*spine.radDeg-parentRotation-childRotation)*alpha;return}var cos=(targetX*targetX+targetY*targetY-len1*len1-len2*len2)/cosDenom;if(cos<-1)cos=-1;else if(cos>1)cos=1;var childAngle=Math.acos(cos)*bendDirection;var adjacent=len1+len2*cos,opposite=len2*Math.sin(childAngle);var parentAngle=Math.atan2(targetY*adjacent-targetX*opposite,targetX*adjacent+targetY*opposite);var rotation=(parentAngle-offset)*spine.radDeg-parentRotation;if(rotation>180)rotation-=360;else if(rotation<-180)rotation+=360;parent.rotationIK=parentRotation+rotation*alpha;rotation=(childAngle+offset)*spine.radDeg-childRotation;if(rotation>180)rotation-=360;else if(rotation<-180)rotation+=360;child.rotationIK=childRotation+(rotation+parent.worldRotation-child.parent.worldRotation)*alpha};module.exports=spine.IkConstraint},{"../SpineUtil":42}],25:[function(require,module,exports){var spine=require("../SpineUtil")||{};spine.IkConstraintData=function(name){this.name=name;this.bones=[]};spine.IkConstraintData.prototype={target:null,bendDirection:1,mix:1};module.exports=spine.IkConstraintData},{"../SpineUtil":42}],26:[function(require,module,exports){var spine=require("../SpineUtil")||{};spine.Animation=require("./Animation");spine.Curves=require("./Curves");spine.IkConstraintTimeline=function(frameCount){this.curves=new spine.Curves(frameCount);this.frames=[];this.frames.length=frameCount*3};spine.IkConstraintTimeline.prototype={ikConstraintIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(frameIndex,time,mix,bendDirection){frameIndex*=3;this.frames[frameIndex]=time;this.frames[frameIndex+1]=mix;this.frames[frameIndex+2]=bendDirection},apply:function(skeleton,lastTime,time,firedEvents,alpha){var frames=this.frames;if(time<frames[0])return;var ikConstraint=skeleton.ikConstraints[this.ikConstraintIndex];if(time>=frames[frames.length-3]){ikConstraint.mix+=(frames[frames.length-2]-ikConstraint.mix)*alpha;ikConstraint.bendDirection=frames[frames.length-1];return}var frameIndex=spine.Animation.binarySearch(frames,time,3);var prevFrameMix=frames[frameIndex+-2];var frameTime=frames[frameIndex];var percent=1-(time-frameTime)/(frames[frameIndex+-3]-frameTime);percent=this.curves.getCurvePercent(frameIndex/3-1,percent);var mix=prevFrameMix+(frames[frameIndex+1]-prevFrameMix)*percent;ikConstraint.mix+=(mix-ikConstraint.mix)*alpha;ikConstraint.bendDirection=frames[frameIndex+-1]}};module.exports=spine.IkConstraintTimeline},{"../SpineUtil":42,"./Animation":2,"./Curves":16}],27:[function(require,module,exports){var spine=require("../SpineUtil")||{};spine.AttachmentType=require("./AttachmentType");spine.MeshAttachment=function(name){this.name=name};spine.MeshAttachment.prototype={type:spine.AttachmentType.mesh,vertices:null,uvs:null,regionUVs:null,triangles:null,hullLength:0,r:1,g:1,b:1,a:1,path:null,rendererObject:null,regionU:0,regionV:0,regionU2:0,regionV2:0,regionRotate:false,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,edges:null,width:0,height:0,updateUVs:function(){var width=this.regionU2-this.regionU,height=this.regionV2-this.regionV;var n=this.regionUVs.length;if(!this.uvs||this.uvs.length!=n){this.uvs=new spine.Float32Array(n)}if(this.regionRotate){for(var i=0;i<n;i+=2){this.uvs[i]=this.regionU+this.regionUVs[i+1]*width;this.uvs[i+1]=this.regionV+height-this.regionUVs[i]*height}}else{for(var i=0;i<n;i+=2){this.uvs[i]=this.regionU+this.regionUVs[i]*width;this.uvs[i+1]=this.regionV+this.regionUVs[i+1]*height}}},computeWorldVertices:function(x,y,slot,worldVertices){var bone=slot.bone;x+=bone.worldX;y+=bone.worldY;var m00=bone.m00,m01=bone.m01,m10=bone.m10,m11=bone.m11;var vertices=this.vertices;var verticesCount=vertices.length;if(slot.attachmentVertices.length==verticesCount)vertices=slot.attachmentVertices;for(var i=0;i<verticesCount;i+=2){var vx=vertices[i];var vy=vertices[i+1];worldVertices[i]=vx*m00+vy*m01+x;worldVertices[i+1]=vx*m10+vy*m11+y}}};module.exports=spine.MeshAttachment},{"../SpineUtil":42,"./AttachmentType":11}],28:[function(require,module,exports){var spine=require("../SpineUtil");spine.AttachmentType=require("./AttachmentType");spine.RegionAttachment=function(name){this.name=name;this.offset=[];this.offset.length=8;this.uvs=[];this.uvs.length=8};spine.RegionAttachment.prototype={type:spine.AttachmentType.region,x:0,y:0,rotation:0,scaleX:1,scaleY:1,width:0,height:0,r:1,g:1,b:1,a:1,path:null,rendererObject:null,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,setUVs:function(u,v,u2,v2,rotate){var uvs=this.uvs;if(rotate){uvs[2]=u;uvs[3]=v2;uvs[4]=u;uvs[5]=v;uvs[6]=u2;uvs[7]=v;uvs[0]=u2;uvs[1]=v2}else{uvs[0]=u;uvs[1]=v2;uvs[2]=u;uvs[3]=v;uvs[4]=u2;uvs[5]=v;uvs[6]=u2;uvs[7]=v2}},updateOffset:function(){var regionScaleX=this.width/this.regionOriginalWidth*this.scaleX;var regionScaleY=this.height/this.regionOriginalHeight*this.scaleY;var localX=-this.width/2*this.scaleX+this.regionOffsetX*regionScaleX;var localY=-this.height/2*this.scaleY+this.regionOffsetY*regionScaleY;var localX2=localX+this.regionWidth*regionScaleX;var localY2=localY+this.regionHeight*regionScaleY;var radians=this.rotation*spine.degRad;var cos=Math.cos(radians);var sin=Math.sin(radians);var localXCos=localX*cos+this.x;var localXSin=localX*sin;var localYCos=localY*cos+this.y;var localYSin=localY*sin;var localX2Cos=localX2*cos+this.x;var localX2Sin=localX2*sin;var localY2Cos=localY2*cos+this.y;var localY2Sin=localY2*sin;var offset=this.offset;offset[0]=localXCos-localYSin;offset[1]=localYCos+localXSin;offset[2]=localXCos-localY2Sin;offset[3]=localY2Cos+localXSin;offset[4]=localX2Cos-localY2Sin;offset[5]=localY2Cos+localX2Sin;offset[6]=localX2Cos-localYSin;offset[7]=localYCos+localX2Sin},computeVertices:function(x,y,bone,vertices){x+=bone.worldX;y+=bone.worldY;var m00=bone.m00,m01=bone.m01,m10=bone.m10,m11=bone.m11;var offset=this.offset;vertices[0]=offset[0]*m00+offset[1]*m01+x;vertices[1]=offset[0]*m10+offset[1]*m11+y;vertices[2]=offset[2]*m00+offset[3]*m01+x;vertices[3]=offset[2]*m10+offset[3]*m11+y;vertices[4]=offset[4]*m00+offset[5]*m01+x;vertices[5]=offset[4]*m10+offset[5]*m11+y;vertices[6]=offset[6]*m00+offset[7]*m01+x;vertices[7]=offset[6]*m10+offset[7]*m11+y}};module.exports=spine.RegionAttachment},{"../SpineUtil":42,"./AttachmentType":11}],29:[function(require,module,exports){var spine=require("../SpineUtil")||{};spine.Animation=require("./Animation");spine.Curves=require("./Curves");spine.RotateTimeline=function(frameCount){this.curves=new spine.Curves(frameCount);this.frames=[];this.frames.length=frameCount*2};spine.RotateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(frameIndex,time,angle){frameIndex*=2;this.frames[frameIndex]=time;this.frames[frameIndex+1]=angle},apply:function(skeleton,lastTime,time,firedEvents,alpha){var frames=this.frames;if(time<frames[0])return;var bone=skeleton.bones[this.boneIndex];if(time>=frames[frames.length-2]){var amount=bone.data.rotation+frames[frames.length-1]-bone.rotation;while(amount>180)amount-=360;while(amount<-180)amount+=360;bone.rotation+=amount*alpha;return}var frameIndex=spine.Animation.binarySearch(frames,time,2);var prevFrameValue=frames[frameIndex-1];var frameTime=frames[frameIndex];var percent=1-(time-frameTime)/(frames[frameIndex-2]-frameTime);percent=this.curves.getCurvePercent(frameIndex/2-1,percent);var amount=frames[frameIndex+1]-prevFrameValue;while(amount>180)amount-=360;while(amount<-180)amount+=360;amount=bone.data.rotation+(prevFrameValue+amount*percent)-bone.rotation;while(amount>180)amount-=360;while(amount<-180)amount+=360;bone.rotation+=amount*alpha}};module.exports=spine.RotateTimeline},{"../SpineUtil":42,"./Animation":2,"./Curves":16}],30:[function(require,module,exports){var spine=require("../SpineUtil");spine.Animation=require("./Animation");spine.Curves=require("./Curves");spine.ScaleTimeline=function(frameCount){this.curves=new spine.Curves(frameCount);this.frames=[];this.frames.length=frameCount*3};spine.ScaleTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(frameIndex,time,x,y){frameIndex*=3;this.frames[frameIndex]=time;this.frames[frameIndex+1]=x;this.frames[frameIndex+2]=y},apply:function(skeleton,lastTime,time,firedEvents,alpha){var frames=this.frames;if(time<frames[0])return;var bone=skeleton.bones[this.boneIndex];if(time>=frames[frames.length-3]){bone.scaleX+=(bone.data.scaleX*frames[frames.length-2]-bone.scaleX)*alpha;bone.scaleY+=(bone.data.scaleY*frames[frames.length-1]-bone.scaleY)*alpha;return}var frameIndex=spine.Animation.binarySearch(frames,time,3);var prevFrameX=frames[frameIndex-2];var prevFrameY=frames[frameIndex-1];var frameTime=frames[frameIndex];var percent=1-(time-frameTime)/(frames[frameIndex+-3]-frameTime);percent=this.curves.getCurvePercent(frameIndex/3-1,percent);bone.scaleX+=(bone.data.scaleX*(prevFrameX+(frames[frameIndex+1]-prevFrameX)*percent)-bone.scaleX)*alpha;bone.scaleY+=(bone.data.scaleY*(prevFrameY+(frames[frameIndex+2]-prevFrameY)*percent)-bone.scaleY)*alpha}};module.exports=spine.ScaleTimeline},{"../SpineUtil":42,"./Animation":2,"./Curves":16}],31:[function(require,module,exports){var spine=require("../SpineUtil");spine.Bone=require("./Bone");spine.Slot=require("./Slot");spine.IkConstraint=require("./IkConstraint");spine.Skeleton=function(skeletonData){this.data=skeletonData;this.bones=[];for(var i=0,n=skeletonData.bones.length;i<n;i++){var boneData=skeletonData.bones[i];var parent=!boneData.parent?null:this.bones[skeletonData.bones.indexOf(boneData.parent)];this.bones.push(new spine.Bone(boneData,this,parent))}this.slots=[];this.drawOrder=[];for(var i=0,n=skeletonData.slots.length;i<n;i++){var slotData=skeletonData.slots[i];var bone=this.bones[skeletonData.bones.indexOf(slotData.boneData)];var slot=new spine.Slot(slotData,bone);this.slots.push(slot);this.drawOrder.push(i)}this.ikConstraints=[];for(var i=0,n=skeletonData.ikConstraints.length;i<n;i++)this.ikConstraints.push(new spine.IkConstraint(skeletonData.ikConstraints[i],this));this.boneCache=[];this.updateCache()};spine.Skeleton.prototype={x:0,y:0,skin:null,r:1,g:1,b:1,a:1,time:0,flipX:false,flipY:false,updateCache:function(){var ikConstraints=this.ikConstraints;var ikConstraintsCount=ikConstraints.length;var arrayCount=ikConstraintsCount+1;var boneCache=this.boneCache;if(boneCache.length>arrayCount)boneCache.length=arrayCount;for(var i=0,n=boneCache.length;i<n;i++)boneCache[i].length=0;while(boneCache.length<arrayCount)boneCache[boneCache.length]=[];var nonIkBones=boneCache[0];var bones=this.bones;outer:for(var i=0,n=bones.length;i<n;i++){var bone=bones[i];var current=bone;do{for(var ii=0;ii<ikConstraintsCount;ii++){var ikConstraint=ikConstraints[ii];var parent=ikConstraint.bones[0];var child=ikConstraint.bones[ikConstraint.bones.length-1];while(true){if(current==child){boneCache[ii].push(bone);boneCache[ii+1].push(bone);continue outer}if(child==parent)break;child=child.parent}}current=current.parent}while(current);nonIkBones[nonIkBones.length]=bone}},updateWorldTransform:function(){var bones=this.bones;for(var i=0,n=bones.length;i<n;i++){var bone=bones[i];bone.rotationIK=bone.rotation}var i=0,last=this.boneCache.length-1;while(true){var cacheBones=this.boneCache[i];for(var ii=0,nn=cacheBones.length;ii<nn;ii++)cacheBones[ii].updateWorldTransform();if(i==last)break;this.ikConstraints[i].apply();i++}},setToSetupPose:function(){this.setBonesToSetupPose();this.setSlotsToSetupPose()},setBonesToSetupPose:function(){var bones=this.bones;for(var i=0,n=bones.length;i<n;i++)bones[i].setToSetupPose();var ikConstraints=this.ikConstraints;for(var i=0,n=ikConstraints.length;i<n;i++){var ikConstraint=ikConstraints[i];ikConstraint.bendDirection=ikConstraint.data.bendDirection;ikConstraint.mix=ikConstraint.data.mix}},setSlotsToSetupPose:function(){var slots=this.slots;for(var i=0,n=slots.length;i<n;i++){slots[i].setToSetupPose(i)}this.resetDrawOrder()},getRootBone:function(){return this.bones.length?this.bones[0]:null},findBone:function(boneName){var bones=this.bones;for(var i=0,n=bones.length;i<n;i++)if(bones[i].data.name==boneName)return bones[i];return null},findBoneIndex:function(boneName){var bones=this.bones;for(var i=0,n=bones.length;i<n;i++)if(bones[i].data.name==boneName)return i;return-1},findSlot:function(slotName){var slots=this.slots;for(var i=0,n=slots.length;i<n;i++)if(slots[i].data.name==slotName)return slots[i];return null},findSlotIndex:function(slotName){var slots=this.slots;for(var i=0,n=slots.length;i<n;i++)if(slots[i].data.name==slotName)return i;return-1},setSkinByName:function(skinName){var skin=this.data.findSkin(skinName);if(!skin)throw"Skin not found: "+skinName;this.setSkin(skin)},setSkin:function(newSkin){if(newSkin){if(this.skin)newSkin._attachAll(this,this.skin);else{var slots=this.slots;for(var i=0,n=slots.length;i<n;i++){var slot=slots[i];var name=slot.data.attachmentName;if(name){var attachment=newSkin.getAttachment(i,name);if(attachment)slot.setAttachment(attachment)}}}}this.skin=newSkin},getAttachmentBySlotName:function(slotName,attachmentName){return this.getAttachmentBySlotIndex(this.data.findSlotIndex(slotName),attachmentName)},getAttachmentBySlotIndex:function(slotIndex,attachmentName){if(this.skin){var attachment=this.skin.getAttachment(slotIndex,attachmentName);if(attachment)return attachment}if(this.data.defaultSkin)return this.data.defaultSkin.getAttachment(slotIndex,attachmentName);return null},setAttachment:function(slotName,attachmentName){var slots=this.slots;for(var i=0,n=slots.length;i<n;i++){var slot=slots[i];if(slot.data.name==slotName){var attachment=null;if(attachmentName){attachment=this.getAttachmentBySlotIndex(i,attachmentName);if(!attachment)throw"Attachment not found: "+attachmentName+", for slot: "+slotName}slot.setAttachment(attachment);return}}throw"Slot not found: "+slotName},findIkConstraint:function(ikConstraintName){var ikConstraints=this.ikConstraints;for(var i=0,n=ikConstraints.length;i<n;i++)if(ikConstraints[i].data.name==ikConstraintName)return ikConstraints[i];
return null},update:function(delta){this.time+=delta},resetDrawOrder:function(){for(var i=0,n=this.drawOrder.length;i<n;i++){this.drawOrder[i]=i}}};module.exports=spine.Skeleton},{"../SpineUtil":42,"./Bone":12,"./IkConstraint":24,"./Slot":37}],32:[function(require,module,exports){var spine=require("../SpineRuntime")||{};spine.AttachmentType=require("./AttachmentType");spine.SkeletonBounds=function(){this.polygonPool=[];this.polygons=[];this.boundingBoxes=[]};spine.SkeletonBounds.prototype={minX:0,minY:0,maxX:0,maxY:0,update:function(skeleton,updateAabb){var slots=skeleton.slots;var slotCount=slots.length;var x=skeleton.x,y=skeleton.y;var boundingBoxes=this.boundingBoxes;var polygonPool=this.polygonPool;var polygons=this.polygons;boundingBoxes.length=0;for(var i=0,n=polygons.length;i<n;i++)polygonPool.push(polygons[i]);polygons.length=0;for(var i=0;i<slotCount;i++){var slot=slots[i];var boundingBox=slot.attachment;if(boundingBox.type!=spine.AttachmentType.boundingbox)continue;boundingBoxes.push(boundingBox);var poolCount=polygonPool.length,polygon;if(poolCount>0){polygon=polygonPool[poolCount-1];polygonPool.splice(poolCount-1,1)}else polygon=[];polygons.push(polygon);polygon.length=boundingBox.vertices.length;boundingBox.computeWorldVertices(x,y,slot.bone,polygon)}if(updateAabb)this.aabbCompute()},aabbCompute:function(){var polygons=this.polygons;var minX=Number.MAX_VALUE,minY=Number.MAX_VALUE,maxX=Number.MIN_VALUE,maxY=Number.MIN_VALUE;for(var i=0,n=polygons.length;i<n;i++){var vertices=polygons[i];for(var ii=0,nn=vertices.length;ii<nn;ii+=2){var x=vertices[ii];var y=vertices[ii+1];minX=Math.min(minX,x);minY=Math.min(minY,y);maxX=Math.max(maxX,x);maxY=Math.max(maxY,y)}}this.minX=minX;this.minY=minY;this.maxX=maxX;this.maxY=maxY},aabbContainsPoint:function(x,y){return x>=this.minX&&x<=this.maxX&&y>=this.minY&&y<=this.maxY},aabbIntersectsSegment:function(x1,y1,x2,y2){var minX=this.minX,minY=this.minY,maxX=this.maxX,maxY=this.maxY;if(x1<=minX&&x2<=minX||y1<=minY&&y2<=minY||x1>=maxX&&x2>=maxX||y1>=maxY&&y2>=maxY)return false;var m=(y2-y1)/(x2-x1);var y=m*(minX-x1)+y1;if(y>minY&&y<maxY)return true;y=m*(maxX-x1)+y1;if(y>minY&&y<maxY)return true;var x=(minY-y1)/m+x1;if(x>minX&&x<maxX)return true;x=(maxY-y1)/m+x1;if(x>minX&&x<maxX)return true;return false},aabbIntersectsSkeleton:function(bounds){return this.minX<bounds.maxX&&this.maxX>bounds.minX&&this.minY<bounds.maxY&&this.maxY>bounds.minY},containsPoint:function(x,y){var polygons=this.polygons;for(var i=0,n=polygons.length;i<n;i++)if(this.polygonContainsPoint(polygons[i],x,y))return this.boundingBoxes[i];return null},intersectsSegment:function(x1,y1,x2,y2){var polygons=this.polygons;for(var i=0,n=polygons.length;i<n;i++)if(polygons[i].intersectsSegment(x1,y1,x2,y2))return this.boundingBoxes[i];return null},polygonContainsPoint:function(polygon,x,y){var nn=polygon.length;var prevIndex=nn-2;var inside=false;for(var ii=0;ii<nn;ii+=2){var vertexY=polygon[ii+1];var prevY=polygon[prevIndex+1];if(vertexY<y&&prevY>=y||prevY<y&&vertexY>=y){var vertexX=polygon[ii];if(vertexX+(y-vertexY)/(prevY-vertexY)*(polygon[prevIndex]-vertexX)<x)inside=!inside}prevIndex=ii}return inside},polygonIntersectsSegment:function(polygon,x1,y1,x2,y2){var nn=polygon.length;var width12=x1-x2,height12=y1-y2;var det1=x1*y2-y1*x2;var x3=polygon[nn-2],y3=polygon[nn-1];for(var ii=0;ii<nn;ii+=2){var x4=polygon[ii],y4=polygon[ii+1];var det2=x3*y4-y3*x4;var width34=x3-x4,height34=y3-y4;var det3=width12*height34-height12*width34;var x=(det1*width34-width12*det2)/det3;if((x>=x3&&x<=x4||x>=x4&&x<=x3)&&(x>=x1&&x<=x2||x>=x2&&x<=x1)){var y=(det1*height34-height12*det2)/det3;if((y>=y3&&y<=y4||y>=y4&&y<=y3)&&(y>=y1&&y<=y2||y>=y2&&y<=y1))return true}x3=x4;y3=y4}return false},getPolygon:function(attachment){var index=this.boundingBoxes.indexOf(attachment);return index==-1?null:this.polygons[index]},getWidth:function(){return this.maxX-this.minX},getHeight:function(){return this.maxY-this.minY}};module.exports=spine.SkeletonBounds},{"../SpineRuntime":41,"./AttachmentType":11}],33:[function(require,module,exports){var spine=require("../SpineUtil");spine.SkeletonData=function(){this.bones=[];this.slots=[];this.skins=[];this.events=[];this.animations=[];this.ikConstraints=[]};spine.SkeletonData.prototype={name:null,defaultSkin:null,width:0,height:0,version:null,hash:null,findBone:function(boneName){var bones=this.bones;for(var i=0,n=bones.length;i<n;i++)if(bones[i].name==boneName)return bones[i];return null},findBoneIndex:function(boneName){var bones=this.bones;for(var i=0,n=bones.length;i<n;i++)if(bones[i].name==boneName)return i;return-1},findSlot:function(slotName){var slots=this.slots;for(var i=0,n=slots.length;i<n;i++){if(slots[i].name==slotName)return this.slots[i]}return null},findSlotIndex:function(slotName){var slots=this.slots;for(var i=0,n=slots.length;i<n;i++)if(slots[i].name==slotName)return i;return-1},findSkin:function(skinName){var skins=this.skins;for(var i=0,n=skins.length;i<n;i++)if(skins[i].name==skinName)return skins[i];return null},findEvent:function(eventName){var events=this.events;for(var i=0,n=events.length;i<n;i++)if(events[i].name==eventName)return events[i];return null},findAnimation:function(animationName){var animations=this.animations;for(var i=0,n=animations.length;i<n;i++)if(animations[i].name==animationName)return animations[i];return null},findIkConstraint:function(ikConstraintName){var ikConstraints=this.ikConstraints;for(var i=0,n=ikConstraints.length;i<n;i++)if(ikConstraints[i].name==ikConstraintName)return ikConstraints[i];return null}};module.exports=spine.SkeletonData},{"../SpineUtil":42}],34:[function(require,module,exports){var spine=require("../SpineUtil");spine.SkeletonData=require("./SkeletonData");spine.BoneData=require("./BoneData");spine.IkConstraintData=require("./IkConstraintData");spine.SlotData=require("./SlotData");spine.Skin=require("./Skin");spine.EventData=require("./EventData");spine.AttachmentType=require("./AttachmentType");spine.ColorTimeline=require("./ColorTimeline");spine.AttachmentTimeline=require("./AttachmentTimeline");spine.RotateTimeline=require("./RotateTimeline");spine.ScaleTimeline=require("./ScaleTimeline");spine.TranslateTimeline=require("./TranslateTimeline");spine.FlipXTimeline=require("./FlipXTimeline");spine.FlipYTimeline=require("./FlipYTimeline");spine.IkConstraintTimeline=require("./IkConstraintTimeline");spine.FfdTimeline=require("./FfdTimeline");spine.DrawOrderTimeline=require("./DrawOrderTimeline");spine.EventTimeline=require("./EventTimeline");spine.Event=require("./Event");spine.Animation=require("./Animation");spine.SkeletonJsonParser=function(attachmentLoader){this.attachmentLoader=attachmentLoader};spine.SkeletonJsonParser.prototype={scale:1,readSkeletonData:function(root,name){var skeletonData=new spine.SkeletonData;skeletonData.name=name;var skeletonMap=root["skeleton"];if(skeletonMap){skeletonData.hash=skeletonMap["hash"];skeletonData.version=skeletonMap["spine"];skeletonData.width=skeletonMap["width"]||0;skeletonData.height=skeletonMap["height"]||0}var bones=root["bones"];for(var i=0,n=bones.length;i<n;i++){var boneMap=bones[i];var parent=null;if(boneMap["parent"]){parent=skeletonData.findBone(boneMap["parent"]);if(!parent)throw"Parent bone not found: "+boneMap["parent"]}var boneData=new spine.BoneData(boneMap["name"],parent);boneData.length=(boneMap["length"]||0)*this.scale;boneData.x=(boneMap["x"]||0)*this.scale;boneData.y=(boneMap["y"]||0)*this.scale;boneData.rotation=boneMap["rotation"]||0;boneData.scaleX=boneMap.hasOwnProperty("scaleX")?boneMap["scaleX"]:1;boneData.scaleY=boneMap.hasOwnProperty("scaleY")?boneMap["scaleY"]:1;boneData.inheritScale=boneMap.hasOwnProperty("inheritScale")?boneMap["inheritScale"]:true;boneData.inheritRotation=boneMap.hasOwnProperty("inheritRotation")?boneMap["inheritRotation"]:true;skeletonData.bones.push(boneData)}var ik=root["ik"];if(ik){for(var i=0,n=ik.length;i<n;i++){var ikMap=ik[i];var ikConstraintData=new spine.IkConstraintData(ikMap["name"]);var bones=ikMap["bones"];for(var ii=0,nn=bones.length;ii<nn;ii++){var bone=skeletonData.findBone(bones[ii]);if(!bone)throw"IK bone not found: "+bones[ii];ikConstraintData.bones.push(bone)}ikConstraintData.target=skeletonData.findBone(ikMap["target"]);if(!ikConstraintData.target)throw"Target bone not found: "+ikMap["target"];ikConstraintData.bendDirection=!ikMap.hasOwnProperty("bendPositive")||ikMap["bendPositive"]?1:-1;ikConstraintData.mix=ikMap.hasOwnProperty("mix")?ikMap["mix"]:1;skeletonData.ikConstraints.push(ikConstraintData)}}var slots=root["slots"];for(var i=0,n=slots.length;i<n;i++){var slotMap=slots[i];var boneData=skeletonData.findBone(slotMap["bone"]);if(!boneData)throw"Slot bone not found: "+slotMap["bone"];var slotData=new spine.SlotData(slotMap["name"],boneData);var color=slotMap["color"];if(color){slotData.r=this.toColor(color,0);slotData.g=this.toColor(color,1);slotData.b=this.toColor(color,2);slotData.a=this.toColor(color,3)}slotData.attachmentName=slotMap["attachment"];slotData.blendMode=slotMap["blend"]&&spine.SlotData.PIXI_BLEND_MODE_MAP[slotMap["blend"]]||spine.SlotData.PIXI_BLEND_MODE_MAP["normal"];skeletonData.slots.push(slotData)}var skins=root["skins"];for(var skinName in skins){if(!skins.hasOwnProperty(skinName))continue;var skinMap=skins[skinName];var skin=new spine.Skin(skinName);for(var slotName in skinMap){if(!skinMap.hasOwnProperty(slotName))continue;var slotIndex=skeletonData.findSlotIndex(slotName);var slotEntry=skinMap[slotName];for(var attachmentName in slotEntry){if(!slotEntry.hasOwnProperty(attachmentName))continue;var attachment=this.readAttachment(skin,attachmentName,slotEntry[attachmentName]);if(attachment)skin.addAttachment(slotIndex,attachmentName,attachment)}}skeletonData.skins.push(skin);if(skin.name=="default")skeletonData.defaultSkin=skin}var events=root["events"];for(var eventName in events){if(!events.hasOwnProperty(eventName))continue;var eventMap=events[eventName];var eventData=new spine.EventData(eventName);eventData.intValue=eventMap["int"]||0;eventData.floatValue=eventMap["float"]||0;eventData.stringValue=eventMap["string"]||null;skeletonData.events.push(eventData)}var animations=root["animations"];for(var animationName in animations){if(!animations.hasOwnProperty(animationName))continue;this.readAnimation(animationName,animations[animationName],skeletonData)}return skeletonData},readAttachment:function(skin,name,map){name=map["name"]||name;var type=spine.AttachmentType[map["type"]||"region"];var path=map["path"]||name;var scale=this.scale;if(type==spine.AttachmentType.region){var region=this.attachmentLoader.newRegionAttachment(skin,name,path);if(!region)return null;region.path=path;region.x=(map["x"]||0)*scale;region.y=(map["y"]||0)*scale;region.scaleX=map.hasOwnProperty("scaleX")?map["scaleX"]:1;region.scaleY=map.hasOwnProperty("scaleY")?map["scaleY"]:1;region.rotation=map["rotation"]||0;region.width=(map["width"]||0)*scale;region.height=(map["height"]||0)*scale;var color=map["color"];if(color){region.r=this.toColor(color,0);region.g=this.toColor(color,1);region.b=this.toColor(color,2);region.a=this.toColor(color,3)}region.updateOffset();return region}else if(type==spine.AttachmentType.mesh){var mesh=this.attachmentLoader.newMeshAttachment(skin,name,path);if(!mesh)return null;mesh.path=path;mesh.vertices=this.getFloatArray(map,"vertices",scale);mesh.triangles=this.getIntArray(map,"triangles");mesh.regionUVs=this.getFloatArray(map,"uvs",1);mesh.updateUVs();color=map["color"];if(color){mesh.r=this.toColor(color,0);mesh.g=this.toColor(color,1);mesh.b=this.toColor(color,2);mesh.a=this.toColor(color,3)}mesh.hullLength=(map["hull"]||0)*2;if(map["edges"])mesh.edges=this.getIntArray(map,"edges");mesh.width=(map["width"]||0)*scale;mesh.height=(map["height"]||0)*scale;return mesh}else if(type==spine.AttachmentType.skinnedmesh){var mesh=this.attachmentLoader.newSkinnedMeshAttachment(skin,name,path);if(!mesh)return null;mesh.path=path;var uvs=this.getFloatArray(map,"uvs",1);var vertices=this.getFloatArray(map,"vertices",1);var weights=[];var bones=[];for(var i=0,n=vertices.length;i<n;){var boneCount=vertices[i++]|0;bones[bones.length]=boneCount;for(var nn=i+boneCount*4;i<nn;){bones[bones.length]=vertices[i];weights[weights.length]=vertices[i+1]*scale;weights[weights.length]=vertices[i+2]*scale;weights[weights.length]=vertices[i+3];i+=4}}mesh.bones=bones;mesh.weights=weights;mesh.triangles=this.getIntArray(map,"triangles");mesh.regionUVs=uvs;mesh.updateUVs();color=map["color"];if(color){mesh.r=this.toColor(color,0);mesh.g=this.toColor(color,1);mesh.b=this.toColor(color,2);mesh.a=this.toColor(color,3)}mesh.hullLength=(map["hull"]||0)*2;if(map["edges"])mesh.edges=this.getIntArray(map,"edges");mesh.width=(map["width"]||0)*scale;mesh.height=(map["height"]||0)*scale;return mesh}else if(type==spine.AttachmentType.boundingbox){var attachment=this.attachmentLoader.newBoundingBoxAttachment(skin,name);var vertices=map["vertices"];for(var i=0,n=vertices.length;i<n;i++)attachment.vertices.push(vertices[i]*scale);return attachment}throw"Unknown attachment type: "+type},readAnimation:function(name,map,skeletonData){var timelines=[];var duration=0;var slots=map["slots"];for(var slotName in slots){if(!slots.hasOwnProperty(slotName))continue;var slotMap=slots[slotName];var slotIndex=skeletonData.findSlotIndex(slotName);for(var timelineName in slotMap){if(!slotMap.hasOwnProperty(timelineName))continue;var values=slotMap[timelineName];if(timelineName=="color"){var timeline=new spine.ColorTimeline(values.length);timeline.slotIndex=slotIndex;var frameIndex=0;for(var i=0,n=values.length;i<n;i++){var valueMap=values[i];var color=valueMap["color"];var r=this.toColor(color,0);var g=this.toColor(color,1);var b=this.toColor(color,2);var a=this.toColor(color,3);timeline.setFrame(frameIndex,valueMap["time"],r,g,b,a);this.readCurve(timeline,frameIndex,valueMap);frameIndex++}timelines.push(timeline);duration=Math.max(duration,timeline.frames[timeline.getFrameCount()*5-5])}else if(timelineName=="attachment"){var timeline=new spine.AttachmentTimeline(values.length);timeline.slotIndex=slotIndex;var frameIndex=0;for(var i=0,n=values.length;i<n;i++){var valueMap=values[i];timeline.setFrame(frameIndex++,valueMap["time"],valueMap["name"])}timelines.push(timeline);duration=Math.max(duration,timeline.frames[timeline.getFrameCount()-1])}else throw"Invalid timeline type for a slot: "+timelineName+" ("+slotName+")"}}var bones=map["bones"];for(var boneName in bones){if(!bones.hasOwnProperty(boneName))continue;var boneIndex=skeletonData.findBoneIndex(boneName);if(boneIndex==-1)throw"Bone not found: "+boneName;var boneMap=bones[boneName];for(var timelineName in boneMap){if(!boneMap.hasOwnProperty(timelineName))continue;var values=boneMap[timelineName];if(timelineName=="rotate"){var timeline=new spine.RotateTimeline(values.length);timeline.boneIndex=boneIndex;var frameIndex=0;for(var i=0,n=values.length;i<n;i++){var valueMap=values[i];timeline.setFrame(frameIndex,valueMap["time"],valueMap["angle"]);this.readCurve(timeline,frameIndex,valueMap);frameIndex++}timelines.push(timeline);duration=Math.max(duration,timeline.frames[timeline.getFrameCount()*2-2])}else if(timelineName=="translate"||timelineName=="scale"){var timeline;var timelineScale=1;if(timelineName=="scale")timeline=new spine.ScaleTimeline(values.length);else{timeline=new spine.TranslateTimeline(values.length);timelineScale=this.scale}timeline.boneIndex=boneIndex;var frameIndex=0;for(var i=0,n=values.length;i<n;i++){var valueMap=values[i];var x=(valueMap["x"]||0)*timelineScale;var y=(valueMap["y"]||0)*timelineScale;timeline.setFrame(frameIndex,valueMap["time"],x,y);this.readCurve(timeline,frameIndex,valueMap);frameIndex++}timelines.push(timeline);duration=Math.max(duration,timeline.frames[timeline.getFrameCount()*3-3])}else if(timelineName=="flipX"||timelineName=="flipY"){var x=timelineName=="flipX";var timeline=x?new spine.FlipXTimeline(values.length):new spine.FlipYTimeline(values.length);timeline.boneIndex=boneIndex;var field=x?"x":"y";var frameIndex=0;for(var i=0,n=values.length;i<n;i++){var valueMap=values[i];timeline.setFrame(frameIndex,valueMap["time"],valueMap[field]||false);frameIndex++}timelines.push(timeline);duration=Math.max(duration,timeline.frames[timeline.getFrameCount()*2-2])}else throw"Invalid timeline type for a bone: "+timelineName+" ("+boneName+")"}}var ikMap=map["ik"];for(var ikConstraintName in ikMap){if(!ikMap.hasOwnProperty(ikConstraintName))continue;var ikConstraint=skeletonData.findIkConstraint(ikConstraintName);var values=ikMap[ikConstraintName];var timeline=new spine.IkConstraintTimeline(values.length);timeline.ikConstraintIndex=skeletonData.ikConstraints.indexOf(ikConstraint);var frameIndex=0;for(var i=0,n=values.length;i<n;i++){var valueMap=values[i];var mix=valueMap.hasOwnProperty("mix")?valueMap["mix"]:1;var bendDirection=!valueMap.hasOwnProperty("bendPositive")||valueMap["bendPositive"]?1:-1;timeline.setFrame(frameIndex,valueMap["time"],mix,bendDirection);this.readCurve(timeline,frameIndex,valueMap);frameIndex++}timelines.push(timeline);duration=Math.max(duration,timeline.frames[timeline.getFrameCount()*3-3])}var ffd=map["ffd"];for(var skinName in ffd){var skin=skeletonData.findSkin(skinName);var slotMap=ffd[skinName];for(slotName in slotMap){var slotIndex=skeletonData.findSlotIndex(slotName);var meshMap=slotMap[slotName];for(var meshName in meshMap){var values=meshMap[meshName];var timeline=new spine.FfdTimeline(values.length);var attachment=skin.getAttachment(slotIndex,meshName);if(!attachment)throw"FFD attachment not found: "+meshName;timeline.slotIndex=slotIndex;timeline.attachment=attachment;var isMesh=attachment.type==spine.AttachmentType.mesh;var vertexCount;if(isMesh)vertexCount=attachment.vertices.length;else vertexCount=attachment.weights.length/3*2;var frameIndex=0;for(var i=0,n=values.length;i<n;i++){var valueMap=values[i];var vertices;if(!valueMap["vertices"]){if(isMesh)vertices=attachment.vertices;else{vertices=[];for(var j=0;j<vertexCount;++j)vertices.push(0)}}else{var verticesValue=valueMap["vertices"];vertices=[];for(var j=0;j<vertexCount;++j)vertices.push(0);var start=valueMap["offset"]||0;var nn=verticesValue.length;if(this.scale==1){for(var ii=0;ii<nn;ii++)vertices[ii+start]=verticesValue[ii]}else{for(var ii=0;ii<nn;ii++)vertices[ii+start]=verticesValue[ii]*this.scale}if(isMesh){var meshVertices=attachment.vertices;for(var ii=0,nn=vertices.length;ii<nn;ii++)vertices[ii]+=meshVertices[ii]}}timeline.setFrame(frameIndex,valueMap["time"],vertices);this.readCurve(timeline,frameIndex,valueMap);frameIndex++}timelines[timelines.length]=timeline;duration=Math.max(duration,timeline.frames[timeline.getFrameCount()-1])}}}var drawOrderValues=map["drawOrder"];if(!drawOrderValues)drawOrderValues=map["draworder"];if(drawOrderValues){var timeline=new spine.DrawOrderTimeline(drawOrderValues.length);var slotCount=skeletonData.slots.length;var frameIndex=0;for(var i=0,n=drawOrderValues.length;i<n;i++){var drawOrderMap=drawOrderValues[i];var drawOrder=null;if(drawOrderMap["offsets"]){drawOrder=[];drawOrder.length=slotCount;for(var ii=slotCount-1;ii>=0;ii--)drawOrder[ii]=-1;var offsets=drawOrderMap["offsets"];var unchanged=[];unchanged.length=slotCount-offsets.length;var originalIndex=0,unchangedIndex=0;for(var ii=0,nn=offsets.length;ii<nn;ii++){var offsetMap=offsets[ii];var slotIndex=skeletonData.findSlotIndex(offsetMap["slot"]);if(slotIndex==-1)throw"Slot not found: "+offsetMap["slot"];while(originalIndex!=slotIndex)unchanged[unchangedIndex++]=originalIndex++;drawOrder[originalIndex+offsetMap["offset"]]=originalIndex++}while(originalIndex<slotCount)unchanged[unchangedIndex++]=originalIndex++;for(var ii=slotCount-1;ii>=0;ii--)if(drawOrder[ii]==-1)drawOrder[ii]=unchanged[--unchangedIndex]}timeline.setFrame(frameIndex++,drawOrderMap["time"],drawOrder)}timelines.push(timeline);duration=Math.max(duration,timeline.frames[timeline.getFrameCount()-1])}var events=map["events"];if(events){var timeline=new spine.EventTimeline(events.length);var frameIndex=0;for(var i=0,n=events.length;i<n;i++){var eventMap=events[i];var eventData=skeletonData.findEvent(eventMap["name"]);if(!eventData)throw"Event not found: "+eventMap["name"];var event=new spine.Event(eventData);event.intValue=eventMap.hasOwnProperty("int")?eventMap["int"]:eventData.intValue;event.floatValue=eventMap.hasOwnProperty("float")?eventMap["float"]:eventData.floatValue;event.stringValue=eventMap.hasOwnProperty("string")?eventMap["string"]:eventData.stringValue;timeline.setFrame(frameIndex++,eventMap["time"],event)}timelines.push(timeline);duration=Math.max(duration,timeline.frames[timeline.getFrameCount()-1])}skeletonData.animations.push(new spine.Animation(name,timelines,duration))},readCurve:function(timeline,frameIndex,valueMap){var curve=valueMap["curve"];if(!curve)timeline.curves.setLinear(frameIndex);else if(curve=="stepped")timeline.curves.setStepped(frameIndex);else if(curve instanceof Array)timeline.curves.setCurve(frameIndex,curve[0],curve[1],curve[2],curve[3])},toColor:function(hexString,colorIndex){if(hexString.length!=8)throw"Color hexidecimal length must be 8, recieved: "+hexString;return parseInt(hexString.substring(colorIndex*2,colorIndex*2+2),16)/255},getFloatArray:function(map,name,scale){var list=map[name];var values=new spine.Float32Array(list.length);var i=0,n=list.length;if(scale==1){for(;i<n;i++)values[i]=list[i]}else{for(;i<n;i++)values[i]=list[i]*scale}return values},getIntArray:function(map,name){var list=map[name];var values=new spine.Uint16Array(list.length);for(var i=0,n=list.length;i<n;i++)values[i]=list[i]|0;return values}};module.exports=spine.SkeletonJsonParser},{"../SpineUtil":42,"./Animation":2,"./AttachmentTimeline":10,"./AttachmentType":11,"./BoneData":13,"./ColorTimeline":15,"./DrawOrderTimeline":17,"./Event":18,"./EventData":19,"./EventTimeline":20,"./FfdTimeline":21,"./FlipXTimeline":22,"./FlipYTimeline":23,"./IkConstraintData":25,"./IkConstraintTimeline":26,"./RotateTimeline":29,"./ScaleTimeline":30,"./SkeletonData":33,"./Skin":35,"./SlotData":38,"./TranslateTimeline":40}],35:[function(require,module,exports){var spine=require("../SpineUtil");spine.Skin=function(name){this.name=name;this.attachments={}};spine.Skin.prototype={addAttachment:function(slotIndex,name,attachment){this.attachments[slotIndex+":"+name]=attachment},getAttachment:function(slotIndex,name){return this.attachments[slotIndex+":"+name]},_attachAll:function(skeleton,oldSkin){for(var key in oldSkin.attachments){var colon=key.indexOf(":");var slotIndex=parseInt(key.substring(0,colon));var name=key.substring(colon+1);var slot=skeleton.slots[slotIndex];if(slot.attachment&&slot.attachment.name==name){var attachment=this.getAttachment(slotIndex,name);if(attachment)slot.setAttachment(attachment)}}}};module.exports=spine.Skin},{"../SpineUtil":42}],36:[function(require,module,exports){var spine=require("../SpineUtil")||{};spine.AttachmentType=require("./AttachmentType");spine.SkinnedMeshAttachment=function(name){this.name=name};spine.SkinnedMeshAttachment.prototype={type:spine.AttachmentType.skinnedmesh,bones:null,weights:null,uvs:null,regionUVs:null,triangles:null,hullLength:0,r:1,g:1,b:1,a:1,path:null,rendererObject:null,regionU:0,regionV:0,regionU2:0,regionV2:0,regionRotate:false,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,edges:null,width:0,height:0,updateUVs:function(u,v,u2,v2,rotate){var width=this.regionU2-this.regionU,height=this.regionV2-this.regionV;var n=this.regionUVs.length;if(!this.uvs||this.uvs.length!=n){this.uvs=new spine.Float32Array(n)}if(this.regionRotate){for(var i=0;i<n;i+=2){this.uvs[i]=this.regionU+this.regionUVs[i+1]*width;this.uvs[i+1]=this.regionV+height-this.regionUVs[i]*height}}else{for(var i=0;i<n;i+=2){this.uvs[i]=this.regionU+this.regionUVs[i]*width;this.uvs[i+1]=this.regionV+this.regionUVs[i+1]*height}}},computeWorldVertices:function(x,y,slot,worldVertices){var skeletonBones=slot.bone.skeleton.bones;var weights=this.weights;var bones=this.bones;var w=0,v=0,b=0,f=0,n=bones.length,nn;var wx,wy,bone,vx,vy,weight;if(!slot.attachmentVertices.length){for(;v<n;w+=2){wx=0;wy=0;nn=bones[v++]+v;for(;v<nn;v++,b+=3){bone=skeletonBones[bones[v]];vx=weights[b];vy=weights[b+1];weight=weights[b+2];wx+=(vx*bone.m00+vy*bone.m01+bone.worldX)*weight;wy+=(vx*bone.m10+vy*bone.m11+bone.worldY)*weight}worldVertices[w]=wx+x;worldVertices[w+1]=wy+y}}else{var ffd=slot.attachmentVertices;for(;v<n;w+=2){wx=0;wy=0;nn=bones[v++]+v;for(;v<nn;v++,b+=3,f+=2){bone=skeletonBones[bones[v]];vx=weights[b]+ffd[f];vy=weights[b+1]+ffd[f+1];weight=weights[b+2];wx+=(vx*bone.m00+vy*bone.m01+bone.worldX)*weight;wy+=(vx*bone.m10+vy*bone.m11+bone.worldY)*weight}worldVertices[w]=wx+x;worldVertices[w+1]=wy+y}}}};module.exports=spine.SkinnedMeshAttachment},{"../SpineUtil":42,"./AttachmentType":11}],37:[function(require,module,exports){var spine=require("../SpineUtil");spine.Slot=function(slotData,bone){this.data=slotData;this.bone=bone;this.setToSetupPose()};spine.Slot.prototype={r:1,g:1,b:1,a:1,_attachmentTime:0,attachment:null,attachmentVertices:[],setAttachment:function(attachment){this.attachment=attachment;this._attachmentTime=this.bone.skeleton.time;this.attachmentVertices.length=0},setAttachmentTime:function(time){this._attachmentTime=this.bone.skeleton.time-time},getAttachmentTime:function(){return this.bone.skeleton.time-this._attachmentTime},setToSetupPose:function(){var data=this.data;this.r=data.r;this.g=data.g;this.b=data.b;this.a=data.a;this.blendMode=data.blendMode;var slotDatas=this.bone.skeleton.data.slots;for(var i=0,n=slotDatas.length;i<n;i++){if(slotDatas[i]==data){this.setAttachment(!data.attachmentName?null:this.bone.skeleton.getAttachmentBySlotIndex(i,data.attachmentName));break}}}};module.exports=spine.Slot},{"../SpineUtil":42}],38:[function(require,module,exports){var spine=require("../SpineUtil");spine.SlotData=function(name,boneData){this.name=name;this.boneData=boneData};spine.SlotData.PIXI_BLEND_MODE_MAP={multiply:PIXI.BLEND_MODES.MULTIPLY,screen:PIXI.BLEND_MODES.SCREEN,additive:PIXI.BLEND_MODES.ADD,normal:PIXI.BLEND_MODES.NORMAL};spine.SlotData.prototype={r:1,g:1,b:1,a:1,attachmentName:null,blendMode:PIXI.BLEND_MODES.NORMAL};module.exports=spine.SlotData},{"../SpineUtil":42}],39:[function(require,module,exports){var spine=require("../SpineUtil");spine.TrackEntry=function(){};spine.TrackEntry.prototype={next:null,previous:null,animation:null,loop:false,delay:0,time:0,lastTime:-1,endTime:0,timeScale:1,mixTime:0,mixDuration:0,mix:1,onStart:null,onEnd:null,onComplete:null,onEvent:null};module.exports=spine.TrackEntry},{"../SpineUtil":42}],40:[function(require,module,exports){var spine=require("../SpineUtil");spine.Animation=require("./Animation");spine.Curves=require("./Curves");spine.TranslateTimeline=function(frameCount){this.curves=new spine.Curves(frameCount);this.frames=[];this.frames.length=frameCount*3};spine.TranslateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(frameIndex,time,x,y){frameIndex*=3;this.frames[frameIndex]=time;this.frames[frameIndex+1]=x;this.frames[frameIndex+2]=y},apply:function(skeleton,lastTime,time,firedEvents,alpha){var frames=this.frames;if(time<frames[0])return;var bone=skeleton.bones[this.boneIndex];if(time>=frames[frames.length-3]){bone.x+=(bone.data.x+frames[frames.length-2]-bone.x)*alpha;bone.y+=(bone.data.y+frames[frames.length-1]-bone.y)*alpha;return}var frameIndex=spine.Animation.binarySearch(frames,time,3);var prevFrameX=frames[frameIndex-2];var prevFrameY=frames[frameIndex-1];var frameTime=frames[frameIndex];var percent=1-(time-frameTime)/(frames[frameIndex+-3]-frameTime);percent=this.curves.getCurvePercent(frameIndex/3-1,percent);bone.x+=(bone.data.x+prevFrameX+(frames[frameIndex+1]-prevFrameX)*percent-bone.x)*alpha;bone.y+=(bone.data.y+prevFrameY+(frames[frameIndex+2]-prevFrameY)*percent-bone.y)*alpha}};module.exports=spine.TranslateTimeline},{"../SpineUtil":42,"./Animation":2,"./Curves":16}],41:[function(require,module,exports){var spine=require("../SpineUtil");spine.Animation=require("./Animation");spine.AnimationStateData=require("./AnimationStateData");spine.AnimationState=require("./AnimationState");spine.AtlasAttachmentParser=require("./AtlasAttachmentParser");spine.Atlas=require("./Atlas");spine.AtlasPage=require("./AtlasPage");spine.AtlasReader=require("./AtlasReader");spine.AtlasRegion=require("./AtlasRegion");spine.AttachmentTimeline=require("./AttachmentTimeline");spine.AttachmentType=require("./AttachmentType");spine.BoneData=require("./BoneData");spine.Bone=require("./Bone");spine.BoundingBoxAttachment=require("./BoundingBoxAttachment");spine.ColorTimeline=require("./ColorTimeline");spine.Curves=require("./Curves");spine.DrawOrderTimeline=require("./DrawOrderTimeline");spine.EventData=require("./EventData");spine.Event=require("./Event");spine.EventTimeline=require("./EventTimeline");spine.FfdTimeline=require("./FfdTimeline");spine.FlipXTimeline=require("./FlipXTimeline");spine.FlipYTimeline=require("./FlipYTimeline");spine.IkConstraintData=require("./IkConstraintData");spine.IkConstraint=require("./IkConstraint");spine.IkConstraintTimeline=require("./IkConstraintTimeline");spine.MeshAttachment=require("./MeshAttachment");spine.RegionAttachment=require("./RegionAttachment");spine.RotateTimeline=require("./RotateTimeline");spine.ScaleTimeline=require("./ScaleTimeline");spine.SkeletonBounds=require("./SkeletonBounds");spine.SkeletonData=require("./SkeletonData");spine.Skeleton=require("./Skeleton");spine.SkeletonJsonParser=require("./SkeletonJsonParser");spine.Skin=require("./Skin.js");spine.SkinnedMeshAttachment=require("./SkinnedMeshAttachment");spine.SlotData=require("./SlotData");spine.Slot=require("./Slot");spine.TrackEntry=require("./TrackEntry");spine.TranslateTimeline=require("./TranslateTimeline");module.exports=spine},{"../SpineUtil":42,"./Animation":2,"./AnimationState":3,"./AnimationStateData":4,"./Atlas":5,"./AtlasAttachmentParser":6,"./AtlasPage":7,"./AtlasReader":8,"./AtlasRegion":9,"./AttachmentTimeline":10,"./AttachmentType":11,"./Bone":12,"./BoneData":13,"./BoundingBoxAttachment":14,"./ColorTimeline":15,"./Curves":16,"./DrawOrderTimeline":17,"./Event":18,"./EventData":19,"./EventTimeline":20,"./FfdTimeline":21,"./FlipXTimeline":22,"./FlipYTimeline":23,"./IkConstraint":24,"./IkConstraintData":25,"./IkConstraintTimeline":26,"./MeshAttachment":27,"./RegionAttachment":28,"./RotateTimeline":29,"./ScaleTimeline":30,"./Skeleton":31,"./SkeletonBounds":32,"./SkeletonData":33,"./SkeletonJsonParser":34,"./Skin.js":35,"./SkinnedMeshAttachment":36,"./Slot":37,"./SlotData":38,"./TrackEntry":39,"./TranslateTimeline":40}],42:[function(require,module,exports){module.exports={radDeg:180/Math.PI,degRad:Math.PI/180,temp:[],Float32Array:typeof Float32Array==="undefined"?Array:Float32Array,Uint16Array:typeof Uint16Array==="undefined"?Array:Uint16Array}},{}],43:[function(require,module,exports){var spine=require("../SpineRuntime");var atlasParser=require("../loaders/atlasParser");spine.Bone.yDown=true;function Spine(spineData){PIXI.Container.call(this);if(!spineData){throw new Error("The spineData param is required.")}if(typeof spineData==="string"){throw new Error('spineData param cant be string. Please use PIXI.spine.Spine.fromAtlas("YOUR_RESOURCE_NAME") from now on.')}this.spineData=spineData;this.skeleton=new spine.Skeleton(spineData);this.skeleton.updateWorldTransform();this.stateData=new spine.AnimationStateData(spineData);this.state=new spine.AnimationState(this.stateData);this.slotContainers=[];for(var i=0,n=this.skeleton.slots.length;i<n;i++){var slot=this.skeleton.slots[i];var attachment=slot.attachment;var slotContainer=new PIXI.Container;this.slotContainers.push(slotContainer);this.addChild(slotContainer);if(attachment instanceof spine.RegionAttachment){var spriteName=attachment.rendererObject.name;var sprite=this.createSprite(slot,attachment);
slot.currentSprite=sprite;slot.currentSpriteName=spriteName;slotContainer.addChild(sprite)}else if(attachment instanceof spine.MeshAttachment){var mesh=this.createMesh(slot,attachment);slot.currentMesh=mesh;slot.currentMeshName=attachment.name;slotContainer.addChild(mesh)}else{continue}}this.autoUpdate=true}Spine.fromAtlas=function(resourceName){var skeletonData=atlasParser.AnimCache[resourceName];if(!skeletonData){throw new Error('Spine data "'+resourceName+'" does not exist in the animation cache')}return new Spine(skeletonData)};Spine.prototype=Object.create(PIXI.Container.prototype);Spine.prototype.constructor=Spine;module.exports=Spine;Spine.globalAutoUpdate=true;Object.defineProperties(Spine.prototype,{autoUpdate:{get:function(){return this.updateTransform===Spine.prototype.autoUpdateTransform},set:function(value){this.updateTransform=value?Spine.prototype.autoUpdateTransform:PIXI.Container.prototype.updateTransform}}});Spine.prototype.update=function(dt){this.state.update(dt);this.state.apply(this.skeleton);this.skeleton.updateWorldTransform();var drawOrder=this.skeleton.drawOrder;var slots=this.skeleton.slots;for(var i=0,n=drawOrder.length;i<n;i++){this.children[i]=this.slotContainers[drawOrder[i]]}for(i=0,n=slots.length;i<n;i++){var slot=slots[i];var attachment=slot.attachment;var slotContainer=this.slotContainers[i];if(!attachment){slotContainer.visible=false;continue}var type=attachment.type;if(type===spine.AttachmentType.region){if(attachment.rendererObject){if(!slot.currentSpriteName||slot.currentSpriteName!==attachment.rendererObject.name){var spriteName=attachment.rendererObject.name;if(slot.currentSprite!==undefined){slot.currentSprite.visible=false}slot.sprites=slot.sprites||{};if(slot.sprites[spriteName]!==undefined){slot.sprites[spriteName].visible=true}else{var sprite=this.createSprite(slot,attachment);slotContainer.addChild(sprite)}slot.currentSprite=slot.sprites[spriteName];slot.currentSpriteName=spriteName}}var bone=slot.bone;slotContainer.position.x=bone.worldX+attachment.x*bone.m00+attachment.y*bone.m01;slotContainer.position.y=bone.worldY+attachment.x*bone.m10+attachment.y*bone.m11;slotContainer.scale.x=bone.worldScaleX;slotContainer.scale.y=bone.worldScaleY;slotContainer.rotation=-(slot.bone.worldRotation*spine.degRad);if(bone.worldFlipX){slotContainer.scale.x=-slotContainer.scale.x;slotContainer.rotation=-slotContainer.rotation}if(bone.worldFlipY==spine.Bone.yDown){slotContainer.scale.y=-slotContainer.scale.y;slotContainer.rotation=-slotContainer.rotation}slot.currentSprite.blendMode=slot.blendMode;slot.currentSprite.tint=PIXI.utils.rgb2hex([slot.r,slot.g,slot.b])}else if(type===spine.AttachmentType.skinnedmesh||type===spine.AttachmentType.mesh){if(!slot.currentMeshName||slot.currentMeshName!==attachment.name){var meshName=attachment.name;if(slot.currentMesh!==undefined){slot.currentMesh.visible=false}slot.meshes=slot.meshes||{};if(slot.meshes[meshName]!==undefined){slot.meshes[meshName].visible=true}else{var mesh=this.createMesh(slot,attachment);slotContainer.addChild(mesh)}slot.currentMesh=slot.meshes[meshName];slot.currentMeshName=meshName}attachment.computeWorldVertices(slot.bone.skeleton.x,slot.bone.skeleton.y,slot,slot.currentMesh.vertices)}else{slotContainer.visible=false;continue}slotContainer.visible=true;slotContainer.alpha=slot.a}};Spine.prototype.autoUpdateTransform=function(){if(Spine.globalAutoUpdate){this.lastTime=this.lastTime||Date.now();var timeDelta=(Date.now()-this.lastTime)*.001;this.lastTime=Date.now();this.update(timeDelta)}else{this.lastTime=0}PIXI.Container.prototype.updateTransform.call(this)};Spine.prototype.createSprite=function(slot,attachment){var descriptor=attachment.rendererObject;var baseTexture=descriptor.page.rendererObject;var spriteRect=new PIXI.Rectangle(descriptor.x,descriptor.y,descriptor.rotate?descriptor.height:descriptor.width,descriptor.rotate?descriptor.width:descriptor.height);var spriteTexture=new PIXI.Texture(baseTexture,spriteRect);var sprite=new PIXI.Sprite(spriteTexture);var baseRotation=descriptor.rotate?Math.PI*.5:0;sprite.scale.x=attachment.width/descriptor.originalWidth*attachment.scaleX;sprite.scale.y=attachment.height/descriptor.originalHeight*attachment.scaleY;sprite.rotation=baseRotation-attachment.rotation*spine.degRad;sprite.anchor.x=(.5*descriptor.originalWidth-descriptor.offsetX)/descriptor.width;sprite.anchor.y=1-(.5*descriptor.originalHeight-descriptor.offsetY)/descriptor.height;sprite.alpha=attachment.a;slot.sprites=slot.sprites||{};slot.sprites[descriptor.name]=sprite;return sprite};Spine.prototype.createMesh=function(slot,attachment){var descriptor=attachment.rendererObject;var baseTexture=descriptor.page.rendererObject;var texture=new PIXI.Texture(baseTexture);var strip=new PIXI.mesh.Mesh(texture,new Float32Array(attachment.uvs.length),new Float32Array(attachment.uvs),new Uint16Array(attachment.triangles),PIXI.mesh.Mesh.DRAW_MODES.TRIANGLES);strip.canvasPadding=1.5;strip.alpha=attachment.a;slot.meshes=slot.meshes||{};slot.meshes[attachment.name]=strip;return strip}},{"../SpineRuntime":41,"../loaders/atlasParser":45}],44:[function(require,module,exports){var atlasParser=require("./atlasParser");PIXI.loaders.Loader.addPixiMiddleware(atlasParser);PIXI.loader.use(atlasParser())},{"./atlasParser":45}],45:[function(require,module,exports){var Resource=PIXI.loaders.Resource,spine=require("../SpineRuntime"),imageLoaderAdapter=require("./imageLoaderAdapter");var atlasParser=module.exports=function(){return function(resource,next){if(!resource.data||!resource.isJson||!resource.data.bones){return next()}var atlasPath=resource.url.substr(0,resource.url.lastIndexOf("."))+".atlas";var atlasOptions={crossOrigin:resource.crossOrigin,xhrType:Resource.XHR_RESPONSE_TYPE.TEXT,metadata:resource.metadata.spineMetadata};var imageOptions={crossOrigin:resource.crossOrigin,metadata:resource.metadata.imageMetadata};var baseUrl=resource.url.substr(0,resource.url.lastIndexOf("/")+1);var adapter=imageLoaderAdapter(this,resource.name+"_atlas_page_",baseUrl,imageOptions);this.add(resource.name+"_atlas",atlasPath,atlasOptions,function(res){new spine.Atlas(this.xhr.responseText,adapter,function(spineAtlas){var spineJsonParser=new spine.SkeletonJsonParser(new spine.AtlasAttachmentParser(spineAtlas));var skeletonData=spineJsonParser.readSkeletonData(resource.data);resource.spineData=skeletonData;resource.spineAtlas=spineAtlas;if(atlasParser.enableCaching)atlasParser.AnimCache[resource.name]=resource.spineData;next()})})}};atlasParser.AnimCache={};atlasParser.enableCaching=true},{"../SpineRuntime":41,"./imageLoaderAdapter":46}],46:[function(require,module,exports){var spine=require("../SpineRuntime");module.exports=function(loader,namePrefix,baseUrl,imageOptions){if(baseUrl&&baseUrl.lastIndexOf("/")!==baseUrl.length-1){baseUrl+="/"}return function(line,callback){var name=namePrefix+line;var url=baseUrl+line;loader.add(name,url,imageOptions,function(resource){callback(resource.texture.baseTexture)})}}},{"../SpineRuntime":41}],47:[function(require,module,exports){module.exports={atlasParser:require("./atlasParser"),Loader:require("./Loader"),syncImageLoaderAdapter:require("./syncImageLoaderAdapter"),imageLoaderAdapter:require("./imageLoaderAdapter")}},{"./Loader":44,"./atlasParser":45,"./imageLoaderAdapter":46,"./syncImageLoaderAdapter":48}],48:[function(require,module,exports){var spine=require("../SpineRuntime");module.exports=function(baseUrl,crossOrigin){if(baseUrl&&baseUrl.lastIndexOf("/")!==baseUrl.length-1){baseUrl+="/"}return function(line,callback){callback(PIXI.BaseTexture.fromImage(line,crossOrigin))}}},{"../SpineRuntime":41}]},{},[1]);(window._gsQueue||(window._gsQueue=[])).push(function(){"use strict";window._gsDefine("easing.Back",["easing.Ease"],function(t){var e,i,s,r=window.GreenSockGlobals||window,n=r.com.greensock,a=2*Math.PI,o=Math.PI/2,h=n._class,l=function(e,i){var s=h("easing."+e,function(){},!0),r=s.prototype=new t;return r.constructor=s,r.getRatio=i,s},_=t.register||function(){},u=function(t,e,i,s){var r=h("easing."+t,{easeOut:new e,easeIn:new i,easeInOut:new s},!0);return _(r,t),r},c=function(t,e,i){this.t=t,this.v=e,i&&(this.next=i,i.prev=this,this.c=i.v-e,this.gap=i.t-t)},p=function(e,i){var s=h("easing."+e,function(t){this._p1=t||0===t?t:1.70158,this._p2=1.525*this._p1},!0),r=s.prototype=new t;return r.constructor=s,r.getRatio=i,r.config=function(t){return new s(t)},s},f=u("Back",p("BackOut",function(t){return(t-=1)*t*((this._p1+1)*t+this._p1)+1}),p("BackIn",function(t){return t*t*((this._p1+1)*t-this._p1)}),p("BackInOut",function(t){return 1>(t*=2)?.5*t*t*((this._p2+1)*t-this._p2):.5*((t-=2)*t*((this._p2+1)*t+this._p2)+2)})),m=h("easing.SlowMo",function(t,e,i){e=e||0===e?e:.7,null==t?t=.7:t>1&&(t=1),this._p=1!==t?e:0,this._p1=(1-t)/2,this._p2=t,this._p3=this._p1+this._p2,this._calcEnd=i===!0},!0),d=m.prototype=new t;return d.constructor=m,d.getRatio=function(t){var e=t+(.5-t)*this._p;return this._p1>t?this._calcEnd?1-(t=1-t/this._p1)*t:e-(t=1-t/this._p1)*t*t*t*e:t>this._p3?this._calcEnd?1-(t=(t-this._p3)/this._p1)*t:e+(t-e)*(t=(t-this._p3)/this._p1)*t*t*t:this._calcEnd?1:e},m.ease=new m(.7,.7),d.config=m.config=function(t,e,i){return new m(t,e,i)},e=h("easing.SteppedEase",function(t){t=t||1,this._p1=1/t,this._p2=t+1},!0),d=e.prototype=new t,d.constructor=e,d.getRatio=function(t){return 0>t?t=0:t>=1&&(t=.999999999),(this._p2*t>>0)*this._p1},d.config=e.config=function(t){return new e(t)},i=h("easing.RoughEase",function(e){e=e||{};for(var i,s,r,n,a,o,h=e.taper||"none",l=[],_=0,u=0|(e.points||20),p=u,f=e.randomize!==!1,m=e.clamp===!0,d=e.template instanceof t?e.template:null,g="number"==typeof e.strength?.4*e.strength:.4;--p>-1;)i=f?Math.random():1/u*p,s=d?d.getRatio(i):i,"none"===h?r=g:"out"===h?(n=1-i,r=n*n*g):"in"===h?r=i*i*g:.5>i?(n=2*i,r=.5*n*n*g):(n=2*(1-i),r=.5*n*n*g),f?s+=Math.random()*r-.5*r:p%2?s+=.5*r:s-=.5*r,m&&(s>1?s=1:0>s&&(s=0)),l[_++]={x:i,y:s};for(l.sort(function(t,e){return t.x-e.x}),o=new c(1,1,null),p=u;--p>-1;)a=l[p],o=new c(a.x,a.y,o);this._prev=new c(0,0,0!==o.t?o:o.next)},!0),d=i.prototype=new t,d.constructor=i,d.getRatio=function(t){var e=this._prev;if(t>e.t){for(;e.next&&t>=e.t;)e=e.next;e=e.prev}else for(;e.prev&&e.t>=t;)e=e.prev;return this._prev=e,e.v+(t-e.t)/e.gap*e.c},d.config=function(t){return new i(t)},i.ease=new i,u("Bounce",l("BounceOut",function(t){return 1/2.75>t?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}),l("BounceIn",function(t){return 1/2.75>(t=1-t)?1-7.5625*t*t:2/2.75>t?1-(7.5625*(t-=1.5/2.75)*t+.75):2.5/2.75>t?1-(7.5625*(t-=2.25/2.75)*t+.9375):1-(7.5625*(t-=2.625/2.75)*t+.984375)}),l("BounceInOut",function(t){var e=.5>t;return t=e?1-2*t:2*t-1,t=1/2.75>t?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375,e?.5*(1-t):.5*t+.5})),u("Circ",l("CircOut",function(t){return Math.sqrt(1-(t-=1)*t)}),l("CircIn",function(t){return-(Math.sqrt(1-t*t)-1)}),l("CircInOut",function(t){return 1>(t*=2)?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)})),s=function(e,i,s){var r=h("easing."+e,function(t,e){this._p1=t||1,this._p2=e||s,this._p3=this._p2/a*(Math.asin(1/this._p1)||0)},!0),n=r.prototype=new t;return n.constructor=r,n.getRatio=i,n.config=function(t,e){return new r(t,e)},r},u("Elastic",s("ElasticOut",function(t){return this._p1*Math.pow(2,-10*t)*Math.sin((t-this._p3)*a/this._p2)+1},.3),s("ElasticIn",function(t){return-(this._p1*Math.pow(2,10*(t-=1))*Math.sin((t-this._p3)*a/this._p2))},.3),s("ElasticInOut",function(t){return 1>(t*=2)?-.5*this._p1*Math.pow(2,10*(t-=1))*Math.sin((t-this._p3)*a/this._p2):.5*this._p1*Math.pow(2,-10*(t-=1))*Math.sin((t-this._p3)*a/this._p2)+1},.45)),u("Expo",l("ExpoOut",function(t){return 1-Math.pow(2,-10*t)}),l("ExpoIn",function(t){return Math.pow(2,10*(t-1))-.001}),l("ExpoInOut",function(t){return 1>(t*=2)?.5*Math.pow(2,10*(t-1)):.5*(2-Math.pow(2,-10*(t-1)))})),u("Sine",l("SineOut",function(t){return Math.sin(t*o)}),l("SineIn",function(t){return-Math.cos(t*o)+1}),l("SineInOut",function(t){return-.5*(Math.cos(Math.PI*t)-1)})),h("easing.EaseLookup",{find:function(e){return t.map[e]}},!0),_(r.SlowMo,"SlowMo","ease,"),_(i,"RoughEase","ease,"),_(e,"SteppedEase","ease,"),f},!0)}),window._gsDefine&&window._gsQueue.pop()();(function(t){"use strict";var e=t.GreenSockGlobals||t;if(!e.TweenLite){var i,s,r,n,a,o=function(t){var i,s=t.split("."),r=e;for(i=0;s.length>i;i++)r[s[i]]=r=r[s[i]]||{};return r},l=o("com.greensock"),h=1e-10,_=[].slice,u=function(){},m=function(){var t=Object.prototype.toString,e=t.call([]);return function(i){return i instanceof Array||"object"==typeof i&&!!i.push&&t.call(i)===e}}(),f={},p=function(i,s,r,n){this.sc=f[i]?f[i].sc:[],f[i]=this,this.gsClass=null,this.func=r;var a=[];this.check=function(l){for(var h,_,u,m,c=s.length,d=c;--c>-1;)(h=f[s[c]]||new p(s[c],[])).gsClass?(a[c]=h.gsClass,d--):l&&h.sc.push(this);if(0===d&&r)for(_=("com.greensock."+i).split("."),u=_.pop(),m=o(_.join("."))[u]=this.gsClass=r.apply(r,a),n&&(e[u]=m,"function"==typeof define&&define.amd?define((t.GreenSockAMDPath?t.GreenSockAMDPath+"/":"")+i.split(".").join("/"),[],function(){return m}):"undefined"!=typeof module&&module.exports&&(module.exports=m)),c=0;this.sc.length>c;c++)this.sc[c].check()},this.check(!0)},c=t._gsDefine=function(t,e,i,s){return new p(t,e,i,s)},d=l._class=function(t,e,i){return e=e||function(){},c(t,[],function(){return e},i),e};c.globals=e;var v=[0,0,1,1],g=[],T=d("easing.Ease",function(t,e,i,s){this._func=t,this._type=i||0,this._power=s||0,this._params=e?v.concat(e):v},!0),w=T.map={},P=T.register=function(t,e,i,s){for(var r,n,a,o,h=e.split(","),_=h.length,u=(i||"easeIn,easeOut,easeInOut").split(",");--_>-1;)for(n=h[_],r=s?d("easing."+n,null,!0):l.easing[n]||{},a=u.length;--a>-1;)o=u[a],w[n+"."+o]=w[o+n]=r[o]=t.getRatio?t:t[o]||new t};for(r=T.prototype,r._calcEnd=!1,r.getRatio=function(t){if(this._func)return this._params[0]=t,this._func.apply(null,this._params);var e=this._type,i=this._power,s=1===e?1-t:2===e?t:.5>t?2*t:2*(1-t);return 1===i?s*=s:2===i?s*=s*s:3===i?s*=s*s*s:4===i&&(s*=s*s*s*s),1===e?1-s:2===e?s:.5>t?s/2:1-s/2},i=["Linear","Quad","Cubic","Quart","Quint,Strong"],s=i.length;--s>-1;)r=i[s]+",Power"+s,P(new T(null,null,1,s),r,"easeOut",!0),P(new T(null,null,2,s),r,"easeIn"+(0===s?",easeNone":"")),P(new T(null,null,3,s),r,"easeInOut");w.linear=l.easing.Linear.easeIn,w.swing=l.easing.Quad.easeInOut;var y=d("events.EventDispatcher",function(t){this._listeners={},this._eventTarget=t||this});r=y.prototype,r.addEventListener=function(t,e,i,s,r){r=r||0;var o,l,h=this._listeners[t],_=0;for(null==h&&(this._listeners[t]=h=[]),l=h.length;--l>-1;)o=h[l],o.c===e&&o.s===i?h.splice(l,1):0===_&&r>o.pr&&(_=l+1);h.splice(_,0,{c:e,s:i,up:s,pr:r}),this!==n||a||n.wake()},r.removeEventListener=function(t,e){var i,s=this._listeners[t];if(s)for(i=s.length;--i>-1;)if(s[i].c===e)return s.splice(i,1),void 0},r.dispatchEvent=function(t){var e,i,s,r=this._listeners[t];if(r)for(e=r.length,i=this._eventTarget;--e>-1;)s=r[e],s.up?s.c.call(s.s||i,{type:t,target:i}):s.c.call(s.s||i)};var b=t.requestAnimationFrame,k=t.cancelAnimationFrame,A=Date.now||function(){return(new Date).getTime()},S=A();for(i=["ms","moz","webkit","o"],s=i.length;--s>-1&&!b;)b=t[i[s]+"RequestAnimationFrame"],k=t[i[s]+"CancelAnimationFrame"]||t[i[s]+"CancelRequestAnimationFrame"];d("Ticker",function(t,e){var i,s,r,o,l,h=this,_=A(),m=e!==!1&&b,f=function(t){S=A(),h.time=(S-_)/1e3;var e,n=h.time-l;(!i||n>0||t===!0)&&(h.frame++,l+=n+(n>=o?.004:o-n),e=!0),t!==!0&&(r=s(f)),e&&h.dispatchEvent("tick")};y.call(h),h.time=h.frame=0,h.tick=function(){f(!0)},h.sleep=function(){null!=r&&(m&&k?k(r):clearTimeout(r),s=u,r=null,h===n&&(a=!1))},h.wake=function(){null!==r&&h.sleep(),s=0===i?u:m&&b?b:function(t){return setTimeout(t,0|1e3*(l-h.time)+1)},h===n&&(a=!0),f(2)},h.fps=function(t){return arguments.length?(i=t,o=1/(i||60),l=this.time+o,h.wake(),void 0):i},h.useRAF=function(t){return arguments.length?(h.sleep(),m=t,h.fps(i),void 0):m},h.fps(t),setTimeout(function(){m&&(!r||5>h.frame)&&h.useRAF(!1)},1500)}),r=l.Ticker.prototype=new l.events.EventDispatcher,r.constructor=l.Ticker;var x=d("core.Animation",function(t,e){if(this.vars=e=e||{},this._duration=this._totalDuration=t||0,this._delay=Number(e.delay)||0,this._timeScale=1,this._active=e.immediateRender===!0,this.data=e.data,this._reversed=e.reversed===!0,Q){a||n.wake();var i=this.vars.useFrames?G:Q;i.add(this,i._time),this.vars.paused&&this.paused(!0)}});n=x.ticker=new l.Ticker,r=x.prototype,r._dirty=r._gc=r._initted=r._paused=!1,r._totalTime=r._time=0,r._rawPrevTime=-1,r._next=r._last=r._onUpdate=r._timeline=r.timeline=null,r._paused=!1;var C=function(){a&&A()-S>2e3&&n.wake(),setTimeout(C,2e3)};C(),r.play=function(t,e){return arguments.length&&this.seek(t,e),this.reversed(!1).paused(!1)},r.pause=function(t,e){return arguments.length&&this.seek(t,e),this.paused(!0)},r.resume=function(t,e){return arguments.length&&this.seek(t,e),this.paused(!1)},r.seek=function(t,e){return this.totalTime(Number(t),e!==!1)},r.restart=function(t,e){return this.reversed(!1).paused(!1).totalTime(t?-this._delay:0,e!==!1,!0)},r.reverse=function(t,e){return arguments.length&&this.seek(t||this.totalDuration(),e),this.reversed(!0).paused(!1)},r.render=function(){},r.invalidate=function(){return this},r.isActive=function(){var t,e=this._timeline,i=this._startTime;return!e||!this._gc&&!this._paused&&e.isActive()&&(t=e.rawTime())>=i&&i+this.totalDuration()/this._timeScale>t},r._enabled=function(t,e){return a||n.wake(),this._gc=!t,this._active=this.isActive(),e!==!0&&(t&&!this.timeline?this._timeline.add(this,this._startTime-this._delay):!t&&this.timeline&&this._timeline._remove(this,!0)),!1},r._kill=function(){return this._enabled(!1,!1)},r.kill=function(t,e){return this._kill(t,e),this},r._uncache=function(t){for(var e=t?this:this.timeline;e;)e._dirty=!0,e=e.timeline;return this},r._swapSelfInParams=function(t){for(var e=t.length,i=t.concat();--e>-1;)"{self}"===t[e]&&(i[e]=this);return i},r.eventCallback=function(t,e,i,s){if("on"===(t||"").substr(0,2)){var r=this.vars;if(1===arguments.length)return r[t];null==e?delete r[t]:(r[t]=e,r[t+"Params"]=m(i)&&-1!==i.join("").indexOf("{self}")?this._swapSelfInParams(i):i,r[t+"Scope"]=s),"onUpdate"===t&&(this._onUpdate=e)}return this},r.delay=function(t){return arguments.length?(this._timeline.smoothChildTiming&&this.startTime(this._startTime+t-this._delay),this._delay=t,this):this._delay},r.duration=function(t){return arguments.length?(this._duration=this._totalDuration=t,this._uncache(!0),this._timeline.smoothChildTiming&&this._time>0&&this._time<this._duration&&0!==t&&this.totalTime(this._totalTime*(t/this._duration),!0),this):(this._dirty=!1,this._duration)},r.totalDuration=function(t){return this._dirty=!1,arguments.length?this.duration(t):this._totalDuration},r.time=function(t,e){return arguments.length?(this._dirty&&this.totalDuration(),this.totalTime(t>this._duration?this._duration:t,e)):this._time},r.totalTime=function(t,e,i){if(a||n.wake(),!arguments.length)return this._totalTime;if(this._timeline){if(0>t&&!i&&(t+=this.totalDuration()),this._timeline.smoothChildTiming){this._dirty&&this.totalDuration();var s=this._totalDuration,r=this._timeline;if(t>s&&!i&&(t=s),this._startTime=(this._paused?this._pauseTime:r._time)-(this._reversed?s-t:t)/this._timeScale,r._dirty||this._uncache(!1),r._timeline)for(;r._timeline;)r._timeline._time!==(r._startTime+r._totalTime)/r._timeScale&&r.totalTime(r._totalTime,!0),r=r._timeline}this._gc&&this._enabled(!0,!1),(this._totalTime!==t||0===this._duration)&&this.render(t,e,!1)}return this},r.progress=r.totalProgress=function(t,e){return arguments.length?this.totalTime(this.duration()*t,e):this._time/this.duration()},r.startTime=function(t){return arguments.length?(t!==this._startTime&&(this._startTime=t,this.timeline&&this.timeline._sortChildren&&this.timeline.add(this,t-this._delay)),this):this._startTime},r.timeScale=function(t){if(!arguments.length)return this._timeScale;if(t=t||h,this._timeline&&this._timeline.smoothChildTiming){var e=this._pauseTime,i=e||0===e?e:this._timeline.totalTime();this._startTime=i-(i-this._startTime)*this._timeScale/t}return this._timeScale=t,this._uncache(!1)},r.reversed=function(t){return arguments.length?(t!=this._reversed&&(this._reversed=t,this.totalTime(this._totalTime,!0)),this):this._reversed},r.paused=function(t){if(!arguments.length)return this._paused;if(t!=this._paused&&this._timeline){a||t||n.wake();var e=this._timeline,i=e.rawTime(),s=i-this._pauseTime;!t&&e.smoothChildTiming&&(this._startTime+=s,this._uncache(!1)),this._pauseTime=t?i:null,this._paused=t,this._active=this.isActive(),!t&&0!==s&&this._initted&&this.duration()&&this.render(e.smoothChildTiming?this._totalTime:(i-this._startTime)/this._timeScale,!0,!0)}return this._gc&&!t&&this._enabled(!0,!1),this};var R=d("core.SimpleTimeline",function(t){x.call(this,0,t),this.autoRemoveChildren=this.smoothChildTiming=!0});r=R.prototype=new x,r.constructor=R,r.kill()._gc=!1,r._first=r._last=null,r._sortChildren=!1,r.add=r.insert=function(t,e){var i,s;if(t._startTime=Number(e||0)+t._delay,t._paused&&this!==t._timeline&&(t._pauseTime=t._startTime+(this.rawTime()-t._startTime)/t._timeScale),t.timeline&&t.timeline._remove(t,!0),t.timeline=t._timeline=this,t._gc&&t._enabled(!0,!0),i=this._last,this._sortChildren)for(s=t._startTime;i&&i._startTime>s;)i=i._prev;return i?(t._next=i._next,i._next=t):(t._next=this._first,this._first=t),t._next?t._next._prev=t:this._last=t,t._prev=i,this._timeline&&this._uncache(!0),this},r._remove=function(t,e){return t.timeline===this&&(e||t._enabled(!1,!0),t.timeline=null,t._prev?t._prev._next=t._next:this._first===t&&(this._first=t._next),t._next?t._next._prev=t._prev:this._last===t&&(this._last=t._prev),this._timeline&&this._uncache(!0)),this},r.render=function(t,e,i){var s,r=this._first;for(this._totalTime=this._time=this._rawPrevTime=t;r;)s=r._next,(r._active||t>=r._startTime&&!r._paused)&&(r._reversed?r.render((r._dirty?r.totalDuration():r._totalDuration)-(t-r._startTime)*r._timeScale,e,i):r.render((t-r._startTime)*r._timeScale,e,i)),r=s},r.rawTime=function(){return a||n.wake(),this._totalTime};var D=d("TweenLite",function(e,i,s){if(x.call(this,i,s),this.render=D.prototype.render,null==e)throw"Cannot tween a null target.";this.target=e="string"!=typeof e?e:D.selector(e)||e;var r,n,a,o=e.jquery||e.length&&e!==t&&e[0]&&(e[0]===t||e[0].nodeType&&e[0].style&&!e.nodeType),l=this.vars.overwrite;if(this._overwrite=l=null==l?j[D.defaultOverwrite]:"number"==typeof l?l>>0:j[l],(o||e instanceof Array||e.push&&m(e))&&"number"!=typeof e[0])for(this._targets=a=_.call(e,0),this._propLookup=[],this._siblings=[],r=0;a.length>r;r++)n=a[r],n?"string"!=typeof n?n.length&&n!==t&&n[0]&&(n[0]===t||n[0].nodeType&&n[0].style&&!n.nodeType)?(a.splice(r--,1),this._targets=a=a.concat(_.call(n,0))):(this._siblings[r]=B(n,this,!1),1===l&&this._siblings[r].length>1&&q(n,this,null,1,this._siblings[r])):(n=a[r--]=D.selector(n),"string"==typeof n&&a.splice(r+1,1)):a.splice(r--,1);else this._propLookup={},this._siblings=B(e,this,!1),1===l&&this._siblings.length>1&&q(e,this,null,1,this._siblings);(this.vars.immediateRender||0===i&&0===this._delay&&this.vars.immediateRender!==!1)&&this.render(-this._delay,!1,!0)},!0),E=function(e){return e.length&&e!==t&&e[0]&&(e[0]===t||e[0].nodeType&&e[0].style&&!e.nodeType)},I=function(t,e){var i,s={};for(i in t)F[i]||i in e&&"x"!==i&&"y"!==i&&"width"!==i&&"height"!==i&&"className"!==i&&"border"!==i||!(!N[i]||N[i]&&N[i]._autoCSS)||(s[i]=t[i],delete t[i]);t.css=s};r=D.prototype=new x,r.constructor=D,r.kill()._gc=!1,r.ratio=0,r._firstPT=r._targets=r._overwrittenProps=r._startAt=null,r._notifyPluginsOfEnabled=!1,D.version="1.11.2",D.defaultEase=r._ease=new T(null,null,1,1),D.defaultOverwrite="auto",D.ticker=n,D.autoSleep=!0,D.selector=t.$||t.jQuery||function(e){return t.$?(D.selector=t.$,t.$(e)):t.document?t.document.getElementById("#"===e.charAt(0)?e.substr(1):e):e};var O=D._internals={isArray:m,isSelector:E},N=D._plugins={},L=D._tweenLookup={},U=0,F=O.reservedProps={ease:1,delay:1,overwrite:1,onComplete:1,onCompleteParams:1,onCompleteScope:1,useFrames:1,runBackwards:1,startAt:1,onUpdate:1,onUpdateParams:1,onUpdateScope:1,onStart:1,onStartParams:1,onStartScope:1,onReverseComplete:1,onReverseCompleteParams:1,onReverseCompleteScope:1,onRepeat:1,onRepeatParams:1,onRepeatScope:1,easeParams:1,yoyo:1,immediateRender:1,repeat:1,repeatDelay:1,data:1,paused:1,reversed:1,autoCSS:1},j={none:0,all:1,auto:2,concurrent:3,allOnStart:4,preexisting:5,"true":1,"false":0},G=x._rootFramesTimeline=new R,Q=x._rootTimeline=new R;Q._startTime=n.time,G._startTime=n.frame,Q._active=G._active=!0,x._updateRoot=function(){if(Q.render((n.time-Q._startTime)*Q._timeScale,!1,!1),G.render((n.frame-G._startTime)*G._timeScale,!1,!1),!(n.frame%120)){var t,e,i;for(i in L){for(e=L[i].tweens,t=e.length;--t>-1;)e[t]._gc&&e.splice(t,1);0===e.length&&delete L[i]}if(i=Q._first,(!i||i._paused)&&D.autoSleep&&!G._first&&1===n._listeners.tick.length){for(;i&&i._paused;)i=i._next;i||n.sleep()}}},n.addEventListener("tick",x._updateRoot);var B=function(t,e,i){var s,r,n=t._gsTweenID;if(L[n||(t._gsTweenID=n="t"+U++)]||(L[n]={target:t,tweens:[]}),e&&(s=L[n].tweens,s[r=s.length]=e,i))for(;--r>-1;)s[r]===e&&s.splice(r,1);return L[n].tweens},q=function(t,e,i,s,r){var n,a,o,l;if(1===s||s>=4){for(l=r.length,n=0;l>n;n++)if((o=r[n])!==e)o._gc||o._enabled(!1,!1)&&(a=!0);else if(5===s)break;return a}var _,u=e._startTime+h,m=[],f=0,p=0===e._duration;for(n=r.length;--n>-1;)(o=r[n])===e||o._gc||o._paused||(o._timeline!==e._timeline?(_=_||$(e,0,p),0===$(o,_,p)&&(m[f++]=o)):u>=o._startTime&&o._startTime+o.totalDuration()/o._timeScale+h>u&&((p||!o._initted)&&2e-10>=u-o._startTime||(m[f++]=o)));for(n=f;--n>-1;)o=m[n],2===s&&o._kill(i,t)&&(a=!0),(2!==s||!o._firstPT&&o._initted)&&o._enabled(!1,!1)&&(a=!0);return a},$=function(t,e,i){for(var s=t._timeline,r=s._timeScale,n=t._startTime;s._timeline;){if(n+=s._startTime,r*=s._timeScale,s._paused)return-100;s=s._timeline}return n/=r,n>e?n-e:i&&n===e||!t._initted&&2*h>n-e?h:(n+=t.totalDuration()/t._timeScale/r)>e+h?0:n-e-h};r._init=function(){var t,e,i,s,r=this.vars,n=this._overwrittenProps,a=this._duration,o=r.immediateRender,l=r.ease;if(r.startAt){if(this._startAt&&this._startAt.render(-1,!0),r.startAt.overwrite=0,r.startAt.immediateRender=!0,this._startAt=D.to(this.target,0,r.startAt),o)if(this._time>0)this._startAt=null;else if(0!==a)return}else if(r.runBackwards&&0!==a)if(this._startAt)this._startAt.render(-1,!0),this._startAt=null;else{i={};for(s in r)F[s]&&"autoCSS"!==s||(i[s]=r[s]);if(i.overwrite=0,i.data="isFromStart",this._startAt=D.to(this.target,0,i),r.immediateRender){if(0===this._time)return}else this._startAt.render(-1,!0)}if(this._ease=l?l instanceof T?r.easeParams instanceof Array?l.config.apply(l,r.easeParams):l:"function"==typeof l?new T(l,r.easeParams):w[l]||D.defaultEase:D.defaultEase,this._easeType=this._ease._type,this._easePower=this._ease._power,this._firstPT=null,this._targets)for(t=this._targets.length;--t>-1;)this._initProps(this._targets[t],this._propLookup[t]={},this._siblings[t],n?n[t]:null)&&(e=!0);else e=this._initProps(this.target,this._propLookup,this._siblings,n);if(e&&D._onPluginEvent("_onInitAllProps",this),n&&(this._firstPT||"function"!=typeof this.target&&this._enabled(!1,!1)),r.runBackwards)for(i=this._firstPT;i;)i.s+=i.c,i.c=-i.c,i=i._next;this._onUpdate=r.onUpdate,this._initted=!0},r._initProps=function(e,i,s,r){var n,a,o,l,h,_;if(null==e)return!1;this.vars.css||e.style&&e!==t&&e.nodeType&&N.css&&this.vars.autoCSS!==!1&&I(this.vars,e);for(n in this.vars){if(_=this.vars[n],F[n])_&&(_ instanceof Array||_.push&&m(_))&&-1!==_.join("").indexOf("{self}")&&(this.vars[n]=_=this._swapSelfInParams(_,this));else if(N[n]&&(l=new N[n])._onInitTween(e,this.vars[n],this)){for(this._firstPT=h={_next:this._firstPT,t:l,p:"setRatio",s:0,c:1,f:!0,n:n,pg:!0,pr:l._priority},a=l._overwriteProps.length;--a>-1;)i[l._overwriteProps[a]]=this._firstPT;(l._priority||l._onInitAllProps)&&(o=!0),(l._onDisable||l._onEnable)&&(this._notifyPluginsOfEnabled=!0)}else this._firstPT=i[n]=h={_next:this._firstPT,t:e,p:n,f:"function"==typeof e[n],n:n,pg:!1,pr:0},h.s=h.f?e[n.indexOf("set")||"function"!=typeof e["get"+n.substr(3)]?n:"get"+n.substr(3)]():parseFloat(e[n]),h.c="string"==typeof _&&"="===_.charAt(1)?parseInt(_.charAt(0)+"1",10)*Number(_.substr(2)):Number(_)-h.s||0;h&&h._next&&(h._next._prev=h)}return r&&this._kill(r,e)?this._initProps(e,i,s,r):this._overwrite>1&&this._firstPT&&s.length>1&&q(e,this,i,this._overwrite,s)?(this._kill(i,e),this._initProps(e,i,s,r)):o},r.render=function(t,e,i){var s,r,n,a,o=this._time,l=this._duration;if(t>=l)this._totalTime=this._time=l,this.ratio=this._ease._calcEnd?this._ease.getRatio(1):1,this._reversed||(s=!0,r="onComplete"),0===l&&(a=this._rawPrevTime,(0===t||0>a||a===h)&&a!==t&&(i=!0,a>h&&(r="onReverseComplete")),this._rawPrevTime=a=!e||t?t:h);else if(1e-7>t)this._totalTime=this._time=0,this.ratio=this._ease._calcEnd?this._ease.getRatio(0):0,(0!==o||0===l&&this._rawPrevTime>h)&&(r="onReverseComplete",s=this._reversed),0>t?(this._active=!1,0===l&&(this._rawPrevTime>=0&&(i=!0),this._rawPrevTime=a=!e||t?t:h)):this._initted||(i=!0);else if(this._totalTime=this._time=t,this._easeType){var _=t/l,u=this._easeType,m=this._easePower;(1===u||3===u&&_>=.5)&&(_=1-_),3===u&&(_*=2),1===m?_*=_:2===m?_*=_*_:3===m?_*=_*_*_:4===m&&(_*=_*_*_*_),this.ratio=1===u?1-_:2===u?_:.5>t/l?_/2:1-_/2}else this.ratio=this._ease.getRatio(t/l);if(this._time!==o||i){if(!this._initted){if(this._init(),!this._initted||this._gc)return;this._time&&!s?this.ratio=this._ease.getRatio(this._time/l):s&&this._ease._calcEnd&&(this.ratio=this._ease.getRatio(0===this._time?0:1))}for(this._active||!this._paused&&this._time!==o&&t>=0&&(this._active=!0),0===o&&(this._startAt&&(t>=0?this._startAt.render(t,e,i):r||(r="_dummyGS")),this.vars.onStart&&(0!==this._time||0===l)&&(e||this.vars.onStart.apply(this.vars.onStartScope||this,this.vars.onStartParams||g))),n=this._firstPT;n;)n.f?n.t[n.p](n.c*this.ratio+n.s):n.t[n.p]=n.c*this.ratio+n.s,n=n._next;this._onUpdate&&(0>t&&this._startAt&&this._startTime&&this._startAt.render(t,e,i),e||i&&0===this._time&&0===o||this._onUpdate.apply(this.vars.onUpdateScope||this,this.vars.onUpdateParams||g)),r&&(this._gc||(0>t&&this._startAt&&!this._onUpdate&&this._startTime&&this._startAt.render(t,e,i),s&&(this._timeline.autoRemoveChildren&&this._enabled(!1,!1),this._active=!1),!e&&this.vars[r]&&this.vars[r].apply(this.vars[r+"Scope"]||this,this.vars[r+"Params"]||g),0===l&&this._rawPrevTime===h&&a!==h&&(this._rawPrevTime=0)))}},r._kill=function(t,e){if("all"===t&&(t=null),null==t&&(null==e||e===this.target))return this._enabled(!1,!1);e="string"!=typeof e?e||this._targets||this.target:D.selector(e)||e;var i,s,r,n,a,o,l,h;if((m(e)||E(e))&&"number"!=typeof e[0])for(i=e.length;--i>-1;)this._kill(t,e[i])&&(o=!0);else{if(this._targets){for(i=this._targets.length;--i>-1;)if(e===this._targets[i]){a=this._propLookup[i]||{},this._overwrittenProps=this._overwrittenProps||[],s=this._overwrittenProps[i]=t?this._overwrittenProps[i]||{}:"all";break}}else{if(e!==this.target)return!1;a=this._propLookup,s=this._overwrittenProps=t?this._overwrittenProps||{}:"all"}if(a){l=t||a,h=t!==s&&"all"!==s&&t!==a&&("object"!=typeof t||!t._tempKill);for(r in l)(n=a[r])&&(n.pg&&n.t._kill(l)&&(o=!0),n.pg&&0!==n.t._overwriteProps.length||(n._prev?n._prev._next=n._next:n===this._firstPT&&(this._firstPT=n._next),n._next&&(n._next._prev=n._prev),n._next=n._prev=null),delete a[r]),h&&(s[r]=1);!this._firstPT&&this._initted&&this._enabled(!1,!1)}}return o},r.invalidate=function(){return this._notifyPluginsOfEnabled&&D._onPluginEvent("_onDisable",this),this._firstPT=null,this._overwrittenProps=null,this._onUpdate=null,this._startAt=null,this._initted=this._active=this._notifyPluginsOfEnabled=!1,
this._propLookup=this._targets?{}:[],this},r._enabled=function(t,e){if(a||n.wake(),t&&this._gc){var i,s=this._targets;if(s)for(i=s.length;--i>-1;)this._siblings[i]=B(s[i],this,!0);else this._siblings=B(this.target,this,!0)}return x.prototype._enabled.call(this,t,e),this._notifyPluginsOfEnabled&&this._firstPT?D._onPluginEvent(t?"_onEnable":"_onDisable",this):!1},D.to=function(t,e,i){return new D(t,e,i)},D.from=function(t,e,i){return i.runBackwards=!0,i.immediateRender=0!=i.immediateRender,new D(t,e,i)},D.fromTo=function(t,e,i,s){return s.startAt=i,s.immediateRender=0!=s.immediateRender&&0!=i.immediateRender,new D(t,e,s)},D.delayedCall=function(t,e,i,s,r){return new D(e,0,{delay:t,onComplete:e,onCompleteParams:i,onCompleteScope:s,onReverseComplete:e,onReverseCompleteParams:i,onReverseCompleteScope:s,immediateRender:!1,useFrames:r,overwrite:0})},D.set=function(t,e){return new D(t,0,e)},D.getTweensOf=function(t,e){if(null==t)return[];t="string"!=typeof t?t:D.selector(t)||t;var i,s,r,n;if((m(t)||E(t))&&"number"!=typeof t[0]){for(i=t.length,s=[];--i>-1;)s=s.concat(D.getTweensOf(t[i],e));for(i=s.length;--i>-1;)for(n=s[i],r=i;--r>-1;)n===s[r]&&s.splice(i,1)}else for(s=B(t).concat(),i=s.length;--i>-1;)(s[i]._gc||e&&!s[i].isActive())&&s.splice(i,1);return s},D.killTweensOf=D.killDelayedCallsTo=function(t,e,i){"object"==typeof e&&(i=e,e=!1);for(var s=D.getTweensOf(t,e),r=s.length;--r>-1;)s[r]._kill(i,t)};var M=d("plugins.TweenPlugin",function(t,e){this._overwriteProps=(t||"").split(","),this._propName=this._overwriteProps[0],this._priority=e||0,this._super=M.prototype},!0);if(r=M.prototype,M.version="1.10.1",M.API=2,r._firstPT=null,r._addTween=function(t,e,i,s,r,n){var a,o;return null!=s&&(a="number"==typeof s||"="!==s.charAt(1)?Number(s)-i:parseInt(s.charAt(0)+"1",10)*Number(s.substr(2)))?(this._firstPT=o={_next:this._firstPT,t:t,p:e,s:i,c:a,f:"function"==typeof t[e],n:r||e,r:n},o._next&&(o._next._prev=o),o):void 0},r.setRatio=function(t){for(var e,i=this._firstPT,s=1e-6;i;)e=i.c*t+i.s,i.r?e=0|e+(e>0?.5:-.5):s>e&&e>-s&&(e=0),i.f?i.t[i.p](e):i.t[i.p]=e,i=i._next},r._kill=function(t){var e,i=this._overwriteProps,s=this._firstPT;if(null!=t[this._propName])this._overwriteProps=[];else for(e=i.length;--e>-1;)null!=t[i[e]]&&i.splice(e,1);for(;s;)null!=t[s.n]&&(s._next&&(s._next._prev=s._prev),s._prev?(s._prev._next=s._next,s._prev=null):this._firstPT===s&&(this._firstPT=s._next)),s=s._next;return!1},r._roundProps=function(t,e){for(var i=this._firstPT;i;)(t[this._propName]||null!=i.n&&t[i.n.split(this._propName+"_").join("")])&&(i.r=e),i=i._next},D._onPluginEvent=function(t,e){var i,s,r,n,a,o=e._firstPT;if("_onInitAllProps"===t){for(;o;){for(a=o._next,s=r;s&&s.pr>o.pr;)s=s._next;(o._prev=s?s._prev:n)?o._prev._next=o:r=o,(o._next=s)?s._prev=o:n=o,o=a}o=e._firstPT=r}for(;o;)o.pg&&"function"==typeof o.t[t]&&o.t[t]()&&(i=!0),o=o._next;return i},M.activate=function(t){for(var e=t.length;--e>-1;)t[e].API===M.API&&(N[(new t[e])._propName]=t[e]);return!0},c.plugin=function(t){if(!(t&&t.propName&&t.init&&t.API))throw"illegal plugin definition.";var e,i=t.propName,s=t.priority||0,r=t.overwriteProps,n={init:"_onInitTween",set:"setRatio",kill:"_kill",round:"_roundProps",initAll:"_onInitAllProps"},a=d("plugins."+i.charAt(0).toUpperCase()+i.substr(1)+"Plugin",function(){M.call(this,i,s),this._overwriteProps=r||[]},t.global===!0),o=a.prototype=new M(i);o.constructor=a,a.API=t.API;for(e in n)"function"==typeof t[e]&&(o[n[e]]=t[e]);return a.version=t.version,M.activate([a]),a},i=t._gsQueue){for(s=0;i.length>s;s++)i[s]();for(r in f)f[r].func||t.console.log("GSAP encountered missing dependency: com.greensock."+r)}a=!1}})(window);if(typeof CC==="undefined"){var CC={dummy:"dummy"};CC.isMobile=navigator.userAgent.match(/BlackBerry|Windows Phone|Android|iPad|iPhone|Silk|iPod|Kindle|Nexus/i)!==null}CC.WebApp=function(domContainer,initWidth,initHeight,resizeMethod,backgroundColor,assetURL){this.domContainer=domContainer||document.body;this.screenWidth=initWidth||960;this.cssEnabled=false;this.screenWidthMax=initWidth||960;this.screenWidthMin=initWidth||960;this.screenHeight=initHeight||720;this.resizeMethod=resizeMethod||CC.WebApp.Resizer.NO_RESIZE;this.backgroundColor=backgroundColor||16777215;this.assetURL=assetURL||"";CC.WebApp.current=this};CC.WebApp.current=false;CC.WebApp.prototype={domContainer:"No DOM Object Defined",screenWidth:"No WIDTH Defined",screenHeight:"No HEIGHT Defined",screenOffsetY:0,scaledWidth:"No WIDTH Defined",scaledHeight:"No HEIGHT Defined",resizeMethod:"No RESIZE METHOD Defined",backgroundColor:"NO BACKGROUND COLOUR  Defined",backgroundObject:"NO BACKGROUND Object  Defined",backgroundGraphic:"NO BACKGROUND Graphic  Defined",renderer:"No RENDER  Defined",stage:"No RENDER  Defined",runUpdate:true,currentTimeStamp:0,previousTimeStamp:0,oldInnerWidth:0,oldInnerHeight:0,oldWindowInnerWidth:0,oldWindowInnerHeight:0,forceResize:false,elapsedSeconds:0,ratio:0};CC.WebApp.prototype.init=function(forceCanvas){if(forceCanvas){this.renderer=new PIXI.CanvasRenderer(this.screenWidth,this.screenHeight)}else{this.renderer=new PIXI.autoDetectRenderer(this.screenWidth,this.screenHeight,{antialias:false})}this.domContainer.appendChild(this.renderer.view);this.stage=new PIXI.Container;var self=this;var resizeForceFunc=function(){self.forceResize=true};window.addEventListener("orientationchange",resizeForceFunc);window.addEventListener("resize",resizeForceFunc)};CC.WebApp.prototype.pause=function(){this.loopActive=false};CC.WebApp.prototype.firstStart=function(screenObject,forcedCanvas){this.init(forcedCanvas);this.start(screenObject)};CC.WebApp.prototype.reSize=function(width,height){this.renderer.resize(width,height);this.screenWidth=width;this.screenHeight=height;this.screenObject.construct.position.x=Math.floor(this.screenWidth*.5);this.screenObject.construct.position.y=Math.floor(this.screenHeight*.5+this.screenOffsetY)};CC.WebApp.prototype.start=function(screenObject){if(!this.loopActive){this.loopActive=true;if(screenObject){this.swapScreen(screenObject)}this.previousTimeStamp=(new Date).getTime();var self=this;requestAnimationFrame(function(){self.mainLoop()});this.dirty()}};CC.WebApp.prototype.setBackgroundColor=function(newbackgroundColor){var newGraphic=new PIXI.Graphics;newGraphic.beginFill(newbackgroundColor);newGraphic.drawRect(0,0,1280,720);newGraphic.endFill();if(this.backgroundObject.children.length>0){this.backgroundObject.removeChild(this.backgroundGraphic)}this.backgroundObject.addChild(newGraphic);this.backgroundGraphic=newGraphic};CC.WebApp.prototype.dirty=function(){this.stage.dirty=true};CC.WebApp.prototype.matchAspectRatio=function(resizeTheWidthBool){if(resizeTheWidthBool){this.screenWidth=Math.ceil(this.screenHeight/this.domContainer.offsetHeight*this.domContainer.offsetWidth);this.screenWidth=Math.min(this.screenWidthMax,this.screenWidth);this.screenWidth=Math.max(this.screenWidthMin,this.screenWidth)}else{this.screenHeight=Math.ceil(this.screenWidth/this.domContainer.offsetWidth*this.domContainer.offsetHeight)}this.renderer.resize(this.screenWidth,this.screenHeight);this.screenObject.construct.position.x=Math.floor(this.screenWidth*.5);this.screenObject.construct.position.y=Math.floor(this.screenHeight*.5+this.screenOffsetY);this.stage.dirty=true};CC.WebApp.prototype.mainLoop=function(){var self=this;if(this.loopActive){requestAnimationFrame(function(){self.mainLoop()})}this.currentTimeStamp=(new Date).getTime();this.elapsedSeconds=(this.currentTimeStamp-this.previousTimeStamp)/1e3;if((this.oldInnerWidth!==this.domContainer.offsetWidth||this.oldInnerHeight!==this.domContainer.offsetHeight||this.oldWindowInnerWidth!==window.innerWidth||this.oldWindowInnerHeight!==window.innerHeight||forceResize)&&this.resizeMethod!==CC.WebApp.Resizer.NO_RESIZE){this.oldInnerWidth=this.domContainer.offsetWidth;this.oldInnerHeight=this.domContainer.offsetHeight;this.oldWindowInnerWidth=window.innerWidth;this.oldWindowInnerHeight=window.innerHeight;if(this.domContainer.offsetHeight<window.innerHeight){var maxWidth=this.domContainer.offsetWidth;var maxWidth=this.domContainer.offsetHeight}else{var maxWidth=window.innerWidth;var maxHeight=window.innerHeight}forceResize=false;if(this.resizeMethod===CC.WebApp.Resizer.FLEX_WIDTH){this.matchAspectRatio(true)}if(this.resizeMethod===CC.WebApp.Resizer.FLEX_HEIGHT){this.matchAspectRatio(false)}this.scaledWidth=this.screenWidth;this.scaledHeight=this.screenHeight;if(this.resizeMethod===CC.WebApp.Resizer.FLEX_WIDTH||this.resizeMethod===CC.WebApp.Resizer.FIXED_RATIO){this.ratio=this.screenWidth/this.screenHeight;if(this.oldInnerHeight*this.ratio<this.oldInnerWidth){this.scaledWidth=maxHeight*this.ratio;this.scaledHeight=maxHeight}else{this.scaledWidth=maxWidth;this.scaledHeight=maxWidth/this.ratio}}if(this.resizeMethod===CC.WebApp.Resizer.FLEX_HEIGHT){this.scaledWidth=this.oldInnerWidth;this.scaledHeight=this.oldInnerHeight}if(this.cssEnabled){this.renderer.view.style.width=this.scaledWidth+"px";this.renderer.view.style.height=this.scaledHeight+"px";if(this.resizeMethod===CC.WebApp.Resizer.FLEX_WIDTH||this.resizeMethod===CC.WebApp.Resizer.FLEX_HEIGHT){this.renderer.view.style.left="0px";this.renderer.view.style.top="0px"}else{this.renderer.view.style.left=(this.oldInnerWidth-this.scaledWidth)*.5+"px";this.renderer.view.style.top=(this.oldInnerHeight-this.scaledHeight)*.5+"px"}}if(this.screenObject&&this.screenObject.resize){this.screenObject.resize(this.screenWidth,this.screenHeight)}}if(this.runUpdate&&typeof dragonBones!=="undefined"){dragonBones.animation.WorldClock.clock.advanceTime(this.elapsedSeconds)}if(this.runUpdate&&this.screenObject&&this.screenObject.update){this.screenObject.update(this.elapsedSeconds)}this.renderer.render(this.stage);this.previousTimeStamp=this.currentTimeStamp};CC.WebApp.prototype.printScreen=function(){return this.renderer.view.toDataURL()};CC.WebApp.prototype.resumeUpdate=function(){this.runUpdate=true;PIXI.spine.Spine.globalAutoUpdate=true;PIXI.ticker.shared.start()};CC.WebApp.prototype.pauseUpdate=function(){this.runUpdate=false;PIXI.spine.Spine.globalAutoUpdate=false;PIXI.ticker.shared.stop()};CC.WebApp.prototype.createScreenSprite=function(){var printSCreenPng=this.printScreen();return new PIXI.Sprite.fromImage(printSCreenPng,true)};CC.WebApp.prototype.swapScreen=function(newScreenObject,transitionEffect,transitionTime,transitionColor){if(this.screenObject&&this.screenObject.end){this.screenObject.end(this.elapsedSeconds)}transitionEffect=transitionEffect||"none";if(transitionTime!=undefined){transitionTime=1}transitionColor=transitionColor||0;this.screenSpriteObject=null;if(typeof TweenLite!=="undefined"&&!CC.isMobile){switch(transitionEffect){case"none":break;case"fade":case"fadezoom":case"faderight":case"fadeleft":case"fadedown":case"fadeup":case"panright":case"panleft":case"pandown":case"panup":case"faderotateleft":case"faderotateright":case"scrollright":case"scrollleft":case"scrolldown":case"scrollup":this.screenSpriteObject=this.createScreenSprite();this.screenSpriteObject.anchor.x=.5;this.screenSpriteObject.anchor.y=.5;this.screenSpriteObject.position.x=Math.floor(this.screenWidth*.5);this.screenSpriteObject.position.y=Math.floor(this.screenHeight*.5);break}}var self=this;var swapScreenPropper=function(){if(self.stage.children.length>0){CC.WebApp.deconstructDisplayObjects(self.stage)}self.backgroundObject=new PIXI.Container;self.screenObject=newScreenObject;if(self.screenObject&&self.screenObject.color!==undefined){self.setBackgroundColor(self.screenObject.color)}else{self.setBackgroundColor(self.backgroundColor)}self.stage.addChild(self.backgroundObject);self.stage.addChild(self.screenObject.construct);self.screenObject.construct.position.x=Math.floor(self.screenWidth*.5);self.screenObject.construct.position.y=Math.floor(self.screenHeight*.5+self.screenOffsetY);if(typeof TweenLite!=="undefined"&&self.screenSpriteObject!==null){self.stage.addChild(self.screenSpriteObject);switch(transitionEffect){case"fade":TweenLite.to(self.screenSpriteObject,transitionTime,{alpha:0,onComplete:function(){self.screenSpriteObject.visible=false}});break;case"faderotateleft":TweenLite.to(self.screenSpriteObject.scale,transitionTime,{x:1.5,y:1.5});TweenLite.to(self.screenSpriteObject,transitionTime,{rotation:-.4});TweenLite.to(self.screenSpriteObject,transitionTime,{alpha:0,onComplete:function(){self.screenSpriteObject.visible=false}});break;case"faderotateright":TweenLite.to(self.screenSpriteObject.scale,transitionTime,{x:1.5,y:1.5});TweenLite.to(self.screenSpriteObject,transitionTime,{rotation:.4});TweenLite.to(self.screenSpriteObject,transitionTime,{alpha:0,onComplete:function(){self.screenSpriteObject.visible=false}});break;case"fadezoom":TweenLite.to(self.screenSpriteObject.scale,transitionTime,{x:1.5,y:1.5});TweenLite.to(self.screenSpriteObject,transitionTime,{alpha:0,onComplete:function(){self.screenSpriteObject.visible=false}});break;case"fadeup":TweenLite.to(self.screenSpriteObject.position,transitionTime,{y:screenSpriteObject.position.y-200});TweenLite.to(self.screenSpriteObject,transitionTime,{alpha:0,onComplete:function(){self.screenSpriteObject.visible=false}});break;case"fadedown":TweenLite.to(self.screenSpriteObject.position,transitionTime,{y:screenSpriteObject.position.y+200});TweenLite.to(self.screenSpriteObject,transitionTime,{alpha:0,onComplete:function(){self.screenSpriteObject.visible=false}});break;case"fadeleft":TweenLite.to(self.screenSpriteObject.position,transitionTime,{x:screenSpriteObject.position.x-200});TweenLite.to(self.screenSpriteObject,transitionTime,{alpha:0,onComplete:function(){self.screenSpriteObject.visible=false}});break;case"faderight":TweenLite.to(self.screenSpriteObject.position,transitionTime,{x:screenSpriteObject.position.x+200});TweenLite.to(self.screenSpriteObject,transitionTime,{alpha:0,onComplete:function(){self.screenSpriteObject.visible=false}});break;case"panleft":TweenLite.from(self.screenObject.construct.position,transitionTime,{x:self.screenWidth*1.5,ease:Circ.easeOut,onUpdate:function(){self.screenSpriteObject.position.x=self.screenObject.construct.position.x-self.screenWidth}});break;case"panright":TweenLite.from(self.screenObject.construct.position,transitionTime,{x:self.screenWidth*-.5,ease:Circ.easeOut,onUpdate:function(){self.screenSpriteObject.position.x=self.screenObject.construct.position.x+self.screenWidth}});break;case"pandown":TweenLite.from(self.screenObject.construct.position,transitionTime,{y:self.screenHeight*1.5,ease:Circ.easeOut,onUpdate:function(){self.screenSpriteObject.position.y=self.screenObject.construct.position.y-self.screenHeight}});break;case"panup":TweenLite.from(self.screenObject.construct.position,transitionTime,{y:self.screenHeight*-.5,ease:Circ.easeOut,onUpdate:function(){self.screenSpriteObject.position.y=self.screenObject.construct.position.y+self.screenHeight}});case"scrollleft":TweenLite.to(self.screenSpriteObject.position,transitionTime,{x:self.screenWidth*.5,ease:Circ.easeInOut});break;case"scrollright":TweenLite.to(self.screenSpriteObject.position,transitionTime,{x:self.screenWidth*1.5,ease:Circ.easeInOut});break;case"scrollup":TweenLite.to(self.screenSpriteObject.position,transitionTime,{y:self.screenHeight*.5,ease:Circ.easeOut});break;case"scrolldown":TweenLite.to(self.screenSpriteObject.position,transitionTime,{y:self.screenHeight*1.5,ease:Circ.easeInOut});break}}self.stage.dirty=true};if(this.screenSpriteObject!==null){this.screenSpriteObject.texture.baseTexture.source.onload=function(){setTimeout(function(){swapScreenPropper()},100)}}else{swapScreenPropper()}};CC.WebApp.Resizer={NO_RESIZE:0,FIXED_RATIO:1,FLEX_WIDTH:2,FLEX_HEIGHT:3};CC.WebApp.deconstructDisplayObjects=function(displayObject){for(var i=displayObject.children.length-1;i>=0;--i){if(!displayObject.children[i].protect){if(displayObject.children[i].children.length>0){CC.WebApp.deconstructDisplayObjects(displayObject.children[i])}displayObject.removeChild(displayObject.children[i])}}};Math.cot=function(theta){return Math.tan(theta)?1/Math.tan(theta):0};CC.Matrix=function(m){this._m=m||[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]]};CC.Matrix.prototype={_m:[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],muliply:function(matrix){var m=matrix._m;var newGrid=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];for(var i=0;i<16;++i){var x=i%4;var y=Math.floor(i/4);var dot=0;for(var j=0;j<4;++j){dot+=this._m[y][j]*m[j][x]}newGrid[y][x]=dot}for(var i=0;i<4;++i){this._m[i][0]=newGrid[i][0];this._m[i][1]=newGrid[i][1];this._m[i][2]=newGrid[i][2];this._m[i][3]=newGrid[i][3]}},intergrateVector:function(vector){var returnVector={x:0,y:0,z:0};var m=this._m;returnVector.x=vector.x*m[0][0]+vector.y*m[0][1]+vector.z*m[0][2]+m[0][3];returnVector.y=vector.x*m[1][0]+vector.y*m[1][1]+vector.z*m[1][2]+m[1][3];returnVector.z=vector.x*m[2][0]+vector.y*m[2][1]+vector.z*m[2][2]+m[2][3];return returnVector},reset:function(){this._m[0][0]=1;this._m[0][1]=0;this._m[0][2]=0;this._m[0][3]=0;this._m[1][0]=0;this._m[1][1]=1;this._m[1][2]=0;this._m[1][3]=0;this._m[2][0]=0;this._m[2][1]=0;this._m[2][2]=1;this._m[2][3]=0;this._m[3][0]=0;this._m[3][1]=0;this._m[3][2]=0;this._m[3][3]=1}};CC.Matrix.createRotationMatrixX=function(angle){return new CC.Matrix([[1,0,0,0],[0,Math.cos(angle),-Math.sin(angle),0],[0,Math.sin(angle),Math.cos(angle),0],[0,0,0,1]])};CC.Matrix.createRotationMatrixY=function(angle){return new CC.Matrix([[Math.cos(angle),0,Math.sin(angle),0],[0,1,0,0],[-Math.sin(angle),0,Math.cos(angle),0],[0,0,0,1]])};CC.Matrix.createRotationMatrixZ=function(angle){return new CC.Matrix([[Math.cos(angle),-Math.sin(angle),0,0],[Math.sin(angle),Math.cos(angle),0,0],[0,0,1,0],[0,0,0,1]])};CC.Matrix.createTranslationMatrix=function(vector){return new CC.Matrix([[1,0,0,vector.x],[0,1,0,vector.y],[0,0,1,vector.z],[0,0,0,1]])};CC.Matrix.createScaleMatrix=function(scale){if(scale.x){return new CC.Matrix([[scale.x,0,0],[0,scale.y,0],[0,0,scale.z,0],[0,0,0,1]])}else{return new CC.Matrix([[scale,0,0],[0,scale,0],[0,0,scale,0],[0,0,0,1]])}};CC.Matrix.createProjectionMatrix=function(fov,near,far,aspect_ratio){return new CC.Matrix([[Math.cot(fov/2)/aspect_ratio,0,0,0],[0,Math.cot(fov/2),0,0],[0,0,far/(far-near),1],[0,0,-(far*near/(far-near)),0]])};CC.Matrix.createWorldMatrix=function(right,up,look,position){return new CC.Matrix([[right.x,right.y,right.z,0],[up.x,up.y,up.z,0],[look.x,look.y,look.z,0],[position.x,position.y,position.z,1]])};if(typeof CC==="undefined"){var CC={dummy:"dummy"};CC.isMobile=navigator.userAgent.match(/BlackBerry|Windows Phone|Android|iPad|iPhone|Silk|iPod|Kindle|Nexus/i)!==null}CC.isMobile=CC.isMobile||navigator.userAgent.match(/Chrome/i)!==null&&navigator.userAgent.match(/Apple/i)!==null&&navigator.userAgent.match(/Linux/i)!==null;CC.ScreensUtility={trimSpriteHitArea:function(sprite){sprite.hitArea=new PIXI.Rectangle(sprite.texture.trim.x-sprite.texture.trim.width*sprite.anchor.x,sprite.texture.trim.y-sprite.texture.trim.height*sprite.anchor.y,sprite.texture.crop.width,sprite.texture.crop.height);return sprite},createButton:function(button,func){button.interactive=true;if(CC.isMobile){button.tap=func}else{button.click=func}button.buttonMode=true},createButtonHighlight:function(button,func){button.interactive=true;if(CC.isMobile){button.tap=func;button.touchstart=function(){button.gotoAndStop(1)};button.touchend=function(){button.gotoAndStop(0)};button.touchendoutside=function(){button.gotoAndStop(0)}}else{button.click=func;button.mousedown=function(){button.gotoAndStop(1)};button.mouseup=function(){button.gotoAndStop(0)};button.mouseupoutside=function(){button.gotoAndStop(0)}}button.buttonMode=true},createButtonHover:function(button,func){button.interactive=true;if(CC.isMobile){button.tap=func;button.touchstart=function(){button.gotoAndStop(1)};button.touchend=function(){button.gotoAndStop(0)};button.touchendoutside=function(){button.gotoAndStop(0)}}else{button.click=func;button.mouseover=function(){button.gotoAndStop(1)};button.mouseout=function(){button.gotoAndStop(0)}}button.buttonMode=true},createButtonHoverShow:function(button,func,overFunc,outFunc){button.alpha=0;overFunc=overFunc||function(){};outFunc=outFunc||function(){};button.interactive=true;if(CC.isMobile){button.tap=func;button.touchstart=function(){button.alpha=1;overFunc()};button.touchend=function(){button.alpha=0;outFunc()};button.touchendoutside=function(){button.alpha=0;outFunc()}}else{button.click=func;button.mouseover=function(){button.alpha=1;overFunc()};button.mouseout=function(){button.alpha=0;outFunc()}}button.buttonMode=true},createButtonHold:function(button,func,startFunc,endFunc){button.interactive=true;button.state=0;button.currentFrame=0;if(CC.isMobile){button.tap=func;button.touchstart=function(mouseData){if(startFunc){startFunc(mouseData)}button.state=1;if(button.gotoAndStop){button.gotoAndStop(1)}};button.touchend=function(mouseData){if(endFunc){endFunc(mouseData)}button.state=0;if(button.gotoAndStop){button.gotoAndStop(0)}};button.touchendoutside=function(mouseData){if(endFunc){endFunc(mouseData)}button.state=0;if(button.gotoAndStop){button.gotoAndStop(0)}}}else{button.click=func;button.mousedown=function(mouseData){if(startFunc){startFunc(mouseData)}button.state=1;if(button.gotoAndStop){button.gotoAndStop(1)}};button.mouseup=function(mouseData){if(endFunc){endFunc(mouseData)}button.state=0;if(button.gotoAndStop){button.gotoAndStop(0)}};button.mouseupoutside=function(mouseData){if(endFunc){endFunc(mouseData)}button.state=0;if(button.gotoAndStop){button.gotoAndStop(0)}}}button.buttonMode=true},createButtonHolding:function(button,func,startFunc,endFunc,moveFunc){button.interactive=true;button.state=0;button.currentFrame=0;if(CC.isMobile){button.tap=func;button.touchstart=function(mouseData){if(startFunc){startFunc(mouseData)}button.state=1;if(button.gotoAndStop){button.gotoAndStop(1)}};button.touchend=function(mouseData){if(endFunc){endFunc(mouseData)}button.state=0;if(button.gotoAndStop){button.gotoAndStop(0)}};button.touchmove=function(mouseData){if(moveFunc){mouseData.originalEvent.preventDefault();moveFunc(mouseData)}}}else{button.click=func;button.mousedown=function(mouseData){if(startFunc){startFunc(mouseData)}button.state=1;if(button.gotoAndStop){button.gotoAndStop(1)}};button.mouseup=function(mouseData){if(endFunc){endFunc(mouseData)}button.state=0;if(button.gotoAndStop){button.gotoAndStop(0)}};button.mousemove=function(mouseData){if(moveFunc){moveFunc(mouseData)}};button.mouseupoutside=function(mouseData){if(endFunc){endFunc(mouseData)}button.state=0;if(button.gotoAndStop){button.gotoAndStop(0)}}}button.buttonMode=true},createButtonToggle:function(button,func){button.interactive=true;if(CC.isMobile){button.tap=function(){if(button.currentFrame===1){button.gotoAndStop(0)}else{button.gotoAndStop(1)}func()}}else{button.click=function(){if(button.currentFrame){button.gotoAndStop(0)}else{button.gotoAndStop(1)}func()}}button.buttonMode=true},createButtonRadial:function(button,otherButtons,func){button.interactive=true;if(CC.isMobile){button.tap=function(){button.gotoAndStop(1);for(var i=0;i<otherButtons.length;++i){if(otherButtons[i]!==button){otherButtons[i].gotoAndStop(0)}}func()}}else{button.click=function(){button.gotoAndStop(1);for(var i=0;i<otherButtons.length;++i){if(otherButtons[i]!==button){otherButtons[i].gotoAndStop(0)}}func()}}button.buttonMode=true},_magToLine:function(pos,end){var normal=CC.Geometry.normaliseVector(end);var length=CC.Geometry.vectorLength(end);var dot=CC.Geometry.dotProduct2D(pos,normal);dot=Math.min(length,Math.max(0,dot));return{value:dot/length,position:CC.Geometry.scaleVector(normal,dot)}},createSlidingButton:function(button,func,endPos,beginPos,updateFunc){var container=new PIXI.Container;var sliderInUse=false;var slideAmount=beginPos;button.position.x=endPos.x*beginPos;button.position.y=endPos.y*beginPos;button.interactive=true;if(isMobile){button.touchstart=function(){sliderInUse=true};button.touchmove=function(mouseData){if(sliderInUse){var relativePosition=mouseData.getLocalPosition(container);var sliderDetails=Screens.magToLine(relativePosition,endPos);slideAmount=sliderDetails.value;button.position.x=sliderDetails.position.x;button.position.y=sliderDetails.position.y;updateFunc(slideAmount)}};button.touchend=function(){sliderInUse=false;func(slideAmount)};button.touchendoutside=button.touchend}else{button.mousedown=function(){sliderInUse=true};button.mousemove=function(mouseData){if(sliderInUse){var relativePosition=mouseData.getLocalPosition(container);var sliderDetails=Screens.magToLine(relativePosition,endPos);slideAmount=sliderDetails.value;button.position.x=sliderDetails.position.x;button.position.y=sliderDetails.position.y;updateFunc(slideAmount)}};button.mouseup=function(){sliderInUse=false;func(slideAmount)};button.mouseupoutside=button.mouseup}button.buttonMode=true;container.addChild(button);return container}};if(typeof CC==="undefined"){var CC={dummy:"dummy"}}CC.Colour={hexToRGB:function(hexNum){var rgbObj={};rgbObj.r=Math.floor(hexNum/(256*256))%256;rgbObj.g=Math.floor(hexNum/256)%256;rgbObj.b=hexNum%256;return rgbObj},hexToString:function(hexNum){var returnString=hexNum.toString(16);returnString="00000"+returnString;returnString="#"+returnString.substr(-6,6);return returnString},stringToHex:function(stringColour){return parseInt(stringColour.substr(-6,6),16)},hexToRGBvalue:function(hexNum){var rgbObj=this.hexToRGB(hexNum);rgbObj.r/=255;rgbObj.g/=255;rgbObj.b/=255;return rgbObj},RGBToHex:function(rgbObj){red=65536*Math.floor(rgbObj.r);green=256*Math.floor(rgbObj.g);blue=Math.floor(rgbObj.b);return red+green+blue},RGBvalueToHex:function(rgbObj){red=65536*Math.floor(255*rgbObj.r);green=256*Math.floor(255*rgbObj.g);blue=Math.floor(255*rgbObj.b);return red+green+blue},HexLerp:function(hexA,hexB,value){var rgbObj={};var rgbA=this.hexToRGBvalue(hexA);var rgbB=this.hexToRGBvalue(hexB);rgbObj.r=(rgbB.r-rgbA.r)*value+rgbA.r;rgbObj.g=(rgbB.g-rgbA.g)*value+rgbA.g;rgbObj.b=(rgbB.b-rgbA.b)*value+rgbA.b;return this.RGBvalueToHex(rgbObj)},HexSqrLerp:function(hexA,hexB,value){var rgbObj={};var rgbA=this.hexToRGBvalue(hexA);var rgbB=this.hexToRGBvalue(hexB);rgbA.a*=rgbA.r;rgbA.g*=rgbA.g;rgbA.b*=rgbA.b;rgbB.r*=rgbB.r;rgbB.g*=rgbB.g;rgbB.b*=rgbB.b;rgbObj.r=Math.sqrt((rgbB.r-rgbA.r)*value+rgbA.r);rgbObj.g=Math.sqrt((rgbB.g-rgbA.g)*value+rgbA.g);rgbObj.b=Math.sqrt((rgbB.b-rgbA.b)*value+rgbA.b);return this.RGBvalueToHex(rgbObj)}};CC.Color=CC.Colour;if(typeof CC==="undefined"){var CC={}}Math.PI=3.14159265359;Math.hPI=3.14159265359*.5;Math.TAU=6.28318530718;Math.PHI=1.61803398875;Math.lerp=function(start,end,value){return(end-start)*value+start};Math.sineEasing=function(value){return(-Math.sin(value*Math.PI)+1)*.5};Math.value=function(start,end,position){return(position-start)/(end-start)};Math.modo=function(value,size){var returnValue=0;if(value>=0){returnValue=value%size}else{returnValue=(size+value%size)%size}return returnValue};CC.Geometry={renderToPixiGraphic:function(vertexArray,fillColor,lineColor){var length=vertexArray.length;var graphics=new PIXI.Graphics;graphics.beginFill(fillColor,.1);graphics.lineStyle(1,lineColor);graphics.moveTo(vertexArray[length-1].x,vertexArray[length-1].y);for(var i=0;i<length;++i){graphics.lineTo(vertexArray[i].x,vertexArray[i].y)}graphics.endFill();return graphics},dotProduct2D:function(vertexA,vertexB){return vertexA.x*vertexB.x+vertexA.y*vertexB.y},dotProduct3D:function(vertexA,vertexB){return vertexA.x*vertexB.x+(vertexA.y*vertexB.y+vertexA.z*vertexB.z)},rotate2D:function(vector,theta){return{x:Math.cos(-theta)*vector.x+Math.sin(-theta)*vector.y,y:-Math.sin(-theta)*vector.x+Math.cos(-theta)*vector.y}},rotate2DRef:function(vector,theta){var X=vector.x;var Y=vector.y;vector.x=Math.cos(-theta)*X+Math.sin(-theta)*Y;vector.y=-Math.sin(-theta)*X+Math.cos(-theta)*Y},rotate3DRef:function(vector,theta){var X=vector.x;var Y=vector.z;vector.x=Math.cos(-theta)*X+Math.sin(-theta)*Y;vector.z=-Math.sin(-theta)*X+Math.cos(-theta)*Y},reflect2D:function(vector,normal){var dotProduct=this.dotProduct2D(normal,vector);return{x:vector.x-2*dotProduct*normal.x,y:vector.y-2*dotProduct*normal.y}},reflect2DRef:function(vector,normal){var dotProduct=this.dotProduct2D(normal,vector);vector.x-=2*dotProduct*normal.x,vector.y-=2*dotProduct*normal.y},polarToVector2D:function(vector,normal){return{x:Math.sin(theta)*raduis,y:Math.cos(theta)*-raduis}},crossProduct2D:function(vertexA,vertexB){return vertexA.x*vertexB.y-vertexA.y*vertexB.x},relativeVector:function(vectorOrigin,VectorTarget){return{x:VectorTarget.x-vectorOrigin.x,y:VectorTarget.y-vectorOrigin.y}},pointTriangleTest:function(point,vertexArray){var resultBool=true;for(var i=0;i<vertexArray.length;++i){var j=(i+1)%vertexArray.length;var relativePoint=this.relativeVector(vertexArray[i],point);var relativeNext=this.relativeVector(vertexArray[i],vertexArray[j]);resultBool=resultBool&&this.crossProduct2D(relativePoint,relativeNext)>0}return resultBool},convertToLineEquationX:function(vectorStart,VectorEnd){var line={slope:1,intercept:0};var relVector=this.relativeVector(vectorStart,VectorEnd);line.slope=relVector.y/relVector.x;line.intercept=vectorStart.y-vectorStart.x*line.slope;return line},convertToLineEquationY:function(vectorStart,VectorEnd){var line={slope:1,intercept:0};var relVector=this.relativeVector(vectorStart,VectorEnd);line.slope=relVector.x/relVector.y;line.intercept=vectorStart.x-vectorStart.y*line.slope;return line},solveTwoLines:function(lineA,lineB){var slopeDual=lineA.slope-lineB.slope;var interceptDual=lineB.intercept-lineA.intercept;return slopeDual!==0?interceptDual/slopeDual:interceptDual/1e-5},solveLine:function(line,value){return line.slope*value+line.intercept},vectorLineIntersection:function(vectorAStart,vectorAEnd,vectorBStart,vectorBEnd){var interSectionPoint={x:0,y:0};var lineA=this.convertToLineEquationX(vectorAStart,vectorAEnd);var lineB=this.convertToLineEquationX(vectorBStart,vectorBEnd);interSectionPoint.x=this.solveTwoLines(lineA,lineB);interSectionPoint.y=this.solveLine(lineA,interSectionPoint.x);return interSectionPoint},triangulateEar:function(vertexArray){var trianglesToExstract=vertexArray.length-2;var triangleVertexArrays=new Array;for(var z=0;z<trianglesToExstract;++z){var vertexFound=false;var testTriAngle=new Array;var candiateIndex=0;for(var i=0;i<vertexArray.length&&!vertexFound;++i){h=(i+(vertexArray.length-1))%vertexArray.length;j=(i+1)%vertexArray.length;testTriAngle[0]=vertexArray[h];testTriAngle[1]=vertexArray[i];testTriAngle[2]=vertexArray[j];var validVertex=this.isPolygonClockWise(testTriAngle);for(var a=0;a<vertexArray.length&&validVertex;++a){if(a!==i&&a!==h&&a!==j){validVertex=validVertex&&!this.pointTriangleTest(vertexArray[a],testTriAngle)}}vertexFound=validVertex;candiateIndex=i}triangleVertexArrays.push(testTriAngle);vertexArray.splice(candiateIndex,1)}return triangleVertexArrays},calculatePerpendicularVector:function(vector){return{x:vector.y,y:-vector.x}},vectorLengthSquared:function(vector){return vector.x*vector.x+vector.y*vector.y},vectorLength:function(vector){return Math.sqrt(this.vectorLengthSquared(vector))},vectorDistanceSquared:function(vectorA,vectorB){return this.vectorLengthSquared(this.relativeVector(vectorA,vectorB))},vectorDistance:function(vectorA,vectorB){return Math.sqrt(this.vectorDistanceSquared(vectorA,vectorB))},normaliseVector:function(vector){return this.scaleVector(vector,1/this.vectorLength(vector))},keyRandomiser:function(keyA,keyB){return(Math.sin(keyA*keyB)+keyB*100)%2-1},warpPolygon:function(vertexArray,amount){var newVertexArray=new Array;for(var i=0;i<vertexArray.length;++i){var flooredX=Math.round(vertexArray[i].x);var flooredY=Math.round(vertexArray[i].y);newVertexArray[i]={x:vertexArray[i].x+this.keyRandomiser(flooredX,flooredY)*amount,y:vertexArray[i].y+this.keyRandomiser(flooredY,flooredX)*amount}}return newVertexArray},isPolygonClockWise:function(vertexArray){var runningTotal=0;for(var i=0;i<vertexArray.length;++i){var j=(i+1)%vertexArray.length;runningTotal+=(vertexArray[j].x-vertexArray[i].x)*(-vertexArray[j].y+-vertexArray[i].y);
}return runningTotal>0},generateRegularPolgyon:function(sides,radius,x,y){var vertexArray=new Array;var stepSize=Math.TAU/sides;for(var i=0;i<sides;++i){vertexArray.push({x:Math.sin(stepSize*i)*radius+x,y:-Math.cos(stepSize*i)*radius+y})}return vertexArray},scaleVector:function(vector,scaler){return{x:vector.x*scaler,y:vector.y*scaler}},clampVectorToRect:function(vector,rect,rectOffset){rectOffset=rectOffset||{x:0,y:0};return{x:Math.min(Math.max(vector.x,rect.x+rectOffset.x),rect.x+rectOffset.x+rect.width),y:Math.min(Math.max(vector.y,rect.y+rectOffset.y),rect.y+rectOffset.y+rect.height)}},sumVectors:function(vectorA,vectorB){return{x:vectorA.x+vectorB.x,y:vectorA.y+vectorB.y}},lerpVector:function(vectorStart,VectorEnd,scaler){var relVector=this.relativeVector(vectorStart,VectorEnd);var scaledVector=this.scaleVector(relVector,scaler);return this.sumVectors(scaledVector,vectorStart)},calculateSurfaceNormal:function(vertexA,vertexB){var relVector=this.normaliseVector(this.relativeVector(vertexA,vertexB));var normalVector=this.calculatePerpendicularVector(relVector);return normalVector},insetPolygon:function(vertexArray,insetValue){var vertexPairsArray=new Array;var insetVertexArray=new Array;for(var i=0;i<vertexArray.length;++i){var j=(i+1)%vertexArray.length;var surfaceNormal=this.calculateSurfaceNormal(vertexArray[i],vertexArray[j]);var insetAmount=this.scaleVector(surfaceNormal,insetValue);vertexPairsArray.push(this.sumVectors(insetAmount,vertexArray[i]));vertexPairsArray.push(this.sumVectors(insetAmount,vertexArray[j]))}for(var i=0;i<vertexPairsArray.length;i+=2){var j=(i+1)%vertexPairsArray.length;var k=(i+2)%vertexPairsArray.length;var l=(i+3)%vertexPairsArray.length;insetVertexArray.push(this.vectorLineIntersection(vertexPairsArray[i],vertexPairsArray[j],vertexPairsArray[k],vertexPairsArray[l]))}return insetVertexArray},convertPolygonToVertexQueue:function(vertexArray){var vertexQueue=new Array;for(var i=0;i<vertexArray.length;++i){var j=(i+1)%vertexArray.length;vertexQueue.push({vertex:vertexArray[i],nextVertex:j,unused:true})}return vertexQueue},convertVertexQueueToPolygons:function(vertexQueue){var vertexArrays=new Array;for(var i=0;i<vertexQueue.length;++i){if(vertexQueue[i].unused){var polygonIndex=vertexArrays.push(new Array)-1;var currentVertexIndex=i;while(vertexQueue[currentVertexIndex].unused){vertexArrays[polygonIndex].push(vertexQueue[currentVertexIndex].vertex);vertexQueue[currentVertexIndex].unused=false;currentVertexIndex=vertexQueue[currentVertexIndex].nextVertex}}}return vertexArrays},checkInsideLine:function(point,vertexA,vertexB,tollrence){var normal=this.normaliseVector(this.relativeVector(vertexA,vertexB));var dotPoint=this.dotProduct2D(normal,point);var dotStart=this.dotProduct2D(vertexA,normal);var dotEnd=this.dotProduct2D(vertexB,normal);if(dotStart>dotEnd){var buffer=dotEnd;dotEnd=dotStart;dotStart=buffer}dotEnd-=tollrence;dotStart+=tollrence;return dotPoint>dotStart&&dotPoint<dotEnd},decomposeVertexQueue:function(vertexQueue){var orignalLength=vertexQueue.length;for(var i=0;i<vertexQueue.length;++i){var j=vertexQueue[i].nextVertex;for(var k=0;k<vertexQueue.length;++k){var l=vertexQueue[k].nextVertex;if(i!==k&&i!==l&&k!==j){var intersection=this.vectorLineIntersection(vertexQueue[i].vertex,vertexQueue[j].vertex,vertexQueue[k].vertex,vertexQueue[l].vertex);if(this.checkInsideLine(intersection,vertexQueue[i].vertex,vertexQueue[j].vertex,0)&&this.checkInsideLine(intersection,vertexQueue[k].vertex,vertexQueue[l].vertex,0)){var a=vertexQueue.push({vertex:intersection,nextVertex:l,unused:true})-1;var b=vertexQueue.push({vertex:intersection,nextVertex:j,unused:true})-1;vertexQueue[i].nextVertex=a;vertexQueue[k].nextVertex=b;console.log("twist");i=0;k=vertexQueue.length}}}}return vertexQueue},decomposePolygon:function(vertexArray){var vertexQueue=this.convertPolygonToVertexQueue(vertexArray);var decomposedVertexQueue=this.decomposeVertexQueue(vertexQueue);return this.convertVertexQueueToPolygons(decomposedVertexQueue)},cutVertexQueue:function(vertexQueue,cutVectorStart,cutVectorEnd){var cutPointsArray=new Array;var cutUnit=this.normaliseVector(this.relativeVector(cutVectorStart,cutVectorEnd));var orignalLenth=vertexQueue.length;for(var i=0;i<orignalLenth;++i){var j=(i+1)%orignalLenth;var intersection=this.vectorLineIntersection(vertexQueue[i].vertex,vertexQueue[j].vertex,cutVectorStart,cutVectorEnd);if(this.checkInsideLine(intersection,vertexQueue[i].vertex,vertexQueue[j].vertex,0)){var a=vertexQueue.push({vertex:intersection,nextVertex:-1,unused:true})-1;var b=vertexQueue.push({vertex:intersection,nextVertex:-1,unused:true})-1;var dotProduct=this.dotProduct2D(cutUnit,intersection);var newCutPoint={dot:dotProduct,pointerA:a,pointerB:b,pointerC:i,pointerD:j};var indexSlot=0;for(var c=cutPointsArray.length-1;c>=0;--c){if(cutPointsArray[c].dot>dotProduct){indexSlot=c}}cutPointsArray.splice(indexSlot,0,newCutPoint)}}for(var i=0;i<cutPointsArray.length;i+=2){var j=i+1;var iA=cutPointsArray[i].pointerA;var iB=cutPointsArray[i].pointerB;var iC=cutPointsArray[i].pointerC;var iD=cutPointsArray[i].pointerD;var jA=cutPointsArray[j].pointerA;var jB=cutPointsArray[j].pointerB;var jC=cutPointsArray[j].pointerC;var jD=cutPointsArray[j].pointerD;vertexQueue[iA].nextVertex=jB;vertexQueue[jA].nextVertex=iB;vertexQueue[iC].nextVertex=iA;vertexQueue[jC].nextVertex=jA;vertexQueue[iB].nextVertex=iD;vertexQueue[jB].nextVertex=jD}return vertexQueue},cutPolygon:function(vertexArray,cutVectorStart,cutVectorEnd){var vertexQueue=this.convertPolygonToVertexQueue(vertexArray);var cutDownVertexQueue=this.cutVertexQueue(vertexQueue,cutVectorStart,cutVectorEnd);return this.convertVertexQueueToPolygons(cutDownVertexQueue)},cullDirtyPolygon:function(vertexArray){var cullBool=false;cullBool=vertexArray.length<3;if(!cullBool){cullBool=!this.isPolygonClockWise(vertexArray)}return cullBool},getMinMaxVectorPair:function(vertexArray,normal){var maxIndex=0;var minIndex=0;var maxDot=null;var minDot=null;for(var i=0;i<vertexArray.length;++i){var dotProduct=this.dotProduct2D(normal,vertexArray[i]);if(maxDot==null||dotProduct>maxDot){minIndex=i;maxDot=dotProduct}if(minDot==null||dotProduct<minDot){maxIndex=i;minDot=dotProduct}}return{vector:{min:vertexArray[minIndex],max:vertexArray[maxIndex]},dot:{min:minDot,max:maxDot}}},defineBoundingBox:function(vertexArray,yAxisNormal){var xAxisNormal=this.calculatePerpendicularVector(yAxisNormal);var xAxisResultsDot=this.getMinMaxVectorPair(vertexArray,xAxisNormal).dot;var yAxisResultsDot=this.getMinMaxVectorPair(vertexArray,yAxisNormal).dot;var left=this.scaleVector(xAxisNormal,xAxisResultsDot.min);var right=this.scaleVector(xAxisNormal,xAxisResultsDot.max);var top=this.scaleVector(yAxisNormal,yAxisResultsDot.min);var bottom=this.scaleVector(yAxisNormal,yAxisResultsDot.max);var topLeft=this.sumVectors(top,left);var topRight=this.sumVectors(top,right);var bottomRight=this.sumVectors(bottom,right);var bottomLeft=this.sumVectors(bottom,left);return[topLeft,topRight,bottomRight,bottomLeft]},griddlePolygon:function(vertexArray,normal,xSize,ySize){var runningPoly=[vertexArray];var gridQuad=this.defineBoundingBox(vertexArray,normal);var xLength=this.vectorDistance(gridQuad[0],gridQuad[3]);var yLength=this.vectorDistance(gridQuad[0],gridQuad[1]);var xBlocks=Math.floor(xLength/xSize);var yBlocks=Math.floor(yLength/ySize);for(var i=1;i<xBlocks;++i){var polygons=new Array;var error=Math.sin(i+gridQuad[1].x)*.1;var firstCutPoint=this.lerpVector(gridQuad[1],gridQuad[2],i/xBlocks+error);var secondCutPoint=this.lerpVector(gridQuad[0],gridQuad[3],i/xBlocks+error);for(var j=0;j<runningPoly.length;++j){polygons=polygons.concat(this.cutPolygon(runningPoly[j],firstCutPoint,secondCutPoint))}runningPoly=polygons}for(var i=1;i<yBlocks;++i){var polygons=new Array;for(var j=0;j<runningPoly.length;++j){var error=Math.sin((i+gridQuad[1].x)*j)*.05;var firstCutPoint=this.lerpVector(gridQuad[0],gridQuad[1],i/yBlocks+error);var secondCutPoint=this.lerpVector(gridQuad[3],gridQuad[2],i/yBlocks+error);polygons=polygons.concat(this.cutPolygon(runningPoly[j],firstCutPoint,secondCutPoint))}runningPoly=polygons}return runningPoly},findLongestSide:function(vertexArray){var currentLongestSide=0;var currentLongestLength=0;for(var i=0;i<vertexArray.length;++i){var j=(i+1)%vertexArray.length;var testDistance=this.vectorDistanceSquared(vertexArray[i],vertexArray[j]);if(testDistance>currentLongestLength){currentLongestLength=testDistance;currentLongestSide=i}}return currentLongestSide}};if(typeof CC==="undefined"){var CC={dummy:"dummy"}}CC.Drawing=function(width,height){this._canvasWidth=width;this._canvasHeight=height;this._brushCanvas=document.createElement("canvas");this._paintCanvas=document.createElement("canvas");this._paintContext=this._paintCanvas.getContext("2d");this._brushContext=this._brushCanvas.getContext("2d");this._paintCanvas.width=width;this._paintCanvas.height=height;var self=this;this._brushStyle={image:new Image};this._brushStyle.image.onload=function(){self._buildBrush()};this.setBrush({});this._canvasTexture=PIXI.Texture.fromCanvas(this._paintCanvas);PIXI.Sprite.call(this,this._canvasTexture);var brushDown=false;var oldBrushCoords=null;this.interactive=true;this.inputStart=function(mouseData){brushDown=true;var currentCoords=mouseData.data.getLocalPosition(this);currentCoords.x+=self._canvasWidth*self.anchor.x;currentCoords.y+=self._canvasHeight*self.anchor.y;oldBrushCoords=currentCoords;if(self._brushStyle.fill){self._fill(currentCoords,currentCoords)}else{self._drawLine(currentCoords,currentCoords)}self.texture.update()};this.inputEnd=function(){brushDown=false;oldBrushCoords=null};this.inputEndOutside=function(){brushDown=false;oldBrushCoords=null};this.inputMove=function(mouseData){if(!!brushDown){var currentCoords=mouseData.data.getLocalPosition(this);currentCoords.x+=self._canvasWidth*self.anchor.x;currentCoords.y+=self._canvasHeight*self.anchor.y;if(oldBrushCoords===null){oldBrushCoords=currentCoords}if(!self._brushStyle.fill&&self._brushStyle.stroke){self._drawLine(oldBrushCoords,currentCoords)}oldBrushCoords=currentCoords}else{oldBrushCoords=null}self.texture.update()};if(CC.isMobile){this.touchstart=this.inputStart;this.touchmove=this.inputMove;this.touchend=this.inputEnd;this.touchendoutside=this.inputEndOutside}else{this.mousedown=this.inputStart;this.mousemove=this.inputMove;this.mouseup=this.inputEnd;this.mouseupoutside=this.inputEndOutside}};CC.Drawing.prototype=Object.create(PIXI.Sprite.prototype);CC.Drawing.prototype.constructor=CC.Drawing;CC.Drawing.prototype.clear=function(colour){if(colour){this._paintContext.fillStyle=CC.Color.hexToString(colour);this._paintContext.fillRect(0,0,this._paintCanvas.width,this._paintCanvas.height)}else{this._paintContext.clearRect(0,0,this._paintCanvas.width,this._paintCanvas.height)}this.texture.update()};CC.Drawing.prototype.load=function(imagePath){var image=new Image;image.src=imagePath;image.onload=function(){this._paintCanvas.drawImage(image,0,0);this.texture.update()}};CC.Drawing.prototype.save=function(format){if(format===undefined||format===null){return this._paintCanvas.toDataURL()}else{return this._paintCanvas.toDataURL("image/jpeg",.8)}};CC.Drawing.prototype.localSave=function(saveName){if(typeof Storage!=="undefined"){localStorage[saveName]=this.save()}};CC.Drawing.prototype.localLoad=function(saveName){if(typeof Storage!=="undefined"&&!!localStorage[saveName]){this.load(localStorage[saveName])}};CC.Drawing.prototype._drawLine=function(start,end){var distance=Math.floor(CC.Geometry.vectorDistance(start,end)/this._brushStyle.spacing);if(isNaN(distance)){distance=1}distance=Math.max(1,distance);for(var i=0;i<distance;++i){var step=i/distance;this._paintContext.save();var Dx=Math.lerp(start.x,end.x,step);var Dy=Math.lerp(start.y,end.y,step);if(!!this._brushStyle.scatter){var randRadi=Math.PI*Math.random()*2;var scatterMag=this.brushRandomScatter*Math.random();Dx+=Math.sin(randRadi)*scatterMag;Dy+=Math.cos(randRadi)*scatterMag}this._paintContext.translate(Dx,Dy);if(this._brushStyle.rotation){this._paintContext.rotate(Math.random()*3.14*2)}if(this._brushStyle.erase){this._paintContext.globalCompositeOperation="destination-out"}this._paintContext.drawImage(this._brushCanvas,this._brushStyle.offset,this._brushStyle.offset);this._paintContext.restore()}};CC.Drawing.prototype.setBrush=function(brushStyle){this._brushStyle.size=32;this._brushStyle.offset=-16;this._brushStyle.erase=false;this._brushStyle.colour=0;this._brushStyle.tint=true;this._brushStyle.rotation=false;this._brushStyle.stroke=true;this._brushStyle.fill=false;this._brushStyle.scatter=0;this._brushStyle.spacing=1;this._brushStyle.imagePath="";this.modBrush(brushStyle)};CC.Drawing.prototype.modBrush=function(brushStyle){this._brushStyle.size=brushStyle.size!==undefined?this.brushStyle.size:this._brushStyle.size;this._brushStyle.offset=this._brushStyle.size*-.5;this._brushStyle.erase=brushStyle.erase!==undefined?this.brushStyle.erase:this._brushStyle.erase;this._brushStyle.colour=brushStyle.colour!==undefined?this.brushStyle.colour:this._brushStyle.colour;this._brushStyle.tint=brushStyle.tint!==undefined?this.brushStyle.tint:this._brushStyle.tint;this._brushStyle.stroke=brushStyle.stroke!==undefined?this.brushStyle.stroke:this._brushStyle.stroke;this._brushStyle.fill=brushStyle.fill!==undefined?this.brushStyle.fill:this._brushStyle.fill;this._brushStyle.rotation=brushStyle.rotation!==undefined?this.brushStyle.rotation:this._brushStyle.rotation;this._brushStyle.scatter=brushStyle.scatter!==undefined?this.brushStyle.scatter:this._brushStyle.scatter;this._brushStyle.spacing=brushStyle.spacing!==undefined?this.brushStyle.spacing:this._brushStyle.spacing;if(brushStyle.imagePath||this._brushStyle.imagePath!==brushStyle.imagePath){this._brushStyle.imagePath=brushStyle.imagePath||"";this._brushStyle.image.src=this._brushStyle.imagePath;this._brushLoaded=false}this._buildBrush()};CC.Drawing.prototype._buildBrush=function(){var brushWidth=this._brushStyle.size<0?this._brushStyle.image.width:this._brushStyle.size;var brushHeight=this._brushStyle.size<0?this._brushStyle.image.width:this._brushStyle.size;this._brushCanvas.width=brushWidth;this._brushCanvas.height=brushHeight;this._brushContext.save();if(this._brushStyle.imagePath===""){console.log("brush defualt");this._brushContext.fillStyle="black";this._brushContext.beginPath();this._brushContext.arc(brushWidth*.5,brushWidth*.5,brushWidth*.5,0,2*Math.PI);this._brushContext.fill()}else{this._brushContext.drawImage(this._brushStyle.image,0,0,brushWidth,brushHeight)}if(this._brushStyle.tint){this._brushContext.globalCompositeOperation="source-in";this._brushContext.fillStyle=this._brushStyle.color;this._brushContext.fillRect(0,0,brushWidth,brushHeight)}this._brushContext.restore()};CC.Drawing.prototype.drawToCenter=function(imagePath,func){var image=new Image;image.onload=function(){ccDrawingCanvas.paintContext.drawImage(image,Math.round((this._canvasWidth-image.width)*.5),Math.round((this._canvasHeight-image.height)*.5));if(func){func()}};image.src=imagePath};CC.Drawing.prototype._convertHexToRGB=function(hex){return{r:parseInt(hex.substr(1,2),16),g:parseInt(hex.substr(3,2),16),b:parseInt(hex.substr(5,2),16)}},CC.Drawing.prototype._convertRGBToHex=function(r,g,b){return"#"+r.toString(16)+g.toString(16)+b.toString(16)};CC.Drawing.prototype._convertXYtoI=function(x,y,width){return x+y*width};CC.Drawing.prototype._convertItoXY=function(i,width){return{x:i%width,y:Math.floor(i/width)}};CC.Drawing.prototype._compairColorData=function(currentIndex,data,oldData,newData){var tolR=data[currentIndex]-oldData.r;var tolG=data[currentIndex+1]-oldData.g;var tolB=data[currentIndex+2]-oldData.b;tolR*=tolR;tolG*=tolG;tolB*=tolB;var tol=tolR+(tolG+tolB);return!(data[currentIndex]===newData.r&&data[currentIndex+1]===newData.g&&data[currentIndex+2]===newData.b)&&tol<=4*4};CC.Drawing.prototype._replaceColor=function(currentIndex,data,newData){data[currentIndex]=newData.r;data[currentIndex+1]=newData.g;data[currentIndex+2]=newData.b};CC.Drawing.prototype._onfill=function(){},CC.Drawing.prototype._fill=function(x,y){var imgData=this._paintContext.getImageData(0,0,this._paintCanvas.width,this._paintCanvas.height);var data=imgData.data;var colorQueue=[];var width=this._paintCanvas.width;var width4=width*4;var dataLength=this._paintCanvas.width*this._paintCanvas.height*4;x=Math.floor(x);y=Math.floor(y);var i=this._convertXYtoI(x,y,width)*4;var oldColor={r:data[i],g:data[i+1],b:data[i+2]};var newColor=this._convertHexToRGB(this._brushStyle.color);colorQueue.push(i);var progress=0;while(colorQueue.length>0){var j=colorQueue[0];colorQueue.shift();progress++;var jNorth=j-width4;var jEast=j+4;var jSouth=j+width4;var jWest=j-4;if(this._compairColorData(jNorth,data,oldColor,newColor)&&jNorth>=0){this._replaceColor(jNorth,data,newColor);colorQueue.push(jNorth)}if(this._compairColorData(jSouth,data,oldColor,newColor)&&jSouth<dataLength){this._replaceColor(jSouth,data,newColor);colorQueue.push(jSouth)}if(this._compairColorData(jEast,data,oldColor,newColor)&&jEast%width4===j%width4+4){this._replaceColor(jEast,data,newColor);colorQueue.push(jEast)}if(this._compairColorData(jWest,data,oldColor,newColor)&&jWest%width4===j%width4-4){this._replaceColor(jWest,data,newColor);colorQueue.push(jWest)}if(progress>10){progress=0}}this._paintContext.putImageData(imgData,0,0)};if(typeof CC==="undefined"){var CC={dummy:"dummy"};CC.isMobile=navigator.userAgent.match(/BlackBerry|Windows Phone|Android|iPad|iPhone|Silk|iPod|Kindle|Nexus/i)!==null}CC.Utility={PI:3.14159265359,HALF_PI:3.14159265359*.5,QUATER_PI:3.14159265359*.25,THIRD_PI:6.28318530718/3,TAU:6.28318530718,PHI:1.61803398875,modo:function(value,size){var returnValue=0;if(value>=0){returnValue=value%size}else{returnValue=(size+value%size)%size}return returnValue},sign:function(value){var returnVar=1;if(value<0){returnVar=-1}return returnVar},lerp:function(start,end,value){return(end-start)*value+start},assignInteractions:function(pixiObject,interactOn,interactMove,interactOff){if(CC.isMobile){pixiObject.touchstart=interactOn;pixiObject.touchmove=interactMove;pixiObject.touchend=interactOff;pixiObject.touchendoutside=interactOff}else{pixiObject.mousedown=interactOn;pixiObject.mousemove=interactMove;pixiObject.mouseup=interactOff;pixiObject.mouseupoutside=interactOff}},sineEasing:function(value){return(-Math.sin(value*this.PI)+1)*.5},value:function(start,end,position){return(position-start)/(end-start)},intToString:function(num,zeros){zeros=zeros||0;var numStr=""+num;var space=zeros-numStr.length;var zeroStr="00000000000000000";return zeroStr.substring(0,space)+numStr},RGBToColor:function(r,g,b){var returnValue=0;r=Math.floor(r%256);g=Math.floor(g%256);b=Math.floor(b%256);returnValue+=r*256*256;returnValue+=g*256;returnValue+=b;return returnValue},RGBValueToColor:function(r,g,b){var returnValue=0;r=Math.floor(r*256)%256;g=Math.floor(g*256)%256;b=Math.floor(b*256)%256;returnValue+=r*256*256;returnValue+=g*256;returnValue+=b;return returnValue},_stringToAnchor:function(anchorString){var anchor={x:.5,y:.5};anchorString=anchorString.toLowerCase();switch(anchorString){case"tl":case"topleft":case"top left":case"top_left":case"nw":case"northwest":case"north west":case"north_west":anchor.x=0;anchor.y=0;break;case"tr":case"topright":case"top right":case"top_right":case"ne":case"northeast":case"north east":case"north_east":anchor.x=1;anchor.y=0;break;case"bl":case"bottomleft":case"bottom left":case"bottom_left":case"sw":case"southwest":case"south west":case"south_west":anchor.x=0;anchor.y=1;break;case"br":case"bottomright":case"bottom right":case"bottom_right":case"se":case"southeast":case"south east":case"south_east":anchor.x=1;anchor.y=1;break;case"t":case"top":case"n":case"north":anchor.y=0;break;case"r":case"right":case"e":case"east":anchor.x=1;break;case"b":case"bottom":case"s":case"south":anchor.y=1;break;case"l":case"left":case"w":case"west":anchor.x=0;break}return anchor},_applyStyle:function(pixiDisplayObject,style){if(style.x!==undefined){pixiDisplayObject.position.x=style.x}if(style.y!==undefined){pixiDisplayObject.position.y=style.y}if(style.position!==undefined){pixiDisplayObject.position.x=style.position.x;pixiDisplayObject.position.y=style.position.y}if(style.alpha!==undefined){pixiDisplayObject.alpha=style.alpha}if(style.tint!==undefined){pixiDisplayObject.tint=style.tint}if(style.visible!==undefined){pixiDisplayObject.visible=style.visible}if(style.rotation!==undefined&&pixiDisplayObject.rotation!==undefined){switch(typeof style.rotation){case"number":pixiDisplayObject.rotation=style.rotation;break;case"string":var stringRotation=style.rotation.substring(stringRotation.length-1);pixiDisplayObject.rotation=Number(stringRotation)*.0174532925;break}}if(style.scale!==undefined&&pixiDisplayObject.scale!==undefined){switch(typeof style.scale){case"number":pixiDisplayObject.scale.x=style.scale;pixiDisplayObject.scale.y=style.scale;break;case"object":pixiDisplayObject.scale.x=style.scale.x;pixiDisplayObject.scale.y=style.scale.y;break}}if(style.flip!==undefined){if(style.flip==="vertical"){pixiDisplayObject.scale.x*=-1}else{pixiDisplayObject.scale.y*=-1}}if(pixiDisplayObject.anchor!==undefined){pixiDisplayObject.anchor.x=.5;pixiDisplayObject.anchor.y=.5;if(style.anchor!==undefined){switch(typeof style.anchor){case"number":pixiDisplayObject.anchor.x=style.anchor;pixiDisplayObject.anchor.y=style.anchor;break;case"string":var stringAnchor=this._stringToAnchor(style.anchor);pixiDisplayObject.anchor.x=stringAnchor.x;pixiDisplayObject.anchor.y=stringAnchor.y;break;case"object":pixiDisplayObject.anchor.x=style.anchor.x;pixiDisplayObject.anchor.y=style.anchor.x;break}}}return pixiDisplayObject},pixi:function(pixiDisplayObject,style){if(style!==undefined){if(style instanceof Array){for(var i=0;i<style.length;++i){this._applyStyle(pixiDisplayObject,style[i])}}else{this._applyStyle(pixiDisplayObject,style)}}else{if(pixiDisplayObject.anchor!==undefined){pixiDisplayObject.anchor.x=.5;pixiDisplayObject.anchor.y=.5}}return pixiDisplayObject},pixiTilingSprite:function(path,width,height,style){var texture=PIXI.Texture.fromImage(path,true);return CC.Utility.pixi(new PIXI.extras.TilingSprite(texture,width,height),style)},pixiAtlasTilingSprite:function(path,width,height,style){var texture=PIXI.Texture.fromFrame(path);return CC.Utility.pixi(new PIXI.extras.TilingSprite(texture,width,height),style)},pixiSprite:function(path,style){return CC.Utility.pixi(new PIXI.Sprite.fromImage(path,true),style)},pixiAtlasSprite:function(path,style){return CC.Utility.pixi(new PIXI.Sprite.fromFrame(path),style)},pixiMovieClip:function(paths,style){var i=0;var textureArray=[];for(i=0;i<paths.length;++i){textureArray.push(PIXI.Texture.fromImage(paths[i]))}return CC.Utility.pixi(new PIXI.extras.MovieClip(textureArray),style)},pixiAtlasMovieClip:function(paths,style){var i=0;var textureArray=[];for(i=0;i<paths.length;++i){textureArray.push(PIXI.Texture.fromFrame(paths[i]))}return CC.Utility.pixi(new PIXI.extras.MovieClip(textureArray),style)},pixiObject:function(style){return CC.Utility.pixi(new PIXI.Container,style)},checkRadius:function(coords,radius){var squardedAdj=coords.x*coords.x;var squardedOps=coords.y*coords.y;var squardedHyp=squardedAdj+squardedOps;return squardedHyp<radius*radius},addAtlasesToLoader:function(atlasName,atlasCount,loadOut){for(var i=0;i<atlasCount;++i){var thisName=atlasName.replace("#",i+"");loadOut.add(thisName)}},quickSort:function(arrayToSort,sortFunc){for(var i=0;i<atlasCount;++i){var thisName=atlasName.replace("#",i+"");loadOut.add(thisName)}}};