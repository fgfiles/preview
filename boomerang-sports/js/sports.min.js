visibly.onVisible(function(event){if(visibly.visibilityState()!=="hidden"){Interface.focus()}});visibly.onHidden(function(event){Interface.blur()});var Interface={currentMusic:null,musicLoopID:0,playMusic:function(name){if(window.sound){if(name){this.stopMusic();this.currentMusic=name}else{name=this.currentMusic}if(this.currentMusic){var self=this;sound.play(this.currentMusic,true);this.musicLoopID=setInterval(function(){sound.play(self.currentMusic,true)},sound._sprites[name][1]*1e3)}}},pauseMusic:function(){if(window.sound){sound.stop();clearInterval(this.musicLoopID)}},stopMusic:function(){if(window.sound){sound.stop();this.currentMusic=null;clearInterval(this.musicLoopID)}},blur:function(){if(window.sound){sound.stop();sound.blur();this.pauseMusic()}},focus:function(){if(window.sound){sound.stop();sound.focus();if(!sound._isMute){this.playMusic()}}},mute:function(){if(window.sound){sound.mute();this.pauseMusic()}},unmute:function(){if(window.sound){sound.stop();sound.unmute();this.playMusic()}},text:function(copy,size,align,maxedWidth,noShadow,maxedHeight){maxedWidth=maxedWidth||0;var text=new PIXI.Container;text.align=align;var textOutside=new PIXI.Text(copy,{font:size+"px fred_burger_shadow",align:"center",fill:0,fill:0,padding:10,lineHeight:size*1.22,wordWrap:!!maxedWidth,wordWrapWidth:maxedWidth});var textInside=new PIXI.Text(copy,{font:size+"px fred_burger",align:"center",fill:16777215,stroke:"#672d68",strokeThickness:size*.25,lineHeight:size*1.22,miterLimit:2,padding:10,wordWrap:!!maxedWidth,wordWrapWidth:maxedWidth});textOutside.maxWidth=maxedWidth;textInside.maxWidth=maxedWidth;textInside.maxWidth=maxedWidth;textOutside.updateText();textInside.updateText();textOutside.x=Math.floor(textOutside.width*-.5);textInside.x=Math.floor(textInside.width*-.5);textOutside.y=Math.floor(textOutside.height*-.5)-size*.2;textInside.y=Math.floor(textInside.height*-.5);if(maxedHeight&&textInside.height>maxedHeight){text.scale.y=maxedHeight/textInside.height;text.scale.x=text.scale.y}text.setText=function(copy){copy=copy||textOutside.text;textOutside.text=copy;textInside.text=copy;textOutside.updateText();textInside.updateText();textOutside.x=Math.floor(textOutside.width*-.5);textInside.x=Math.floor(textInside.width*-.5);textOutside.y=Math.floor(textOutside.height*-.5)-size*.2;textInside.y=Math.floor(textInside.height*-.5);if(maxedHeight&&textInside.height>maxedHeight){text.scale.y=maxedHeight/textInside.height;text.scale.x=text.scale.y}};if(!noShadow){text.addChild(textOutside)}text.addChild(textInside);return text},reverseText:function(copy,size,align,maxedWidth,noShadow,maxedHeight){maxedWidth=maxedWidth||0;maxedHeight=maxedHeight||0;var text=new PIXI.Container;text.align=align;var textOutside=new PIXI.Text(copy,{font:size+"px fred_burger_shadow",align:align,fill:16777215,lineHeight:size*1.22,wordWrap:!!maxedWidth,wordWrapWidth:maxedWidth});var textInside=new PIXI.Text(copy,{font:size+"px fred_burger",align:align,fill:0,stroke:"#FFFFFF",strokeThickness:size*.25,lineHeight:size*1.22,miterLimit:2,wordWrap:!!maxedWidth,wordWrapWidth:maxedWidth});textOutside.maxWidth=maxedWidth;textInside.maxWidth=maxedWidth;textInside.maxWidth=maxedWidth;textOutside.updateText();textInside.updateText();textOutside.x=Math.floor(textOutside.width*-.5);textInside.x=Math.floor(textInside.width*-.5);textOutside.y=Math.floor(textOutside.height*-.5)-size*.2;textInside.y=Math.floor(textInside.height*-.5);if(maxedHeight&&textInside.height>maxedHeight){text.scale.y=maxedHeight/textInside.height;text.scale.x=text.scale.y}text.setText=function(copy){copy=copy||textOutside.text;textOutside.text=copy;textInside.text=copy;textOutside.updateText();textInside.updateText();textOutside.x=Math.floor(textOutside.width*-.5);textInside.x=Math.floor(textInside.width*-.5);textOutside.y=Math.floor(textOutside.height*-.5)-size*.2;textInside.y=Math.floor(textInside.height*-.5);if(maxedHeight&&textInside.height>maxedHeight){text.scale.y=maxedHeight/textInside.height;text.scale.x=text.scale.y}};if(!noShadow){text.addChild(textOutside)}text.addChild(textInside);return text},helpPopup:function(copy,image,controlImg){var helpContainer=new PIXI.Container;var blackBack=new PIXI.Graphics;blackBack.beginFill(0,.5);blackBack.drawRect(-1e3,-1e3,2e3,2e3);var helpText=this.text(copy,40,.5,580,true,150);helpText.y=180;helpContainer.visible=false;helpContainer.show=function(pausedAlready){blackBack.alpha=0;TweenLite.to(blackBack,.7,{alpha:1});background.y=-600;helpText.setText();TweenLite.to(background,.7,{ease:Back.easeOut,y:0});this.pausedAlready=pausedAlready;CC.WebApp.current.pauseUpdate();this.visible=true};helpContainer.hide=function(){if(!this.pausedAlready){CC.WebApp.current.resumeUpdate()}TweenLite.to(blackBack,.7,{alpha:0});TweenLite.to(background,.7,{ease:Back.easeIn,y:-600,onComplete:function(){helpContainer.visible=false}})};var closeButton=this.button("close",function(){helpContainer.hide()});var background=CC.Utility.pixiAtlasSprite("help_panel.png");var controlImage=CC.Utility.pixiAtlasSprite(controlImg,{x:-250,y:-20});var helpImage=CC.Utility.pixiAtlasSprite(image,{x:0,y:-90});closeButton.x=300;closeButton.y=-250;helpContainer.addChild(blackBack);helpContainer.addChild(background);background.addChild(helpText);background.addChild(helpImage);background.addChild(controlImage);background.addChild(closeButton);helpContainer.onclose=function(){};return helpContainer},pausePopup:function(helpPopup,replayFunc){var pauseContainer=new PIXI.Container;var blackBack=new PIXI.Graphics;blackBack.beginFill(0,.5);blackBack.drawRect(-1e3,-1e3,2e3,2e3);var background=CC.Utility.pixiAtlasSprite("pause_panel.png");pauseContainer.visible=false;var self=this;var pauseText=this.text(SS.copy.pauseMenuTitle,72,.5,580,true);pauseText.y=pauseText.width*-.5;pauseText.y=-120;pauseContainer.show=function(){blackBack.alpha=0;TweenLite.to(blackBack,.7,{alpha:1});background.y=-600;TweenLite.to(background,.7,{ease:Back.easeOut,y:0});CC.WebApp.current.pauseUpdate();this.visible=true};pauseContainer.hide=function(){CC.WebApp.current.resumeUpdate();TweenLite.to(blackBack,.7,{alpha:0});TweenLite.to(background,.7,{ease:Back.easeIn,y:-600,onComplete:function(){pauseContainer.visible=false}})};var closeButton=this.button("close",function(){pauseContainer.hide()});var homeButton=this.button("home",function(){Interface.playMusic("music_screens");CC.WebApp.current.resumeUpdate();CC.WebApp.current.swapScreen(MenuScreens.createTeamSelectionScreen())});var replayButton=this.button("replay",function(){if(replayFunc){replayFunc()}});var muteButton=this.button("sound_on",function(){muteButton.visible=false;unmuteButton.visible=true;self.mute()});var unmuteButton=this.button("sound_off",function(){unmuteButton.visible=false;muteButton.visible=true;self.unmute()});muteButton.visible=!sound._isMute;unmuteButton.visible=!muteButton.visible;var helpButton=this.button("help",function(){helpPopup.show(true)});helpButton.y=0;closeButton.x=250;closeButton.y=-150;unmuteButton.x=150;muteButton.x=150;homeButton.x=-150;unmuteButton.y=homeButton.y=muteButton.y=helpButton.y=100;pauseContainer.addChild(blackBack);pauseContainer.addChild(background);background.addChild(closeButton);background.addChild(helpButton);background.addChild(homeButton);background.addChild(pauseText);background.addChild(unmuteButton);background.addChild(muteButton);return pauseContainer},button:function(name,func){var buttonContainer=new PIXI.Container;buttonContainer.shadow=CC.Utility.pixiAtlasSprite("button_"+name+"_shadow.png");buttonContainer.button=CC.Utility.pixiAtlasSprite("button_"+name+".png");buttonContainer.addChild(buttonContainer.shadow);buttonContainer.addChild(buttonContainer.button);buttonContainer.shadow.y=5;buttonContainer.button.y=-5;buttonContainer.buttonMode=true;buttonContainer.button.interactive=true;buttonContainer.button.mouseover=function(){buttonContainer.shadow.scale.x=buttonContainer.shadow.scale.y=1.05;buttonContainer.button.scale.x=buttonContainer.button.scale.y=1.05};buttonContainer.button.mouseout=function(){buttonContainer.shadow.rotation=0;buttonContainer.button.rotation=0;buttonContainer.shadow.scale.x=buttonContainer.shadow.scale.y=1;buttonContainer.button.scale.x=buttonContainer.button.scale.y=1};buttonContainer.button.mousedown=buttonContainer.button.touchstart=function(){buttonContainer.shadow.y=2;buttonContainer.button.y=-2;TweenLite.killTweensOf(buttonContainer.shadow);TweenLite.killTweensOf(buttonContainer.button);TweenLite.killTweensOf(buttonContainer.shadow.scale);TweenLite.killTweensOf(buttonContainer.button.scale)};buttonContainer.button.mouseup=buttonContainer.button.touchend=function(){sound.play("click_0");TweenLite.to(buttonContainer.shadow,.1,{y:5});TweenLite.to(buttonContainer.button,.1,{y:-5});TweenLite.to(buttonContainer.shadow,.1,{rotation:0});TweenLite.to(buttonContainer.button,.1,{rotation:0});if(func){setTimeout(function(){func()},300)}};if(CC.isMobile){buttonContainer.button.mouseup=function(){};buttonContainer.button.mousedown=function(){};buttonContainer.button.mouseover=function(){};buttonContainer.button.mouseout=function(){}}else{buttonContainer.button.touchstart=function(){};buttonContainer.button.touchend=function(){}}return buttonContainer},noDelayButton:function(name,func){var buttonContainer=new PIXI.Container;buttonContainer.shadow=CC.Utility.pixiAtlasSprite("button_"+name+"_shadow.png");buttonContainer.button=CC.Utility.pixiAtlasSprite("button_"+name+".png");buttonContainer.addChild(buttonContainer.shadow);buttonContainer.addChild(buttonContainer.button);buttonContainer.shadow.y=5;buttonContainer.button.y=-5;buttonContainer.button.interactive=true;buttonContainer.button.mouseover=function(){buttonContainer.shadow.scale.x=buttonContainer.shadow.scale.y=1.05;buttonContainer.button.scale.x=buttonContainer.button.scale.y=1.05};buttonContainer.button.mouseout=function(){buttonContainer.shadow.rotation=0;buttonContainer.button.rotation=0;buttonContainer.shadow.scale.x=buttonContainer.shadow.scale.y=1;buttonContainer.button.scale.x=buttonContainer.button.scale.y=1};buttonContainer.button.mousedown=buttonContainer.button.touchstart=function(){buttonContainer.shadow.y=2;buttonContainer.button.y=-2;TweenLite.killTweensOf(buttonContainer.shadow);TweenLite.killTweensOf(buttonContainer.button);TweenLite.killTweensOf(buttonContainer.shadow.scale);TweenLite.killTweensOf(buttonContainer.button.scale)};buttonContainer.button.mouseup=buttonContainer.button.touchend=function(){sound.play("click_0");TweenLite.to(buttonContainer.shadow,.1,{y:5});TweenLite.to(buttonContainer.button,.1,{y:-5});TweenLite.to(buttonContainer.shadow,.1,{rotation:0});TweenLite.to(buttonContainer.button,.1,{rotation:0});if(func){func()}};if(CC.isMobile){buttonContainer.button.mouseup=function(){};buttonContainer.button.mousedown=function(){};buttonContainer.button.mouseover=function(){};buttonContainer.button.mouseout=function(){}}else{buttonContainer.button.touchstart=function(){};buttonContainer.button.touchend=function(){}}return buttonContainer}};var URLQuery=[];if(typeof console==="undefined"){}var startApp=function(){var containerDom=document.getElementById("interactive-area");var webApp=new CC.WebApp(containerDom,960,720);webApp.screenWidthMax=1280;webApp.screenWidthMin=960;document.body.addEventListener("keypress",function(e){if(e.keyCode==32){e.preventDefault()}});PIXI.AUTO_PREVENT_DEFAULT=false;webApp.backgroundColor=16777215;var interactiveArea=document.getElementById("interactive-area");if(CC.isMobile){interactiveArea.style.backgroundImage="url(img/rotate_device.png)"}var isSafariMac=navigator.userAgent.match(/Macintosh/i)&&navigator.userAgent.match(/Safari/i);switch(URLQuery[1]){case"ring":webApp.firstStart(Screens.createLoadingScreen(),!CC.isMobile&&!isSafariMac);break;default:case"pogo":case"ball":webApp.firstStart(Screens.createLoadingScreen(),!CC.isMobile&&!isSafariMac);break}webApp.cssEnabled=true;webApp.resizeMethod=CC.WebApp.Resizer.FLEX_WIDTH;ccLoader.load()};var Physics=function(){this.circles=[];this.physicsObj=[];this.renderObject=new PIXI.Graphics};Physics.prototype.init=function(){this.circle.position=this.circle.position||{x:0,y:0};this.circle.position.x=this.circle.position.x||0;this.circle.position.y=this.circle.position.y||0;this.circle.velocity=this.circle.velocity||{x:0,y:0};this.circle.velocity.x=this.circle.velocity.x||0;this.circle.velocity.y=this.circle.velocity.y||0;this.circle.radius=this.circle.radius||20};Physics.prototype.addDynamicCircle=function(circle){circle.position=circle.position||{x:0,y:0};circle.position.x=circle.position.x||0;circle.position.y=circle.position.y||0;circle.velocity=circle.velocity||{x:0,y:0};circle.velocity.x=circle.velocity.x||0;circle.velocity.y=circle.velocity.y||0;circle.radius=circle.radius||20;this.circles.push(circle)};Physics.prototype.addRect=function(rect){rect.position=rect.position||{x:0,y:0};rect.position.x=rect.position.x||0;rect.position.y=rect.position.y||0;rect.velocity=rect.velocity||{x:0,y:0};rect.velocity.x=rect.velocity.x||0;rect.velocity.y=rect.velocity.y||0;rect.rotation=rect.rotation||0;rect.type="rect";this.physicsObj.push(rect);return rect};Physics.prototype.addCircle=function(circle){circle.type="circle";circle.position=circle.position||{x:0,y:0};circle.position.x=circle.x||0;circle.position.y=circle.y||0;circle.velocity=circle.velocity||{x:0,y:0};circle.velocity.x=circle.velocity.x||0;circle.velocity.y=circle.velocity.y||0;this.physicsObj.push(circle);return circle};Physics.prototype._physisCircleRectTest=function(circle,rect){var oldPosX=circle.position.x;var oldPosY=circle.position.y;var oldVelX=circle.velocity.x;var oldVelY=circle.velocity.y;var clampedCircle=CC.Geometry.clampVectorToRect(circle.position,rect,rect.position);var relativeVector={x:clampedCircle.x-circle.position.x,y:clampedCircle.y-circle.position.y};var distanceSqr=relativeVector.x*relativeVector.x+relativeVector.y*relativeVector.y;if(distanceSqr<circle.radius*circle.radius){var distance=Math.sqrt(distanceSqr);var surfaceNormal={x:relativeVector.x/distance,y:relativeVector.y/distance};if(surfaceNormal.x||surfaceNormal.y){CC.Geometry.reflect2DRef(circle.velocity,surfaceNormal)}circle.position.x=clampedCircle.x+surfaceNormal.x*-circle.radius;circle.position.y=clampedCircle.y+surfaceNormal.y*-circle.radius;circle.velocity.x*=.7;circle.velocity.y*=.7;if(rect.func){rect.func(circle)}else{}}circle.position.x=isNaN(circle.position.x)?oldPosX:circle.position.x;circle.position.y=isNaN(circle.position.y)?oldPosY:circle.position.y;circle.velocity.x=isNaN(circle.velocity.x)?oldVelX:circle.velocity.x;circle.velocity.y=isNaN(circle.velocity.y)?oldVelY:circle.velocity.y};Physics.prototype._physisCircleCircleTest=function(circleA,circleB){var oldPosX=circleA.position.x;var oldPosY=circleA.position.y;var oldVelX=circleA.velocity.x;var oldVelY=circleA.velocity.y;var relativeVector={x:circleA.position.x-circleB.position.x,y:circleA.position.y-circleB.position.y};var distanceSqr=relativeVector.x*relativeVector.x+relativeVector.y*relativeVector.y;var minDistance=circleA.radius+circleB.radius;if(distanceSqr<minDistance*minDistance){var distance=Math.sqrt(distanceSqr);var surfaceNormal={x:relativeVector.x/distance,y:relativeVector.y/distance};if(surfaceNormal.x||surfaceNormal.y){CC.Geometry.reflect2DRef(circleA.velocity,surfaceNormal)}circleA.position.x=circleB.position.x+surfaceNormal.x*minDistance;circleA.position.y=circleB.position.y+surfaceNormal.y*minDistance;if(circleB.func){circleB.func(circleA)}else{}}circleA.position.x=isNaN(circleA.position.x)?oldPosX:circleA.position.x;circleA.position.y=isNaN(circleA.position.y)?oldPosY:circleA.position.y;circleA.velocity.x=isNaN(circleA.velocity.x)?oldVelX:circleA.velocity.x;circleA.velocity.y=isNaN(circleA.velocity.y)?oldVelY:circleA.velocity.y};Physics.prototype.project=function(velocity,time){var pointProjected={x:0,y:0,height:0};pointProjected.x=velocity.x*time;pointProjected.y=velocity.y*time-time*time*.5*-900;return pointProjected};Physics.prototype.projectPeak=function(yVelocity){return yVelocity/-900};Physics.prototype.update=function(elapse){for(var j=0;j<this.circles.length;++j){this.circle=this.circles[j];if(this.circle.visible&&this.circle.enabled){this.circle.velocity.y+=900*elapse;this.circle.position.x+=this.circle.velocity.x*elapse;this.circle.position.y+=this.circle.velocity.y*elapse;for(var i=0;i<this.physicsObj.length;++i){switch(this.physicsObj[i].type){case"circle":var circle=this.physicsObj[i];this._physisCircleCircleTest(this.circle,circle);break;case"rect":var rect=this.physicsObj[i];this._physisCircleRectTest(this.circle,rect);break}}}}};var Graphics3D=function(){PIXI.Graphics.call(this);this.pos={x:0,y:0,z:0};this.transPos={};this.scalar=1;this.graf=true;this.rot=0;this.triArray=[];this.triArrayColour=[];this.vertexArray=[];this.vertexTransArray=[]};Graphics3D.prototype=Object.create(PIXI.Graphics.prototype);Graphics3D.prototype.constructor=Graphics3D;Graphics3D.prototype.addVertex=function(x,y,z){this.vertexArray.push({x:x,y:y,z:z});this.vertexTransArray.push({x:x,y:y,z:z})};Graphics3D.prototype.addTri=function(vertA,vertB,vertC,colour){this.triArrayColour.push(colour);this.triArrayColour.push(colour);this.triArrayColour.push(colour);this.triArray.push(vertA);this.triArray.push(vertB);this.triArray.push(vertC)};Graphics3D.prototype.isBackFace=function(vertA,vertB,vertC){var dot=-(vertB.y-vertA.y)*(vertC.x-vertA.x)+(vertB.x-vertA.x)*(vertC.y-vertA.y);return dot>0};Graphics3D.prototype.build=function(){var vertA,vertB,vertC,colour;this.clear();for(var i=0;i<this.triArray.length;i+=3){colour=this.triArrayColour[i];vertA=this.vertexTransArray[this.triArray[i]];vertB=this.vertexTransArray[this.triArray[i+1]];vertC=this.vertexTransArray[this.triArray[i+2]];if(this.isBackFace(vertA,vertB,vertC)&&vertA.z>0&&vertB.z>0&&vertC.z>0){this.beginFill(colour);this.moveTo(vertA.x,vertA.y);this.lineTo(vertB.x,vertB.y);this.lineTo(vertC.x,vertC.y)}}};var MenuScreenWidgets={createBackButton:function(func){var backButton=Interface.button("back",func);backButton.x=CC.WebApp.current.screenWidth*-.5+60;backButton.y=-300;backButton.resize=function(screenWidth,screenHeight){backButton.x=screenWidth*-.5+60};return backButton},createAudioButton:function(){var audioButton=new PIXI.Container;audioButton.soundOn=Interface.button("sound_on_small",function(){Interface.mute();audioButton.soundOn.visible=false;audioButton.soundOff.visible=true});audioButton.soundOff=Interface.button("sound_off_small",function(){Interface.unmute();audioButton.soundOn.visible=true;audioButton.soundOff.visible=false});audioButton.soundOn.visible=!sound._isMute;audioButton.soundOff.visible=sound._isMute;audioButton.addChild(audioButton.soundOn);audioButton.addChild(audioButton.soundOff);audioButton.x=CC.WebApp.current.screenWidth*.5+-60;audioButton.y=-300;audioButton.resize=function(screenWidth,screenHeight){audioButton.x=screenWidth*.5+-60};return audioButton},createSlidingCarousel:function(items){var carousel=new PIXI.Container,slider=new PIXI.Container,leftArrow=Interface.noDelayButton("carousel",function(){carousel.currentSlideIndex--;TweenLite.to(carousel,1,{onUpdate:carousel.updateSlider,positionInPX:carousel.currentSlideIndex*carousel.slideWidth,ease:Back.easeOut})}),rightArrow=Interface.noDelayButton("carousel",function(){carousel.currentSlideIndex++;TweenLite.to(carousel,1,{onUpdate:carousel.updateSlider,positionInPX:carousel.currentSlideIndex*carousel.slideWidth,ease:Back.easeOut})});rightArrow.scale.x*=-1;leftArrow.x=-300;rightArrow.x=300;carousel.addChild(slider);carousel.addChild(leftArrow);carousel.addChild(rightArrow);carousel.slides=[];carousel.slideCount=items.length;carousel.slideWidth=600;carousel.previousSlideIndex=0;carousel.currentSlideIndex=0;carousel.positionInPX=carousel.currentSlideIndex*carousel.slideWidth;carousel.selected=null;carousel.extraSlides=4;var createSlide=function(item){var slide=new PIXI.Container,sprite=new PIXI.Sprite(item.texture.clone());sprite.anchor.set(.5);slide.addChild(sprite);slide.data=item.data;slide.interactive=true;slide.buttonMode=true;slide.hitArea=new PIXI.Circle(0,0,200);slide.mouseover=function(event){var mousePos=event.data.getLocalPosition(carousel);if(Math.abs(mousePos.x)<210){slide.scale.set(1.05)}};slide.mousedown=slide.touchstart=function(event){var mousePos=event.data.getLocalPosition(carousel);if(Math.abs(mousePos.x)<210){TweenLite.killTweensOf(slide.scale)}};slide.mouseup=slide.touchend=function(event){sound.play("click_0");TweenLite.to(slide,.1,{rotation:0});var mousePos=event.data.getLocalPosition(carousel);if(item.press&&Math.abs(mousePos.x)<210){setTimeout(function(){item.press()},300)}};slide.mouseout=slide.touchout=function(event){var mousePos=event.data.getLocalPosition(carousel);if(Math.abs(mousePos.x)<210){slide.rotation=0;slide.scale.set(1)}};if(CC.isMobile){slide.mouseup=function(){};slide.mousedown=function(){};slide.mouseover=function(){};slide.mouseout=function(){}}else{slide.touchstart=function(){};slide.touchend=function(){};slide.touchout=function(){}}return slide};for(var i=0;i<carousel.slideCount+carousel.extraSlides;i++){var item=items[(i+Math.floor(carousel.extraSlides/2))%carousel.slideCount];var slide=createSlide(item);slide.x=(i-Math.floor(carousel.extraSlides/2))*carousel.slideWidth;slider.addChild(slide);carousel.slides.push(slide)}carousel.setPositionByData=function(data){var fakeIndex=0;for(var i=0;i<carousel.slideCount;i++){var correctedIndex=CC.Utility.modo(i,carousel.slideCount)+Math.floor(carousel.extraSlides/2);var currentSlide=carousel.slides[correctedIndex];if(currentSlide.data.id===data.id){carousel.currentSlideIndex=i;carousel.positionInPX=carousel.currentSlideIndex*carousel.slideWidth;carousel.updateSlider();break}}};carousel.updateSlider=function(){slider.position.x=-(CC.Utility.modo(carousel.positionInPX+carousel.slideWidth,carousel.slideCount*carousel.slideWidth)-carousel.slideWidth);var index=CC.Utility.modo(carousel.currentSlideIndex,carousel.slideCount)+Math.floor(carousel.extraSlides/2),prevIndex=CC.Utility.modo(carousel.previousSlideIndex,carousel.slideCount)+Math.floor(carousel.extraSlides/2);carousel.selected=carousel.slides[index];carousel.previousSlideIndex=carousel.currentSlideIndex};carousel.resetPositions=function(){slider.y=-1500;leftArrow.scale.set(0);rightArrow.scale.set(0)};carousel.introAnim=function(callback){carousel.resetPositions();TweenLite.to(slider,1,{y:0,ease:Back.easeOut,onComplete:callback});TweenLite.to(leftArrow.scale,1,{x:1,y:1,ease:Back.easeOut});TweenLite.to(rightArrow.scale,1,{x:-1,y:1,ease:Back.easeOut})};carousel.outroAnim=function(callback){TweenLite.to(slider,.7,{y:-1500,ease:Power1.easeOut});setTimeout(function(){callback()},700);TweenLite.to(leftArrow.scale,.5,{x:0,y:0,ease:Power0.easeNone});TweenLite.to(rightArrow.scale,.5,{x:0,y:0,ease:Power0.easeNone})};carousel.selected=carousel.slides[carousel.currentSlideIndex];window.carousel=carousel;carousel.updateSlider();return carousel}};var MenuScreens={createSplashScreen:function(){var container=new PIXI.Container,backgroundBlurred=new PIXI.Container,background=new PIXI.Container,backgroundLeftBlurred=new PIXI.Sprite.fromFrame("resort_blur_left.png"),backgroundLeft=new PIXI.Sprite.fromFrame("resort_bg_left.png"),backgroundRightBlurred=new PIXI.Sprite.fromFrame("resort_blur_right.png"),backgroundRight=new PIXI.Sprite.fromFrame("resort_bg_right.png"),isExiting=false,canLeave=false,inactiveTime=0;backgroundLeftBlurred.x=backgroundLeft.x=-640;backgroundLeftBlurred.y=backgroundLeft.y=-360;backgroundRightBlurred.x=backgroundRight.x=-640;backgroundRightBlurred.y=backgroundRight.y=-360;background.addChild(backgroundLeft);background.addChild(backgroundRight);backgroundBlurred.addChild(backgroundLeftBlurred);backgroundBlurred.addChild(backgroundRightBlurred);container.addChild(background);container.addChild(backgroundBlurred);var splashAnim=new PIXI.spine.Spine.fromAtlas("anim/title_anim.json");splashAnim.children[17].children[0].texture=PIXI.Texture.fromFrame("img/logo.png");splashAnim.children[17].children[0].scale.x=.75;splashAnim.children[17].children[0].scale.y=.75;window.splashAnim=splashAnim;splashAnim.state.setAnimationByName(0,"intro");splashAnim.state.onComplete=function(){splashAnim.state.setAnimationByName(0,"idle",true);splashAnim.state.onComplete=undefined};splashAnim.stateData.setMixByName("intro","idle",1);container.addChild(splashAnim);var startButton=new PIXI.Container;startButton.hitArea=new PIXI.Rectangle(-135,-70,270,140);startButton.y=240;startButton.buttonMode=true;startButton.interactive=true;startButton.click=startButton.tap=function(){splashAnim.state.onComplete=function(){canLeave=true};if(!isExiting){splashAnim.state.setAnimationByName(0,"outro");isExiting=true;TweenLite.to(backgroundBlurred,.5,{alpha:0});TweenLite.to(audioButton.scale,.5,{x:0,y:0,ease:Power0.easeNone})}sound.play("click_0")};startButton.mouseover=function(){splashAnim.state.setAnimationByName(1,"rollover");inactiveTime=0};container.addChild(startButton);var audioButton=MenuScreenWidgets.createAudioButton();audioButton.scale.set(0);container.addChild(audioButton);TweenLite.to(audioButton.scale,1,{x:1,y:1,ease:Back.easeOut});var updateFunc=function(delta){inactiveTime+=delta;if(canLeave){CC.WebApp.current.swapScreen(MenuScreens.createObjectiveScreen());canLeave=false}if(inactiveTime>5){splashAnim.state.setAnimationByName(1,"rollover");inactiveTime=0}};SS.updateTeamScores();Interface.playMusic("music_screens");sound.play("title_splash");return{construct:container,color:15592941,update:updateFunc}},createObjectiveScreen:function(){var container=new PIXI.Container,backgroundBlurred=new PIXI.Container,background=new PIXI.Container,backgroundLeftBlurred=new PIXI.Sprite.fromFrame("resort_blur_left.png"),backgroundLeft=new PIXI.Sprite.fromFrame("resort_bg_left.png"),backgroundRightBlurred=new PIXI.Sprite.fromFrame("resort_blur_right.png"),backgroundRight=new PIXI.Sprite.fromFrame("resort_bg_right.png"),haveBlured=false,isExiting=false,canLeave=false;backgroundLeftBlurred.x=backgroundLeft.x=-640;backgroundLeftBlurred.y=backgroundLeft.y=-360;backgroundRightBlurred.x=backgroundRight.x=-640;backgroundRightBlurred.y=backgroundRight.y=-360;background.addChild(backgroundLeft);background.addChild(backgroundRight);backgroundBlurred.addChild(backgroundLeftBlurred);backgroundBlurred.addChild(backgroundRightBlurred);backgroundBlurred.alpha=0;container.addChild(background);container.addChild(backgroundBlurred);var trophyAnim=new PIXI.spine.Spine.fromAtlas("anim/beachball_trophy.json");trophyAnim.y=50;trophyAnim.visible=false;container.addChild(trophyAnim);var sign=new PIXI.Container;var signBackground=new PIXI.Sprite.fromFrame("text_panel.png");sign.addChild(signBackground);var text=Interface.text(SS.copy.objectiveTitle,50,"center",700,true,80);text.x=sign.width/2;text.y=sign.height/2;sign.addChild(text);sign.x=-360;sign.y=-360;sign.visible=false;container.addChild(sign);var backButton=MenuScreenWidgets.createBackButton(function(){TweenLite.to(sign,.5,{y:-1e3,ease:Power0.easeNone});TweenLite.to(backButton.scale,.5,{x:0,y:0,ease:Power0.easeNone});TweenLite.to(audioButton.scale,.5,{x:0,y:0,ease:Power0.easeNone});TweenLite.to(continueButton,.7,{y:700,ease:Power0.easeNone,onComplete:function(){CC.WebApp.current.swapScreen(MenuScreens.createSplashScreen())}});trophyAnim.state.setAnimationByName(0,"outro")});backButton.visible=false;container.addChild(backButton);var audioButton=MenuScreenWidgets.createAudioButton();audioButton.visible=false;container.addChild(audioButton);var continueButton=Interface.button("continue",function(){trophyAnim.state.onComplete=function(){canLeave=true};if(!isExiting){trophyAnim.state.setAnimationByName(0,"outro");isExiting=true;TweenLite.to(backButton.scale,.5,{x:0,y:0,ease:Power0.easeNone});TweenLite.to(audioButton.scale,.5,{x:0,y:0,ease:Power0.easeNone});TweenLite.to(continueButton.scale,.5,{x:0,y:0,ease:Power0.easeNone});TweenLite.to(sign,.5,{y:-1e3,ease:Power0.easeNone})}});continueButton.x=CC.WebApp.current.screenWidth*.5+-150;continueButton.y=280;continueButton.visible=false;container.addChild(continueButton);sound.play("crowd_start");var totalTime=0;var updateFunc=function(delta){totalTime+=delta;if(!haveBlured&&totalTime>1){TweenLite.to(backgroundBlurred,.5,{alpha:1,onComplete:function(){trophyAnim.visible=true;sign.visible=true;backButton.visible=true;backButton.scale.set(0);audioButton.visible=true;audioButton.scale.set(0);continueButton.visible=true;continueButton.scale.set(0);trophyAnim.state.setAnimationByName(0,"intro");TweenLite.to(backButton.scale,1,{x:1,y:1,ease:Back.easeOut});TweenLite.to(audioButton.scale,1,{x:1,y:1,ease:Back.easeOut});TweenLite.to(continueButton.scale,1,{x:1,y:1,ease:Back.easeOut});sign.y=-1e3;TweenLite.to(sign,1,{y:-360,ease:Back.easeOut})}});haveBlured=true}if(canLeave){CC.WebApp.current.swapScreen(MenuScreens.createTeamSelectionScreen());canLeave=false}};var resize=function(screenWidth,screenHeight){backButton.resize(screenWidth,screenHeight);continueButton.x=screenWidth*.5+-150;audioButton.resize(screenWidth,screenHeight)};return{construct:container,color:15592941,update:updateFunc,resize:resize}},createTeamSelectionScreen:function(){var container=new PIXI.Container,backgroundBlurred=new PIXI.Container,background=new PIXI.Container,backgroundLeftBlurred=new PIXI.Sprite.fromFrame("resort_blur_left.png"),backgroundLeft=new PIXI.Sprite.fromFrame("resort_bg_left.png"),backgroundRightBlurred=new PIXI.Sprite.fromFrame("resort_blur_right.png"),backgroundRight=new PIXI.Sprite.fromFrame("resort_bg_right.png");backgroundLeftBlurred.x=backgroundLeft.x=-640;backgroundLeftBlurred.y=backgroundLeft.y=-360;backgroundRightBlurred.x=backgroundRight.x=-640;backgroundRightBlurred.y=backgroundRight.y=-360;background.addChild(backgroundLeft);background.addChild(backgroundRight);backgroundBlurred.addChild(backgroundLeftBlurred);backgroundBlurred.addChild(backgroundRightBlurred);container.addChild(background);container.addChild(backgroundBlurred);var carouselItems=[];for(var i=0;i<SS.teams.length;i++){var team=SS.teams[i],item={};item.data=team;var sprite=new PIXI.Container;var frame=new PIXI.Sprite.fromFrame("frame.png"),teamSelectionImage=new PIXI.Sprite.fromFrame(team.selectionImage);frame.anchor.set(.5);teamSelectionImage.anchor.set(.5);sprite.addChild(teamSelectionImage);sprite.addChild(frame);if(true===SS.scoreboardAvailable){var medalData=SS.getMedalByID(team.medalPosition);if(medalData!=null){var medal=new PIXI.Sprite.fromFrame(medalData.medalImage);medal.anchor.set(.5);medal.x=-160;medal.y=-110;sprite.addChild(medal)}}item.texture=sprite.generateTexture(CC.WebApp.current.renderer);item.press=function(){goForward()};carouselItems.push(item)}var carousel=MenuScreenWidgets.createSlidingCarousel(carouselItems);if(SS.selectedTeam){carousel.setPositionByData(SS.selectedTeam)}else{carousel.setPositionByData(SS.teams[Math.floor(Math.random()*SS.teams.length)])}container.addChild(carousel);carousel.introAnim();var sign=new PIXI.Container;var signBackground=new PIXI.Sprite.fromFrame("text_panel.png");sign.addChild(signBackground);var text=Interface.text(SS.copy.teamSelectionTitle,50,"center",700,true,80);text.x=sign.width/2;text.y=sign.height/2;sign.addChild(text);sign.x=-360;sign.y=-1e3;container.addChild(sign);TweenLite.to(sign,1,{y:-360,ease:Back.easeOut});var backButton=MenuScreenWidgets.createBackButton(function(){goBackward()});backButton.scale.set(0);container.addChild(backButton);TweenLite.to(backButton.scale,1,{x:1,y:1,ease:Back.easeOut});var audioButton=MenuScreenWidgets.createAudioButton();audioButton.scale.set(0);container.addChild(audioButton);TweenLite.to(audioButton.scale,1,{x:1,y:1,ease:Back.easeOut});var continueButton=Interface.button("continue",function(){goForward()});continueButton.x=0;continueButton.y=700;if(!CC.isMobile){container.addChild(continueButton)}TweenLite.to(continueButton,1,{x:0,y:280,ease:Back.easeOut});function goBackward(){
TweenLite.to(sign,.5,{y:-1e3,ease:Power0.easeNone});TweenLite.to(backButton.scale,.5,{x:0,y:0,ease:Power0.easeNone});TweenLite.to(audioButton.scale,.5,{x:0,y:0,ease:Power0.easeNone});TweenLite.to(continueButton,.7,{x:0,y:700,ease:Power0.easeNone});TweenLite.to(backgroundBlurred,.5,{alpha:0});carousel.outroAnim(function(){CC.WebApp.current.swapScreen(MenuScreens.createObjectiveScreen())})}function goForward(){SS.selectedTeam=carousel.selected.data;TweenLite.to(sign,.5,{y:-1e3,ease:Power0.easeNone});TweenLite.to(backButton.scale,.5,{x:0,y:0,ease:Power0.easeNone});TweenLite.to(audioButton.scale,.5,{x:0,y:0,ease:Power0.easeNone});TweenLite.to(continueButton,.7,{x:0,y:700,ease:Power0.easeNone});carousel.outroAnim(function(){CC.WebApp.current.swapScreen(MenuScreens.createEventSelectionScreen())})}var updateFunc=function(delta){};var resize=function(screenWidth,screenHeight){backButton.resize(screenWidth,screenHeight);audioButton.resize(screenWidth,screenHeight)};return{construct:container,color:15592941,update:updateFunc,resize:resize}},createEventSelectionScreen:function(){var container=new PIXI.Container,backgroundLeft=new PIXI.Sprite.fromFrame("resort_blur_left.png"),backgroundRight=new PIXI.Sprite.fromFrame("resort_blur_right.png");backgroundLeft.x=-640;backgroundLeft.y=-360;backgroundRight.x=-640;backgroundRight.y=-360;container.addChild(backgroundLeft);container.addChild(backgroundRight);var carouselItems=[];for(var i=0;i<SS.events.length;i++){var events=SS.events[i];var item={};item.data=events;var sprite=new PIXI.Sprite.fromFrame(events.selectionImage);sprite.anchor.set(.5);item.texture=sprite.generateTexture(CC.WebApp.current.renderer);item.press=function(){goForward()};carouselItems.push(item)}var carousel=MenuScreenWidgets.createSlidingCarousel(carouselItems);container.addChild(carousel);carousel.introAnim();var sign=new PIXI.Container;var signBackground=new PIXI.Sprite.fromFrame("text_panel.png");sign.addChild(signBackground);var text=Interface.text(SS.copy.eventSelectionTitle,50,"center",700,true,80);text.x=sign.width/2;text.y=sign.height/2;sign.addChild(text);sign.x=-360;sign.y=-1e3;container.addChild(sign);TweenLite.to(sign,1,{y:-360,ease:Back.easeOut});var backButton=MenuScreenWidgets.createBackButton(function(){goBackward()});backButton.scale.set(0);container.addChild(backButton);TweenLite.to(backButton.scale,1,{x:1,y:1,ease:Back.easeOut});var audioButton=MenuScreenWidgets.createAudioButton();audioButton.scale.set(0);container.addChild(audioButton);TweenLite.to(audioButton.scale,1,{x:1,y:1,ease:Back.easeOut});var continueButton=Interface.button("continue",function(){goForward()});continueButton.x=0;continueButton.y=700;if(!CC.isMobile){container.addChild(continueButton)}TweenLite.to(continueButton,1,{x:0,y:280,ease:Back.easeOut});function goBackward(){TweenLite.to(sign,.5,{y:-1e3,ease:Power0.easeNone});TweenLite.to(backButton.scale,.5,{x:0,y:0,ease:Power0.easeNone});TweenLite.to(audioButton.scale,.5,{x:0,y:0,ease:Power0.easeNone});TweenLite.to(continueButton,.7,{x:0,y:700,ease:Power0.easeNone});carousel.outroAnim(function(){CC.WebApp.current.swapScreen(MenuScreens.createTeamSelectionScreen())})}function goForward(){SS.selectedEvent=carousel.selected.data;TweenLite.to(sign,.5,{y:-1e3,ease:Power0.easeNone});TweenLite.to(backButton.scale,.5,{x:0,y:0,ease:Power0.easeNone});TweenLite.to(audioButton.scale,.5,{x:0,y:0,ease:Power0.easeNone});TweenLite.to(continueButton,.7,{x:0,y:700,ease:Power0.easeNone});carousel.outroAnim(function(){CC.WebApp.current.swapScreen(carousel.selected.data.selectedScreen())})}var updateFunc=function(delta){};var resize=function(screenWidth,screenHeight){backButton.resize(screenWidth,screenHeight);audioButton.resize(screenWidth,screenHeight)};return{construct:container,color:15592941,update:updateFunc,resize:resize}}};var BasketZorbScreens={createStartScreen:function(){var container=new PIXI.Container;var updateFunc=function(delta){};return{construct:container,color:16711680,update:updateFunc}},createGameEndPopup:function(refreshFunc,nextFunc){var popupHolder=new PIXI.Container;var popupBack=CC.Utility.pixiAtlasSprite("end_panel.png");var team=SS.selectedTeam?SS.selectedTeam.id:URLQuery[2];var charactersToken=CC.Utility.pixiAtlasSprite("teams000"+(team+1)+".png",{x:330,y:-180,scale:.5});charactersToken.addChild(CC.Utility.pixiAtlasSprite("frame.png"));charactersToken.visible=false;var scorePrefix=SS.copy.bestScorePrefix+": ";if(scorePrefix.length>8){scorePrefix=""}var blackBack=new PIXI.Graphics;blackBack.beginFill(0,.5);blackBack.drawRect(-1e3,-1e3,2e3,2e3);var player1=new PIXI.spine.Spine.fromAtlas("anim/end_character_"+team*2+".json");var player2=new PIXI.spine.Spine.fromAtlas("anim/end_character_"+(team*2+1)+".json");player1.x=370;player2.x=-370;player1.y=370;player2.y=370;var scoreIconA=CC.Utility.pixiAtlasSprite("basket_icon.png",{x:-110,y:-70});var scoreIconB=CC.Utility.pixiAtlasSprite("basket_icon.png",{x:110,y:-70,scale:{x:-1,y:1}});var recordIconA=CC.Utility.pixiAtlasSprite("trophy_icon.png",{x:-150,y:50});var recordIconB=CC.Utility.pixiAtlasSprite("trophy_icon.png",{x:150,y:50,scale:{x:-1,y:1}});var starsImage=new PIXI.spine.Spine.fromAtlas("anim/star_results.json");starsImage.position.y=-210;player1.state.setAnimationByName(0,"animation",true);player2.state.setAnimationByName(0,"animation",true);var scoreText=new PIXI.Container;var scoreTextOutside=new PIXI.extras.BitmapText("00",{font:150+"px zorb_ball_font_outline",align:"left"});var scoreTextInside=new PIXI.extras.BitmapText("00",{font:150+"px zorb_ball_font",align:"left"});var recordText=new PIXI.Container;var recordTextOutside=new PIXI.extras.BitmapText("Best: 00",{font:90+"px zorb_ball_font_outline",align:"left"});var recordTextInside=new PIXI.extras.BitmapText("Best: 00",{font:90+"px zorb_ball_font",align:"left"});scoreTextOutside.x=scoreTextOutside.textWidth*-.5;scoreTextInside.x=scoreTextInside.textWidth*-.5;recordTextOutside.x=recordTextOutside.textWidth*-.5;recordTextInside.x=recordTextInside.textWidth*-.5;var recordBroken=false;var recordShown=false;var starIndex=1;popupHolder.show=function(score){Interface.playMusic("music_screens");TweenLite.from(player1,.5,{ease:Bounce.easeOut,y:1e3});TweenLite.from(player2,.5,{ease:Bounce.easeOut,y:1e3});this.visible=true;starIndex=SS.selectedEvent.calculateStarScore(score);this.gameScore=0;var highScore=localStorage.getItem("boomsports_ball_high_score");var scoreUpdate=function(){scoreTextOutside.text=CC.Utility.intToString(Math.round(this.gameScore),2);scoreTextInside.text=scoreTextOutside.text;scoreTextOutside.x=scoreTextOutside.textWidth*-.5;scoreTextInside.x=scoreTextInside.textWidth*-.5};var scoreComplete=function(){if(recordBroken){recordText.scale.x=1.2;recordText.scale.y=1.2;TweenLite.to(recordText.scale,.3,{x:1,y:1});recordTextOutside.text=scorePrefix+CC.Utility.intToString(Math.round(highScore)||"00",2);recordTextInside.text=recordTextOutside.text;recordTextOutside.updateText();recordTextOutside.updateTransform();recordTextInside.updateText();recordTextInside.updateTransform();recordTextOutside.x=recordTextOutside.textWidth*-.5;recordTextInside.x=recordTextInside.textWidth*-.5;recordShown=true}};TweenLite.to(this,1,{gameScore:score,onUpdateScope:this,onUpdate:scoreUpdate,onCompleteScope:this,onComplete:scoreComplete});recordTextOutside.text=scorePrefix+CC.Utility.intToString(Math.round(highScore)||"00",2);recordTextInside.text=recordTextOutside.text;recordTextOutside.updateText();recordTextOutside.updateTransform();recordTextInside.updateText();recordTextInside.updateTransform();recordTextOutside.x=recordTextOutside.textWidth*-.5;recordTextInside.x=recordTextInside.textWidth*-.5;recordIconA.x=recordTextOutside.textWidth*-.5-40;recordIconB.x=recordTextOutside.textWidth*.5+40;if(highScore===null||highScore<score){recordBroken=true;highScore=score;localStorage.setItem("boomsports_ball_high_score",score)}starsImage.state.setAnimationByName(0,"stars_"+starIndex)};scoreText.addChild(scoreTextOutside);scoreText.addChild(scoreTextInside);recordText.addChild(recordTextOutside);recordText.addChild(recordTextInside);scoreText.y=-140;recordText.y=0;var timer=0;popupHolder.update=function(delta){timer+=delta*10;if(recordShown){recordIconA.rotation=Math.sin(timer)*.2;recordIconB.rotation=-Math.sin(timer)*.2;recordText.scale.x=1+Math.sin(timer)*.05;recordText.scale.y=recordText.scale.x}};var closePanel=function(buttonFunc){starsImage.state.setAnimationByName(0,"stars_"+(starIndex||5)+"_out");TweenLite.to(replayButton.scale,.3,{ease:Back.easeIn,x:.7,y:.7,onComplete:function(){replayButton.visible=false}});TweenLite.to(nextButton.scale,.3,{ease:Back.easeIn,x:.7,y:.7,onComplete:function(){nextButton.visible=false}});replayButton.interactive=false;nextButton.interactive=false;charactersToken.visible=true;setTimeout(function(){sound.play("ball_star_0")},500);TweenLite.to(charactersToken.scale,.5,{ease:Back.easeOut,x:.5,y:.5,onComplete:function(){TweenLite.to(charactersToken.scale,.3,{delay:.3,x:.7,y:.7})}});TweenLite.to(charactersToken.scale,.5,{delay:1.5,ease:Back.easeIn,x:.3,y:.3,onComplete:function(){charactersToken.visible=false;setTimeout(function(){Interface.playMusic("music_screens");buttonFunc()},300)}});TweenLite.to(player1,.5,{ease:Quad.easeIn,y:800});TweenLite.to(player2,.5,{ease:Quad.easeIn,y:800})};var replayButton=Interface.button("replay",function(){closePanel(refreshFunc)});var nextButton=Interface.button("next",function(){closePanel(nextFunc)});replayButton.position.x=-70;nextButton.position.x=70;replayButton.position.y=190;nextButton.position.y=190;popupHolder.addChild(blackBack);popupHolder.addChild(popupBack);popupHolder.addChild(scoreIconA);popupHolder.addChild(scoreIconB);popupHolder.addChild(recordIconA);popupHolder.addChild(recordIconB);popupHolder.addChild(scoreText);popupHolder.addChild(recordText);popupHolder.addChild(replayButton);popupHolder.addChild(nextButton);popupHolder.addChild(charactersToken);popupHolder.addChild(starsImage);popupHolder.addChild(player1);popupHolder.addChild(player2);popupHolder.visible=false;popupHolder.hitArea=new PIXI.Rectangle(-1e3,-1e3,2e3,2e3);popupHolder.interactive=true;popupHolder.click=popupHolder.tap=function(eventData){};return popupHolder},constrainDistance:function(pointA,pointB,maxDistance,fixedA){var relativeVector={};var midPoint={};relativeVector.x=pointA.x-pointB.x;relativeVector.y=pointA.y-pointB.y;midPoint.x=(pointA.x+pointB.x)*.5;midPoint.y=(pointA.y+pointB.y)*.5;distance=CC.Geometry.vectorLengthSquared(relativeVector);if(distance>maxDistance*maxDistance){distance=Math.sqrt(distance);relativeVector.x/=distance*2;relativeVector.y/=distance*2;if(fixedA){pointB.x=midPoint.x+-(relativeVector.x*maxDistance);pointB.y=midPoint.y+-(relativeVector.y*maxDistance)}else{pointA.x=midPoint.x+relativeVector.x*maxDistance;pointA.y=midPoint.y+relativeVector.y*maxDistance;pointB.x=midPoint.x+-(relativeVector.x*maxDistance);pointB.y=midPoint.y+-(relativeVector.y*maxDistance)}}},createNet:function(levels){var netGraphicsObject=new PIXI.Graphics;netPhyiscsNodes=[];var verticalStep=37;var offset={x:-305,y:-60};for(var i=0;i<levels;++i){var nodeA={xOrigin:verticalStep*(levels-i)*-.5,yOrigin:verticalStep*i,xVel:0,yVel:0};var nodeB={xOrigin:verticalStep*(levels-i)*.5,yOrigin:verticalStep*i,xVel:0,yVel:0};nodeA.xOrigin+=offset.x;nodeA.yOrigin+=offset.y;nodeB.xOrigin+=offset.x;nodeB.yOrigin+=offset.y;nodeA.x=nodeA.xOrigin;nodeA.y=nodeA.yOrigin;nodeB.x=nodeB.xOrigin;nodeB.y=nodeB.yOrigin;netPhyiscsNodes.push(nodeA);netPhyiscsNodes.push(nodeB)}var step1,step2,A,B,C,D,AB,CD,netLevels,circle,distance,dipA,dipB;relativeVector={x:0,y:0};var flipSide=1;netGraphicsObject.update=function(delta,circles){var netLevels=levels+1;for(var i=0;i<levels-1;++i){A=netPhyiscsNodes[i*2];B=netPhyiscsNodes[i*2+1];C=netPhyiscsNodes[i*2+2];D=netPhyiscsNodes[i*2+3];if(!i){BasketZorbScreens.constrainDistance(A,B,verticalStep*netLevels)}netLevels*=.9;BasketZorbScreens.constrainDistance(C,D,verticalStep*(netLevels-2));BasketZorbScreens.constrainDistance(A,C,verticalStep,!i);BasketZorbScreens.constrainDistance(B,D,verticalStep,!i)}for(var i=0;i<netPhyiscsNodes.length;++i){var node=netPhyiscsNodes[i];node.xVel*=.5;node.yVel*=.5;node.yVel+=20;if(i>=2){node.x+=node.xVel*delta;node.y+=node.yVel*delta}for(var j=0;j<circles.length;++j){circle=circles[j];relativeVector.x=node.x-circle.x;relativeVector.y=node.y-circle.y;distance=CC.Geometry.vectorLengthSquared(relativeVector);if(distance<circle.radius*circle.radius){distance=Math.sqrt(distance);node.xVel=relativeVector.x*-10;node.yVel=relativeVector.y*-10;relativeVector.x/=distance;relativeVector.y/=distance;node.x=circle.x+relativeVector.x*circle.radius;node.y=circle.y+relativeVector.y*circle.radius;circle.velocity.x+=relativeVector.x*-100;circle.velocity.y+=relativeVector.y*-100}}}this.clear();this.lineStyle(4,16777215);for(var i=0;i<levels-1;++i){A=netPhyiscsNodes[i*2];B=netPhyiscsNodes[i*2+1];C=netPhyiscsNodes[i*2+2];D=netPhyiscsNodes[i*2+3];netLevels=levels-i+1;this.moveTo(A.x,A.y);for(var j=0;j<netLevels;++j){step1=j/netLevels;step2=j/(netLevels-1);dipA=Math.sin(step1*Math.PI)*10;dipB=Math.sin(step2*Math.PI)*10;AB={x:Math.lerp(A.x,B.x,step1),y:Math.lerp(A.y,B.y,step1)+dipA};CD={x:Math.lerp(C.x,D.x,step2),y:Math.lerp(C.y,D.y,step2)+dipB};this.lineTo(AB.x,AB.y);this.lineTo(CD.x,CD.y)}this.lineTo(B.x,B.y)}};return netGraphicsObject},createGameScreen:function(screenObject){window.focus();console.log("this has changed");SS.getAccessToken();Interface.stopMusic();sound.play("crowd_start");sound.play("game_intro_sting");var container=new PIXI.Container;var ballShadowHolder=new PIXI.Container;var ballHolder=new PIXI.Container;var popupHolder=this.createGameEndPopup(function(){CC.WebApp.current.swapScreen(BasketZorbScreens.createGameScreen())},function(){CC.WebApp.current.swapScreen(MenuScreens.createTeamSelectionScreen())});if(CC.isMobile){var helpPopup=Interface.helpPopup(SS.copy.ballHelpMobile,"help_screens_ball.png","help_controls_3.png")}else{var helpPopup=Interface.helpPopup(SS.copy.ballHelpDesktop,"help_screens_ball.png","help_controls_0.png")}var pausePopup=Interface.pausePopup(helpPopup);var pauseButton=Interface.button("pause",function(){pausePopup.show();pauseButton.visible=false;restartButton.visible=false});pauseButton.position.y=-300;var restartButton=Interface.button("restart",function(){CC.WebApp.current.swapScreen(BasketZorbScreens.createGameScreen())});restartButton.position.y=-300;var streakTracker=0;var ballPowerMul=CC.isMobile?1.5:1;var boatParty=CC.Utility.pixiAtlasMovieClip(["boat_party0001.png","boat_party0002.png","boat_party0003.png","boat_party0004.png","boat_party0005.png","boat_party0006.png","boat_party0007.png"]);boatParty.animationSpeed=.3;boatParty.position.x=750;boatParty.position.y=-70;boatParty.play();var chopper=CC.Utility.pixiAtlasMovieClip(["chopper001.png","chopper002.png"]);chopper.animationSpeed=.3;chopper.position.x=-750;chopper.position.y=-150;chopper.play();var background=CC.Utility.pixiAtlasSprite("basketzorb_bg1.png");background.addChild(CC.Utility.pixiAtlasSprite("basketzorb_bg2.png"));var midground=CC.Utility.pixiAtlasSprite("basketzorb_mg1.png");midground.addChild(CC.Utility.pixiAtlasSprite("basketzorb_mg2.png"));var beachHead=CC.Utility.pixiAtlasSprite("basketzorb_beach1.png",{y:170,anchor:"b"});beachHead.addChild(CC.Utility.pixiAtlasSprite("basketzorb_beach2.png",{anchor:"b"}));var waveHead=CC.Utility.pixiAtlasSprite("basketzorb_wash1.png",{y:150,anchor:"b"});waveHead.addChild(CC.Utility.pixiAtlasSprite("basketzorb_wash2.png",{anchor:"b"}));var wetSandHead=CC.Utility.pixiAtlasSprite("basketzorb_wetsand1.png",{y:150,anchor:"b"});wetSandHead.addChild(CC.Utility.pixiAtlasSprite("basketzorb_wetsand2.png",{anchor:"b"}));var treeLeaves=new PIXI.Container;treeLeaves.addChild(CC.Utility.pixiAtlasSprite("basketzorb_palm0003.png"));treeLeaves.addChild(CC.Utility.pixiAtlasSprite("basketzorb_palm0002.png"));treeLeaves.addChild(CC.Utility.pixiAtlasSprite("basketzorb_palm0001.png"));treeLeaves.addChild(CC.Utility.pixiAtlasSprite("basketzorb_palm0004.png"));treeLeaves.addChild(CC.Utility.pixiAtlasSprite("basketzorb_palm0005.png"));treeLeaves.addChild(CC.Utility.pixiAtlasSprite("basketzorb_palm0006.png"));treeLeaves.addChild(CC.Utility.pixiAtlasSprite("basketzorb_palm0007.png"));treeLeaves.position.x=485;treeLeaves.position.y=-185;var timerCountDown=63;var oldCountDown=63;var countdownWhistleSoundPlayed=false;var crowdA=new PIXI.spine.Spine.fromAtlas("anim/basketzorb_crowd.json");var crowdB=new PIXI.spine.Spine.fromAtlas("anim/basketzorb_crowd.json");crowdA.position.y=360;crowdB.position.y=360;crowdB.scale.x=-1;window.crowdA=crowdA;crowdA.state.setAnimationByName(0,"idle1",true);crowdB.state.setAnimationByName(0,"idle2",true);crowdA.stateData.setMixByName("idle1","react1",.3);crowdB.stateData.setMixByName("idle2","react2",.3);crowdA.stateData.setMixByName("react1","idle1",.3);crowdB.stateData.setMixByName("react2","idle2",.3);var totalScore=0;var scoreSize=Math.round(128*.8);var timeSize=Math.round(128*.8);var scoreText=CC.Utility.pixiAtlasSprite("score_panel.png",{anchor:"br"});var scoreTextOutside=new PIXI.extras.BitmapText("00",{font:scoreSize+"px zorb_ball_font_outline",align:"left"});var scoreTextInside=new PIXI.extras.BitmapText("00",{font:scoreSize+"px zorb_ball_font",align:"left"});var timeText=CC.Utility.pixiAtlasSprite("time_panel.png",{anchor:"bl"});var timeTextOutside=new PIXI.extras.BitmapText("0",{font:timeSize+"px zorb_ball_font_outline",align:"center"});var timeTextInside=new PIXI.extras.BitmapText("10:15",{font:timeSize+"px zorb_ball_font",align:"center"});scoreText.addChild(scoreTextOutside);scoreText.addChild(scoreTextInside);timeText.addChild(timeTextOutside);timeText.addChild(timeTextInside);scoreTextOutside.position.x=scoreTextInside.position.x=-180;scoreTextOutside.position.y=scoreTextInside.position.y=-95;timeTextOutside.position.x=timeTextInside.position.x=100;timeTextOutside.position.y=timeTextInside.position.y=-95;scoreText.position.y=360;scoreText.position.x=620;timeText.position.x=-620;timeText.position.y=360;var target=CC.Utility.pixiAtlasSprite("power_arrow.png",{scale:.05});var countdownAnim=new PIXI.spine.Spine.fromAtlas("anim/countdown.json");target.position.x=-305;target.position.y=-65;countdownAnim.state.onEvent=function(i,event){if(event.stringValue==="sound_beep"){sound.play("beep")}else{Interface.playMusic("ball_music_0");sound.play("ball_start_whistle")}};countdownAnim.visible=false;countdownAnim.preWait=1.5;countdownAnim.preWaitOver=false;var powerArrow=CC.Utility.pixiAtlasSprite("power_arrow.png");var powerArrowStem=new PIXI.Graphics;var resetTimer=0;container.hitArea=new PIXI.Rectangle(-1e3,-1e3,2e3,2e3);container.interactive=true;container.mouseup=container.touchend=function(){if(resetTimer<0){}};var backboard=CC.Utility.pixiAtlasSprite("basket_back.png");var hoop=new PIXI.spine.Spine.fromAtlas("anim/basket.json");var starBurst=new PIXI.spine.Spine.fromAtlas("anim/starburst.json");var zorbRef=new PIXI.spine.Spine.fromAtlas("anim/ref_zorb.json");var hoopGlow=CC.Utility.pixiAtlasSprite("hoop_glow.png");zorbRef.y=-80;zorbRef.scale.y=.2;zorbRef.state.setAnimationByName(0,"idle",true);backboard.position.x=-325;backboard.position.y=-65;hoopGlow.position.x=target.position.x;hoopGlow.position.y=target.position.y;hoopGlow.alpha=0;hoop.position.x=backboard.position.x+18;hoop.position.y=backboard.position.y+11;hoop.update(10);starBurst.position.x=backboard.position.x+18;starBurst.position.y=backboard.position.y+11;starBurst.position.y+=100;starBurst.scale.x=starBurst.scale.y=.9;starBurst.visible=false;powerArrowStem.visible=false;var ballCount=2;var ballsArray=[];var ballsArrayShadow=[];var ballsIndex=0;var physics=new Physics;for(var i=0;i<ballCount;++i){var ball=new PIXI.Container;ball.wave=CC.Utility.pixiAtlasSprite("zorb_back.png",{alpha:0});var team=SS.selectedTeam?SS.selectedTeam.id:URLQuery[2];ball.character=new PIXI.spine.Spine.fromAtlas("anim/zorb_character_"+(team*2+i)+".json");ball.character.state.setAnimationByName(0,"idle",true);ball.highlight=CC.Utility.pixiAtlasSprite("zorb_front.png");ball.addChild(ball.wave);ball.addChild(ball.character);ball.hitArea=new PIXI.Circle(0,0,94*.5);ball.radius=94*.5;ball.index=i;ball.position.x=300;ball.enabled=false;ball.visible=false;ball.interactive=true;ball.buttonMode=true;ball.prevY=0;ball.rimHits=5;ball.shadow=new PIXI.Graphics;ballShadowHolder.addChild(ball.shadow);ball.shadow.beginFill(0);ball.shadow.x=0;ball.shadow.y=220;ball.shadow.visible=false;ball.shadow.drawCircle(0,0,64*.5);ball.shadow.scale.y=.3;var drawTrajectory=function(velocity){powerArrowStem.clear();var maxHeight=physics.projectPeak(velocity.y);maxHeight+=.2;var lastPos={x:0,y:0};var dir=velocity.x>0?-1:1;var sections=3;var sectionList=[];sectionList[0]={x:0,y:0};for(var j=1;j<=sections;++j){var step=maxHeight/sections;var pos=physics.project(velocity,j*step);lastPos.angle=Math.atan2(pos.y-lastPos.y,pos.x-lastPos.x)+Math.PI*.5;lastPos.x=pos.x;lastPos.y=pos.y;sectionList[j]=pos}var distanceToPeak=CC.Geometry.vectorLength(sectionList[3]);var normal={x:sectionList[3].y/distanceToPeak,y:-(sectionList[3].x/distanceToPeak)};var dotLength1=CC.Geometry.dotProduct2D(normal,sectionList[1]);var dotLength2=CC.Geometry.dotProduct2D(normal,sectionList[2]);sectionList[1].x+=dotLength1*normal.x*.5;sectionList[1].y+=dotLength1*normal.y*.5;sectionList[2].x+=dotLength2*normal.x*.5;sectionList[2].y+=dotLength2*normal.y*.5;var value=distanceToPeak/400;for(var j=0;j<2;++j){var vertical=j*1.5;if(j){powerArrowStem.beginFill(16777215);powerArrowStem.lineStyle(0,8947848)}else{powerArrowStem.lineStyle(6,8947848)}var angle=.4;var sinA=Math.sin(angle);var cosA=Math.cos(angle);var sinB=Math.sin(angle+Math.PI*.5);var cosB=Math.cos(angle+Math.PI*.5);powerArrowStem.moveTo(0,0);powerArrowStem.bezierCurveTo(sectionList[1].x,sectionList[1].y+8*value-vertical,sectionList[2].x,sectionList[2].y+8*value-vertical,sectionList[3].x+16*value*sinA,sectionList[3].y+16*value*cosA);powerArrowStem.lineTo(sectionList[3].x+32*value*sinA,sectionList[3].y+32*value*cosA-vertical);powerArrowStem.lineTo(sectionList[3].x+-40*value*sinB,sectionList[3].y+-40*value*cosB-vertical);powerArrowStem.lineTo(sectionList[3].x+32*value*-sinA,sectionList[3].y+32*value*-cosA-vertical);powerArrowStem.lineTo(sectionList[3].x+16*value*-sinA,sectionList[3].y+16*value*-cosA-vertical);powerArrowStem.bezierCurveTo(sectionList[2].x,sectionList[2].y-8*value-vertical,sectionList[1].x,sectionList[1].y-8*value-vertical,sectionList[0].x,sectionList[0].y-1-vertical)}return lastPos};ball.onInput=function(events){if(!this.grabbed&&!this.enabled){powerArrowStem.position.x=this.position.x;powerArrowStem.position.y=this.position.y;var mousePos=events.data.getLocalPosition(this);this.grabbed=true;powerArrowStem.visible=true;powerArrowStem.clear()}};ball.moveInput=function(events){if(this.grabbed){var mousePos=events.data.getLocalPosition(this);if(mousePos.y>0){var lastPos=drawTrajectory({x:-mousePos.x*4*ballPowerMul,y:-mousePos.y*4*ballPowerMul})}else{powerArrowStem.clear()}var power=Math.sqrt(mousePos.x*mousePos.x+mousePos.y*mousePos.y)/200;powerArrowStem.visible=true}};ball.reset=function(){this.floorHits=0;this.alpha=1;this.visible=true;this.shadow.visible=true;this.enabled=false;var randomScale=1-timerCountDown/60*.9;this.position.x=200+Math.sin(Math.random()*Math.PI*2)*200*randomScale;this.position.y=Math.sin(Math.random()*Math.PI*2)*150*randomScale;this.scale.x=this.scale.y=.5;this.velocity.x=0;this.velocity.y=0;this.rimHits=5;sound.play("ball_spawnned_0");var otherBall=ballsArray[1-this.index];if(!otherBall.enabled&&CC.Geometry.vectorDistance(otherBall.position,this.position)<94){var angle=Math.random()*Math.PI*2;this.position.x=otherBall.position.x+Math.sin(angle)*this.radius*2.2;this.position.y=otherBall.position.y+Math.cos(angle)*this.radius*2.2}this.character.skeleton.setToSetupPose();this.character.state.setAnimationByName(0,"idle",true);this.character.rotation=0;TweenLite.to(this.scale,.5,{x:1,y:1,ease:Back.easeOut});this.wave.alpha=1;this.wave.scale.x=1;this.wave.scale.y=1;TweenLite.to(this.wave.scale,.7,{x:4,y:4});TweenLite.to(this.wave,.7,{alpha:0})};ball.offInput=function(events){var mousePos=events.data.getLocalPosition(this);if(this.grabbed){resetTimer=1;this.grabbed=false;this.enabled=true;powerArrowStem.visible=false;this.velocity.x=-mousePos.x*4*ballPowerMul;this.velocity.y=-mousePos.y*4*ballPowerMul;ballsIndex=(ballsIndex+1)%ballCount;sound.play("ball_launch");this.character.state.setAnimationByName(0,"release",true);if(!ballsArray[ballsIndex].visible){ballsArray[ballsIndex].reset()}}};ball.justOff=function(events){var mousePos=events.data.getLocalPosition(this);if(this.grabbed){this.grabbed=false;powerArrow.visible=false}};ball.floorHits=0;ball.touchstart=ball.mousedown=ball.onInput;ball.touchmove=ball.mousemove=ball.moveInput;ball.touchendoutside=ball.mouseupoutside=ball.offInput;ball.touchend=ball.mouseup=ball.justOff;ballsArray.push(ball);ballHolder.addChild(ball);physics.addDynamicCircle(ballsArray[i])}var floorRect=physics.addRect(new PIXI.Rectangle(-1e3,225,2e3,200));floorRect.func=function(circle){sound.play("ball_bounce");circle.floorHits++;if(circle.floorHits>1){circle.reset();streakTracker=0}};var backBoardPhys=physics.addRect(new PIXI.Rectangle(-500,-300,100,300));var hoopPhys=physics.addCircle({x:-215,y:-65,radius:8});var backboardRapidHits=0;var backboardTimeDown=0;backBoardPhys.func=function(circle){circle.rimHits--;circle.rimHits--;console.log(backboardTimeDown);if(backboardTimeDown>.05){backboardTimeDown=0;backboardRapidHits=0;sound.play("ball_rim_bounce")}else{backboardRapidHits++;if(backboardRapidHits>2){circle.reset()}}};hoopPhys.func=function(circle){circle.rimHits--;circle.rimHits--;sound.play("ball_rim_bounce")};target.visible=false;container.addChild(background);container.addChild(waveHead);container.addChild(wetSandHead);container.addChild(beachHead);container.addChild(chopper);container.addChild(boatParty);container.addChild(zorbRef);container.addChild(midground);container.addChild(treeLeaves);container.addChild(backboard);container.addChild(ballShadowHolder);container.addChild(powerArrowStem);container.addChild(ballHolder);container.addChild(target);container.addChild(starBurst);container.addChild(hoop);container.addChild(hoopGlow);container.addChild(crowdA);container.addChild(crowdB);container.addChild(scoreText);container.addChild(timeText);container.addChild(pauseButton);container.addChild(restartButton);container.addChild(popupHolder);container.addChild(countdownAnim);container.addChild(pausePopup);container.addChild(helpPopup);var animTimer=0;var oldSeconds=-1;var seconds,waveTimer,seconds,minute,timerText;var chopperFlip=1;var showHelpStart=window.boom_help_shown_already_ball===undefined;var firstBallStart=true;var updateFunc=function(delta){delta=Math.min(delta,.06);backboardTimeDown+=delta;if(forcePause&&!pausePopup.visible){pausePopup.show();pauseButton.visible=false;restartButton.visible=false}if(!countdownAnim.preWaitOver){countdownAnim.preWait-=delta;if(countdownAnim.preWait<0){countdownAnim.preWaitOver=true;countdownAnim.visible=true;countdownAnim.state.setAnimationByName(0,"countdown")}}crowdA.position.x=CC.WebApp.current.screenWidth*-.5;crowdB.position.x=CC.WebApp.current.screenWidth*.5;timeText.position.x=CC.WebApp.current.screenWidth*-.5;scoreText.position.x=CC.WebApp.current.screenWidth*.5;pauseButton.position.x=CC.WebApp.current.screenWidth*.5-60;restartButton.position.x=CC.WebApp.current.screenWidth*-.5+60;boatParty.position.x+=delta*-25;boatParty.position.y=Math.sin(boatParty.position.x*.02)*5-70;if(boatParty.position.x>750){boatParty.position.x=750}chopper.position.x+=delta*-100*chopperFlip;chopper.position.y=Math.sin(chopper.position.x*.01)*10-250;if(Math.abs(chopper.position.x)>800){chopperFlip=-chopperFlip;chopper.position.x=chopperFlip*750;chopper.scale.x=chopperFlip}waveTimer=animTimer*.5;wetSandHead.scale.y=1+Math.sin(waveTimer)*.25;beachHead.scale.y=1+Math.sin(waveTimer)*.03;waveHead.scale.y=1+Math.sin(waveTimer-1)*.2;animTimer+=delta;for(var i=0;i<treeLeaves.children.length;++i){treeLeaves.children[i].rotation=Math.sin(i+animTimer)*.05}if(countdownAnim.preWaitOver){timerCountDown=Math.max(0,timerCountDown-delta)}if(firstBallStart&&timerCountDown<60){firstBallStart=false;TweenLite.to(zorbRef,.3,{delay:1,ease:Back.easeOut,y:-130});TweenLite.to(zorbRef.scale,.3,{delay:1,ease:Back.easeOut,y:1});ballsArray[0].reset()}if(!popupHolder.visible&&timerCountDown<=0){SS.sendScore(SS.selectedTeam.teamName,SS.selectedEvent.id,SS.selectedEvent.calculateStarScore(totalScore));SS.updateTeamScores();sound.play("ball_start_whistle");sound.play("crowd_start");popupHolder.show(totalScore)}if(popupHolder.visible){popupHolder.update(delta)}if(timeText.visible!==!(popupHolder.visible||pausePopup.visible||helpPopup.visible));{timeText.visible=!(popupHolder.visible||pausePopup.visible||helpPopup.visible);scoreText.visible=timeText.visible;pauseButton.visible=timeText.visible;restartButton.visible=timeText.visible}resetTimer-=delta;seconds=Math.floor(timerCountDown);timerText=CC.Utility.intToString(Math.min(seconds,60),2);if(timeTextOutside.text!==timerText){timeTextOutside.text=timerText;timeTextInside.text=timeTextOutside.text;scoreTextOutside.text=CC.Utility.intToString(totalScore,2);scoreTextInside.text=scoreTextOutside.text}if(timerCountDown<11&&Math.floor(timerCountDown)!==Math.floor(oldCountDown)){sound.play("beep")}physics.update(delta);for(var i=0;i<ballCount;++i){var ball=ballsArray[i];ball.shadow.x=ball.x;if(ball.enabled){ball.character.rotation+=ball.velocity.x*5e-4}else{ball.character.rotation=0}ball.highlight.rotation=ball.x*.001;ball.shadow.scale.x=1-Math.abs(ball.y-ball.shadow.y)/400;ball.shadow.scale.y=ball.shadow.scale.x*.3;ball.shadow.alpha=ball.shadow.scale.y;ball.shadow.visible=ball.visible;if(Math.abs(target.x-ball.x)<60&&ball.prevY<=target.y&&ball.y>target.y){TweenLite.to(ball,.6,{alpha:0,scope:ball,onComplete:function(){this.vars.scope.reset()}});hoop.state.setAnimationByName(0,"score");starBurst.visible=true;starBurst.state.setAnimationByName(0,"burst_"+(1+streakTracker));sound.play("ball_star_0");totalScore++;streakTracker=Math.min(streakTracker+1,4);crowdA.state.setAnimationByName(0,"react1",true);crowdB.state.setAnimationByName(0,"react2",true);sound.play("crowd_score"+Math.floor(Math.random()*3+1));setTimeout(function(){crowdA.state.setAnimationByName(0,"idle1",true);crowdB.state.setAnimationByName(0,"idle2",true)},2e3);hoopGlow.alpha=1;zorbRef.state.setAnimationByName(1,"score");hoopGlow.scale.x=hoopGlow.scale.y=1;TweenLite.to(ball.position,.3,{x:target.x});TweenLite.to(ball.velocity,.3,{x:0});TweenLite.to(hoopGlow,.5,{alpha:0});TweenLite.to(hoopGlow.scale,.5,{x:2,y:2});TweenLite.to(ball.scale,.5,{x:0,y:0,ease:Back.easeIn})}ball.prevY=ball.position.y;if(Math.abs(ball.position.x)>700){ball.reset();streakTracker=0}}if(showHelpStart){showHelpStart=false;window.boom_help_shown_already_ball=true;timeText.visible=false;scoreText.visible=false;pauseButton.visible=false;restartButton.visible=false;helpPopup.show()}oldCountDown=timerCountDown};return{construct:container,color:15658751,update:updateFunc}}};var RubberRingRideWidgets={createGameEndPopup:function(refreshFunc,nextFunc){var popupHolder=new PIXI.Container;var popupBack=CC.Utility.pixiAtlasSprite("end_panel.png");var blackBack=new PIXI.Graphics;var team=SS.selectedTeam?SS.selectedTeam.id:URLQuery[2];var player1=new PIXI.spine.Spine.fromAtlas("anim/end_character_"+team*2+".json");var player2=new PIXI.spine.Spine.fromAtlas("anim/end_character_"+(team*2+1)+".json");var scorePrefix=SS.copy.bestScorePrefix+": ";if(scorePrefix.length>8){scorePrefix=""}var charactersToken=CC.Utility.pixiAtlasSprite("teams000"+(team+1)+".png",{x:330,y:-180,scale:.5});charactersToken.addChild(CC.Utility.pixiAtlasSprite("frame.png"));charactersToken.visible=false;player1.x=370;player2.x=-370;
player1.y=370;player2.y=370;var scoreIconA=CC.Utility.pixiAtlasSprite("flag_icon.png",{x:-150,y:-70});var scoreIconB=CC.Utility.pixiAtlasSprite("flag_icon.png",{x:150,y:-70,scale:{x:-1,y:1}});var recordIconA=CC.Utility.pixiAtlasSprite("trophy_icon.png",{x:-150,y:50});var recordIconB=CC.Utility.pixiAtlasSprite("trophy_icon.png",{x:150,y:50,scale:{x:-1,y:1}});var starsImage=new PIXI.spine.Spine.fromAtlas("anim/star_results.json");starsImage.position.y=-210;player1.state.setAnimationByName(0,"animation",true);player2.state.setAnimationByName(0,"animation",true);blackBack.beginFill(0,.5);blackBack.drawRect(-1e3,-1e3,2e3,2e3);var scoreText=new PIXI.Container;var scoreTextOutside=new PIXI.extras.BitmapText("0:00",{font:150+"px zorb_ball_font_outline",align:"left"});var scoreTextInside=new PIXI.extras.BitmapText("0:00",{font:150+"px zorb_ball_font",align:"left"});var recordText=new PIXI.Container;var recordTextOutside=new PIXI.extras.BitmapText("Best: -:--",{font:90+"px zorb_ball_font_outline",align:"left"});var recordTextInside=new PIXI.extras.BitmapText("Best: -:--",{font:90+"px zorb_ball_font",align:"left"});scoreTextOutside.x=scoreTextOutside.textWidth*-.5;scoreTextInside.x=scoreTextInside.textWidth*-.5;recordTextOutside.x=recordTextOutside.textWidth*-.5;recordTextInside.x=recordTextInside.textWidth*-.5;var recordBroken=false;var recordShown=false;var starIndex=5;popupHolder.show=function(score){Interface.playMusic("music_screens");TweenLite.from(player1,.5,{ease:Bounce.easeOut,y:1e3});TweenLite.from(player2,.5,{ease:Bounce.easeOut,y:1e3});this.visible=true;console.log(SS.selectedEvent);starIndex=SS.selectedEvent.calculateStarScore(score);this.gameScore=0;var highScore=localStorage.getItem("boomsports_race_high_score");var scoreUpdate=function(){var raceMinute=Math.floor(this.gameScore/60)%60;var raceSeconds=Math.floor(this.gameScore%60);scoreTextOutside.text=raceMinute+":"+CC.Utility.intToString(raceSeconds,2);scoreTextInside.text=scoreTextOutside.text;scoreTextOutside.x=scoreTextOutside.textWidth*-.5;scoreTextInside.x=scoreTextInside.textWidth*-.5};var scoreComplete=function(){if(recordBroken){recordText.scale.x=1.2;recordText.scale.y=1.2;TweenLite.to(recordText.scale,.3,{x:1,y:1});var raceMinute=Math.floor(highScore/60)%60;var raceSeconds=Math.floor(highScore%60);recordTextOutside.text=scorePrefix+raceMinute+":"+CC.Utility.intToString(CC.Utility.intToString(raceSeconds,2)||"-:--",2);recordTextInside.text=recordTextOutside.text;recordTextOutside.updateText();recordTextOutside.updateTransform();recordTextInside.updateText();recordTextInside.updateTransform();recordTextOutside.x=recordTextOutside.textWidth*-.5;recordTextInside.x=recordTextInside.textWidth*-.5;recordShown=true}};TweenLite.to(this,1,{gameScore:score,onUpdateScope:this,onUpdate:scoreUpdate,onCompleteScope:this,onComplete:scoreComplete});var raceMinute=Math.floor(highScore/60)%60;var raceSeconds=Math.floor(highScore%60);recordTextOutside.text=scorePrefix+raceMinute+":"+CC.Utility.intToString(CC.Utility.intToString(raceSeconds,2)||"-:--",2);recordTextInside.text=recordTextOutside.text;recordTextOutside.updateText();recordTextOutside.updateTransform();recordTextInside.updateText();recordTextInside.updateTransform();recordTextOutside.x=recordTextOutside.textWidth*-.5;recordTextInside.x=recordTextInside.textWidth*-.5;recordIconA.x=recordTextOutside.textWidth*-.5-40;recordIconB.x=recordTextOutside.textWidth*.5+40;if(highScore===null||highScore>score){recordBroken=true;highScore=score;localStorage.setItem("boomsports_race_high_score",score)}starsImage.state.setAnimationByName(0,"stars_"+starIndex)};scoreText.addChild(scoreTextOutside);scoreText.addChild(scoreTextInside);recordText.addChild(recordTextOutside);recordText.addChild(recordTextInside);scoreText.y=-140;recordText.y=0;var timer=0;popupHolder.update=function(delta){timer+=delta*10;if(recordShown){recordIconA.rotation=Math.sin(timer)*.2;recordIconB.rotation=-Math.sin(timer)*.2;recordText.scale.x=1+Math.sin(timer)*.05;recordText.scale.y=recordText.scale.x}};var closePanel=function(buttonFunc){starsImage.state.setAnimationByName(0,"stars_"+(starIndex||5)+"_out");TweenLite.to(replayButton.scale,.3,{ease:Back.easeIn,x:.7,y:.7,onComplete:function(){replayButton.visible=false}});TweenLite.to(nextButton.scale,.3,{ease:Back.easeIn,x:.7,y:.7,onComplete:function(){nextButton.visible=false}});replayButton.interactive=false;nextButton.interactive=false;charactersToken.visible=true;setTimeout(function(){sound.play("ball_star_0")},500);TweenLite.to(charactersToken.scale,.5,{ease:Back.easeOut,x:.5,y:.5,onComplete:function(){TweenLite.to(charactersToken.scale,.3,{delay:.3,x:.7,y:.7})}});TweenLite.to(charactersToken.scale,.5,{delay:1.5,ease:Back.easeIn,x:.3,y:.3,onComplete:function(){charactersToken.visible=false;setTimeout(function(){Interface.playMusic("music_screens");buttonFunc()},300)}});TweenLite.to(player1,.5,{ease:Quad.easeIn,y:800});TweenLite.to(player2,.5,{ease:Quad.easeIn,y:800})};var replayButton=Interface.button("replay",function(){closePanel(refreshFunc)});var nextButton=Interface.button("next",function(){closePanel(nextFunc)});replayButton.position.x=-70;nextButton.position.x=70;replayButton.position.y=190;nextButton.position.y=190;popupHolder.addChild(blackBack);popupHolder.addChild(popupBack);popupHolder.addChild(scoreIconA);popupHolder.addChild(scoreIconB);popupHolder.addChild(recordIconA);popupHolder.addChild(recordIconB);popupHolder.addChild(scoreText);popupHolder.addChild(recordText);popupHolder.addChild(replayButton);popupHolder.addChild(nextButton);popupHolder.addChild(charactersToken);popupHolder.addChild(starsImage);popupHolder.addChild(player1);popupHolder.addChild(player2);popupHolder.visible=false;popupHolder.hitArea=new PIXI.Rectangle(-1e3,-1e3,2e3,2e3);popupHolder.interactive=true;popupHolder.click=popupHolder.tap=function(eventData){};return popupHolder},createRaceProgressIndicator:function(){var container=new PIXI.Container;var team=SS.selectedTeam?SS.selectedTeam.id:URLQuery[2];var startMarker=CC.Utility.pixiAtlasSprite("progress_"+team*2+".png");var backingMarker=CC.Utility.pixiAtlasSprite("ring_distance_tracker.png");container.addChild(backingMarker);container.addChild(startMarker);container.setDistance=function(value){startMarker.x=(value-.5)*600};container.setDistance(0);return container}};var RubberRingRideScreens={createStartScreen:function(){var container=new PIXI.Container;var updateFunc=function(delta){};return{construct:container,color:16711680,update:updateFunc}},createGameScreen:function(){window.focus();SS.getAccessToken();console.log("changed by jk");Interface.stopMusic();sound.play("game_intro_sting");sound.play("crowd_start");var dragSoundReady=0;var playDragWaterSound=function(){if(!playerRubberRing.playerFlying&&dragSoundReady<0&&!theRaceIsOver){sound.play("ring_drag");dragSoundReady=1}};var speedBar=new PIXI.Graphics;speedBar.beginFill(16711680);speedBar.drawRect(0,0,100,20);speedBar.beginFill(255);speedBar.drawRect(100,0,100,20);speedBar.beginFill(65280);speedBar.drawRect(200,0,100,20);var speedBarMarker=new PIXI.Graphics;speedBarMarker.beginFill(16776960);speedBarMarker.drawRect(0,0,1,20);speedBar.addChild(speedBarMarker);speedBar.x=-400;speedBar.y=-250;var speedBoatSoundTime=0;var speedBoatSoundTimeTotal=100;var paraShootTimeout=0;var leftButton=CC.Utility.pixiAtlasSprite("button_carousel.png",{x:-250});var rightButton=CC.Utility.pixiAtlasSprite("button_carousel.png",{x:250});rightButton.scale.x=-1;rightButton.visible=leftButton.visible=CC.isMobile;var container=new PIXI.Container;var cameraPosition={x:0,y:0,z:0};var cameraPositionPlayer={x:0,y:0,z:0};var cameraVelocity={x:0,y:0,z:0};var trackSections=[[],[[1,10,"obst"]],[[0,10,"ramp"],[2,10,"coll"]],[[0,10,"ramp"],[1,10,"ramp"],[2,10,"ramp"]],[[0,10,"obst"],[2,10,"ramp"]],[[0,10,"ramp"],[2,10,"ramp"],[0,15,"coll"],[2,15,"obst"]],[[0,10,"ramp"],[1,18,"obst"],[2,10,"ramp"]],[[0,10,"obst"],[1,12,"ramp"],[1,19,"coll"],[2,10,"obst"]],[[0,2,"ramp"],[2,7,"obst"],[2,12,"coll"],[0,15,"obst"]],[[1,3,"ramp"],[0,10,"obst"],[1,10,"coll"],[2,10,"obst"],[1,15,"ramp"]],[[1,19,"win"]],[[1,3,"ramp"],[0,10,"obst"],[0,15,"para"],[2,10,"obst"],[2,15,"ramp"]]];var trackChoice=[[0],[3,2,1],[3,2,1],[3,2,1],[3,2,1],[3,4,5],[3,2,1],[11],[3,2,1],[3,4,5,6],[3,4,5,6],[3,4,5,6],[3,4,5,6],[3,4,5,6],[3,4,5,6],[3,6,7,8],[3,6,7,8],[11],[3,6,7,8],[3,6,7,8],[3,6,7,8],[7,8,9],[7,8,9],[10],[0],[0],[0],[0],[0]];if(CC.isMobile){var helpPopup=Interface.helpPopup(SS.copy.ringHelpMobile,"help_screens_ring.png","help_controls_3.png")}else{var helpPopup=Interface.helpPopup(SS.copy.ringHelpDesktop,"help_screens_ring.png","help_controls_2.png")}var pausePopup=Interface.pausePopup(helpPopup);var pauseButton=Interface.button("pause",function(){pausePopup.show();pauseButton.visible=false;restartButton.visible=false});pauseButton.position.y=-300;var restartButton=Interface.button("restart",function(){document.body.removeEventListener("keydown",funcKeyDown);document.body.removeEventListener("keyup",funcKeyUp);CC.WebApp.current.swapScreen(RubberRingRideScreens.createGameScreen())});restartButton.position.y=-300;var trackChoiceIndex=0;var cameraRoll=0;var cameraYaw=0;var cameraPitch=0;var psudo3dHolder=new PIXI.Container;var cameraSwayHolder=new PIXI.Container;var waveEffectHolder=new PIXI.Container;var psudo3dObjectsArray=[];var buoyPool=[];var leftArrowDown=false;var rightArrowDown=false;var upArrowDown=false;var downArrowDown=false;var touchingScreen=false;var rope=new PIXI.Graphics;var sea=new PIXI.Graphics;var skyLine=new PIXI.Container;var skyPartCount=4;var countdownWhistleSoundPlayed=false;for(var i=0;i<skyPartCount;++i){var cloudName="cloud"+Math.round(Math.random())+"_big.png";var cloudX=Math.sin(Math.random()*10)*200;var cloudY=Math.sin(Math.random()*10)*50;skyLine.addChild(CC.Utility.pixiAtlasSprite(cloudName,{x:(-skyPartCount+i)*1e3+cloudX,y:cloudY-200}));skyLine.addChild(CC.Utility.pixiAtlasSprite(cloudName,{x:i*1e3+cloudX,y:cloudY-200}));skyLine.addChild(CC.Utility.pixiAtlasSprite(cloudName,{x:(skyPartCount+i)*1e3+cloudX,y:cloudY-200}));skyLine.addChild(CC.Utility.pixiAtlasSprite("ring_sky_0"+(i+1)+".png",{x:(-skyPartCount+i)*1e3,anchor:"b"}));skyLine.addChild(CC.Utility.pixiAtlasSprite("ring_sky_0"+(i+1)+".png",{x:i*1e3,anchor:"b"}));skyLine.addChild(CC.Utility.pixiAtlasSprite("ring_sky_0"+(i+1)+".png",{x:(skyPartCount+i)*1e3,anchor:"b"}))}var waveEffectPool=[];var waveCount=10;var lens={focus:1e3,focusTarget:1e3};for(var i=0;i<waveCount;++i){var wave=CC.Utility.pixiTilingSprite("ring_waves.png",2e3,95);wave.anchor.y=0;wave.offsetYaw=Math.random()*Math.PI*2e3;waveEffectHolder.addChild(wave);waveEffectPool.push(wave)}var backgroundGrad=CC.Utility.pixiAtlasSprite("ring_background.png",{scale:{x:100,y:1.2}});var trackAngleCurrent=0;var raceTimerTracker=0;var theRaceIsOver=false;var stopAllTogether=false;var trackAngleMul=2;var trackAngleNext=0;var trackMaxSteps=20;var trackDist=100;var trackDistanceTraveled=0;var cameraMovementForward=0;var trackTotalDistance=500;var trackCurrentStep=0;var trackPath=[{x:0,y:0,z:0}];var buoyIndex=0;var rampFlipper=1;var nodeSkipper=0;var lastTrackAngle=0;var collectableAlotment=4;var trackPartsGenerated=0;var addTrackPath=function(){if(countDown<3){trackPartsGenerated++}trackAngleNext=trackAngleCurrent+(Math.random()-.5)*trackAngleMul;if(countDown<0&&trackAngleMul<2){trackAngleMul+=.3}for(var i=0;i<trackMaxSteps;++i){var currentAngle=Math.lerp(trackAngleCurrent,trackAngleNext,i/trackMaxSteps);var nextNode={x:trackPath[trackPath.length-1].x,z:trackPath[trackPath.length-1].z};nodeSkipper++;if(nodeSkipper>1){addBuoy(nextNode.x+Math.sin(currentAngle+Math.PI*.5)*trackDist*.5,nextNode.z+Math.cos(currentAngle+Math.PI*.5)*trackDist*.5);addBuoy(nextNode.x+-(Math.sin(currentAngle+Math.PI*.5)*trackDist*.5),nextNode.z+-(Math.cos(currentAngle+Math.PI*.5)*trackDist*.5));nodeSkipper=0}nextNode.x+=Math.sin(currentAngle)*trackDist;nextNode.z+=Math.cos(currentAngle)*trackDist;nextNode.theta=currentAngle;nextNode.angle=currentAngle-lastTrackAngle;trackPath.push(nextNode);lastTrackAngle=currentAngle}trackAngleCurrent=trackAngleNext;var lastTrack=currentTrack;var tracksForPlacement=trackChoice[trackChoiceIndex];var trackIndexForPlacement=Math.floor(tracksForPlacement.length*Math.random());var currentTrack=trackSections[tracksForPlacement[trackIndexForPlacement]];if(lastTrack===currentTrack){currentTrack=trackSections[tracksForPlacement[(trackIndexForPlacement+1)%tracksForPlacement.length]]}trackChoiceIndex=(trackChoiceIndex+1)%trackChoice.length;var nextNode=trackPath[trackPath.length-2];var perpAngle=nextNode.theta+Math.PI*.5;var xPos=nextNode.x+Math.sin(perpAngle)*trackDist*-.9;var zPos=nextNode.z+Math.cos(perpAngle)*trackDist*-.9;switch(trackChoiceIndex){case 4:break;case 9:break;case 14:break;case 19:break}for(var i=0;i<currentTrack.length;++i){var trackObject=currentTrack[i];nextNode=trackPath[trackPath.length-21+trackObject[1]];perpAngle=nextNode.theta+Math.PI*.5;lane=trackObject[0]-1;xPos=nextNode.x+Math.sin(perpAngle)*trackDist*lane*.3;zPos=nextNode.z+Math.cos(perpAngle)*trackDist*lane*.3;switch(trackObject[2]){case"ramp":addRamp(xPos,zPos,-nextNode.theta);break;case"obst":addObstacle(xPos,zPos);break;case"coll":addCollectable(xPos,zPos,1);break;case"para":addCollectable(xPos,zPos,0);break;case"win":addWinPosts(xPos,zPos,perpAngle);break}}};var addRamp=function(x,z,rot){var ramp=rampArray[rampIndex];ramp.unJumped=true;ramp.pos.x=x;ramp.pos.z=z;ramp.rot=rot;rampIndex=(rampIndex+1)%rampArray.length};var addCollectable=function(x,z,type){collectablePool[collectableIndex].pos.x=x;collectablePool[collectableIndex].pos.y=25;collectablePool[collectableIndex].pos.z=z;collectablePool[collectableIndex].type=type;collectablePool[collectableIndex].collected=false;collectablePool[collectableIndex].scalar=1.5;collectablePool[collectableIndex].gotoAndStop(!!type);collectableIndex=(collectableIndex+1)%collectablePool.length};var addObstacle=function(x,z){obstaclePool[obstacleIndex].pos.x=x;obstaclePool[obstacleIndex].pos.y=20;obstaclePool[obstacleIndex].pos.z=z;obstaclePool[obstacleIndex].hit=false;obstaclePool[obstacleIndex].alpha=1;obstacleIndex=(obstacleIndex+1)%obstaclePool.length};var addBuoy=function(x,z){buoyPool[buoyIndex].pos.x=x;buoyPool[buoyIndex].pos.z=z;buoyIndex=(buoyIndex+1)%buoyPool.length};var addDistanceMarker=function(x,z,index){distanceMarkers[index].pos.x=x;distanceMarkers[index].pos.z=z};var distanceSize=Math.round(128*.8);var distanceText=CC.Utility.pixiAtlasSprite("time_panel2.png",{anchor:"bl"});var distanceTextOutside=new PIXI.extras.BitmapText("0",{font:distanceSize+"px zorb_ball_font_outline",align:"center"});var distanceTextInside=new PIXI.extras.BitmapText("10:15",{font:distanceSize+"px zorb_ball_font",align:"center"});var endPopup=RubberRingRideWidgets.createGameEndPopup(function(){document.body.removeEventListener("keydown",funcKeyDown);document.body.removeEventListener("keyup",funcKeyUp);CC.WebApp.current.swapScreen(RubberRingRideScreens.createGameScreen())},function(){document.body.removeEventListener("keydown",funcKeyDown);document.body.removeEventListener("keyup",funcKeyUp);CC.WebApp.current.swapScreen(MenuScreens.createTeamSelectionScreen())});var raceIndicator=RubberRingRideWidgets.createRaceProgressIndicator();raceIndicator.position.y=-300;distanceText.addChild(distanceTextOutside);distanceText.addChild(distanceTextInside);distanceTextOutside.position.x=distanceTextInside.position.x=83;distanceTextOutside.position.y=distanceTextInside.position.y=-90;distanceText.position.x=-620;distanceText.position.y=360;var countdownAnim=new PIXI.spine.Spine.fromAtlas("anim/countdown.json");countdownAnim.visible=false;countdownAnim.preWait=1.5;countdownAnim.preWaitOver=false;var countDown=3;countdownAnim.state.onEvent=function(i,event){if(event.stringValue==="sound_beep"){sound.play("beep")}else{Interface.playMusic("ring_music_0");sound.play("ball_start_whistle")}};sea.beginFill(4079166);sea.drawRect(-1e3,0,2e3,1e3);cameraSwayHolder.addChild(sea);container.interactive=true;container.hitArea=new PIXI.Rectangle(-1e3,-1e3,2e3,2e3);container.touchstart=container.mousedown=function(eventFeedback){var mousePos=eventFeedback.data.getLocalPosition(container);touchingScreen=true;this.touchmove(eventFeedback)};container.touchmove=container.mousemove=function(eventFeedback){var mousePos=eventFeedback.data.getLocalPosition(container);if(touchingScreen){if(mousePos.x>0){rightArrowDown=true;leftArrowDown=false;leftButton.scale.x=1;leftButton.scale.y=1;rightButton.scale.x=-1.2;rightButton.scale.y=1.2;leftButton.alpha=1;rightButton.alpha=.5;playDragWaterSound()}else{leftArrowDown=true;rightArrowDown=false;leftButton.scale.x=1.2;leftButton.scale.y=1.2;rightButton.scale.x=-1;rightButton.scale.y=1;leftButton.alpha=.5;rightButton.alpha=1;playDragWaterSound()}}};container.touchend=container.mouseup=function(){leftArrowDown=false;rightArrowDown=false;upArrowDown=false;downArrowDown=false;touchingScreen=false;leftButton.scale.x=1;leftButton.scale.y=1;rightButton.scale.x=-1;rightButton.scale.y=1;leftButton.alpha=1;rightButton.alpha=1};window.funcKeyDown=function(e){switch(e.keyCode){case 37:e.preventDefault();playDragWaterSound();leftArrowDown=true;break;case 39:e.preventDefault();playDragWaterSound();rightArrowDown=true;break;case 38:e.preventDefault();upArrowDown=true;break;case 40:e.preventDefault();downArrowDown=true;break}};window.funcKeyUp=function(e){switch(e.keyCode){case 37:e.preventDefault();leftArrowDown=false;break;case 39:e.preventDefault();rightArrowDown=false;break;case 38:e.preventDefault();upArrowDown=false;break;case 40:e.preventDefault();downArrowDown=false;break}};document.body.addEventListener("keydown",funcKeyDown);document.body.addEventListener("keyup",funcKeyUp);var collectablePool=[];var distanceMarkers=[];var obstaclePool=[];var collectableIndex=0;var obstacleIndex=0;var rampArray=[];var rampIndex=0;for(var i=0;i<20;++i){var graphicsRamp=new Graphics3D;psudo3dHolder.addChild(graphicsRamp);graphicsRamp.addVertex(10,-10,20);graphicsRamp.addVertex(10,0,-0);graphicsRamp.addVertex(-10,0,0);graphicsRamp.addVertex(-10,-10,20);graphicsRamp.addVertex(-10,0,20);graphicsRamp.addVertex(10,0,20);graphicsRamp.addVertex(0,-8.75,17.5);graphicsRamp.addVertex(7,-6.25,12.5);graphicsRamp.addVertex(-7,-6.25,12.5);graphicsRamp.addVertex(0,-3.75,7.5);graphicsRamp.addVertex(7,-1.25,2.5);graphicsRamp.addVertex(-7,-1.25,2.5);graphicsRamp.addTri(0,1,3,16733888);graphicsRamp.addTri(1,2,3,16733888);graphicsRamp.addTri(3,2,4,13386905);graphicsRamp.addTri(0,5,1,13386905);graphicsRamp.addTri(6,7,8,16764139);graphicsRamp.addTri(9,10,11,16764139);graphicsRamp.pos.y=30;graphicsRamp.scalar=1;graphicsRamp.unJumped=true;rampArray.push(graphicsRamp);psudo3dObjectsArray.push(graphicsRamp)}var ropeNode=new PIXI.Container;ropeNode.pos={x:0,y:20,z:0};ropeNode.transPos={};ropeNode.scalar=1;psudo3dHolder.addChild(ropeNode);psudo3dObjectsArray.push(ropeNode);var boatConnector=new PIXI.Container;boatConnector.pos={x:0,y:40,z:0};boatConnector.transPos={};boatConnector.scalar=1;psudo3dHolder.addChild(boatConnector);psudo3dObjectsArray.push(boatConnector);var winPostA=new PIXI.spine.Spine.fromAtlas("anim/race_ref.json");winPostA.state.setAnimationByName(0,"animation",true);var winPostB=CC.Utility.pixiAtlasSprite("end_post_right.png");winPostA.pos={x:0,y:20,z:0};winPostB.pos={x:0,y:0,z:0};winPostA.scalar=2;winPostB.scalar=2;var addWinPosts=function(posX,posZ,angle){winPostA.pos.x=posX+Math.sin(angle)*-100;winPostA.pos.z=posZ+Math.cos(angle)*-100;winPostB.pos.x=posX+Math.sin(angle)*-100;winPostB.pos.z=posZ+Math.cos(angle)*-100};winPostA.transPos={};winPostB.transPos={};psudo3dHolder.addChild(winPostA);psudo3dObjectsArray.push(winPostA);var team=SS.selectedTeam?SS.selectedTeam.id:URLQuery[2];var speedBoat=CC.Utility.pixiAtlasMovieClip(["boat_anim_"+(team*2+1)+"_0001.png","boat_anim_"+(team*2+1)+"_0002.png","boat_anim_"+(team*2+1)+"_0003.png","boat_anim_"+(team*2+1)+"_0004.png","boat_anim_"+(team*2+1)+"_0005.png","boat_anim_"+(team*2+1)+"_0006.png","boat_anim_"+(team*2+1)+"_0007.png","boat_anim_"+(team*2+1)+"_0008.png","boat_anim_"+(team*2+1)+"_0009.png","boat_anim_"+(team*2+1)+"_0010.png","boat_anim_"+(team*2+1)+"_0011.png","boat_anim_"+(team*2+1)+"_0012.png","boat_anim_"+(team*2+1)+"_0013.png","boat_anim_"+(team*2+1)+"_0014.png"]);speedBoat.targetRot=0;speedBoat.boat=true;speedBoat.loop=false;speedBoat.pos={x:0,y:30,z:0};speedBoat.transPos={};speedBoat.scalar=10;speedBoat.splash=new PIXI.Container;speedBoat.splashL=new PIXI.spine.Spine.fromAtlas("anim/ring_splashes.json");speedBoat.splashM=new PIXI.spine.Spine.fromAtlas("anim/ring_wave.json");speedBoat.splashR=new PIXI.spine.Spine.fromAtlas("anim/ring_splashes.json");speedBoat.splashR.scale.x=-1;speedBoat.splash.scale.x=.3;speedBoat.splash.scale.y=speedBoat.splash.scale.x;speedBoat.splashL.position.x=-50;speedBoat.splashR.position.x=50;speedBoat.splashR.position.y=150;speedBoat.splashL.position.y=150;speedBoat.splashM.position.y=150;speedBoat.gotoAndStop(5);speedBoat.splash.addChild(speedBoat.splashL);speedBoat.splash.addChild(speedBoat.splashR);speedBoat.splash.addChild(speedBoat.splashM);speedBoat.splashR.update(Math.random());speedBoat.splashL.update(Math.random());speedBoat.splashR.state.setAnimationByName(0,"animation",true);speedBoat.splashL.state.setAnimationByName(0,"animation",true);speedBoat.splashM.state.setAnimationByName(0,"animation",true);speedBoat.addChild(speedBoat.splash);psudo3dHolder.addChild(speedBoat);psudo3dObjectsArray.push(speedBoat);var playerRubberRing=new PIXI.Container;var playerRubberRingOver=new PIXI.spine.Spine.fromAtlas("anim/ring_character_"+team*2+".json");var playerSplashesLeft=new PIXI.spine.Spine.fromAtlas("anim/ring_splashes.json");var playerSplashesRight=new PIXI.spine.Spine.fromAtlas("anim/ring_splashes.json");var playerSplashesMiddle=new PIXI.spine.Spine.fromAtlas("anim/ring_wave.json");var playerBoostA=new PIXI.spine.Spine.fromAtlas("anim/boost.json");var playerBoostB=new PIXI.spine.Spine.fromAtlas("anim/boost.json");var playerObstacleSmash=new PIXI.spine.Spine.fromAtlas("anim/obstacle_smash.json");var paraglider=new PIXI.spine.Spine.fromAtlas("anim/paraglider.json");paraglider.y=10;paraglider.alpha=0;playerRubberRingOver.addChild(paraglider);playerObstacleSmash.visible=false;playerSplashesRight.scale.x=-1;playerRubberRingOver.splashScale=1;playerSplashesLeft.y=80;playerSplashesRight.y=80;playerSplashesLeft.x=-50;playerSplashesRight.x=50;playerSplashesMiddle.y=80;playerRubberRingOver.addChild(playerSplashesRight);playerRubberRingOver.addChild(playerSplashesLeft);playerRubberRingOver.addChild(playerSplashesMiddle);playerSplashesRight.update(Math.random());playerSplashesLeft.update(Math.random());playerSplashesRight.state.setAnimationByName(0,"animation",true);playerSplashesLeft.state.setAnimationByName(0,"animation",true);playerSplashesMiddle.state.setAnimationByName(0,"animation",true);playerBoostA.state.setAnimationByName(0,"boost_0");playerBoostB.state.setAnimationByName(0,"boost_0");playerBoostB.rotation=2;playerRubberRingOver.lean="center";playerRubberRing.speed=1;playerRubberRing.positionSlide=0;playerRubberRing.velocitySlide=0;playerRubberRing.playerFlying=0;playerRubberRing.pos={x:0,y:30,z:0};cameraPitch=-150;playerRubberRing.transPos={};playerRubberRing.scalar=1;playerRubberRing.playerJumping=30;psudo3dHolder.addChild(playerRubberRing);psudo3dObjectsArray.push(playerRubberRing);for(var i=0;i<80;++i){var threeDObject=new PIXI.Container;threeDObject.top=CC.Utility.pixiAtlasSprite("marker_buoy_top.png");threeDObject.bottom=CC.Utility.pixiAtlasSprite("marker_buoy_bottom.png");threeDObject.addChild(threeDObject.top);threeDObject.addChild(threeDObject.bottom);threeDObject.pos={x:0,y:30,z:0};threeDObject.transPos={x:0,y:0,z:0};threeDObject.scalar=.5;threeDObject.buoy=true;buoyPool.push(threeDObject);psudo3dHolder.addChild(threeDObject);psudo3dObjectsArray.push(threeDObject)}for(var i=0;i<4;++i){var threeDObject=CC.Utility.pixiAtlasSprite("distance_markers000"+(i+1)+".png");threeDObject.pos={x:0,y:15,z:0};threeDObject.transPos={};threeDObject.scalar=2;distanceMarkers.push(threeDObject);psudo3dHolder.addChild(threeDObject);psudo3dObjectsArray.push(threeDObject)}for(var i=0;i<10;++i){var tint=CC.Color.HexLerp(8947848,16777215,Math.random());var threeDObject=CC.Utility.pixiAtlasMovieClip(["power_up.png","collectible.png"]);threeDObject.alpha=1;threeDObject.pos={};threeDObject.transPos={};threeDObject.pos.x=0;threeDObject.pos.y=0;threeDObject.pos.z=0;threeDObject.scalar=.5;collectablePool.push(threeDObject);psudo3dHolder.addChild(threeDObject);psudo3dObjectsArray.push(threeDObject)}for(var i=0;i<10;++i){var tint=CC.Color.HexLerp(8947848,16777215,Math.random());var threeDObject=CC.Utility.pixiAtlasSprite("obstacle.png");threeDObject.alpha=1;threeDObject.pos={};threeDObject.transPos={};threeDObject.pos.x=0;threeDObject.pos.y=0;threeDObject.pos.z=0;threeDObject.scalar=1;obstaclePool.push(threeDObject);psudo3dHolder.addChild(threeDObject);psudo3dObjectsArray.push(threeDObject)}var timer=0;var threeDObject,threeDObjectTest,closest;var zScale;var closestIndex;var relaxToCenterTimedown=0;addTrackPath();addTrackPath();var trackMovement=0;var stopBoatAtcentre=false;var perpX=0;var perpY=0;var i;var updateFunc=function(delta){delta=Math.min(delta,.06);speedBoatSoundTime+=delta;dragSoundReady-=delta;if(forcePause&&!pausePopup.visible){pausePopup.show();pauseButton.visible=false;restartButton.visible=false}if(speedBoatSoundTime>speedBoatSoundTimeTotal){speedBoatSoundTime=0}if(!countdownAnim.preWaitOver){countdownAnim.preWait-=delta;if(countdownAnim.preWait<0){countdownAnim.preWaitOver=true;countdownAnim.visible=true;countdownAnim.state.setAnimationByName(0,"countdown")}}rightButton.position.x=CC.WebApp.current.screenWidth*.5-150;leftButton.position.x=CC.WebApp.current.screenWidth*-.5+150;if(paraShootTimeout>0){paraShootTimeout-=delta;if(paraShootTimeout<=0){TweenLite.to(paraglider,.5,{y:-500,alpha:0});TweenLite.to(playerRubberRing,1,{playerFlying:0,ease:Bounce.easeOut});Interface.playMusic("ring_music_0");setTimeout(function(){sound.play("ring_land")},300);TweenLite.to(lens,1,{focus:1e3})}}endPopup.update(delta);pauseButton.position.x=CC.WebApp.current.screenWidth*.5-60;restartButton.position.x=CC.WebApp.current.screenWidth*-.5+60;pauseButton.visible=!(endPopup.visible||pausePopup.visible||helpPopup.visible);restartButton.visible=pauseButton.visible;raceIndicator.visible=pauseButton.visible;distanceText.visible=pauseButton.visible;timer+=delta*2;countDown-=delta;playerRubberRing.pos.y=(Math.sin(timer*3)*5-10)*playerRubberRing.playerFlying;playerRubberRing.pos.y+=playerRubberRing.playerJumping*(1-playerRubberRing.playerFlying);cameraPitch=-150*playerRubberRing.playerFlying;var trackDelta=delta*10*.5*playerRubberRing.speed;relaxToCenterTimedown-=delta;playerRubberRing.speed=Math.min(playerRubberRing.speed,3);playerRubberRing.speed=Math.max(playerRubberRing.speed,.3);if(playerRubberRing.speed>1&&!playerRubberRing.playerFlying){playerRubberRing.speed-=delta*.5}if(playerRubberRing.speed<1&&!playerRubberRing.playerFlying){playerRubberRing.speed+=delta*.5}if(playerRubberRing.speed!==1&&Math.abs(playerRubberRing.speed)<.5&&!playerRubberRing.playerFlying){playerRubberRing.speed=1}if(playerRubberRing.playerFlying){playerRubberRing.speed=1.5+playerRubberRing.playerFlying}speedBarMarker.x=playerRubberRing.speed*100;trackMovement+=trackDelta;var raceMinute=Math.floor(raceTimerTracker/60)%60;var raceSeconds=Math.floor(raceTimerTracker%60);var raceMilSeconds=Math.floor(raceTimerTracker%60*100)%100;distanceText.position.x=CC.WebApp.current.screenWidth*-.5;distanceTextOutside.text=raceMinute+":"+CC.Utility.intToString(raceSeconds,2);distanceTextInside.text=distanceTextOutside.text;skyLine.x=Math.modo(-cameraYaw/Math.PI*skyPartCount*1e3,skyPartCount*1e3)-500;for(i=0;i<waveCount;++i){var wave=waveEffectPool[i];wave.z=i*200;wave.z=Math.modo(wave.z-cameraMovementForward*50,waveCount*200)-100;wave.scale.y=lens.focus*.1/wave.z;wave.tileScale.x=wave.scale.y;if(CC.isMobile){wave.tilePosition.x=1e3-wave.tileScale.x+(cameraYaw+wave.offsetYaw)*wave.tileScale.x}else{wave.tilePosition.x=(cameraYaw+wave.offsetYaw)*wave.tileScale.x}wave.y=wave.scale.y*100;wave.visible=wave.y>10&&wave.tileScale.x>.125;wave.alpha=Math.min(wave.tileScale.x,1)}if(!theRaceIsOver){cameraMovementForward+=trackDelta}if(countDown<-countdownAnim.preWait&&!theRaceIsOver){trackDistanceTraveled+=trackDelta;raceTimerTracker+=delta}var posX=playerRubberRing.pos.x-winPostA.pos.x;var posZ=playerRubberRing.pos.z-winPostA.pos.z;var marvinDistanceSqr=posX*posX+posZ*posZ;if(countDown<0&&!theRaceIsOver&&marvinDistanceSqr<4e4){theRaceIsOver=true;sound.play("ball_start_whistle");sound.play("crowd_start");SS.sendScore(SS.selectedTeam.teamName,SS.selectedEvent.id,SS.selectedEvent.calculateStarScore(raceTimerTracker));SS.updateTeamScores();setTimeout(function(){endPopup.show(raceTimerTracker);stopAllTogether=true},2e3)}raceIndicator.setDistance(Math.min(1,trackDistanceTraveled/trackTotalDistance));if(!stopAllTogether){cameraPositionPlayer.x=Math.lerp(trackPath[0].x,trackPath[1].x,trackMovement);cameraPositionPlayer.z=Math.lerp(trackPath[0].z,trackPath[1].z,trackMovement);if(!theRaceIsOver){cameraPosition.x=cameraPositionPlayer.x;cameraPosition.y=cameraPositionPlayer.y;cameraPosition.z=cameraPositionPlayer.z}cameraYaw=Math.atan2(Math.lerp(trackPath[1].x,trackPath[2].x,trackMovement)-cameraPosition.x,Math.lerp(trackPath[1].z,trackPath[2].z,trackMovement)-cameraPosition.z);perpX=-(trackPath[7].z-trackPath[8].z);perpZ=trackPath[7].x-trackPath[8].x;speedBoat.pos.x=Math.lerp(trackPath[10].x,trackPath[11].x,trackMovement)+perpX*2;speedBoat.pos.z=Math.lerp(trackPath[10].z,trackPath[11].z,trackMovement)+perpZ*2}boatConnector.pos.x=speedBoat.pos.x+Math.sin(cameraYaw)*-100;boatConnector.pos.z=speedBoat.pos.z+Math.cos(cameraYaw)*-100;ropeNode.pos.x=Math.lerp(ropeNode.pos.x,(playerRubberRing.pos.x+speedBoat.pos.x)*.5,1);ropeNode.pos.z=Math.lerp(ropeNode.pos.z,(playerRubberRing.pos.z+speedBoat.pos.z)*.5,1);if(trackMovement>=1){trackMovement=0;trackPath.splice(0,1);if(trackPath.length<=40){addTrackPath()}}if(rightArrowDown&&!stopAllTogether){playerRubberRing.velocitySlide+=delta*200;cameraRoll+=-delta;relaxToCenterTimedown=.1;if(playerRubberRingOver.lean!=="right"){if(playerRubberRingOver.lean==="left"){playerRubberRingOver.state.setAnimationByName(0,"full_r")}else{playerRubberRingOver.state.setAnimationByName(0,"lean_r")}playerRubberRingOver.lean="right"}}if(!leftArrowDown&&!rightArrowDown&&relaxToCenterTimedown<0){if(playerRubberRingOver.lean!=="center"){if(playerRubberRingOver.lean==="right"){playerRubberRingOver.state.setAnimationByName(0,"return_r")}else{playerRubberRingOver.state.setAnimationByName(0,"return_l")}playerRubberRingOver.lean="center"}}if(leftArrowDown&&!stopAllTogether){cameraRoll+=delta;relaxToCenterTimedown=.1;playerRubberRing.velocitySlide+=-delta*200;if(playerRubberRingOver.lean!=="left"){if(playerRubberRingOver.lean==="right"){playerRubberRingOver.state.setAnimationByName(0,"full_l")}else{playerRubberRingOver.state.setAnimationByName(0,"lean_l")}playerRubberRingOver.lean="left"}}playerRubberRing.velocitySlide*=.95;playerRubberRing.positionSlide+=playerRubberRing.velocitySlide*delta;playerRubberRing.rotation=playerRubberRing.velocitySlide*.005;playerSplashesLeft.scale.x=1+-playerRubberRing.rotation*1.5;playerSplashesRight.scale.x=-1-playerRubberRing.rotation*1.5;playerSplashesLeft.scale.x*=playerRubberRingOver.splashScale*Math.min(playerRubberRing.speed,1.5)*(1-playerRubberRing.playerFlying);playerSplashesRight.scale.x*=playerRubberRingOver.splashScale*Math.min(playerRubberRing.speed,1.5)*(1-playerRubberRing.playerFlying);playerSplashesLeft.scale.y=playerSplashesLeft.scale.x;playerSplashesRight.scale.y=-playerSplashesRight.scale.x;playerSplashesMiddle.scale.y=playerSplashesMiddle.scale.x=playerRubberRingOver.splashScale*Math.min(playerRubberRing.speed,1.5)*(1-playerRubberRing.playerFlying);
playerSplashesLeft.rotation=-playerRubberRing.rotation;playerSplashesRight.rotation=-playerRubberRing.rotation;var dist=Math.abs(playerRubberRing.positionSlide);if(dist>50){if(playerRubberRing.velocitySlide*playerRubberRing.positionSlide>0){playerRubberRing.velocitySlide*=-1;playerRubberRing.speed-=.1}playerRubberRing.positionSlide=playerRubberRing.positionSlide/dist*50}playerRubberRing.pos.x=cameraPositionPlayer.x;playerRubberRing.pos.z=cameraPositionPlayer.z;playerRubberRing.pos.x+=Math.sin(cameraYaw)*100;playerRubberRing.pos.z+=Math.cos(cameraYaw)*100;playerRubberRing.pos.x+=Math.sin(cameraYaw+Math.hPI)*playerRubberRing.positionSlide;playerRubberRing.pos.z+=Math.cos(cameraYaw+Math.hPI)*playerRubberRing.positionSlide;cameraRoll=Math.min(1,Math.max(-1,cameraRoll));cameraRoll*=.9;if(CC.isMobile&&CC.WebApp.current.renderer.type!==2||!CC.isMobile){cameraSwayHolder.rotation=-cameraRoll}cameraSwayHolder.y=-cameraPitch;if(upArrowDown){cameraVelocity.z+=-Math.cos(cameraYaw)*10;cameraVelocity.x+=-Math.sin(cameraYaw)*10}if(downArrowDown){cameraVelocity.z+=Math.cos(cameraYaw)*10;cameraVelocity.x+=Math.sin(cameraYaw)*10}for(i=0;i<psudo3dObjectsArray.length;++i){threeDObject=psudo3dObjectsArray[i];if(threeDObject.graf){for(var j=0;j<threeDObject.vertexArray.length;++j){var vertex=threeDObject.vertexArray[j];var vertexTrans=threeDObject.vertexTransArray[j];vertexTrans.x=vertex.x*threeDObject.scalar;vertexTrans.y=vertex.y*threeDObject.scalar;vertexTrans.z=vertex.z*threeDObject.scalar;CC.Geometry.rotate3DRef(vertexTrans,threeDObject.rot);vertexTrans.x=vertexTrans.x+threeDObject.pos.x-cameraPosition.x;vertexTrans.y=vertexTrans.y+threeDObject.pos.y-cameraPosition.y;vertexTrans.z=vertexTrans.z+threeDObject.pos.z-cameraPosition.z;CC.Geometry.rotate3DRef(vertexTrans,cameraYaw);vertexTrans.x*=lens.focus/vertexTrans.z;vertexTrans.y*=lens.focus/vertexTrans.z}threeDObject.build()}threeDObject.transPos.x=threeDObject.pos.x-cameraPosition.x;threeDObject.transPos.y=threeDObject.pos.y-cameraPosition.y;threeDObject.transPos.z=threeDObject.pos.z-cameraPosition.z;CC.Geometry.rotate3DRef(threeDObject.transPos,cameraYaw);if(!threeDObject.graf){zScale=lens.focus/threeDObject.transPos.z;threeDObject.x=threeDObject.transPos.x*zScale;threeDObject.y=threeDObject.transPos.y*zScale;threeDObject.scale.x=zScale*.1*threeDObject.scalar;threeDObject.scale.y=zScale*.1*threeDObject.scalar}threeDObject.visible=threeDObject.transPos.z>0&&!threeDObject.collected;if(threeDObject.buoy){threeDObject.bottom.scale.y=Math.abs(Math.sin(threeDObject.y/720))*2;threeDObject.visible=.5<Math.max(0,Math.min(zScale,1))}if(threeDObject.boat){var turnValue=Math.min(Math.max((threeDObject.x-300)/2,-10),3);threeDObject.splash.x=-turnValue*2;threeDObject.targetRot=Math.lerp(threeDObject.targetRot,Math.floor(turnValue+10),.1);threeDObject.gotoAndStop(threeDObject.targetRot)}threeDObject.sorted=false}for(var i=0;i<psudo3dObjectsArray.length;++i){closestIndex=-1;for(var j=0;j<psudo3dObjectsArray.length;++j){threeDObject=psudo3dObjectsArray[j];if(threeDObject.visible&&!threeDObject.sorted&&(closestIndex===-1||-threeDObject.transPos.z<closest)){closestIndex=j;closest=-threeDObject.transPos.z}}if(closestIndex!==-1){threeDObject=psudo3dObjectsArray[closestIndex];threeDObject.sorted=true;psudo3dHolder.addChild(threeDObject)}}rope.clear();rope.lineStyle(2,16777215);rope.moveTo(speedBoat.x+(-30-18*(speedBoat.currentFrame/14))*speedBoat.scale.x,speedBoat.y+15*speedBoat.scale.x);rope.lineTo(playerRubberRing.x,playerRubberRing.y);playerRubberRingOver.position.x=playerRubberRing.position.x;playerRubberRingOver.position.y=playerRubberRing.position.y;playerRubberRingOver.scale.x=playerRubberRing.scale.x;playerRubberRingOver.scale.y=playerRubberRing.scale.y;playerRubberRingOver.rotation=playerRubberRing.rotation;if(!playerRubberRing.playerFlying){for(i=0;i<rampArray.length;++i){var ramp=rampArray[i];var vec={x:0,z:0};var dist;if(ramp&&ramp.unJumped&&ramp.visible){vec.x=ramp.pos.x-playerRubberRing.pos.x;vec.z=ramp.pos.z-playerRubberRing.pos.z;dist=vec.x*vec.x+vec.z*vec.z;if(dist<20*20){ramp.unJumped=false;TweenLite.to(playerRubberRing,.3,{playerJumping:10});playerRubberRing.speed+=1;TweenLite.to(lens,.5,{focus:750});TweenLite.to(lens,1,{delay:1,focus:1e3});TweenLite.to(playerRubberRingOver,.2,{splashScale:0});TweenLite.to(playerRubberRingOver,.3,{delay:.5,splashScale:1});sound.play("ring_boost_2");setTimeout(function(){sound.play("ring_land")},500);playerRubberRingOver.state.setAnimationByName(1,"jump");TweenLite.to(playerRubberRing,1,{playerJumping:30,delay:.3,ease:Bounce.easeOut})}}}for(i=0;i<collectablePool.length;++i){var collectable=collectablePool[i];var vec={x:0,z:0};var dist;if(collectable&&!collectable.collected&&collectable.visible){vec.x=collectable.pos.x-playerRubberRing.pos.x;vec.z=collectable.pos.z-playerRubberRing.pos.z;dist=vec.x*vec.x+vec.z*vec.z;if(dist<20*20){collectable.collected=true;playerRubberRing.speed+=.1;if(collectable.type){playerRubberRing.speed=3;TweenLite.to(lens,.5,{focus:500});TweenLite.to(lens,1,{delay:1,focus:1e3});sound.play("ring_boost_1");sound.play("crowd_score"+Math.floor(Math.random()*3+1));playerBoostA.state.setAnimationByName(0,"boost_0");setTimeout(function(){playerBoostB.state.setAnimationByName(0,"boost_0")},100)}else{paraglider.alpha=1;paraglider.y=10;Interface.playMusic("ring_music_1");sound.play("crowd_score"+Math.floor(Math.random()*3+1));sound.play("ring_boost_0");sound.play("ring_boost_4");paraglider.state.setAnimationByName(0,"animation");TweenLite.to(playerRubberRing,.5,{playerFlying:1});TweenLite.to(lens,.5,{focus:750});paraShootTimeout=5}TweenLite.to(collectable.pos,.3,{y:-50})}}}for(i=0;i<obstaclePool.length;++i){var obstacle=obstaclePool[i];var vec={x:0,z:0};var dist;if(obstacle&&!obstacle.hit&&obstacle.visible){vec.x=obstacle.pos.x-playerRubberRing.pos.x;vec.z=obstacle.pos.z-playerRubberRing.pos.z;dist=vec.x*vec.x+vec.z*vec.z;if(dist<15*15){obstacle.hit=true;sound.play("ring_hit");TweenLite.to(lens,.01,{focus:1200});TweenLite.to(lens,.5,{delay:.2,focus:1e3});playerObstacleSmash.scale.x=1;playerObstacleSmash.scale.y=1;TweenLite.to(playerObstacleSmash.scale,.6,{x:1.2,y:1.2});playerObstacleSmash.x=obstacle.x;playerObstacleSmash.y=obstacle.y;playerObstacleSmash.visible=true;playerRubberRingOver.state.setAnimationByName(1,"crash");playerObstacleSmash.state.setAnimationByName(0,"animation");obstacle.alpha=0;playerRubberRing.speed*=.66}}}}if(showHelpStart){showHelpStart=false;window.boom_help_shown_already_ring=true;distanceText.visible=false;pauseButton.visible=false;restartButton.visible=false;helpPopup.show()}};var showHelpStart=window.boom_help_shown_already_ring===undefined;var firstBallStart=true;container.addChild(cameraSwayHolder);cameraSwayHolder.addChild(backgroundGrad);cameraSwayHolder.addChild(skyLine);cameraSwayHolder.addChild(waveEffectHolder);cameraSwayHolder.addChild(psudo3dHolder);cameraSwayHolder.addChild(rope);cameraSwayHolder.addChild(playerRubberRingOver);cameraSwayHolder.addChild(playerObstacleSmash);cameraSwayHolder.addChild(playerBoostA);cameraSwayHolder.addChild(playerBoostB);container.addChild(leftButton);container.addChild(rightButton);container.addChild(distanceText);container.addChild(raceIndicator);container.addChild(countdownAnim);container.addChild(pauseButton);container.addChild(restartButton);container.addChild(endPopup);container.addChild(pausePopup);container.addChild(helpPopup);return{construct:container,color:15658751,update:updateFunc}}};var BeachPogoWidgets={createBeachBall:function(func){var container=new PIXI.Container;var ballContainer=new PIXI.Container;var ballObject=CC.Utility.pixiAtlasSprite("beachball_"+Math.floor(Math.random()*5)+".png");var ballObjectRing=CC.Utility.pixiAtlasSprite("beach_ball_ring.png");container.radius=128;ballObject.rotation=Math.random()*Math.PI*2;container.func=func;container.ballObject=ballContainer;container.ball=ballObject;ballObjectRing.alpha=.5;ballContainer.addChild(ballObject);ballContainer.addChild(ballObjectRing);container.addChild(ballContainer);return container},createPlatform:function(func){var platform=CC.Utility.pixiAtlasSprite("pogo_platform.png");platform.func=func;return platform},createCrowdAnim:function(id,x,y,scaleX,scaleY){var crowd=CC.Utility.pixiAtlasMovieClip(["bg_crowd"+id+"0001.png","bg_crowd"+id+"0002.png","bg_crowd"+id+"0003.png","bg_crowd"+id+"0004.png","bg_crowd"+id+"0005.png","bg_crowd"+id+"0006.png","bg_crowd"+id+"0007.png","bg_crowd"+id+"0008.png","bg_crowd"+id+"0009.png"],{anchor:"b"});crowd.animationSpeed=25/60;crowd.x=x;crowd.y=y;crowd.scale.x=scaleX;crowd.scale.y=scaleY;crowd.gotoAndPlay(Math.floor(Math.random()*10));return crowd},createTreePalmAnim:function(x,y,scaleX,scaleY,rot){var palmHolder=new PIXI.Container;palmHolder.addChild(CC.Utility.pixiAtlasSprite("pogo_tree_0.png"));palmHolder.addChild(CC.Utility.pixiAtlasSprite("pogo_tree_1.png"));palmHolder.addChild(CC.Utility.pixiAtlasSprite("pogo_tree_2.png"));palmHolder.addChild(CC.Utility.pixiAtlasSprite("pogo_tree_3.png"));palmHolder.addChild(CC.Utility.pixiAtlasSprite("pogo_tree_4.png"));palmHolder.addChild(CC.Utility.pixiAtlasSprite("pogo_tree_5.png"));palmHolder.addChild(CC.Utility.pixiAtlasSprite("pogo_tree_6.png"));palmHolder.x=x;palmHolder.y=y;palmHolder.scale.x=scaleX;palmHolder.scale.y=scaleY;palmHolder.rotaton=rot;palmHolder.timer=0;palmHolder.update=function(delta,offset){this.timer+=delta;for(var i=0;i<this.children.length;++i){this.children[i].rotation=Math.sin(this.timer+i+offset)*.1}};return palmHolder},createPogoStick:function(makeSound){var container=new PIXI.Container;var containerStick=new PIXI.Container;var team=SS.selectedTeam?SS.selectedTeam.id:URLQuery[2];var pogoStick=[new PIXI.spine.Spine.fromAtlas("anim/pogo_character_"+team*2+".json"),new PIXI.spine.Spine.fromAtlas("anim/pogo_character_"+(team*2+1)+".json")];pogoStick[0].update(1);pogoStick[1].update(1);pogoStick[0].state.setAnimationByName(1,"blink",true);pogoStick[1].state.setAnimationByName(1,"blink",true);pogoStick[0].stateData.setMixByName("land","idle",1);pogoStick[1].stateData.setMixByName("land","idle",1);pogoStick[0].stateData.setMixByName("idle","land",1);pogoStick[1].stateData.setMixByName("idle","land",1);containerStick.addChild(pogoStick[0]);containerStick.addChild(pogoStick[1]);pogoStick[1].visible=false;container.addChild(containerStick);container.stick=containerStick;if(makeSound){pogoStick[0].state.onEvent=function(i,event){if(pogoStick[0].visible){sound.play("pogo_bounce_2")}};pogoStick[1].state.onEvent=function(i,event){if(pogoStick[1].visible){sound.play("pogo_bounce_2")}}}container.setCharacter=function(charIndex){pogoStick[0].visible=!charIndex;pogoStick[1].visible=!!charIndex};container.timer=0;container.jumpChecker=function(delta){container.timer+=delta;container.stick.position.y=70*-(Math.abs(Math.sin(container.timer*5))*.5);if(container.timer>.62){container.timer=0;pogoStick[0].state.setAnimationByName(0,"land");pogoStick[1].state.setAnimationByName(0,"land")}};container.jumpState=function(){pogoStick[0].state.clearTrack(0);pogoStick[1].state.clearTrack(0);pogoStick[0].skeleton.setToSetupPose();pogoStick[1].skeleton.setToSetupPose();container.timer=0;pogoStick[0].state.setAnimationByName(0,"idle",true);pogoStick[1].state.setAnimationByName(0,"idle",true)};return container},createGameEndPopup:function(refreshFunc,nextFunc){var popupHolder=new PIXI.Container;var popupBack=CC.Utility.pixiAtlasSprite("end_panel.png");var blackBack=new PIXI.Graphics;var scorePrefix=SS.copy.bestScorePrefix+": ";if(scorePrefix.length>8){scorePrefix=""}var team=SS.selectedTeam?SS.selectedTeam.id:URLQuery[2];var charactersToken=CC.Utility.pixiAtlasSprite("teams000"+(team+1)+".png",{x:330,y:-180,scale:.5});charactersToken.addChild(CC.Utility.pixiAtlasSprite("frame.png"));charactersToken.visible=false;var player1=new PIXI.spine.Spine.fromAtlas("anim/end_character_"+team*2+".json");var player2=new PIXI.spine.Spine.fromAtlas("anim/end_character_"+(team*2+1)+".json");player1.x=370;player2.x=-370;player1.y=370;player2.y=370;var scoreIconA=CC.Utility.pixiAtlasSprite("beachball_icon.png",{x:-110,y:-70,anchor:"r"});var scoreIconB=CC.Utility.pixiAtlasSprite("beachball_icon.png",{x:110,y:-70,anchor:"r",scale:{x:-1,y:1}});var recordIconA=CC.Utility.pixiAtlasSprite("trophy_icon.png",{x:-150,y:50});var recordIconB=CC.Utility.pixiAtlasSprite("trophy_icon.png",{x:150,y:50,scale:{x:-1,y:1}});var starsImage=new PIXI.spine.Spine.fromAtlas("anim/star_results.json");starsImage.position.y=-210;player1.state.setAnimationByName(0,"animation",true);player2.state.setAnimationByName(0,"animation",true);blackBack.beginFill(0,.5);blackBack.drawRect(-1e3,-1e3,2e3,2e3);var scoreText=new PIXI.Container;var scoreTextOutside=new PIXI.extras.BitmapText("0m",{font:150+"px zorb_ball_font_outline",align:"left"});var scoreTextInside=new PIXI.extras.BitmapText("0m",{font:150+"px zorb_ball_font",align:"left"});var recordText=new PIXI.Container;var recordTextOutside=new PIXI.extras.BitmapText("Best: 0m",{font:90+"px zorb_ball_font_outline",align:"left"});var recordTextInside=new PIXI.extras.BitmapText("Best: 0m",{font:90+"px zorb_ball_font",align:"left"});scoreTextOutside.x=scoreTextOutside.textWidth*-.5;scoreTextInside.x=scoreTextInside.textWidth*-.5;recordTextOutside.x=recordTextOutside.textWidth*-.5;recordTextInside.x=recordTextInside.textWidth*-.5;recordIconA.x=recordTextOutside.textWidth*-.5-40;recordIconB.x=recordTextOutside.textWidth*.5+40;var recordBroken=false;var recordShown=false;var starIndex=1;popupHolder.show=function(score){Interface.playMusic("music_screens");TweenLite.from(player1,.5,{ease:Bounce.easeOut,y:1e3});TweenLite.from(player2,.5,{ease:Bounce.easeOut,y:1e3});this.visible=true;starIndex=SS.selectedEvent.calculateStarScore(score);this.gameScore=0;var highScore=localStorage.getItem("boomsports_pogo_high_score");var scoreUpdate=function(){scoreTextOutside.text=Math.round(this.gameScore/256)+"m";scoreTextInside.text=scoreTextOutside.text;scoreTextOutside.x=scoreTextOutside.textWidth*-.5;scoreTextInside.x=scoreTextInside.textWidth*-.5;scoreIconA.x=scoreTextOutside.textWidth*-.5;scoreIconB.x=scoreTextOutside.textWidth*.5};var scoreComplete=function(){if(recordBroken){recordText.scale.x=1.2;recordText.scale.y=1.2;TweenLite.to(recordText.scale,.3,{x:1,y:1});recordTextOutside.text=scorePrefix+Math.round((highScore||0)/256)+"m";recordTextInside.text=recordTextOutside.text;recordTextInside.updateText();recordTextOutside.updateText();recordTextOutside.x=recordTextOutside.textWidth*-.5;recordTextInside.x=recordTextInside.textWidth*-.5;recordTextOutside.updateText();recordTextOutside.updateTransform();recordTextInside.updateText();recordTextInside.updateTransform();recordIconA.x=recordTextOutside.textWidth*-.5-40;recordIconB.x=recordTextOutside.textWidth*.5+40;recordShown=true}};TweenLite.to(this,1,{gameScore:score,onUpdateScope:this,onUpdate:scoreUpdate,onCompleteScope:this,onComplete:scoreComplete});recordTextOutside.text=scorePrefix+Math.round((highScore||0)/256)+"m";recordTextInside.text=recordTextOutside.text;recordTextOutside.updateText();recordTextOutside.updateTransform();recordTextInside.updateText();recordTextInside.updateTransform();recordTextOutside.x=recordTextOutside.textWidth*-.5;recordTextInside.x=recordTextInside.textWidth*-.5;recordIconA.x=recordTextOutside.textWidth*-.5-40;recordIconB.x=recordTextOutside.textWidth*.5+40;if(highScore===null||highScore<score){recordBroken=true;highScore=score;localStorage.setItem("boomsports_pogo_high_score",score)}starsImage.state.setAnimationByName(0,"stars_"+starIndex)};scoreText.addChild(scoreTextOutside);scoreText.addChild(scoreTextInside);recordText.addChild(recordTextOutside);recordText.addChild(recordTextInside);scoreText.y=-140;recordText.y=0;var timer=0;popupHolder.update=function(delta){timer+=delta*10;if(recordShown){recordIconA.rotation=Math.sin(timer)*.2;recordIconB.rotation=-Math.sin(timer)*.2;recordText.scale.x=1+Math.sin(timer)*.05;recordText.scale.y=recordText.scale.x}};var closePanel=function(buttonFunc){starsImage.state.setAnimationByName(0,"stars_"+(starIndex||5)+"_out");TweenLite.to(replayButton.scale,.3,{ease:Back.easeIn,x:.7,y:.7,onComplete:function(){replayButton.visible=false}});TweenLite.to(nextButton.scale,.3,{ease:Back.easeIn,x:.7,y:.7,onComplete:function(){nextButton.visible=false}});replayButton.interactive=false;nextButton.interactive=false;charactersToken.visible=true;setTimeout(function(){sound.play("ball_star_0")},500);TweenLite.to(charactersToken.scale,.5,{ease:Back.easeOut,x:.5,y:.5,onComplete:function(){TweenLite.to(charactersToken.scale,.3,{delay:.3,x:.7,y:.7})}});TweenLite.to(charactersToken.scale,.5,{delay:1.5,ease:Back.easeIn,x:.3,y:.3,onComplete:function(){charactersToken.visible=false;setTimeout(function(){Interface.playMusic("music_screens");buttonFunc()},300)}});TweenLite.to(player1,.5,{ease:Quad.easeIn,y:800});TweenLite.to(player2,.5,{ease:Quad.easeIn,y:800})};var replayButton=Interface.button("replay",function(){closePanel(refreshFunc)});var nextButton=Interface.button("next",function(){closePanel(nextFunc)});replayButton.position.x=-70;nextButton.position.x=70;replayButton.position.y=190;nextButton.position.y=190;popupHolder.addChild(blackBack);popupHolder.addChild(popupBack);popupHolder.addChild(scoreIconA);popupHolder.addChild(scoreIconB);popupHolder.addChild(recordIconA);popupHolder.addChild(recordIconB);popupHolder.addChild(scoreText);popupHolder.addChild(recordText);popupHolder.addChild(replayButton);popupHolder.addChild(nextButton);popupHolder.addChild(charactersToken);popupHolder.addChild(starsImage);popupHolder.addChild(player1);popupHolder.addChild(player2);popupHolder.visible=false;popupHolder.hitArea=new PIXI.Rectangle(-1e3,-1e3,2e3,2e3);popupHolder.interactive=true;return popupHolder},createBackground:function(){var container=new PIXI.Container;var panelList=[];var treeList=[];for(var i=0;i<20;++i){var numberString=CC.Utility.intToString(i+1,2);var backgroundSection=CC.Utility.pixiAtlasSprite("pogo_background_"+numberString+".png",{anchor:"tl"});backgroundSection.x=i*256;backgroundSection.width=257;backgroundSection.index=i;backgroundSection.click=function(event){var mousePos=event.data.getLocalPosition(this)};panelList.push(backgroundSection);container.addChild(backgroundSection);var panelDistace=256*panelList.length;var halfDist=panelDistace*.5}panelList[19].addChild(this.createTreePalmAnim(173,74,-.8,.8,0));panelList[1].addChild(this.createTreePalmAnim(77,74,.9,.9,0));panelList[3].addChild(this.createTreePalmAnim(181,72,-.9,.9,0));panelList[5].addChild(this.createTreePalmAnim(70,32,.8,.8,0));panelList[9].addChild(this.createTreePalmAnim(55,44,-1,1,0));panelList[15].addChild(this.createTreePalmAnim(213,145,.5,.5,0));panelList[0].addChild(this.createCrowdAnim(1,101,266,1,1));panelList[5].addChild(this.createCrowdAnim(2,147,273,1,1));panelList[10].addChild(this.createCrowdAnim(1,54,274,1,1));panelList[14].addChild(this.createCrowdAnim(2,117,275,.6,.6));panelList[17].addChild(this.createCrowdAnim(1,147,274,1,1));panelList[18].addChild(this.createCrowdAnim(2,20,274,1,1));container.update=function(cameraPos,delta){for(var i=0;i<panelList.length;++i){var panel=panelList[i];panel.position.x=Math.modo(i*256+(cameraPos*.5+halfDist),panelDistace)-cameraPos-halfDist;panel.position.x=Math.floor(panel.position.x);for(var j=0;j<panel.children.length;++j){if(panel.children[j].update){panel.children[j].update(delta||.016,j)}}}};return container}};var BeachPogoScreens={createStartScreen:function(){var container=new PIXI.Container;var updateFunc=function(delta){};return{construct:container,color:16711680,update:updateFunc}},createGameScreen:function(){window.focus();SS.getAccessToken();Interface.stopMusic();sound.play("crowd_start");sound.play("game_intro_sting");var container=new PIXI.Container;var cameraFloatingLayer=new PIXI.Container;var jumpButtonTest=new PIXI.Container;jumpButtonTest.hitArea=new PIXI.Rectangle(-1e3,-1e3,2e3,2e3);jumpButtonTest.interactive=true;var pogoStick=BeachPogoWidgets.createPogoStick(true);pogoStick.onPlatform=true;var playerSunk=false;var nextDistraction=0;var distractionTimer=20;var distractionAnimations=[new PIXI.spine.Spine.fromAtlas("anim/distraction_0.json"),new PIXI.spine.Spine.fromAtlas("anim/distraction_1.json"),new PIXI.spine.Spine.fromAtlas("anim/distraction_2.json")];distractionAnimations[0].x=-1e3;distractionAnimations[1].x=-1e3;distractionAnimations[2].x=-1e3;var prevCharacterDummy=BeachPogoWidgets.createPogoStick();prevCharacterDummy.position.y=-30;cameraFloatingLayer.position.y=80;cameraFloatingLayer.position.x=-300;if(CC.isMobile){var helpPopup=Interface.helpPopup(SS.copy.pogoHelpMobile,"help_screens_pogo.png","help_controls_3.png")}else{var helpPopup=Interface.helpPopup(SS.copy.pogoHelpDesktop,"help_screens_pogo.png","help_controls_1.png")}var pausePopup=Interface.pausePopup(helpPopup);var pauseButton=Interface.button("pause",function(){pausePopup.show();pauseButton.visible=false;restartButton.visible=false});var restartButton=Interface.button("restart",function(){document.body.removeEventListener("keydown",funcKeyDown);document.body.removeEventListener("keyup",funcKeyUp);CC.WebApp.current.swapScreen(BeachPogoScreens.createGameScreen())});restartButton.position.y=-300;pauseButton.position.y=-300;var waterSplash=new PIXI.spine.Spine.fromAtlas("anim/pogo_splash.json");waterSplash.visible=false;var starsPlatform=new PIXI.spine.Spine.fromAtlas("anim/platform_stars.json");starsPlatform.primedAnimation;var starThresholds=[2560,6400,12800,25600];var findNextPlatformX=function(){var shortestDist=null;var testDist;var returnX,platform;for(var i=0;i<platformPool.length;++i){platform=platformPool[i];testDist=platform.x-pogoStick.x;if((shortestDist===null||testDist<shortestDist)&&testDist>0){returnX=platform.x;shortestDist=testDist}}return returnX};var chopper=CC.Utility.pixiAtlasMovieClip(["chopper_1.png","chopper_2.png"],{y:-500});chopper.play();chopper.timer=0;chopper.animationSpeed=.3;chopper.scale.x=-1;var cloudLayer=new PIXI.Container;var cloudSpread=3e3;var cloudCount=3;var cloudStep=cloudSpread/cloudCount;for(var i=0;i<cloudCount;++i){var xPos=cloudStep*i+Math.sin(Math.random()*10)*cloudStep*.3;var yPos=Math.random()*-200;var cloudsA=CC.Utility.pixiAtlasSprite("cloud1.png",{x:xPos,y:yPos});var cloudsB=CC.Utility.pixiAtlasSprite("cloud1.png",{x:xPos+cloudSpread,y:yPos});cloudLayer.addChild(cloudsA);cloudLayer.addChild(cloudsB)}cloudLayer.position.y=-450;var currentCharacterIndex=0;var countdownAnim=new PIXI.spine.Spine.fromAtlas("anim/countdown.json");countdownAnim.visible=false;countdownAnim.preWait=1.5;countdownAnim.preWaitOver=false;countdownAnim.state.onEvent=function(i,event){if(event.stringValue==="sound_beep"){sound.play("beep")}else{Interface.playMusic("pogo_music_0");sound.play("ball_start_whistle")}};var gameTimer=-countdownAnim.preWait;var countdownWhistleSoundPlayed=false;var endScreenPopup=BeachPogoWidgets.createGameEndPopup(function(){document.body.removeEventListener("keydown",funcKeyDown);document.body.removeEventListener("keyup",funcKeyUp);CC.WebApp.current.swapScreen(BeachPogoScreens.createGameScreen())},function(){document.body.removeEventListener("keydown",funcKeyDown);document.body.removeEventListener("keyup",funcKeyUp);CC.WebApp.current.swapScreen(MenuScreens.createTeamSelectionScreen())});var totalScore=0;var distanceSize=Math.round(128*.8);var distanceText=CC.Utility.pixiAtlasSprite("pogo_distance_panel.png",{anchor:"bl"});var distanceTextOutside=new PIXI.extras.BitmapText("0",{font:distanceSize+"px zorb_ball_font_outline",align:"center"});var distanceTextInside=new PIXI.extras.BitmapText("10:15",{font:distanceSize+"px zorb_ball_font",align:"center"});distanceText.addChild(distanceTextOutside);distanceText.addChild(distanceTextInside);distanceTextOutside.position.x=distanceTextInside.position.x=20;distanceTextOutside.position.y=distanceTextInside.position.y=-95;distanceText.position.x=-620;distanceText.position.y=360;var sea=CC.Utility.pixiAtlasSprite("sea.png");var seaA=CC.Utility.pixiAtlasSprite("sea.png");var sky=CC.Utility.pixiAtlasSprite("pogo_background_gradient.png");sky.anchor.y=1;sky.y=-233;sea.scale.x=3;seaA.scale.x=3;sky.scale.x=10;var secondCharacterDummy=BeachPogoWidgets.createPogoStick();secondCharacterDummy.position.y=-30;secondCharacterDummy.setCharacter(1);secondCharacterDummy.currentPlatformIndex=1;var pogoStickMask=new PIXI.Graphics;var pogoBackground=BeachPogoWidgets.createBackground();cameraFloatingLayer.addChild(sea);cameraFloatingLayer.addChild(sky);cameraFloatingLayer.addChild(cloudLayer);cameraFloatingLayer.addChild(pogoBackground);pogoBackground.position.y=-500;var powerArrowStem=new PIXI.Graphics;var physics=new Physics;var maxHeight,jumpArcTimeDown,heightY,lastPos,maxTime,dir,sections,sectionList,step,checks,checkStep,j,k,startTime,startTime,spread,pos;powerArrowStem.drawTrajectory=function(velocity){powerArrowStem.clear();maxHeight=physics.projectPeak(velocity.y);heightY=physics.project(velocity,maxHeight).y;maxTime=Math.sqrt((0-(heightY+pogoStick.y)*2)/900)+maxHeight;lastPos={x:0,y:0};dir=velocity.x>0?-1:1;sections=3;sectionList=[];sectionList[0]={x:0,y:0};step=maxTime/sections;checks=256;checkStep=256/velocity.x/checks;for(var j=0;j<beachBallPool.length;++j){var beachBall=beachBallPool[j];if(beachBall.x>pogoStick.x+128&&beachBall.x<pogoStick.x+1200){for(var k=0;k<checks;++k){startTime=(beachBall.x-pogoStick.x-128)/velocity.x;spread=startTime+k*checkStep;pos=physics.project(velocity,spread);pos.x+=pogoStick.x;pos.y+=pogoStick.y;pos.x-=beachBall.x;pos.y-=beachBall.y;if(pos.x*pos.x+pos.y*pos.y<22500){if(spread>0){j=beachBallPool.length+2;k=checks+2;step=Math.min(spread,maxTime)/sections}}}}}for(var j=1;j<=sections;++j){var pos=physics.project(velocity,j*step);lastPos.angle=Math.atan2(-(pos.y-lastPos.y),pos.x-lastPos.x);lastPos.x=pos.x;lastPos.y=pos.y;sectionList[j]=pos}var distanceToPeak=CC.Geometry.vectorLength(sectionList[3]);var normal={x:sectionList[3].y/distanceToPeak,y:-(sectionList[3].x/distanceToPeak)};var dotLength1=CC.Geometry.dotProduct2D(normal,sectionList[1]);var dotLength2=CC.Geometry.dotProduct2D(normal,sectionList[2]);sectionList[1].x+=dotLength1*normal.x*.5;sectionList[1].y+=dotLength1*normal.y*.5;sectionList[2].x+=dotLength2*normal.x*.5;sectionList[2].y+=dotLength2*normal.y*.5;var value=distanceToPeak/400;for(var j=0;j<2;++j){var vertical=j*1.5;if(j){powerArrowStem.beginFill(16777215);powerArrowStem.lineStyle(0,8947848)}else{powerArrowStem.lineStyle(6,8947848)}var sinA=Math.sin(lastPos.angle);var cosA=Math.cos(lastPos.angle);var sinB=Math.sin(lastPos.angle+Math.PI*.5);var cosB=Math.cos(lastPos.angle+Math.PI*.5);powerArrowStem.moveTo(0,0);powerArrowStem.bezierCurveTo(sectionList[1].x,sectionList[1].y+8*value-vertical,sectionList[2].x,sectionList[2].y+8*value-vertical,sectionList[3].x+16*value*sinA,sectionList[3].y+16*value*cosA);powerArrowStem.lineTo(sectionList[3].x+32*value*sinA,sectionList[3].y+32*value*cosA-vertical);powerArrowStem.lineTo(sectionList[3].x+40*value*sinB,sectionList[3].y+40*value*cosB-vertical);powerArrowStem.lineTo(sectionList[3].x+32*value*-sinA,sectionList[3].y+32*value*-cosA-vertical);powerArrowStem.lineTo(sectionList[3].x+16*value*-sinA,sectionList[3].y+16*value*-cosA-vertical);powerArrowStem.bezierCurveTo(sectionList[2].x,sectionList[2].y-8*value-vertical,sectionList[1].x,sectionList[1].y-8*value-vertical,sectionList[0].x,sectionList[0].y-1-vertical)}return lastPos};pogoStickMask.beginFill(16711680,.5);pogoStickMask.drawRect(-256,-1e3,512,1030);pogoStick.mask=pogoStickMask;var chargeJump=0;var timer=0;var secondPlayerTimer=0;var jumpCharging=false;var jumpIndicatorBacking=new PIXI.Graphics;var jumpIndicator=new PIXI.Graphics;var waterFade=CC.Utility.pixiAtlasSprite("pogo_water_fade.png",{anchor:"t"});waterFade.scale.x=10;waterFade.position.y=20;var slideOffTimer=0;var slideOffDir=1;seaA.position.y=200;jumpIndicator.beginFill(16711680);jumpIndicator.drawRect(0,0,200,20);jumpIndicatorBacking.beginFill(14540253);jumpIndicatorBacking.drawRect(-2,-2,204,24);pogoStick.position.y=-300;pogoStick.velocity={x:0,y:0};pogoStick.target=-1;var jumpStartFunction=function(){if((pogoStick.target!==-1||pogoStick.onPlatform||jumpArcTimeDown<0)&&!jumpCharging&&gameTimer>3){jumpCharging=true;chargeJump=0}};var jumpEndFunction=function(){powerArrowStem.clear();if(chargeJump&&(pogoStick.target!==-1||pogoStick.onPlatform)&&gameTimer>3){var ball=beachBallPool[pogoStick.target];{pogoStick.target=-1;pogoStick.onPlatform=false;pogoStick.velocity.x=500*chargeJump+200;pogoStick.velocity.y=-(2e3*chargeJump+200);sound.play("pogo_launch");sound.play("ball_launch");pogoStick.jumpState();chargeJump=0;jumpArcTimeDown=physics.projectPeak(pogoStick.velocity.y)}}chargeJump=0;jumpCharging=false};var beachBallPool=[];var platformPool=[];var beachBallPoolIndex=0;var platformPoolIndex=0;var beachBallMaskPool=[];window.funcKeyDown=function(e){if(e.keyCode==32){e.preventDefault();if(!e.repeat){jumpStartFunction()}}};window.funcKeyUp=function(e){if(e.keyCode==32){e.preventDefault();jumpEndFunction()}};document.body.addEventListener("keydown",funcKeyDown);document.body.addEventListener("keyup",funcKeyUp);var genratorHead=0;var difficultyScale=0;var totalGeneratedBallCount=0;cameraFloatingLayer.addChild(seaA);for(var i=0;i<20;++i){var addPlatformInsteadOfBall=!(totalGeneratedBallCount%10);if(addPlatformInsteadOfBall){var platform=BeachPogoWidgets.createPlatform();platform.index=platformPool.push(platform)-1;cameraFloatingLayer.addChild(platform)}else{var beachBall=BeachPogoWidgets.createBeachBall();beachBall.maskA=CC.Utility.pixiAtlasSprite("ball_mask_2.png",{anchor:"tl",x:-128});beachBall.maskB=CC.Utility.pixiAtlasSprite("ball_mask_2.png",{anchor:"tr",x:128});var maskHolder=new PIXI.Container;var beachBallMask=CC.Utility.pixiAtlasSprite("ball_mask.png",{anchor:"t"});maskHolder.beachMask=beachBallMask;var maskRipple=new PIXI.spine.Spine.fromAtlas("anim/ripple.json");maskRipple.state.setAnimationByName(0,"ripple",true);maskRipple.update(Math.random());beachBallMask.addChild(maskRipple);maskHolder.addChild(beachBall.maskA);maskHolder.addChild(beachBall.maskB);maskHolder.addChild(beachBallMask);beachBallPool.push(beachBall);beachBallMaskPool.push(maskHolder);cameraFloatingLayer.addChild(beachBall);cameraFloatingLayer.addChild(maskHolder)}totalGeneratedBallCount++}totalGeneratedBallCount=0;var addBallOrPlatform=function(){var addPlatformInsteadOfBall=!(totalGeneratedBallCount%10);if(addPlatformInsteadOfBall){var platform=platformPool[platformPoolIndex];platform.position.x=genratorHead;platformPoolIndex=(platformPoolIndex+1)%platformPool.length}else{var beachBall=beachBallPool[beachBallPoolIndex];var beachBallMask=beachBallMaskPool[beachBallPoolIndex];beachBall.position.x=genratorHead;beachBall.position.y=(Math.random()-.5)*(-50+-100*difficultyScale);beachBallMask.position.x=beachBall.position.x;beachBallPoolIndex=(beachBallPoolIndex+1)%beachBallPool.length}genratorHead+=350+Math.random()*600*difficultyScale;totalGeneratedBallCount++;difficultyScale+=.01};for(var i=0;i<20;++i){addBallOrPlatform()}secondCharacterDummy.position.x=platformPool[1].position.x+100;prevCharacterDummy.position.x=-1e3;cameraFloatingLayer.addChild(waterFade);cameraFloatingLayer.addChild(powerArrowStem);cameraFloatingLayer.addChild(pogoStickMask);cameraFloatingLayer.addChild(secondCharacterDummy);cameraFloatingLayer.addChild(prevCharacterDummy);cameraFloatingLayer.addChild(pogoStick);cameraFloatingLayer.addChild(chopper);cameraFloatingLayer.addChild(waterSplash);cameraFloatingLayer.addChild(distractionAnimations[0]);cameraFloatingLayer.addChild(distractionAnimations[1]);cameraFloatingLayer.addChild(distractionAnimations[2]);cameraFloatingLayer.addChild(starsPlatform);jumpButtonTest.mousedown=jumpButtonTest.touchstart=function(){jumpStartFunction()};jumpButtonTest.mouseup=jumpButtonTest.touchend=function(){jumpEndFunction()};jumpIndicator.position.x=-200;jumpIndicator.position.y=-200;
jumpIndicatorBacking.position.x=-200;jumpIndicatorBacking.position.y=-200;container.addChild(cameraFloatingLayer);container.addChild(jumpButtonTest);container.addChild(distanceText);container.addChild(pauseButton);container.addChild(restartButton);var cloudParalaxScale=.7;var cloudParalaxInverseScale=1/cloudParalaxScale-1;var updateFunc=function(delta){delta=Math.min(delta,.06);if(forcePause&&!pausePopup.visible){pausePopup.show();pauseButton.visible=false;restartButton.visible=false}if(!countdownAnim.preWaitOver){countdownAnim.preWait-=delta;if(countdownAnim.preWait<0){countdownAnim.preWaitOver=true;countdownAnim.visible=true;countdownAnim.state.setAnimationByName(0,"countdown")}}if(distractionTimer>0&&!playerSunk){distractionTimer-=delta;if(distractionTimer<=0){distractionTimer=4+Math.random()*6;var distractionAnim=distractionAnimations[nextDistraction];distractionAnim.x=pogoStick.x+300*Math.random()+200;distractionAnim.y=50*Math.random()+50;distractionAnim.state.clearTrack(0);distractionAnim.skeleton.setToSetupPose();distractionAnim.state.setAnimationByName(0,"animation");sound.play("pogo_water_hit_1");nextDistraction=(nextDistraction+1)%distractionAnimations.length;if(nextDistraction===0){for(var i=0;i<3;++i){distractionAnimations.push(distractionAnimations.splice(distractionAnimations.length-(i+1),1)[0])}}}}endScreenPopup.update(delta);pauseButton.visible=!(endScreenPopup.visible||pausePopup.visible||helpPopup.visible);distanceText.visible=pauseButton.visible;restartButton.visible=pauseButton.visible;distanceText.position.x=CC.WebApp.current.screenWidth*-.5;distanceTextOutside.text=Math.floor(pogoStick.x/256)+"m";distanceTextInside.text=distanceTextOutside.text;gameTimer+=delta;if(jumpArcTimeDown>0){jumpArcTimeDown-=delta}chopper.timer+=delta;chopper.rotation=Math.sin(chopper.timer)*.1;chopper.x=Math.lerp(chopper.x,pogoStick.x+300,.1);chopper.y=Math.sin(chopper.timer*2)*50-650;pauseButton.position.x=CC.WebApp.current.screenWidth*.5-60;restartButton.position.x=CC.WebApp.current.screenWidth*-.5+60;cloudLayer.position.x=-cameraFloatingLayer.position.x*.7;cloudLayer.position.x+=Math.floor(cloudLayer.position.x*cloudParalaxInverseScale/cloudSpread)*cloudSpread;pogoStickMask.position.x=pogoStick.x;waterFade.position.x=-cameraFloatingLayer.position.x;if(jumpCharging){chargeJump+=delta*.35;chargeJump=Math.min(chargeJump,1);powerArrowStem.position.x=pogoStick.x;powerArrowStem.position.y=pogoStick.y;powerArrowStem.drawTrajectory({x:500*chargeJump+200,y:-(2e3*chargeJump+200)});if(chargeJump>.4){chargeJump=0;jumpCharging=false;powerArrowStem.clear()}}for(var i=0;i<starThresholds.length;++i){var mark=starThresholds[i];if(pogoStick.oldX&&mark>pogoStick.oldX&&mark<=pogoStick.x){starsPlatform.x=findNextPlatformX();starsPlatform.primedAnimation="stars_"+(i+2);starsPlatform.state.setAnimationByName(0,"stars_0")}}if(pogoStick.oldX&&starsPlatform.x-200>pogoStick.oldX&&starsPlatform.x-200<pogoStick.x){starsPlatform.state.setAnimationByName(0,starsPlatform.primedAnimation);sound.play("ball_star_0")}pogoStick.oldX=pogoStick.x;for(var i=0;i<beachBallPool.length;++i){var ball=beachBallPool[i];ball.ballObject.position.y*=.9}jumpIndicator.scale.x=chargeJump;if(pogoStick.target!==-1){pogoStick.jumpChecker(delta);slideOffTimer-=delta*.5;var ball=beachBallPool[pogoStick.target];ball.ball.rotation+=delta*.5;ball.ballObject.position.y=Math.abs(Math.sin(pogoStick.timer*5))*10;var distance=CC.Geometry.vectorDistance(ball,pogoStick);pogoStick.x=Math.lerp(pogoStick.x,ball.x-Math.sin(slideOffTimer)*ball.radius,.1);pogoStick.y=Math.lerp(pogoStick.y,ball.y-Math.cos(slideOffTimer)*ball.radius,.1);pogoStick.x=ball.x+(pogoStick.x-ball.x)/distance*ball.radius;pogoStick.y=ball.y+(pogoStick.y-ball.y)/distance*ball.radius;pogoStick.velocity.x=0;pogoStick.velocity.y=0;timer+=delta;if(pogoStick.y>ball.y-ball.radius*.5){pogoStick.target=-1;chargeJump=0;pogoStick.velocity.x=100*slideOffDir;pogoStick.velocity.y=-100}}else if(pogoStick.onPlatform){pogoStick.jumpChecker(delta);timer+=delta;pogoStick.velocity.x=0;pogoStick.velocity.y=0;pogoStick.position.y=-30}else{pogoStick.velocity.y+=delta*900;pogoStick.position.x+=pogoStick.velocity.x*delta;pogoStick.position.y+=pogoStick.velocity.y*delta;timer=0;pogoStick.stick.position.y=0}secondPlayerTimer+=delta;secondCharacterDummy.jumpChecker(delta);prevCharacterDummy.jumpChecker(delta);if(pogoStick.onPlatform){cameraFloatingLayer.position.x=Math.lerp(cameraFloatingLayer.position.x,-pogoStick.x-300,.01);cameraFloatingLayer.position.y=Math.lerp(cameraFloatingLayer.position.y,-pogoStick.y+100,.01)}else{cameraFloatingLayer.position.x=Math.lerp(cameraFloatingLayer.position.x,-pogoStick.x-300,.1);cameraFloatingLayer.position.y=Math.lerp(cameraFloatingLayer.position.y,-pogoStick.y+100,.1)}cameraFloatingLayer.position.x=Math.round(cameraFloatingLayer.position.x);cameraFloatingLayer.position.y=Math.round(cameraFloatingLayer.position.y);cameraFloatingLayer.position.y=Math.max(cameraFloatingLayer.position.y,100);pogoBackground.update(cameraFloatingLayer.position.x);sea.x=pogoStick.x+200;seaA.x=sea.x;sky.x=sea.x;if(!playerSunk&&pogoStick.y>100){pogoStick.velocity.x=0;pogoStick.velocity.y=0;pogoStick.target=-1;jumpCharging=false;playerSunk=true;waterSplash.visible=true;pogoStick.visible=false;waterSplash.x=pogoStick.x;waterSplash.y=50;waterSplash.state.setAnimationByName(0,"splash_0");sound.play("pogo_splash");sound.play("ball_start_whistle");sound.play("crowd_start");setTimeout(function(){SS.sendScore(SS.selectedTeam.teamName,SS.selectedEvent.id,SS.selectedEvent.calculateStarScore(pogoStick.x));SS.updateTeamScores();endScreenPopup.show(pogoStick.x)},2500)}for(var i=0;i<beachBallPool.length;++i){var ball=beachBallPool[i];var ballMask=beachBallMaskPool[i];ballMask.beachMask.scale.x=-Math.cos(Math.cos((ball.y+ball.ballObject.y)/128)*Math.PI);ball.maskA.scale.x=(ball.y+ball.ballObject.y>0?1-ballMask.beachMask.scale.x:0)*.5;ballMask.beachMask.scale.y=ballMask.beachMask.scale.x;ball.maskB.scale.x=ball.maskA.scale.x;if(pogoStick.target===-1){var distanceSqr=CC.Geometry.vectorDistanceSquared(ball,pogoStick);if(distanceSqr<ball.radius*ball.radius){pogoStick.target=i;sound.play("pogo_bounce_1");pogoStick.jumpChecker(100);if(ball.x>pogoStick.x){slideOffDir=-1}else{slideOffDir=1}slideOffTimer=0;if(pogoStick.y>ball.y-ball.radius*.75){pogoStick.target=-1;pogoStick.velocity.x=200*slideOffDir;pogoStick.velocity.y=-100}}}if(ball.x<pogoStick.x-1e3){addBallOrPlatform()}}for(var i=0;i<platformPool.length;++i){var platform=platformPool[i];if(!pogoStick.onPlatform){if(Math.abs(platform.position.x-pogoStick.position.x)<180&&pogoStick.position.y>-30){pogoStick.onPlatform=true;sound.play("ring_contact");sound.play("crowd_score"+Math.floor(Math.random()*3+1));if(i===secondCharacterDummy.currentPlatformIndex){prevCharacterDummy.position.x=pogoStick.position.x;prevCharacterDummy.setCharacter(currentCharacterIndex);secondCharacterDummy.setCharacter(currentCharacterIndex);currentCharacterIndex=1-currentCharacterIndex;pogoStick.setCharacter(currentCharacterIndex);prevCharacterDummy.position.x=pogoStick.position.x;TweenLite.to(prevCharacterDummy.position,2,{x:secondCharacterDummy.position.x-200});pogoStick.position.x=secondCharacterDummy.position.x;secondCharacterDummy.currentPlatformIndex=(secondCharacterDummy.currentPlatformIndex+1)%platformPool.length;secondCharacterDummy.position.x=platformPool[secondCharacterDummy.currentPlatformIndex].position.x+100}}}if(platform.x<pogoStick.x-1e3){addBallOrPlatform()}}if(pogoStick.position.x>platformPool[secondCharacterDummy.currentPlatformIndex].position.x+800){secondCharacterDummy.currentPlatformIndex=(secondCharacterDummy.currentPlatformIndex+1)%platformPool.length;secondCharacterDummy.position.x=platformPool[secondCharacterDummy.currentPlatformIndex].position.x+100}container.addChild(countdownAnim);container.addChild(endScreenPopup);container.addChild(pausePopup);container.addChild(helpPopup);pogoStick.rotation=Math.lerp(pogoStick.rotation,pogoStick.velocity.x*Math.max(-pogoStick.velocity.y,0)*7e-6,.03);if(showHelpStart){showHelpStart=false;window.boom_help_shown_already_pogo=true;distanceText.visible=false;pauseButton.visible=false;restartButton.visible=false;helpPopup.show()}};var showHelpStart=window.boom_help_shown_already_pogo===undefined;var firstBallStart=true;return{construct:container,color:7528191,update:updateFunc}}};var Screens={createLoadingScreen:function(){var container=new PIXI.Container,logo=new PIXI.Sprite.fromFrame("logo_preloader.png"),loadingWheel=new PIXI.Sprite.fromFrame("loading_icon.png"),loadingText=Interface.reverseText(SS.copy.loading,40,"left",700,true),continueButton=new PIXI.Sprite.fromFrame("iOS_start.png");isIOS=navigator.userAgent.match(/iPod|iPad|iPhone|Silk|Kindle/i)!==null,buttonClicked=!isIOS;logo.scale.x=logo.scale.y=.75;loadingWheel.anchor.set(.5);loadingWheel.y=180;continueButton.anchor.set(.5);continueButton.interactive=true;continueButton.buttonMode=true;loadingText.x=-CC.WebApp.current.screenWidth*.5+(loadingText.width/2+30);loadingText.y=320;loadingText.visible=!isIOS;logo.anchor.set(.5);logo.y=-50;logo.visible=!isIOS;loadingWheel.visible=!isIOS;container.addChild(logo);container.addChild(loadingWheel);if(isIOS){container.addChild(continueButton)}var totalTime=0;var pulseButtonTimer=0;var updateFunc=function(delta){continueButton.visible=isIOS&&!sound._touched&&sound._primed;loadingText.visible=!isIOS||sound._touched;logo.visible=!isIOS||sound._touched;loadingWheel.visible=!isIOS||sound._touched;totalTime+=delta;loadingWheel.rotation+=delta*3;pulseButtonTimer+=delta;if(buttonClicked&&totalTime>.5){loadingText.visible=!loadingText.visible;totalTime=0}if(continueButton.visible){continueButton.rotation=Math.max(Math.sin(pulseButtonTimer*3)-.5,0)*Math.cos(pulseButtonTimer*12*3)*.2}};var resize=function(screenWidth,screenHeight){loadingText.x=-screenWidth*.5+(loadingText.width/2+30)};return{construct:container,color:15668878,update:updateFunc,resize:resize}},createStartScreen:function(screenObject){var container=new PIXI.Container;var updateFunc=function(delta){};return{construct:container,color:15658751,update:updateFunc}}};var SS={scoreboardAvailable:false,scoreboardStatic:"dat/database.json",scoreboardUrl:"http://boomerang-sports.completecontrol.eu/",currentAccessToken:null,countryCode:"GB",teams:[{id:0,teamName:"Team A",name:"Looney Tunes",selectionImage:"teams0001.png",medalPosition:-1,scoreTotal:0},{id:1,teamName:"Team B",name:"Wabbit!",selectionImage:"teams0002.png",medalPosition:-1,scoreTotal:0},{id:2,teamName:"Team C",name:"Tom & Jerry Show",selectionImage:"teams0003.png",medalPosition:-1,scoreTotal:0},{id:3,teamName:"Team D",name:"Be Cool Scoobydoo",selectionImage:"teams0004.png",medalPosition:-1,scoreTotal:0}],events:[{id:"Game B",eventName:"Beach Pogo",selectionImage:"game0001.png",selectedScreen:function(){return BeachPogoScreens.createGameScreen()},calculateStarScore:function(score){var starIndex=1;if(score/256>=10){starIndex=2}if(score/256>=25){starIndex=3}if(score/256>=50){starIndex=4}if(score/256>=100){starIndex=5}return starIndex}},{id:"Game C",eventName:"Rubber Ring Race",selectionImage:"game0003.png",selectedScreen:function(){return RubberRingRideScreens.createGameScreen()},calculateStarScore:function(score){var starIndex=5;if(score>60){starIndex=4}if(score>70){starIndex=3}if(score>80){starIndex=2}if(score>90){starIndex=1}return starIndex}},{id:"Game A",eventName:"Basket Zorb",selectionImage:"game0002.png",selectedScreen:function(){return BasketZorbScreens.createGameScreen()},calculateStarScore:function(score){var starIndex=1;if(score>=6){starIndex=2}if(score>=11){starIndex=3}if(score>=16){starIndex=4}if(score>=21){starIndex=5}return starIndex}}],medals:[{id:0,medalName:"Gold",medalImage:"medals0001.png"},{id:1,medalName:"Silver",medalImage:"medals0002.png"},{id:2,medalName:"Bronze",medalImage:"medals0003.png"},{id:3,medalName:"Copper",medalImage:"medals0004.png"}],getMedalByID:function(id){for(var i=0;i<SS.medals.length;i++){if(SS.medals[i].id==id){return SS.medals[i]}}return null},getEventByID:function(id){for(var i=0;i<SS.events.length;i++){if(SS.events[i].id==id){return SS.events[i]}}return null},gameCopy:{objectiveTitle:"Help your team win! \n",teamSelectionTitle:"Choose your team! \n",eventSelectionTitle:"Choose an event! \n",loadingText:"Loading... \n"},copy:{},lastScoreUpdate:1462870057081,updateTeamScores:function(){var minutesCacheValid=15;if(new Date(new Date(SS.lastScoreUpdate).getTime()+minutesCacheValid*6e4).getTime()>Date.now()){return}var xmlhttp=new XMLHttpRequest;xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==XMLHttpRequest.DONE&&xmlhttp.status==200){var jsonResponse=JSON.parse(xmlhttp.responseText);jsonResponse.results.sort(function(a,b){return b.score_total-a.score_total});var nextMedal=0;for(var i=0;i<jsonResponse.results.length;i++){for(var j=0;j<SS.teams.length;j++){if(SS.teams[j].teamName==jsonResponse.results[i].team_name){SS.teams[j].scoreTotal=jsonResponse.results[i].score_total;SS.teams[j].medalPosition=nextMedal;nextMedal++}}}}else if(xmlhttp.readyState==XMLHttpRequest.DONE){console.log("Failed to update scoreboard. Status: "+xmlhttp.status)}};if(true===SS.scoreboardAvailable){xmlhttp.open("GET",SS.scoreboardUrl+"?action=scoreboard",true)}else{xmlhttp.open("GET",SS.scoreboardStatic,true)}xmlhttp.send();SS.lastScoreUpdate=Date.now()},getAccessToken:function(){if(SS.currentAccessToken!=null&&new Date(SS.currentAccessToken.expires*1e3).getTime()>Date.now()){return}if(true===SS.scoreboardAvailable){var xmlhttp=new XMLHttpRequest;xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==XMLHttpRequest.DONE&&xmlhttp.status==200){var jsonResponse=JSON.parse(xmlhttp.responseText);SS.currentAccessToken={token:jsonResponse.results.access_token,expires:jsonResponse.results.expires}}else if(xmlhttp.readyState==XMLHttpRequest.DONE){console.log("Failed to update scoreboard. Status: "+xmlhttp.status)}};xmlhttp.open("GET",SS.scoreboardUrl+"?action=token&data_accesskey=562c56392d786cbae3497c84d3534511",true);xmlhttp.send()}},checkAccessToken:function(){},sendScore:function(team,game,score){if(SS.currentAccessToken==null){return}if(true===SS.scoreboardAvailable){var xmlhttp=new XMLHttpRequest;xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==XMLHttpRequest.DONE&&xmlhttp.status==200){var jsonResponse=JSON.parse(xmlhttp.responseText)}else if(xmlhttp.readyState==XMLHttpRequest.DONE){console.log("Failed to update scoreboard. Status: "+xmlhttp.status)}};var params={action:"score",data_accesskey:"562c56392d786cbae3497c84d3534511",data_accesstoken:SS.currentAccessToken.token,data_team:team,data_game:game,data_score:score,data_country:SS.countryCode};xmlhttp.open("POST",SS.scoreboardUrl,true);xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");xmlhttp.send(SS.toQueryString(params))}},toQueryString:function(params){var parts=[];for(var i in params){if(params.hasOwnProperty(i)){parts.push(encodeURIComponent(i)+"="+encodeURIComponent(params[i]))}}return parts.join("&")}};var ccAssetsLoaded=false;PIXI.dontSayHello=true;var sound=null;var ccPreLoader=new PIXI.loaders.Loader;var ccLoader=new PIXI.loaders.Loader;CC.Utility.addAtlasesToLoader("img/atlas_#.json",2,ccLoader);CC.Utility.addAtlasesToLoader("img/ui_atlas_#.json",1,ccLoader);CC.Utility.addAtlasesToLoader("img/fast_atlas_#.json",1,ccLoader);ccLoader.add("img/logo.png");ccLoader.add("anim/countdown.json");ccLoader.add("anim/title_anim.json");ccLoader.add("anim/beachball_trophy.json");ccLoader.add("anim/zorb_character_0.json");ccLoader.add("anim/zorb_character_1.json");ccLoader.add("anim/zorb_character_2.json");ccLoader.add("anim/zorb_character_3.json");ccLoader.add("anim/zorb_character_4.json");ccLoader.add("anim/zorb_character_5.json");ccLoader.add("anim/zorb_character_6.json");ccLoader.add("anim/zorb_character_7.json");ccLoader.add("anim/pogo_character_0.json");ccLoader.add("anim/pogo_character_1.json");ccLoader.add("anim/pogo_character_2.json");ccLoader.add("anim/pogo_character_3.json");ccLoader.add("anim/pogo_character_4.json");ccLoader.add("anim/pogo_character_5.json");ccLoader.add("anim/pogo_character_6.json");ccLoader.add("anim/pogo_character_7.json");ccLoader.add("anim/ring_character_0.json");ccLoader.add("anim/ring_character_2.json");ccLoader.add("anim/ring_character_4.json");ccLoader.add("anim/ring_character_6.json");ccLoader.add("anim/end_character_0.json");ccLoader.add("anim/end_character_1.json");ccLoader.add("anim/end_character_2.json");ccLoader.add("anim/end_character_3.json");ccLoader.add("anim/end_character_4.json");ccLoader.add("anim/end_character_5.json");ccLoader.add("anim/end_character_6.json");ccLoader.add("anim/end_character_7.json");ccLoader.add("anim/distraction_0.json");ccLoader.add("anim/distraction_1.json");ccLoader.add("anim/distraction_2.json");ccLoader.add("anim/starburst.json");ccLoader.add("anim/ring_splashes.json");ccLoader.add("anim/ring_wave.json");ccLoader.add("anim/basketzorb_crowd.json");ccLoader.add("anim/basket.json");ccLoader.add("anim/ripple.json");ccLoader.add("anim/boost.json");ccLoader.add("anim/ref_zorb.json");ccLoader.add("anim/race_ref.json");ccLoader.add("anim/paraglider.json");ccLoader.add("anim/platform_stars.json");ccLoader.add("anim/obstacle_smash.json");ccLoader.add("anim/star_results.json");ccLoader.add("anim/pogo_splash.json");ccLoader.add("fnt/zorb_ball_font.fnt");ccLoader.add("fnt/zorb_ball_font_outline.fnt");ccPreLoader.add("fnt/fred_font.fnt");ccPreLoader.add("fnt/fred_font_shadow.fnt");CC.Utility.addAtlasesToLoader("img/preload_atlas_#.json",1,ccPreLoader);ccPreLoader.add("snd/audio_sprites.json");ccPreLoader.add("dat/copy_deck.json");var onPreloadComplete=function(){startApp()};var onPreloadProgress=function(loader,res){if(res.data.sprite){totalLoadThresholds++;if(navigator.userAgent.match(/Kindle|Silk/i)!==null){sound=new CC.Sound({src:[res.name.replace(".json",".ogg")],milliseconds:true,sprites:res.data.sprite});onLoaderComplete()}else if(navigator.userAgent.match(/MSIE 10/i)!==null){sound=new CC.Sound({src:[res.name.replace(".json",".mp3")],milliseconds:true,sprites:res.data.sprite});onLoaderComplete()}else{sound=new CC.Sound({src:[res.name.replace(".json",".ogg"),res.name.replace(".json",".m4a"),res.name.replace(".json",".mp3"),res.name.replace(".json",".ac3")],milliseconds:true,sprites:res.data.sprite});if(sound._onloadCalled){onLoaderComplete()}else{sound.onload=onLoaderComplete}}}else if(res.isJson&&res.data.copy){SS.copy=res.data.copy;SS.countryCode=res.data.language}};var initApp=function(){ccPreLoader.load()};ccLoadedAssetCount=0;var ccAnimationList={};var onLoaderProgress=function(loader,res){ccLoadedAssetCount++;if(res.data.skeleton){var dataSpine=res.name.split("/");var dataName=dataSpine[dataSpine.length-1].replace(".json","");ccAnimationList[dataName]=res}};WebFont.load({custom:{families:["fred_burger","fred_burger_shadow"]}});var loadThresholds=0;var totalLoadThresholds=1;window.IMAGES_HAS_LOADED=false;window.SOUND_HAS_LOADED=false;var onLoaderCompleteImg=function(){window.IMAGES_HAS_LOADED=true;loadThresholds++;if(loadThresholds>=totalLoadThresholds){startGameFunction()}};var onLoaderComplete=function(){window.SOUND_HAS_LOADED=true;loadThresholds++;if(loadThresholds>=totalLoadThresholds){startGameFunction()}};var startGameFunction=function(){URLQuery=window.location.href.split("?");if(URLQuery.length<1){URLQuery=[0,"ball",0]}if(URLQuery.length<2){URLQuery=[0,URLQuery[1],0]}switch(URLQuery[1]){case"pogo":SS.selectedTeam=SS.teams[URLQuery[2]||0];SS.selectedEvent=SS.events[0];CC.WebApp.current.swapScreen(BeachPogoScreens.createGameScreen());break;case"ring":SS.selectedTeam=SS.teams[URLQuery[2]||0];SS.selectedEvent=SS.events[1];CC.WebApp.current.swapScreen(RubberRingRideScreens.createGameScreen());break;case"ball":SS.selectedTeam=SS.teams[URLQuery[2]||0];SS.selectedEvent=SS.events[2];CC.WebApp.current.swapScreen(BasketZorbScreens.createGameScreen());break;default:CC.WebApp.current.swapScreen(MenuScreens.createSplashScreen());break}};ccPreLoader.on("progress",onPreloadProgress);ccPreLoader.once("complete",onPreloadComplete);ccLoader.on("progress",onLoaderProgress);ccLoader.once("complete",onLoaderCompleteImg);