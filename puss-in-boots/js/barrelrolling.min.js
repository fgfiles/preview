/*! ... The Adventures of Puss In Boots ï¿½ 2015 DreamWorks Animation LLC. All rights reserved ...*/
game_shell.config.BG_COLOR="#371108";var BarrelRolling=function(){this.version="1.02",this.GAME_ID="barrel_run",this.ui={},this.onReady=function(){console.log("Barrel Run v"+this.version),alex.statics.XHR_LOAD_ENABLED=!1,this.loader=new alex.load.BulkLoader,this.loader.useXHR=!1,this.loader.imageLoad.useXHR=!1,this.user=this.createUser(),this.bootstrap()},this.bootstrap=function(){this.preload=new game_shell.BootStrap,this.preload.init({resolution:this.resolution,stageW:this.viewport.width,stageH:this.viewport.height,stage:this.pixiStage.content});var self=this;this.preload.on("complete",function(){self.createGameData(),self.start.call(self)}),this.preload.start()},this.createGameData=function(){this.gameData=new game_shell.data.GameData,this.gameData.init(this.json.game_config);var defaultLevel=this.config.LEVEL-1||0;this.user.levelInfo=this.gameData.levels[defaultLevel]},this.start=function(){this.game.gameScreens.call(game_shell.screenMgr);var firstScreen=this.config.FIRST_SCREEN||"title";this.screenMgr.showScreen(firstScreen)},this.createUser=function(){var user=new game_shell.data.User;return user.init({cheatUnlock:this.config.CHEAT_UNLOCK||!1}),user}};BarrelRolling.call(game_shell),alex.GenericGame.prototype.createSoundManager=function(){this.sndMgr=new game_shell.game.SoundManager;var sndConfig={isIOS:alex.utils.system.isIOS,context:null,audioType:game_shell.system.audioType};this.sndMgr.init(sndConfig),this.sndMgr.musicVolume=game_shell.config.MUSIC_VOLUME||.25},game_shell.BootStrap=function(){alex.load.BootStrap.call(this),this.barColor=15366678},game_shell.BootStrap.prototype=Object.create(alex.load.BootStrap.prototype),game_shell.BootStrap.prototype.defineBundle=function(){var imgFolder=alex.statics.IMG_DIR,jsonFolder=alex.statics.JSON_DIR;this.addJson({src:imgFolder+"bootstrap/bootstrap_@"+this.resolution+"x.json",id:"loader"}),this.addJson({src:jsonFolder+"config.json",id:"game_config"}),this.addImage({src:imgFolder+"bootstrap/bootstrap_@"+this.resolution+"x.png",id:"loader"})},alex.load.BootStrap.prototype.createLoadBar=function(){var w=10,h=20;this.bar=new alex.display.Quad(w,h,this.barColor),this.bar.x=this.stageW*-.5,this.bar.y=.5*this.stageH+h*-.5,this.stage.addChild(this.bar)},game_shell.data.User=function(){this.cheatUnlock=!1,this.progress=null,this.levelInfo=null},game_shell.data.User.prototype.init=function(config){if(config)for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.storage=this.createStorage(),this.progress=this.createProgress()},game_shell.data.User.prototype.saveResult=function(levelData){this.progress.saveResult(levelData)},game_shell.data.User.prototype.createProgress=function(){var progress=new game_shell.data.GameProgress,storage=this.storage;return progress.init({cheatUnlock:this.cheatUnlock,storage:storage,user:this,eventQueue:game_shell.eventQueue,screenManager:game_shell.screenMgr}),progress},game_shell.data.User.prototype.createStorage=function(){var storage=new game_shell.data.GameSave;return storage.init({key:game_shell.GAME_ID}),storage},game_shell.data.GameSave=function(){this.key=null,this.isSupported=!1},game_shell.data.GameSave.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.isSupported=this._checkSupported()},game_shell.data.GameSave.prototype._checkSupported=function(){try{return"localStorage"in window&&null!==window.localStorage}catch(e){return!1}},game_shell.data.GameSave.prototype.save=function(results){this.isSupported&&this._saveProgress(results)},game_shell.data.GameSave.prototype._saveProgress=function(results){var s=JSON.stringify(results);this._saveItem(this.key,s)},game_shell.data.GameSave.prototype.restore=function(){if(!this.isSupported)return null;try{var stringValue=localStorage[this.key];return"undefined"!=typeof stringValue?JSON.parse(stringValue):null}catch(e){console.log("ERROR - Storage.restore:"),console.log(e)}},game_shell.data.GameSave.prototype._saveItem=function(p_key,p_value){var success=!0;try{localStorage.removeItem(p_key),localStorage.setItem(p_key,p_value)}catch(e){console.log("*** LOCAL STORAGE ERROR! "+e.message),success=!1}return success},game_shell.data.GameData=function(){this.levels=null},game_shell.data.GameData.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);game_shell.bmFont=this.bmFont,game_shell.webFont=this.webFont},game_shell.data.GameData.prototype.getStars=function(time,level,respawns){if(0===time)return 0;var difficulty=Math.floor((level-1)/3),step=this.difficultySecs*difficulty,threeStars=this.threeStars-step,twoStars=this.twoStars-step,t=(this.oneStar-step,time/1e3),stars=1;return threeStars>t?stars=0===respawns?3:2:twoStars>t&&(stars=2>respawns?2:1),stars},game_shell.data.GameData.prototype.getMapData=function(index){var list=this.levels;return index>=list.length?null:list[index]},game_shell.data.GameData.prototype.getLocationMusic=function(location){var assets=null;switch(location){case 0:assets=this.assets.location_0_music;break;case 1:assets=this.assets.location_1_music;break;case 2:assets=this.assets.location_2_music}var i,item,copyList=[],n=assets.length;for(i=0;n>i;i++)item=assets[i],copyList[i]={src:item.src,id:item.id};return copyList},game_shell.data.GameData.prototype.getLocationAssets=function(location,resolution){var assets=null;switch(location){case 0:1===resolution?assets=this.assets.location_0_1x:2===resolution&&(assets=this.assets.location_0_2x);break;case 1:1===resolution?assets=this.assets.location_1_1x:2===resolution&&(assets=this.assets.location_1_2x);break;case 2:1===resolution?assets=this.assets.location_2_1x:2===resolution&&(assets=this.assets.location_2_2x)}return assets},game_shell.data.GameProgress=function(){this.cheatUnlock=!1,this.numLevels=9,this.results=[],this.storage=null,this.eventQueue=null,this.screenManager=null},game_shell.data.GameProgress.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.populate(),this.restore(),this.initEvents()},game_shell.data.GameProgress.prototype.initEvents=function(){this.nextLevel=this._nextLevel.bind(this),this.eventQueue.on("next_level",this.nextLevel)},game_shell.data.GameProgress.prototype._nextLevel=function(){console.log("GameProgress - _nextLevel");var currentMapData=this.user.levelInfo,levelIndex=currentMapData.index+1,mapData=game_shell.gameData.getMapData(levelIndex);if(mapData){var screenId="game",config={screenId:screenId,mapData:mapData};this.user.levelInfo=mapData;var manifest=this.screenManager.getManifestPath(screenId);this.screenManager.loadWithManifest(config,manifest)}else this.eventQueue.queueEvent({type:alex.events.NEW_SCREEN,screenId:"finish"})},game_shell.data.GameProgress.prototype.populate=function(){for(var i=0;i<this.numLevels;i++)this.results[i]=new game_shell.data.SavedResult(i+1,this.cheatUnlock);var data=this.results[0];data.unlocked=!0},game_shell.data.GameProgress.prototype.saveResult=function(levelData){if(!levelData)return void console.log("GameProgress saveResult - null levelData!");if(console.log("GameProgress -> saveResult - index "+levelData.index),levelData.isCompleted&&levelData.index<this.numLevels-1){var nextResult=this.getResultByIndex(levelData.index+1);nextResult.unlocked=!0}var resultData=this.getResultByIndex(levelData.index);resultData.save(levelData),this.storage.save(this.getResults())},game_shell.data.GameProgress.prototype.restore=function(){var savedData=this.storage.restore();if(savedData){for(var r,saved,n=savedData.length,highestUnlocked=null,i=0;n>i;i++)saved=savedData[i],saved.best.isCompleted&&(highestUnlocked=saved),r=this.getResultByIndex(saved.best.index),r&&(r.best.copy(saved.best),r.last.copy(saved.last));if(highestUnlocked)for(var index=highestUnlocked.best.index+1;index>0;)r=this.getResultByIndex(index),r&&(r.unlocked=!0),index--}},game_shell.data.GameProgress.prototype.getResults=function(){for(var r,results=[],i=0;i<this.numLevels;i++)r=this.results[i],results[i]={best:r.best,last:r.last};return results},game_shell.data.GameProgress.prototype.getResultByIndex=function(index){var i,found=null,item=null,n=this.results.length;for(i=0;n>i;i++)if(item=this.results[i],item.index===index){found=item;break}return found},game_shell.data.LevelProgress=function(){this.started=!1,this.gameBus=null,this.gameData=null,this.levelStats=null,this.types=game_shell.physics.BodyTypes,this.levelIndex=-1,this.coinValue=10,this.killValue=100,this.distanceValue=.5,this.playerSprite=null},game_shell.data.LevelProgress.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.levelStats=new game_shell.data.LevelStats(this.levelIndex),this.coinValue=this.gameData.coinValue,this.killValue=this.gameData.killValue,this.distanceValue=this.gameData.distanceValue},game_shell.data.LevelProgress.prototype.start=function(initialTime){this.started=!0,this.levelStats.time=0},game_shell.data.LevelProgress.prototype.reset=function(){this.levelStats.reset(),this.started=!1},game_shell.data.LevelProgress.prototype.destroyObstacle=function(){this.levelStats.kills++},game_shell.data.LevelProgress.prototype.levelComplete=function(){this.started=!1,this.levelStats.isCompleted=!0,this.refreshScore()},game_shell.data.LevelProgress.prototype.update=function(delta){if(this.started){this.levelStats.time+=delta;var x=this.playerSprite.x;x>0&&x>this.levelStats.distance&&(this.levelStats.distance=x,this.refreshScore())}},game_shell.data.LevelProgress.prototype.reachCheckpoint=function(index,isLast){var isNew=!1;return index>this.levelStats.checkpoint&&(this.levelStats.checkpoint=index,isNew=!0),isLast&&(this.refreshScore(),this.levelStats.isCompleted=!0),isNew},game_shell.data.LevelProgress.prototype.collect=function(type){switch(type){case this.types.COIN:this.levelStats.coins++;break;case this.types.POWERUP_INVINCIBLE:this.levelStats.powerInvincible++}this.refreshScore()},game_shell.data.LevelProgress.prototype.refreshScore=function(){var score=0;score+=this.levelStats.coins*this.coinValue,score+=this.levelStats.kills*this.killValue,score+=Math.floor(this.levelStats.distance*this.distanceValue),this.levelStats.score=score},game_shell.data.LevelProgress.prototype.addTime=function(extraTime){},Object.defineProperty(game_shell.data.LevelProgress.prototype,"time",{get:function(){return this.levelStats.time}}),Object.defineProperty(game_shell.data.LevelProgress.prototype,"stars",{get:function(){return this.levelStats.stars}}),Object.defineProperty(game_shell.data.LevelProgress.prototype,"points",{get:function(){return this.levelStats.score}}),Object.defineProperty(game_shell.data.LevelProgress.prototype,"finalScore",{get:function(){return this.levelStats.score}}),Object.defineProperty(game_shell.data.LevelProgress.prototype,"checkpoint",{get:function(){return this.levelStats.checkpoint}}),Object.defineProperty(game_shell.data.LevelProgress.prototype,"isCompleted",{get:function(){return this.levelStats.isCompleted}}),game_shell.data.LevelStats=function(index){this.time=0,this.index=index||0,this.score=0,this.coins=0,this.powerInvincible=0,this.powerFlight=0,this.kills=0,this.distance=0,this.hits=0,this.respawns=0,this.checkpoint=0,this.isCompleted=!1},game_shell.data.LevelStats.prototype.finalScore=function(points){var timePoints=this.time/100;this.score=points+timePoints},game_shell.data.LevelStats.prototype.reset=function(){game_shell.data.LevelStats.call(this,this.index)},game_shell.data.LevelStats.prototype.copyIfBetter=function(levelData){levelData.isCompleted&&(this.isCompleted=!0),levelData.score>this.score&&(this.score=levelData.score),levelData.checkpoint>this.checkpoint&&(this.checkpoint=levelData.checkpoint),levelData.time>this.time&&(this.time=levelData.time)},game_shell.data.LevelStats.prototype.copy=function(levelData){for(var s in levelData)levelData.hasOwnProperty(s)&&(this[s]=levelData[s])},Object.defineProperty(game_shell.data.LevelStats.prototype,"stars",{get:function(){return this.isCompleted?game_shell.gameData.getStars(this.time,this.index,this.respawns):0}}),game_shell.data.SavedResult=function(index,unlocked){this.index=index||0,this.unlocked=unlocked||!1,this.best=new game_shell.data.LevelStats(this.index),this.last=new game_shell.data.LevelStats(this.index)},game_shell.data.SavedResult.prototype.getStars=function(){return this.best.stars},game_shell.data.SavedResult.prototype.save=function(levelData){this.last.copy(levelData),levelData.isCompleted?levelData.score>this.best.score&&this.best.copy(levelData):this.best.copyIfBetter(levelData),this.best.time=Math.floor(this.best.time),this.best.score=Math.floor(this.best.score)},game_shell.screens.SCR_LOAD="load",game_shell.screens.SCR_TITLE="title",game_shell.screens.SCR_GAME="game",game_shell.screens.SCR_FINISH="finish",game_shell.screens.SCR_MENU="menu",game_shell.title={},game_shell.menu={},game_shell.game={},game_shell.physics={},game_shell.game.gameScreens=function(){this.createScreen=function(p_event){var screen,scr=game_shell.screens,screenId="string"==typeof p_event?p_event:p_event.screenId;switch(screenId){case scr.SCR_LOAD:screen=new scr.LoadScreen(p_event);break;case scr.SCR_TITLE:screen=new scr.TitleScreen(p_event);break;case scr.SCR_FINISH:screen=new scr.FinishScreen(p_event);break;case scr.SCR_MENU:screen=new scr.MenuScreen(p_event);break;case scr.SCR_GAME:p_event.spriteData=this.getSpriteData(game_shell.user.levelInfo),screen=new scr.GameScreen(p_event);break;case"test":screen=new scr.TestScreen(p_event)}return screen},this.getSpriteData=function(levelInfo){var spriteData=null,gameData=game_shell.gameData;switch(levelInfo.location){case 0:spriteData=gameData.layout.red_rock_canyon;break;case 1:spriteData=gameData.layout.thieves_market;break;case 2:spriteData=gameData.layout.rooftop}return spriteData},this.getManifestPath=function(screenId){var scr=game_shell.screens,dir=alex.statics.JSON_DIR+"manifests/",file=null;switch(screenId){case scr.SCR_TITLE:case scr.SCR_MENU:file=dir+"title_manifest.json";break;case scr.SCR_GAME:case scr.SCR_FINISH:file=dir+"game_manifest.json";break;case"test":file=dir+"game_manifest.json"}return file},this.addToManifestJSON=function(screenId,jsonData){var sid="string"==typeof screenId?screenId:screenId.screenId,scr=game_shell.screens,resolution=game_shell.resolution,levelInfo=game_shell.user.levelInfo;switch(sid){case scr.SCR_GAME:var location=levelInfo.location,assets=game_shell.gameData.getLocationAssets(location,resolution),targetList=2===resolution?jsonData.json_2x:jsonData.json_1x;this.merge(targetList,assets),assets=game_shell.gameData.getLocationMusic(location),this.merge(jsonData.snd_webaudio,assets),8===levelInfo.index&&jsonData.snd_webaudio.push(game_shell.gameData.assets.end_music),jsonData.json.push({src:levelInfo.src,id:"map"})}},this.merge=function(target,source){var i,n=source.length;for(i=0;n>i;i++)target[target.length]=source[i]}},game_shell.screens.LoadScreen=function(config){alex.screens.ScreenBase.call(this,config)},game_shell.screens.LoadScreen.prototype=Object.create(alex.screens.ScreenBase.prototype),game_shell.screens.LoadScreen.prototype.constructor=game_shell.screens.LoadScreen,game_shell.screens.LoadScreen.prototype.run=function(){var bgImg="loader_background.png",bg=new PIXI.Sprite(PIXI.TextureCache[bgImg]);bg.anchor.x=.5,bg.anchor.y=.5,this.addChild(bg);var frame=new PIXI.Sprite(PIXI.TextureCache["loading_frame.png"]);frame.anchor.x=.5,frame.anchor.y=.5,this.addChild(frame),this.fill=new PIXI.Sprite(PIXI.TextureCache["loadbar_fill.png"]);var w=this.fill.texture.frame.width/this.resolution;this.fill.x=w*-.5,this.fill.anchor.y=.5,this.fill.scale.x=1e-8,this.addChild(this.fill);var self=this;game_shell.loader.on("progress",function(event){self.fill.scale.x=event.value}),game_shell.loader.on("complete",function(){self.fill.scale.x=1,self.newScreen(self.targetScreen)})},game_shell.screens.FinishScreen=function(config){alex.screens.ScreenBase.call(this,config)},game_shell.screens.FinishScreen.prototype=Object.create(alex.screens.ScreenBase.prototype),game_shell.screens.FinishScreen.prototype.constructor=game_shell.screens.FinishScreen,game_shell.screens.FinishScreen.prototype.run=function(){this.createBg(),this.btn=this.createPlayAgain(),this.startPulse(),this.snd.playEndLoop()},game_shell.screens.FinishScreen.prototype.createBg=function(){var img=new PIXI.Sprite(PIXI.TextureCache["end_game.png"]);return img.anchor.x=img.anchor.y=.5,this.addChild(img),img},game_shell.screens.FinishScreen.prototype.createPlayAgain=function(){var btn=new alex.display.Button("result_next_btn.png"),self=this;return btn.on("release",function(){self.snd.stopEndLoop(),self.newScreen("title")}),btn.x=150,btn.y=100,this.addChild(btn),btn},game_shell.screens.FinishScreen.prototype.startPulse=function(){var pulse=new alex.motion.Pulsar;return pulse.init({scale:this.btn.scale,autostart:!0}),this.addUpdateItem(pulse),pulse},game_shell.screens.TitleScreen=function(config){alex.screens.ScreenBase.call(this,config)},game_shell.screens.TitleScreen.prototype=Object.create(alex.screens.ScreenBase.prototype),game_shell.screens.TitleScreen.prototype.constructor=game_shell.screens.TitleScreen,game_shell.screens.TitleScreen.prototype.run=function(){this.titleScene=this.createScene()},game_shell.screens.TitleScreen.prototype.createScene=function(){var scene=new game_shell.title.TitleScene;scene.init({screenW:this.screenW,defaultW:this.defaultW,screenH:this.screenH,snd:this.snd,resolution:this.resolution}),this.addChild(scene.root),this.addUpdateItem(scene.updateList);var self=this;return scene.on("screen",function(event){self.snd.stopTitleLoop(),self.newScreen(event)}),scene},game_shell.screens.TitleScreen.prototype.dispose=function(){this.titleScene.dispose(),alex.screens.ScreenBase.prototype.dispose.call(this)},game_shell.title.TitleScene=function(){},game_shell.title.TitleScene.prototype=Object.create(alex.utils.EventDispatcher.prototype),game_shell.title.TitleScene.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.build(),this.addListeners(),this.playPuss=this._playPuss.bind(this),this.transitionIn(),this.snd.playTitleLoop()},game_shell.title.TitleScene.prototype.transitionIn=function(){var targetY=this.screenH*-.5,self=this;new TWEEN.Tween(this.title).to({y:targetY},700).onComplete(function(){self.thieves.play("anim"),self.pulse.start()}).easing(TWEEN.Easing.Quadratic.Out).start(),this.timeout.delay(this.playPuss,1e3)},game_shell.title.TitleScene.prototype.transitionOut=function(){var targetY=-1.5*this.screenH,self=this,time=700;new TWEEN.Tween(this.title).to({y:targetY},time).easing(TWEEN.Easing.Quadratic.Out).start(),new TWEEN.Tween(this.puss.root).to({y:1.1*this.screenH},.75*time).delay(300).easing(TWEEN.Easing.Quadratic.In).onComplete(function(){self.emit({type:"screen",screenId:"menu"})}).start()},game_shell.title.TitleScene.prototype._playPuss=function(){this.puss.play("talk");var snd=this.snd;this.timeout.delay(function(){snd.play("im_good")},1e3),this.timeout.delay(function(){snd.play("adventure")},6400)},game_shell.title.TitleScene.prototype.addListeners=function(){var self=this;this.startButton.on("release",function(){self.transitionOut()})},game_shell.title.TitleScene.prototype.update=function(delta){dragonBones.animation.WorldClock.clock.advanceTime(delta/1e3),this.timeout.update(delta)},game_shell.title.TitleScene.prototype.build=function(){var builder=new game_shell.title.TitleBuilder;return builder.init({scene:this,resolution:this.resolution,screenW:this.screenW,screenH:this.screenH}),builder},game_shell.title.TitleScene.prototype.dispose=function(){this.puss.dispose(),this.thieves.dispose()},game_shell.title.TitleScene.prototype.showHelp=function(){this.enable(!1)},game_shell.title.TitleScene.prototype.enable=function(bool){this.startButton.enabled=bool,bool?this.pulse.start():this.pulse.stop()},game_shell.title.TitleBuilder=function(){this.scene=null,this.root=null,this.timeout=null,this.defaultW=0,this.screenW=0,this.screenH=0,this.resolution=1},game_shell.title.TitleBuilder.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.root=this.scene.root=new PIXI.DisplayObjectContainer,this.scene.timeout=this.timeout=new alex.utils.DelayedAction,this.scene.updateList=this.updateList=new alex.utils.UpdateList,this.updateList.add(this.scene),this.scene.background=this.createBackground(),this.scene.thieves=this.createThieves(),this.scene.title=this.createTitle(),this.scene.puss=this.createPuss(),this.scene.startButton=this.createStartButton(),this.scene.pulse=this.createPulse(),this.addCopyright()},game_shell.title.TitleBuilder.prototype.addCopyright=function(){var copyright=new PIXI.Sprite(PIXI.TextureCache["copyright.png"]);copyright.anchor.x=1,copyright.anchor.y=1,copyright.x=.5*this.screenW-5,copyright.y=.5*this.screenH-5,this.root.addChild(copyright)},game_shell.title.TitleBuilder.prototype.createTitle=function(){var tx=PIXI.TextureCache["game_title.png"],h=tx.frame.height/this.resolution,title=new PIXI.Sprite(tx);return title.y=this.screenH*-.5-h,title.x=-240,this.root.addChild(title),title},game_shell.title.TitleBuilder.prototype.createPulse=function(){var pulse=new alex.motion.Pulsar;return pulse.init({scale:this.scene.startButton.scale,autostart:!1}),this.updateList.add(pulse),pulse},game_shell.title.TitleBuilder.prototype.createBackground=function(){var background=new PIXI.Sprite(PIXI.TextureCache["title_background.png"]);return background.anchor.x=background.anchor.y=.5,this.root.addChild(background),background},game_shell.title.TitleBuilder.prototype.createThieves=function(){var armatureData={armatureName:"start_screen_DB",skeletonId:"start_screen_DB",skeletonJSON:game_shell.json.thief_title,atlasJson:game_shell.json.title,animationId:"anim",partsList:["thief1.png","thief2.png","thief3.png","thief4.png"]},thieves=new dragonBones.BonesSprite;return thieves.init({armatureData:armatureData,x:0,y:0}),this.root.addChild(thieves.root),thieves},game_shell.title.TitleBuilder.prototype.createPuss=function(delay){var armatureData={armatureName:"puss_title",skeletonId:"puss_title",skeletonJSON:game_shell.json.puss_title,atlasJson:game_shell.json.title,animationId:"idle",partsList:["puss_forearm_R2.png","puss_lids1.png","puss_lids2.png","puss_title_body.png","puss_title_eyes.png","puss_title_face.png","puss_title_forearm_L.png","puss_title_forearm_L2.png","puss_title_forearm_R.png","puss_title_jaw.png","puss_title_mouth.png","puss_title_plume.png","puss_title_pupil1.png","puss_title_pupil2.png","puss_title_upperArm_L1.png","puss_title_upperArm_R.png"]},puss=new dragonBones.BonesSprite;return puss.init({armatureData:armatureData,x:0,y:0}),puss.on("complete",function(event){"talk"==event.timeline&&puss.play("idle")}),this.root.addChild(puss.root),puss},game_shell.title.TitleBuilder.prototype.createStartButton=function(){var btn=new alex.display.Button("play_btn.png");return btn.x=115,btn.y=255,this.scene.title.addChild(btn),btn},game_shell.title.TitleBuilder.prototype.createHelpButton=function(){},game_shell.screens.MenuScreen=function(config){alex.screens.ScreenBase.call(this,config)},game_shell.screens.MenuScreen.prototype=Object.create(alex.screens.ScreenBase.prototype),game_shell.screens.MenuScreen.prototype.constructor=game_shell.screens.MenuScreen,game_shell.screens.MenuScreen.prototype.run=function(){this.menu=this.createScene(),this.initEvents()},game_shell.screens.MenuScreen.prototype.createScene=function(){var scene=new game_shell.menu.MenuScene;return scene.init({screenW:this.screenW,defaultW:this.defaultW,screenH:this.screenH,user:game_shell.user,snd:this.snd,levelData:game_shell.gameData.levels,cheat:game_shell.config.CHEAT_UNLOCK,eventQueue:this.eventQueue,resolution:this.resolution}),this.addChild(scene.root),this.addUpdateItem(scene),scene},game_shell.screens.MenuScreen.prototype.initEvents=function(){var self=this;this.menu.bus.on("select",function(event){self.snd.play("select"),game_shell.user.levelInfo=event.levelInfo,self.newScreen("game")})},game_shell.menu.MenuScene=function(){},game_shell.menu.MenuScene.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.build()},game_shell.menu.MenuScene.prototype.update=function(delta){dragonBones.animation.WorldClock.clock.advanceTime(delta/1e3),this.updateList.update(delta)},game_shell.menu.MenuScene.prototype.build=function(){var builder=new game_shell.menu.MenuBuilder;return builder.init({menu:this,user:this.user,levelData:this.levelData,snd:this.snd,resolution:this.resolution,screenW:this.screenW,defaultW:this.defaultW,screenH:this.screenH}),builder},game_shell.menu.MenuBuilder=function(){this.menu=null,this.root=null,this.bus=null,this.timeout=null,this.defaultW=0,this.screenW=0,this.screenH=0,this.resolution=1},game_shell.menu.MenuBuilder.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.root=this.menu.root=new PIXI.DisplayObjectContainer,this.timeout=this.menu.timeout=new alex.utils.DelayedAction,this.updateList=this.menu.updateList=new alex.utils.UpdateList,this.menu.bus=new alex.utils.EventDispatcher,this.menu.background=this.createBackground(),this.menu.carousel=this.createCarousel(),this.menu.panels=this.createPanels(),this.createChevrons()},game_shell.menu.MenuBuilder.prototype.createPanels=function(){var panel0X,panel1X,panel2X,w=this.defaultW,x1=-1*w,x2=x1+w,x3=x2+w,index=this.user.levelInfo.index,difficultyGroup=Math.floor(index/3);switch(difficultyGroup){case 0:panel0X=x2,panel1X=x3,panel2X=x1;break;case 1:panel0X=x1,panel1X=x2,panel2X=x3;break;case 2:panel0X=x3,panel1X=x1,panel2X=x2}var easy=[this.levelData[0],this.levelData[1],this.levelData[2]],medium=[this.levelData[3],this.levelData[4],this.levelData[5]],hard=[this.levelData[6],this.levelData[7],this.levelData[8]],panels=[];return panels[0]=this.createMenuPanel(easy,panel0X,0),panels[1]=this.createMenuPanel(medium,panel1X,1),panels[2]=this.createMenuPanel(hard,panel2X,2),panels},game_shell.menu.MenuBuilder.prototype.createChevrons=function(){this.leftChevron=this.createChevron("btn_previous_level_menu.png",this.screenW*-.5),this.rightChevron=this.createChevron("btn_next_level_menu.png",.5*this.screenW)},game_shell.menu.MenuBuilder.prototype.createChevron=function(txId,x){var chevron=new alex.display.Button(txId);chevron.x=x;var targetX=x>0?x-40:x+40;new TWEEN.Tween(chevron).to({x:targetX},250).start(),this.root.addChild(chevron);var carousel=this.menu.carousel,direction=x>0?-1:1,snd=this.snd;return chevron.on("release",function(){carousel.start(direction),snd.play("page_turn")}),chevron},game_shell.menu.MenuBuilder.prototype.createMenuPanel=function(data,x,difficulty){var panel=new game_shell.menu.MenuPanel;return panel.init({data:data,difficulty:difficulty,bus:this.menu.bus,cheat:this.cheat,progress:this.user.progress,resolution:this.resolution,screenW:this.screenW,screenH:this.screenH}),panel.root.x=x,this.root.addChild(panel.root),this.menu.carousel.add(panel),panel},game_shell.menu.MenuBuilder.prototype.createBackground=function(){var background=new PIXI.Sprite(PIXI.TextureCache["menu_background.png"]);return background.anchor.x=background.anchor.y=.5,this.root.addChild(background),background},game_shell.menu.MenuBuilder.prototype.createCarousel=function(){var carousel=new game_shell.ui.CarouselMove;return carousel.init({itemW:this.defaultW}),carousel},game_shell.menu.MenuPanel=function(){this.data=null,this.bus=null,this.cheat=!1,this.difficulty=0},game_shell.menu.MenuPanel.prototype=Object.create(alex.utils.EventDispatcher.prototype),game_shell.menu.MenuPanel.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.root=new PIXI.DisplayObjectContainer;var tracks=this.data;this.panel1=this.createPanel(-150,tracks[0]),this.panel2=this.createPanel(0,tracks[1]),this.panel3=this.createPanel(150,tracks[2]),this.createTitle()},game_shell.menu.MenuPanel.prototype.enable=function(bool){this.panel1.enable(bool),this.panel2.enable(bool),this.panel3.enable(bool)},game_shell.menu.MenuPanel.prototype.createTitle=function(){var tx;switch(this.difficulty){case 0:tx=PIXI.TextureCache["select_easy.png"];break;case 1:tx=PIXI.TextureCache["select_medium.png"];break;case 2:tx=PIXI.TextureCache["select_hard.png"]}var title=new PIXI.Sprite(tx);return title.anchor.x=.5,title.y=this.screenH*-.5+20,this.root.addChild(title),title},game_shell.menu.MenuPanel.prototype.createPanel=function(x,trackData){var panel=new game_shell.menu.LevelPanel,index=trackData.index,resultData=this.progress.getResultByIndex(index+1);return panel.init({index:index,difficulty:this.difficulty,cheat:this.cheat,resolution:this.resolution,bus:this.bus,resultData:resultData,levelInfo:trackData}),panel.root.x=x,this.root.addChild(panel.root),panel},game_shell.menu.LevelPanel=function(){this.root=null,this.bus=null,this.index=-1,this.resolution=1,this.difficulty=0,this.levelInfo=null,this.resultData=null,this.cheat=!1,this.font="clare_bold",this.eventSelect={type:"select",levelInfo:null}},game_shell.menu.LevelPanel.prototype=Object.create(alex.utils.EventDispatcher.prototype),game_shell.menu.LevelPanel.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.root=new PIXI.DisplayObjectContainer,this.eventSelect.levelInfo=this.levelInfo,this.button=this.createPanel(),this.createField(this.resultData.best.score,70),this.createField(this.resultData.last.score,95),this.createStars();var isLocked=!this.resultData.unlocked&&!this.cheat;isLocked?this.createLocked():(this.addListeners(),this.enable(!0)),this.createIndex()},game_shell.menu.LevelPanel.prototype.enable=function(bool){this.button.interactive=this.button.buttonMode=bool&&(this.resultData.unlocked||this.cheat)},game_shell.menu.LevelPanel.prototype.addListeners=function(){var pressed=!1,self=this;this.button.mousedown=this.button.touchstart=function(){pressed=!0},this.button.mouseup=this.button.touchend=function(){pressed&&self.bus.emit(self.eventSelect)},this.button.mouseupoutside=this.button.touchendoutside=function(){pressed=!1},this.button.hitArea=new PIXI.Rectangle(0,0,140,240)},game_shell.menu.LevelPanel.prototype.createLocked=function(){var locked=new PIXI.Sprite(PIXI.TextureCache["locked_panel.png"]);return locked.anchor.x=locked.anchor.y=.5,locked.x=0,locked.y=24,this.root.addChild(locked),locked},game_shell.menu.LevelPanel.prototype.createStars=function(){var numStars=this.resultData.best.stars;numStars>=1&&this.createStar(-38),numStars>=2&&this.createStar(1),numStars>=3&&this.createStar(39)},game_shell.menu.LevelPanel.prototype.createStar=function(x){var star=new PIXI.Sprite(PIXI.TextureCache["level_star.png"]);return star.anchor.x=star.anchor.y=.5,star.x=x,star.y=46,this.root.addChild(star),star},game_shell.menu.LevelPanel.prototype.createPanel=function(){var tx;switch(this.levelInfo.location){case 0:tx=PIXI.TextureCache["panel_canyon.png"];break;case 1:tx=PIXI.TextureCache["panel_market.png"];break;case 2:tx=PIXI.TextureCache["panel_rooftop.png"]}var panelSprite=new PIXI.Sprite(tx),w=tx.frame.width/this.resolution;tx.frame.height/this.resolution;return panelSprite.x=w*-.5,panelSprite.y=-85,this.root.addChild(panelSprite),panelSprite},game_shell.menu.LevelPanel.prototype.createIndex=function(){var s,index=this.index+1;s=10>index?"0"+index+".png":index.toString()+".png";var tx=PIXI.TextureCache[s],indexSprite=new PIXI.Sprite(tx);return indexSprite.anchor.x=.5,indexSprite.anchor.y=.5,indexSprite.y=-85,this.root.addChild(indexSprite),indexSprite},game_shell.menu.LevelPanel.prototype.createField=function(value,y){var pt=18*this.resolution,style={font:pt.toString()+"pt "+this.font},s=this.scoreString(Math.floor(value)),field=new PIXI.BitmapText(s,style);return field.scale.x=field.scale.y=1/this.resolution,field.y=y,field.updateText(),field.x=field.width*-.5+15,
this.root.addChild(field),field},game_shell.menu.LevelPanel.prototype.scoreString=function(score){var s,num=score.toString();return s=10>score?"00000"+num:100>score?"0000"+num:1e3>score?"000"+num:1e4>score?"00"+num:1e5>score?"0"+num:num},game_shell.ui.CarouselMove=function(){this.items=[],this._x=0,this.isMoving=!1,this.minX=0,this.maxX=0,this.draggedX=0,this.duration=333,alex.utils.EventDispatcher.prototype.apply(this)},game_shell.ui.CarouselMove.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.evtStart={type:"start",sign:0,itemW:this.itemW,x:0,dist:0},this.evtComplete={type:"complete",focus:null},this.createTween()},game_shell.ui.CarouselMove.prototype.createTween=function(){this.tween=new TWEEN.Tween(this);var self=this;this.tween.onStart(function(){self.tweenStart(self.sign)}),this.tween.onComplete(function(){self.moveComplete.call(self)})},game_shell.ui.CarouselMove.prototype.start=function(sign){if(!this.isMoving){var start=this.draggedX/this.itemW,amount=0>start?1+start:1-start,duration=this.duration*amount;this._x=start,this.draggedX=0,this.isMoving=!0,this.sign=sign,this.tween.to({x:sign},duration).start()}},game_shell.ui.CarouselMove.prototype.toNearest=function(){if(!this.isMoving){var sign=0,start=this.draggedX/this.itemW,amount=0>start?1+start:1-start,duration=this.duration*amount,absDrag=this.draggedX>0?this.draggedX:-this.draggedX;sign=absDrag>.5*this.itemW?this.draggedX>0?1:-1:0,this.draggedX=0,this.isMoving=!0,this._x=start,this.sign=sign,this.tween.to({x:sign},duration).start()}},game_shell.ui.CarouselMove.prototype.tweenStart=function(sign){var dist,x=this._x*this.itemW;if(sign>0)dist=this.itemW-x;else if(0>sign)dist=0-(this.itemW+x);else{var half=this.itemW/2;dist=x>0?x>half?this.itemW-x:-x:-half>x?0-(this.itemW+x):-x}this.evtStart.dist=dist,this.evtStart.x=this._x,this.evtStart.sign=sign,this.emit(this.evtStart)},game_shell.ui.CarouselMove.prototype.moveStart=function(){var i,item,n=this.items.length;for(i=0;n>i;i++)item=this.items[i],item.start=item.root.x},game_shell.ui.CarouselMove.prototype.moveComplete=function(){this.isMoving=!1;var item=null;this.sign>0?(item=this.findRightmost(),item.root.x=this.minX):this.sign<0&&(item=this.findLeftmost(),item.root.x=this.maxX),this.moveStart(),this.evtComplete.focus=this.findFocus(),this.emit(this.evtComplete)},game_shell.ui.CarouselMove.prototype.findRightmost=function(){var i,item,rightmost=this.items[0],n=this.items.length;for(i=1;n>i;i++)item=this.items[i],item.root.x>rightmost.root.x&&(rightmost=item);return rightmost},game_shell.ui.CarouselMove.prototype.findLeftmost=function(){var i,item,leftmost=this.items[0],n=this.items.length;for(i=1;n>i;i++)item=this.items[i],item.root.x<leftmost.root.x&&(leftmost=item);return leftmost},game_shell.ui.CarouselMove.prototype.findFocus=function(){var i,item,x,center=this.items[0],n=this.items.length;for(i=1;n>i;i++)item=this.items[i],x=item.root.x,0>x&&(x=-x),x<Math.abs(center.root.x)&&(center=item);return center},game_shell.ui.CarouselMove.prototype.add=function(item){var x=item.root.x,index=this.items.length;this.items[index]={start:x,index:index,itemW:this.itemW,item:item,root:item.root},x<this.minX?this.minX=x:x>this.maxX&&(this.maxX=x),this.moveStart()},game_shell.ui.CarouselMove.prototype.dragItems=function(distance){this.draggedX+=distance;var i,wrapper,amount,n=this.items.length;for(i=0;n>i;i++)wrapper=this.items[i],wrapper.root.x+=distance,amount=this.draggedX/this.itemW},game_shell.ui.CarouselMove.prototype.moveItems=function(amount){var i,wrapper,n=this.items.length;for(i=0;n>i;i++)wrapper=this.items[i],wrapper.root.x=wrapper.start+amount*this.itemW},Object.defineProperty(game_shell.ui.CarouselMove.prototype,"x",{get:function(){return this._x},set:function(value){this._x=value,this.moveItems(this._x)}}),game_shell.screens.GameScreen=function(config){this.spriteData=null,alex.screens.ScreenBase.call(this,config)},game_shell.screens.GameScreen.prototype=Object.create(alex.screens.ScreenBase.prototype),game_shell.screens.GameScreen.prototype.constructor=game_shell.screens.GameScreen,game_shell.screens.GameScreen.prototype.run=function(){void 0!==game_shell.config.DEBUG_SCALE&&(this.scale.x=this.scale.y=game_shell.config.DEBUG_SCALE),this.gameScene=this.createScene(),this.addListeners(),this.snd.playGameIntro()},game_shell.screens.GameScreen.prototype.addListeners=function(){var gameBus=this.gameScene.gameBus,self=this;gameBus.on("next",function(){self.nextLevel()}),gameBus.on("menu",function(){self.newScreen("menu")}),gameBus.on("quit",function(){self.snd.pause(!1),self.newScreen("title")})},game_shell.screens.GameScreen.prototype.nextLevel=function(){this.eventQueue.queueEvent({type:"next_level"})},game_shell.screens.GameScreen.prototype.createScene=function(){var scene=new game_shell.game.GameScene,mapData=game_shell.json.map;return scene.init({screenW:this.screenW,defaultW:this.defaultW,screenH:this.screenH,snd:this.snd,gameData:game_shell.gameData,user:game_shell.user,mapData:mapData,isMobile:game_shell.system.isMobile,spriteData:this.spriteData,resolution:this.resolution}),this.addChild(scene.root),this.addUpdateItem(scene),scene},game_shell.screens.GameScreen.prototype.dispose=function(){this.gameScene.dispose(),this.snd.stopGameMusic(),alex.screens.ScreenBase.prototype.dispose.call(this)},game_shell.game.PowerupTypes={INVINCIBILITY:1,FLIGHT:2,COIN_MAGNET:3,TIME:4},game_shell.game.GameScene=function(){this.spriteData=null,this.levelIndex=1,this.levelProgress=null,this.mapData=null,this.gameData=null,this.types=game_shell.physics.BodyTypes,this.powerTypes=game_shell.game.PowerupTypes,this.worldTime=1e3,this.isPaused=!1},game_shell.game.GameScene.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.levelIndex=this.user.levelInfo.index+1,this.buildScene(),this.buildUI(),this.buildMap(),this.addListeners(),this.gameLoop.drawGameObjects(0),this.gameLoop.postUpdate(0),this.showPromptPanels()},game_shell.game.GameScene.prototype.showPromptPanels=function(){game_shell.config.SKIP_PROMPT?this.startCountDown():this.promptPanel.start()},game_shell.game.GameScene.prototype._startCountDown=function(){if(game_shell.config.CHEAT_START>0)this._start();else{this.countdown.start(this.updateList),this.startFlag.play("in");var levelInfo=this.user.levelInfo;switch(levelInfo.location){case 1:this.snd.play("mayor");break;case 0:this.snd.play("mayor_canyon");break;case 2:this.snd.play("mayor_rooftop")}}},game_shell.game.GameScene.prototype._start=function(){this.snd.playWithDelay("barrel_smash",650),this.startFlag.start(),this.monster.start(),this.player.start(),this.obstacleController.start(),this.gameLoop.start(),this.levelProgress.start(),this.input.enable(!0),this.pauseButton.visible=!0},game_shell.game.GameScene.prototype.addListeners=function(){this.start=this._start.bind(this),this.startCountDown=this._startCountDown.bind(this),this.collectCoin=this._collectCoin.bind(this),this.collectPowerup=this._collectPowerup.bind(this),this.reachCheckpoint=this._reachCheckpoint.bind(this),this.motionDie=this._motionDie.bind(this),this.togglePause=this._togglePause.bind(this),this.destroyObstacle=this._destroyObstacle.bind(this),this.gameBus.on("pause",this.togglePause),this.gameBus.on("jump",this.player.jump),this.gameBus.on(this.player.eventDead.type,this.respawnController.respawn),this.gameBus.on("motion_die",this.motionDie),this.gameBus.on("prompt_complete",this.startCountDown),this.gameBus.on(this.countdown.eventComplete.type,this.start),this.player.events.on(this.player.eventCoin.type,this.collectCoin),this.player.events.on(this.player.eventPowerup.type,this.collectPowerup),this.player.events.on(this.player.eventCheckpoint.type,this.reachCheckpoint),this.player.events.on(this.player.eventInvincible.type,this.destroyObstacle);var snd=this.snd;this.gameBus.on("power_end",function(){snd.play("power_end")})},game_shell.game.GameScene.prototype._togglePause=function(){this.isPaused=!this.isPaused,console.log("gameBus - pause: "+this.isPaused),this.snd.pause(this.isPaused),this.isPaused?(this.uiLayer.addChild(this.pausePanel.root),this.pausePanel.show()):this.pauseButton.enabled=!0},game_shell.game.GameScene.prototype._reachCheckpoint=function(event){var index=event.index,isLast=event.isLast;if(console.log("_reachCheckpoint "+index+" isLast: "+isLast),isLast)this.levelProgress.reachCheckpoint(index,!0),console.log("YOU WIN!!!"),this.levelComplete();else{this.levelProgress.reachCheckpoint(index,!1)}},game_shell.game.GameScene.prototype._collectPowerup=function(event){var pt=event.pt;event.pt=null;var power=event.power;switch(this.particles.burst(pt),this.levelProgress.collect(power),console.log("_collectPowerup: "+power),power){case this.powerTypes.INVINCIBILITY:this.powerupController.getInvincibility(),this.snd.playWithDelay("vo_come_on",700);break;case this.powerTypes.FLIGHT:this.powerupController.getFlight(),this.player.activateFlight(),this.snd.playWithDelay("vo_i_am_puss",700)}this.snd.play("powerup")},game_shell.game.GameScene.prototype._motionDie=function(){this.monster.attack();var player=this.player;this.timeout.delay(function(){player.die()},500)},game_shell.game.GameScene.prototype._destroyObstacle=function(event){this.spritePinger.hitItem(event),this.levelProgress.destroyObstacle(),this.snd.play("hit_hazard_1")},game_shell.game.GameScene.prototype._collectCoin=function(event){var pt=event.pt;event.pt=null,this.particles.burst(pt),this.levelProgress.collect(this.types.COIN),this.snd.play("coin",.5)},game_shell.game.GameScene.prototype.levelComplete=function(){this.levelProgress.levelComplete(),this.user.saveResult(this.levelProgress.levelStats),this.camera.tracking={x:this.player.graphics.x,y:this.player.graphics.y},new TWEEN.Tween(this.camera.tracking).to({y:this.camera.maxY},500).easing(TWEEN.Easing.Quadratic.Out).start(),this.player.motionTracker.stop(),this.obstacleController.stop(),this.snd.play("yay"),this.snd.playWithDelay("cheer",700,.5),this.snd.stopGameMusic();var self=this;this.timeout.delay(function(){self.pussEndVox.call(self)},1500);var resultDelay=4e3;2===this.user.levelInfo.location&&(resultDelay=6e3),this.timeout.delay(function(){self.showResult()},resultDelay)},game_shell.game.GameScene.prototype.pussEndVox=function(){var levelInfo=this.user.levelInfo;switch(levelInfo.location){case 1:this.snd.play("puss_end_1");break;case 0:this.snd.play("puss_end_2");break;case 2:this.snd.play("puss_end_3")}},game_shell.game.GameScene.prototype.showResult=function(){this.pauseButton.visible=!1,this.uiLayer.addChild(this.resultPanel.root),this.resultPanel.show(),this.updateList.add(this.resultPanel.particles),this.snd.play("fanfare")},game_shell.game.GameScene.prototype.buildScene=function(){var builder=new game_shell.game.GameBuilder;return builder.init({scene:this,snd:this.snd,spriteData:this.spriteData,gameData:this.gameData,isMobile:this.isMobile,levelIndex:this.levelIndex,resolution:this.resolution,defaultW:this.defaultW,screenW:this.screenW,screenH:this.screenH}),builder},game_shell.game.GameScene.prototype.buildMap=function(){var builder=new game_shell.game.MapBuilder;return builder.init({platforms:this.platformLayer,obstacles:this.obstacleLayer,parallax2:this.parallax2Layer,parallax1:this.parallax1Layer,resolution:this.resolution,levelIndex:this.levelIndex,scene:this,snd:this.snd,mapData:this.mapData,gameBus:this.gameBus,screenW:this.screenW,screenH:this.screenH}),this.parallax.addScenery(builder.sceneryItems),builder},game_shell.game.GameScene.prototype.buildUI=function(){var builder=new game_shell.ui.UIBuilder;return builder.init({resolution:this.resolution,isMobile:this.isMobile,snd:this.snd,user:this.user,screenW:this.screenW,defaultW:this.defaultW,screenH:this.screenH,root:this.root,uiLayer:this.uiLayer,levelIndex:this.levelIndex,updateList:this.updateList,scene:this,timeout:this.timeout}),builder},game_shell.game.GameScene.prototype.dispose=function(){this.player.dispose(),this.player=null},game_shell.game.GameScene.prototype.update=function(delta){this.isPaused||(dragonBones.animation.WorldClock.clock.advanceTime(delta/1e3),this.world.step(delta/this.worldTime),this.updateList.update(delta),this.levelProgress.update(delta),this.timeField.update(delta),this.powerupController.update(delta),this.obstacleController.update(delta),this.scoreField.setScore(this.levelProgress.points),this.timeout.update(delta)),this.gameBus.update(delta)},game_shell.game.GameBuilder=function(){this.scene=null,this.root=null,this.spriteData=null,this.gameData=null,this.timeout=null,this.isMobile=!1,this.defaultW=0,this.screenW=0,this.screenH=0,this.resolution=1},game_shell.game.GameBuilder.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.root=this.scene.root=new PIXI.DisplayObjectContainer,this.scene.timeout=this.timeout=new alex.utils.DelayedAction,this.scene.updateList=this.updateList=new alex.utils.UpdateList,this.scene.gameBus=new alex.utils.EventQueue,this.scene.sky=this.createSky(),this.scene.mapLayer=this.createMapLayer(),this.scene.parallax2Layer=this.createNestedLayer(),this.scene.parallax1Layer=this.createNestedLayer(),this.scene.obstacleLayer=this.createNestedLayer(),this.scene.platformLayer=this.createNestedLayer(),this.scene.uiLayer=this.createUILayer(),this.scene.spritePinger=this.createSpritePinger(),this.scene.camera=this.createCamera(),this.scene.input=this.createUserInput(),this.scene.parallax=this.createParallax(),this.scene.monster=this.createMonster(),this.scene.hitTracker=this.createHitTracker(),this.scene.levelProgress=this.createLevelProgress(),this.scene.particles=this.createParticles(),this.scene.levelReset=this.createLevelReset()},game_shell.game.GameBuilder.prototype.createUILayer=function(){var uiLayer=new PIXI.DisplayObjectContainer;return this.root.addChild(uiLayer),uiLayer},game_shell.game.GameBuilder.prototype.createLevelReset=function(){var levelReset=new game_shell.game.LevelReset;return levelReset.init({scene:this.scene,gameBus:this.scene.gameBus}),levelReset},game_shell.game.GameBuilder.prototype.createSpritePinger=function(){var spritePinger=new game_shell.game.SpritePinger;return spritePinger.init({screenW:this.screenW,defaultW:this.defaultW,screenH:this.screenH,uiLayer:this.scene.uiLayer,resolution:this.resolution}),this.scene.obstacleLayer.addChild(spritePinger.root),spritePinger},game_shell.game.GameBuilder.prototype.createParticles=function(){var tx=PIXI.TextureCache["star_particle.png"],particles=new game_shell.game.ParticleBase,particleHolder=new PIXI.DisplayObjectContainer;return this.scene.obstacleLayer.addChildAt(particleHolder,0),particles.init({texture:tx,root:particleHolder,resolution:this.resolution}),this.updateList.add(particles),particles},game_shell.game.GameBuilder.prototype.createParallax=function(){var parallax=new game_shell.game.Parallax;return parallax.init({resolution:this.resolution,camera:this.scene.camera,mapLayer:this.scene.mapLayer,parallax1:this.scene.parallax1Layer,parallax2:this.scene.parallax2Layer}),parallax.update(0),this.updateList.add(parallax),parallax},game_shell.game.GameBuilder.prototype.createMapLayer=function(){var mapLayer=new PIXI.DisplayObjectContainer;return mapLayer.y=.5*this.screenH,this.root.addChild(mapLayer),mapLayer},game_shell.game.GameBuilder.prototype.createUserInput=function(){var userInput=new game_shell.game.UserInput,isMobile=this.isMobile,display=null;return isMobile&&(display=new alex.display.Quad(this.screenW,this.screenH),display.x=this.screenW*-.5,display.y=this.screenH*-.5,this.root.addChildAt(display,0)),userInput.init({isMobile:isMobile,display:display,gameBus:this.scene.gameBus}),userInput},game_shell.game.GameBuilder.prototype.createNestedLayer=function(){var layer=new PIXI.DisplayObjectContainer;return this.scene.mapLayer.addChild(layer),layer},game_shell.game.GameBuilder.prototype.createCamera=function(){var camera=new alex.game.Camera,target={x:0},max=2e4,maxTrackV=400,moveY=!0,maxY=this.screenH*-.5,minY=maxY-maxTrackV,trackX=this.gameData.cameraTrackX||150;return camera.init({scene:this.scene.mapLayer,tracking:target,trackX:trackX,moveY:moveY,minY:minY,maxY:maxY,resolution:this.resolution,bgW:max,screenW:this.screenW,screenH:this.screenH}),this.updateList.add(camera),camera.update(0),camera},alex.game.Camera.prototype._frameCheckRect=function(rect){var obj1R=rect.x+rect.width,obj2R=this.viewport.x+this.viewport.width;return obj1R>this.viewport.x&&rect.x<obj2R},game_shell.game.GameBuilder.prototype.createMonster=function(){var monster=new game_shell.game.Monster;return monster.init({screenW:this.screenW,timeout:this.timeout,snd:this.snd,resolution:this.resolution}),this.updateList.add(monster),this.root.addChild(monster.sprite),monster},game_shell.game.GameBuilder.prototype.createHitTracker=function(){var hitTracker=new game_shell.game.HitTracker,timeout=5e3;return game_shell.gameData.monsterTimeout&&(timeout=1e3*game_shell.gameData.monsterTimeout),hitTracker.init({gameBus:this.scene.gameBus,resetTime:timeout,monster:this.scene.monster}),this.updateList.add(hitTracker),hitTracker},game_shell.game.GameBuilder.prototype.createSky=function(){var sky=new PIXI.Sprite(PIXI.TextureCache[this.spriteData.sky]);return sky.anchor.x=sky.anchor.y=.5,this.root.addChild(sky),sky},game_shell.game.GameBuilder.prototype.createLevelProgress=function(){var levelProgress=new game_shell.data.LevelProgress;return levelProgress.init({levelIndex:this.levelIndex,gameData:game_shell.gameData,gameBus:this.scene.gameBus}),levelProgress},game_shell.game.MapBuilder=function(){this.platforms=null,this.obstacles=null,this.parallax1=null,this.parallax2=null,this.snd=null,this.world=null,this.gameLoop=null,this.gameBus=null,this.sceneryItems=[],this.resetItems=[],this.spawnPoints=[],this.levelIndex=1,this.resolution=1,this.gravity=-10,this.physicsScale=game_shell.physics.SCALE},game_shell.game.MapBuilder.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.scene.world=this.world=this.createWorld(),this.scene.gameLoop=this.gameLoop=this.createGameLoop(),this.scene.obstacleController=this.createObstacleController(),this.parse(config.mapData),this.scene.player=this.createPlayer(),this.scene.respawnController=this.createRespawnController()},game_shell.game.MapBuilder.prototype.parse=function(map){this.parseList(map.platforms),this.parseList(map.spawn),this.parseList(map.collectibles),this.parseList(map.obstacles),this.createCheckPoints(map.checkpoints),this.createScenery(map.parallax1,this.parallax1),this.createScenery(map.parallax2,this.parallax2)},game_shell.game.MapBuilder.prototype.parseList=function(objects){var i,n=objects.length;for(i=0;n>i;i++)this.createPhysicsItem(objects[i])},game_shell.game.MapBuilder.prototype.createPhysicsItem=function(objData){var type=objData.type,types=game_shell.physics.BodyTypes;objData.resolution=this.resolution;var physicsItem=null;switch(type){case types.RECTANGLE_ROCK:physicsItem=this.createObject(game_shell.physics.RectangleRock,objData),objData.image||physicsItem.graphics.removeFromParent();break;case types.FALLING_PLATFORM:physicsItem=this.createObject(game_shell.physics.FallingPlatform,objData),this.resetItems[this.resetItems.length]=physicsItem;break;case types.CHECK_POINT:physicsItem=objData.isLast?this.createObject(game_shell.physics.FinishLine,objData,this.obstacles):this.createObject(game_shell.physics.Checkpoint,objData,this.obstacles);break;case types.COIN:case types.POWERUP_INVINCIBLE:case types.POWERUP_FLIGHT:physicsItem=this.createObject(game_shell.physics.Collectible,objData),type!==types.COIN&&(this.resetItems[this.resetItems.length]=physicsItem);break;case types.ROLLING_BARREL:this.addSpawnPt(objData);break;case types.SCENERY:this.createObject(game_shell.physics.Scenery,objData);break;case types.SCENERY_BACKGROUND:this.createObject(game_shell.physics.Scenery,objData,this.obstacles);break;case types.OBSTACLE:objData.snd=this.snd,physicsItem=this.createObstacle(objData),physicsItem.adjustPivot(),this.scene.obstacleController.add(physicsItem)}return physicsItem&&type!==types.FALLING_PLATFORM&&(physicsItem.needsDraw=!1),physicsItem},game_shell.game.MapBuilder.prototype.createObject=function(TypeClass,config,parent){var obj=new TypeClass;return obj.init(config),parent||(parent=this.platforms),parent.addChild(obj.graphics),config.type!==game_shell.physics.BodyTypes.SCENERY&&(this.world.addBody(obj.body),obj.uid=this.gameLoop.add(obj)),obj.draw(!0),obj},game_shell.game.MapBuilder.prototype.createObstacle=function(data){return this.createObject(game_shell.physics.Obstacle,data,this.obstacles)},game_shell.game.MapBuilder.prototype.createObstacleController=function(){var obstacleController=new game_shell.game.ObstacleController;return obstacleController.init({camera:this.scene.camera}),obstacleController},game_shell.game.MapBuilder.prototype.createScenery=function(list,parent){var data,i,n=list.length;for(i=0;n>i;i++)data=list[i],this.sceneryItems[this.sceneryItems.length]=this.createSceneryItem(data,parent)},game_shell.game.MapBuilder.prototype.createSceneryItem=function(data,parent){data.resolution=this.resolution;var sceneryItem=new game_shell.game.BackgroundItem;return sceneryItem.init(data),parent.addChild(sceneryItem.sprite),sceneryItem},game_shell.game.MapBuilder.prototype.addSpawnPt=function(objData){this.spawnPoints[this.spawnPoints.length]={x:objData.x,y:objData.y}},game_shell.game.MapBuilder.prototype.createCheckPoints=function(list){var i,item,n=list.length;for(i=0;n>i;i++)item=list[i],item.index=i;item.isLast=!0;var pt={x:-list[0].x,y:-list[0].y};for(this.scene.startFlag=this.createCheckPoint(pt,game_shell.game.StartFlag),this.scene.checkpoints=[],i=1;n>i;i++)this.scene.checkpoints[this.scene.checkpoints.length]=this.createPhysicsItem(list[i])},game_shell.game.MapBuilder.prototype.createCheckPoint=function(objData,TypeClass){var checkpoint=new TypeClass;return checkpoint.init(objData),this.obstacles.addChild(checkpoint.root),checkpoint},game_shell.game.MapBuilder.prototype.createWorld=function(){return new p2.World({gravity:[0,this.gravity]})},game_shell.game.MapBuilder.prototype.createGameLoop=function(){var gameLoop=new alex.game.GameLoop;this.scene.updateList.add(gameLoop);var cameraCulling=!0;return gameLoop.init({input:this.scene.input,cameraCulling:cameraCulling,camera:this.scene.camera}),gameLoop},game_shell.game.MapBuilder.prototype.createRespawnController=function(){var respawnController=new game_shell.game.RespawnController;return respawnController.init({player:this.scene.player,checkpoints:this.scene.checkpoints,resetItems:this.resetItems,levelStats:this.scene.levelProgress.levelStats,obstacleController:this.scene.obstacleController,spawnPoints:this.spawnPoints}),respawnController},game_shell.game.MapBuilder.prototype.createPlayer=function(){var parent=this.obstacles,l=game_shell.config.CHEAT_START||0,startPt=this.spawnPoints[l],maxSpeed=-2;switch(this.levelIndex){case 1:maxSpeed=-2;break;case 2:maxSpeed=-2;break;case 3:maxSpeed=-2;break;case 4:maxSpeed=-2.3;break;case 5:maxSpeed=-2.3;break;case 6:maxSpeed=-2.3;break;case 7:maxSpeed=-2.6;break;case 8:maxSpeed=-2.6;break;case 9:maxSpeed=-2.6}var player=this.createObject(game_shell.game.Player,{resolution:this.resolution,gameBus:this.gameBus,gravity:this.gravity,maxSpeed:maxSpeed,powerupController:this.scene.powerupController,hitTracker:this.scene.hitTracker,world:this.world,snd:this.snd,x:startPt.x,y:startPt.y,mass:2},parent);return this.scene.camera.tracking=player.graphics,this.scene.camera.update(0),this.scene.levelProgress.playerSprite=player.graphics,player},game_shell.game.Parallax=function(){this.resolution=1,this.mapLayer=null,this.parallax1=null,this.parallax2=null,this.p1=-.8,this.p2=-.9,this.lastX=0,this.camera=null,this.sceneryItems=[],this.viewport=new PIXI.Rectangle,this.cullRect=new PIXI.Rectangle},game_shell.game.Parallax.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.lastX=this.mapLayer.x,this.viewport.width=this.camera.viewport.width,this.viewport.height=this.camera.viewport.height,this.viewport.x=this.viewport.width*-.5},game_shell.game.Parallax.prototype.addScenery=function(list){var i,backgroundItem,n=list.length;for(i=0;n>i;i++)backgroundItem=list[i],this.sceneryItems[this.sceneryItems.length]=backgroundItem},game_shell.game.Parallax.prototype.update=function(delta){if(this.mapLayer.x!==this.lastX){this.lastX=this.mapLayer.x,this.parallax1.x=this.lastX*this.p1,this.parallax2.x=this.lastX*this.p2;var i,backgroundItem,frame,sprite,n=this.sceneryItems.length;for(i=0;n>i;i++)backgroundItem=this.sceneryItems[i],frame=backgroundItem.frame,sprite=backgroundItem.sprite,this.cullRect.x=frame.x,this.cullRect.y=frame.y,this.cullRect.width=frame.width,this.cullRect.height=frame.height,this.cullRect.x+=sprite.parent.x+this.lastX,sprite.visible=this.isInFrame(this.cullRect)}},game_shell.game.Parallax.prototype.isInFrame=function(rect){var obj1R=rect.x+rect.width,obj2R=this.viewport.x+this.viewport.width;return obj1R>this.viewport.x&&rect.x<obj2R},game_shell.game.BackgroundItem=function(){this.frame=null,this.sprite=null,this.resolution=1},game_shell.game.BackgroundItem.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.frame=new PIXI.Rectangle,this.sprite=this.createSprite(config),this.updateFrame()},game_shell.game.BackgroundItem.prototype.createSprite=function(data){var sprite=new PIXI.Sprite(PIXI.TextureCache[data.image]);return sprite.rotation=data.angle,sprite.x=data.x,sprite.y=data.y,sprite},game_shell.game.BackgroundItem.prototype.updateFrame=function(){var bounds=this.sprite.getLocalBounds();this.frame.x=this.sprite.x+bounds.x,this.frame.y=this.sprite.y+bounds.y,this.frame.width=bounds.width/this.resolution,this.frame.height=bounds.height/this.resolution},game_shell.game.ObstacleController=function(){this.obstacles=[],this.timer=null,this.camera=null},game_shell.game.ObstacleController.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.timer=this.createTimer(),this.viewport=this.camera.viewport},game_shell.game.ObstacleController.prototype._check=function(){var i,obstacle,n=this.obstacles.length;for(i=0;n>i;i++)obstacle=this.obstacles[i],!obstacle.triggered&&this.isInFrame(obstacle.frame)&&obstacle.trigger()},game_shell.game.ObstacleController.prototype.respawn=function(x){var i,obstacle,n=this.obstacles.length;for(i=0;n>i;i++)obstacle=this.obstacles[i],obstacle.triggered&&obstacle.graphics.x>x&&obstacle.untrigger()},game_shell.game.ObstacleController.prototype.isInFrame=function(rect){var objR=rect.x+rect.width;return objR<this.viewport.x+this.viewport.width},game_shell.game.ObstacleController.prototype.createTimer=function(){var interval=100;this.check=this._check.bind(this);var timer=new alex.utils.Timer(interval);return timer.on("timer",this.check),timer},game_shell.game.ObstacleController.prototype.start=function(){this.timer.start()},game_shell.game.ObstacleController.prototype.stop=function(){this.timer.stop()},game_shell.game.ObstacleController.prototype.update=function(delta){this.timer.update(delta)},game_shell.game.ObstacleController.prototype.add=function(obstacle){this.obstacles[this.obstacles.length]=obstacle},game_shell.game.LevelReset=function(){this.scene=null,this.bodyTypes=game_shell.physics.BodyTypes},game_shell.game.LevelReset.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.playAgain=this._playAgain.bind(this.scene),this.gameBus.on("replay",this.playAgain)},game_shell.game.LevelReset.prototype._playAgain=function(){this.player.reset(this.respawnController.spawnPoints[0]),this.camera.tracking=this.player.graphics.position;var i,gameObject,allItems=this.gameLoop.gameObjects,n=allItems.length,bodyTypes=game_shell.physics.BodyTypes;for(i=0;n>i;i++)gameObject=allItems[i],(gameObject.type===bodyTypes.CHECK_POINT||gameObject.type===bodyTypes.COIN||gameObject.type===bodyTypes.OBSTACLE||gameObject.type===bodyTypes.POWERUP_FLIGHT||gameObject.type===bodyTypes.POWERUP_INVINCIBLE)&&gameObject.reset();this.startFlag.reset(),this.levelProgress.reset(),this.powerupController.reset(),delete game_shell.config.CHEAT_START,this.updateList.remove(this.resultPanel.particles),this.player.hitPause=4e3,this.timeField.reset(),this.snd.play("respawn"),this.startCountDown(),this.snd.playGameIntro()},game_shell.game.HitTracker=function(){this.gameBus=null,this.timeout=null,this.hits=0,this.resetTime=5e3,this.monster=null},game_shell.game.HitTracker.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.hit=this._hit.bind(this),this.reset=this._reset.bind(this),this.timeout=new alex.utils.DelayedAction},game_shell.game.HitTracker.prototype._reset=function(){this.hits=0,this.monster.reset()},game_shell.game.HitTracker.prototype._hit=function(){this.timeout.clear();var isDead=!1;return 0===this.hits?(this.hits++,this.timeout.delay(this.reset,this.resetTime),this.monster.next()):(isDead=!0,this.monster.next()),isDead},game_shell.game.HitTracker.prototype.update=function(delta){this.timeout.update(delta)},game_shell.game.Monster=function(){this.sprite=null,this.timeout=null,this.snd=null,this.screenW=0,this.states={stateOff:0,stateComing:1,stateOn:2,stateStart:3},this.state=0,this.baseY=0,this.counter=0,this.range=10,this.tweens=new alex.utils.TweenGroup},game_shell.game.Monster.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.sprite=this.createSprite();var w=this.sprite.texture.frame.width/this.resolution;this.offX=this.screenW*-.5,this.comingX=this.offX+.5*w,this.onX=this.offX+w,this.startX=this.offX+.5*w,this.baseY=this.sprite.y,this.reset=this._reset.bind(this)},game_shell.game.Monster.prototype.start=function(){this.state=this.states.stateStart,this.counter=2*Math.random()*Math.PI,this.snd.play("mayor_scared");var snd=this.snd,tw=new TWEEN.UpdateTween(this.sprite).to({x:this.startX},500).delay(500).easing(TWEEN.Easing.Quadratic.Out).onStart(function(){this.visible=!0,snd.play("monster_attack")}).start();this.tweens.add(tw),this.timeout.delay(this.reset,2e3)},game_shell.game.Monster.prototype.createSprite=function(){var sprite=new PIXI.Sprite(PIXI.TextureCache["monster_head.png"]);return sprite.anchor.y=.5,sprite.anchor.x=1,sprite.x=this.screenW*-.5,sprite.visible=!1,sprite},game_shell.game.Monster.prototype.next=function(){switch(this.state){case this.states.stateOff:this.enterScreen();break;case this.states.stateComing:this.attack()}},game_shell.game.Monster.prototype._reset=function(){var time=this.state===this.states.stateStart?2e3:500;this.state=this.states.stateOff;var tw=new TWEEN.UpdateTween(this.sprite).to({x:this.offX},time).onComplete(function(){this.visible=!1}).easing(TWEEN.Easing.Quadratic.Out).start();this.tweens.add(tw)},game_shell.game.Monster.prototype.enterScreen=function(){this.state=this.states.stateComing,this.counter=2*Math.random()*Math.PI;var tw=new TWEEN.UpdateTween(this.sprite).to({x:this.comingX},500).easing(TWEEN.Easing.Quadratic.Out).onStart(function(){this.visible=!0}).start();this.tweens.add(tw),this.snd.play("monster_appear")},game_shell.game.Monster.prototype.attack=function(){this.state=this.states.stateOn;var tw=new TWEEN.UpdateTween(this.sprite).to({x:this.onX},500).easing(TWEEN.Easing.Quadratic.Out).onStart(function(){this.visible=!0}).start();this.tweens.add(tw),this.snd.play("monster_attack")},game_shell.game.Monster.prototype.update=function(delta){if(this.tweens.update(delta),this.state>0){this.counter+=.005*delta;var bounce=Math.sin(this.counter)*this.range;0>bounce&&(bounce=-bounce),this.sprite.y=this.baseY+bounce}},game_shell.game.ParticleBase=function(){this.root=null,this.texture=null,this.life=3,this.proton=new Proton,this.rad=Math.PI/180,
this.deg=180/Math.PI},game_shell.game.ParticleBase.prototype.init=function(config){this.poolSize=150;for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.emitter=this.createEmitter(),this._spritePool=this._createPool(this.poolSize),this.createRender(),this.move(config.x,config.y)},game_shell.game.ParticleBase.prototype.dispose=function(){this.proton&&this.proton.destroy(),this.proton=null},game_shell.game.ParticleBase.prototype.fire=function(px,py,duration){var time=duration||.5;this.move(px,py),this.emit(time)},game_shell.game.ParticleBase.prototype.move=function(px,py){this.emitter.p.x=px||0,this.emitter.p.y=py||0},game_shell.game.ParticleBase.prototype.update=function(p_time){this.proton.update(p_time)},game_shell.game.ParticleBase.prototype.emit=function(p_secs){var secs=p_secs||1/0;this.emitter.emit(secs)},game_shell.game.ParticleBase.prototype.stop=function(andRemove){this.emitter.stopEmit(),andRemove&&this.emitter.removeAllParticles()},game_shell.game.ParticleBase.prototype.burst=function(pt){pt&&this.move(pt.x,pt.y),this.emitter.emit(.2)},game_shell.game.ParticleBase.prototype.rotate=function(radians){var degrees=radians*this.deg%360-180;this.emitter.velocity.thaPan.a=degrees},game_shell.game.ParticleBase.prototype.createEmitter=function(){var texture=this.texture,vx=.5*this.life,vy=this.life,mass=1,gravity=2,lx=.35*this.life,ly=.5*this.life,emitter=new Proton.BehaviourEmitter;return emitter.addInitialize(new Proton.ImageTarget(texture)),emitter.rate=new Proton.Rate(10,.1),emitter.addInitialize(new Proton.Mass(mass)),emitter.addBehaviour(new Proton.Gravity(gravity)),emitter.addInitialize(new Proton.Life(lx,ly)),emitter.addInitialize(new Proton.Velocity(new Proton.Span(vx,vy),new Proton.Span(0,360),"polar")),emitter.addBehaviour(new Proton.Scale(Proton.getSpan(.5,1.5))),emitter.addBehaviour(new Proton.Alpha(1,0,1/0,Proton.easeInQuart)),emitter.addBehaviour(new Proton.Rotate(Proton.getSpan(0,360),Proton.getSpan(-3,3),"add")),this.proton.addEmitter(emitter),emitter},game_shell.game.ParticleBase.prototype.transformSprite=function(particleSprite,particle){particleSprite.x=particle.p.x,particleSprite.y=particle.p.y,particleSprite.scale.x=particle.scale,particleSprite.scale.y=particle.scale,particleSprite.alpha=particle.alpha,particleSprite.rotation=particle.rotation*this.rad},game_shell.game.ParticleBase.prototype._createPool=function(size){for(var sp,_spritePool=[],tx=this.texture;size>0;)size--,sp=new PIXI.Sprite(tx),sp.anchor.x=.5,sp.anchor.y=.5,_spritePool[_spritePool.length]=sp;return _spritePool},game_shell.game.ParticleBase.prototype.createRender=function(){this.renderer=new Proton.Renderer("other",this.proton);var self=this;this.renderer.onParticleCreated=function(particle){var particleSprite=self.nextSprite();particle.sprite=particleSprite,self.root.addChild(particle.sprite)},this.renderer.onParticleUpdate=function(particle){self.transformSprite(particle.sprite,particle)},this.renderer.onParticleDead=function(particle){particle.sprite.removeFromParent()},this.renderer.start()},game_shell.game.ParticleBase.prototype.nextSprite=function(){var sp=this._spritePool.shift();return this._spritePool[this._spritePool.length]=sp,sp},game_shell.game.NullParticles=function(){this.dispose=function(){},this.init=function(cfg){},this.fire=function(px,py,duration){},this.move=function(px,py){},this.update=function(p_time){},this.emit=function(p_secs){}},game_shell.game.StartFlag=function(){dragonBones.BonesSprite.call(this),this._nextTimeline="idle",this.barrelX=35,this.baseX=0,this.baseY=0},game_shell.game.StartFlag.prototype=Object.create(dragonBones.BonesSprite.prototype),game_shell.game.StartFlag.prototype.init=function(config){config.armatureData=this.getData(),dragonBones.BonesSprite.prototype.init.call(this,config),this.baseX=this.bonesBase.x,this.baseY=this.bonesBase.y,this.addBarrels();var self=this;self.on("complete",function(event){"idle"!=event.timeline&&"end"!=event.timeline&&self.play(self._nextTimeline)})},game_shell.game.StartFlag.prototype.start=function(){this.play("start"),this.pingOff(this.bonesBase,0,0),this.pingOff(this.barrel1,100,50),this.pingOff(this.barrel2,-50,-50)},game_shell.game.StartFlag.prototype.addBarrels=function(){this.barrel1=this.createBarrel(this.barrelX),this.barrel2=this.createBarrel(-this.barrelX)},game_shell.game.StartFlag.prototype.createBarrel=function(x){var barrel1=new PIXI.Sprite(PIXI.TextureCache["background_barrel.png"]);return barrel1.x=this.bonesBase.x+x,barrel1.y=this.bonesBase.y,barrel1.anchor.y=1,barrel1.anchor.x=.5,this.root.addChildAt(barrel1,0),barrel1},game_shell.game.StartFlag.prototype.pingOff=function(hazard,offsetX,speed){var targetX,screenH=320,screenW=568,targetY=hazard.y-screenH,xDist=.25*screenW+.5*Math.random()*screenW;targetX=hazard.x+xDist+offsetX;var scale=.02,spin=.06,time=500+speed;new TWEEN.Tween(hazard).to({x:targetX,y:targetY},time).delay(650).onUpdate(function(){hazard.rotation+=spin,hazard.scale.x-=scale,hazard.scale.y-=scale}).onComplete(function(){hazard.removeFromParent()}).easing(TWEEN.Easing.Quadratic.Out).start()},game_shell.game.StartFlag.prototype.reset=function(){this.armature.animation.gotoAndPlay("in"),this.restore(this.barrel1,this.barrelX),this.restore(this.barrel2,-this.barrelX),this.restore(this.bonesBase,0)},game_shell.game.StartFlag.prototype.restore=function(sprite,x){sprite.x=this.baseX+x,sprite.y=this.baseY,sprite.rotation=0,sprite.scale.x=sprite.scale.y=1,this.root.addChild(sprite)},game_shell.game.StartFlag.prototype.getData=function(){return{armatureName:"flag_animation",skeletonId:"flag_animation",skeletonJSON:game_shell.json.flag_animation,atlasJson:game_shell.json.game,animationId:"in",partsList:["mayor_arm1.png","mayor_arm2.png","mayor_barrell_back.png","mayor_barrell_front.png","mayor_body.png","mayor_flag.png"]}},game_shell.game.EndFlag=function(){dragonBones.BonesSprite.call(this)},game_shell.game.EndFlag.prototype=Object.create(dragonBones.BonesSprite.prototype),game_shell.game.EndFlag.prototype.init=function(config){config.armatureData=this.getData(),dragonBones.BonesSprite.prototype.init.call(this,config),this.bonesBase.x=0,this.bonesBase.y=0},game_shell.game.EndFlag.prototype.reset=function(){this.armature.animation.gotoAndStop("anim")},game_shell.game.EndFlag.prototype.getData=function(){return{armatureName:"checkpoint",skeletonId:"checkpoint",skeletonJSON:game_shell.json.checkpoint,atlasJson:game_shell.json.game,animationId:"anim",partsList:["toby_barrell_back.png","toby_barrell_front.png","toby_body.png","toby_flag1.png","toby_flag2.png"]}},game_shell.game.CheckpointFlag=function(){this.index=1,this.resolution=1,this.root=null,this.flag=null},game_shell.game.CheckpointFlag.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.root=new PIXI.DisplayObjectContainer,this.flag=this.createFlag(),this.height=this.flag.texture.frame.height/this.resolution,this.flag.y=this.height,this.root.x=config.x,this.root.y=config.y},game_shell.game.CheckpointFlag.prototype.createFlag=function(){var tx;switch(this.index){case 1:tx=PIXI.TextureCache["checkpoint_flag_01.png"];break;case 2:tx=PIXI.TextureCache["checkpoint_flag_02.png"];break;case 3:tx=PIXI.TextureCache["checkpoint_flag_03.png"]}var flag=new PIXI.Sprite(tx);return flag.anchor.y=1,this.root.addChild(flag),flag},game_shell.game.CheckpointFlag.prototype.reset=function(){},game_shell.game.CheckpointFlag.prototype.play=function(){new TWEEN.Tween(this.flag).to({y:0},300).easing(TWEEN.Easing.Quadratic.Out).start()},game_shell.physics.BodyTypes={ROLLING_BARREL:1,RECTANGLE_ROCK:2,FALLING_PLATFORM:3,SCENERY:4,CHECK_POINT:6,COIN:7,OBSTACLE:8,POWERUP_INVINCIBLE:9,POWERUP_FLIGHT:10,SCENERY_BACKGROUND:11,NONE:-1},game_shell.physics.SCALE=100,game_shell.physics.GameObject=function(config){this.body=null,this.shape=null,this.graphics=null,this.type=-1,this.scaling=game_shell.physics.SCALE,this.offsetR=0,this.offsetX=0,this.offsetY=0,this.needsDraw=!0,this.frame=new PIXI.Rectangle},game_shell.physics.GameObject.prototype=Object.create(alex.utils.EventDispatcher.prototype),game_shell.physics.GameObject.prototype.createMultiShape=function(config,isSensor){var x=config.x/this.scaling,y=config.y/this.scaling;this.body=new p2.Body({position:[x,y]});var i,rect,shape,w,h,n=config.shapes.length,shapes=[];for(i=0;n>i;i++)rect=config.shapes[i],w=rect.width/this.scaling,h=rect.height/this.scaling,x=rect.x/this.scaling,y=rect.y/this.scaling,shape=new p2.Rectangle(w,h),isSensor&&(shape.sensor=!0),this.body.addShape(shape,[x,y],rect.angle),shapes[i]=shape;return shapes},game_shell.physics.GameObject.prototype.updateFrame=function(){var bounds=this.graphics.getLocalBounds();this.frame.x=this.graphics.x+bounds.x,this.frame.y=this.graphics.y+bounds.y,this.frame.width=bounds.width/this.resolution,this.frame.height=bounds.height/this.resolution},game_shell.physics.GameObject.prototype.createRectangle=function(config){var w=config.width/this.scaling,h=config.height/this.scaling,x=config.x/this.scaling,y=config.y/this.scaling,boxShape=new p2.Rectangle(w,h),boxBody=new p2.Body({position:[x,y]});return boxBody.addShape(boxShape),boxBody.userData=this,this.body=boxBody,this.shape=boxShape,this.parse(config),boxShape},game_shell.physics.GameObject.prototype.createCircle=function(config){var diameter=config.diameter/this.scaling,x=config.x/this.scaling,y=config.y/this.scaling,circleShape=new p2.Circle(diameter/2),circleBody=new p2.Body({position:[x,y]});return circleBody.addShape(circleShape),circleBody.userData=this,this.frame.width=this.frame.height=config.diameter,this.body=circleBody,this.shape=circleShape,this.parse(config),circleShape},game_shell.physics.GameObject.prototype.update=function(time){},game_shell.physics.GameObject.prototype.preUpdate=function(time){},game_shell.physics.GameObject.prototype.debugGraphics=function(shapes,positions,parent){var i,shape,gfx,position,holder=parent||new PIXI.DisplayObjectContainer,n=shapes.length;for(i=0;n>i;i++)shape=shapes[i],position=positions[i],gfx=this.graphicsRect(shape),gfx.x=-position.x,gfx.y=-position.y,gfx.rotation=position.angle,holder.addChild(gfx);return holder},game_shell.physics.GameObject.prototype.graphicsRect=function(boxShape){var graphics=new PIXI.Graphics,color=16711680,fillAlpha=.4;graphics.lineStyle(2,color),graphics.beginFill(color,fillAlpha);var w=boxShape.width*this.scaling,h=boxShape.height*this.scaling;return graphics.drawRect(-w/2,-h/2,w,h),graphics.endFill(),graphics},game_shell.physics.GameObject.prototype.debugRect=function(parent){var gfx=this.graphicsRect(this.shape);return gfx.x=-(this.body.position[0]*this.scaling),gfx.y=-(this.body.position[1]*this.scaling),gfx.rotation=this.body.angle,gfx},game_shell.physics.GameObject.prototype.draw=function(force){if(this.graphics&&(this.needsDraw||force)){var x=this.graphics.position.x=-(this.body.position[0]*this.scaling),y=this.graphics.position.y=-(this.body.position[1]*this.scaling);this.graphics.rotation=this.body.angle,this.frame.x=x-.5*this.frame.width,this.frame.y=y-.5*this.frame.height}},game_shell.physics.GameObject.prototype.setPosition=function(pt){this.body.position[0]=pt.x/this.scaling,this.body.position[1]=pt.y/this.scaling},game_shell.physics.GameObject.prototype.parse=function(config){this.resolution=config.resolution,this.setPosition(config),this.body.angle=config.angle||0,this.body.mass=config.mass||0,config.rotated&&(this.offsetR=-this.body.angle,this.offsetX=config.imgX,this.offsetY=config.imgY)},Object.defineProperties(game_shell.physics.GameObject.prototype,{x:{get:function(){return this.body.position[0]*this.scaling}},y:{get:function(){return this.body.position[1]*this.scaling}}}),alex.game.GameLoop.prototype.drawGameObjects=function(){var i,obj,n=this.gameObjects.length;for(i=0;n>i;i++)obj=this.gameObjects[i],obj.needsDraw&&obj.draw()},game_shell.physics.RectangleRock=function(){game_shell.physics.GameObject.call(this),this.type=game_shell.physics.BodyTypes.RECTANGLE_ROCK},game_shell.physics.RectangleRock.prototype=Object.create(game_shell.physics.GameObject.prototype),game_shell.physics.RectangleRock.prototype.constructor=game_shell.physics.RectangleRock,game_shell.physics.RectangleRock.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);var shapes=this.createMultiShape(config);this.body.mass=1,this.body.userData=this,this.parse(config),config.image?(this.graphics=new PIXI.Sprite(PIXI.TextureCache[config.image]),this.graphics.anchor.x=this.graphics.anchor.y=.5,this.debug&&this.debugGraphics(shapes,config.shapes,this.graphics)):(this.graphics=this.debugGraphics(shapes,config.shapes),this.graphics.visible=!1),this.draw(!0),this.updateFrame()},game_shell.physics.CircleRock=function(){game_shell.physics.GameObject.call(this),this.type=game_shell.physics.BodyTypes.RECTANGLE_ROCK},game_shell.physics.CircleRock.prototype=Object.create(game_shell.physics.RectangleRock.prototype),game_shell.physics.CircleRock.prototype.constructor=game_shell.physics.CircleRock,game_shell.physics.CircleRock.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.createCircle(config);this.body.fixedRotation=!0,this.graphics=new PIXI.Sprite(PIXI.TextureCache[config.image]),this.graphics.anchor.x=this.graphics.anchor.y=.5,this.graphics.rotation=this.body.angle},game_shell.physics.Checkpoint=function(){game_shell.physics.GameObject.call(this),this.type=game_shell.physics.BodyTypes.CHECK_POINT,this.extraTime=15,this.index=1,this.isLast=!1},game_shell.physics.Checkpoint.prototype=Object.create(game_shell.physics.GameObject.prototype),game_shell.physics.Checkpoint.prototype.constructor=game_shell.physics.Checkpoint,game_shell.physics.Checkpoint.prototype.init=function(config){this.color=65484;for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);config.shapes=[{x:0,y:0,angle:0,width:6,height:2200}];this.createMultiShape(config,!0);this.body.fixedRotation=!0,this.body.userData=this,this.needsDraw=!1,this.triggered=!1,this.index=config.index||1,this.graphics=this.createAnimation(config),this.draw(!0),this.updateFrame()},game_shell.physics.Checkpoint.prototype.activate=function(){this.triggered||(this.triggered=!0,this.animation.play("anim"))},game_shell.physics.Checkpoint.prototype.reset=function(){this.triggered=!1,this.animation.reset()},game_shell.physics.Checkpoint.prototype.createAnimation=function(config){var animation=new game_shell.game.CheckpointFlag;return animation.init({x:config.clipX,resolution:this.resolution,index:this.index,y:config.clipY}),this.animation=animation,animation.root},Object.defineProperty(game_shell.physics.Checkpoint.prototype,"root",{get:function(){return this.graphics}}),game_shell.physics.Collectible=function(){game_shell.physics.GameObject.call(this),this.type=game_shell.physics.BodyTypes.COIN,this.collected=!1},game_shell.physics.Collectible.prototype=Object.create(game_shell.physics.GameObject.prototype),game_shell.physics.Collectible.prototype.constructor=game_shell.physics.Collectible,game_shell.physics.Collectible.prototype.reset=function(){this.collected=!1,this.graphics.alpha=1},game_shell.physics.Collectible.prototype.collect=function(){this.collected=!0,this.graphics.alpha=0},game_shell.physics.Collectible.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);config.diameter||(config.diameter=config.width);var circleShape=this.createCircle(config);circleShape.sensor=!0,this.body.fixedRotation=!0,this.body.userData=this,this.parse(config),this.graphics=new PIXI.Sprite(PIXI.TextureCache[config.image]),this.graphics.anchor.x=this.graphics.anchor.y=.5,this.draw(!0),this.updateFrame()},game_shell.physics.Obstacle=function(){game_shell.physics.GameObject.call(this),this.type=game_shell.physics.BodyTypes.OBSTACLE,this.needsDraw=!1,this.active=!0,this.wasHit=!1,this.triggered=!1,this.timeout=0,this.popY=this.hiddenY=0,this.isPit=!1},game_shell.physics.Obstacle.prototype=Object.create(game_shell.physics.GameObject.prototype),game_shell.physics.Obstacle.prototype.constructor=game_shell.physics.Obstacle,game_shell.physics.Obstacle.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.createMultiShape(config,!0),this.body.mass=1,this.body.userData=this,this.parse(config),this.graphics=new PIXI.Sprite(PIXI.TextureCache[config.image]),this.graphics.anchor.x=.5,this.graphics.anchor.y=.5,this.graphics.rotation=this.body.angle,this.draw(!0),this.updateFrame()},game_shell.physics.Obstacle.prototype.reset=function(){this.wasHit=!1,this.triggered=!1,this.graphics.alpha=1,this.timeout=0,this.active=!0,this.graphics.y=this.hiddenY},game_shell.physics.Obstacle.prototype.doTimeout=function(){this.timeout=2e3,this.active=!1},game_shell.physics.Obstacle.prototype.hit=function(){this.wasHit=!0,this.active=!1,this.graphics.alpha=0},game_shell.physics.Obstacle.prototype.adjustPivot=function(){var frame=this.graphics.texture.frame,h=(frame.width/this.resolution,frame.height/this.resolution);this.graphics.anchor.y=1;var pt={x:0,y:.5*h};this.graphics.updateTransform(),this.matrixRotatePoint(pt,this.graphics.worldTransform,pt),this.update=this._update,this.wiggle=new alex.motion.Wiggle(this.graphics,.01),this.graphics.x+=pt.x,this.graphics.y+=pt.y,this.popY=this.graphics.y,this.hiddenY=this.popY+h,this.graphics.y=this.hiddenY},game_shell.physics.Obstacle.prototype.untrigger=function(){this.wasHit||(this.triggered=!1,this.graphics.y=this.hiddenY)},game_shell.physics.Obstacle.prototype.trigger=function(){this.triggered=!0,new TWEEN.Tween(this.graphics).to({y:this.popY},250).easing(TWEEN.Easing.Quadratic.Out).start(),this.snd.playThief()},game_shell.physics.Obstacle.prototype.matrixRotatePoint=function(p,m,output){var w=p.x,h=p.y,pt=output||new PIXI.Point;return pt.x=m.a*w+m.c*h,pt.y=m.d*h+m.b*w,pt},game_shell.physics.Obstacle.prototype._update=function(delta){this.triggered&&(this.wiggle.wiggle(delta),this.timeout>0&&(this.timeout-=delta,this.timeout<0&&(this.timeout=0,this.active=!0)))},game_shell.physics.FinishLine=function(){game_shell.physics.Checkpoint.call(this),this.isLast=!0},game_shell.physics.FinishLine.prototype=Object.create(game_shell.physics.Checkpoint.prototype),game_shell.physics.FinishLine.prototype.constructor=game_shell.physics.FinishLine,game_shell.physics.FinishLine.prototype.createAnimation=function(config){var animation=new game_shell.game.EndFlag;return animation.init({x:config.clipX,y:config.clipY}),this.animation=animation,animation.root},game_shell.physics.FinishLine.prototype.activate=function(){this.triggered||(this.triggered=!0,this.animation.play("anim"))},game_shell.physics.FallingPlatform=function(){game_shell.physics.RectangleRock.call(this),this.type=game_shell.physics.BodyTypes.FALLING_PLATFORM,this.hasFallen=!1,this.resetPoint={x:0,y:0}},game_shell.physics.FallingPlatform.prototype=Object.create(game_shell.physics.RectangleRock.prototype),game_shell.physics.FallingPlatform.prototype.constructor=game_shell.physics.FallingPlatform,game_shell.physics.FallingPlatform.prototype.init=function(config){game_shell.physics.RectangleRock.prototype.init.call(this,config),this.body.type=p2.Body.DYNAMIC,this.body.mass=1,this.body.fixedRotation=!0,this.body.updateMassProperties(),this.body.sleep(),this.resetPoint.x=this.body.position[0],this.resetPoint.y=this.body.position[1]},game_shell.physics.FallingPlatform.prototype.fall=function(){this.hasFallen=!0},game_shell.physics.FallingPlatform.prototype.reset=function(){this.hasFallen=!0,this.body.position[0]=this.resetPoint.x,this.body.position[1]=this.resetPoint.y,this.body.velocity[0]=0,this.body.velocity[1]=0,this.body.setZeroForce(),this.body.sleep(),this.draw(!0)},game_shell.physics.Scenery=function(){game_shell.physics.GameObject.call(this),this.type=game_shell.physics.BodyTypes.SCENERY},game_shell.physics.Scenery.prototype=Object.create(game_shell.physics.GameObject.prototype),game_shell.physics.Scenery.prototype.constructor=game_shell.physics.Scenery,game_shell.physics.Scenery.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);var x=config.x/this.scaling,y=config.y/this.scaling;this.body=new p2.Body({position:[x,y]}),this.body.angle=config.angle,this.graphics=new PIXI.Sprite(PIXI.TextureCache[config.image]),this.graphics.anchor.x=this.graphics.anchor.y=.5,this.draw(!0),this.updateFrame()},game_shell.ui.UIBuilder=function(){this.scene=null,this.root=null,this.gameBus=null,this.isMobile=!1,this.bmFont=game_shell.bmFont},game_shell.ui.UIBuilder.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.scene.pauseButton=this.createPauseButton(),this.scene.timeField=this.createTimeField(),this.scene.levelField=this.createLevelField(),this.scene.scoreField=this.createScoreField(),this.scene.promptPanel=this.createPromptPanel(),this.scene.countdown=this.createCountdown(),this.scene.powerupController=this.createPowerupController(),this.scene.pausePanel=this.createPausePanel(),this.scene.resultPanel=this.createResultPanel()},game_shell.ui.UIBuilder.prototype.createResultPanel=function(){var resultPanel=new game_shell.ui.ResultPanel;return resultPanel.init({resolution:this.resolution,levelProgress:this.scene.levelProgress,levelInfo:this.user.levelInfo,gameBus:this.scene.gameBus}),resultPanel},game_shell.ui.UIBuilder.prototype.createPauseButton=function(){var pauseButton=new alex.display.Button("pause_btn.png");pauseButton.x=.5*this.screenW-40,pauseButton.y=this.screenH*-.5+40,pauseButton.visible=!1,this.scene.uiLayer.addChild(pauseButton);var scene=this.scene;return pauseButton.on("release",function(event){pauseButton.enabled=!1,scene.gameBus.emit({type:"pause"})}),pauseButton},game_shell.ui.UIBuilder.prototype.createTimeField=function(){var timeField=new game_shell.ui.TimeField;return this.initialTime=0,timeField.init({font:this.bmFont,defaultTime:this.initialTime,levelProgress:this.scene.levelProgress,resolution:this.resolution}),timeField.root.y=this.screenH*-.5,timeField.root.x=this.screenW*-.5+70,this.uiLayer.addChild(timeField.root),timeField},game_shell.ui.UIBuilder.prototype.createPowerupController=function(){var powerupController=new game_shell.game.PowerupController;return powerupController.init({resolution:this.resolution,gameBus:this.scene.gameBus,screenW:this.screenW,screenH:this.screenH}),this.uiLayer.addChild(powerupController.root),powerupController},game_shell.ui.UIBuilder.prototype.createLevelField=function(){var levelField=new game_shell.ui.LevelField;return levelField.init({resolution:this.resolution,levelIndex:this.levelIndex}),levelField.root.y=.5*this.screenH-80,levelField.root.x=this.scene.timeField.root.x+15,this.uiLayer.addChild(levelField.root),levelField},game_shell.ui.UIBuilder.prototype.createScoreField=function(){var scoreField=new game_shell.ui.ScoreField;return scoreField.init({font:this.bmFont,resolution:this.resolution}),scoreField.root.y=this.scene.timeField.root.y+50,scoreField.root.x=this.scene.timeField.root.x-46,this.uiLayer.addChild(scoreField.root),scoreField},game_shell.ui.UIBuilder.prototype.createCountdown=function(){var countdown=new game_shell.ui.CountdownController;return countdown.init({timeout:this.timeout,snd:this.scene.snd,resolution:this.resolution,gameBus:this.scene.gameBus}),this.scene.uiLayer.addChild(countdown.root),countdown},game_shell.ui.UIBuilder.prototype.createPromptPanel=function(){var promptPanel=new game_shell.ui.PromptPanel;return promptPanel.init({isMobile:this.isMobile,screenH:this.screenH,gameBus:this.scene.gameBus,timeout:this.timeout,resolution:this.resolution}),promptPanel.root.y=20,this.uiLayer.addChild(promptPanel.root),promptPanel},game_shell.ui.UIBuilder.prototype.createPausePanel=function(){var pausePanel=new game_shell.ui.PausePanel;return pausePanel.init({resolution:this.resolution,screenH:this.screenH,gameBus:this.scene.gameBus}),pausePanel},game_shell.ui.PromptPanel=function(){this.root=null,this.timeout=null,this.gameBus=!1,this.isMobile=!1,this.time=500,this.rotation=.087,this.x=140,this.y=20,this.offY=0,this.step=0},game_shell.ui.PromptPanel.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.root=new PIXI.DisplayObjectContainer,this.offY=this.screenH+40,this.content1=this.createContent("collect.png","power_up.png"),this.isMobile?this.content2=this.createContent("jump_sign.png","mobile_controls.png"):this.content2=this.createContent("jump_sign.png","desktop_controls.png")},game_shell.ui.PromptPanel.prototype.start=function(){this.showContent(this.content1),this.root.visible=!0},game_shell.ui.PromptPanel.prototype.next=function(){0===this.step?(this.step++,this.showContent(this.content2)):(this.step=0,this.root.visible=!1,this.gameBus.emit({type:"prompt_complete"}))},game_shell.ui.PromptPanel.prototype.showContent=function(content){content.y=this.offY,content.visible=!0;var self=this;new TWEEN.Tween(content).to({y:.5*this.screenH},this.time).delay(this.time).easing(TWEEN.Easing.Back.Out).onComplete(function(){self.removeContent(content)}).start()},game_shell.ui.PromptPanel.prototype.createSprite=function(tx,x,y,r){var sprite=new PIXI.Sprite(PIXI.TextureCache[tx]);return sprite.anchor.x=.5,sprite.anchor.y=1,sprite.y=y,sprite.x=x,sprite.rotation=r,sprite},game_shell.ui.PromptPanel.prototype.removeContent=function(content){var self=this;new TWEEN.Tween(content).to({y:this.offY},250).delay(2e3).onComplete(function(){content.visible=!1,self.next()}).easing(TWEEN.Easing.Quadratic.Out).start()},game_shell.ui.PromptPanel.prototype.createContent=function(tx1,tx2){var content=new PIXI.DisplayObjectContainer;content.visible=!1;var s1=this.createSprite(tx1,-this.x,this.y,-this.rotation);content.addChild(s1);var s2=this.createSprite(tx2,this.x,this.y,this.rotation);return content.addChild(s2),this.root.addChild(content),content},game_shell.ui.CountdownNumbers=function(){this.sprite=null,this.resolution=1,this.maxScale=1.5},game_shell.ui.CountdownNumbers.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.sprite=new PIXI.Sprite(PIXI.TextureCache["countdown_3.png"]),this.sprite.alpha=0,this._setPivot()},game_shell.ui.CountdownNumbers.prototype.show=function(number){var texture=this._getTexture(number);texture&&(this.sprite.setTexture(texture),this._setPivot(),this.sprite.scale.x=this.sprite.scale.y=this.maxScale,this.animate())},game_shell.ui.CountdownNumbers.prototype.animate=function(){var self=this,out=new TWEEN.Tween(this).to({alpha:0,scale:.25},400).easing(TWEEN.Easing.Quadratic.Out).onComplete(function(){self.scale=self.maxScale});new TWEEN.Tween(this).to({alpha:1,scale:1},400).easing(TWEEN.Easing.Quadratic.Out).onComplete(function(){out.start()}).start()},Object.defineProperty(game_shell.ui.CountdownNumbers.prototype,"scale",{set:function(value){this.sprite.scale.x=value,this.sprite.scale.y=value},get:function(){return this.sprite.scale.x}}),Object.defineProperty(game_shell.ui.CountdownNumbers.prototype,"alpha",{set:function(value){this.sprite.alpha=value},get:function(){return this.sprite.alpha}}),game_shell.ui.CountdownNumbers.prototype._getTexture=function(number){var tx=null;switch(number){case 3:tx=PIXI.TextureCache["countdown_3.png"];break;case 2:tx=PIXI.TextureCache["countdown_2.png"];break;case 1:tx=PIXI.TextureCache["countdown_1.png"]}return tx},game_shell.ui.CountdownNumbers.prototype._setPivot=function(){var tx=this.sprite.texture,frame=tx.frame;this.width=frame.width/this.resolution,this.height=frame.height/this.resolution,this.sprite.pivot.x=.5*this.width,this.sprite.pivot.y=.5*this.height},game_shell.ui.CountdownController=function(){this.root=null,this.snd=null,this.eventComplete={type:"countdown_complete"}},game_shell.ui.CountdownController.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.root=new PIXI.DisplayObjectContainer,this.root.visible=!1,this.timer=this.createTimer(),this.numbers=this.createNumbers()},game_shell.ui.CountdownController.prototype.start=function(updateList){this.timer.start(),updateList.add(this.timer),this.root.visible=!0,this.root.addChild(this.numbers.sprite)},game_shell.ui.CountdownController.prototype.createNumbers=function(){var numbers=new game_shell.ui.CountdownNumbers;return numbers.init({resolution:this.resolution}),numbers},game_shell.ui.CountdownController.prototype.createTimer=function(){var tick=this.cheat?100:1e3,timer=new alex.utils.Timer(tick,5),self=this;return timer.on("timer",function(event){self.countDown(event.countDown-1)}),timer},game_shell.ui.CountdownController.prototype.countDown=function(countDown){this.numbers.show(countDown),0===countDown&&this.hide()},game_shell.ui.CountdownController.prototype.hide=function(){this.root.visible=!1,this.gameBus.emit(this.eventComplete)},game_shell.ui.TimeField=function(){this.font="clare_bold",this.root=null,this.levelProgress=null,this.lastTime=0,this.defaultTime=0},game_shell.ui.TimeField.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.root=new PIXI.DisplayObjectContainer;var timeTitle=new PIXI.Sprite(PIXI.TextureCache["time_title.png"]);timeTitle.anchor.x=.5,timeTitle.y=14,this.root.addChild(timeTitle),this.field=this._createField(37)},game_shell.ui.TimeField.prototype._createField=function(y){var pt=30*this.resolution,style={font:pt.toString()+"pt "+this.font},s=this.timeToString(1e3*this.defaultTime),timeField=new PIXI.BitmapText(s,style);return timeField.scale.x=timeField.scale.y=1/this.resolution,timeField.updateText(),timeField.pivot.x=timeField.width*this.resolution*.5,timeField.y=y,this.root.addChild(timeField),timeField},game_shell.ui.TimeField.prototype.reset=function(){var s=this.timeToString(1e3*this.defaultTime);this.field.setText(s),this.root.visible=!1},game_shell.ui.TimeField.prototype.timeToString=function(newTime){var seconds=Math.floor(newTime/1e3),decisecs=Math.floor((newTime-1e3*seconds)/100),mins=Math.floor(seconds/60),secs=seconds-60*mins,ss=10>secs?"0"+secs:secs.toString();return mins.toString()+":"+ss+":"+decisecs},game_shell.ui.TimeField.prototype.reset=function(){var s=this.timeToString(0);this.field.setText(s)},game_shell.ui.TimeField.prototype.update=function(delta){if(this.levelProgress.started){var newTime=this.levelProgress.time;if(0>newTime&&(newTime=0),newTime!==this.lastTime){this.lastTime=newTime;var s=this.timeToString(newTime);this.field.setText(s)}}},game_shell.ui.ScoreField=function(){this.font="clare_bold",this.root=null,this["default"]="000000",this.padding=10,this.lastScore=0,this.five="00000",this.four="0000",this.three="000",this.two="00",this.one="0"},game_shell.ui.ScoreField.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.root=new PIXI.DisplayObjectContainer,this.field=this._createField(40),this.label=this._createLabel(20)},game_shell.ui.ScoreField.prototype._createLabel=function(y){var title=new PIXI.Sprite(PIXI.TextureCache["score_title.png"]);return title.y=y,title.x=-4,this.root.addChild(title),title},game_shell.ui.ScoreField.prototype._createField=function(y){var pt=18*this.resolution,style={font:pt.toString()+"pt "+this.font},field=new PIXI.BitmapText(this["default"],style);return field.scale.x=field.scale.y=1/this.resolution,field.y=y,field.updateText(),field.x=0,this.root.addChild(field),field},game_shell.ui.ScoreField.prototype.setScore=function(score){if(score!==this.lastScore){this.lastScore=score;var s=this.scoreString(score);this.field.setText(s)}},game_shell.ui.ScoreField.prototype.reset=function(){this.setScore(0)},game_shell.ui.ScoreField.prototype.scoreString=function(score){var s,num=score.toString();return s=10>score?this.five+num:100>score?this.four+num:1e3>score?this.three+num:1e4>score?this.two+num:1e5>score?this.one+num:num},game_shell.ui.LevelField=function(){
this.root=null,this.levelIndex=1,this.y=20},game_shell.ui.LevelField.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.root=new PIXI.DisplayObjectContainer,this.root.y=20,this.createLabel(20),this.createIcon(34)},game_shell.ui.LevelField.prototype.createLabel=function(y){var label=new PIXI.Sprite(PIXI.TextureCache["level_title.png"]);label.anchor.x=.5,label.x=-40,label.y=y,this.root.addChild(label)},game_shell.ui.LevelField.prototype.getIconTexture=function(){var tx=null;switch(this.levelIndex){case 1:tx=PIXI.TextureCache["01.png"];break;case 2:tx=PIXI.TextureCache["02.png"];break;case 3:tx=PIXI.TextureCache["03.png"];break;case 4:tx=PIXI.TextureCache["04.png"];break;case 5:tx=PIXI.TextureCache["05.png"];break;case 6:tx=PIXI.TextureCache["06.png"];break;case 7:tx=PIXI.TextureCache["07.png"];break;case 8:tx=PIXI.TextureCache["08.png"];break;case 9:tx=PIXI.TextureCache["09.png"]}return tx},game_shell.ui.LevelField.prototype.createIcon=function(y){var tx=this.getIconTexture(),icon=new PIXI.Sprite(tx);icon.anchor.x=.5,icon.x=-40,icon.y=y,this.root.addChild(icon)},game_shell.game.UserInput=function(){this.isMobile=!1,this.gameBus=null,this.control=null,this.eventJump={type:"jump"},this.debugCounter=0},game_shell.game.UserInput.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.isMobile?(this.control=new game_shell.game.UserTouch,this.control.init(config)):this.control=new game_shell.game.KeyWrapper},game_shell.game.UserInput.prototype.check=function(p_delta){(this.control.spacePressed()||this.control.upPressed())&&this.gameBus.emit(this.eventJump),this.control.update(p_delta)},game_shell.game.UserInput.prototype.enable=function(state){this.control.enable(state)},game_shell.game.KeyWrapper=function(){},game_shell.game.KeyWrapper.prototype=Object.create(game_shell.Keys),game_shell.game.KeyWrapper.prototype.spacePressed=function(){return this.wasPressed(this.SPACE_KEY)},game_shell.game.KeyWrapper.prototype.upPressed=function(){return this.wasPressed(this.UP_KEY)},game_shell.game.UserTouch=function(){this.UP=0,this.JUST_PRESSED=1,this.DOWN=2,this.SPACE=this.UP,this.screenW=1,this.screenH=1,this.display=null},game_shell.game.UserTouch.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.upPressed=this.spacePressed,this.display||(this.display=new alex.display.Quad(this.screenW,this.screenH),this.display.x=this.screenW*-.5,this.display.y=this.screenH*-.5),this.addListeners()},game_shell.game.UserTouch.prototype.addListeners=function(){this.display.touchstart=this.display.mousedown=this._touchstart.bind(this),this.display.touchend=this.display.mouseup=this._touchend.bind(this)},game_shell.game.UserTouch.prototype._touchstart=function(event){this.SPACE=this.JUST_PRESSED},game_shell.game.UserTouch.prototype._touchend=function(event){this.SPACE=this.UP},game_shell.game.UserTouch.prototype.update=function(p_delta){this.SPACE===this.JUST_PRESSED&&(this.SPACE=this.DOWN)},game_shell.game.UserTouch.prototype.reset=function(){this.SPACE=this.UP},game_shell.game.UserTouch.prototype.enable=function(bool){this.display.interactive=bool,this.display.buttonMode=bool},game_shell.game.UserTouch.prototype.spacePressed=function(){return this.SPACE===this.JUST_PRESSED},game_shell.ui.PowerupBubble=function(){this.sprite=null,this.type=-1,this.resolution=1,this.tweenOn=null,this.tweenOff=null,this.gameBus=null,this.eventExpire={type:"power_end"},this.screenW=0,this._alpha=1,this.screenH=0,this.startY=100,this._counter=0,this.cos=0,this.isExtra=!1,this.autoRemove=!1,this.timeBubble=!1},game_shell.ui.PowerupBubble.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.sprite=new PIXI.Sprite(PIXI.TextureCache[config.txId]),this.sprite.anchor.x=this.sprite.anchor.y=.5,this.sprite.visible=!1;var w=this.sprite.texture.frame.width/this.resolution;this.timeBubble?(this.targetX=0,this.autoRemove=!0):this.targetX=.5*this.screenW-.5*w-10,this.createTweenOn(),this.createTweenOff()},game_shell.ui.PowerupBubble.prototype.createTweenOff=function(){var offY=this.screenH*-.5,self=this;this.tweenOff=new TWEEN.Tween(this).to({x:this.targetX,y:offY,counter:7,scale:.5,alpha:0},500).onStart(function(){self._alpha=4,self.gameBus.emit(self.eventExpire)}).onUpdate(function(){self.cos=20*Math.cos(self._counter)}).onComplete(function(){self.sprite.visible=!1}).easing(TWEEN.Easing.Quadratic.In)},game_shell.ui.PowerupBubble.prototype.createTweenOn=function(){var self=(this.sprite,this);this.tweenOn=new TWEEN.Tween(this).to({x:this.targetX,counter:Math.PI,y:0,scale:1},1e3).onStart(function(){self._alpha=1}).onComplete(function(){self.isExtra?self.sprite.visible=!1:self.autoRemove&&self.clear()}).easing(TWEEN.Easing.Quadratic.Out)},Object.defineProperties(game_shell.ui.PowerupBubble.prototype,{x:{get:function(){return this.sprite.x},set:function(value){this.sprite.x=value+this.cos}},y:{get:function(){return this.sprite.y},set:function(value){this.sprite.y=value}},alpha:{get:function(){return this._alpha},set:function(value){this._alpha=value,this.sprite.alpha=this._alpha>1?1:this._alpha}},scale:{get:function(){return this.sprite.scale.x},set:function(value){this.sprite.scale.x=this.sprite.scale.y=value}},counter:{get:function(){return this._counter},set:function(value){this._counter=value}}}),game_shell.ui.PowerupBubble.prototype.clear=function(){this._counter=0,this.cos=0,this.tweenOff.start()},game_shell.ui.PowerupBubble.prototype.activate=function(){this._counter=0,this.cos=0;var sprite=this.sprite;sprite.x=0,this.sprite.y=this.startY,sprite.scale.x=sprite.scale.y=.001,sprite.visible=!0,sprite.alpha=1,this.tweenOn.start()},game_shell.ui.Bonus=function(){this.sprite=null,this._alpha=1,this._scale=1},game_shell.ui.Bonus.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s])},game_shell.ui.Bonus.prototype.fire=function(pt){this.sprite.x=0,this.sprite.y=0,this.alpha=6,this.scale=.4;var targetY=this.sprite.y-150,sprite=this.sprite;new TWEEN.Tween(this).to({y:targetY,alpha:0,scale:1},700).easing(TWEEN.Easing.Quadratic.Out).onComplete(function(){sprite.removeFromParent()}).start()},Object.defineProperties(game_shell.ui.Bonus.prototype,{alpha:{get:function(){return this._alpha},set:function(value){this._alpha=value,value>1&&(value=1),this.sprite.alpha=value}},y:{get:function(){return this.sprite.y},set:function(value){this.sprite.y=value}},scale:{get:function(){return this._scale},set:function(value){this._scale=value,this.sprite.scale.x=this.sprite.scale.y=value}}}),game_shell.ui.ResultPanel=function(){alex.ui.PopupBase.call(this),this.gameBus=null,this.levelProgress=null,this.levelInfo=null,this.font="clare_bold"},game_shell.ui.ResultPanel.prototype=Object.create(alex.ui.PopupBase.prototype),game_shell.ui.ResultPanel.prototype.constructor=game_shell.ui.ResultPanel,game_shell.ui.ResultPanel.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.action=-1,this.next=1,this.menu=2,this.replay=3;var panel=new PIXI.Sprite(PIXI.TextureCache["result_panel.png"]);panel.anchor.x=.5,panel.anchor.y=.5,this.content.addChild(panel),this.continueBtn=this.createBtn("result_next_btn.png",100,this.next),this.menuBtn=this.createBtn("result_menu_btn.png",0,this.menu),this.replayBtn=this.createBtn("result_play_again_btn.png",-100,this.replay),this.header=this.createHeader(),this.numberIcon=this.createTrackNumber(),this.createLabels(),this.scoreField=this.createPoints(),this.createStars(),this.particles=this.createParticles()},game_shell.ui.ResultPanel.prototype.show=function(){this.refresh(),alex.ui.PopupBase.prototype.show.call(this)},game_shell.ui.ResultPanel.prototype.createStars=function(){var x=66,y=-30,starPlaces=new PIXI.Sprite(PIXI.TextureCache["panel_stars.png"]);starPlaces.y=y-3,starPlaces.x=-5,starPlaces.anchor.x=starPlaces.anchor.y=.5,this.content.addChild(starPlaces),this.star1=this._createStar(-x,y),this.star2=this._createStar(-4,y),this.star3=this._createStar(x-8,y)},game_shell.ui.ResultPanel.prototype.refresh=function(){var stars=this.levelProgress.stars;this.star1.visible=stars>0,this.star2.visible=stars>1,this.star3.visible=stars>2;var score=this.levelProgress.finalScore;this.levelProgress.isCompleted||(this.continueBtn.enabled=!1,this.continueBtn.visible=!1,this.menuBtn.x=this.continueBtn.x),this.totalizer(1e3,score)},game_shell.ui.ResultPanel.prototype.totalizer=function(delay,score){var self=this,from={score:0,t:0},to={score:score,t:2},fired=!1;//!this.levelProgress.isCompleted;// - don't fire particles unless completed the level!
new TWEEN.Tween(from).to(to,1e3).delay(delay).onUpdate(function(){var points=Math.floor(this.score),s=self.scoreString(points);self.scoreField.setText(s),!fired&&this.t>1&&(fired=!0,self.particles.fire(0,0,.75))}).start()},game_shell.ui.ResultPanel.prototype.createParticles=function(){var tx=PIXI.TextureCache["star_particle.png"],particles=new game_shell.game.ParticleBase,particleHolder=new PIXI.DisplayObjectContainer;return this.content.addChild(particleHolder),particles.init({texture:tx,root:particleHolder,resolution:this.resolution}),particles},game_shell.ui.ResultPanel.prototype._createStar=function(x,y){var star=new PIXI.Sprite(PIXI.TextureCache["result_star.png"]);return star.anchor.x=star.anchor.y=.5,star.x=x,star.y=y,this.content.addChild(star),star},game_shell.ui.ResultPanel.prototype.createLabels=function(){var pointsLabel=new PIXI.Sprite(PIXI.TextureCache["label_points.png"]);pointsLabel.x=71,pointsLabel.y=16,this.content.addChild(pointsLabel);var scoreLabel=new PIXI.Sprite(PIXI.TextureCache["label_you_scored.png"]);scoreLabel.x=-117,scoreLabel.y=12,this.content.addChild(scoreLabel)},game_shell.ui.ResultPanel.prototype.createPoints=function(){var pt=30*this.resolution,style={font:pt.toString()+"pt "+this.font,tint:5986374},field=new PIXI.BitmapText("000000",style);return field.scale.x=field.scale.y=1/this.resolution,field.y=10,field.updateText(),field.x=field.width*-.5,this.content.addChild(field),field},game_shell.ui.ResultPanel.prototype.scoreString=function(score){var s,num=score.toString();return s=10>score?"00000"+num:100>score?"0000"+num:1e3>score?"000"+num:1e4>score?"00"+num:1e5>score?"0"+num:num},game_shell.ui.ResultPanel.prototype.createTrackNumber=function(){var s,index=this.levelInfo.index+1;s=10>index?"0"+index+".png":index.toString()+".png";var tx=PIXI.TextureCache[s],indexSprite=new PIXI.Sprite(tx);indexSprite.anchor.x=.5,indexSprite.anchor.y=.5,indexSprite.y=this.header.y;var w=this.header.texture.frame.width/this.resolution;return indexSprite.x=w*-.5-30,this.content.addChild(indexSprite),indexSprite},game_shell.ui.ResultPanel.prototype.createHeader=function(){var titleTx;switch(this.levelInfo.location){case 0:titleTx=PIXI.TextureCache["result_canyon_title.png"];break;case 1:titleTx=PIXI.TextureCache["result_market_title.png"];break;case 2:titleTx=PIXI.TextureCache["result_rooftop_title.png"]}var header=new PIXI.Sprite(titleTx);return header.anchor.x=.5,header.y=-100,this.content.addChild(header),header},game_shell.ui.ResultPanel.prototype.createBtn=function(img,x,action){var btn=new alex.display.Button(img);btn.x=x,btn.y=100,this.content.addChild(btn);var self=this;return btn.on("release",function(){self.action=action,self.hide()}),btn},game_shell.ui.ResultPanel.prototype.onHidden=function(){this.root.removeFromParent(),this.action===this.next?this.gameBus.emit({type:"next"}):this.action===this.menu?this.gameBus.emit({type:"menu"}):this.action===this.replay&&this.gameBus.emit({type:"replay"}),alex.ui.PopupBase.prototype.onHidden.call(this)},game_shell.ui.PausePanel=function(){this.screenH=320,alex.ui.PopupBase.call(this),this.tweenTime=150,this.gameBus=null},game_shell.ui.PausePanel.prototype=Object.create(alex.ui.PopupBase.prototype),game_shell.ui.PausePanel.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);var panel=new PIXI.Sprite(PIXI.TextureCache["pause_panel.png"]);panel.anchor.x=.5,panel.y=this.screenH*-.5,this.content.addChild(panel),this.action=-1,this.resume=1,this.quit=2;var self=this,btnResume=new alex.display.Button("btn_resume.png");btnResume.on("release",function(){self.action=self.resume,self.hide()}),btnResume.y=-55,this.content.addChild(btnResume);var btnQuit=new alex.display.Button("btn_quit.png");btnQuit.on("release",function(){self.action=self.quit,self.hide()}),btnQuit.y=25,this.content.addChild(btnQuit),this.content.y=-this.screenH},game_shell.ui.PausePanel.prototype.onHidden=function(){this.root.removeFromParent(),this.action===this.quit?this.gameBus.emit({type:"quit"}):this.action===this.resume&&this.gameBus.emit({type:"pause"}),alex.ui.PopupBase.prototype.onHidden.call(this)},game_shell.ui.PausePanel.prototype.createTweenOpen=function(){var self=this,tw=new TWEEN.Tween(this.content).to({y:0},this.tweenTime).easing(TWEEN.Easing.Quadratic.Out).onComplete(function(){self.state=self.states.SHOWN,self.onShown()});return tw},game_shell.ui.PausePanel.prototype.createTweenShut=function(){var self=this,y=-this.screenH;this.content.y=0;var tw=new TWEEN.Tween(this.content).to({y:-this.screenH},this.tweenTime).easing(TWEEN.Easing.Quadratic.In).onComplete(function(){self.state=self.states.HIDDEN,self.onHidden()});return this.content.y=y,tw},game_shell.ui.PausePanel.prototype.show=function(){this.state===this.states.HIDDEN&&(this.state=this.states.OPENING,this.bgQuad.alpha=0,this.content.y=-this.screenH,this.tweenQuadIn.start(),this.tweenOpen.start())},game_shell.game.SoundManager=function(){alex.audio.SndMgr.call(this),this.musicVolume=.4,this.updateList=new alex.utils.UpdateList,this.createLists()},game_shell.game.SoundManager.prototype=Object.create(alex.audio.SndMgr.prototype),game_shell.game.SoundManager.prototype.update=function(delta){this.updateList.update(delta),this.snd.update(delta)},game_shell.game.SoundManager.prototype.playTitleLoop=function(){this.play("title_loop",this.musicVolume,!0)},game_shell.game.SoundManager.prototype.stopTitleLoop=function(){this.fadeOut("title_loop")},game_shell.game.SoundManager.prototype.playEndLoop=function(){this.play("end_loop",this.musicVolume,!0)},game_shell.game.SoundManager.prototype.stopEndLoop=function(){this.fadeOut("end_loop")},game_shell.game.SoundManager.prototype.playGameIntro=function(){if(this.webAudio){var startTime=this.snd.context.currentTime,channel=this.play("theme_start",this.musicVolume),duration=channel.duration;-1===duration&&(duration=channel.channel.buffer.duration);var endTime=startTime+duration,soundTracker=new game_shell.game.SoundTracker;soundTracker.init({snd:this,loopId:"music_loop",volume:this.musicVolume,endTime:endTime}),this.updateList.add(soundTracker);var self=this;soundTracker.on("complete",function(){self.updateList.remove(soundTracker)})}},game_shell.game.SoundManager.prototype.stopGameMusic=function(){this.webAudio&&(this.updateList.length>0?(this.updateList.purge(),this.fadeOut("theme_start")):this.fadeOut("music_loop"))},game_shell.game.SoundManager.prototype.createLists=function(){this.jumps=new alex.utils.Sequence(["jump_1","jump_2","jump_3","jump_4","jump_5","jump_6","jump_7","jump_8","jump_9"],!0),this.pussHit=new alex.utils.Sequence(["puss_hit_1","puss_hit_2","puss_hit_3"],!0),this.canPlayThief=!0,this.thief=new alex.utils.Sequence(["thief_1","thief_2","thief_3","thief_4","thief_1","thief_2","thief_3","thief_4","thief_vo_1","thief_vo_2","thief_vo_3","thief_vo_4","thief_vo_5"],!0),this.thiefEnd=this._thiefEnd.bind(this)},game_shell.game.SoundManager.prototype.playPussHit=function(){var sfx=this.pussHit.next();this.play(sfx)},game_shell.game.SoundManager.prototype.playThief=function(){if(this.webAudio){if(this.canPlayThief){this.canPlayThief=!1;var sfx=this.thief.next(),channel=this.play(sfx);channel.on("complete",this.thiefEnd)}}else this.play(this.thief.next())},game_shell.game.SoundManager.prototype._thiefEnd=function(){this.canPlayThief=!0},game_shell.game.SoundManager.prototype.playJump=function(){var sfx=this.jumps.next();this.play(sfx)},game_shell.game.SoundTracker=function(){this.snd=null,this.endTime=-1,this.context=null,this.hasFired=!1,this.loopId="music_loop",this.volume=.5},game_shell.game.SoundTracker.prototype=Object.create(alex.utils.EventDispatcher.prototype),game_shell.game.SoundTracker.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.context=this.snd.snd.context},game_shell.game.SoundTracker.prototype.update=function(delta){if(!this.hasFired&&this.context.currentTime>=this.endTime){this.hasFired=!0;this.snd.play(this.loopId,this.volume,!0);this.emit({type:"complete"})}},game_shell.game.Barrel=function(){this.resolution=1,this.rad=Math.PI/180,this.turn=.5*this.rad,this.turnFast=1*this.rad,this.speed=0,this.baseY=0,this.counter=0,this.range=2,this.bounce=null},game_shell.game.Barrel.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.root=new PIXI.DisplayObjectContainer,this.root.y=this.baseY=config.y,this.root.x=config.x,this.bounce=new alex.motion.TriangleWave,this.bounce.oscillationsPerSec=6,this.build()},game_shell.game.Barrel.prototype.play=function(){this.speed=this.turn},game_shell.game.Barrel.prototype.spin=function(){this.speed=this.turnFast},game_shell.game.Barrel.prototype.stopSpin=function(){this.speed=this.turn},game_shell.game.Barrel.prototype.stop=function(){this.speed=0},game_shell.game.Barrel.prototype.update=function(delta){this.speed>0&&(this.top.rotation+=delta*this.speed,this.bounce.update(delta),this.root.y=this.baseY-this.bounce.value*this.range)},game_shell.game.Barrel.prototype.build=function(){this.back=this._makeSprite("barrell_back.png",-15,-23),this.top=this._makeSprite("barrell_top.png",0,0),this.shadow=this._makeSprite("barrell_shadow.png",-21,-21);var frame=this.top.texture.frame,w=frame.width,h=frame.height;this.top.pivot.x=.5*w/this.resolution,this.top.pivot.y=.5*h/this.resolution},game_shell.game.Barrel.prototype._makeSprite=function(txId,x,y){var sprite=new PIXI.Sprite(PIXI.TextureCache[txId]);return sprite.x=x,sprite.y=y,this.root.addChild(sprite),sprite},game_shell.game.Barrel.prototype.dispose=function(){},game_shell.game.Player=function(){game_shell.physics.GameObject.call(this),this.bodyTypes=game_shell.physics.BodyTypes,this.type=this.bodyTypes.ROLLING_BARREL,this.resolution=1,this.diameter=47,this.speed=-.4,this.maxSpeed=-2,this.jumpPower=4,this.deadY=-4,this.underY=-.2,this.isFlying=!1,this.gravity=-10,this.states={dead:1,playing:2,complete:3},this.state=this.states.dead,this.hitPause=0,this.maxJumps=2,this.jumpsAllowed=this.maxJumps,this.barrel=null,this.hitTracker=null,this.puss=null,this.snd=null,this.gameBus=null,this.powerTypes=game_shell.game.PowerupTypes,this.powerupController=null,this.events=new alex.utils.EventDispatcher,this.eventCoin={type:"coin",pt:null},this.eventPowerup={type:"powerup",pt:null,power:-1},this.eventInvincible={type:"invincible",obstacle:null},this.eventDead={type:"dead"},this.eventHit={type:"hit"},this.eventCheckpoint={type:"checkpoint",index:0,extraTime:0,isLast:!1}},game_shell.game.Player.prototype=Object.create(game_shell.physics.GameObject.prototype),game_shell.game.Player.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.build(config),this.addContactListeners(),this.gameBus.on("expired_flight",this._deactivateFlight.bind(this))},game_shell.game.Player.prototype.addContactListeners=function(){this.jump=this._jump.bind(this),this.contactHandler=this._contactHandler.bind(this),this.world.on("beginContact",this.contactHandler)},game_shell.game.Player.prototype._contactHandler=function(event){if(this.state!==this.states.dead){var otherBody=null,didHit=!1;if(event.bodyA.userData===this?(otherBody=event.bodyB,didHit=!0):event.bodyB.userData===this&&(otherBody=event.bodyA,didHit=!0),didHit){var gameObject=otherBody.userData,type=gameObject.type,bodyTypes=this.bodyTypes;type===bodyTypes.COIN?gameObject.collected||(gameObject.collect(),this.eventCoin.pt=gameObject.graphics.position,this.events.emit(this.eventCoin)):type===bodyTypes.POWERUP_INVINCIBLE?gameObject.collected||(gameObject.collect(),this.eventPowerup.power=this.powerTypes.INVINCIBILITY,this.eventPowerup.pt=gameObject.graphics.position,this.events.emit(this.eventPowerup)):type===bodyTypes.POWERUP_FLIGHT?gameObject.collected||(gameObject.collect(),this.eventPowerup.power=this.powerTypes.FLIGHT,this.eventPowerup.pt=gameObject.graphics.position,this.events.emit(this.eventPowerup)):type==bodyTypes.OBSTACLE?this.powerupController.hasInvincibility?gameObject.wasHit||gameObject.isPit||(gameObject.hit(),this.eventInvincible.obstacle=gameObject,this.events.emit(this.eventInvincible)):gameObject.active&&!gameObject.wasHit&&this.hitObstacle(gameObject):type==bodyTypes.FALLING_PLATFORM?gameObject.hasFallen||(this.jumpsAllowed=this.maxJumps,gameObject.fall()):type==bodyTypes.CHECK_POINT?this.body.position[1]>0&&!gameObject.triggered&&(gameObject.activate(),this.eventCheckpoint.index=gameObject.index,this.eventCheckpoint.isLast=gameObject.isLast,this.eventCheckpoint.extraTime=gameObject.extraTime,this.events.emit(this.eventCheckpoint)):this.body.position[1]>this.underY&&(this.jumpsAllowed=this.maxJumps,this.barrel.speed>this.barrel.turn&&this.barrel.stopSpin())}}},game_shell.game.Player.prototype.start=function(){this.puss.play(),this.barrel.play(),this.motionTracker.start(),this.state=this.states.playing},game_shell.game.Player.prototype.die=function(){this.hitPause=1500,this.state=this.states.dead,this.puss.play("dead"),this.barrel.stop(),this.motionTracker.stop(),this.snd.play("puss_die")},game_shell.game.Player.prototype.hitObstacle=function(gameObject){this.body.velocity[0]=0,this.motionTracker.stop();var isDead=this.hitTracker.hit();isDead?this.die():(gameObject.doTimeout(),this.hitPause=750,this.puss.play("hit"),this.events.emit(this.eventHit),this.snd.play("hit_hazard_2"),this.snd.playPussHit())},game_shell.game.Player.prototype.recover=function(){this.motionTracker.start()},game_shell.game.Player.prototype.reset=function(pt){var v=this.body.velocity;v[0]=0,v[1]=0,this.hitTracker.reset(),this.hitPause=0,this.setPosition(pt),this.draw(),this.state=this.states.dead,this.puss.play("stand"),this.barrel.stop(),this.motionTracker.stop()},game_shell.game.Player.prototype.respawn=function(pt){var v=this.body.velocity;v[0]=0,v[1]=0,this.puss.play(),this.barrel.play(),this.hitTracker.reset(),this.hitPause=0,this.setPosition(pt),this.state=this.states.playing,this.motionTracker.start(),this.snd.play("respawn")},game_shell.game.Player.prototype.jumpAnimation=function(){1===this.jumpsAllowed?(this.puss.play("jump1"),this.barrel.spin()):this.puss.play("jump2"),this.snd.playJump()},game_shell.game.Player.prototype._jump=function(){if(!(this.state===this.states.dead||this.hitPause>0)){var jumpPower=this.jumpPower,isFlying=this.powerupController.hasFlight;if(isFlying&&(this.jumpsAllowed=1,jumpPower=1),this.jumpsAllowed>0){this.jumpsAllowed--,isFlying||this.jumpAnimation();var v=this.body.velocity;v[1]=jumpPower}}},game_shell.game.Player.prototype.activateFlight=function(){this.body.world.gravity[1]=-1,this.body.setZeroForce(),this.isFlying=!0,this.glow.visible=!0,this.barrel.stop(),this.puss.play("stand"),this.particles.emit(2)},game_shell.game.Player.prototype._deactivateFlight=function(){this.body.world.gravity[1]=this.gravity,this.isFlying=!1,this.glow.visible=!1,this.barrel.play(),this.puss.play()},game_shell.game.Player.prototype.levelComplete=function(){this.state=this.states.complete},game_shell.game.Player.prototype.update=function(delta){this.barrel.update(delta),this.motionTracker.update(delta);var v=this.body.velocity;this.hitPause>0?(this.hitPause-=delta,v[0]=0,this.hitPause<=0&&(this.hitPause=0,this.state===this.states.dead?this.gameBus.emit(this.eventDead):this.recover())):this.body.position[1]>this.underY&&(v[0]+=this.speed,v[0]<this.maxSpeed&&(v[0]=this.maxSpeed));var playerY=this.body.position[1];playerY<this.deadY&&this.gameBus.emit(this.eventDead),this.isFlying&&this.particles.update(delta)},game_shell.game.Player.prototype.build=function(config){var builder=new game_shell.game.PlayerBuilder;config.player=this,config.diameter=this.diameter,builder.init(config)},game_shell.game.Player.prototype.dispose=function(){this.barrel.dispose(),this.puss.dispose()},game_shell.game.PlayerBuilder=function(){this.player=null,this.diameter=1},game_shell.game.PlayerBuilder.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.createPhysicsBody(config),this.player.graphics=this.createGraphics(),this.addPussRect(),this.player.motionTracker=this.createMotionTracker()},game_shell.game.PlayerBuilder.prototype.createMotionTracker=function(){var motionTracker=new game_shell.game.MotionTracker;return motionTracker.init({sprite:this.player.graphics.position,gameBus:this.player.gameBus}),motionTracker},game_shell.game.PlayerBuilder.prototype.createPhysicsBody=function(cf){var config={diameter:this.diameter,mass:this.player.mass,x:cf.x,y:cf.y,resolution:this.player.resolution},circleShape=this.player.createCircle(config),body=this.player.body;body.fixedRotation=!0,body.type=p2.Body.DYNAMIC,body.updateMassProperties();var frame=this.player.frame;return frame.width=this.diameter,frame.height=this.diameter,circleShape},game_shell.game.PlayerBuilder.prototype.addPussRect=function(){var pussRect=new p2.Rectangle(.35,.7),rectPosition=[0,.65];this.player.body.addShape(pussRect,rectPosition),this.debug&&this.debugPussRect(pussRect,rectPosition)},game_shell.game.PlayerBuilder.prototype.debugPussRect=function(rect,position){var gfx=this.player.graphicsRect(rect);gfx.x=position[0]*this.player.scaling,gfx.y=position[1]*-this.player.scaling,this.player.graphics.addChild(gfx)},game_shell.game.PlayerBuilder.prototype.createGraphics=function(){var root=new PIXI.DisplayObjectContainer,y=.5*this.diameter;return this.player.glow=this.createGlow(y),root.addChild(this.player.glow),this.player.particles=this.createParticles(root,y),this.player.barrel=this.createBarrel(0),root.addChild(this.player.barrel.root),this.player.puss=this.createPussInBoots(y),root.addChild(this.player.puss.root),root},game_shell.game.PlayerBuilder.prototype.createGlow=function(y){var glow=new PIXI.Sprite(PIXI.TextureCache["puss_glow.png"]);return glow.anchor.x=.5,glow.anchor.y=1,glow.y=y,glow.visible=!1,glow},game_shell.game.PlayerBuilder.prototype.createParticles=function(root,y){var particleRoot=new PIXI.DisplayObjectContainer;root.addChild(particleRoot),particleRoot.y=-60;var particles=new game_shell.game.PussParticles;return particles.init({texture:PIXI.TextureCache["glow_particle.png"],root:particleRoot,resolution:this.resolution}),particles},game_shell.game.PlayerBuilder.prototype.createPussInBoots=function(y){var armatureData={armatureName:"puss_on_barrel",skeletonId:"puss_on_barrel",skeletonJSON:game_shell.json.puss_on_barrel,atlasJson:game_shell.json.game,animationId:"stand",partsList:["hit_star.png","leg_hit1.png","leg_hit2.png","puss_body.png","puss_curled.png","puss_foot_L.png","puss_foot_R.png","puss_forearm_L.png","puss_forearm_L2.png","puss_forearm_R.png","puss_forearm_R2.png","puss_head.png","puss_head2.png","puss_shin_L.png","puss_shin_R.png","puss_thigh_L.png","puss_thigh_R.png","puss_upperArm_L.png","puss_upperArm_R.png","tail2.png","tail3.png"]},puss=new dragonBones.BonesSprite;return puss.init({armatureData:armatureData,x:0,y:y}),puss.on("complete",function(event){"idle"!=event.timeline&&"dead"!=event.timeline&&puss.play()}),puss},game_shell.game.PlayerBuilder.prototype.createBarrel=function(y){var barrel=new game_shell.game.Barrel;return barrel.init({x:0,y:y,resolution:this.player.resolution}),barrel.stop(),barrel},game_shell.game.MotionTracker=function(){this.sprite=null,this.timer=!1,this.x=0,this.minDist=10,this.gameBus=null,this.ticks=0,this.maxTicks=3,this.eventDie={type:"motion_die"}},game_shell.game.MotionTracker.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.timer=this.createTimer()},game_shell.game.MotionTracker.prototype.createTimer=function(){var timer=new alex.utils.Timer;return timer.on("timer",this._tick.bind(this)),timer},game_shell.game.MotionTracker.prototype._tick=function(){var distX=this.sprite.x-this.x;this.x=this.sprite.x,distX<this.minDist?(this.ticks++,this.ticks>this.maxTicks&&(this.stop(),this.gameBus.emit(this.eventDie))):this.ticks=0},game_shell.game.MotionTracker.prototype.start=function(){this.x=this.sprite.x,this.ticks=0,this.timer.start()},game_shell.game.MotionTracker.prototype.stop=function(){this.timer.stop()},game_shell.game.MotionTracker.prototype.update=function(delta){this.timer.update(delta)},game_shell.game.RespawnController=function(){this.player=null,this.spawnPoints=null,this.resetItems=null,this.obstacleController=null,this.checkpoints=null,this.levelStats=null},game_shell.game.RespawnController.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.respawn=this._respawn.bind(this)},game_shell.game.RespawnController.prototype.getSpawnPoint=function(){for(var points=this.checkpoints,i=points.length-2,checkpoint=null,playerX=this.player.x,index=0;i>-1;i--)if(checkpoint=points[i],playerX<-checkpoint.root.x){index=checkpoint.index;break}game_shell.config.CHEAT_START>index&&(index=game_shell.config.CHEAT_START);var pt=this.spawnPoints[index];return pt},game_shell.game.RespawnController.prototype._respawn=function(){var pt=this.getSpawnPoint();this.player.respawn(pt),this.levelStats.respawns++;var resetItem,i,n=this.resetItems.length;for(i=0;n>i;i++)resetItem=this.resetItems[i],resetItem.reset();this.obstacleController.respawn(pt.x)},game_shell.game.PowerupController=function(){this.powerupTypes=game_shell.game.PowerupTypes,this.timeout=new alex.utils.DelayedAction,this.root=null,this.gameBus=null,this.screenH=0,this.screenW=0,this.cheatInvincible=!1,this.invincibilityBubble=null,this.extraInvinvibility=null,this.invincibilityDuration=5e3,this.timeoutInvincibility=null,this.eventExpiredInvincibility={type:"expired_invincibility"},this.flightBubble=null,this.extraFlightBubble=null,this.flightDuration=3e3,this.timeoutFlight=null,this.eventExpiredFlight={type:"expired_flight"}},game_shell.game.PowerupController.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.root=new PIXI.DisplayObjectContainer,this.endInvincibility=this._endInvincibility.bind(this),this.invincibilityBubble=this.createBubble("potion.png",this.powerupTypes.INVINCIBILITY),this.extraInvinvibility=this.createBubble("potion.png",this.powerupTypes.INVINCIBILITY),this.extraInvinvibility.isExtra=!0,this.cheatInvincible&&(this.invincibilityDuration=9999e3,this.timeoutInvincibility={_targetTime:1e5}),this.endFlight=this._endFlight.bind(this),this.flightBubble=this.createBubble("red_potion.png",this.powerupTypes.FLIGHT),this.extraFlightBubble=this.createBubble("red_potion.png",this.powerupTypes.FLIGHT),this.extraFlightBubble.isExtra=!0},game_shell.game.PowerupController.prototype.createBubble=function(txId,type){var bubble=new game_shell.ui.PowerupBubble;return bubble.init({type:type,timeBubble:!1,txId:txId,gameBus:this.gameBus,resolution:this.resolution,screenW:this.screenW,screenH:this.screenH}),this.root.addChild(bubble.sprite),bubble},game_shell.game.PowerupController.prototype.reset=function(){this.flightBubble.sprite.visible=!1,this.extraFlightBubble.sprite.visible=!1,this.invincibilityBubble.sprite.visible=!1,this.extraInvinvibility.sprite.visible=!1},game_shell.game.PowerupController.prototype.update=function(delta){this.timeout.update(delta)},Object.defineProperties(game_shell.game.PowerupController.prototype,{hasInvincibility:{get:function(){return null!==this.timeoutInvincibility}},hasFlight:{get:function(){return null!==this.timeoutFlight}}}),game_shell.game.PowerupController.prototype.getInvincibility=function(){console.log("getInvincibility");var newPower=!0;return this.timeoutInvincibility?(this.timeoutInvincibility._targetTime+=this.invincibilityDuration,this.extraInvinvibility.activate(),newPower=!1):(this.timeoutInvincibility=this.timeout.delay(this.endInvincibility,this.invincibilityDuration),this.invincibilityBubble.activate()),newPower},game_shell.game.PowerupController.prototype._endInvincibility=function(){var self=this;this.timeout.delay(function(){self.timeoutInvincibility=null,self.gameBus.emit(self.eventExpiredInvincibility)},500),this.invincibilityBubble.clear()},game_shell.game.PowerupController.prototype.getFlight=function(){console.log("getFlight");var newPower=!0;return this.timeoutFlight?(this.timeoutFlight._targetTime+=this.flightDuration,this.extraFlightBubble.activate(),newPower=!1):(this.timeoutFlight=this.timeout.delay(this.endFlight,this.flightDuration),this.flightBubble.activate()),newPower},game_shell.game.PowerupController.prototype._endFlight=function(){var self=this;this.timeout.delay(function(){self.timeoutFlight=null,self.gameBus.emit(self.eventExpiredFlight)},500),this.flightBubble.clear()},game_shell.game.SpritePinger=function(){this.root=null,this.uiLayer=null,this.sprites=null,this.bonus=null,this.defaultW=1,this.pi=Math.PI,this.defaultTx="cactus_01.png",this.pingTime=500},game_shell.game.SpritePinger.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.root=new PIXI.DisplayObjectContainer,this.hitItem=this._hitItem.bind(this),this.sprites=this.createSequence(this.defaultTx,6),this.bonus=this.createBonus("bonus_popup.png",6)},game_shell.game.SpritePinger.prototype.createSequence=function(txId,length){var list=this.spriteList(txId,length);return new alex.utils.Sequence(list)},game_shell.game.SpritePinger.prototype.spriteList=function(txId,length){length||(length=3);for(var tx=PIXI.TextureCache[txId],list=[],sp=null;list.length<length;)sp=new PIXI.Sprite(tx),sp.anchor.x=sp.anchor.y=.5,list[list.length]=sp;return list},game_shell.game.SpritePinger.prototype.createBonus=function(txId,length){var i,sprite,bonus,list=this.spriteList(txId,length),bonuses=[],n=list.length;for(i=0;n>i;i++)sprite=list[i],bonus=new game_shell.ui.Bonus,bonus.init({sprite:sprite}),bonuses[i]=bonus;return new alex.utils.Sequence(bonuses)},game_shell.game.SpritePinger.prototype._hitItem=function(event){var gameObject=event.obstacle,obstacleSprite=gameObject.graphics,sprite=this.sprites.next();sprite.setTexture(obstacleSprite.texture),sprite.x=obstacleSprite.x,sprite.y=obstacleSprite.y;var side=2*Math.random()-1;this.fireHazard(sprite,side);var bonus=this.bonus.next();bonus.fire(),this.uiLayer.addChild(bonus.sprite)},game_shell.game.SpritePinger.prototype.fireHazard=function(hazard,side){hazard.scale.x=hazard.scale.y=.7,hazard.rotation=Math.random()*(this.pi+this.pi),this.root.addChild(hazard);var targetX,targetY=hazard.y-this.screenH,xDist=.25*this.defaultW+.5*Math.random()*this.defaultW;targetX=side>0?hazard.x-xDist:hazard.x+xDist;var spin=-this.pi+Math.random()*(this.pi+this.pi);new TWEEN.Tween(hazard).to({x:targetX,y:targetY},this.pingTime).onUpdate(function(){hazard.rotation+=spin,hazard.scale.x-=.01,hazard.scale.y-=.01}).onComplete(function(){hazard.removeFromParent()}).easing(TWEEN.Easing.Quadratic.Out).start()},game_shell.game.PussParticles=function(){game_shell.game.ParticleBase.call(this)},game_shell.game.PussParticles.prototype=Object.create(game_shell.game.ParticleBase.prototype),game_shell.game.PussParticles.prototype.createEmitter=function(){var texture=this.texture,lx=.35*this.life,ly=.5*this.life,emitter=new Proton.Emitter;return emitter.addInitialize(new Proton.ImageTarget(texture)),emitter.rate=new Proton.Rate(5,.1),emitter.addInitialize(new Proton.Mass(1)),emitter.addInitialize(new Proton.Life(lx,ly)),emitter.addInitialize(new Proton.V(new Proton.Span(.5,1),new Proton.Span(0,360),"polar")),emitter.addBehaviour(new Proton.Alpha(1,[.7,1])),emitter.addBehaviour(new Proton.Scale(Proton.getSpan(.5,1.5),0)),this.proton.addEmitter(emitter),emitter};