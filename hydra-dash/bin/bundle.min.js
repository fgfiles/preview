!function(){function t(e,i,s){function n(a,r){if(!i[a]){if(!e[a]){var h="function"==typeof require&&require;if(!r&&h)return h(a,!0);if(o)return o(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var c=i[a]={exports:{}};e[a][0].call(c.exports,function(t){var i=e[a][1][t];return n(i||t)},c,c.exports,t,e,i,s)}return i[a].exports}for(var o="function"==typeof require&&require,a=0;a<s.length;a++)n(s[a]);return n}return t}()({1:[function(t,e,i){function s(){}var n=t("./Common"),o=t("./general/Goals"),a=t("./managers/SavedData"),r=t("./scenes/EditorScene"),h=t("./scenes/SplashScene"),l=t("./scenes/MapScene"),c=t("./scenes/CharacterScene"),p=t("./scenes/GameScene"),d=t("./scenes/DailyBonusScene"),u=t("./scenes/GameOverScene"),_=t("./scenes/HelpOverlay"),g=t("./scenes/SkillUpgradeOverlay"),m=t("./scenes/PauseOverlay"),y=t("./scenes/CharacterUnlockedOverlay"),f=t("./scenes/CongratulationsOverlay");e.exports=s,s.prototype.init=function(){console.log("[Application] Init"),n.savedData=new a,n.savedData.init(),n.goalsManager=new o,n.goalsManager.init(),window.og.mode&&"editor"==window.og.mode?this.showEditor():this.showSplashScene()},s.prototype.showEditor=function(){var t=new r;n.sceneManager.add(t,this._getSceneTransition()),n.currentScene=t},s.prototype.showDailyBonusScene=function(){var t=new d;n.sceneManager.add(t,this._getSceneTransition()),n.currentScene=t,t.signals.next.addOnce(function(){this.showSplashScene()},this)},s.prototype.showSplashScene=function(){if(n.savedData.canAwardDailyBonus())return void this.showDailyBonusScene();var t=new h;n.sceneManager.add(t,this._getSceneTransition()),n.currentScene=t,t.signals.next.addOnce(function(){n.savedData.endless?this.showCharacterScene():this.showMapScene()},this),t.signals.guiClick.add(function(t){switch(t){case"help":this.showHelpOverlay("splash")}},this)},s.prototype.showMapScene=function(){var t=new l;n.sceneManager.add(t,this._getSceneTransition()),n.currentScene=t,t.signals.next.addOnce(function(){this.showCharacterScene()},this),t.signals.previous.addOnce(function(){this.showSplashScene()},this),t.signals.guiClick.add(function(t){switch(t){case"help":this.showHelpOverlay("map")}},this)},s.prototype.showCharacterScene=function(){var t=new c;n.sceneManager.add(t,this._getSceneTransition()),n.currentScene=t,t.signals.next.addOnce(function(){this.showGameScene()},this),t.signals.previous.addOnce(function(){n.savedData.endless?this.showSplashScene():this.showMapScene()},this),t.signals.skillUpgrade.add(function(t){this.showSkillUpgradeOverlay(t)},this),t.signals.showUnlockedCharacter.add(function(t){this.showUnlockedCharacterOverlay(t)},this),t.signals.guiClick.add(function(t){switch(t){case"help":this.showHelpOverlay("character")}},this)},s.prototype.showGameScene=function(){var t=new p;n.sceneManager.add(t,this._getSceneTransition()),n.currentScene=t,t.signals.next.addOnce(function(){this.showGameOverScene()},this),t.signals.help.addOnce(function(){this.showHelpOverlay("game")},this),t.signals.guiClick.add(function(t){"pause"==t&&this.showPauseOverlay()},this)},s.prototype.showGameOverScene=function(){var t=new u;n.sceneManager.add(t,this._getSceneTransition()),n.currentScene=t,t.signals.previous.addOnce(function(){this.showSplashScene()},this),t.signals.next.addOnce(function(){n.savedData.endless?this.showCharacterScene():this.showMapScene()},this),t.signals.showCongratulations.add(function(t){this.showCongratulationsOverlay(t)},this),t.signals.guiClick.addOnce(function(t){"home"==t?this.showSplashScene():"restart"==t&&this.showGameScene()},this)},s.prototype.showHelpOverlay=function(t){TweenMax.pauseAll();var e=new _(t);n.sceneManager.add(e,this._getSceneTransition()),n.currentScene=e,e.signals.previous.add(function(){n.sceneManager.remove(),n.currentScene=n.sceneManager._stack[0],TweenMax.resumeAll()},this);var i=new p3.Transition;i.replace=!1,i.push=!0,n.sceneManager.add(e,i)},s.prototype.showSkillUpgradeOverlay=function(t){var e=new g(t);n.sceneManager.add(e,this._getSceneTransition()),n.currentScene=e,e.signals.previous.addOnce(function(){n.sceneManager.remove(),n.currentScene=n.sceneManager._stack[0]},this),e.signals.next.addOnce(function(t){n.sceneManager.remove(),n.currentScene=n.sceneManager._stack[0],n.currentScene.buySkill(t)},this);var i=new p3.Transition;i.replace=!1,i.push=!0,n.sceneManager.add(e,i)},s.prototype.showUnlockedCharacterOverlay=function(t){TweenMax.pauseAll();var e=new y(t);n.sceneManager.add(e,this._getSceneTransition()),n.currentScene=e,e.signals.previous.addOnce(function(){n.sceneManager.remove(),n.currentScene=n.sceneManager._stack[0],TweenMax.resumeAll()},this);var i=new p3.Transition;i.replace=!1,i.push=!0,n.sceneManager.add(e,i)},s.prototype.showCongratulationsOverlay=function(t){TweenMax.pauseAll();var e=new f(t||"levels");n.sceneManager.add(e,this._getSceneTransition()),n.currentScene=e,e.signals.next.addOnce(function(){n.sceneManager.remove(),n.currentScene=n.sceneManager._stack[0],TweenMax.resumeAll()},this);var i=new p3.Transition;i.replace=!1,i.push=!0,n.sceneManager.add(e,i)},s.prototype.showPauseOverlay=function(){TweenMax.pauseAll();var t=new m;n.sceneManager.add(t,this._getSceneTransition()),n.currentScene=t,t.signals.previous.addOnce(function(){n.sceneManager.remove(),n.currentScene=n.sceneManager._stack[0],TweenMax.resumeAll()},this),t.signals.restart.addOnce(function(){this.showGameScene()},this),t.signals.home.addOnce(function(){this.showSplashScene()},this);var e=new p3.Transition;e.replace=!1,e.push=!0,n.sceneManager.add(t,e)},s.prototype._getSceneTransition=function(){var t=new p3.FadeTransition;return t.interactive=!0,t.wait=!1,t.push=!1,t.replace=!0,t},s.prototype._getOverlayTransition=function(){var t=new p3.Transition;return t.replace=!1,t.push=!0,t}},{"./Common":3,"./general/Goals":61,"./managers/SavedData":65,"./scenes/CharacterScene":66,"./scenes/CharacterUnlockedOverlay":67,"./scenes/CongratulationsOverlay":68,"./scenes/DailyBonusScene":69,"./scenes/EditorScene":70,"./scenes/GameOverScene":71,"./scenes/GameScene":72,"./scenes/HelpOverlay":73,"./scenes/MapScene":74,"./scenes/PauseOverlay":75,"./scenes/SkillUpgradeOverlay":78,"./scenes/SplashScene":79}],2:[function(t,e,i){"use strict";function s(){var t=this.getSpec();t&&(this.height=t[0],window.addEventListener("resize",this.onResize.bind(this)),this.div=document.createElement("div"),this.div.style.backgroundColor="#000000",this.div.style.position="absolute",this.div.style.top="0",this.div.style.left="0",this.div.style.width="100%",this.div.style.height="9999999999999999px",this.image=new Image,this.image.src="assets/system/brim.png",this.image.style.position="absolute",this.image.style.top="-35px",this.image.width=0,this.div.appendChild(this.image),this.brimMode=!0,document.body.appendChild(this.div),function(){var t;document.addEventListener("touchstart",function(e){this.brimMode&&(t=!0,e.preventDefault(),e.returnValue=!1)},!1),document.addEventListener("touchmove",function(e){this.brimMode&&(t&&(e.preventDefault(),e.returnValue=!1),t=!1)},!1)}(),this.onResize())}t("./Common");e.exports=s,s.prototype.getSpec=function(){for(var t=[[320,480,2,"iPhone 4"],[320,568,2,"iPhone 5 or 5s"],[375,667,2,"iPhone 6"],[414,736,3,"iPhone 6 plus"]],e=0;e<t.length;e++){var i=t[e],s=window.screen.height==i[0]&&window.screen.width==i[1]||window.screen.width==i[0]&&window.screen.height==i[1];if(s)return i}return null},s.prototype.showBrim=function(){this.div.style.visibility="visible",this.div.style.height="9999999999999999px"},s.prototype.showGame=function(){this.div.style.visibility="hidden",this.div.style.height=this.height+1+"px",window.scrollTo(0,0)},s.prototype.onResize=function(){window.innerHeight>window.innerWidth||window.innerHeight===this.height?this.showGame():this.showBrim(),this.image.width=window.innerWidth,window.scrollTo(0,0)}},{"./Common":3}],3:[function(t,e,i){"use strict";var s={};e.exports=s,s.STAGE_WIDTH=1900,s.STAGE_HEIGHT=768,s.view=null,s.stage=null,s.renderer=null,s.isWebGL=null,s.gameDir="",s.paths={audio:"assets/audio/",data:"assets/data/",fonts:"assets/fonts/",images:"assets/images/",localisation:"assets/images/localisation/",particles:"assets/particles/",scripts:"scripts/",spine:"assets/spine/",system:"assets/system/"},s.sceneManager=null,s.currentScene=null,s.app=null,s.config=null,s.assets=null,s.audio=null,s.language="en",s.keyboard=null,s.touch=new PIXI.Point(0,0),s.touching=!1,s.mouseInput=null,s.delta=null,s.fpsMeter=null,s.FPS=60,s.frameCount=0,s.paused=!1,s.timestep=null,s.queueCalls=null,s.animator=null,s.emitter=null,s.colours={black:0,white:16777215,blue:13311,red:16724736,green:65280,yellow:16776960,pink:16738047},s.textures={},s.lowPerformance=!1,s.savedData=null,s.displayObjects=null,s.createText=function(t,e){if(t+="","undefined"!=typeof s.copy[t]&&(t=s.copy[t][s.language]),e||(e={}),e.size=e.size||40,e.color=e.color||16777215,e.align=e.align||"center",e.strokeColor=e.stroke||0,e.strokeThickness=e.strokeThickness||8,e.bitmapFont=e.bitmapFont||s.bitmapFont,e.upperCase=e.upperCase||!0,e.upperCase&&(t=t.toUpperCase()),s.webfont)var t=new PIXI.Text(t,{fontFamily:s.liveFont,fontSize:e.size+"px",fill:e.color,align:e.align,stroke:e.strokeColor,strokeThickness:e.strokeThickness,padding:e.strokeThickness,lineJoin:"round"});else var t=new PIXI.extras.BitmapText(t,{font:e.size+"px "+e.bitmapFont,tint:e.color,align:e.align});return t.anchor.set(.5),t}},{}],4:[function(t,e,i){function s(t,e,i){this._width=t,this._height=e,this._preloader=null,this._game=null,this._scale="1x",d.language=i}var n=t("./Application"),o=t("./audio/AudioManager"),a=(t("./Brim"),t("./common/DisplayObjectManager")),r=t("./common/Keyboard"),h=t("./common/MouseInput"),l=t("./common/QueueCalls"),c=t("./common/Emitter"),p=t("./managers/OmnitureStats"),d=t("./Common"),u=t("./scenes/PreloaderScene");e.exports=s,s.prototype.init=function(){var t=new p3.ViewParams;t.holderId="game",t.width=this._width,t.height=this._height,t.rotateImageUrl="./assets/system/rotate_device.jpg",t.rotateImageColor="#000000",PIXI.settings.RETINA_PREFIX=/\_(?=[^_]*$)(.+)x/,p3.Device.init(window.bowser),p3.Device.isMobile?p3.log=function(){}:p3.log=console.log,TweenMax.defaultOverwrite="none",TweenMax.ticker.fps(d.FPS),d.view=new p3.View(t),d.view.signals.ready.addOnce(this.onViewReady,this),d.view.signals.resize.add(this.onCanvasResize,this),window.addEventListener("resize",function(){this.onCanvasResize()}.bind(this),!1)},s.prototype.onViewReady=function(t){t.screencanvas=!0;var e=null!==navigator.userAgent.match(/Kindle|Silk|KFA/),i={};i.view=t,i.transparent=e,i.antialias=!1,i.preserveDrawingBuffer=!1,i.resolution=1,d.stage=new PIXI.Container,p3.Device.isCocoonJS?(d.stage.scale.x=window.innerHeight/this._height,d.stage.scale.y=window.innerHeight/this._height,d.renderer=new PIXI.WebGLRenderer(window.innerWidth,window.innerHeight,i),CocoonJS.App.forwardAsync("CocoonJS.App.pause();")):d.renderer=new PIXI.autoDetectRenderer(this._width,this._height,i),d.renderer.backgroundColor=0,d.isWebGL=d.renderer instanceof PIXI.WebGLRenderer,d.sceneManager=new p3.SceneManager(d.renderer),d.sceneManager.updateAll=!0,d.stage.addChild(d.sceneManager.view),d.assets=p3.AssetManager.instance,d.assets._loader.pre(this.preResource),d.audio=p3.Button.audio=new o;var s=new p3.Timestep(p3.Timestep.VARIABLE);s.init(this.update,this.render,this),d.timestep=s,d.animator=new p3.Animator,d.animator.init(),d.keyboard=new r,d.keyboard.init(window),d.mouseInput=new h,d.mouseInput.init(d.stage),d.queueCalls=new l,d.emitter=new c,d.displayObjects=new a,document.onclick=function(t){window.focus()},this.onCanvasResize(),this.loadPreloader()},s.prototype.loadPreloader=function(){var t=[{name:"strings",url:d.gameDir+d.paths.data+"localization.json"},{name:"config",url:d.gameDir+d.paths.data+"config.json"},{name:"editorConfig",url:d.gameDir+d.paths.images+"editor/config.json"},{name:"preloader_0",url:d.gameDir+d.paths.images+this._scale+"/preloader_0_1x.json"},{name:"preloader_bg",url:d.gameDir+d.paths.images+"localised/preloader_"+d.language+".jpg"},{name:"splash_bg",url:d.gameDir+d.paths.images+this._scale+"/ui_splash_fg.jpg"}];d.assets.addFiles(t),d.assets.signals.complete.addOnce(function(){d.copy=d.assets.getJSON("strings"),d.config=d.assets.getJSON("config"),d.config.editor=d.assets.getJSON("editorConfig"),d.r2l=d.copy.languages[d.language].r2l,d.webfont=d.copy.languages[d.language].webfont,d.liveFont="Arial",d.bitmapFont="Noto",d.bitmapFontTitle="NotoChrome",this.loadAssets()},this),d.assets.load()},s.prototype.loadAssets=function(){this.generateTextures();var t=[{name:"level_01",url:d.gameDir+d.paths.data+"/level_01.json"},{name:"level_02",url:d.gameDir+d.paths.data+"/level_02.json"},{name:"level_03",url:d.gameDir+d.paths.data+"/level_03.json"},{name:"level_04",url:d.gameDir+d.paths.data+"/level_04.json"},{name:"level_05",url:d.gameDir+d.paths.data+"/level_05.json"},{name:"level_06",url:d.gameDir+d.paths.data+"/level_06.json"},{name:"level_07",url:d.gameDir+d.paths.data+"/level_07.json"},{name:"level_08",url:d.gameDir+d.paths.data+"/level_08.json"},{name:"level_09",url:d.gameDir+d.paths.data+"/level_09.json"},{name:"level_10",url:d.gameDir+d.paths.data+"/level_10.json"},{name:"level_11",url:d.gameDir+d.paths.data+"/level_11.json"},{name:"level_12",url:d.gameDir+d.paths.data+"/level_12.json"},{name:"endless_start",url:d.gameDir+d.paths.data+"/endless_start.json"},{name:"endless_000",url:d.gameDir+d.paths.data+"/endless_000.json"},{name:"endless_001",url:d.gameDir+d.paths.data+"/endless_001.json"},{name:"endless_002",url:d.gameDir+d.paths.data+"/endless_002.json"},{name:"endless_003",url:d.gameDir+d.paths.data+"/endless_003.json"},{name:"endless_004",url:d.gameDir+d.paths.data+"/endless_004.json"},{name:"endless_005",url:d.gameDir+d.paths.data+"/endless_005.json"},{name:"endless_006",url:d.gameDir+d.paths.data+"/endless_006.json"},{name:"endless_007",url:d.gameDir+d.paths.data+"/endless_007.json"},{name:"endless_008",url:d.gameDir+d.paths.data+"/endless_008.json"},{name:"endless_009",url:d.gameDir+d.paths.data+"/endless_009.json"},{name:"endless_010",url:d.gameDir+d.paths.data+"/endless_010.json"},{name:"endless_011",url:d.gameDir+d.paths.data+"/endless_011.json"},{name:"endless_012",url:d.gameDir+d.paths.data+"/endless_012.json"},{name:"endless_013",url:d.gameDir+d.paths.data+"/endless_013.json"},{name:"base_one_0_1x",url:d.gameDir+d.paths.images+this._scale+"/base_one_0_1x.json"},{name:"ui_3_0.8x",url:d.gameDir+d.paths.images+this._scale+"/ui_0_0.8x.json"},{name:"ui_3_1.8x",url:d.gameDir+d.paths.images+this._scale+"/ui_1_0.8x.json"},{name:"ui_hd_0_1x",url:d.gameDir+d.paths.images+this._scale+"/ui_hd_0_1x.json"},{name:"bg_base_one",url:d.gameDir+d.paths.images+this._scale+"/bg_base_one.jpg"},{name:"ui_title",url:d.gameDir+d.paths.images+"localised/ui_title_"+d.language+".png"},{name:"font_noto_chrome",url:d.gameDir+d.paths.fonts+"noto_chrome_120.fnt"},{name:"font_noto",url:d.gameDir+d.paths.fonts+"noto_white_56.fnt"},{name:"particle_coin_collect_burst",url:d.gameDir+d.paths.particles+"particle_coin_collect_burst.json"},{name:"particle_explosion_small",url:d.gameDir+d.paths.particles+"particle_explosion_small.json"},{name:"particle_arrow_trail",url:d.gameDir+d.paths.particles+"particle_arrow_trail.json"},{name:"particle_character_slide",url:d.gameDir+d.paths.particles+"particle_character_slide.json"},{name:"particles_splash_dust",url:d.gameDir+d.paths.particles+"particles_splash_dust.json"},{name:"particle_cage_burst",url:d.gameDir+d.paths.particles+"particle_cage_burst.json"},{name:"spine_avengers",url:d.gameDir+d.paths.spine+"avengers_character.json"},{name:"spine_black_widow",url:d.gameDir+d.paths.spine+"avengers_character_black_widow.json"},{name:"spine_hulk",url:d.gameDir+d.paths.spine+"avengers_character_hulk.json"},{name:"spine_enemy",url:d.gameDir+d.paths.spine+"avengers_enemy.json"},{name:"spine_scientist_back",url:d.gameDir+d.paths.spine+"avengers_character_enemy_scientist_back.json"},{name:"spine_rays",url:d.gameDir+d.paths.spine+"ui_motion_rays.json"}];for(var e in d.config)null==d.config[e]&&console.warn("CONFIG: "+e+" IS NULL");for(var e in d.config.editor.path)for(var i in d.config.editor.path[e])t.push({name:d.config.editor.path[e][i],url:d.gameDir+d.paths.images+"editor/"+d.config.editor.path[e][i]+".png"});t=t.concat([{name:"camera_zoom",url:d.gameDir+d.paths.images+"editor/camera_zoom.png"},{name:"level_end",url:d.gameDir+d.paths.images+"editor/level_end.png"},{name:"level_gameover",url:d.gameDir+d.paths.images+"editor/level_gameover.png"},{name:"level_bullettime",url:d.gameDir+d.paths.images+"editor/level_bullettime.png"},{name:"tutorial",url:d.gameDir+d.paths.images+"editor/tutorial.png"},{name:"roll_lock",url:d.gameDir+d.paths.images+"editor/roll_lock.png"},{name:"roll_unlock",url:d.gameDir+d.paths.images+"editor/roll_unlock.png"}]),"editor"==window.og.mode&&(t=t.concat([{name:"theme_01_divider",url:d.gameDir+d.paths.images+"editor/theme_01_divider.png"},{name:"theme_02_divider",url:d.gameDir+d.paths.images+"editor/theme_02_divider.png"},{name:"theme_03_divider",url:d.gameDir+d.paths.images+"editor/theme_03_divider.png"},{name:"enemy_biohaz",url:d.gameDir+d.paths.images+"editor/enemy_biohaz.png"},{name:"enemy_guard",url:d.gameDir+d.paths.images+"editor/enemy_guard.png"},{name:"enemy_scientist",url:d.gameDir+d.paths.images+"editor/enemy_scientist.png"},{name:"enemy_scientist_back",url:d.gameDir+d.paths.images+"editor/enemy_scientist_back.png"},{name:"hint_editor_down",url:d.gameDir+d.paths.images+"editor/hint_editor_down.png"},{name:"hint_editor_up",url:d.gameDir+d.paths.images+"editor/hint_editor_up.png"}]));var s=["music_ingame_action","music_ingame_stealth","music_main_menu_oop","music_menu_map_loop","sfx_btn_click_00","sfx_btn_rollover_00","sfx_jump_00","sfx_generic_land_heavy_00","sfx_generic_land_soft_00","sfx_footstep_black_panther_00","sfx_footstep_black_panther_01","sfx_footstep_black_panther_02","sfx_footstep_black_panther_03","sfx_footstep_black_widow_00","sfx_footstep_black_widow_01","sfx_footstep_black_widow_02","sfx_footstep_black_widow_03","sfx_footstep_captain_america_00","sfx_footstep_captain_america_01","sfx_footstep_captain_america_02","sfx_footstep_captain_america_03","sfx_footstep_falcon_00","sfx_footstep_falcon_01","sfx_footstep_falcon_02","sfx_footstep_falcon_03","sfx_footstep_hawkeye_00","sfx_footstep_hawkeye_01","sfx_footstep_hawkeye_02","sfx_footstep_hawkeye_03","sfx_footstep_hulk_00","sfx_footstep_hulk_01","sfx_footstep_hulk_02","sfx_footstep_hulk_03","sfx_footstep_iron_man_00","sfx_footstep_iron_man_01","sfx_footstep_iron_man_02","sfx_footstep_iron_man_03","sfx_footstep_thor_00","sfx_footstep_thor_01","sfx_footstep_thor_02","sfx_footstep_thor_03","sfx_footstep_snow_00","sfx_footstep_snow_01","sfx_footstep_snow_02","sfx_footstep_snow_03","sfx_surface_slide_loop_00","sfx_ui_powerup_ready_00","sfx_ui_powerup_empty_00","sfx_ui_powerup_activate_00","sfx_coin_pickup_00","sfx_coin_reward_loop_00","sfx_usb_pickup_00","sfx_generic_attack_miss_00","sfx_generic_kick_00","sfx_generic_punch_00","sfx_ironman_shoot_00","sfx_ironman_rocketjump","sfx_captamerica_shield_impact_00","sfx_thor_hammer_smash_00","sfx_hulk_smash_cage_00","sfx_hulk_attack_miss_00","sfx_hawkeye_arrow_fly_00","sfx_hawkeye_arrow_impact_00","sfx_hawkeye_arrow_impact_01","sfx_hawkeye_arrow_impact_02","sfx_blackpanther_leap_00","sfx_laser_trap_set_00","sfx_laser_trap_caught_00","music_game_win_sting","music_game_over_sting"];this._preloader=new u,this._preloader.signals.next.addOnce(this.startGame,this),d.sceneManager.add(this._preloader),t.length?(d.assets.addFiles(t),d.assets.signals.progress.add(this.onLoadingProgress,this),d.assets.signals.complete.addOnce(this.onLoadingCompleted,this),d.assets.load(),d.audio.addSounds(s,[".mp3",".ogg",".m4a"],"assets/audio/")):this.onLoadingCompleted()},s.prototype.startGame=function(){this._game=new n,this._game.init(),d.app=this._game,d.stats=new p("avengers hydra dash"),d.stats.track("game_start")},s.prototype.update=function(){d.sceneManager.update(),d.keyboard.update(),d.animator.update(),d.queueCalls.update(),d.frameCount++},s.prototype.render=function(){d.renderer.render(d.stage)},s.prototype.onLoadingProgress=function(t){this._preloader.loaded=t.progress/100},s.prototype.onLoadingCompleted=function(t,e){window.Spine={},Spine.avengers=e.spine_avengers.spineData,Spine.black_widow=e.spine_black_widow.spineData,Spine.hulk=e.spine_hulk.spineData,Spine.enemy=e.spine_enemy.spineData,Spine.scientist_back=e.spine_scientist_back.spineData,Spine.rays=e.spine_rays.spineData,d.assets.getTexture("ui_map_grid_tile").baseTexture.mipmap=!1,d.assets.getTexture("ingame_progress_bar_on").baseTexture.mipmap=!1,d.assets.getTexture("ingame_progress_bar_off").baseTexture.mipmap=!1,d.assets.getTexture("bg_outside_layer_0").baseTexture.mipmap=!1,d.assets.getTexture("bg_outside_layer_5").baseTexture.mipmap=!1,d.assets.signals.progress.removeAll(),d.assets.signals.complete.removeAll(),this._preloader.loaded=1},s.prototype.onCanvasResize=function(t){t&&(d.renderer&&d.renderer.resize(p3.View.width,p3.View.height),d.sceneManager.resize())},s.prototype.generateTextures=function(){d.textures.placeHolderButtonCircle=PIXI.Texture.BLANK,d.textures.placeHolderButtonRectangle=PIXI.Texture.BLANK},s.prototype.preResource=function(t,e){t.loadType===PIXI.loaders.Resource.TYPE.JSON&&t.onComplete.once(function(t){t.data&&t.data.meta&&(t.data.meta.scale="1")}),e()},s.prototype.buildFontAtlases=function(){d.assets.getFontAtlas=function(t){var e=d.assets.fontAtlases[t];if(!e)throw new Error('[AssetManager.getJSON] - FontAtlas does not exist: "'+t+'".');return e},d.assets._resources.hasOwnProperty("fontAtlases")||(d.assets.fontAtlases={});for(var t in d.assets._resources)if(d.assets._resources.hasOwnProperty(t)){var e=d.assets._resources[t];if(e.data.font){var i=d.assets.getTexture(t+"Image");d.assets.fontAtlases[t]=new FontAtlas(t,e.data,i)}}}},{"./Application":1,"./Brim":2,"./Common":3,"./audio/AudioManager":6,"./common/DisplayObjectManager":8,"./common/Emitter":9,"./common/Keyboard":10,"./common/MouseInput":11,"./common/QueueCalls":12,"./managers/OmnitureStats":64,"./scenes/PreloaderScene":76}],5:[function(t,e,i){"use strict";function s(){this.id=-1,this.howl=null}e.exports=s},{}],6:[function(t,e,i){"use strict";function s(){this._cache={},this._music=null,this._isMuted=!1;var t;"undefined"!=typeof document.hidden?(t="hidden",this.visibilityChange="visibilitychange"):"undefined"!=typeof document.mozHidden?(t="mozHidden",this.visibilityChange="mozvisibilitychange"):"undefined"!=typeof document.msHidden?(t="msHidden",this.visibilityChange="msvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(t="webkitHidden",this.visibilityChange="webkitvisibilitychange"),document.addEventListener(this.visibilityChange,function(){document[t]?Howler.volume(0):Howler.volume(1)},!1)}var n=t("./Audio"),o=t("./AudioParams");e.exports=s,s.prototype.addSounds=function(t,e,i){i=i||"";var s,n,o,a,r,h,l;for(h=0;h<t.length;++h){for(o=i+t[h],o=o.split("/"),n=o[o.length-1],a=[],l=0;l<e.length;++l)r=e[l],a.push(o.join("/")+r);s=new Howl({src:a,volume:1,loop:!1,autoplay:!1}),s.name=n,this._cache[n]=s}},s.prototype.removeSounds=function(t){for(var e,i,s,n=0;n<t.length;++n){e=t[n];for(i in this._cache)if(this._cache.hasOwnProperty(key)&&(s=this._cache[key],s.name==i)){s.unload(),delete this._cache[e];break}}},s.prototype.playSound=function(t,e){e=e||new o;var i=-1;"string"!=typeof t&&(t=t[Math.floor(Math.random()*t.length)]);var s=this._cache[t];if(!s)return console.warn("Could not find sound - "+t),i;i=s.play(),s.volume(e.volume,i),s.loop(e.loop,i),s.__onend=function(){e.callback&&e.callback.call(e.scope)},s.on("end",s.__onend);var a=new n;return a.id=i,a.howl=s,a},s.prototype.playMusic=function(t,e){if(e=e||new o,"string"!=typeof t&&(t=t[Math.floor(Math.random()*(t.length-1))]),this._music&&this._music.name==t)return this._music;var i=this._cache[t];if(!i)return console.warn("Could not find music - "+t),null;if(i.volume(e.volume),i.loop(!0),i.customValues=e.customValues,i.__onend=function(){e.callback&&e.callback.call(e.scope)},i.on("end",i.__onend),p3.Device&&p3.Device.isAndroidStockBrowser&&(i.buffer=!0),e.fadeIn){if(this._music){var s=this._music;this.fadeOut(s,e.fadeIn,function(){this.stop()},s)}this.fadeIn(i,e.fadeIn)}else this._music&&this.stopMusic(),i.play();return this._music=i,i},s.prototype.stopSound=function(t,e){try{var i=this._cache[t];if(!i)return void console.warn("Could not find sound - "+t);i.stop(e)}catch(s){console.error(s)}},s.prototype.pauseSound=function(t,e){try{var i=this._cache[t];if(!i)return void console.warn("Could not find sound - "+t);i.pause(e)}catch(s){console.error(s)}},s.prototype.resumeSound=function(t,e){try{var i=this._cache[t];if(!i)return void console.warn("Could not find sound - "+t);i.play(e)}catch(s){console.error(s)}},s.prototype.fadeSound=function(t,e,i,s,n){try{var o=this._cache[t];if(!o)return void console.warn("Could not find sound - "+t);o.fade(i,s,1e3*n,e)}catch(a){console.error(a)}},s.prototype.stopMusic=function(t){if(this._music){var t=t||this._music.name;this._music.name==t&&(this._music.volume(0),this._music.stop(),this._music.__onend&&this._music.off("end",this._music.__onend),this._music=null)}},s.prototype.mute=function(t){this._isMuted=t,this._isMuted?Howler.mute(!0):Howler.mute(!1)},s.prototype.fadeIn=function(t,e,i,s){e=e||1,t.volume(0),t.play(),t.__volume=0,TweenMax.killTweensOf(t),TweenMax.to(t,e,{__volume:1,ease:Sine.easeInOut,onUpdate:function(t){t.volume(t.__volume)},onUpdateScope:this,onUpdateParams:[t],onComplete:i,onCompleteParams:[t],onCompleteScope:s})},s.prototype.fadeOut=function(t,e,i,s){e=e||1,t.__volume=t._volume,TweenMax.killTweensOf(t),TweenMax.to(t,e,{__volume:0,ease:Sine.easeInOut,onUpdate:function(t){t.volume(t.__volume)},onUpdateScope:this,onUpdateParams:[t],onComplete:i,onCompleteParams:[t],onCompleteScope:s})},s.prototype.setAudioPos3D=function(t,e,i,s,n){s=s||0,n=n||320;var o=i.findLayerForObject(e),a=e.x*(1/o.parallax.x),r=a-i.position.x;r/=Math.abs(r),r==-1?a=Math.min(0,(a+s-i.position.x)/(n-s)):1==r&&(a=Math.max(0,(a-s-i.position.x)/(n-s))),t.howl.pos(a,0,0,t.id)},s.prototype.setAudioPosStereo=function(t,e,i,s,n){s=s||0,n=n||320;var o=i.findLayerForObject(e),a=e.x*(1/o.parallax.x),r=a-i.position.x;r/=Math.abs(r),a=Math.max(0,Math.abs(a-s-i.position.x)/n),a=Math.max(0,Math.min(1,1+(1-a))),t.howl.volume(a,t.id),a=e.x*(1/o.parallax.x),r==-1?a=Math.min(0,(a+s-i.position.x)/(n-s)):1==r&&(a=Math.max(0,(a-s-i.position.x)/(n-s))),a=Math.max(-1,Math.min(1,a)),t.howl.stereo(a,t.id)},Object.defineProperty(s.prototype,"isMute",{get:function(){return this._isMuted}})},{"./Audio":5,"./AudioParams":7}],7:[function(t,e,i){"use strict";function s(){this.volume=1,this.loop=!1,this.delay=0,this.fadeIn=0,this.priority=0,this.callback=null,this.scope=window}e.exports=s},{}],8:[function(t,e,i){"use strict";function s(){}var n=t("../Common");e.exports=s,s.prototype.createContainer=function(t){var e=new PIXI.Container;return this.set(e,t),e},s.prototype.createSprite=function(t){var e=new PIXI.Sprite(t.texture||n.assets.getTexture(t.asset));return this.set(e,t),e},s.prototype.createRectangle=function(t){var e=new PIXI.Graphics;this.set(e,t);var i=t.rect&&void 0!=t.rect.x?t.rect.x:0,s=t.rect&&void 0!=t.rect.y?t.rect.y:0,o=t.rect&&void 0!=t.rect.width?t.rect.width:t.rectWidth,a=t.rect&&void 0!=t.rect.height?t.rect.height:t.rectHeight;if(void 0==o&&(o=0),void 0==a&&(a=0),void 0!=t.fillColour&&e.beginFill(t.fillColour,t.fillAlpha),void 0==t.lineWidth&&void 0==t.lineColour||e.lineStyle(void 0!=t.lineWidth?t.lineWidth:1,void 0!=t.lineColour?t.lineColour:0,t.lineAlpha),e.drawRect(i,s,o,a),t.asTexture){var r=n.renderer.generateTexture(e);return e.destroy(),r}return e},s.prototype.createCircle=function(t){var e=new PIXI.Graphics;this.set(e,t);var i=t.circ&&void 0!=t.circ.x?t.circ.x:0,s=t.circ&&void 0!=t.circ.y?t.circ.y:0,o=t.circ&&void 0!=t.circ.radius?t.circ.radius:t.radius;if(void 0==o&&(o=10),void 0!=t.fillColour&&e.beginFill(t.fillColour,void 0!=t.fillAlpha?t.fillAlpha:1),void 0==t.lineWidth&&void 0==t.lineColour||e.lineStyle(void 0!=t.lineWidth?t.lineWidth:1,void 0!=t.lineColour?t.lineColour:0,t.lineAlpha),e.drawCircle(i,s,o),t.asTexture){var a=n.renderer.generateTexture(e);return e.destroy(),a}return e},s.prototype.set=function(t,e){e=e||{};var i=["x","y","rotation","alpha","tint","visible"];for(var s in i)void 0!=e[i[s]]&&(t[i[s]]=e[i[s]]);void 0!=e.scale&&(t.scale=new PIXI.Point(e.scale,e.scale)),void 0!=e.anchor&&(t.anchor=new PIXI.Point(e.anchor,e.anchor)),t.rotation=void 0!=e.degrees?e.degrees*PIXI.DEG_TO_RAD:t.rotation,t.scale.x=void 0!=e.scaleX?e.scaleX:t.scale.x,t.scale.y=void 0!=e.scaleY?e.scaleY:t.scale.y,t.anchor&&(t.anchor.x=void 0!=e.anchorX?e.anchorX:t.anchor.x,t.anchor.y=void 0!=e.anchorY?e.anchorY:t.anchor.y),void 0!=e.width&&(t.width=e.width),void 0!=e.height&&(t.height=e.height),void 0!=e.parent&&e.parent.addChild(t)},s.prototype.generatePlaceholderButton=function(t,e,i,s){if(null==n.textures["placeholder_text_"+i]){var e=new PIXI.Text(e,{font:"30px Tahoma",fill:0,align:"center"});n.textures["placeholder_text_"+i]=n.renderer.generateTexture(e)}var o,a=n.textures["placeHolderButton"+("circle"==t?"Circle":"Rectangle")],r=new p3.ButtonStates(a,a,a,n.textures["placeholder_text_"+i]);if(s){if(null==n.textures.placeholder_text_unmute){var e=new PIXI.Text("Unmute",{font:"30px Tahoma",fill:0,align:"center"});n.textures.placeholder_text_unmute=n.renderer.generateTexture(e)}r.iconAlt=n.textures.placeholder_text_unmute,o=new p3.MuteButton(r)}else o=new p3.Button(r);return o.animate=!0,o.animateIcon=!1,o.id=i,o},s.prototype.createBitmapText=function(t,e,i){var s=new PIXI.Container,o=BitmapText.ALIGN_CENTER;"center"==i.align?o=BitmapText.ALIGN_CENTER:"left"==i.align?o=BitmapText.ALIGN_LEFT:"right"==i.align&&(o=BitmapText.ALIGN_RIGHT);var a=new BitmapText(t,n.assets.getFontAtlas(e),o);s.addChild(a),Object.defineProperty(s,"text",{get:function(){return a.text},set:function(t){a.text=t}}),a.scale.x=i.scaleX||1,a.scale.y=i.scaleY||1,i.scale&&(a.scale.x=i.scale,a.scale.y=i.scale);var r=void 0!=i.anchorX?i.anchorX:0,h=void 0!=i.anchorY?i.anchorY:0;return i.anchor&&(r=i.anchor,h=i.anchor),a.x=-(a.width*r),a.y=-(a.height*h),s}},{"../Common":3}],9:[function(t,e,i){"use strict";function s(){}var n=t("../Common");e.exports=s,s.prototype.add=function(t,e,i,s,o,a,r,h){void 0==r&&(r=!0),void 0==h&&(h=1),s=s||0,o=o||0;for(var l=p3.AssetManager.instance,c=0;c<e.length;c++)e[c]=l.getTexture(e[c]);var p=new PIXI.particles.Emitter(t,e,l.getJSON(i));return r?p.emit=!0:p.emit=!1,p.updateOwnerPos(s,o),n.animator.add(p),null!=a&&n.animator.setTimeout(function(){this.destroy(p,h)},a,this),p},s.prototype.destroy=function(t,e){null!=t&&(e=e||0,t.emit=!1,n.animator.setTimeout(function(){try{n.animator.remove(t),t.destroy()}catch(e){}},e,this))}},{"../Common":3}],10:[function(t,e,i){"use strict";function s(){this._keysDown=null,this._keysPressed=null,this._keysUp=null,this._keysDownBuffer=[],this._keysDownBufferLength=500}e.exports=s,s.prototype.KEY_TAB=9,s.prototype.KEY_ENTER=13,s.prototype.KEY_SHIFT=16,s.prototype.KEY_CTRL=17,s.prototype.KEY_ALT=18,s.prototype.KEY_ESC=27,s.prototype.KEY_SPACE=32,s.prototype.KEY_LEFT=37,s.prototype.KEY_UP=38,s.prototype.KEY_RIGHT=39,s.prototype.KEY_DOWN=40,s.prototype.KEY_DELETE=46,s.prototype.KEY_A=65,s.prototype.KEY_B=66,s.prototype.KEY_C=67,s.prototype.KEY_D=68,s.prototype.KEY_E=69,s.prototype.KEY_F=70,s.prototype.KEY_G=71,s.prototype.KEY_H=72,s.prototype.KEY_I=73,s.prototype.KEY_J=74,s.prototype.KEY_K=75,s.prototype.KEY_L=76,s.prototype.KEY_M=77,s.prototype.KEY_N=78,s.prototype.KEY_O=79,s.prototype.KEY_P=80,s.prototype.KEY_Q=81,s.prototype.KEY_R=82,s.prototype.KEY_S=83,s.prototype.KEY_T=84,s.prototype.KEY_U=85,s.prototype.KEY_V=86,s.prototype.KEY_W=87,s.prototype.KEY_X=88,s.prototype.KEY_Y=89,s.prototype.KEY_Z=90,
s.prototype.KEY_PLUS=187,s.prototype.KEY_MINUS=189,s.prototype.KEY_F1=112,s.prototype.KEY_F2=113,s.prototype.KEY_F3=114,s.prototype.KEY_F4=115,s.prototype.KEY_F5=116,s.prototype.KEY_F6=117,s.prototype.KEY_F7=118,s.prototype.KEY_F8=119,s.prototype.KEY_F9=120,s.prototype.KEY_F10=121,s.prototype.KEY_F11=122,s.prototype.KEY_F12=123,s.prototype.init=function(t){this.reset(),t.onkeydown=function(t){var e;e=window.event?t.keyCode:t.which,this._keysDown[e]=!this._keysPressed[e],this._keysPressed[e]=!0,window.og&&"editor"!=window.og.mode&&(e!=s.prototype.KEY_UP&&e!=s.prototype.KEY_DOWN&&e!=s.prototype.KEY_RIGHT&&e!=s.prototype.KEY_LEFT&&e!=s.prototype.KEY_SPACE||t.preventDefault()),this._keysDown[e]&&(this._keysDownBuffer.push(e),this._keysDownBuffer.length>=2*this._keysDownBufferLength&&this._keysDownBuffer.splice(this._keysDownBufferLength))}.bind(this),t.onkeyup=function(t){var e;e=window.event?t.keyCode:t.which,this._keysDown[e]=!1,this._keysPressed[e]=!1,this._keysUp[e]=!0}.bind(this),t.focus()},s.prototype.update=function(){this._keysDown={},this._keysUp={}},s.prototype.reset=function(){this._keysDown={},this._keysPressed={},this._keysUp={}},s.prototype.getKeyPressed=function(t){if(t instanceof Array){for(var e=0;e<t.length;e++)if(!this.getKeyPressed(t[e]))return!1;return!0}return this._keysPressed[t]},s.prototype.getKeyJustPressed=function(t){if(t instanceof Array){for(var e=0,i=0;i<t.length;i++)if(this.getKeyJustPressed(t[i]))e++;else if(!this.getKeyPressed(t[i]))return!1;return e>=1}return!!this._keysDown[t]},s.prototype.getKeyJustReleased=function(t){if(t instanceof Array){for(var e=0;e<t.length;e++)if(this.getKeyJustReleased(t[e]))return!0;return!1}return this._keysUp[t]},s.prototype.clearBuffer=function(){this._keysDownBuffer=[]},s.prototype.getLastKeyPressed=function(){return this._keysDownBuffer.length>0&&this._keysDownBuffer[this._keysDownBuffer.length-1]},s.prototype.getKeycodeName=function(t){switch(t){case 8:return"Backspace";case 9:return"Tab";case 12:return"Numpad Middle";case 13:return"Enter";case 16:return"Shift";case 17:return"Ctrl";case 18:return"Alt";case 19:return"Pause";case 20:return"Caps Lock";case 27:return"Escape";case 32:return"Space";case 33:return"Page Up";case 34:return"Page Down";case 35:return"End";case 36:return"Home";case 37:return"◀";case 38:return"▲";case 39:return"▶";case 40:return"▼";case 44:return"Print Screen";case 45:return"Insert";case 46:return"Delete";case 48:return"0";case 49:return"1";case 50:return"2";case 51:return"3";case 52:return"4";case 53:return"5";case 54:return"6";case 55:return"7";case 56:return"8";case 57:return"9";case 65:return"A";case 66:return"B";case 67:return"C";case 68:return"D";case 69:return"E";case 70:return"F";case 71:return"G";case 72:return"H";case 73:return"I";case 74:return"J";case 75:return"K";case 76:return"L";case 77:return"M";case 78:return"N";case 79:return"O";case 80:return"P";case 81:return"Q";case 82:return"R";case 83:return"S";case 84:return"T";case 85:return"U";case 86:return"V";case 87:return"W";case 88:return"X";case 89:return"Y";case 90:return"Z";case 91:return"Left Windows";case 92:return"Right Windows";case 93:return"Menu Key";case 96:return"Numpad 0";case 97:return"Numpad 1";case 98:return"Numpad 2";case 99:return"Numpad 3";case 100:return"Numpad 4";case 101:return"Numpad 5";case 102:return"Numpad 6";case 103:return"Numpad 7";case 104:return"Numpad 8";case 105:return"Numpad 9";case 106:return"Numpad *";case 107:return"Numpad +";case 109:return"Numpad -";case 110:return"Numpad .";case 111:return"Numpad /";case 112:return"F1";case 113:return"F2";case 114:return"F3";case 115:return"F4";case 116:return"F5";case 117:return"F6";case 118:return"F7";case 119:return"F8";case 120:return"F9";case 121:return"F10";case 122:return"F11";case 123:return"F12";case 144:return"Num Lock";case 145:return"Scroll Lock";case 160:return"Left Shift";case 161:return"Right Shift";case 162:return"Left Ctrl";case 163:return"Right Ctrl";case 164:return"Left Alt";case 165:return"Right Alt";case 186:return";";case 187:return"=";case 189:return"-";case 192:return"`";case 188:return",";case 190:return".";case 191:return"/";case 219:return"[";case 220:return"\\";case 221:return"]";case 222:return"'";default:return"Key "+t}},s.prototype.getKeyString=function(t){if(t instanceof Array){for(var e=[],i=0;i<t.length;i++)e.push(this.getKeycodeName(t[i]));return e.join(" + ")}return this.getKeycodeName(t)}},{}],11:[function(t,e,i){"use strict";function s(){this.touch=new PIXI.Point,this.isTouch=!1,this.signals={},this.signals.mouseMove=new signals.Signal,this.signals.mouseDown=new signals.Signal,this.signals.mouseUp=new signals.Signal,this.signals.mouseOut=new signals.Signal,this.signals.mouseClick=new signals.Signal,this._stage=null}var n=t("../Common");e.exports=s,s.prototype.init=function(t){this._stage=t,this._stage.interactive=!0,this._stage.mousemove=this._stage.touchmove=this.onMouseMove.bind(this),this._stage.mousedown=this._stage.touchstart=this.onMouseDown.bind(this),this._stage.mouseup=this._stage.touchend=this.onMouseUp.bind(this),this._stage.mouseout=this.onMouseOut.bind(this),this._stage.click=this._stage.tap=this.onMouseClick.bind(this)},s.prototype.dispose=function(){this._stage.mousemove=this._stage.touchmove=null,this._stage.mousedown=this._stage.touchstart=null,this._stage.mouseup=this._stage.touchend=null,this._stage.mouseout=null,this._stage.click=this._stage.tap=null,this.signals.mouseMove.dispose(),this.signals.mouseDown.dispose(),this.signals.mouseUp.dispose(),this.signals.mouseOut.dispose(),this.signals.mouseClick.dispose()},s.prototype.onMouseMove=function(t){this.touch=t.data.getLocalPosition(this._stage),n.queueCalls.add(function(){this.signals.mouseMove.dispatch(t)},[],this)},s.prototype.onMouseDown=function(t){this.touch=t.data.getLocalPosition(this._stage),this.isTouch=!0,n.queueCalls.add(function(){this.signals.mouseDown.dispatch(t)},[],this)},s.prototype.onMouseUp=function(t){this.touch=t.data.getLocalPosition(this._stage),this.isTouch=!1,n.queueCalls.add(function(){this.signals.mouseUp.dispatch(t)},[],this)},s.prototype.onMouseOut=function(t){this.touch=t.data.getLocalPosition(this._stage),this.isTouch=!1,n.queueCalls.add(function(){this.signals.mouseOut.dispatch(t)},[],this)},s.prototype.onMouseClick=function(t){n.queueCalls.add(function(){this.signals.mouseClick.dispatch(t)},[],this)}},{"../Common":3}],12:[function(t,e,i){"use strict";function s(){this._calls=null,this.init()}t("../Common");s.prototype=Object.create(PIXI.Container.prototype),s.prototype.constructor=s,e.exports=s,s.prototype.init=function(){this._calls=[]},s.prototype.update=function(){for(;this._calls.length>0;)this._calls[0].callback.apply(this._calls[0].scope,this._calls[0].params),this._calls.splice(0,1)},s.prototype.add=function(t,e,i){this._calls.push({callback:t,params:e,scope:i})}},{"../Common":3}],13:[function(t,e,i){function s(){this.points=[],this.quadWidth=96,this.cacheDrawingPoints=!0,this._drawingPoints=null,this._drawingPointsNormals=null}t("../Common");e.exports=s,s.prototype.addPoint=function(t,e,i){i?this.points.splice(i,0,{x:t,y:e}):this.points.push({x:t,y:e})},s.prototype.deletePoint=function(t){this.points.splice(t,1)},s.prototype.getFirstPoint=function(){return this.points[0]},s.prototype.getLastPoint=function(){return this.points[this.points.length-1]},s.prototype.getPenultimatePoint=function(){return this.points[this.points.length-2]},s.prototype.getWidth=function(){return this.getLastPoint().x-this.getFirstPoint().x},s.prototype.calculateBezierPoint=function(t,e,i,s,n){var o=1-t,a=t*t,r=o*o,h=r*o,l=a*t,c={x:h*e.x,y:h*e.y};return c.x+=3*r*t*i.x,c.y+=3*r*t*i.y,c.x+=3*o*a*s.x,c.y+=3*o*a*s.y,c.x+=l*n.x,c.y+=l*n.y,c},s.prototype.getDrawingPoints=function(){this._drawingPoints=[];for(var t=0;t<this.points.length-3;t+=3){var e=this.points[t],i=this.points[t+1],s=this.points[t+2],n=this.points[t+3],o=Math.sqrt(Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2)),a=Math.ceil(o/this.quadWidth);0==t&&this._drawingPoints.push(this.calculateBezierPoint(0,e,i,s,n));for(var r=1;r<=a;r++){var h=r/a;this._drawingPoints.push(this.calculateBezierPoint(h,e,i,s,n))}}return this._drawingPoints},s.prototype.getDrawingPointsNormals=function(){var t=this.getDrawingPoints();this._drawingPointsNormals=[];for(var e=1;e<t.length-1;e++){var i=t[e-1],s=t[e+1],n={x:s.x-i.x,y:s.y-i.y},o={x:-n.y,y:n.x},a=Math.sqrt(o.x*o.x+o.y*o.y),r={x:o.x/a,y:o.y/a};this._drawingPointsNormals[e]=r}return this._drawingPointsNormals[0]={x:0,y:1},this._drawingPointsNormals[t.length-1]={x:0,y:1},this._drawingPointsNormals},s.prototype.getGroundSegments=function(t,e){for(var i=[],s=null,n=this.getDrawingPoints(),o=this.getDrawingPointsNormals(),a=0;a<n.length-1;a++){var r=Math.abs(Math.atan2(n[a+1].y-n[a].y,n[a+1].x-n[a].x)*PIXI.RAD_TO_DEG);if(r<t||r>e){if(null==s)continue;i.push(s),s=null}else null==s&&(s={points:[n[a]],normals:[o[a]]}),s.points.push(n[a+1]),s.normals.push(o[a+1])}null!=s&&i.push(s);for(var a=0;a<i.length;a++)i[a].normals.length>2&&(i[a].normals[0]=i[a].normals[1],i[a].normals[i[a].normals.length-1]=i[a].normals[i[a].normals.length-2]);return i}},{"../Common":3}],14:[function(t,e,i){function s(){PIXI.Container.call(this),this.assetManager=p3.AssetManager.instance,this.levels=[],this.level=null,this.snapGrid=16,this.grid=null,this.cmb=!1,this.panMousePosition=null,this.zoomLevels=[.025,.05,.125,.25,.333,.5,.666,1,2,3,4,5,6,8],this.config=this.assetManager.getJSON("editorConfig");for(var t=33,t=33,e=0;e<this.config.objects.length;e++){var i=new PIXI.Sprite(this.assetManager.getTexture(this.config.objects[e].texture)),s=Math.min(1/(i.width/t),1/(i.height/t)),o=PIXI.RenderTexture.create(t,t),a=new PIXI.Matrix;a.translate(i.width<i.height?(i.height-i.width)/2:1,i.height<i.width?(i.width-i.height)/2:1),a.scale(s,s),n.renderer.render(i,o,!0,a),this.config.objects[e].textureBase64=n.renderer.extract.base64(o)}this.history=[],this.historyIndex=0,this.gui={selector:"#controls",levelTemplate:_.template($("#template-level").html(),{variable:"editor"}),layerTemplate:_.template($("#template-layer").html(),{variable:"editor"}),pathTemplate:_.template($("#template-path").html(),{variable:"editor"}),objectTemplate:_.template($("#template-object").html(),{variable:"editor"})}}var n=t("../Common"),o=t("../editor/Level");t("../editor/LevelLayer");e.exports=s,s.prototype=Object.create(PIXI.Container.prototype),s.prototype.constructor=s,s.prototype.init=function(){this.titleContainer=new PIXI.Container,this.titleContainer.x=0,this.titleContainer.y=0,this.addChild(this.titleContainer),this.title=new PIXI.Text("",{fontFamily:"Arial",fontSize:36,fill:16777215,align:"left"}),this.title.anchor.set(0,0),this.title.alpha=.5,this.titleContainer.addChild(this.title),this.levelContainer=new PIXI.Container,this.addChildAt(this.levelContainer,0),this.renderGrid(),this.newLevel(),document.addEventListener("mousewheel",function(t){0!=$("#canvas:hover").length&&this.zoomDelta(Math.sign(t.wheelDelta))}.bind(this),!1),$("body").on("click",".level_new",function(t){this.newLevel()}.bind(this)),$("body").on("click",".level_export",function(t){this["export"]()}.bind(this)),$("body").on("click",".level_import",function(t){this.load($("textarea[name=level_import_text]").val())}.bind(this)),$("body").on("click",".level_image",function(t){var e=this.level.toImage();if(e){var i=window.open(e,"level_image");i.focus()}}.bind(this)),$("body").on("click",".level_debug, #play",function(t){this.playLevel()}.bind(this)),$("body").on("change","input[name=level_name]",function(t){this.level.setName($(t.currentTarget).val()),$("textarea[name=level_import_text]").val(JSON.stringify(this.level["export"]()))}.bind(this)),$("body").on("click",".new_layer",function(t){this.level.newLayer()}.bind(this)),$("body").on("click",".edit_layer",function(t){var e=parseInt($(t.currentTarget).attr("data-index"));this.level.selectLayer(this.level.getLayerAtIndex(e))}.bind(this)),$("body").on("click",".back",function(t){this.back()}.bind(this)),$("body").on("change","input[name=layer_name]",function(t){this.level.layer.setName($(t.currentTarget).val())}.bind(this)),$("body").on("click",".delete_layer",function(t){this.level.deleteLayer(this.level.layer),this.back()}.bind(this)),$("body").on("change","input[name=layer_depth]",function(t){this.level.layer.setDepth(parseInt($(t.currentTarget).val())),this.render()}.bind(this)),$("body").on("change","input[name=layer_parallax]",function(t){this.level.layer.setParallax(parseFloat($(t.currentTarget).val())),this.render()}.bind(this)),$("body").on("click",".objects li:not(.selected)",function(t){$(".objects li.selected").removeClass("selected"),this.level.layer.setIdObject($(t.currentTarget).attr("data-id")),$(t.currentTarget).addClass("selected")}.bind(this)),$("body").on("change","select[name=path_open]",function(t){this.level.layer.selected.setConfig("closed",!parseInt($(t.currentTarget).val()),"change"==t.type),this.render()}.bind(this)),$("body").on("click",".delete_path",function(t){this.level.layer.deletePath(this.level.layer.selected),this.back()}.bind(this)),$("body").on("click",".clone_path",function(t){this.level.layer.clonePath(this.level.layer.selected)}.bind(this)),$("body").on("click",".flip_h_path",function(t){this.level.layer.selected.flipH(),this.render()}.bind(this)),$("body").on("click",".flip_v_path",function(t){this.level.layer.selected.flipV(),this.render()}.bind(this)),$("body").on("change","input[name=path_depth], input[name=object_depth]",function(t){this.level.layer.setSelectedDepth(parseInt($(t.currentTarget).val())),this.render()}.bind(this)),$("body").on("change","select[name=path_collisions]",function(t){this.level.layer.selected.setConfig("collisions",parseInt($(t.currentTarget).val()),"change"==t.type)}.bind(this)),$("body").on("change input","input[name=path_texture_walls_angle]",function(t){this.level.layer.selected.setConfig("texWallAngle",parseInt($(t.currentTarget).val()),"change"==t.type),this.level.layer.selected.render()}.bind(this)),$("body").on("change input","input[name=path_texture_fill_size]",function(t){this.level.layer.selected.setConfig("texFillSize",parseInt($(t.currentTarget).val()),"change"==t.type),this.level.layer.selected.render()}.bind(this)),$("body").on("change input","input[name=path_texture_fill_padding]",function(t){this.level.layer.selected.setConfig("texFillPadding",parseInt($(t.currentTarget).val()),"change"==t.type),this.level.layer.selected.render()}.bind(this)),$("body").on("change input","input[name=path_texture_ground_size]",function(t){this.level.layer.selected.setConfig("texGroundSize",parseInt($(t.currentTarget).val()),"change"==t.type),this.level.layer.selected.render()}.bind(this)),$("body").on("change input","input[name=path_texture_ground_delta]",function(t){this.level.layer.selected.setConfig("texGroundDelta",parseFloat($(t.currentTarget).val()),"change"==t.type),this.level.layer.selected.render()}.bind(this)),$("body").on("change input","input[name=path_texture_walls_size]",function(t){this.level.layer.selected.setConfig("texWallSize",parseInt($(t.currentTarget).val()),"change"==t.type),this.level.layer.selected.render()}.bind(this)),$("body").on("change input","input[name=path_texture_walls_delta]",function(t){this.level.layer.selected.setConfig("texWallDelta",parseFloat($(t.currentTarget).val()),"change"==t.type),this.level.layer.selected.render()}.bind(this)),$("body").on("change","select[name=path_texture_fill]",function(t){this.level.layer.selected.setConfig("texFill",$(t.currentTarget).val(),"change"==t.type),this.level.layer.selected.render()}.bind(this)),$("body").on("change","select[name=path_texture_ground]",function(t){this.level.layer.selected.setConfig("texGround",$(t.currentTarget).val(),"change"==t.type),this.level.layer.selected.render()}.bind(this)),$("body").on("change","select[name=path_texture_ground_edge]",function(t){this.level.layer.selected.setConfig("texGroundEdge",$(t.currentTarget).val(),"change"==t.type),this.level.layer.selected.render()}.bind(this)),$("body").on("change","select[name=path_texture_ground_edge_side]",function(t){this.level.layer.selected.setConfig("texGroundEdgeSide",$(t.currentTarget).val(),"change"==t.type),this.level.layer.selected.render()}.bind(this)),$("body").on("change","select[name=path_texture_wall]",function(t){this.level.layer.selected.setConfig("texWall",$(t.currentTarget).val(),"change"==t.type),this.level.layer.selected.render()}.bind(this)),$("body").on("change input","textarea[name=path_data], textarea[name=object_data]",function(t){this.level.layer.selected.setConfig("data",$(t.currentTarget).val(),"change"==t.type)}.bind(this)),$("body").on("change","select[name=move_path_to_layer]",function(t){var e=this.level.getLayerAtIndex($(t.currentTarget).val());e.adoptPath(this.level.layer.selected),this.level.layer.selected.render()}.bind(this)),$("body").on("click",".delete_object",function(t){this.level.layer.deleteObject(this.level.layer.selected),this.back()}.bind(this)),$("body").on("change input","input[name=object_scale]",function(t){this.level.layer.selected.setScale(parseFloat($(t.currentTarget).val()),"change"==t.type)}.bind(this)),$("body").on("change input","input[name=object_rotation]",function(t){this.level.layer.selected.setRotation(parseFloat($(t.currentTarget).val()),"change"==t.type)}.bind(this)),$("body").on("change input","input[name=object_flip_x]",function(t){this.level.layer.selected.setFlipX(parseInt($(t.currentTarget).val()),"change"==t.type)}.bind(this)),$("body").on("change","input[type=range]",function(t){$(this).blur()}),n.savedData.levelDebug&&($("textarea[name=level_import_text]").val(n.savedData.levelDebug),this.load($("textarea[name=level_import_text]").val())),n.view.signals.resize.removeAll(),n.view.signals.resize.add(this.onCanvasResize,this),this.onCanvasResize()},s.prototype.update=function(){this.mouse.centerPressed?this.cmb?(this.level.x+=(this.mouse.position.x-this.panMousePosition.x)*(1/this.zoom),this.level.y+=(this.mouse.position.y-this.panMousePosition.y)*(1/this.zoom),this.panMousePosition=new PIXI.Point(this.mouse.position.x,this.mouse.position.y),this.updateGridPosition()):(this.cmb=!0,this.panMousePosition=new PIXI.Point(this.mouse.position.x,this.mouse.position.y)):this.cmb&&(this.cmb=!1),null!=this.level&&(n.keyboard.getKeyJustPressed([n.keyboard.KEY_CTRL,n.keyboard.KEY_Z,n.keyboard.KEY_SHIFT])?this.historyRedo():n.keyboard.getKeyJustPressed([n.keyboard.KEY_CTRL,n.keyboard.KEY_Z])?this.historyUndo():n.keyboard.getKeyJustPressed([n.keyboard.KEY_F2])&&this.playLevel(),this.level.update())},s.prototype.render=function(){null!=this.level&&(this.level.render(),this.level.renderGUI())},s.prototype.getMousePosition=function(){return new PIXI.Point(n.STAGE_WIDTH/2+(this.mouse.position.x-n.STAGE_WIDTH/2)/this.zoom-this.level.x,n.STAGE_HEIGHT/2+(this.mouse.position.y-n.STAGE_HEIGHT/2)/this.zoom-this.level.y)},s.prototype.zoomDelta=function(t){var t=Math.sign(t),e=this.zoomLevels.indexOf(this.zoom);if(!(t==-1&&e<=0||1==t&&e>=this.zoomLevels.length-1)){var i=n.STAGE_WIDTH*this.zoom,s=n.STAGE_HEIGHT*this.zoom;this.zoom=this.zoomLevels[e+t];var o=n.STAGE_WIDTH*this.zoom,a=n.STAGE_HEIGHT*this.zoom;this.levelContainer.x+=(i-o)/2,this.levelContainer.y+=(s-a)/2,this.updateGridPosition()}},s.prototype.renderGUI=function(t){switch(t){case"level":var e=this.gui.levelTemplate(this);break;case"layer":var e=this.gui.layerTemplate(this);break;case"path":var e=this.gui.pathTemplate(this);break;case"object":var e=this.gui.objectTemplate(this);break;default:console.error("GUI level not found")}$(this.gui.selector).html(e)},s.prototype.back=function(){this.level&&(this.level.back(),this.render())},s.prototype.renderGrid=function(){var t=this.snapGrid*this.zoom;if(t<10)return void(this.grid.visible=!1);var e=document.createElement("canvas");e.width=t,e.height=t;var i=e.getContext("2d");i.beginPath(),i.strokeStyle="#666666",i.lineWidth=1,i.moveTo(.5,0),i.lineTo(.5,e.height),i.moveTo(0,e.height-.5),i.lineTo(e.width,e.height-.5),i.stroke();var s=PIXI.Texture.fromCanvas(e,PIXI.SCALE_MODES.NEAREST);s.baseTexture.mipmap=!1,this.grid?this.grid.texture=s:(this.grid=new PIXI.extras.TilingSprite(s,e.width,e.height),this.grid.alpha=.3,this.addChildAt(this.grid,0)),this.updateGridPosition(),this.grid.visible=!0},s.prototype.updateGridPosition=function(){this.grid.width=n.renderer.width,this.grid.height=n.renderer.height,this.grid.tilePosition.x=Math.round(((this.level?this.level.x:0)+this.levelContainer.x/this.zoom)%this.snapGrid*this.zoom),this.grid.tilePosition.y=Math.round(((this.level?this.level.y:0)+this.levelContainer.y/this.zoom)%this.snapGrid*this.zoom)},s.prototype.newLevel=function(){null!=this.level&&this.levelContainer.removeChild(this.level);var t=new o(this);this.level=t,this.level.init(),this.levels.push(t),this.levelContainer.addChild(this.level),this.render(),this.updateGridPosition(),this.historyReset()},s.prototype.getObject=function(t){for(var e=0;e<this.config.objects.length;e++)if(this.config.objects[e].id==t)return this.config.objects[e];return null},s.prototype.load=function(t){var e=JSON.parse(t);this.newLevel(),this.level["import"](e),this.render()},s.prototype["import"]=function(){$("#level_import").replaceWith($("#level_import").val("").clone(!0)),$("#level_import").trigger("click")},s.prototype["export"]=function(){var t=JSON.stringify(this.level["export"]()),e=this.level.name+"_"+Math.floor(Date.now()/1e3)+".json",i=document.createElement("a");i.setAttribute("href","data:application/json;charset=utf-8,"+encodeURIComponent(t)),i.setAttribute("download",e),i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i)},s.prototype.playLevel=function(){n.savedData.levelDebug=JSON.stringify(this.level["export"]()),n.savedData.save();var t=window.open("index.html","level_debug");t.focus()},s.prototype.historyReset=function(){console.info("Resetting history"),this.history=[JSON.stringify(this.level["export"]())],this.historyIndex=0},s.prototype.historyAddState=function(){var t=JSON.stringify(this.level["export"]());this.historyIndex<this.history.length-1&&this.history.splice(this.historyIndex+1,1e4),t!=this.history[this.history.length-1]&&(this.history.push(t),this.historyIndex++)},s.prototype.historyUndo=function(){0!=this.historyIndex&&(this.historyIndex--,console.info("Undo state %i",this.historyIndex),this.historyRestore())},s.prototype.historyRedo=function(){this.historyIndex!=this.history.length-1&&(this.historyIndex++,console.info("Redo state %i",this.historyIndex),this.historyRestore())},s.prototype.historyRestore=function(){this.level.reset(),this.level["import"](JSON.parse(this.history[this.historyIndex])),this.render()},s.prototype.onCanvasResize=function(){n.renderer.view.style.width=window.innerWidth+"px",n.renderer.view.style.height=window.innerHeight+"px",n.renderer.resize(window.innerWidth,window.innerHeight),this.updateGridPosition()},Object.defineProperty(s.prototype,"zoom",{get:function(){return this.levelContainer.scale.x},set:function(t){this.zoom!=t&&(this.levelContainer.scale.set(t),this.level.layer?this.level.render():this.level.renderDot(),this.renderGrid())}})},{"../Common":3,"../editor/Level":15,"../editor/LevelLayer":16}],15:[function(t,e,i){function s(t){this.editor=t,this.name="New level",this.layers=[],this.layer=null,this.lmb=!1,this.rmb=!1,this.dragMovement=null,PIXI.Container.call(this)}var n=t("../Common"),o=(t("../editor/Editor"),t("../editor/LevelLayer"));e.exports=s,s.prototype=Object.create(PIXI.Container.prototype),s.prototype.constructor=s,s.prototype.init=function(){this.reset(),this.x=n.STAGE_WIDTH/4,this.y=n.STAGE_HEIGHT/2},s.prototype.reset=function(){this.removeChildren(),this.startingPoint||(this.startingPoint=new PIXI.Graphics,this.startingPoint.beginFill(65280),this.startingPoint.drawCircle(0,0,5),this.startingPoint.endFill()),this.addChild(this.startingPoint),this.layers=[],this.layer=null},s.prototype.update=function(){if(null!=this.layer)this.layer.update();else if(this.editor.mouse.rightPressed){this.editor.getMousePosition();if(this.rmb){var t=this.editor.mouse.movement;t.multiply(1/this.editor.zoom);for(var e=0;e<this.layers.length;e++)this.layers[e].moveAll(new PIXI.Point(-Math.round(this.dragMovement.x/this.editor.snapGrid)*this.editor.snapGrid,-Math.round(this.dragMovement.y/this.editor.snapGrid)*this.editor.snapGrid));this.dragMovement.x+=t.x,this.dragMovement.y+=t.y;for(var e=0;e<this.layers.length;e++)this.layers[e].moveAll(new PIXI.Point(Math.round(this.dragMovement.x/this.editor.snapGrid)*this.editor.snapGrid,Math.round(this.dragMovement.y/this.editor.snapGrid)*this.editor.snapGrid)),this.layers[e].render()}else this.rmb=!0,this.dragMovement=new PIXI.Point(0,0)}else this.rmb&&(this.rmb=!1,this.renderGUI(),this.editor.historyAddState())},s.prototype.renderDot=function(){this.startingPoint.scale.set(1/this.editor.zoom),this.addChild(this.startingPoint)},s.prototype.render=function(){this.renderDot();for(var t=0;t<this.layers.length;t++)this.layers[t].render()},s.prototype.renderGUI=function(){this.editor.title.text="",this.layer?this.layer.renderGUI():this.editor.renderGUI("level")},s.prototype.back=function(){this.layer&&this.layer.back()},s.prototype.newLayer=function(t){this.layer=new o(this,t),this.layers.push(this.layer),this.layer.init(),this.addChild(this.layer),this.selectLayer(this.layer),this.editor.historyAddState()},s.prototype.deleteLayer=function(t){var e=this.layers.indexOf(t);e>-1&&(this.removeChild(this.layers[e]),this.layers.splice(e,1),this.editor.historyAddState())},s.prototype.selectLayer=function(t){this.layer=t,this.render(),this.renderGUI()},s.prototype.getLayerAtIndex=function(t){return this.layers[t]?this.layers[t]:null},s.prototype["export"]=function(){for(var t={name:this.name,layers:[],length:this.getLength()},e=0;e<this.layers.length;e++)t.layers.push(this.layers[e]["export"]());return t},s.prototype.getLength=function(){for(var t=0;t<this.layers.length;t++)for(var e=0;e<this.layers[t].objects.length;e++)if("level_end"==this.layers[t].objects[e].config.id)return Math.round(this.layers[t].objects[e].x-this.layers[t].objects[e].width);return 0},s.prototype.getBounds=function(){for(var t=0,e=0,i=0,s=0,n=0;n<this.layers.length;n++)for(var o=0;o<this.layers[n].paths.length;o++)for(var a=0;a<this.layers[n].paths[o].bezier.points.length;a++)this.layers[n].paths[o].bezier.points[a].x<t?t=this.layers[n].paths[o].bezier.points[a].x:this.layers[n].paths[o].bezier.points[a].x>e&&(e=this.layers[n].paths[o].bezier.points[a].x),this.layers[n].paths[o].bezier.points[a].y<i?i=this.layers[n].paths[o].bezier.points[a].y:this.layers[n].paths[o].bezier.points[a].y>s&&(s=this.layers[n].paths[o].bezier.points[a].y);return[t,i,e,s]},s.prototype.setName=function(t){t=$.trim(t),""!=t&&(this.name=t,this.editor.historyAddState())},s.prototype["import"]=function(t){this.name=t.name;for(var e=0;e<t.layers.length;e++){var i=new o(this,"");i["import"](t.layers[e]),this.layers.push(i),this.addChild(i)}},s.prototype.toImage=function(){var t=this.getBounds();if(t[2]!=t[0]){t[0]-=128,t[1]-=256,t[2]+=128,t[3]+=256;var e=t[2]-t[0],i=t[3]-t[1],s=1,o=PIXI.RenderTexture.create(e*s,i*s),a=new PIXI.Matrix;a.translate(-t[0]-this.x,-t[1]-this.y),n.renderer.render(this,o,!0,a);var r=n.renderer.extract.base64(o);return console.log(r),r}}},{"../Common":3,"../editor/Editor":14,"../editor/LevelLayer":16}],16:[function(t,e,i){function s(t,e){this.editor=t.editor,this.level=t,this.name=e?e:"New layer #"+(this.level.layers.length+1),this.paths=[],this.objects=[],this.depth=0,this.parallax=0,this.idObject="",this.selected=null,this.lmb=!1,this.rmb=!1,this.dragMovement=null,PIXI.Container.call(this)}var n=(t("../Common"),t("../editor/Editor"),t("../editor/Level"),t("../editor/LevelPath")),o=t("../editor/LevelObject");e.exports=s,s.prototype=Object.create(PIXI.Container.prototype),s.prototype.constructor=s,s.prototype.init=function(){},s.prototype.update=function(){if(null!=this.selected)this.selected.update();else{if(this.editor.mouse.leftPressed){var t=this.editor.getMousePosition();if(!this.lmb){this.lmb=!0;var e=this.getObjectAtPoint(t);if(null!=e)this.selectObject(e);else{var i=this.getPathAtPoint(t,50);null!=i?this.selectObject(i):""==this.idObject?this.newPath(t):this.newObject(this.idObject,t)}}}else this.lmb&&(this.lmb=!1);if(this.editor.mouse.rightPressed){var t=this.editor.getMousePosition();if(this.rmb){var s=this.editor.mouse.movement;s.multiply(1/this.editor.zoom),this.moveAll(new PIXI.Point(-Math.round(this.dragMovement.x/this.editor.snapGrid)*this.editor.snapGrid,-Math.round(this.dragMovement.y/this.editor.snapGrid)*this.editor.snapGrid)),this.dragMovement.x+=s.x,this.dragMovement.y+=s.y,this.moveAll(new PIXI.Point(Math.round(this.dragMovement.x/this.editor.snapGrid)*this.editor.snapGrid,Math.round(this.dragMovement.y/this.editor.snapGrid)*this.editor.snapGrid)),this.render()}else this.rmb=!0,this.dragMovement=new PIXI.Point(0,0)}else this.rmb&&(this.rmb=!1,this.editor.historyAddState())}if(null==this.selected&&!this.lmb&&!this.rmb){for(var t=this.editor.getMousePosition(),e=this.getObjectAtPoint(t),i=this.getPathAtPoint(t,50),n=0;n<this.paths.length;n++)this.paths[n].alpha=1,this.paths[n].wireframe.alpha=1,this.paths[n].wireframe.visible=!1;for(var n=0;n<this.objects.length;n++)this.objects[n].alpha=1,this.objects[n].wireframe.alpha=1,this.objects[n].wireframe.visible=!1;if(null!=e)e.wireframe.visible=!0,e.wireframe.alpha=.75;else if(null!=i){i.wireframe.visible=!0,i.wireframe.alpha=.5;for(var n=0;n<this.paths.length;n++)this.paths[n]!=i&&(this.paths[n].alpha=.75)}}$("input:focus, textarea:focus").length>0},s.prototype.render=function(){for(var t=-10,e=10,i=t;i<=e;i++){for(var s=0;s<this.paths.length;s++)this.paths[s].config.depth==i&&(this.addChild(this.paths[s]),this.paths[s].render());for(var s=0;s<this.objects.length;s++)this.objects[s].config.depth==i&&(this.addChild(this.objects[s]),this.objects[s].render())}null!=this.level.layer&&this.level.layer!=this?this.alpha=.5:this.alpha=1},s.prototype.renderGUI=function(){this.updateTitle(),this.selected?this.selected.renderGUI():this.editor.renderGUI("layer")},s.prototype.updateTitle=function(){this.editor.title.text="LAYER: "+this.name},s.prototype.back=function(){this.selected?this.selected.back():(this.level.layer=null,this.idObject="",this.editor.historyAddState())},s.prototype.setIdObject=function(t){this.level.layer.idObject!=t&&(this.level.layer.idObject=t,this.editor.historyAddState())},s.prototype.selectObject=function(t){this.selected=t,this.render(),this.renderGUI(),this.editor.historyAddState()},s.prototype.newObject=function(t,e){var i=this.editor.getObject(t);if(null!=i){var s=new o(this);s.init(i),s.x=e.x,s.y=e.y,this.objects.push(s),this.addChild(s),this.selectObject(s)}},s.prototype.deleteObject=function(t){var e=this.objects.indexOf(t);e>-1&&(this.removeChild(this.objects[e]),this.objects.splice(e,1),this.editor.historyAddState())},s.prototype.newPath=function(t){var e=new n(this);e.init(),e.addPoint(t.x,t.y),this.paths.push(e),this.addChild(e),this.selectObject(e),this.editor.historyAddState()},s.prototype.deletePath=function(t){var e=this.paths.indexOf(t);e!=-1&&(this.removeChild(this.paths[e]),this.paths.splice(e,1),this.editor.historyAddState())},s.prototype.adoptPath=function(t){var e=t.layer.paths.indexOf(t);if(e!=-1){var i=t["export"]();t.layer.removeChild(t),t.layer.paths.splice(e,1),t.layer.selected=null,this.level.selectLayer(this);var s=new n(this);s["import"](i),this.paths.push(s),this.addChild(s),this.selectObject(s),this.editor.historyAddState()}},s.prototype.clonePath=function(t){var e=this.paths.indexOf(t);if(e!=-1){var i=t["export"]();if(i.points.length<=1)return t;var s=new n(this);s["import"](i),s.move(Math.round(50/this.editor.snapGrid)*this.editor.snapGrid,Math.round(50/this.editor.snapGrid)*this.editor.snapGrid),this.paths.push(s),this.addChild(s),this.selectObject(s),
this.editor.historyAddState()}},s.prototype.splitPath=function(t,e){if(e%3==0){var i=this.paths.indexOf(t);if(i!=-1){var s=t["export"]();if(s.points.length<=1)return t;var o=new n(this);o["import"](s);for(var a=t.pointsCount-1;a>=0;a--)a<e&&o.deletePoint(a),a>e&&t.deletePoint(a);this.paths.push(o),this.addChild(o),this.selectObject(o),this.editor.historyAddState()}}},s.prototype.moveAll=function(t){t.x=Math.round(t.x/this.editor.snapGrid)*this.editor.snapGrid,t.y=Math.round(t.y/this.editor.snapGrid)*this.editor.snapGrid;for(var e=0;e<this.paths.length;e++)this.paths[e].move(t.x,t.y);for(var e=0;e<this.objects.length;e++)this.objects[e].x+=t.x,this.objects[e].y+=t.y},s.prototype.getObjectAtPoint=function(t){for(var e=null,i=this.objects.length-1;i>=0;i--)this.objects[i].isPointInside(t)&&(null==e||e.depth<this.objects[i].depth||i>this.objects.indexOf(e))&&(e=this.objects[i]);return e},s.prototype.getPathAtPoint=function(t,e){for(var i=null,s=0;s<this.paths.length;s++)for(var n=this.paths[s].bezier.getDrawingPoints(),o=0;o<n.length-1;o++){var a=new PIXI.Point(n[o+1].x-n[o].x,n[o+1].y-n[o].y),r=new PIXI.Point(a.x,a.y);r.normalize();var h=new PIXI.Point(t.x-n[o].x,t.y-n[o].y),l=h.dotProduct(a)/a.getLength(),c=new PIXI.Point(r.x*l,r.y*l);if((c.x/a.x<0||c.x/a.x>1)&&c.x!=a.x||c.y/a.y<0||c.y/a.y>1)var p=new PIXI.Point(t.x-n[o].x,t.y-n[o].y),d=new PIXI.Point(t.x-n[o+1].x,t.y-n[o+1].y),u=Math.min(p.getLength(),d.getLength());else var _=new PIXI.Point(h.x-c.x,h.y-c.y),u=_.getLength();(null==i||this.paths[s].depth>i.depth||s>this.paths.indexOf(i))&&u<e&&(i=this.paths[s])}return i},s.prototype.setName=function(t){t=$.trim(t),""!=t&&(this.name=t,this.updateTitle(),this.editor.historyAddState())},s.prototype.setDepth=function(t){this.depth=t,this.level.children.sort(function(t,e){return t.depth<e.depth?-1:t.depth>e.depth?1:0}),this.level.layers.sort(function(t,e){return t.depth<e.depth?-1:t.depth>e.depth?1:0}),this.editor.historyAddState()},s.prototype.setSelectedDepth=function(t){null!=this.selected&&(this.selected.config.depth=t,this.children.sort(function(t,e){return t.config.depth<e.config.depth?-1:t.config.depth>e.config.depth?1:0}),this.paths.sort(function(t,e){return t.depth<e.depth?-1:t.depth>e.depth?1:0}),this.objects.sort(function(t,e){return t.depth<e.depth?-1:t.depth>e.depth?1:0}),this.editor.historyAddState())},s.prototype.setParallax=function(t){this.parallax=t||0,this.editor.historyAddState()},s.prototype["export"]=function(){var t={name:this.name,depth:this.depth,parallax:this.parallax,paths:[],objects:[]};this.level.layer==this&&(t.selected=!0,t.idObject=this.idObject);for(var e=0;e<this.objects.length;e++)t.objects.push(this.objects[e]["export"]());for(var e=0;e<this.paths.length;e++)t.paths.push(this.paths[e]["export"]());return t.objects.sort(function(t,e){return t.x<e.x?-1:t.x>e.x?1:0}),t.paths.sort(function(t,e){return t.bounds[0]<e.bounds[0]?-1:t.bounds[0]>e.bounds[0]?1:0}),t},s.prototype["import"]=function(t){this.name=t.name,this.depth=t.depth,this.parallax=t.parallax||0;for(var e=0;e<t.objects.length;e++){var i=new o(this);i["import"](t.objects[e]),this.objects.push(i)}for(var e=0;e<t.paths.length;e++){var s=new n(this);s["import"](t.paths[e]),this.paths.push(s)}t.selected&&(this.level.layer=this,this.idObject=t.idObject)}},{"../Common":3,"../editor/Editor":14,"../editor/Level":15,"../editor/LevelObject":17,"../editor/LevelPath":18}],17:[function(t,e,i){function s(t){this.editor=t.editor,this.layer=t,this.assetManager=p3.AssetManager.instance,this.config={id:"",texture:"",anchor:{x:.5,y:.5},scale:{x:1,y:1},rotation:0,depth:0,data:""},this.sprite=null,this.wireframe=null,this.isDragging=!1,this.lmb=!1,PIXI.Container.call(this)}var n=t("../Common");t("../editor/Editor"),t("../editor/Level"),t("../editor/LevelLayer");e.exports=s,s.prototype=Object.create(PIXI.Container.prototype),s.prototype.constructor=s,s.prototype.init=function(t){if(this.config.id=t.id,this.config.texture=Array.isArray(t.texture)?t.texture[p3.Utils.randomInt(0,t.texture.length-1)]:t.texture,this.config.anchor=t.anchor,t.scale){if(Array.isArray(t.scale))var e=Math.round(10*p3.Utils.randomRange(t.scale[0],t.scale[1]))/10;else var e=t.scale;this.config.scale={x:e,y:e}}t.data&&(this.config.data=t.data),t.depth&&(this.config.depth=t.depth),this.lmb=!0,this.isDragging=!0},s.prototype.update=function(){if(this.editor.mouse.leftPressed){var t=this.editor.getMousePosition();if(this.lmb){if(this.isDragging){var e=this.editor.mouse.movement;e.multiply(1/this.editor.zoom),this.x+=e.x,this.y+=e.y}}else{var t=this.editor.getMousePosition(),i=this.layer.getObjectAtPoint(t);if(this.isPointInside(t)||i==this)this.isDragging=!0;else{if(null==i)return void this.layer.newObject(this.config.id,t);var i=this.layer.getObjectAtPoint(t);if(null!=i)return void this.layer.selectObject(i)}this.lmb=!0}}else this.lmb&&(this.lmb=!1,this.isDragging=!1,this.editor.historyAddState());var s=$("input:focus, textarea:focus").length>0;!n.keyboard.getKeyJustPressed(n.keyboard.KEY_C)||n.keyboard.getKeyPressed(n.keyboard.KEY_CTRL)||s||($("select:focus").blur(),$(".delete_object").trigger("click")),!n.keyboard.getKeyJustPressed(n.keyboard.KEY_B)||n.keyboard.getKeyPressed(n.keyboard.KEY_CTRL)||s||($("select:focus").blur(),$(".back").trigger("click"))},s.prototype.render=function(){this.rotation=this.config.rotation*PIXI.DEG_TO_RAD,this.scale=new PIXI.Point(this.config.scale.x,this.config.scale.y),this.sprite||(this.sprite=new PIXI.Sprite(PIXI.Texture.EMPTY),this.addChild(this.sprite)),this.sprite.texture=this.assetManager.getTexture(this.config.texture),this.sprite.anchor.set(this.config.anchor.x,this.config.anchor.y),this.renderWireframe()},s.prototype.renderWireframe=function(){this.wireframe&&(this.removeChild(this.wireframe),this.wireframe.destroy(!0));var t=1/(this.editor.zoom*Math.abs(this.scale.x));this.wireframe=new PIXI.Graphics,this.addChild(this.wireframe),this.wireframe.lineStyle(t,16711680,1),this.wireframe.moveTo(-this.sprite.anchor.x*this.sprite.width,-this.sprite.anchor.y*this.sprite.height),this.wireframe.lineTo(+(1-this.sprite.anchor.x)*this.sprite.width,-this.sprite.anchor.y*this.sprite.height),this.wireframe.lineTo(+(1-this.sprite.anchor.x)*this.sprite.width,+(1-this.sprite.anchor.y)*this.sprite.height),this.wireframe.lineTo(-this.sprite.anchor.x*this.sprite.width,+(1-this.sprite.anchor.y)*this.sprite.height),this.wireframe.lineTo(-this.sprite.anchor.x*this.sprite.width,-this.sprite.anchor.y*this.sprite.height),this.wireframe.beginFill(16711680),this.wireframe.drawCircle(0,0,5*t),this.wireframe.endFill,this.wireframe.visible=this.layer.selected==this},s.prototype.renderGUI=function(){this.editor.renderGUI("object")},s.prototype.back=function(){this.layer.selected=null,this.editor.historyAddState()},s.prototype.setScale=function(t,e){this.config.scale.x=t*Math.sign(this.config.scale.x),this.config.scale.y=t*Math.sign(this.config.scale.y),this.scale.set(this.config.scale.x,this.config.scale.y),e&&this.editor.historyAddState(),this.renderWireframe()},s.prototype.setFlipX=function(t,e){this.config.scale.x=Math.abs(this.config.scale.x)*Math.sign(t),this.scale.x=this.config.scale.x,e&&this.editor.historyAddState()},s.prototype.setFlipY=function(t,e){this.config.scale.y=Math.abs(this.config.scale.y)*Math.sign(t),this.scale.y=this.config.scale.y,e&&this.editor.historyAddState()},s.prototype.setRotation=function(t,e){this.config.rotation=t,this.rotation=this.config.rotation*PIXI.DEG_TO_RAD,e&&this.editor.historyAddState()},s.prototype.setConfig=function(t,e,i){this.config[t]=e,i&&this.editor.historyAddState()},s.prototype.isPointInside=function(t){var e=new PIXI.Point(t.x,t.y);0!=this.rotation&&e.rotateAround(new PIXI.Point(this.x,this.y),-this.rotation);var i=this.x-this.sprite.width*this.scale.x*this.sprite.anchor.x,s=this.x+this.sprite.width*this.scale.x*(1-this.sprite.anchor.x),n=this.y-this.sprite.height*this.scale.y*this.sprite.anchor.y,o=this.y+this.sprite.height*this.scale.y*(1-this.sprite.anchor.y);return!(e.x<Math.min(i,s))&&(!(e.x>Math.max(i,s))&&(!(e.y<Math.min(n,o))&&!(e.y>Math.max(n,o))))},s.prototype["export"]=function(){var t=jQuery.extend(!0,{},this.config);return t.position={x:Math.round(this.x),y:Math.round(this.y)},this.layer.selected==this&&(t.selected=!0),t},s.prototype["import"]=function(t){this.x=t.position.x,this.y=t.position.y,this.config.id=t.id,this.config.texture=t.texture,this.config.anchor={x:t.anchor.x,y:t.anchor.y},this.config.scale={x:t.scale.x,y:t.scale.y},this.config.rotation=t.rotation,this.config.depth=t.depth,this.config.data=t.data,t.selected&&(this.layer.selected=this)},Object.defineProperty(s.prototype,"depth",{get:function(){return this.config.depth}})},{"../Common":3,"../editor/Editor":14,"../editor/Level":15,"../editor/LevelLayer":16}],18:[function(t,e,i){function s(t){this.editor=t.editor,this.layer=t,this.assetManager=p3.AssetManager.instance,this.config={closed:!1,depth:0,collisions:1,texFill:this.editor.config.path.fill[0],texGround:this.editor.config.path.ground[0],texGroundEdge:this.editor.config.path.ground_edge[0],texWall:this.editor.config.path.wall[0],texFillPadding:512,texFillSize:256,texGroundSize:160,texGroundDelta:.1,texWallSize:160,texWallDelta:.1,texWallAngle:70,texGroundEdgeSide:"",data:""},this.bezier=new o,this.bezier.cacheDrawingPoints=!1,this.pointIndex=-1,this.wireframe=null,this.textures=null,this.lmb=!1,this.rmb=!1,this.dragMovement=null,PIXI.Container.call(this)}var n=t("../Common"),o=(t("../editor/Editor"),t("../editor/Level"),t("../editor/LevelLayer"),t("../editor/BezierPath"));e.exports=s,s.prototype=Object.create(PIXI.Container.prototype),s.prototype.constructor=s,s.prototype.init=function(){},s.prototype.update=function(){if(this.editor.mouse.leftPressed){var t=this.editor.getMousePosition();if(!this.lmb&&this.editor.mouse.leftJustPressed){if(this.lmb=!0,this.pointIndex=this.getClosestPointTo(t.x,t.y),this.pointIndex==-1){var e=this.bezier.points[this.bezier.points.length-1],i=t;if(this.config.closed||e.x<i.x)this.addPoint(e.x+(i.x-e.x)/2,e.y),this.addPoint(i.x-(i.x-e.x)/2,i.y),this.addPoint(i.x,i.y),this.pointIndex=this.bezier.points.length-1;else if(this.bezier.points.length>1&&i.x>this.bezier.getFirstPoint().x)for(var s=3;s<this.bezier.points.length;s+=3)if(this.bezier.points[s].x>i.x){var e=this.bezier.points[s-3],o=this.bezier.points[s];this.addPoint(o.x-(o.x-i.x)/2,i.y,s-1),this.addPoint(i.x,i.y,s-1),this.addPoint(e.x+(i.x-e.x)/2,i.y,s-1),this.pointIndex=s;break}this.render()}}else if(this.lmb&&this.pointIndex!=-1){var a=n.keyboard.getKeyPressed(n.keyboard.KEY_SHIFT),r=this.movePoint(this.pointIndex,t.x,t.y,a);r&&this.render()}}else this.lmb&&(this.lmb=!1,this.render(),this.editor.historyAddState());if(this.editor.mouse.rightPressed){var t=this.editor.getMousePosition();if(this.rmb){var h=this.editor.mouse.movement;h.multiply(1/this.editor.zoom),this.move(-Math.round(this.dragMovement.x/this.editor.snapGrid)*this.editor.snapGrid,-Math.round(this.dragMovement.y/this.editor.snapGrid)*this.editor.snapGrid),this.dragMovement.x+=h.x,this.dragMovement.y+=h.y,this.move(Math.round(this.dragMovement.x/this.editor.snapGrid)*this.editor.snapGrid,Math.round(this.dragMovement.y/this.editor.snapGrid)*this.editor.snapGrid),this.render()}else this.rmb=!0,this.dragMovement=new PIXI.Point(0,0)}else this.rmb&&(this.rmb=!1,this.editor.historyAddState());if(this.rmb)this.hoverGfx.visible=!1;else{var t=this.editor.getMousePosition(),l=this.getClosestPointTo(t.x,t.y);l!=-1?(this.hoverGfx.visible=!0,this.hoverGfx.x=this.bezier.points[l].x,this.hoverGfx.y=this.bezier.points[l].y):this.hoverGfx.visible=!1}var c=$("input:focus, textarea:focus").length>0;if(n.keyboard.getKeyJustPressed(n.keyboard.KEY_C)&&!n.keyboard.getKeyPressed(n.keyboard.KEY_CTRL)&&!c&&this.pointIndex%3==0&&this.bezier.points.length>1){var p=this.pointIndex==this.bezier.points.length-1;this.deletePoint(this.pointIndex),p&&(this.pointIndex-=3),this.render()}!n.keyboard.getKeyJustPressed(n.keyboard.KEY_K)||n.keyboard.getKeyPressed(n.keyboard.KEY_CTRL)||c||this.pointIndex%3==0&&this.bezier.points.length>1&&(this.splitPathAtPoint(this.pointIndex),this.render()),!n.keyboard.getKeyJustPressed(n.keyboard.KEY_B)||n.keyboard.getKeyPressed(n.keyboard.KEY_CTRL)||c||($("select:focus").blur(),$(".back").trigger("click")),n.keyboard.getKeyJustPressed(n.keyboard.KEY_W)&&!c&&(this.wireframe.visible=!this.wireframe.visible)},s.prototype.render=function(){if(this.hoverGfx?this.hoverGfx.clear():this.hoverGfx=new PIXI.Graphics,this.hoverGfx.beginFill(16737792,.6),this.hoverGfx.drawCircle(0,0,this.editor.snapGrid/this.editor.zoom),this.hoverGfx.endFill(),this.hoverGfx.visible=!1,null!=this.wireframe&&(this.removeChild(this.wireframe),this.wireframe.destroy(!0)),null!=this.textures&&this.removeChild(this.textures),this.wireframe=new PIXI.Graphics,this.textures=new PIXI.Container,this.bezier.points.length>1){var t=this.bezier.getDrawingPoints();if(""!=this.config.texFill){for(var e=null,i=[],s=0;s<t.length;s++)i.push(new poly2tri.Point(t[s].x,t[s].y)),(null==e||e<t[s].y)&&(e=t[s].y);this.config.closed?i[0].x==i[i.length-1].x&&i[0].y==i[i.length-1].y&&i.splice(i.length-1,1):(i.push(new poly2tri.Point(t[t.length-1].x,e+this.config.texFillPadding)),i.push(new poly2tri.Point(t[0].x,e+this.config.texFillPadding)));for(var s=0;s<i.length;s++)i[s].x=Math.round(i[s].x),i[s].y=Math.round(i[s].y);try{var n=new poly2tri.SweepContext(i);n.triangulate();var o=n.getTriangles()}catch(a){console.log("Triangulation failed",a)}if(o){var r=this.assetManager.getTexture(this.config.texFill);r.baseTexture.wrapMode=1;for(var h=new Float32Array(6*o.length),l=new Float32Array(6*o.length),c=new Uint16Array(3*o.length),p=this.config.texFillSize,s=0;s<o.length;s++){var d=o[s].getPoints();h.set([d[0].x,d[0].y,d[1].x,d[1].y,d[2].x,d[2].y],6*s),l.set([d[0].x/p,d[0].y/p,d[1].x/p,d[1].y/p,d[2].x/p,d[2].y/p],6*s),c.set([0+3*s,1+3*s,2+3*s],3*s)}var u=new PIXI.mesh.Mesh(r,h,l,c,PIXI.mesh.Mesh.DRAW_MODES.TRIANGLES);this.textures.addChild(u)}}if(""!=this.config.texWall){for(var _=this.bezier.getGroundSegments(this.config.texWallAngle,360),g=this.config.texWallSize,m=this.config.texWallDelta,y=0,f=0;f<_.length;f++)y+=_[f].points.length-1;var r=this.assetManager.getTexture(this.config.texWall);r.baseTexture.wrapMode=1;for(var h=new Float32Array(8*y),l=new Float32Array(8*y),c=new Uint16Array(6*y),x=0,f=0;f<_.length;f++)for(var v=0,b=0,s=0;s<_[f].normals.length-1;s++){h.set([_[f].points[s].x-_[f].normals[s].x*(g*m),_[f].points[s].y-_[f].normals[s].y*(g*m),_[f].points[s+1].x-_[f].normals[s+1].x*(g*m),_[f].points[s+1].y-_[f].normals[s+1].y*(g*m),_[f].points[s+1].x+_[f].normals[s+1].x*(g*(1-m)),_[f].points[s+1].y+_[f].normals[s+1].y*(g*(1-m)),_[f].points[s].x+_[f].normals[s].x*(g*(1-m)),_[f].points[s].y+_[f].normals[s].y*(g*(1-m))],8*x);var I=new PIXI.Point(_[f].points[s].x-_[f].points[s+1].x,_[f].points[s].y-_[f].points[s+1].y);b=I.getLength(),l.set([v/g,0,(v+b)/g,0,(v+b)/g,1,v/g,1],8*x),c.set([0+4*x,1+4*x,2+4*x,0+4*x,2+4*x,3+4*x],6*x),v+=b,x++}var u=new PIXI.mesh.Mesh(r,h,l,c,PIXI.mesh.Mesh.DRAW_MODES.TRIANGLES);this.textures.addChild(u)}var _=this.bezier.getGroundSegments(0,this.config.texWallAngle,""==this.config.texGroundEdge),C=this.config.texGroundSize,m=this.config.texGroundDelta;if(""!=this.config.texGround){for(var y=0,f=0;f<_.length;f++)y+=_[f].points.length-1;var r=this.assetManager.getTexture(this.config.texGround);r.baseTexture.wrapMode=1;for(var h=new Float32Array(8*y),l=new Float32Array(8*y),c=new Uint16Array(6*y),x=0,f=0;f<_.length;f++){0!=f||"right"!=this.config.texGroundEdgeSide&&"none"!=this.config.texGroundEdgeSide||(_[f].normals[0]={x:0,y:1}),f!=_.length-1||"left"!=this.config.texGroundEdgeSide&&"none"!=this.config.texGroundEdgeSide||(_[f].normals[_[f].normals.length-1]={x:0,y:1});for(var b=0,s=0;s<_[f].normals.length-1;s++){var I=new PIXI.Point(_[f].points[s].x-_[f].points[s+1].x,_[f].points[s].y-_[f].points[s+1].y);b+=I.getLength()}for(var g=b/Math.max(1,Math.round(b/C)),v=0,b=0,s=0;s<_[f].normals.length-1;s++){h.set([_[f].points[s].x-_[f].normals[s].x*(g*m),_[f].points[s].y-_[f].normals[s].y*(C*m),_[f].points[s+1].x-_[f].normals[s+1].x*(g*m),_[f].points[s+1].y-_[f].normals[s+1].y*(C*m),_[f].points[s+1].x+_[f].normals[s+1].x*(g*(1-m)),_[f].points[s+1].y+_[f].normals[s+1].y*(C*(1-m)),_[f].points[s].x+_[f].normals[s].x*(g*(1-m)),_[f].points[s].y+_[f].normals[s].y*(C*(1-m))],8*x);var I=new PIXI.Point(_[f].points[s].x-_[f].points[s+1].x,_[f].points[s].y-_[f].points[s+1].y);b=I.getLength(),l.set([v/g,0,(v+b)/g,0,(v+b)/g,1,v/g,1],8*x),c.set([0+4*x,1+4*x,2+4*x,0+4*x,2+4*x,3+4*x],6*x),v+=b,x++}}var u=new PIXI.mesh.Mesh(r,h,l,c,PIXI.mesh.Mesh.DRAW_MODES.TRIANGLES);this.textures.addChild(u)}if(""!=this.config.texGroundEdge){for(var r=this.assetManager.getTexture(this.config.texGroundEdge),h=new Float32Array(16*_.length),l=new Float32Array(16*_.length),c=new Uint16Array(12*_.length),f=0;f<_.length;f++){for(var b=0,s=0;s<_[f].normals.length-1;s++){var I=new PIXI.Point(_[f].points[s].x-_[f].points[s+1].x,_[f].points[s].y-_[f].points[s+1].y);b+=I.getLength()}var g=b/Math.round(b/C);if(f>0||"left"==this.config.texGroundEdgeSide||""==this.config.texGroundEdgeSide){var w=_[f].points[0],P=_[f].normals[0],I=new PIXI.Point(_[f].points[0].x-_[f].points[1].x,_[f].points[0].y-_[f].points[1].y);I.normalize(),h.set([w.x-P.x*(g*m)+I.x*g,w.y-P.y*(C*m-I.y*C),w.x-P.x*(g*m),w.y-P.y*(C*m),w.x+P.x*(g*(1-m)),w.y+P.y*(C*(1-m)),w.x+P.x*(g*(1-m))+I.x*g,w.y+P.y*(C*(1-m)+I.y*C)],8*f*2),l.set([0,0,1,0,1,1,0,1],8*f*2),c.set([0+2*f*4,1+2*f*4,2+2*f*4,0+2*f*4,2+2*f*4,3+2*f*4],6*f*2)}if(f<_.length-1||"right"==this.config.texGroundEdgeSide||""==this.config.texGroundEdgeSide){var T=_[f].normals.length-1,w=_[f].points[_[f].normals.length-1],P=_[f].normals[_[f].normals.length-1],I=new PIXI.Point(_[f].points[T].x-_[f].points[T-1].x,_[f].points[T].y-_[f].points[T-1].y);I.normalize(),h.set([w.x-P.x*(g*m)+I.x*g,w.y-P.y*(C*m-I.y*C),w.x-P.x*(g*m),w.y-P.y*(C*m),w.x+P.x*(g*(1-m)),w.y+P.y*(C*(1-m)),w.x+P.x*(g*(1-m))+I.x*g,w.y+P.y*(C*(1-m)+I.y*C)],8*(2*f+1)),l.set([0,0,1,0,1,1,0,1],8*(2*f+1)),c.set([0+4*(2*f+1),1+4*(2*f+1),2+4*(2*f+1),0+4*(2*f+1),2+4*(2*f+1),3+4*(2*f+1)],6*(2*f+1))}}var u=new PIXI.mesh.Mesh(r,h,l,c,PIXI.mesh.Mesh.DRAW_MODES.TRIANGLES);this.textures.addChild(u)}}this.wireframe.moveTo(this.bezier.points[0].x,this.bezier.points[0].y),this.wireframe.lineStyle(2/this.editor.zoom,16711680);for(var s=1;s<this.bezier.points.length;s+=3)this.wireframe.bezierCurveTo(this.bezier.points[s].x,this.bezier.points[s].y,this.bezier.points[s+1].x,this.bezier.points[s+1].y,this.bezier.points[s+2].x,this.bezier.points[s+2].y);this.wireframe.lineStyle(2/this.editor.zoom,10027008,.5);for(var s=0;s<this.bezier.points.length-1;s+=3)this.wireframe.moveTo(this.bezier.points[s].x,this.bezier.points[s].y),this.wireframe.lineTo(this.bezier.points[s+1].x,this.bezier.points[s+1].y),this.wireframe.moveTo(this.bezier.points[s+2].x,this.bezier.points[s+2].y),this.wireframe.lineTo(this.bezier.points[s+3].x,this.bezier.points[s+3].y);for(var s=0;s<this.bezier.points.length;s++)s%3==0&&(s==this.pointIndex?this.wireframe.lineStyle(2/this.editor.zoom,65280,1):this.wireframe.lineStyle(0/this.editor.zoom,16711680,0),this.wireframe.beginFill(16711680),this.wireframe.drawCircle(this.bezier.points[s].x,this.bezier.points[s].y,5/this.editor.zoom),this.wireframe.endFill());for(var s=0;s<this.bezier.points.length;s++)s%3!=0&&(s==this.pointIndex?this.wireframe.lineStyle(2/this.editor.zoom,65280,1):this.wireframe.lineStyle(0/this.editor.zoom,16711680,0),this.wireframe.beginFill(10027212),this.wireframe.drawCircle(this.bezier.points[s].x,this.bezier.points[s].y,4/this.editor.zoom),this.wireframe.endFill());this.addChild(this.textures),this.addChild(this.hoverGfx),this.addChild(this.wireframe),this.wireframe.visible=this.layer.selected==this},s.prototype.renderGUI=function(){this.editor.renderGUI("path")},s.prototype.back=function(){this.layer.selected=null,this.bezier.points.length<=1&&this.layer.deletePath(this),this.hoverGfx.visible=!1,this.editor.historyAddState()},s.prototype.addPoint=function(t,e,i){t=Math.round(t/this.editor.snapGrid)*this.editor.snapGrid,e=Math.round(e/this.editor.snapGrid)*this.editor.snapGrid,this.bezier.addPoint(t,e,i)},s.prototype.deletePoint=function(t){if(t%3==0){var e=0==t,i=t==this.bezier.points.length-1;e&&this.bezier.deletePoint(t+2),i||this.bezier.deletePoint(t+1),this.bezier.deletePoint(t),e||this.bezier.deletePoint(t-1),i&&this.bezier.deletePoint(t-2)}},s.prototype.splitPathAtPoint=function(t){var e=0==t,i=t==this.bezier.points.length-1;e||i||this.layer.splitPath(this,t)},s.prototype.movePoint=function(t,e,i,s){var n=new PIXI.Point(this.bezier.points[t].x,this.bezier.points[t].y);if(this.bezier.points[t].x=Math.round(e/this.editor.snapGrid)*this.editor.snapGrid,this.bezier.points[t].y=Math.round(i/this.editor.snapGrid)*this.editor.snapGrid,this.bezier.points[t].x==n.x&&this.bezier.points[t].y==n.y)return!1;if(t%3==0)t>0&&(this.bezier.points[t-1].x+=this.bezier.points[t].x-n.x,this.bezier.points[t-1].y+=this.bezier.points[t].y-n.y),t<this.bezier.points.length-1&&(this.bezier.points[t+1].x+=this.bezier.points[t].x-n.x,this.bezier.points[t+1].y+=this.bezier.points[t].y-n.y);else if(s){if(1==t||t==this.bezier.points.length-2)return!0;if(t%3==1)var o=this.bezier.points[t-1],a=this.bezier.points[t-2];else var o=this.bezier.points[t+1],a=this.bezier.points[t+2];var r=new PIXI.Point(this.bezier.points[t].x-o.x,this.bezier.points[t].y-o.y);a.x=o.x-r.x,a.y=o.y-r.y}return!0},s.prototype.getPointIndexAt=function(t,e){t=Math.round(t/this.editor.snapGrid)*this.editor.snapGrid,e=Math.round(e/this.editor.snapGrid)*this.editor.snapGrid;for(var i=this.bezier.points.length-1;i>=0;i--)if(i%3!=0&&this.bezier.points[i].x==t&&this.bezier.points[i].y==e)return i;for(var i=this.bezier.points.length-1;i>=0;i--)if(i%3==0&&this.bezier.points[i].x==t&&this.bezier.points[i].y==e)return i;return-1},s.prototype.getClosestPointTo=function(t,e,i){for(var i=i||1*this.editor.snapGrid/this.editor.zoom,s=this.bezier.points.length-1;s>=0;s--)if(s%3!=0){var n=Math.sqrt(Math.pow(this.bezier.points[s].x-t,2)+Math.pow(this.bezier.points[s].y-e,2));if(n<i)return s}for(var s=this.bezier.points.length-1;s>=0;s--)if(s%3==0){var n=Math.sqrt(Math.pow(this.bezier.points[s].x-t,2)+Math.pow(this.bezier.points[s].y-e,2));if(n<i)return s}return-1},s.prototype.move=function(t,e){for(var i=0;i<this.bezier.points.length;i++)this.bezier.points[i].x+=t,this.bezier.points[i].y+=e},s.prototype.flipH=function(){for(var t=null,e=null,i=[],s=0;s<this.bezier.points.length;s++)(null==t||this.bezier.points[s].x<t)&&(t=this.bezier.points[s].x),(null==e||this.bezier.points[s].x>e)&&(e=this.bezier.points[s].x);for(var n=e-t,i=[],s=this.bezier.points.length-1;s>=0;s--){var o=(this.bezier.points[s].x-t)/n;i.push({x:t+(1-o)*n,y:this.bezier.points[s].y})}this.bezier.points=i},s.prototype.flipV=function(){for(var t=null,e=null,i=[],s=0;s<this.bezier.points.length;s++)(null==t||this.bezier.points[s].y<t)&&(t=this.bezier.points[s].y),(null==e||this.bezier.points[s].y>e)&&(e=this.bezier.points[s].y);for(var n=e-t,i=[],s=this.bezier.points.length-1;s>=0;s--){var o=(this.bezier.points[s].y-t)/n;i.push({x:this.bezier.points[s].x,y:t+(1-o)*n})}this.bezier.points=i},s.prototype.setConfig=function(t,e,i){this.config[t]=e,i&&this.editor.historyAddState()},s.prototype["export"]=function(){var t=jQuery.extend(!0,{},this.config);t.points=this.bezier.points,t.bounds=[null,null];for(var e=0;e<this.bezier.points.length;e++)t.bounds[0]=null===t.bounds[0]?this.bezier.points[e].x:Math.min(t.bounds[0],this.bezier.points[e].x),t.bounds[1]=null===t.bounds[1]?this.bezier.points[e].x:Math.max(t.bounds[1],this.bezier.points[e].x);return this.layer.selected==this&&(t.selected=!0,t.pointIndex=this.pointIndex),t},s.prototype["import"]=function(t){this.config.closed=t.closed,this.config.depth=t.depth,this.config.collisions=t.collisions,this.config.texFill=t.texFill,this.config.texGround=t.texGround,this.config.texGroundEdge=t.texGroundEdge,this.config.texGroundEdgeSide=t.texGroundEdgeSide,this.config.texWall=t.texWall,this.config.texFillPadding=t.texFillPadding,this.config.texFillSize=t.texFillSize,this.config.texGroundSize=t.texGroundSize,this.config.texGroundDelta=t.texGroundDelta,this.config.texWallSize=t.texWallSize,this.config.texWallDelta=t.texWallDelta,this.config.texWallAngle=t.texWallAngle,this.config.data=t.data,t.selected&&(this.layer.selected=this,this.pointIndex=t.pointIndex);for(var e=0;e<t.points.length;e++)this.bezier.addPoint(t.points[e].x,t.points[e].y)},Object.defineProperty(s.prototype,"depth",{get:function(){return this.config.depth}}),Object.defineProperty(s.prototype,"pointsCount",{get:function(){return this.bezier.points.length}}),Object.defineProperty(s.prototype,"visiblePointsCount",{get:function(){return Math.floor((this.bezier.points.length+2)/3)}})},{"../Common":3,"../editor/BezierPath":13,"../editor/Editor":14,"../editor/Level":15,"../editor/LevelLayer":16}],19:[function(t,e,i){"use strict";function s(){this.x=0,this.y=0,this.xInc=0,this.yInc=0,this.xMax=null,this.yMax=null,this.xMin=null,this.yMin=null}e.exports=s,s.prototype.update=function(t){this.x+=this.xInc*t,this.y+=this.yInc*t,this.xMax&&(this.x=Math.min(this.x,this.xMax)),this.xMin&&(this.x=Math.max(this.x,this.xMin)),this.yMax&&(this.y=Math.min(this.y,this.yMax)),this.yMin&&(this.y=Math.max(this.y,this.yMin))}},{}],20:[function(t,e,i){"use strict";function s(t,e){this.signals={},this.signals.disposed=new signals.Signal,this.type=t,this.collisionRect=null,this.collisionCircle=null,this.areaRect=null,this.collidable=!1,this.removeWhenOutside=e,this.layer=null,this._sounds=[],this.collisionGraphic=null,PIXI.Container.call(this)}var n=t("../Common");e.exports=s,s.prototype=Object.create(PIXI.Container.prototype),s.prototype.constructor=s,s.prototype.init=function(){},s.prototype.destroy=function(t){this.dispose(),PIXI.Container.prototype.destroy.call(this,t)},s.prototype.update=function(){},s.prototype.reset=function(){this.x=0,this.y=0,this.removeMe=!1},s.prototype.dispose=function(){this.signals.disposed.dispatch(this),this.removed=!0,this.stopSound(),this.layer=null},s.prototype.pause=function(){},s.prototype.resume=function(){},s.prototype.drawCollision=function(){this.collisionGraphic&&this.removeChild(this.collisionGraphic),this.collisionGraphic=new PIXI.Graphics,this.addChild(this.collisionGraphic),this.collisionGraphic.lineStyle(2,16191773),null!=this.collisionRect&&this.collisionGraphic.drawRect(this.collisionRect.x,this.collisionRect.y,this.collisionRect.width,this.collisionRect.height),null!=this.collisionCircle&&this.collisionGraphic.drawCircle(this.collisionCircle.x,this.collisionCircle.y,this.collisionCircle.radius)},s.prototype.playSound=function(t,e){return this._sounds[t]=n.audio.playSound(t,e),this._sounds[t].playing=!0,this._sounds[t].volume=1,this._sounds[t]},s.prototype.playRandomSound=function(t,e){if(0==t.length)return!1;var i=t[p3.Utils.randomInt(0,t.length-1)];return this.playSound(i,e)},s.prototype.stopSound=function(t){for(var e in this._sounds)t&&t!=e||n.audio.stopSound(e,this._sounds[e].id)},s.prototype.isPointWithinScreenBounds=function(t,e){var i=t||0,s=e||0,n=this.worldTransform;return i+=n.tx,s+=n.ty,i>0&&i<p3.View.width&&s>0&&s<p3.View.height}},{"../Common":3}],21:[function(t,e,i){function s(t,e){PIXI.Container.call(this),this.scene=t,this.level=e,this._canShowGoal=!1,this._goalsQueue=[],this._progressBarWidth=0,this._characterData=n.assets.getJSON("config").characters[n.savedData.character],this._goals=n.goalsManager.getActiveGoals()}var n=t("../Common"),o=t("../shaders/CooldownFilter");e.exports=s,s.prototype=Object.create(PIXI.Container.prototype),s.prototype.constructor=s,s.prototype.init=function(){if(this._gameoverOverlay=new PIXI.Sprite(PIXI.Texture.WHITE),this._gameoverOverlay.width=n.STAGE_WIDTH,this._gameoverOverlay.height=n.STAGE_HEIGHT,this._gameoverOverlay.tint=13373713,this._gameoverOverlay.alpha=.25,this._gameoverOverlay.blendMode=1,this._gameoverOverlay.visible=!1,this.addChild(this._gameoverOverlay),this._coinsContainer=new PIXI.Container,this._coinsContainer.y=80,this.addChild(this._coinsContainer),this._coinsContainer.bg=new PIXI.Sprite(n.assets.getTexture("ui_tokens_bg")),this._coinsContainer.bg.anchor.set(0,.5),this._coinsContainer.bg.scale.set(.8),this._coinsContainer.bg.x+=10,this._coinsContainer.addChild(this._coinsContainer.bg),this._coinsContainer.label=n.createText("0",{size:60}),this._coinsContainer.label.x=180,this._coinsContainer.label.y=-12,this._coinsContainer.addChild(this._coinsContainer.label),this._coinsContainer.coin=new PIXI.Sprite(PIXI.Texture.WHITE),this._coinsContainer.coin.anchor.set(.5),this._coinsContainer.coin.position.x=60,this._coinsContainer.coin.visible=!1,this._coinsContainer.addChild(this._coinsContainer.coin),this.level.endless&&(this._distanceContainer=new PIXI.Container,this._distanceContainer.y=this._coinsContainer.y,this.addChild(this._distanceContainer),this._distanceContainer.bg=new PIXI.Sprite(n.assets.getTexture("ui_distance_bg")),this._distanceContainer.bg.anchor.set(0,.5),this._distanceContainer.bg.scale.set(.8),this._distanceContainer.bg.x+=10,this._distanceContainer.addChild(this._distanceContainer.bg),this._distanceContainer.label=n.createText("0",{size:40}),this._distanceContainer.label.x=186,this._distanceContainer.label.y=-10,this._distanceContainer.addChild(this._distanceContainer.label)),!this.level.endless){this.progressBar=new PIXI.Container,this.progressBar.x=n.STAGE_WIDTH/2-this.progressBar.width/2,this.progressBar.y=n.STAGE_HEIGHT-60,this.addChild(this.progressBar),this.progressBar.capLeft=new PIXI.Sprite(n.assets.getTexture("ingame_progress_bar_on_side")),this.progressBar.capLeft.anchor.set(1,.5),this.progressBar.addChild(this.progressBar.capLeft),this.progressBar.capRight=new PIXI.Sprite(n.assets.getTexture("ingame_progress_bar_off_side")),this.progressBar.capRight.anchor.set(0,.5),this.progressBar.addChild(this.progressBar.capRight);var t=n.assets.getTexture("ingame_progress_bar_off");this.progressBar.barBg=new PIXI.extras.TilingSprite(t,0,t.height),this.progressBar.barBg.anchor.set(0,.5),this.progressBar.addChild(this.progressBar.barBg);var t=n.assets.getTexture("ingame_progress_bar_on");this.progressBar.bar=new PIXI.extras.TilingSprite(t,0,t.height),this.progressBar.bar.anchor.set(0,.5),this.progressBar.addChild(this.progressBar.bar),this.progressBar.collectibles=new PIXI.Container,this.progressBar.bar.addChild(this.progressBar.collectibles),this.progressBar.chara=new PIXI.Sprite(n.assets.getTexture("ingame_progress_symbol")),this.progressBar.chara.anchor.set(.5),this.progressBar.chara.scale.set(.5),this.progressBar.bar.addChild(this.progressBar.chara)}this.level.endless||(this._collectiblesContainer=new PIXI.Container,this._collectiblesContainer.y=80,this.addChild(this._collectiblesContainer),this._collectiblesContainer.bg=new PIXI.Sprite(n.assets.getTexture("ui_progress_bg")),this._collectiblesContainer.bg.anchor.set(0,.5),this._collectiblesContainer.addChild(this._collectiblesContainer.bg),this._collectiblesContainer.fill=new PIXI.Sprite(n.assets.getTexture("ui_progress_fill")),this._collectiblesContainer.fill.anchor.set(-.315,.65),this._collectiblesContainer.fill.x=-208,this._collectiblesContainer.addChild(this._collectiblesContainer.fill),this._collectiblesContainer.fill.mask=new PIXI.Sprite(n.assets.getTexture("ui_progress_fill")),this._collectiblesContainer.fill.mask.anchor.copy(this._collectiblesContainer.fill.anchor),this._collectiblesContainer.addChild(this._collectiblesContainer.fill.mask),this._collectiblesContainer.icon=new PIXI.Sprite(n.assets.getTexture("ui_progress_icon")),this._collectiblesContainer.icon.anchor.set(.5),this._collectiblesContainer.icon.x=100,this._collectiblesContainer.addChild(this._collectiblesContainer.icon),this.updateCollectibles()),this._tutorial=new PIXI.Container,this._tutorial.x=n.STAGE_WIDTH/2,
this._tutorial.y=100,this._tutorial.scale.set(0),this.addChild(this._tutorial),this._tutorial.bg=new PIXI.Sprite(n.assets.getTexture("ui_text_panel")),this._tutorial.bg.anchor.set(.5),this._tutorial.addChild(this._tutorial.bg),this._tutorial.label=n.createText("PLACEHOLDER",{size:28,align:"center"}),this._tutorial.label.anchor.set(.5),this._tutorial.label.y=-5,this._tutorial.addChild(this._tutorial.label),this._goal=new PIXI.Container,this._goal.x=n.STAGE_WIDTH/2,this._goal.y=n.STAGE_HEIGHT/2+250,this._goal.scale.set(0),this.addChild(this._goal);var e=new PIXI.Sprite(n.assets.getTexture("ui_goal_bg"));e.anchor.set(.5),this._goal.addChild(e),this._goal.label=n.createText("PLACEHOLDER",{align:"left",size:22}),this._goal.label.x=-190,this._goal.label.y=-6,this._goal.label.anchor.set(0,.5),e.addChild(this._goal.label),this._goal.coin=new PIXI.Sprite(n.assets.getTexture("ui_icon_ability_token")),this._goal.coin.x=200,this._goal.coin.anchor.set(.5),this._goal.coin.scale.set(.6),this._goal.addChild(this._goal.coin),this._goal.reward=n.createText("PLACEHOLDER",{size:24}),this._goal.reward.anchor.set(0,.5),this._goal.reward.x=240,this._goal.reward.y=-5,e.addChild(this._goal.reward);var i=new PIXI.Sprite(n.assets.getTexture("ui_goal_icon"));i.anchor.set(.5),e.addChild(i),this._goalCoins=[];for(var s=0;s<30;s++){var a=new PIXI.Sprite(n.assets.getTexture("ui_icon_ability_token"));a.anchor.set(.5),a.alpha=0,this.addChild(a),this._goalCoins.push(a)}var r=new p3.ButtonStates(n.assets.getTexture("btns/ui_btn_jump_out"),n.assets.getTexture("btns/ui_btn_jump_over"),n.assets.getTexture("btns/ui_btn_jump_over"),n.assets.getTexture("btns/ui_icon_jump"));if(this._jumpButton=new p3.Button(r),this._jumpButton.y=n.STAGE_HEIGHT-180,this._jumpButton.signals.down.add(function(){this.level.avatar.kJumpStart=!0},this),this._jumpButton.signals.up.add(function(){this.level.avatar.kJumpEnd=!0},this),this.addChild(this._jumpButton),!p3.Device.isMobile){var h=new PIXI.Sprite(n.assets.getTexture("btns/ui_btn_key_bg"));h.anchor.set(.5),this._jumpButton.addChild(h);var l=new PIXI.Sprite(n.assets.getTexture("btns/ui_btn_key_up"));l.anchor.set(.5),h.addChild(l)}var r=new p3.ButtonStates(n.assets.getTexture("btns/ui_btn_punch_out"),n.assets.getTexture("btns/ui_btn_punch_over"),n.assets.getTexture("btns/ui_btn_punch_over"),n.assets.getTexture("btns/ui_icon_punch"));this._attackButton=new p3.Button(r),this._attackButton.y=n.STAGE_HEIGHT-300,this._attackButton.signals.down.add(function(){this.level.avatar.kAttack=!0},this),this.addChild(this._attackButton),this._attackButton.desaturateFilter=new PIXI.filters.ColorMatrixFilter,this._attackButton.children[1].filters=[this._attackButton.desaturateFilter],this._attackButton.cooldown=new PIXI.Sprite(n.assets.getTexture("btns/ui_btn_special_cooldown")),this._attackButton.cooldown.anchor.set(.5),this._attackButton.cooldown.filters=[new o],this._attackButton.cooldown.tint=16689670,this._attackButton.cooldown.tintPercentage=0,this._attackButton.addChildAt(this._attackButton.cooldown,1);var h=new PIXI.Sprite(n.assets.getTexture("btns/ui_btn_key_bg"));h.anchor.set(.5),h.visible=!p3.Device.isMobile,this._attackButton.addChild(h),this._attackButton.label=n.createText("X",{size:26}),this._attackButton.label.y=50,h.addChild(this._attackButton.label);var r=new p3.ButtonStates(n.assets.getTexture("btns/ui_btn_special_out"),n.assets.getTexture("btns/ui_btn_special_over"),n.assets.getTexture("btns/ui_btn_special_over"),n.assets.getTexture("btns/ui_icon_special_"+this.level.avatar.character));this._specialButton=new p3.Button(r),this._specialButton.y=n.STAGE_HEIGHT-180,this._specialButton.signals.down.add(function(){this.level.avatar.kSpecial=!0},this),this._specialButton.chargePercentage=1,this.addChild(this._specialButton),this._specialButton.desaturateFilter=new PIXI.filters.ColorMatrixFilter,this._specialButton.children[1].filters=[this._specialButton.desaturateFilter],this._specialButton.cooldown=new PIXI.Sprite(n.assets.getTexture("btns/ui_btn_special_cooldown")),this._specialButton.cooldown.anchor.set(.5),this._specialButton.cooldown.filters=[new o],this._specialButton.cooldown.tint=16711680,this._specialButton.cooldown.tintPercentage=0,this._specialButton.addChildAt(this._specialButton.cooldown,1);var h=new PIXI.Sprite(n.assets.getTexture("btns/ui_btn_key_bg"));h.anchor.set(.5),h.visible=!p3.Device.isMobile,this._specialButton.addChild(h),this._specialButton.label=n.createText("C",{size:26}),this._specialButton.label.y=50,h.addChild(this._specialButton.label)},s.prototype.update=function(){if(this._coinsContainer.label.text!=this.level.coins&&(this._coinsContainer.label.text=this.level.coins),this.level.endless){var t=this.level.avatar.distance+"m";this._distanceContainer.label.text!=t&&(this._distanceContainer.label.text=t)}this.level.endless||(this.progressBar.bar.width=Math.max(0,Math.min(1,this.level.avatar.x/this.level.config.length))*this._progressBarWidth,this.progressBar.chara.x=this.progressBar.bar.width),this._goalsQueue.length>0&&this._canShowGoal&&this.showGoal();var e=1-this.level.avatar.attackCooldown/this.level.avatar.attackCooldownMax;if(this._attackButton.chargePercentage!=e&&(this._attackButton.chargePercentage=e,this._attackButton.cooldown.filters[0].uniforms.percentage=e,this._attackButton.desaturateFilter.saturate(-1+e,!1),1==e)){TweenMax.killTweensOf(this._attackButton.cooldown);var i=this.scene.createTimeline({onUpdateScope:this,onUpdate:function(){var t=this._attackButton.cooldown.tintPercentage;this._attackButton.cooldown.tint=(Math.round(255)<<16)+(Math.round(255*(.66+t*(1-.66)))<<8)+Math.round(255*(.02+.98*t))}});i.to(this._attackButton.cooldown,.2,{tintPercentage:1,ease:Sine.easeInOut},0),i.to(this._attackButton.cooldown,.4,{tintPercentage:0,ease:Sine.easeInOut},.2)}var e=1-this.level.avatar.specialCooldown/this.level.avatar.specialCooldownMax;if(this._specialButton.chargePercentage!=e){this._specialButton.chargePercentage=e;var s=1==e?"C":Math.ceil(this.level.avatar.specialCooldown);if(s!=this._specialButton.label.text&&(this._specialButton.label.text=s),this._specialButton.cooldown.filters[0].uniforms.percentage=e,this._specialButton.desaturateFilter.saturate(-1+e,!1),1==e){n.audio.playSound("sfx_ui_powerup_ready_00"),TweenMax.killTweensOf(this._specialButton.cooldown);var i=this.scene.createTimeline({onUpdateScope:this,onUpdate:function(){var t=this._specialButton.cooldown.tintPercentage;this._specialButton.cooldown.tint=(Math.round(255)<<16)+(Math.round(255*t)<<8)+Math.round(255*t)}});i.to(this._specialButton.cooldown,.2,{tintPercentage:1,ease:Sine.easeInOut},0),i.to(this._specialButton.cooldown,.8,{tintPercentage:0,ease:Sine.easeInOut},.2)}}},s.prototype.resize=function(){if(this._coinsContainer&&(this._coinsContainer.x=n.STAGE_WIDTH/2-p3.View.width/2+40),p3.Device.isMobile&&(this._coinsContainer.x+=80),this._collectiblesContainer&&(this._collectiblesContainer.x=n.STAGE_WIDTH/2-this._collectiblesContainer.bg.width/2),this._distanceContainer&&(this._distanceContainer.x=n.STAGE_WIDTH/2-this._distanceContainer.bg.width/2),!this.level.endless&&(this._progressBarWidth=Math.round(Math.min(n.STAGE_WIDTH,p3.View.width)-100),this.progressBar.capLeft.x=-this._progressBarWidth/2,this.progressBar.capRight.x=this._progressBarWidth/2,this.progressBar.barBg.x=-this._progressBarWidth/2,this.progressBar.barBg.width=this._progressBarWidth,this.progressBar.bar.x=-this._progressBarWidth/2,this.progressBar.collectibles.data))for(var t=0;t<this.progressBar.collectibles.children.length;t++)this.progressBar.collectibles.children[t].x=this._progressBarWidth*this.progressBar.collectibles.data[t];this._jumpButton.x=n.STAGE_WIDTH/2+p3.View.width/2-120,this._attackButton.x=n.STAGE_WIDTH/2-p3.View.width/2+120,this._specialButton.x=n.STAGE_WIDTH/2-p3.View.width/2+240},s.prototype.queueGoal=function(t,e){this._goalsQueue.push({text:t,reward:e})},s.prototype.showGoal=function(){this._canShowGoal=!1;var t=this._goalsQueue.splice(0,1)[0];this._goal.label.text=t.text.toUpperCase(),this._goal.label.scale.set(1),this._goal.reward.text=t.reward+"";var e=this.scene.createTimeline({onCompleteScope:this,onComplete:function(){this._canShowGoal=!0}});e.to(this._goal.scale,.5,{x:1,y:1,ease:Back.easeOut},0),e.to(this._goal.scale,.5,{x:0,y:0,ease:Back.easeIn},2)},s.prototype.showGoals=function(t,e){var i=new PIXI.Container;i.x=n.STAGE_WIDTH/2,i.y=n.STAGE_HEIGHT/2+140,this.addChild(i);for(var s=0,o=0;o<this._goals.length;o++){var a=this._goals[o].id,r=n.goalsManager.getGoalStatus(a),h=this._goals[o].reward,l=new PIXI.Container;l.y=60*o,i.addChild(l);var c=new PIXI.Sprite(n.assets.getTexture("ui_goal_bg"));c.anchor.set(.5),c.scale.y=.6,c.alpha=.66,l.addChild(c);var p=new PIXI.Sprite(n.assets.getTexture("ui_goal_fill"));p.anchor.set(.4,.5),p.tint=1==r?3530019:15261205,p.width=c.width-10,p.x=-(.1*p.width)-(1-r)*p.width,p.scale.y=.6,l.addChild(p);var d=new PIXI.Sprite(PIXI.Texture.WHITE);d.width=p.width,d.height=p.height,d.anchor.set(.5),l.addChild(d),p.mask=d;var u=new PIXI.Sprite(n.assets.getTexture("ui_goal_icon"));u.anchor.set(.5),u.x-=.2*c.width,u.scale.set(.6),l.addChild(u);var _=n.createText(this._goals[o].label,{size:26,align:"left"});if(_.x=-230,_.y=-5,_.anchor.set(0,.5),l.addChild(_),t&&1==r){s+=h;var g=new PIXI.Sprite(n.assets.getTexture("ui_icon_ability_token"));g.x=225,g.y=2,g.anchor.set(.5),g.scale.set(.5),l.addChild(g);var _=n.createText(h,{size:24});_.anchor.set(0,.5),_.x=g.x+30,_.y=-5,l.addChild(_);for(var m=0,y=10,f=this.scene.createTimeline({delay:e||0}),x=0;x<this._goalCoins.length&&m<y;x++){var v=this._goalCoins[x];v.alpha>0||(this.addChild(v),v.position.set(i.x+l.x+g.x,i.y+l.y+g.y),v.scale.set(0),v.alpha=1,f.to(v.scale,1,{x:1,y:1,ease:Quart.easeOut},.1*(m+o/3)),f.to(v,1,{x:this._coinsContainer.x+this._coinsContainer.coin.x,y:this._coinsContainer.y+this._coinsContainer.coin.y,ease:Sine.easeInOut},.1*(m+o/3)),f.to(v,1,{rotation:2*Math.PI,ease:Sine.easeInOut},.1*(m+o/3)),f.to(v,.01,{alpha:0,ease:Linear.easeNone}),m++)}}}var f=this.scene.createTimeline({delay:e||0,onCompleteScope:this,onComplete:function(){this.removeChild(i),this._canShowGoal=!0}});if(f.to(i,.3,{alpha:1,ease:Sine.easeOut},0),f.to(i,.3,{y:i.y,ease:Sine.easeOut},0),f.to(i,.3,{alpha:0,ease:Sine.easeOut},2.5),f.to(i,.3,{y:i.y+100,ease:Sine.easeOut},2.5),0!=s){var f=this.scene.createTimeline();f.to(this.level,1,{coins:this.level.coins+s,ease:Linear.easeNone,onUpdateScope:this,onUpdate:function(){this.level.coins=Math.floor(this.level.coins)}},.9)}i.alpha=0,i.y+=100,this._canShowGoal=!1},s.prototype.tutorial=function(t,e){this._tutorial.label.text=t.toUpperCase(),this._tutorialTween=this.scene.createTimeline(),this._tutorialTween.to(this._tutorial.scale,.5,{x:1,y:1,ease:Back.easeOut},0),this._tutorialTween.to(this._tutorial.scale,.5,{x:0,y:0,ease:Back.easeIn},e||2)},s.prototype.highlight=function(t){switch(this._highlight||(this._highlight=new PIXI.Sprite(n.assets.getTexture("ui_icon_nav_play")),this._highlight.anchor.set(.5),this.addChild(this._highlight)),t){case"style":this._highlight.position.set(this._styleContainer.x+200,this._styleContainer.y),this._highlight.scale.set(-1,1);break;default:return}this._highlightTween&&this._highlightTween.kill(),this._highlightTween=this.scene.createTimeline(),this._highlightTween.to(this._highlight.scale,.3,{x:this._highlight.scale.x,y:this._highlight.scale.y,ease:Back.easeOut},0),this._highlightTween.to(this._highlight.scale,.3,{x:0,y:0,ease:Back.easeIn},2),this._highlight.scale.set(0,0)},s.prototype.gameOver=function(){var t=this.scene.createTimeline();t.to(this._goal,.5,{alpha:0,ease:Linear.easeNone},0),this.level.endless||t.to(this.progressBar,.5,{alpha:0,ease:Linear.easeNone},0)},s.prototype.showRedOverlay=function(){this._gameoverOverlay.visible=!0;var t=this.scene.createTimeline();t.from(this._gameoverOverlay,1.5,{alpha:0,ease:Sine.easeInOut},0)},s.prototype.updateCollectibles=function(){if(!this.level.endless){var t=n.savedData.getLevelCollectiblesCollectedPercentage(this.level.levelIndex);this._collectiblesContainer.fill.x=-208*(1-t);var e=this.scene.createTimeline();if(e.to(this._collectiblesContainer.icon.scale,.2,{x:1.4,y:1.4,ease:Quad.easeOut}),e.to(this._collectiblesContainer.icon.scale,.3,{x:1,y:1,ease:Quad.easeIn}),this.progressBar.collectibles.data)for(var i=0;i<this.progressBar.collectibles.children.length;i++)this.progressBar.collectibles.children[i].visible=!n.savedData.isCollectibleCollected(this.level.levelIndex,i)}},s.prototype.addProgressBarCollectibles=function(t){if(this.progressBar){this.progressBar.collectibles.data=t;for(var e=0;e<t.length;e++){var i=new PIXI.Sprite(n.assets.getTexture("ui_progress_icon"));i.anchor.set(.5),i.scale.set(.3),i.visible=!n.savedData.isCollectibleCollected(this.level.levelIndex,e),this.progressBar.collectibles.addChild(i)}this.updateCollectibles()}}},{"../Common":3,"../shaders/CooldownFilter":80}],22:[function(t,e,i){function s(t,e,i,s,o){switch(PIXI.Container.call(this),this.scene=t,this.debug=!1,this.data=i,this.levelTheme=s,this.levelIndex=o||0,this.layerContainer=null,this.layers=[],this.objectManager=null,this.endless=e,this.completed=!1,this.defaultZoom=.75,this._deltaTime=0,this._deltaTimeScale=1,this.styleScore=0,this.coins=0,this.collectibleIndex=0,i&&(this.endless?(console.log(n.assets.getJSON(i.start[0])),this.config=n.assets.getJSON(i.start[0])):(console.log(n.assets.getJSON(i)),this.config=n.assets.getJSON(i))),this.scene.character){case"iron_man":this.avatar=new v(this.scene.character);break;case"captain_america":this.avatar=new b(this.scene.character);break;case"hulk":this.avatar=new I(this.scene.character);break;case"falcon":this.avatar=new C(this.scene.character);break;case"black_widow":this.avatar=new w(this.scene.character);break;case"thor":this.avatar=new P(this.scene.character);break;case"hawkeye":this.avatar=new T(this.scene.character);break;case"black_panther":this.avatar=new S(this.scene.character);break;default:this.avatar=new Avatar(this.scene.character)}this.focusPoint=new PIXI.Point(this.avatar.focusPointLand.point.x,this.avatar.focusPointLand.point.y),this.focusXActive=!0,this.focusYActive=!0,this.focusPosition=new PIXI.Point(0,0),this.focusPointTween=null,this.zoom=1,this.zoomTarget=1,this.zoomTween=null,this._isShake=!1,this._shakeTime=0,this._shakeTimeEnd=1,this._shakeStrength=new PIXI.Point(10,10),this.effects=[]}var n=t("../Common"),o=(t("../editor/BezierPath"),t("../game/LevelLayer")),a=(t("../game/LevelPath"),t("../game/LevelRecord")),r=t("../game/ObjectManager"),h=t("../game/objects/decoration/ObjectDecoration"),l=t("../game/objects/triggers/ObjectLevelEnd"),c=t("../game/objects/triggers/ObjectGameOver"),p=t("../game/objects/triggers/ObjectLevelBulletTime"),d=t("../game/objects/triggers/ObjectCameraZoom"),u=t("../game/objects/triggers/ObjectTutorial"),_=t("../game/objects/triggers/ObjectRollLock"),g=t("../game/objects/triggers/ObjectRollUnlock"),m=t("../game/objects/collectibles/ObjectCoin"),y=t("../game/objects/collectibles/ObjectCollectible"),f=(t("../game/objects/obstacles/ObstacleStatic"),t("../game/objects/avatar/Enemy")),x=t("../game/objects/avatar/EnemyScientistBack"),v=(t("../game/objects/avatar/Avatar"),t("../game/objects/avatar/AvatarIronMan")),b=t("../game/objects/avatar/AvatarCaptainAmerica"),I=t("../game/objects/avatar/AvatarHulk"),C=t("../game/objects/avatar/AvatarFalcon"),w=t("../game/objects/avatar/AvatarBlackWidow"),P=t("../game/objects/avatar/AvatarThor"),T=t("../game/objects/avatar/AvatarHawkeye"),S=t("../game/objects/avatar/AvatarBlackPanther"),k=t("../game/objects/decoration/ObjectHint"),B=t("../game/objects/decoration/ObjectSwitch"),M=t("../game/objects/decoration/ObjectCage");e.exports=s,s.prototype=Object.create(PIXI.Container.prototype),s.prototype.constructor=s,s.prototype.init=function(){var t=[{id:"level_end",pool:"level_end",base:l,args:[!0]},{id:"level_gameover",pool:"level_gameover",base:c,args:[!1]},{id:"level_bullettime",pool:"level_bullettime",base:p,args:[]},{id:"camera_zoom",pool:"camera_zoom",base:d,args:[]},{id:"tutorial",pool:"tutorial",base:u,args:[]},{id:"roll_lock",pool:"roll_lock",base:_,args:[]},{id:"roll_unlock",pool:"roll_unlock",base:g,args:[]},{id:"coin",pool:"coin",base:m,args:[]},{id:"collectible",pool:"collectible",base:y,args:[]},{id:"enemy_biohaz",pool:"enemy",base:f,args:[],quantity:1},{id:"enemy_guard",pool:"enemy",base:f,args:[],quantity:1},{id:"enemy_scientist",pool:"enemy",base:f,args:[],quantity:1},{id:"enemy_scientist_back",pool:"scientist_back",base:x,args:[],quantity:1},{id:"hint_up",pool:"hint",base:k,args:[],quantity:1},{id:"hint_down",pool:"hint",base:k,args:[],quantity:1},{id:"laser_bridge_switch",pool:"switch",base:B,args:[],quantity:0},{id:"cage",pool:"cage",base:M,args:[],quantity:0},{id:"default",pool:"default",base:h,args:[],quantity:20}];this.objectManager=new r(t),this.objectManager.init(),this.layerContainer=new PIXI.Container,this.addChild(this.layerContainer),this.createBackgroundLayers();for(var e=0;e<this.config.layers.length;e++){var i=this.addLayer(this.config.layers[e].name,new PIXI.Point(0,0),this.config.layers[e]);i.init()}this.addLayer("avatar",new PIXI.Point(0,0),{name:"avatar",depth:0}),this.getLayer("avatar").addChild(this.avatar),this.avatar.init(this),this.avatar.x=0,this.avatar.y=0,this.endless&&n.savedData.endlessRecord>0&&(this.record=new a(n.savedData.endlessRecord),this.record.init(this),this.addChild(this.record)),this.sortChildren(),this.zoom=this.defaultZoom+.5,this.changeZoom(this.defaultZoom,3)},s.prototype.update=function(){this._deltaTime=p3.Timestep.deltaTime;var t=new PIXI.Point(this.avatar.x,this.avatar.y);this.avatar.update(),this._isShake&&(this._shakeTime+=this.deltaTime,this._shakeTime>=this._shakeTimeEnd&&(this._shakeTime=0,this._isShake=!1)),this.focusXActive&&(this.focusPosition.x=this.avatar.x),this.focusYActive&&(this.focusPosition.y=this.avatar.y),this.x=n.STAGE_WIDTH*this.focusPoint.x-this.focusPosition.x*this.zoom,this.y=n.STAGE_HEIGHT*this.focusPoint.y-this.focusPosition.y*this.zoom,this._isShake&&(this.x+=p3.Utils.randomInt(-1,1)*(this._shakeStrength.x*(1-this._shakeTime/this._shakeTimeEnd)),this.y+=p3.Utils.randomInt(-1,1)*(this._shakeStrength.y*(1-this._shakeTime/this._shakeTimeEnd))),this.scale.x=this.zoom,this.scale.y=this.zoom;for(var e=new PIXI.Point(this.focusXActive?this.avatar.x-t.x:0,this.focusYActive?this.avatar.y-t.y:0),i=0;i<this.layers.length;i++)this.layers[i].update(e);if(this.endless){this.record&&this.record.update();var s=this.getLayer("path");if(0==s.paths.length){for(var o=new PIXI.Point,i=0;i<s.childrenPaths.length;i++)s.childrenPaths[i].config.closed||o.x<s.childrenPaths[i].config.points[s.childrenPaths[i].config.points.length-1].x&&(o=s.childrenPaths[i].config.points[s.childrenPaths[i].config.points.length-1]);if(this.data.parts.length>0){var a=this.data.parts[p3.Utils.randomInt(0,this.data.parts.length-1)],r=n.assets.getJSON(a);console.log(a)}else if(""!=this.data.partDebug)var r=this.data.partDebug;for(var h=0;h<r.layers.length;h++){var s=this.getLayer(r.layers[h].name);if(null==s){var s=this.addLayer(r.layers[h].name,new PIXI.Point(0,0),r.layers[h]);this.sortChildren()}var l=JSON.parse(JSON.stringify(r.layers[h]));s.queuePaths(l.paths,o),s.queueObjects(l.objects,o)}}}this.avatar.y>12e3&&this.avatar.onDeath(!0)},s.prototype.destroy=function(t){PIXI.Container.prototype.destroy.call(this,t),this.clearEffects()},s.prototype.addLayer=function(t,e,i){var s=new o(t,e,i?i:{name:t,depth:0});return s.level=this,this.layers.push(s),this.layerContainer.addChild(s),s},s.prototype.getLayer=function(t){for(var e=0;e<this.layers.length;e++)if(this.layers[e].id==t)return this.layers[e];return null},s.prototype.getPathsByType=function(t){for(var e=[],i=0;i<this.layers.length;i++)e=e.concat(this.layers[i].getPathsByType(t));return e},s.prototype.createBackgroundLayers=function(){var t=[];t.push({id:"layer_5",image:"bg_"+this.levelTheme+"_layer_5",xScale:40,yScale:2,xSpeed:0,y:0,alpha:1}),t.push({id:"layer_4",image:"bg_"+this.levelTheme+"_layer_4",xScale:2,yScale:2,xSpeed:.05,y:0,alpha:1}),t.push({id:"layer_3",image:"bg_"+this.levelTheme+"_layer_3",xScale:2,yScale:2,xSpeed:.09,y:150,alpha:1}),t.push({id:"layer_2",image:"bg_"+this.levelTheme+"_layer_2",xScale:2,yScale:2,xSpeed:.12,y:300,alpha:1}),t.push({id:"layer_1",image:"bg_"+this.levelTheme+"_layer_1",xScale:2,yScale:2,xSpeed:.15,y:550,alpha:1}),t.push({id:"layer_0",image:"bg_"+this.levelTheme+"_layer_0",xScale:2,yScale:2,xSpeed:0,y:0,alpha:1});for(var e=0;e<t.length;e++){var i=this.addLayer(t[e].id,new PIXI.Point(t[e].xSpeed,0),{name:t[e].id,depth:-1e3+e});i.setBackground(t[e].image,t[e].y,new PIXI.Point(t[e].xScale,t[e].yScale),t[e].alpha)}},s.prototype.sortChildren=function(){this.layerContainer.children.sort(function(t,e){return t.config.depth<e.config.depth?-1:t.config.depth>e.config.depth?1:0})},s.prototype.changeZoom=function(t,e,i){null!=this.zoomTween&&this.zoomTween.kill(),t!=this.zoom&&(this.zoomTween=new TimelineMax,this.zoomTween.to(this,e,{zoom:t,ease:Sine.easeInOut},i?i:0),this.zoomTarget=t)},s.prototype.changeFocusPoint=function(t,e,i){null!=this.focusPointTween&&this.focusPointTween.kill(),this.focusPoint.equal(t)||(this.focusPointTween=new TimelineMax,this.focusPointTween.to(this.focusPoint,e,{x:t.x,y:t.y,ease:Sine.easeInOut},i?i:0))},s.prototype.shake=function(t,e){this._isShake=!0,this._shakeTime=0,this._shakeTimeEnd=t,this._shakeStrength=e},s.prototype.bulletTime=function(t,e,i,s,n){if(this.inBulletTime=!0,null!=this.bulletTimeTimeline&&this.bulletTimeTimeline.kill(),t!=this._deltaTimeScale){var n=n?n:0;this.bulletTimeTimeline=new TimelineMax,this.bulletTimeTimeline.to(this,i,{_deltaTimeScale:t,ease:Sine.easeInOut},n),s&&this.bulletTimeTimeline.to(this,s,{_deltaTimeScale:1,ease:Sine.easeInOut},n+e)}},s.prototype.gameOver=function(t){this.parent.gameOver(t)},s.prototype.addEffect=function(t){return this.effects.push(t),t.level=this,t},s.prototype.clearEffects=function(){for(var t=this.effects.length-1;t>=0;t--)this.effects[t].destroy();this.effects=[]},Object.defineProperty(s.prototype,"deltaTime",{get:function(){return this._deltaTime*this._deltaTimeScale}})},{"../Common":3,"../editor/BezierPath":13,"../game/LevelLayer":23,"../game/LevelPath":24,"../game/LevelRecord":25,"../game/ObjectManager":26,"../game/objects/avatar/Avatar":35,"../game/objects/avatar/AvatarBlackPanther":36,"../game/objects/avatar/AvatarBlackWidow":37,"../game/objects/avatar/AvatarCaptainAmerica":38,"../game/objects/avatar/AvatarFalcon":39,"../game/objects/avatar/AvatarHawkeye":40,"../game/objects/avatar/AvatarHulk":41,"../game/objects/avatar/AvatarIronMan":42,"../game/objects/avatar/AvatarThor":43,"../game/objects/avatar/Enemy":44,"../game/objects/avatar/EnemyScientistBack":45,"../game/objects/collectibles/ObjectCoin":47,"../game/objects/collectibles/ObjectCollectible":48,"../game/objects/decoration/ObjectCage":49,"../game/objects/decoration/ObjectDecoration":50,"../game/objects/decoration/ObjectHint":51,"../game/objects/decoration/ObjectSwitch":52,"../game/objects/obstacles/ObstacleStatic":53,"../game/objects/triggers/ObjectCameraZoom":54,"../game/objects/triggers/ObjectGameOver":55,"../game/objects/triggers/ObjectLevelBulletTime":56,"../game/objects/triggers/ObjectLevelEnd":57,"../game/objects/triggers/ObjectRollLock":58,"../game/objects/triggers/ObjectRollUnlock":59,"../game/objects/triggers/ObjectTutorial":60}],23:[function(t,e,i){"use strict";function s(t,e,i){this.level=null,this.id=t,this.parallax="undefined"!=typeof e?e:new PIXI.Point(1,1),this.bg=null,this.config=i?i:null,this.paths=[],this.objects=[],this.childrenPaths=[],this.childrenObjects=[],this.assetManager=p3.AssetManager.instance,PIXI.Container.call(this)}var n=t("../Common"),o=t("../game/LevelPath");t("../general/ScrollingContainer");e.exports=s,s.prototype=Object.create(PIXI.Container.prototype),s.prototype.constructor=s,s.prototype.init=function(){null!=this.config&&(this.queuePaths(this.config.paths),this.queueObjects(this.config.objects))},s.prototype.update=function(t){if(this.bg)this.x=1*-this.level.x/this.level.zoom,this.y=1*-this.level.y/this.level.zoom,this.bg.tilePosition.x-=t.x*this.parallax.x,this.bg.tilePosition.y-=t.y*this.parallax.y,this.bg.scale=new PIXI.Point(1/this.level.zoom,1/this.level.zoom),this.bg.y=1*this.bg.yOr/this.level.zoom,this.xTiling&&(this.bg.tilePosition.x+=p3.Timestep.deltaTime*this.xTiling);else{0!=this.parallax.x&&(this.x+=t.x*this.parallax.x),0!=this.parallax.y&&(this.y+=t.y*this.parallax.y);for(var e=!1,i=0;i<this.childrenPaths.length;i++)this.childrenPaths[i].update();for(;this.paths.length>0&&this.paths[0].bounds[0]<(n.STAGE_WIDTH-this.level.x)*(1/this.level.zoom)&&this.paths[0].bounds[1]>-this.level.x*(1/this.level.zoom);){var s=new o(this,this.paths[0]);s.init(),s.render(),this.addChild(s),this.childrenPaths.push(s),this.paths.splice(0,1),e=!0}for(var i=this.childrenPaths.length-1;i>=0;i--)(this.childrenPaths[i].config.bounds[1]<-this.level.x*(1/this.level.zoom)||this.childrenPaths[i].toDelete)&&(this.childrenPaths[i].dispose(),this.removeChild(this.childrenPaths[i]),this.childrenPaths.splice(i,1));for(;this.objects.length>0&&this.objects[0].position.x<(n.STAGE_WIDTH-this.level.x)*(1/this.level.zoom)&&this.objects[0].position.x>-this.level.x*(1/this.level.zoom);)this.addObject(this.objects[0].id,this.objects[0]),this.objects.splice(0,1),e=!0;for(var i=0;i<this.childrenObjects.length;i++){var a=this.childrenObjects[i].x;this.childrenObjects[i].collisionRect&&(a+=this.childrenObjects[i].collisionRect.x+this.childrenObjects[i].collisionRect.width),this.childrenObjects[i].removeWhenOutside&&a<-this.level.x*(1/this.level.zoom)&&(this.childrenObjects[i].dispose(),this.level.objectManager.dispose(this.childrenObjects[i]),this.removeChild(this.childrenObjects[i]),this.childrenObjects.splice(i,1))}e&&this.sortChildren()}for(var i=0;i<this.childrenObjects.length;i++)this.childrenObjects[i].update()},s.prototype.queuePaths=function(t,e){for(var i=0;i<t.length;i++){if("undefined"!=typeof e){for(var s=0;s<t[i].points.length;s++)t[i].points[s].x+=e.x,t[i].points[s].y+=e.y;t[i].bounds[0]+=e.x,t[i].bounds[1]+=e.x}this.paths.push(t[i])}this.paths.sort(function(t,e){return t.bounds[0]<e.bounds[0]?-1:t.bounds[0]>e.bounds[0]?1:0})},s.prototype.queueObjects=function(t,e){e||(e=new PIXI.Point(0,0));for(var i=0;i<t.length;i++)"undefined"!=typeof e&&(t[i].position.x+=e.x,t[i].position.y+=e.y),this.objects.push(t[i]);this.objects.sort(function(t,e){return t.position.x<e.position.x?-1:t.position.x>e.position.x?1:0})},s.prototype.addObject=function(t,e){var i=this.level.objectManager.generate(t);return i.layer=this,i.configure(this.level,e),this.addChild(i),this.childrenObjects.push(i),i},s.prototype.setBackground=function(t,e,i,s){var o=this.assetManager.getTexture(t);this.bg=new PIXI.extras.TilingSprite(o,n.STAGE_WIDTH,o.height*i.y),this.bg.tileScale=new PIXI.Point(i.x,i.y),this.bg.y=e,this.bg.alpha=s,this.addChild(this.bg),this.bg.yOr=e},s.prototype.sortChildren=function(){this.children.sort(function(t,e){return t.config.depth<e.config.depth?-1:t.config.depth>e.config.depth?1:t.config.bounds&&!e.config.bounds?-1:!t.config.bounds&&e.config.bounds?1:t.config.bounds&&e.config.bounds?t.config.bounds[0]<e.config.bounds[0]?-1:1:0})},s.prototype.getPathsByType=function(t){for(var e=[],i=0;i<this.childrenPaths.length;i++)this.childrenPaths[i].type==t&&e.push(this.childrenPaths[i]);return e},s.prototype.addExtraPath=function(t){var e=new o(this,t);return e.init(),e.render(),this.addChild(e),this.childrenPaths.push(e),e.layerArrIndex=this.childrenPaths.length-1,e},s.prototype.removeExtraPath=function(t){t.toDelete=!0}},{"../Common":3,"../game/LevelPath":24,"../general/ScrollingContainer":62}],24:[function(t,e,i){function s(t,e){this.assetManager=p3.AssetManager.instance,this.layerArrIndex=null,this.layer=t,this.level=t.level,this.config=e,this.bezier=new n,this.wireframe=null,this.textures=null,this.toDelete=!1,this.assetManager=p3.AssetManager.instance,PIXI.Container.call(this)}var n=(t("../Common"),t("../editor/BezierPath"));e.exports=s,s.prototype=Object.create(PIXI.Container.prototype),s.prototype.constructor=s,s.prototype.collisions={SOLID:0,NONE:1,PASSTHROUGH:2},s.prototype.init=function(){for(var t=0;t<this.config.points.length;t++)this.bezier.addPoint(this.config.points[t].x,this.config.points[t].y);if(""!=this.config.data)try{this.config.data=JSON.parse(this.config.data)}catch(e){console.error("Couldn't parse path JSON"),console.info(e)}},s.prototype.update=function(){},s.prototype.render=function(){if(null!=this.textures&&this.removeChild(this.textures),this.textures=new PIXI.Container,this.level.debug&&(null!=this.wireframe&&this.removeChild(this.wireframe),this.wireframe=new PIXI.Graphics),this.bezier.points.length>1){var t=this.bezier.getDrawingPoints();if(""!=this.config.texFill&&!this.isHidden()){for(var e=null,i=[],s=0;s<t.length;s++)i.push(new poly2tri.Point(t[s].x,t[s].y)),(null==e||e<t[s].y)&&(e=t[s].y);this.config.closed?i[0].x==i[i.length-1].x&&i[0].y==i[i.length-1].y&&i.splice(i.length-1,1):(i.push({x:t[t.length-1].x,y:e+this.config.texFillPadding}),i.push({x:t[0].x,y:e+this.config.texFillPadding}));for(var s=0;s<i.length;s++)i[s].x=Math.round(i[s].x),i[s].y=Math.round(i[s].y);try{var n=new poly2tri.SweepContext(i);n.triangulate();var o=n.getTriangles()}catch(a){console.log("Triangulation failed",a)}if(o){var r=this.assetManager.getTexture(this.config.texFill);r.baseTexture.wrapMode=1;for(var h=new Float32Array(6*o.length),l=new Float32Array(6*o.length),c=new Uint16Array(3*o.length),p=this.config.texFillSize,s=0;s<o.length;s++){var d=o[s].getPoints();h.set([d[0].x,d[0].y,d[1].x,d[1].y,d[2].x,d[2].y],6*s),l.set([d[0].x/p,d[0].y/p,d[1].x/p,d[1].y/p,d[2].x/p,d[2].y/p],6*s),c.set([0+3*s,1+3*s,2+3*s],3*s),this.level.debug}var u=new PIXI.mesh.Mesh(r,h,l,c,PIXI.mesh.Mesh.DRAW_MODES.TRIANGLES);this.textures.addChild(u)}}if(""!=this.config.texWall&&!this.isHidden()){for(var _=this.bezier.getGroundSegments(this.config.texWallAngle,360),g=this.config.texWallSize,m=this.config.texWallDelta,y=0,f=0;f<_.length;f++)y+=_[f].points.length-1;var r=this.assetManager.getTexture(this.config.texWall);r.baseTexture.wrapMode=1;for(var h=new Float32Array(8*y),l=new Float32Array(8*y),c=new Uint16Array(6*y),x=0,f=0;f<_.length;f++)for(var v=0,b=0,s=0;s<_[f].normals.length-1;s++){h.set([_[f].points[s].x-_[f].normals[s].x*(g*m),_[f].points[s].y-_[f].normals[s].y*(g*m),_[f].points[s+1].x-_[f].normals[s+1].x*(g*m),_[f].points[s+1].y-_[f].normals[s+1].y*(g*m),_[f].points[s+1].x+_[f].normals[s+1].x*(g*(1-m)),_[f].points[s+1].y+_[f].normals[s+1].y*(g*(1-m)),_[f].points[s].x+_[f].normals[s].x*(g*(1-m)),_[f].points[s].y+_[f].normals[s].y*(g*(1-m))],8*x);var I=new PIXI.Point(_[f].points[s].x-_[f].points[s+1].x,_[f].points[s].y-_[f].points[s+1].y);b=I.getLength(),l.set([v/g,0,(v+b)/g,0,(v+b)/g,1,v/g,1],8*x),c.set([0+4*x,1+4*x,2+4*x,0+4*x,2+4*x,3+4*x],6*x),v+=b,this.level.debug&&(this.wireframe.lineStyle(1,65280,.5),this.wireframe.moveTo(h[8*x+0],h[8*x+0+1]),this.wireframe.lineTo(h[8*x+2],h[8*x+2+1]),this.wireframe.lineTo(h[8*x+4],h[8*x+4+1]),this.wireframe.lineTo(h[8*x+6],h[8*x+6+1]),this.wireframe.lineTo(h[8*x+0],h[8*x+0+1]),this.wireframe.lineTo(h[8*x+4],h[8*x+4+1])),x++}var u=new PIXI.mesh.Mesh(r,h,l,c,PIXI.mesh.Mesh.DRAW_MODES.TRIANGLES);this.textures.addChild(u)}var _=this.bezier.getGroundSegments(0,this.config.texWallAngle,""==this.config.texGroundEdge),C=this.config.texGroundSize,m=this.config.texGroundDelta;if(""!=this.config.texGround&&!this.isHidden()){for(var y=0,f=0;f<_.length;f++)y+=_[f].points.length-1;var r=this.assetManager.getTexture(this.config.texGround);r.baseTexture.wrapMode=1;for(var h=new Float32Array(8*y),l=new Float32Array(8*y),c=new Uint16Array(6*y),x=0,f=0;f<_.length;f++){0!=f||"right"!=this.config.texGroundEdgeSide&&"none"!=this.config.texGroundEdgeSide||(_[f].normals[0]={x:0,y:1}),f!=_.length-1||"left"!=this.config.texGroundEdgeSide&&"none"!=this.config.texGroundEdgeSide||(_[f].normals[_[f].normals.length-1]={
x:0,y:1});for(var b=0,s=0;s<_[f].normals.length-1;s++){var I=new PIXI.Point(_[f].points[s].x-_[f].points[s+1].x,_[f].points[s].y-_[f].points[s+1].y);b+=I.getLength()}for(var g=b/Math.max(1,Math.round(b/C)),v=0,b=0,s=0;s<_[f].normals.length-1;s++){h.set([_[f].points[s].x-_[f].normals[s].x*(g*m),_[f].points[s].y-_[f].normals[s].y*(C*m),_[f].points[s+1].x-_[f].normals[s+1].x*(g*m),_[f].points[s+1].y-_[f].normals[s+1].y*(C*m),_[f].points[s+1].x+_[f].normals[s+1].x*(g*(1-m)),_[f].points[s+1].y+_[f].normals[s+1].y*(C*(1-m)),_[f].points[s].x+_[f].normals[s].x*(g*(1-m)),_[f].points[s].y+_[f].normals[s].y*(C*(1-m))],8*x);var I=new PIXI.Point(_[f].points[s].x-_[f].points[s+1].x,_[f].points[s].y-_[f].points[s+1].y);b=I.getLength(),l.set([v/g,0,(v+b)/g,0,(v+b)/g,1,v/g,1],8*x),c.set([0+4*x,1+4*x,2+4*x,0+4*x,2+4*x,3+4*x],6*x),v+=b,this.level.debug&&(this.wireframe.lineStyle(1,65280,.5),this.wireframe.moveTo(h[8*x+0],h[8*x+0+1]),this.wireframe.lineTo(h[8*x+2],h[8*x+2+1]),this.wireframe.lineTo(h[8*x+4],h[8*x+4+1]),this.wireframe.lineTo(h[8*x+6],h[8*x+6+1]),this.wireframe.lineTo(h[8*x+0],h[8*x+0+1]),this.wireframe.lineTo(h[8*x+4],h[8*x+4+1])),x++}}var u=new PIXI.mesh.Mesh(r,h,l,c,PIXI.mesh.Mesh.DRAW_MODES.TRIANGLES);this.textures.addChild(u)}if(""!=this.config.texGroundEdge&&!this.isHidden()){for(var r=this.assetManager.getTexture(this.config.texGroundEdge),h=new Float32Array(16*_.length),l=new Float32Array(16*_.length),c=new Uint16Array(12*_.length),f=0;f<_.length;f++){for(var b=0,s=0;s<_[f].normals.length-1;s++){var I=new PIXI.Point(_[f].points[s].x-_[f].points[s+1].x,_[f].points[s].y-_[f].points[s+1].y);b+=I.getLength()}var g=b/Math.max(1,Math.round(b/C));if(f>0||"left"==this.config.texGroundEdgeSide||""==this.config.texGroundEdgeSide){var w=_[f].points[0],P=_[f].normals[0],I=new PIXI.Point(_[f].points[0].x-_[f].points[1].x,_[f].points[0].y-_[f].points[1].y);I.normalize(),h.set([w.x-P.x*(g*m)+I.x*g,w.y-P.y*(C*m-I.y*C),w.x-P.x*(g*m),w.y-P.y*(C*m),w.x+P.x*(g*(1-m)),w.y+P.y*(C*(1-m)),w.x+P.x*(g*(1-m))+I.x*g,w.y+P.y*(C*(1-m)+I.y*C)],8*f*2),l.set([0,0,1,0,1,1,0,1],8*f*2),c.set([0+2*f*4,1+2*f*4,2+2*f*4,0+2*f*4,2+2*f*4,3+2*f*4],6*f*2),this.level.debug&&(this.wireframe.lineStyle(1,65280,.5),this.wireframe.moveTo(h[2*f*8+0],h[2*f*8+0+1]),this.wireframe.lineTo(h[2*f*8+2],h[2*f*8+2+1]),this.wireframe.lineTo(h[2*f*8+4],h[2*f*8+4+1]),this.wireframe.lineTo(h[2*f*8+6],h[2*f*8+6+1]),this.wireframe.lineTo(h[2*f*8+0],h[2*f*8+0+1]),this.wireframe.lineTo(h[2*f*8+4],h[2*f*8+4+1]))}if(f<_.length-1||"right"==this.config.texGroundEdgeSide||""==this.config.texGroundEdgeSide){var T=_[f].normals.length-1,w=_[f].points[_[f].normals.length-1],P=_[f].normals[_[f].normals.length-1],I=new PIXI.Point(_[f].points[T].x-_[f].points[T-1].x,_[f].points[T].y-_[f].points[T-1].y);I.normalize(),h.set([w.x-P.x*(g*m)+I.x*g,w.y-P.y*(C*m-I.y*C),w.x-P.x*(g*m),w.y-P.y*(C*m),w.x+P.x*(g*(1-m)),w.y+P.y*(C*(1-m)),w.x+P.x*(g*(1-m))+I.x*g,w.y+P.y*(C*(1-m)+I.y*C)],8*(2*f+1)),l.set([0,0,1,0,1,1,0,1],8*(2*f+1)),c.set([0+4*(2*f+1),1+4*(2*f+1),2+4*(2*f+1),0+4*(2*f+1),2+4*(2*f+1),3+4*(2*f+1)],6*(2*f+1)),this.level.debug&&(this.wireframe.lineStyle(1,65280,.5),this.wireframe.moveTo(h[8*(2*f+1)+0],h[8*(2*f+1)+0+1]),this.wireframe.lineTo(h[8*(2*f+1)+2],h[8*(2*f+1)+2+1]),this.wireframe.lineTo(h[8*(2*f+1)+4],h[8*(2*f+1)+4+1]),this.wireframe.lineTo(h[8*(2*f+1)+6],h[8*(2*f+1)+6+1]),this.wireframe.lineTo(h[8*(2*f+1)+0],h[8*(2*f+1)+0+1]),this.wireframe.lineTo(h[8*(2*f+1)+4],h[8*(2*f+1)+4+1]))}}var u=new PIXI.mesh.Mesh(r,h,l,c,PIXI.mesh.Mesh.DRAW_MODES.TRIANGLES);this.textures.addChild(u)}}if(this.addChild(this.textures),this.level.debug){this.wireframe.moveTo(this.bezier.points[0].x,this.bezier.points[0].y),this.wireframe.lineStyle(2,16711680);for(var s=1;s<this.bezier.points.length;s+=3)this.wireframe.bezierCurveTo(this.bezier.points[s].x,this.bezier.points[s].y,this.bezier.points[s+1].x,this.bezier.points[s+1].y,this.bezier.points[s+2].x,this.bezier.points[s+2].y);for(var s=0;s<this.bezier.points.length;s++)s%3==0&&(s==this.pointIndex?this.wireframe.lineStyle(2,65280,1):this.wireframe.lineStyle(0,16711680,0),this.wireframe.beginFill(16711680),this.wireframe.drawCircle(this.bezier.points[s].x,this.bezier.points[s].y,5),this.wireframe.endFill());this.addChild(this.wireframe)}},s.prototype.dispose=function(){this.iceBridgePS&&this.iceBridgePS.destroy()},s.prototype.isHidden=function(){return""!=this.config.data&&!!this.config.data.hidden},s.prototype.isRollPath=function(){return"roll"==this.type},Object.defineProperty(s.prototype,"type",{get:function(){return this.config.data&&this.config.data.type?this.config.data.type:"default"}})},{"../Common":3,"../editor/BezierPath":13}],25:[function(t,e,i){function s(t){PIXI.Container.call(this),this.level=null,this.record=t,this.config={depth:100},this.visible=!1}var n=t("../Common"),o=t("./GameObject");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.init=function(t){this.level=t,this.x=this.record*n.config.data.unit;var e=n.assets.getTexture("ui_endless_marker");this._sprite=new PIXI.extras.TilingSprite(e,e.width,n.STAGE_HEIGHT),this._sprite.anchor.set(1,0),this._sprite.blendMode=1,this.addChild(this._sprite)},s.prototype.dispose=function(){},s.prototype.update=function(){this.visible=this.x>this.level.avatar.x-n.STAGE_WIDTH&&this.x<this.level.avatar.x+n.STAGE_WIDTH,this.visible&&(this.y=1*-this.level.y/this.level.zoom,this.scale.set(1/this.level.zoom))}},{"../Common":3,"./GameObject":20}],26:[function(t,e,i){"use strict";function s(t){this.assetManager=p3.AssetManager.instance,this._poolData=t,this._pools=null,this._objects=[],this._id2Pool=[],PIXI.Container.call(this)}t("../Common");e.exports=s,s.prototype=Object.create(PIXI.Container.prototype),s.prototype.constructor=s,s.prototype.init=function(){this._pools={};for(var t=0;t<this._poolData.length;t++)this._pools[this._poolData[t].pool]||(this._pools[this._poolData[t].pool]=new p3.ObjectPool(this._poolData[t].base,this._poolData[t].quantity?this._poolData[t].quantity:1,this._poolData[t].args)),this._id2Pool[this._poolData[t].id]=this._poolData[t].pool},s.prototype.generate=function(t){if(this._id2Pool[t]&&this._pools[this._id2Pool[t]])var e=this._pools[this._id2Pool[t]];else var e=this._pools["default"];var i=e.create();return null==i&&(e.expand(2),i=e.create()),this._objects[i.type]||(this._objects[i.type]=[]),this._objects[i.type].push(i),i},s.prototype.dispose=function(t){for(var e in this._pools)if(this._pools[e]._used.indexOf(t)>-1){this._pools[e].free(t);var i=this._objects[t.type].indexOf(t);i!=-1&&this._objects[t.type].splice(i,1)}},s.prototype.getObjectsOfType=function(t){return this._objects[t]?this._objects[t]:[]}},{"../Common":3}],27:[function(t,e,i){function s(t,e,i){PIXI.particles.Emitter.call(this,t,e,i)}t("../../Common");e.exports=s,s.prototype=Object.create(PIXI.particles.Emitter.prototype),s.prototype.constructor=s,s.prototype.destroy=function(){if(this.world){var t=this.world.effects.indexOf(this);t!=-1&&this.world.effects.splice(t,1)}this.cleanup(),PIXI.particles.Emitter.prototype.destroy.call(this)}},{"../../Common":3}],28:[function(t,e,i){function s(t,e){o.call(this,t,[n.assets.getTexture("particle_fx_fire_1"),n.assets.getTexture("particle_fx_fire_2"),n.assets.getTexture("particle_fx_fire_3"),n.assets.getTexture("particle_fx_fire_4"),n.assets.getTexture("particle_fx_fire_5"),n.assets.getTexture("particle_fx_fire_6")],n.assets.getJSON("particle_arrow_trail")),this._target=e,this.autoUpdate=!0,this.updateOwnerPos(this._target.x,this._target.y)}var n=t("../../Common"),o=t("./Effect");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.update=function(t){this.emit=this._target.visible,this.resetPositionTracking(),this.updateOwnerPos(this._target.x,this._target.y),o.prototype.update.call(this,t)}},{"../../Common":3,"./Effect":27}],29:[function(t,e,i){function s(t,e,i){o.call(this,t,[n.assets.getTexture("base_one_cage_particle_00"),n.assets.getTexture("base_one_cage_particle_01"),n.assets.getTexture("base_one_cage_particle_02")],n.assets.getJSON("particle_cage_burst")),this.updateOwnerPos(e,i),this.playOnceAndDestroy()}var n=t("../../Common"),o=t("./Effect");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s},{"../../Common":3,"./Effect":27}],30:[function(t,e,i){function s(t){o.call(this,t,[n.assets.getTexture("particle_explode_smoke_00"),n.assets.getTexture("particle_explode_smoke_01")],n.assets.getJSON("particle_character_slide")),this.autoUpdate=!0}var n=t("../../Common"),o=t("./Effect");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.update=function(t){this.resetPositionTracking(),o.prototype.update.call(this,t)}},{"../../Common":3,"./Effect":27}],31:[function(t,e,i){function s(t,e,i){o.call(this,t,[n.assets.getTexture("particle_explode_spark_02"),n.assets.getTexture("particle_explode_spark_00")],n.assets.getJSON("particle_coin_collect_burst")),this.updateOwnerPos(e,i),this.playOnceAndDestroy()}var n=t("../../Common"),o=t("./Effect");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s},{"../../Common":3,"./Effect":27}],32:[function(t,e,i){function s(t,e,i){o.call(this,t,[n.assets.getTexture("particle_explode_spark_00"),n.assets.getTexture("particle_explode_spark_01"),n.assets.getTexture("particle_explode_spark_02")],n.assets.getJSON("particle_explosion_small")),this.updateOwnerPos(e,i),this.playOnceAndDestroy()}var n=t("../../Common"),o=t("./Effect");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s},{"../../Common":3,"./Effect":27}],33:[function(t,e,i){function s(t){o.call(this,t,[n.assets.getTexture("particle_splash_dust")],n.assets.getJSON("particles_splash_dust")),this.update(10),this.autoUpdate=!0}var n=t("../../Common"),o=t("./Effect");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.update=function(t){o.prototype.update.call(this,t)}},{"../../Common":3,"./Effect":27}],34:[function(t,e,i){"use strict";function s(){PIXI.Container.call(this),this.emitter=null,this.init()}var n=t("../../Common");e.exports=s,s.prototype=Object.create(PIXI.Container.prototype),s.prototype.constructor=s,s.prototype.init=function(){this.emitter=n.emitter.add(this,["particle_fx_fire_1","particle_fx_fire_2","particle_fx_fire_3","particle_fx_fire_4","particle_fx_fire_5","particle_fx_fire_6"],"particle_fx_wall_torch_00",0,0)},s.prototype.update=function(){},s.prototype.dispose=function(){n.emitter.destroy(this.emitter,1),this.emitter=null}},{"../../Common":3}],35:[function(t,e,i){function s(t){o.call(this,"avatar"),this.character=t,this._characterData=n.assets.getJSON("config").characters[n.savedData.character],this._powerupsData=n.assets.getJSON("config").powerups,this.animationHolder=null,this.spine=null,this.spineSpeed=1,this.config={depth:0},this.abilities={doubleJump:!1,roll:!1},this.areInputActive=!0,this.isDead=!1,this.isImmortal=!1,this.isGrounded=!1,this.isAccelerating=!0,this.hasLevelEnded=!1,this.isPerformingSpecial=!1,this.canPerformSpecial=!0,this.velocity=new p3.Vector2(0,0),this.jumpEnabled=!0,this.jumpTime=.45,this.jumpHeightMin=125,this.jumpHeight=300,this.doubleJumpHeightMin=100,this.doubleJumpHeight=200,this.jumpSlopeAngleMax=65,this.isTumbling=!1,this.runSpeedMin=600,this.runSpeedMax=900,this.slidingSpeedMax=1200,this.accelerationSliding=350,this.accelerationSlopeDown=100,this.accelerationSlopeUp=-500,this.accelerationNormal=-200,this.runSpeed=this.runSpeedMin,this.decceleration=0,this.fallTime=0,this.fallTimeToLand=.7,this.canSlide=!0,this.isSliding=!1,this.timeUnsliding=0,this.timeUnslidingEnd=.2,this.slidingAngleStart=35,this.slidingAngleEnd=15,this.canTumble=!1,this.isTumbling=!1,this.tumbleSpeed=0,this.tumbleSpeedMin=180,this.tumbleSpeedMax=720,this.tumbleSpeedTime=.4,this.tumbleAngle=0,this.tumbleSpeedYStart=0,this.tumbleDeathAngle={min:130,max:130},this.runUpAngle=-50,this.runDownAngle=10,this.rotation=0,this.angleTarget=0,this.angleSpeed=.2,this.collisionCircleRadius=80,this.pickupCircle=null,this.pickupCircleRadius=140,this.attackCircleRadius=150,this.attackCooldown=0,this.attackCooldownMax=.5,this.attackDamageDelay=.1,this.specialCooldown=0,this.specialCooldownMax=2.5,this.focusPointLand={point:new PIXI.Point(.3,.6),time:1.4,delay:0},this.focusPointJump={point:new PIXI.Point(.32,.35),time:.4,delay:0},this.focusPointFall={point:new PIXI.Point(.32,.3),time:.4,delay:.1},this.focusPointSlide={point:new PIXI.Point(.28,.5),time:1,delay:0},this.focusPointDeath={point:new PIXI.Point(.5,.6),time:2,delay:0},this.focusPointEnd={point:new PIXI.Point(.5,.6),time:2,delay:0},this.zoomSlide={zoom:-.25,time:1},this.zoomSlideEnd={zoom:0,time:1.5},this.zoomDeath={zoom:.4,time:2},this.kJumpStart=!1,this.kJumpPressed=!1,this.kJumpEnd=!1,this.kSpecial=!1,this.kAttack=!1,this.animationCodes={run:["run"],jump:["jump_start"],tumble:["jump_tumble"],fall:["jump_fall1","jump_fall2","jump_fall3"],land:["jump_land1","jump_land2","jump_land3"],idle:["idle","idle2"],slide:["slide"],special:["attack",this.character+"_attack"],attack:["kick","kick2","punch","punch2"],death:["die3"],ceiling:["climb_black_panther"],empty:["empty"]},this.animationMixes=[{items:["jump","run"],value:0},{items:["run","fall"],value:.1},{items:["run","attack"],value:0},{items:["jump","attack"],value:0},{items:["fall","attack"],value:0},{items:["attack","attack"],value:2/60},{items:["run","special"],value:0},{items:["run","death"],value:.5},{items:["special","empty"],value:.1},{items:["attack","empty"],value:.1}],this.animationLock=!1}var n=t("../../../Common"),o=t("./RunningEntity"),a=t("../../effects/EffectCharacterSlide");t("../../../shaders/OutlineFilter");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.init=function(t){switch(o.prototype.init.call(this,t),this.initCharacter(this.character),this.zoomSlide.zoom+=this.level.defaultZoom,this.zoomSlideEnd.zoom+=this.level.defaultZoom,this.zoomDeath.zoom+=this.level.defaultZoom,this.collisionCircle=new PIXI.Circle(0,0,this.collisionCircleRadius),this.pickupCircle=new PIXI.Circle((-10),(-50),this.pickupCircleRadius),this.attackCircle=new PIXI.Circle(0,0,this.attackCircleRadius),this.jumpSpeed=2*this.jumpHeight/this.jumpTime,this.gravity=this.jumpSpeed/this.jumpTime,this.jumpTimeMin=Math.sqrt(2*this.jumpHeightMin/this.gravity),this.jumpSpeedMin=this.gravity*this.jumpTimeMin,this.doubleJumpTimeMin=Math.sqrt(2*this.doubleJumpHeightMin/this.gravity),this.doubleJumpSpeedMin=this.gravity*this.doubleJumpTimeMin,this.doubleJumpTime=Math.sqrt(2*this.doubleJumpHeight/this.gravity),this.doubleJumpSpeed=this.gravity*this.doubleJumpTime,this.character){default:var e=.3,i=Spine.avengers,s=this.character;this.animationCodes.run=["run_"+this.character];break;case"hulk":var e=.4;case"black_widow":var e=.3,i=Spine[this.character],s=this.character}this.animationHolder=new PIXI.Container,this.addChild(this.animationHolder),this.spine=new PIXI.spine.Spine(i),this.spine.skeleton.setToSetupPose(),this.spine.skeleton.setSkin(null),this.spine.skeleton.setSkinByName(s),this.spine.x=0,this.spine.y=80,this.spine.autoUpdate=!1,this.spine.scale.set(e),this.spine.update(0),this.animationHolder.addChild(this.spine);var r=[];for(var h in this.animationCodes)for(var l=this.animationCodes[h].length-1;l>=0;l--){var c=this.animationCodes[h][l];this.checkIfAnimationExists(c)?r.push(c):this.animationCodes[h].splice(l,1)}for(var h=0;h<r.length;h++)for(var l=0;l<r.length;l++)h!=l&&this.spine.stateData.setMix(r[h],r[l],.2);for(var p in this.animationCodes)for(var d in this.animationCodes)for(var u=0;u<this.animationMixes.length;u++)if(this.animationMixes[u].items.indexOf(p)!=-1&&this.animationMixes[u].items.indexOf(d)!=-1&&(p!=d||this.animationMixes[u].items[0]==this.animationMixes[u].items[1]))for(var _=this.animationMixes[u].value,h=0;h<this.animationCodes[p].length;h++)for(var g=this.animationCodes[p][h],m=0;m<this.animationCodes[d].length;m++){var y=this.animationCodes[d][m];this.spine.stateData.setMix(g,y,_)}if(this.setAnimation("run",!0),this.spine.state.addListener({event:function(t,e){"sfx_footstep"==e.data.name&&this.isGrounded&&(this.currentPath&&"base_one_snow_fill_00"==this.currentPath.config.texFill?this.playSound("sfx_footstep_snow_0"+p3.Utils.randomInt(0,3),{volume:.5}):this.playSound("sfx_footstep_"+this.character+"_0"+p3.Utils.randomInt(0,3),{volume:.5}))}.bind(this)}),this.slidePS=this.level.addEffect(new a(this.level)),this.slidePS.emit=!1,this.bonusText=new PIXI.Container,this.bonusText.visible=!1,this.addChild(this.bonusText),this.bonusText.label=n.createText("+1",{align:"left",size:30}),this.bonusText.label.x=0,this.bonusText.label.y=-6,this.bonusText.label.anchor.set(0,.5),this.bonusText.addChild(this.bonusText.label),this.bonusText.coin=new PIXI.Sprite(n.assets.getTexture("ui_icon_ability_token")),this.bonusText.coin.x=this.bonusText.label.width+5,this.bonusText.coin.anchor.set(0,.5),this.bonusText.coin.scale.set(.4),this.bonusText.addChild(this.bonusText.coin),this.bonusText.x-=this.bonusText.width/2,this.level.debug){this.drawCollision();var f=new PIXI.Graphics;this.addChild(f),f.lineStyle(1,16191773),f.drawCircle(0,0,this.pickupCircle.radius),f.x=this.pickupCircle.x,f.y=this.pickupCircle.y;var x=new PIXI.Graphics;this.addChild(x),x.lineStyle(1,65280),x.drawCircle(0,0,this.attackCircle.radius),x.x=this.attackCircle.x,x.y=this.attackCircle.y}},s.prototype.initCharacter=function(t){this._characterData.jumpHeight&&(this.jumpHeight=this._characterData.jumpHeight),this._characterData.doubleJumpHeight&&(this.doubleJumpHeight=this._characterData.doubleJumpHeight),this._characterData.tumbleSpeedMin&&(this.tumbleSpeedMin=this._characterData.tumbleSpeedMin),this._characterData.tumbleSpeedMax&&(this.tumbleSpeedMax=this._characterData.tumbleSpeedMax),this._characterData.tumbleSpeedTime&&(this.tumbleSpeedTime=this._characterData.tumbleSpeedTime),this._characterData.pickupCircleRadius&&(this.pickupCircleRadius=this._characterData.pickupCircleRadius),this._characterData.speedMultiplier&&(this.runSpeedMin*=this._characterData.speedMultiplier,this.runSpeedMax*=this._characterData.speedMultiplier,this.slidingSpeedMax*=this._characterData.speedMultiplier);var e=n.savedData.getSkillData("tumble");this.tumbleSpeedMax*=e.power[n.savedData.getCharacterSkillLevel("tumble",this.character)];var e=n.savedData.getSkillData("magnet");this.pickupCircleRadius*=e.power[n.savedData.getCharacterSkillLevel("magnet",this.character)]},s.prototype.update=function(){var t=this.distance;this.spine.update(this.level.deltaTime*this.spineSpeed),this.isDead||(this.hasLevelEnded&&this.isGrounded?this.setAnimation("idle",!0):this.isStickingToCeiling?this.setAnimation("ceiling",!0):this.isTumbling?(this.tumbleSpeed+=(this.tumbleSpeedMax-this.tumbleSpeedMin)*(this.level.deltaTime/this.tumbleSpeedTime),this.tumbleSpeed>this.tumbleSpeedMax&&(this.tumbleSpeed=this.tumbleSpeedMax),this.kJumpPressed?("tumble"!=this.currentAnimation&&""!=this.currentAnimation&&this.level.changeFocusPoint(this.focusPointFall.point,this.focusPointFall.time,this.focusPointFall.delay),this.setAnimation("tumble",!0),this.tumbleAngle+=this.tumbleSpeed*this.level.deltaTime*PIXI.DEG_TO_RAD):this.isTumbling=!1):this.isGrounded&&!this.isSliding&&this.collisionPoint?"attack"==this.currentAnimation?this.addAnimation("run",!0):this.setAnimation("run",!0):!this.isGrounded&&this.isAccelerating&&this.velocity.y>0&&"fall"!=this.currentAnimation&&""!=this.currentAnimation&&(this.setAnimation("fall",!1),this.level.changeFocusPoint(this.focusPointFall.point,this.focusPointFall.time,this.focusPointFall.delay))),"run"==this.currentAnimation&&this.runSpeed>this.runSpeedMin?this.spineSpeed=1+.5*((this.runSpeed-this.runSpeedMin)/(this.runSpeedMax-this.runSpeedMin)):this.spineSpeed=1;var e=new p3.Vector2(this.velocity.x,this.velocity.y),i=this.isSliding,s=this.isGrounded;if(this.isDead||this.hasLevelEnded)this.velocity.x=0;else{this.kJumpStart=this.kJumpStart||n.keyboard.getKeyJustPressed(n.keyboard.KEY_UP),this.kJumpEnd=this.kJumpEnd||n.keyboard.getKeyJustReleased(n.keyboard.KEY_UP),this.kSpecial=this.kSpecial||n.keyboard.getKeyJustPressed(n.keyboard.KEY_C),this.kAttack=this.kAttack||n.keyboard.getKeyJustPressed(n.keyboard.KEY_X),this.areInputActive&&(this.kJumpStart&&this.isGrounded?(this.jump(),this.kJumpPressed=!0):this.kJumpEnd?(this.jumpEnd(),this.kJumpPressed=!1):this.kSpecial?this.special():this.kAttack&&this.attack()),this.kJumpStart=!1,this.kJumpEnd=!1,this.kSpecial=!1,this.kAttack=!1;var o=this.accelerationNormal;this.isSliding?o=this.accelerationSliding:this.isGrounded&&this.collisionPoint.angle*PIXI.RAD_TO_DEG>this.runDownAngle?o=this.accelerationSlopeDown:this.isGrounded&&this.collisionPoint.angle*PIXI.RAD_TO_DEG<this.runUpAngle&&(o=this.accelerationSlopeUp),this.isAccelerating?this.runSpeed+=o*this.level.deltaTime:this.runSpeed=this.velocity.x*(1-this.decceleration);var a=this.runSpeedMax;this.isSliding&&(a=this.slidingSpeedMax),this.vehicle&&this.vehicle.maxSpeed&&(a=this.vehicle.maxSpeed),this.runSpeed=Math.max(Math.min(this.runSpeed,a),this.isAccelerating?this.runSpeedMin:0),this.velocity.x=this.runSpeed,!this.isSliding&&this.canSlide&&this.isGrounded&&this.collisionPoint.angle*PIXI.RAD_TO_DEG>this.slidingAngleStart?(this.specialEnd(),this.isSliding=!0,this.timeUnsliding=0,this.setAnimation("slide",!0),this.angleTarget=0,this.playSound("sfx_surface_slide_loop_00",{loop:!0}),this.level.changeZoom(this.zoomSlide.zoom,this.zoomSlide.time),this.level.changeFocusPoint(this.focusPointSlide.point,this.focusPointSlide.time,this.focusPointSlide.delay)):this.isSliding&&(!this.collisionPoint||this.collisionPoint.angle*PIXI.RAD_TO_DEG<this.slidingAngleEnd)&&(this.timeUnsliding+=this.level.deltaTime,this.setAnimation("slide",!0),this.timeUnsliding>=this.timeUnslidingEnd&&(this.isSliding=!1,this.setAnimation("run",!0))),this.isSliding||this.stopSound("sfx_surface_slide_loop_00")}if(this.isStickingToCeiling||(this.velocity.y+=this.gravity*this.level.deltaTime,this.velocity.y>=this.gravity/2&&(this.velocity.y=this.gravity/2)),this.isTumbling)this.animationHolder.rotation=this.angleTarget;else{var r=Math.atan2(Math.sin(this.angleTarget-this.animationHolder.rotation),Math.cos(this.angleTarget-this.animationHolder.rotation));this.animationHolder.rotation=this.animationHolder.rotation+r*this.angleSpeed}this.move(this.velocity),this.isGrounded&&(this.velocity.y=0,s||this.isDead||this.land()),!this.isGrounded&&this.velocity.y>0?this.fallTime+=this.level.deltaTime:0!=this.fallTime&&(this.fallTime=0),this.collisions(),this.isDead||(i&&!this.isSliding&&(this.level.changeZoom(this.zoomSlideEnd.zoom,this.zoomSlideEnd.time),this.isGrounded&&this.level.changeFocusPoint(this.focusPointLand.point,this.focusPointLand.time,this.focusPointLand.delay)),this.canTumble&&!this.isGrounded&&e.y<=this.tumbleSpeedYStart&&this.velocity.y>this.tumbleSpeedYStart&&this.kJumpPressed&&(this.isTumbling=!0,this.tumbleAngle=0,this.canTumble=!1,this.canDoubleJump=!1,this.tumbleSpeed=this.tumbleSpeedMin)),this.isDead||this.hasLevelEnded||(this.attackCooldown>0&&(this.attackCooldown=Math.max(0,this.attackCooldown-this.level.deltaTime)),this.specialCooldown>0&&(this.specialCooldown=Math.max(0,this.specialCooldown-this.level.deltaTime))),this.slidePS.emit=this.isSliding,this.timeUnsliding<.1?this.slidePS.updateSpawnPos(this.x-10+p3.Utils.randomInt(-5,5),this.y+this.collisionCircle.radius+30):this.slidePS.updateSpawnPos(this.x+10,this.y+this.collisionCircle.radius-10),!this.isDead&&this.areInputActive&&t<this.distance&&(this.isSliding&&n.goalsManager.trackEvent("slide",this.distance-t),n.goalsManager.trackEvent("run",this.distance-t))},s.prototype.collisions=function(){if(!this.isDead){var t=new PIXI.Circle(this.x+this.collisionCircle.x,this.y+this.collisionCircle.y,this.collisionCircle.radius),e=new PIXI.Circle(this.x+this.pickupCircle.x,this.y+this.pickupCircle.y,this.pickupCircle.radius),i=[{id:"coin",circle:e},{id:"collectible",circle:e},{id:"obstacle",circle:t},{id:"camera_zoom",circle:t},{id:"level_end",circle:t},{id:"level_bullettime",circle:t},{id:"tutorial",circle:t},{id:"decoration_interactive",circle:t}];for(var s in i){var n=this.level.objectManager.getObjectsOfType(i[s].id);for(var o in n)if(n[o].collidable&&this.checkCollision(i[s].circle,n[o]))switch(i[s].id){case"coin":n[o].pickup(this),this.level.coins++;break;case"collectible":n[o].pickup(this);break;case"obstacle":this.onDeath(n[o].fallenOffLevel),n[o].hit(this);break;case"level_end":this.onLevelEnd(),n[o].hit(this);break;case"enemy":break;default:n[o].hit(this)}}}},s.prototype.jump=function(){if(!this.isDead&&this.jumpEnabled)if(this.isGrounded){if(this.collisionPoint&&this.collisionPoint.angle*PIXI.RAD_TO_DEG<-this.jumpSlopeAngleMax)return;this.canDoubleJump=!0,this.isSliding=!1,this.rotation=0,this.angleTarget=0,this.isGrounded=!1,this.canTumble=!0,this.vehicle&&this.vehicle.jumpHeight?this.velocity.y=-(2*this.vehicle.jumpHeight/this.jumpTime):this.velocity.y=-this.jumpSpeed,this.setAnimation("jump",!1),this.level.changeFocusPoint(this.focusPointJump.point,this.focusPointJump.time,this.focusPointJump.delay),this.playRandomSound(["sfx_jump_00"])}else this.canDoubleJump&&this.abilities.doubleJump&&(this.canDoubleJump=!1,this.velocity.y=-this.doubleJumpSpeed,this.setAnimation("jump",!1))},s.prototype.jumpEnd=function(){this.isDead||this.isGrounded||(this.canDoubleJump||!this.abilities.doubleJump?this.velocity.y<-this.jumpSpeedMin&&this.velocity.y>=-this.jumpSpeed&&(this.velocity.y=-this.jumpSpeedMin):this.velocity.y<-this.doubleJumpSpeedMin&&this.velocity.y>=-this.doubleJumpSpeed&&(this.velocity.y=-this.doubleJumpSpeedMin))},s.prototype.land=function(){this.animationLock=!1,this.canDoubleJump=!1,this.fallTime>=this.fallTimeToLand?(this.level.shake(.25,new PIXI.Point(8,12)),this.distance>5&&this.playRandomSound(["sfx_generic_land_heavy_00"])):this.distance>5&&this.playRandomSound(["sfx_generic_land_soft_00"]),this.isTumbling=!1;var t=Math.floor((this.animationHolder.rotation*PIXI.RAD_TO_DEG+180)/360);this.animationHolder.rotation=this.animationHolder.rotation%(2*Math.PI);var e=this.animationHolder.rotation*PIXI.RAD_TO_DEG;if(this.tumbleDeathAngle.min!=this.tumbleDeathAngle.max&&e>this.tumbleDeathAngle.min&&e<this.tumbleDeathAngle.max&&!this.isImmortal)this.death();else if(t>0&&(n.goalsManager.trackEvent("tumble"),t>=2&&n.goalsManager.trackEvent("tumble_double"),t>=3&&n.goalsManager.trackEvent("tumble_triple"),this.level.styleScore+=n.config.score.tumble*Math.pow(2,t-1),t>=1)){var i=Math.pow(t,2);this.level.coins+=i,this.showBonusText("+"+i)}this.distance>5&&n.goalsManager.trackEvent("jump"),this.level.changeFocusPoint(this.focusPointLand.point,this.focusPointLand.time,this.focusPointLand.delay)},s.prototype.setAnimation=function(t,e){if(!(this.animationLock||e&&t==this.currentAnimation||void 0==this.animationCodes[t]||0==this.animationCodes[t].length)){var i=0;"empty"!=t&&("special"!=t||"captain_america"!=this.character&&"thor"!=this.character&&"hawkeye"!=this.character)&&("attack"!=t||"thor"!=this.character&&"iron_man"!=this.character)||(i=1);var s=this.animationCodes[t][p3.Utils.randomInt(0,this.animationCodes[t].length-1)];this.spine.state.setAnimation(i,s,e,0),this.currentAnimation=t,1==i&&this.addAnimation("empty",!1)}},s.prototype.addAnimation=function(t,e){if(!(this.animationLock||e&&t==this.currentAnimation||void 0==this.animationCodes[t]||0==this.animationCodes[t].length)){var i=0;"special"!=t&&"empty"!=t&&("attack"!=t||"thor"!=this.character&&"iron_man"!=this.character)||(i=1);var s=this.animationCodes[t][p3.Utils.randomInt(0,this.animationCodes[t].length-1)];this.spine.state.addAnimation(i,s,e,0),this.currentAnimation=t}},s.prototype.checkIfAnimationExists=function(t){for(var e=0;e<this.spine.spineData.animations.length;e++)if(this.spine.spineData.animations[e].name==t)return!0;return!1},s.prototype.stop=function(t){void 0==t&&(t=1),this.decceleration=Math.max(0,Math.min(1,t)),this.isAccelerating=!1},s.prototype.resume=function(){this.isAccelerating=!0},s.prototype.special=function(){this.specialCooldown=this.specialCooldownMax,n.goalsManager.trackEvent("special"),this.playSound("sfx_ui_powerup_activate_00")},s.prototype.specialEnd=function(){},s.prototype.canAttack=function(){return!this.isDead&&(!this.isSliding&&(!this.isTumbling&&(!this.isPerformingSpecial&&!(this.attackCooldown>0))))},s.prototype.attack=function(){this.canAttack()&&(this.setAnimation("attack"),this.killEnemies(this.attackDamageDelay),this.attackCooldown=this.attackCooldownMax,this.isGrounded||(this.canTumble=!1,this.addAnimation("fall",!0),this.animationLock=!0))},s.prototype.killEnemies=function(t){if(t)return void(this._attackTimeline=this.level.scene.delay(t,function(){this.killEnemies()},[],this));this._attackTimeline&&this._attackTimeline.kill();var e=this.level.objectManager.getObjectsOfType("enemy"),i=0;if(e.length>0)for(var s=new PIXI.Circle(this.x+this.attackCircle.x,this.y+this.attackCircle.y,this.attackCircle.radius),n=0;n<e.length;n++)e[n].collidable&&(e[n].x<this.x||this.checkCollision(s,e[n])&&(e[n].onDeath(),this.level.shake(.4,new PIXI.Point(40,20)),i++));this.playMeleeKillSound(!!i)},s.prototype.playMeleeKillSound=function(t){t?this.playSound(["sfx_generic_kick_00","sfx_generic_punch_00"]):this.playSound("sfx_generic_attack_miss_00")},s.prototype.killEnemiesRanged=function(t,e){if(e)return void(this._attackTimeline=this.level.scene.delay(e,function(t){this.killEnemiesRanged(t)},[t],this));this._attackTimeline&&this._attackTimeline.kill();var i=this.level.objectManager.getObjectsOfType("enemy"),s=0;if(i.length>0){var n=new PIXI.Point(Math.cos(this.animationHolder.rotation)*t,Math.sin(this.animationHolder.rotation)*t),o=new PIXI.Point(n.x,n.y);o.normalize();for(var a=0;a<i.length;a++)if(i[a].collidable){var r=new PIXI.Point(i[a].x-this.x,i[a].y-this.y),h=r.dotProduct(n)/n.getLength(),l=new PIXI.Point(o.x*h,o.y*h);if(l.x!=n.x){if(l.x/n.x<0)continue;if(l.x/n.x>1)continue}else{if(l.y/n.y<0)continue;if(l.y/n.y>1)continue}var c=new PIXI.Point(l.x-r.x,l.y-r.y),p=c.getLength();p<200&&(i[a].onDeath(),s++,this.level.shake(.4,new PIXI.Point(40,20)))}}this.playRangedKillSound(!!s)},s.prototype.playRangedKillSound=function(t){},s.prototype.onLevelEnd=function(){this.level.avatar.stop(.8),this.level.changeFocusPoint(this.focusPointEnd.point,this.focusPointEnd.time,this.focusPointEnd.delay),this.level.gameOver(!0),this.specialEnd(),this.animationLock=!1,this.jumpEnabled=!1,this.canPerformSpecial=!1,this.isPerformingSpecial=!1,this.hasLevelEnded=!0,this._attackTimeline&&this._attackTimeline.kill()},s.prototype.onDeath=function(t){this.isDead||this.isImmortal&&!t||(this.isDead=!0,this.isSliding=!1,this.animationLock=!1,this._attackTimeline&&this._attackTimeline.kill(),this.stopSound(),t?this.level.focusYActive=!1:(this.gravity=0,this.velocity.y=0,this.setAnimation("death",!0),this.level.changeZoom(this.zoomDeath.zoom,this.zoomDeath.time),this.level.changeFocusPoint(this.focusPointDeath.point,this.focusPointDeath.time,this.focusPointDeath.delay)),this.level.gameOver(!1))},s.prototype.showBonusText=function(t){this.bonusText.visible=!0,this.bonusText.label.text=t,this.bonusText.coin.x=this.bonusText.label.width+5,this._bonusTimeline&&this._bonusTimeline.kill(),this._bonusTimeline=this.level.scene.createTimeline(),this._bonusTimeline.fromTo(this.bonusText,1,{y:-50},{y:-150,ease:Sine.easeInOut},0),this._bonusTimeline.fromTo(this.bonusText,.5,{alpha:0},{alpha:1,ease:Sine.easeOut},0),this._bonusTimeline.to(this.bonusText,.5,{alpha:0,ease:Sine.easeIn},.5)},Object.defineProperty(s.prototype,"distance",{get:function(){return Math.floor(this.x/n.config.data.unit)}})},{"../../../Common":3,"../../../shaders/OutlineFilter":81,"../../effects/EffectCharacterSlide":30,"./RunningEntity":46}],36:[function(t,e,i){function s(t){n.call(this,t),this._superjumpMultiplier=1.25}var n=(t("../../../Common"),
t("./Avatar"));t("../../Force");e.exports=s,s.prototype=Object.create(n.prototype),s.prototype.constructor=s,s.prototype.init=function(t){n.prototype.init.call(this,t)},s.prototype.update=function(){this.isPerformingSpecial&&this.velocity.y>0&&this.specialEnd(),n.prototype.update.call(this)},s.prototype.special=function(){if(!this.isDead&&!this.hasLevelEnded){if(this.isPerformingSpecial)return void this.specialEnd();if(!this.isPerformingSpecial&&this.canPerformSpecial&&!(this.specialCooldown>0)&&!this.isSliding&&this.isGrounded&&!this.hasLevelEnded){if(this.isPerformingSpecial=!0,this.canPerformSpecial=!1,this.canStickToCeiling=!0,this.jumpSpeed*=this._superjumpMultiplier,this.jump(),this.collisionCircle.radius=100,this.spine.y=this.collisionCircle.radius,this.level.debug&&this.drawCollision(),this.isGrounded)return void this.specialEnd();n.prototype.special.call(this),this.playSound("sfx_blackpanther_leap_00")}}},s.prototype.specialEnd=function(){this.isPerformingSpecial&&(this.isPerformingSpecial=!1,this.canPerformSpecial=!0,this.canStickToCeiling=!1,this.jumpSpeed/=this._superjumpMultiplier,this.collisionCircle.radius=80,this.spine.y=this.collisionCircle.radius,this.level.debug&&this.drawCollision())}},{"../../../Common":3,"../../Force":19,"./Avatar":35}],37:[function(t,e,i){function s(t){n.call(this,t),this.abilities.roll=!0,this.rollTimeTotal=.73,this.rollTimeCurrent=0,this.rollLock=!1,this.animationCodes.special=["roll_start"],this.animationCodes.specialLoop=["roll_loop"]}var n=(t("../../../Common"),t("./Avatar"));e.exports=s,s.prototype=Object.create(n.prototype),s.prototype.constructor=s,s.prototype.init=function(t){n.prototype.init.call(this,t)},s.prototype.update=function(){this.isPerformingSpecial&&(this.rollTimeCurrent+=this.level.deltaTime,this.rollTimeCurrent>this.rollTimeTotal&&!this.rollLock&&this.specialEnd()),n.prototype.update.call(this)},s.prototype.special=function(){if(!this.isDead&&!this.hasLevelEnded&&!this.isPerformingSpecial&&this.canPerformSpecial&&!(this.specialCooldown>0)&&this.isGrounded&&!this.isSliding){this.isPerformingSpecial=!0,this.jumpEnabled=!1,this.isImmortal=!0,this.setAnimation("special",!1),this.setAnimation("specialLoop",!0),this.animationLock=!0,this.rollTimeCurrent=0,this.rollLock=!1,this.canSlide=!1,this.ignoreRollPaths=!0,this.runSpeedMin*=1.4,this.runSpeedMax*=1.8,this.level.changeZoom(1.2,.5,0);var t=this.level.scene.createTimeline();t.to(this.collisionCircle,.25,{radius:35,ease:Linear.easeNone,onUpdate:function(){this.spine.y=this.collisionCircle.radius,this.level.debug&&this.drawCollision()},onUpdateScope:this},0),n.prototype.special.call(this)}},s.prototype.specialEnd=function(){if(this.isPerformingSpecial){this.isPerformingSpecial=!1,this.animationLock=!1,this.isImmortal=!1,this.jumpEnabled=!0,this.canSlide=!0,this.ignoreRollPaths=!1,this.runSpeedMin/=1.4,this.runSpeedMax/=1.8,this.angleTarget=0,this.level.changeZoom(1,1,0);var t=this.level.scene.createTimeline({onCompleteScope:this,onComplete:function(){this.isUnshrinking=!1}});t.to(this.collisionCircle,.25,{radius:80,ease:Linear.easeNone,onUpdate:function(){this.spine.y=this.collisionCircle.radius,this.level.debug&&this.drawCollision()},onUpdateScope:this},0)}},s.prototype.collisions=function(){if(n.prototype.collisions.call(this),!this.isDead&&this.isPerformingSpecial){var t=new PIXI.Circle(this.x+this.collisionCircle.x,this.y+this.collisionCircle.y,this.collisionCircle.radius),e=[{id:"roll_lock",circle:t},{id:"roll_unlock",circle:t}];for(var i in e){var s=this.level.objectManager.getObjectsOfType(e[i].id);for(var o in s)if(s[o].collidable&&this.checkCollision(e[i].circle,s[o]))switch(e[i].id){case"roll_lock":s[o].hit(this),this.rollLock=!0;break;case"roll_unlock":s[o].hit(this),this.rollLock=!1}}}}},{"../../../Common":3,"./Avatar":35}],38:[function(t,e,i){function s(t){n.call(this,t),this.chargeTimeTotal=1,this.chargeTimeCurrent=0,this.focusPointCharge={point:new PIXI.Point(.4,.6),time:.5,delay:0},this.zoomCharge={zoom:-.1,time:.5},this.zoomChargeEnd={zoom:0,time:2},this.animationCodes.special=["attack_captain_america"]}var n=(t("../../../Common"),t("./Avatar"));t("../../Force");e.exports=s,s.prototype=Object.create(n.prototype),s.prototype.constructor=s,s.prototype.init=function(t){n.prototype.init.call(this,t),this.zoomCharge.zoom+=this.level.defaultZoom,this.zoomChargeEnd.zoom+=this.level.defaultZoom},s.prototype.update=function(){this.isPerformingSpecial&&(this.chargeTimeCurrent+=this.level.deltaTime,this.chargeTimeCurrent>this.chargeTimeTotal?this.specialEnd():this.killEnemies()),n.prototype.update.call(this)},s.prototype.special=function(){this.isDead||this.hasLevelEnded||this.isPerformingSpecial||this.canPerformSpecial&&(this.specialCooldown>0||this.isGrounded&&(this.isSliding||(this.isPerformingSpecial=!0,this.jumpEnabled=!1,this.isImmortal=!0,this.setAnimation("special",!0),this.animationLock=!0,this.chargeTimeCurrent=0,this.runSpeedMin*=1.5,this.runSpeedMax*=2,this.level.changeZoom(this.zoomCharge.zoom,this.zoomCharge.time),this.level.changeFocusPoint(this.focusPointCharge.point,this.focusPointCharge.time,this.focusPointCharge.delay),n.prototype.special.call(this))))},s.prototype.specialEnd=function(){this.isPerformingSpecial&&(this.isPerformingSpecial=!1,this.animationLock=!1,this.isImmortal=!1,this.jumpEnabled=!0,this.runSpeedMin/=1.5,this.runSpeedMax/=2,this.level.changeZoom(this.zoomChargeEnd.zoom,this.zoomChargeEnd.time),this.level.changeFocusPoint(this.focusPointLand.point,this.focusPointLand.time,this.focusPointLand.delay))},s.prototype.jump=function(){this.specialEnd(),n.prototype.jump.call(this)},s.prototype.playMeleeKillSound=function(t){this.isPerformingSpecial?t&&this.playSound("sfx_captamerica_shield_impact_00"):n.prototype.playMeleeKillSound.call(this,t)}},{"../../../Common":3,"../../Force":19,"./Avatar":35}],39:[function(t,e,i){function s(t){n.call(this,t),this.flyingTimeTotal=3,this.flyingTimeCurrent=0,this.animationCodes.special=["fly_falcon"]}var n=(t("../../../Common"),t("./Avatar"));t("../../Force");e.exports=s,s.prototype=Object.create(n.prototype),s.prototype.constructor=s,s.prototype.init=function(t){n.prototype.init.call(this,t)},s.prototype.update=function(){this.isPerformingSpecial?(this.flyingTimeCurrent+=this.level.deltaTime,(this.flyingTimeCurrent>this.flyingTimeTotal||this.isGrounded)&&this.specialEnd()):!this.canPerformSpecial&&this.isGrounded&&(this.canPerformSpecial=!0),n.prototype.update.call(this)},s.prototype.special=function(){if(!this.isDead&&!this.hasLevelEnded)return this.isPerformingSpecial?void this.specialEnd():void(this.isTumbling||this.isPerformingSpecial||this.canPerformSpecial&&(this.specialCooldown>0||(this.isPerformingSpecial=!0,this.canPerformSpecial=!1,this.canTumble=!1,this.flyingTimeCurrent=0,this.setAnimation("special",!0),this.animationLock=!0,this.gravity/=10,this.velocity.y=-200,this.runSpeedMin*=1.25,this.runSpeedMax*=1.5,n.prototype.special.call(this))))},s.prototype.specialEnd=function(){this.isPerformingSpecial&&(this.isPerformingSpecial=!1,this.animationLock=!1,this.gravity*=10,this.runSpeedMin/=1.25,this.runSpeedMax/=1.5)}},{"../../../Common":3,"../../Force":19,"./Avatar":35}],40:[function(t,e,i){function s(t){o.call(this,t),this.specialTimeTotal=.5,this.specialTimeCurrent=0,this.animationCodes.special=["attack_hawkeye"]}var n=t("../../../Common"),o=t("./Avatar"),a=t("../../effects/EffectExplosionSmall"),r=t("../../effects/EffectArrowTrail");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.init=function(t){o.prototype.init.call(this,t),this.arrow=new PIXI.Sprite(n.assets.getTexture("arrow")),this.arrow.anchor.set(.5),this.arrow.visible=!1,this.arrow.ps=this.level.addEffect(new r(this.level,this.arrow)),this.level.addChild(this.arrow)},s.prototype.update=function(){o.prototype.update.call(this),this.isPerformingSpecial&&(this.specialTimeCurrent+=this.level.deltaTime,this.specialTimeCurrent>this.specialTimeTotal&&this.specialEnd()),this.arrow.visible&&(this.arrow.time+=this.level.deltaTime,this.arrow.time<this.specialTimeTotal?(this.arrow.x+=Math.cos(this.arrow.rotation+Math.PI/2)*this.arrow.speed*this.level.deltaTime,this.arrow.y+=Math.sin(this.arrow.rotation+Math.PI/2)*this.arrow.speed*this.level.deltaTime,this.collisionsArrow()):(this.arrow.visible=!1,this.level.addEffect(new a(this.level,this.arrow.x,this.arrow.y))))},s.prototype.special=function(){this.isDead||this.hasLevelEnded||this.isPerformingSpecial||this.canPerformSpecial&&(this.specialCooldown>0||this.isSliding||(this.isPerformingSpecial=!0,this.canPerformSpecial=!1,this.jumpEnabled=!1,this.setAnimation("special",!1),this.addAnimation("run",!0),this.animationLock=!0,this.specialTimeCurrent=0,this.level.changeZoom(.8,.4,0),this.shootArrow(.2),o.prototype.special.call(this)))},s.prototype.shootArrow=function(t){if(t)return void(this._attackTimeline=this.level.scene.delay(t,function(){this.shootArrow()},[],this));this._attackTimeline&&this._attackTimeline.kill();var e=140,i=-130,s=Math.atan2(-i,e);Math.sqrt(e*e+i*i);this.arrow.x=this.x+Math.cos(s-this.animationHolder.rotation)*e,this.arrow.y=this.y+Math.sin(s-this.animationHolder.rotation)*i,this.arrow.visible=!0,this.arrow.speed=3e3,this.arrow.time=0,this.arrow.rotation=this.animationHolder.rotation-Math.PI/2,this.playSound("sfx_hawkeye_arrow_fly_00")},s.prototype.specialEnd=function(){this.isPerformingSpecial&&(this.isPerformingSpecial=!1,this.canPerformSpecial=!0,this.animationLock=!1,this.jumpEnabled=!0,this.level.changeZoom(1,1,0))},s.prototype.collisionsArrow=function(){var t=new PIXI.Circle(this.arrow.x,this.arrow.y,100),e=[{id:"coin",circle:t},{id:"collectible",circle:t},{id:"enemy",circle:t}];for(var i in e){var s=this.level.objectManager.getObjectsOfType(e[i].id);for(var n in s)if(s[n].collidable&&this.checkCollision(e[i].circle,s[n]))switch(e[i].id){case"coin":s[n].pickup(this),this.level.coins++;break;case"collectible":s[n].pickup(this);break;case"enemy":return s[n].onDeath(this),this.level.addEffect(new a(this.level,s[n].x,this.arrow.y)),this.arrow.visible=!1,this.level.shake(.4,new PIXI.Point(40,20)),void this.playRandomSound(["sfx_hawkeye_arrow_impact_00","sfx_hawkeye_arrow_impact_01","sfx_hawkeye_arrow_impact_02"])}}}},{"../../../Common":3,"../../effects/EffectArrowTrail":28,"../../effects/EffectExplosionSmall":32,"./Avatar":35}],41:[function(t,e,i){function s(t){n.call(this,t),this.chargeTimeTotal=1,this.chargeTimeCurrent=0,this.focusPointCharge={point:new PIXI.Point(.4,.6),time:.5,delay:0},this.zoomCharge={zoom:-.1,time:.5},this.zoomChargeEnd={zoom:0,time:2},this.attackCircleRadius=240,this.attackDamageDelay=.15,this.animationCodes.attack=["punch_hulk"],this.animationCodes.special=["hulk_bash"]}var n=(t("../../../Common"),t("./Avatar"));t("../../Force");e.exports=s,s.prototype=Object.create(n.prototype),s.prototype.constructor=s,s.prototype.init=function(t){n.prototype.init.call(this,t),this.zoomCharge.zoom+=this.level.defaultZoom,this.zoomChargeEnd.zoom+=this.level.defaultZoom,this.spine.state.addListener({event:function(t,e){"sfx_footstep"==e.data.name&&this.level.shake(.1,new PIXI.Point(0,4))}.bind(this)})},s.prototype.update=function(){this.isPerformingSpecial&&(this.chargeTimeCurrent+=this.level.deltaTime,this.chargeTimeCurrent>this.chargeTimeTotal?this.specialEnd():this.killEnemies()),n.prototype.update.call(this)},s.prototype.special=function(){this.isDead||this.hasLevelEnded||this.isPerformingSpecial||this.canPerformSpecial&&(this.specialCooldown>0||this.isGrounded&&(this.isSliding||(this.isPerformingSpecial=!0,this.jumpEnabled=!1,this.isImmortal=!0,this.setAnimation("special",!0),this.animationLock=!0,this.chargeTimeCurrent=0,this.runSpeedMin*=1.5,this.runSpeedMax*=2,this.level.changeZoom(this.zoomCharge.zoom,this.zoomCharge.time),this.level.changeFocusPoint(this.focusPointCharge.point,this.focusPointCharge.time,this.focusPointCharge.delay),n.prototype.special.call(this))))},s.prototype.specialEnd=function(){this.isPerformingSpecial&&(this.isPerformingSpecial=!1,this.animationLock=!1,this.isImmortal=!1,this.jumpEnabled=!0,this.runSpeedMin/=1.5,this.runSpeedMax/=2,this.level.changeZoom(this.zoomChargeEnd.zoom,this.zoomChargeEnd.time),this.level.changeFocusPoint(this.focusPointLand.point,this.focusPointLand.time,this.focusPointLand.delay))},s.prototype.jump=function(){this.specialEnd(),n.prototype.jump.call(this)},s.prototype.collisions=function(){if(n.prototype.collisions.call(this),this.isPerformingSpecial&&!this.isDead)for(var t=new PIXI.Circle(this.x+this.collisionCircle.x,this.y+this.collisionCircle.y,this.collisionCircle.radius),e=this.level.objectManager.getObjectsOfType("cage"),i=0;i<e.length;i++)e[i].collidable&&this.checkCollision(t,e[i])&&e[i].hit()},s.prototype.playMeleeKillSound=function(t){this.isPerformingSpecial?t&&n.prototype.playMeleeKillSound.call(this,t):t?n.prototype.playMeleeKillSound.call(this,t):this.playSound("sfx_hulk_attack_miss_00")}},{"../../../Common":3,"../../Force":19,"./Avatar":35}],42:[function(t,e,i){function s(t){n.call(this,t),this.flyingTimeTotal=1,this.flyingTimeCurrent=0,this.flyingForce=null,this.attackCooldownMax=1.5,this.animationCodes.special=["fly_iron_man"],this.animationCodes.attack=["punch_iron_man"]}var n=(t("../../../Common"),t("./Avatar")),o=t("../../Force");e.exports=s,s.prototype=Object.create(n.prototype),s.prototype.constructor=s,s.prototype.init=function(t){n.prototype.init.call(this,t)},s.prototype.update=function(){this.isPerformingSpecial?(this.flyingTimeCurrent+=this.level.deltaTime,this.flyingForce.update(this.level.deltaTime),this.velocity.y=this.flyingForce.y,this.flyingTimeCurrent>this.flyingTimeTotal?this.specialEnd():this.killEnemies()):!this.canPerformSpecial&&this.isGrounded&&(this.canPerformSpecial=!0),n.prototype.update.call(this)},s.prototype.special=function(){if(!this.isDead&&!this.hasLevelEnded)return this.isPerformingSpecial?void this.specialEnd():void(this.isPerformingSpecial||this.canPerformSpecial&&(this.specialCooldown>0||this.isTumbling||(this.isPerformingSpecial=!0,this.canPerformSpecial=!1,this.jumpEnabled=!1,this.isGrounded=!1,this.isSliding=!1,this.isTumbling=!1,this.canTumble=!1,this.isImmortal=!0,this.y-=10,this.allowPassthroughCollisions=!1,this.setAnimation("special",!0),this.animationLock=!0,this.flyingForce=new o,this.flyingForce.y=-700,this.flyingForce.yInc=5,this.flyingForce.maxY=0,this.flyingTimeCurrent=0,this.level.changeZoom(.8,.5,0),this.playSound("sfx_ironman_rocketjump"),n.prototype.special.call(this))))},s.prototype.specialEnd=function(){this.isPerformingSpecial&&(this.isPerformingSpecial=!1,this.allowPassthroughCollisions=!0,this.animationLock=!1,this.isImmortal=!1,this.jumpEnabled=!0,this.level.changeZoom(1,1,0))},s.prototype.attack=function(){this.canAttack()&&(this.setAnimation("attack"),this.killEnemiesRanged(800,.1),this.playSound("sfx_ironman_shoot_00"),this.attackCooldown=this.attackCooldownMax)}},{"../../../Common":3,"../../Force":19,"./Avatar":35}],43:[function(t,e,i){function s(t){n.call(this,t),this.specialTimeTotal=.5,this.specialTimeCurrent=0,this.attackDamageDelay=.25,this.attackCircleRadius*=1.75,this.attackCooldownMax=1,this.specialCooldownMax=2,this.animationCodes.attack=["attack_thor2"],this.animationCodes.special=["punch_thor"]}var n=(t("../../../Common"),t("./Avatar"));e.exports=s,s.prototype=Object.create(n.prototype),s.prototype.constructor=s,s.prototype.init=function(t){n.prototype.init.call(this,t)},s.prototype.update=function(){n.prototype.update.call(this),this.isPerformingSpecial&&(this.specialTimeCurrent+=this.level.deltaTime,this.specialTimeCurrent>this.specialTimeTotal&&this.specialEnd())},s.prototype.special=function(){this.isDead||this.hasLevelEnded||this.isPerformingSpecial||this.canPerformSpecial&&(this.specialCooldown>0||this.isGrounded&&(this.isSliding||(this.isPerformingSpecial=!0,this.canPerformSpecial=!1,this.jumpEnabled=!1,this.setAnimation("special",!1),this.animationLock=!0,this.killEnemiesRanged(800,.3),this.specialTimeCurrent=0,n.prototype.special.call(this))))},s.prototype.specialEnd=function(){this.isPerformingSpecial&&(this.isPerformingSpecial=!1,this.canPerformSpecial=!0,this.animationLock=!1,this.jumpEnabled=!0)},s.prototype.killEnemies=function(t){if(n.prototype.killEnemies.call(this,t),!t)for(var e=this.level.objectManager.getObjectsOfType("switch"),i=new PIXI.Circle(this.x+this.attackCircle.x,this.y+this.attackCircle.y,2*this.attackCircle.radius),s=0;s<e.length;s++)if(e[s].collidable&&!(e[s].x<this.x-50)&&this.checkCollision(i,e[s])){e[s].hit(),this.level.shake(.4,new PIXI.Point(40,20));for(var o=this.level.getPathsByType("laser"),a=0;a<o.length;a++)o[a].visible=!1,o[a].config.collisions=0;return}},s.prototype.playMeleeKillSound=function(t){this.playSound("sfx_thor_hammer_smash_00")},s.prototype.playRangedKillSound=function(t){t&&this.playMeleeKillSound()}},{"../../../Common":3,"./Avatar":35}],44:[function(t,e,i){function s(t){o.call(this,"enemy",!0),this.animationHolder=null,this.spine=null,this.spineSpeed=1,this.config={depth:0},this.abilities={doubleJump:!1},this.animationCodes={run:["run1","run2","run3","run4"],walk:["walk1"],crawl:["crawl1"],crouch:["crouch1","crouch2"],taunt:["taunt1","taunt2","pray1"],idle:["idle"],death:["enemy_die1","enemy_die4"],death_backstab:["enemy_die3"],death_push:["enemy_die2"],aim:["enemy_aim"],aim_loop:["enemy_aim_fire"],aim_attack:["enemy_aim_shoot"],attack:["enemy_aim"],step_back:["enemy_step_back"],fall:["jump_fall1"]},this.animationMixes=[{items:["idle","attack"],value:.1},{items:["aim","attack"],value:0}],this.animationLock=!1,this.isDead=!1,this.isImmortal=!1,this.isGrounded=!1,this.velocity=new p3.Vector2(0,0),this.jumpEnabled=!0,this.jumpTime=.45,this.jumpHeightMin=125,this.jumpHeight=300,this.runSpeedMin=600,this.runSpeedMax=900,this.runSpeed=this.runSpeedMin,this.runAnimation="run",this.runUpAngle=-50,this.runDownAngle=10,this.rotation=0,this.angleTarget=0,this.angleSpeed=.2,this._targetVisible=!1,this.canDoAction=!1}var n=t("../../../Common"),o=t("./RunningEntity");t("../../../shaders/OutlineFilter");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.init=function(t){if(!this.spine){this.level=t,this.collisionCircle=new PIXI.Circle(0,0,80),this.attackCircle=new PIXI.Circle((-240),(-40),15),this.jumpSpeed=2*this.jumpHeight/this.jumpTime,this.gravity=this.jumpSpeed/this.jumpTime,this.jumpTimeMin=Math.sqrt(2*this.jumpHeightMin/this.gravity),this.jumpSpeedMin=this.gravity*this.jumpTimeMin,this.animationHolder=new PIXI.Container,this.addChild(this.animationHolder),this.spine=new PIXI.spine.Spine(Spine.enemy),this.spine.skeleton.setToSetupPose(),this.spine.skeleton.setSkin(null),this.spine.x=0,this.spine.y=80,this.spine.autoUpdate=!1,this.spine.scale.set(.3),this.spine.update(0),this.animationHolder.addChild(this.spine);var e=[];for(var i in this.animationCodes)for(var s=this.animationCodes[i].length-1;s>=0;s--){var n=this.animationCodes[i][s];this.checkIfAnimationExists(n)?e.push(n):(console.warn("Animation %s missing",n),this.animationCodes[i].splice(s,1))}for(var i=0;i<e.length;i++)for(var s=0;s<e.length;s++)i!=s&&this.spine.stateData.setMix(e[i],e[s],.2);for(var o in this.animationCodes)for(var a in this.animationCodes)for(var r=0;r<this.animationMixes.length;r++)if(this.animationMixes[r].items.indexOf(o)!=-1&&this.animationMixes[r].items.indexOf(a)!=-1&&(o!=a||this.animationMixes[r].items[0]==this.animationMixes[r].items[1]))for(var h=this.animationMixes[r].value,i=0;i<this.animationCodes[o].length;i++)for(var l=this.animationCodes[o][i],c=0;c<this.animationCodes[a].length;c++){var p=this.animationCodes[a][c];this.spine.stateData.setMix(l,p,h)}}this.setAnimation("attack",!0),this.setAnimation("idle",!0)},s.prototype.configure=function(t,e){switch(this.level=t,this.config=e,this.x=this.config.position.x,this.y=this.config.position.y,this.velocity.x=0,this.velocity.y=0,this.spine.scale.x=-Math.sign(this.config.scale.x)*Math.abs(this.spine.scale.x),this.collidable=!0,this.isDead=!1,this.canDoAction=!0,this.canShoot=!1,this.animationLock=!1,this.spine.skeleton.setSkin(null),this.attackCircle.x=Math.abs(this.attackCircle.x)*-Math.sign(this.config.scale.x),this.config.id){case"enemy_scientist":this.spine.skeleton.setSkinByName(this.config.id+p3.Utils.randomInt(1,9));break;default:this.spine.skeleton.setSkinByName(this.config.id)}if(this.setAnimation("idle",!0),this.spine.update(1),""!=this.config.data)try{JSON.parse(this.config.data)}catch(i){console.error("Enemy data error %s",this.config.data)}1==Math.sign(this.config.scale.x)?(this.velocity.x=-200,this.runAnimation="walk"):(this.velocity.x=0,this.runAnimation="run"),this.level.debug&&(this.drawCollision(),!this._attackCollisionCircle&&this.canDoAction&&(this._attackCollisionCircle=new PIXI.Graphics,this.addChild(this._attackCollisionCircle),this._attackCollisionCircle.lineStyle(1,65280),this._attackCollisionCircle.drawCircle(0,0,this.attackCircle.radius)),this._attackCollisionCircle.x=this.attackCircle.x,this._attackCollisionCircle.y=this.attackCircle.y),this.targetHide()},s.prototype.update=function(){this.spine.update(this.level.deltaTime*this.spineSpeed),this.isDead||(this.isGrounded&&this.collisionPoint&&"fall"==this.currentAnimation?this.setAnimation("idle",!0):!this.isGrounded&&this.velocity.y>0?"fall"!=this.currentAnimation&&""!=this.currentAnimation&&this.setAnimation("fall",!1):this.isGrounded&&(0==this.velocity.x?this.setAnimation("idle",!0):this.setAnimation(this.runAnimation,!0)));var t=(new p3.Vector2(this.velocity.x,this.velocity.y),this.isGrounded);if(this.velocity.y+=this.gravity*this.level.deltaTime,this.velocity.y>=this.gravity/2&&(this.velocity.y=this.gravity/2),this.move(this.velocity),this.isGrounded){this.velocity.y=0;var e=Math.atan2(Math.sin(this.angleTarget-this.animationHolder.rotation),Math.cos(this.angleTarget-this.animationHolder.rotation));this.animationHolder.rotation=this.animationHolder.rotation+e*this.angleSpeed,t||this.isDead||this.land()}if(!this.isDead&&this.canDoAction)if("enemy_scientist"==this.config.id){if(this.x>this.level.avatar.x){var i=Math.sqrt(Math.pow(this.x-this.level.avatar.x,2)+Math.pow(this.y-this.level.avatar.y,2));if(i<600)switch(this.animationLock=!1,this.canDoAction=!1,p3.Utils.randomInt(0,4)){case 0:case 1:this.runAnimation="run",this.spineSpeed=p3.Utils.randomRange(.8,1.2),this.velocity.x=500*this.spineSpeed,this.spine.scale.x=Math.abs(this.spine.scale.x);break;case 2:this.runAnimation="crawl",this.spineSpeed=p3.Utils.randomRange(.8,1.2),this.velocity.x=200*this.spineSpeed,this.spine.scale.x=Math.abs(this.spine.scale.x);break;case 3:this.setAnimation("crouch",!0),this.animationLock=!0,this.velocity.x=0;break;case 4:this.setAnimation("taunt",!0),this.animationLock=!0,this.spine.scale.x=-Math.abs(this.spine.scale.x),this.velocity.x=0}}}else{var s=function(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t},i=Math.sqrt(Math.pow(this.x-this.level.avatar.x,2)+Math.pow(this.y-this.level.avatar.y,2)),n=new PIXI.Point(Math.acos(this.animationHolder.rotation),Math.asin(this.animationHolder.rotation));this.config.scale.x>0&&(n.x*=-1,n.y*=-1);var o=new PIXI.Point(this.level.avatar.x-this.x,this.level.avatar.y-this.y),a=Math.atan2(-n.y,n.x)*PIXI.RAD_TO_DEG,r=Math.atan2(-o.y,o.x)*PIXI.RAD_TO_DEG,e=Math.abs(s(r-a));if(this.canShoot){var h=new PIXI.Circle(this.x+this.attackCircle.x,this.y+this.attackCircle.y,this.attackCircle.radius);this.checkCollision(h,this.level.avatar)&&(this.animationLock=!1,this.setAnimation("aim_attack",!1),this.addAnimation("step_back",!1),this.animationLock=!0,this.canDoAction=!1,this.level.avatar.onDeath(),this.playSound("sfx_laser_trap_caught_00"))}else e<30&&i<1e3&&(this.setAnimation("aim",!1),this.addAnimation("aim_loop",!0),this.animationLock=!0,this.canShoot=!0,this.velocity.x=0,this.playSound("sfx_laser_trap_set_00"))}if("enemy_scientist"!=this.config.id)if(this.isDead||this._targetVisible)(this.level.avatar.isDead||this.level.avatar.x>this.x+50)&&this.targetFadeOut();else if(!this.level.avatar.isDead&&this.level.avatar.x<this.x){var i=Math.sqrt(Math.pow(this.x-this.level.avatar.x,2)+Math.pow(this.y-this.level.avatar.y,2));i<1200&&this.targetFadeIn()}},s.prototype.jump=function(){this.isDead||this.jumpEnabled&&this.isGrounded&&(this.rotation=0,this.angleTarget=0,this.isGrounded=!1,this.setAnimation("jump",!1))},s.prototype.jumpEnd=function(){this.isDead||this.isGrounded||this.velocity.y<-this.jumpSpeedMin&&this.velocity.y>=-this.jumpSpeed&&(this.velocity.y=-this.jumpSpeedMin)},s.prototype.land=function(){},s.prototype.setAnimation=function(t,e){if(!(this.animationLock||e&&t==this.currentAnimation||void 0==this.animationCodes[t]||0==this.animationCodes[t].length)){var i=this.animationCodes[t][p3.Utils.randomInt(0,this.animationCodes[t].length-1)];this.spine.state.setAnimation(0,i,e,0),this.currentAnimation=t}},s.prototype.addAnimation=function(t,e){if(!(this.animationLock||e&&t==this.currentAnimation||void 0==this.animationCodes[t]||0==this.animationCodes[t].length)){var i=this.animationCodes[t][p3.Utils.randomInt(0,this.animationCodes[t].length-1)];this.spine.state.addAnimation(0,i,e,0),this.currentAnimation=t}},s.prototype.checkIfAnimationExists=function(t){for(var e=0;e<this.spine.spineData.animations.length;e++)if(this.spine.spineData.animations[e].name==t)return!0;return!1},s.prototype.stop=function(){this._velocity.x=0},s.prototype.resume=function(){},s.prototype.onDeath=function(){this.isDead||(this.isDead=!0,this.collidable=!1,this.velocity.x=0,this.animationLock=!1,1==Math.sign(this.spine.scale.x)?this.setAnimation("death_backstab",!1):Math.abs(this.x-this.level.avatar.x)>400?this.setAnimation("death",!1):this.setAnimation("death_push",!1),n.goalsManager.trackEvent("enemy"),this.targetHide())},s.prototype.hit=function(){},s.prototype.targetFadeIn=function(){this.spine.state.setAnimation(2,"target_appear",!1,0),this.spine.state.addAnimation(2,"target_on",!0,0),this._targetVisible=!0},s.prototype.targetFadeOut=function(){this._targetVisible&&(this._targetVisible=!1,this.spine.state.setAnimation(2,"target_disappear",!1,0),this.spine.state.addAnimation(2,"target_off",!1,0))},s.prototype.targetHide=function(){this.spine.state.setAnimation(2,"target_off",!1,0)}},{"../../../Common":3,"../../../shaders/OutlineFilter":81,"./RunningEntity":46}],45:[function(t,e,i){function s(t){o.call(this,"enemy",!0),this.animationHolder=null,this.spine=null,this.spineSpeed=1,this.config={depth:0},this.animationCodes={death:["enemy_die1","enemy_die4"]},this.animationLock=!1,this.isDead=!1,this.isImmortal=!1,this.canDoAction=!1,this.velocity=new p3.Vector2(0,0),this.jumpEnabled=!0,this.jumpTime=.45,this.jumpHeightMin=125,this.jumpHeight=300}var n=t("../../../Common"),o=t("./RunningEntity");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.init=function(t){if(!this.spine){this.level=t,this.jumpSpeed=2*this.jumpHeight/this.jumpTime,this.gravity=this.jumpSpeed/this.jumpTime,this.jumpTimeMin=Math.sqrt(2*this.jumpHeightMin/this.gravity),this.jumpSpeedMin=this.gravity*this.jumpTimeMin,this.collisionCircle=new PIXI.Circle(0,0,80),this.animationHolder=new PIXI.Container,this.addChild(this.animationHolder),this.spineBack=new PIXI.spine.Spine(Spine.scientist_back),this.spineBack.skeleton.setToSetupPose(),this.spineBack.skeleton.setSkin(null),this.spineBack.skeleton.setSkinByName("default"),this.spineBack.x=0,this.spineBack.y=80,this.spineBack.autoUpdate=!1,this.spineBack.scale.set(.3),this.spineBack.update(0),this.animationHolder.addChild(this.spineBack),this.spine=new PIXI.spine.Spine(Spine.enemy),this.spine.skeleton.setToSetupPose(),this.spine.skeleton.setSkin(null),this.spine.skeleton.setSkinByName("enemy_scientist1"),this.spine.x=0,this.spine.y=80,this.spine.autoUpdate=!1,this.spine.scale.set(-.3,.3),this.spine.update(0),this.animationHolder.addChild(this.spine);var e=[];for(var i in this.animationCodes)for(var s=this.animationCodes[i].length-1;s>=0;s--){var n=this.animationCodes[i][s];this.checkIfAnimationExists(n)?e.push(n):(console.warn("Animation %s missing",n),this.animationCodes[i].splice(s,1))}}this.spineBack.visible=!0,this.spine.visible=!1,this.setAnimation("idle",!0),this.spineBack.state.setAnimation(0,"idle"+p3.Utils.randomInt(1,2),!0,0)},s.prototype.configure=function(t,e){if(this.level=t,this.config=e,this.x=this.config.position.x,this.y=this.config.position.y,this.collidable=!0,this.isDead=!1,""!=this.config.data)try{JSON.parse(this.config.data)}catch(i){console.error("EnemyScientistBack data error %s",this.config.data)}this.level.debug&&this.drawCollision()},s.prototype.update=function(){this.spineBack.visible?this.spineBack.update(this.level.deltaTime*this.spineSpeed):this.spine.update(this.level.deltaTime*this.spineSpeed),this.velocity.y+=this.gravity*this.level.deltaTime,this.velocity.y>=this.gravity/2&&(this.velocity.y=this.gravity/2),this.move(this.velocity)},s.prototype.setAnimation=function(t,e){if(!(this.animationLock||e&&t==this.currentAnimation||void 0==this.animationCodes[t]||0==this.animationCodes[t].length)){var i=this.animationCodes[t][p3.Utils.randomInt(0,this.animationCodes[t].length-1)];this.spine.state.setAnimation(0,i,e,0),this.currentAnimation=t}},s.prototype.addAnimation=function(t,e){if(!(this.animationLock||e&&t==this.currentAnimation||void 0==this.animationCodes[t]||0==this.animationCodes[t].length)){var i=this.animationCodes[t][p3.Utils.randomInt(0,this.animationCodes[t].length-1)];this.spine.state.addAnimation(0,i,e,0),this.currentAnimation=t}},s.prototype.checkIfAnimationExists=function(t){for(var e=0;e<this.spine.spineData.animations.length;e++)if(this.spine.spineData.animations[e].name==t)return!0;return!1},s.prototype.onDeath=function(){this.isDead||(this.isDead=!0,this.collidable=!1,this.spineBack.visible=!1,this.spine.visible=!0,this.setAnimation("death",!1),n.goalsManager.trackEvent("enemy"))}},{"../../../Common":3,"./RunningEntity":46}],46:[function(t,e,i){"use strict";function s(t,e){n.call(this,t,!!e),this.level=null,this.allowPathCollisions=!0,this.allowPassthroughCollisions=!0,this.collisionPoint=null,this.angleTarget=0,this.velocity=new PIXI.Point,this.currentPath=null,this.ignoreRollPaths=!1,this.canStickToCeiling=!1,this.isStickingToCeiling=!1}var n=(t("../../../Common"),t("../../GameObject"));e.exports=s,s.prototype=Object.create(n.prototype),s.prototype.constructor=s,s.prototype.init=function(t){this.level=t},s.prototype.move=function(t){var e=Math.sign(t.y),t=new PIXI.Point(t.x*this.level.deltaTime,t.y*this.level.deltaTime);if(t.y>0&&t.y>=this.collisionCircle.radius&&(t.y=.99*this.collisionCircle.radius),this.isGrounded&&this.collisionPoint&&(t.x*=Math.cos(this.collisionPoint.angle)),this.x+=t.x,this.y+=t.y,this.isStickingToCeiling=!1,this.allowPathCollisions){var i=this.isGrounded;this.collisionPoint=null,this.isGrounded=!1,this.level.debug&&(this.wireframe&&this.level.removeChild(this.wireframe),this.wireframe=new PIXI.Graphics,this.wireframe.config={depth:1e3},this.level.addChild(this.wireframe)),this.currentPath=null;for(var s=0;s<this.level.layers.length;s++)for(var n=0;n<this.level.layers[s].childrenPaths.length;n++)if(1==this.level.layers[s].childrenPaths[n].config.collisions&&!(this.level.layers[s].childrenPaths[n].config.bounds[0]>this.x+this.collisionCircle.x+2*this.collisionCircle.radius||this.level.layers[s].childrenPaths[n].config.bounds[1]<this.x+this.collisionCircle.x-2*this.collisionCircle.radius))for(var o=this.level.layers[s].childrenPaths[n].bezier.getDrawingPoints(),a=0;a<o.length-1;a++){var r=o[a+1],h=o[a];if(!(r.x>h.x)){var l=new PIXI.Point(this.x+this.collisionCircle.x,this.y+this.collisionCircle.y);if(!(r.x>l.x+this.collisionCircle.radius||h.x<l.x-this.collisionCircle.radius||r.y>l.y+this.collisionCircle.radius&&h.y>l.y+this.collisionCircle.radius||r.y<l.y-this.collisionCircle.radius&&h.y<l.y-this.collisionCircle.radius)){var c=new PIXI.Point(o[a+1].x-o[a].x,o[a+1].y-o[a].y),p=new PIXI.Point(c.x,c.y);
p.normalize();var d=new PIXI.Point(this.x+this.collisionCircle.x-o[a].x,this.y+this.collisionCircle.y-o[a].y),u=d.dotProduct(c)/c.getLength(),_=new PIXI.Point(p.x*u,p.y*u);_.x!=c.x?(_.x/c.x<0&&(_=new PIXI.Point(0,0)),_.x/c.x>1&&(_=new PIXI.Point(c.x,c.y))):(_.y/c.y<0&&(_=new PIXI.Point(0,0)),_.y/c.y>1&&(_=new PIXI.Point(c.x,c.y)));var g=new PIXI.Point(_.x-d.x,_.y-d.y),m=g.getLength();this.level.debug&&(this.wireframe.lineStyle(8,16777215,1),this.wireframe.moveTo(r.x,r.y),this.wireframe.lineTo(h.x,h.y),this.wireframe.lineStyle(6,255,1),this.wireframe.moveTo(l.x,l.y),this.wireframe.lineTo(l.x-d.x,l.y-d.y)),m<this.collisionCircle.radius&&(this.level.debug&&(this.wireframe.lineStyle(3,16711935,1),this.wireframe.moveTo(o[a].x,o[a].y),this.wireframe.lineTo(o[a].x+_.x,o[a].y+_.y),this.wireframe.lineStyle(5,65280,1),this.wireframe.moveTo(o[a].x+_.x,o[a].y+_.y),this.wireframe.lineTo(o[a].x+_.x-g.x,o[a].y+_.y-g.y)),this.velocity.y<=0&&(this.isStickingToCeiling=this.canStickToCeiling,this.isStickingToCeiling?(this.y+=this.collisionCircle.radius-m-.001,this.velocity.y=0):(this.y-=t.y,this.velocity.y=200)),0==t.x||this.isStickingToCeiling||(this.x+=-Math.sign(t.x)*(this.collisionCircle.radius-m)))}}}for(var y=80,s=0;s<this.level.layers.length;s++)for(var n=0;n<this.level.layers[s].childrenPaths.length;n++){var f=this.level.layers[s].childrenPaths[n];if(f.config.collisions!=f.collisions.SOLID&&(f.config.collisions!=f.collisions.PASSTHROUGH||!(e<0)&&this.allowPassthroughCollisions)&&!(f.config.bounds[0]>this.x+this.collisionCircle.x+2*this.collisionCircle.radius||f.config.bounds[1]<this.x+this.collisionCircle.x-2*this.collisionCircle.radius||this.ignoreRollPaths&&this.level.layers[s].childrenPaths[n].isRollPath())){var o=f.bezier.getDrawingPoints();do for(var x=!1,a=0;a<o.length-1;a++){var r=o[a],h=o[a+1];if(!(r.x>h.x)){var l=new PIXI.Point(this.x+this.collisionCircle.x,this.y+this.collisionCircle.y);if(!(r.x>l.x+this.collisionCircle.radius||h.x<l.x-this.collisionCircle.radius||r.y>l.y+this.collisionCircle.radius&&h.y>l.y+this.collisionCircle.radius||r.y<l.y-this.collisionCircle.radius&&h.y<l.y-this.collisionCircle.radius)){var v=Math.atan2(h.y-r.y,h.x-r.x);if(!(Math.abs(v*PIXI.RAD_TO_DEG)>=y)){if(2==f.config.collisions){if(!i){var b=(l.x-r.x)/(h.x-r.x);b=Math.min(Math.max(b,0),1);var I=r.y+(h.y-r.y)*b;if(l.y>I)continue}if(Math.abs(v*PIXI.RAD_TO_DEG)>=f.config.texWallAngle)continue}var c=new PIXI.Point(o[a+1].x-o[a].x,o[a+1].y-o[a].y),p=new PIXI.Point(c.x,c.y);p.normalize();var d=new PIXI.Point(this.x+this.collisionCircle.x-o[a].x,this.y+this.collisionCircle.y-o[a].y),u=d.dotProduct(c)/c.getLength(),_=new PIXI.Point(p.x*u,p.y*u);if(_.x!=c.x){if(_.x/c.x<0&&!i)continue;_.x/c.x<0&&(_=new PIXI.Point(0,0)),_.x/c.x>1&&(_=new PIXI.Point(c.x,c.y))}else _.y/c.y<0&&(_=new PIXI.Point(0,0)),_.y/c.y>1&&(_=new PIXI.Point(c.x,c.y));var g=new PIXI.Point(_.x-d.x,_.y-d.y),m=g.getLength();if(this.level.debug&&(this.wireframe.lineStyle(8,16777215,1),this.wireframe.moveTo(r.x,r.y),this.wireframe.lineTo(h.x,h.y),this.wireframe.lineStyle(6,255,1),this.wireframe.moveTo(l.x,l.y),this.wireframe.lineTo(l.x-d.x,l.y-d.y)),m<this.collisionCircle.radius){this.level.debug&&(this.wireframe.lineStyle(3,16711935,1),this.wireframe.moveTo(o[a].x,o[a].y),this.wireframe.lineTo(o[a].x+_.x,o[a].y+_.y),this.wireframe.lineStyle(5,16711680,1),this.wireframe.moveTo(o[a].x+_.x,o[a].y+_.y),this.wireframe.lineTo(o[a].x+_.x-g.x,o[a].y+_.y-g.y)),t.y=0,this.isGrounded=!0,g.normalize();var C=g.angle(new PIXI.Point(0,1)),w=Math.sin(Math.acos(Math.sin(C)))*this.collisionCircle.radius-Math.abs(Math.cos(C))*m;this.y-=w,this.collisionPoint={path:f,position:{x:o[a].x+_.x,y:o[a].y+_.y},angle:v},this.currentPath=f,w>=1&&(x=!0)}}}}}while(x)}}if(!this.isGrounded&&i&&t.y>0){for(var y=80,P=50,T=P,s=0;s<this.level.layers.length;s++)for(var n=0;n<this.level.layers[s].childrenPaths.length;n++){var f=this.level.layers[s].childrenPaths[n];if(f.config.collisions!=f.collisions.SOLID&&(f.config.collisions!=f.collisions.PASSTHROUGH||!(e<0)&&this.allowPassthroughCollisions)&&!(f.config.bounds[0]>this.x+this.collisionCircle.x+2*this.collisionCircle.radius||f.config.bounds[1]<this.x+this.collisionCircle.x-2*this.collisionCircle.radius||this.ignoreRollPaths&&this.level.layers[s].childrenPaths[n].isRollPath()))for(var o=f.bezier.getDrawingPoints(),a=0;a<o.length-1;a++){var r=o[a],h=o[a+1];if(!(r.x>h.x)){var l=new PIXI.Point(this.x+this.collisionCircle.x,this.y+this.collisionCircle.y);if(!(r.x>l.x+this.collisionCircle.radius||h.x<l.x-this.collisionCircle.radius||r.y<l.y-this.collisionCircle.radius&&h.y<l.y-this.collisionCircle.radius||r.y>l.y+this.collisionCircle.radius+50&&h.y>l.y+this.collisionCircle.radius+50)){var v=Math.atan2(h.y-r.y,h.x-r.x);if(!(Math.abs(v*PIXI.RAD_TO_DEG)>y)){var c=new PIXI.Point(o[a+1].x-o[a].x,o[a+1].y-o[a].y),p=new PIXI.Point(c.x,c.y);p.normalize();var d=new PIXI.Point(this.x+this.collisionCircle.x-o[a].x,this.y+this.collisionCircle.y-o[a].y),u=d.dotProduct(c)/c.getLength(),_=new PIXI.Point(p.x*u,p.y*u);_.x!=c.x?(_.x/c.x<0&&(_=new PIXI.Point(0,0)),_.x/c.x>1&&(_=new PIXI.Point(c.x,c.y))):(_.y/c.y<0&&(_=new PIXI.Point(0,0)),_.y/c.y>1&&(_=new PIXI.Point(c.x,c.y)));var g=new PIXI.Point(_.x-d.x,_.y-d.y),m=g.getLength();if(this.level.debug&&(this.wireframe.lineStyle(8,16777215,1),this.wireframe.moveTo(r.x,r.y),this.wireframe.lineTo(h.x,h.y),this.wireframe.lineStyle(6,255,1),this.wireframe.moveTo(l.x,l.y),this.wireframe.lineTo(l.x-d.x,l.y-d.y)),g.y>0&&m>this.collisionCircle.radius){this.level.debug&&(this.wireframe.lineStyle(3,16711935,1),this.wireframe.moveTo(o[a].x,o[a].y),this.wireframe.lineTo(o[a].x+_.x,o[a].y+_.y),this.wireframe.lineStyle(5,16737792,1),this.wireframe.moveTo(o[a].x+_.x,o[a].y+_.y),this.wireframe.lineTo(o[a].x+_.x-g.x,o[a].y+_.y-g.y)),g.normalize();var C=g.angle(new PIXI.Point(0,1)),S=m-this.collisionCircle.radius,k=S*Math.sin(C)/Math.cos(C),B=Math.sqrt(Math.pow(S,2)+Math.pow(k,2));B<T&&(T=B,this.collisionPoint={path:f,position:{x:o[a].x+_.x,y:o[a].y+_.y},angle:v},this.currentPath=f)}}}}}}T<P&&(t.y=0,this.y+=T,this.isGrounded=!0)}this.isGrounded&&(!this.isSliding||0!=this.timeUnsliding||null!=this.vehicle&&this.isSliding)?this.angleTarget=this.collisionPoint.angle:this.isTumbling?this.angleTarget=0+this.tumbleAngle:this.angleTarget=0}},s.prototype.checkCollision=function(t,e){if(null!=e.collisionRect){var i=[];i.push(new PIXI.Point(e.x+e.collisionRect.x,e.y+e.collisionRect.y)),i.push(new PIXI.Point(e.x+e.collisionRect.x+e.collisionRect.width,e.y+e.collisionRect.y)),i.push(new PIXI.Point(e.x+e.collisionRect.x+e.collisionRect.width,e.y+e.collisionRect.y+e.collisionRect.height)),i.push(new PIXI.Point(e.x+e.collisionRect.x,e.y+e.collisionRect.y+e.collisionRect.height));for(var s=new PIXI.Point(e.x,e.y),n=0;n<i.length;n++)i[n].rotateAround(s,e.rotation);for(var n=0;n<i.length;n++)if(Math.sqrt(Math.pow(i[n].x-t.x,2)+Math.pow(i[n].y-t.y,2))<t.radius)return!0;for(var o=0;o<i.length;o++){var a=new PIXI.Point(i[(o+1)%i.length].x-i[o].x,i[(o+1)%i.length].y-i[o].y),r=new PIXI.Point(a.x,a.y);r.normalize();var h=new PIXI.Point(t.x-i[o].x,t.y-i[o].y),l=h.dotProduct(a)/a.getLength(),c=new PIXI.Point(r.x*l,r.y*l);if(c.x!=a.x){if(c.x/a.x<0)continue;if(c.x/a.x>1)continue}else{if(c.y/a.y<0)continue;if(c.y/a.y>1)continue}var p=new PIXI.Point(c.x-h.x,c.y-h.y),d=p.getLength();if(d<t.radius)return!0}}else if(null!=e.collisionCircle){var u=new PIXI.Circle(e.x,e.y,e.collisionCircle.radius),_=new PIXI.Point(t.x-u.x,t.y-u.y);return Math.sqrt(Math.pow(_.x,2)+Math.pow(_.y,2))<=t.radius+u.radius}return!1}},{"../../../Common":3,"../../GameObject":20}],47:[function(t,e,i){function s(){o.call(this,"coin",!0),this.level=null,this.config=null,this.sprite=null,this.attracted=!1,this.attractionTimeMax=.3,this.attractionPosition=new PIXI.Point,this.timeline=null}var n=t("../../../Common"),o=t("../../GameObject"),a=t("../../effects/EffectCoinCollect");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.init=function(t){null==this.sprite&&(this.sprite=new PIXI.Sprite,this.addChild(this.sprite))},s.prototype.reset=function(){this.level=null,this.config=null},s.prototype.configure=function(t,e){this.level=t,this.config=e,this.x=this.config.position.x,this.y=this.config.position.y,this.sprite.texture=n.assets.getTexture("ui_icon_ability_token"),this.sprite.anchor.set(.5),this.sprite.scale.set(1),this.sprite.visible=!0,this.collidable=!0,this.sprite.visible=!0,this.attracted=!1,this.attractionTarget=0,this.attractionTime=0,this.rotation=Math.random(0,360)*PIXI.DEG_TO_RAD,this.collisionCircle=new PIXI.Circle(0,0,55),this.timeline?this.timeline.resume():(this.sprite.position.set(0,-10),this.timeline=this.level.scene.createTimeline(),this.timeline.to(this.sprite,.75,{y:10,ease:Sine.easeInOut,repeat:-1,yoyo:!0},Math.random()),this.timeline.to(this.sprite.scale,.5,{x:1.3,y:1.3,ease:Sine.easeInOut,repeat:-1,yoyo:!0},0)),this.level.debug&&this.drawCollision()},s.prototype.dispose=function(){this.timeline&&this.timeline.pause()},s.prototype.update=function(){if(this.attracted){if(this.attractionTime+=p3.Timestep.deltaTime,this.attractionTime>this.attractionTimeMax)return this.sprite.visible=!1,void(this.attracted=!1);this.x=this.attractionPosition.x+(this.attractionTarget.x-20-this.attractionPosition.x)*this.attractionTime/this.attractionTimeMax,this.y=this.attractionPosition.y+(this.attractionTarget.y-20-this.attractionPosition.y)*this.attractionTime/this.attractionTimeMax,this.sprite.scale.x=1-this.attractionTime/this.attractionTimeMax,this.sprite.scale.y=1-this.attractionTime/this.attractionTimeMax}},s.prototype.pickup=function(t){if(this.collidable)return this.collidable=!1,this.attracted=!0,this.attractionTarget=t,this.attractionPosition.set(this.x,this.y),this.level.addEffect(new a(this.level,this.x,this.y)),this.playSound("sfx_coin_pickup_00"),n.goalsManager.trackEvent("coins"),!0}},{"../../../Common":3,"../../GameObject":20,"../../effects/EffectCoinCollect":31}],48:[function(t,e,i){function s(){o.call(this,"collectible",!0),this.level=null,this.config=null,this.sprite=null,this.attracted=!1,this.attractionTimeMax=.3,this.attractionPosition=new PIXI.Point,this.timeline=null}var n=t("../../../Common"),o=t("../../GameObject");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.init=function(t){null==this.sprite&&(this.glow=new PIXI.Sprite(n.assets.getTexture("ui_rays")),this.glow.anchor.set(.5),this.glow.tint=16759296,this.addChild(this.glow),this.sprite=new PIXI.Sprite,this.addChild(this.sprite))},s.prototype.reset=function(){this.level=null,this.config=null},s.prototype.configure=function(t,e){this.level=t,this.config=e,this.index=t.collectibleIndex,t.collectibleIndex++,this.x=this.config.position.x,this.y=this.config.position.y,this.sprite.texture=n.assets.getTexture("ui_progress_icon"),this.sprite.anchor.set(.5),this.sprite.scale.set(1),this.sprite.visible=!0,this.glow.rotation=0,this.glow.scale.set(1),this.glow.visible=!0,this.glow.alpha=1,this.collidable=!n.savedData.isCollectibleCollected(this.level.levelIndex,this.index),this.sprite.visible=!0,this.sprite.alpha=this.collidable?1:.5,this.glow.visible=this.collidable,this.attracted=!1,this.attractionTarget=0,this.attractionTime=0,this.rotation=Math.random(0,360)*PIXI.DEG_TO_RAD,this.collisionCircle=new PIXI.Circle(0,0,55),this.collidable&&(this.sprite.position.set(0,-10),this.timeline&&this.timeline.kill(),this.timeline=this.level.scene.createTimeline(),this.timeline.to(this.sprite,1,{y:20,ease:Sine.easeInOut,repeat:-1,yoyo:!0,onUpdateScope:this,onUpdate:function(){this.glow.y=this.sprite.y}},0),this.timeline.to(this.glow,8,{rotation:2*Math.PI,ease:Linear.easeNone,repeat:-1},0),this.timeline.to(this.glow.scale,.5,{x:1.5,y:1.5,ease:Quad.easeInOut,repeat:-1,yoyo:!0},0)),this.level.debug&&this.drawCollision()},s.prototype.dispose=function(){this.timeline&&this.timeline.kill()},s.prototype.update=function(){if(this.attracted){if(this.attractionTime+=p3.Timestep.deltaTime,this.attractionTime>this.attractionTimeMax)return this.sprite.visible=!1,void(this.attracted=!1);this.x=this.attractionPosition.x+(this.attractionTarget.x-20-this.attractionPosition.x)*this.attractionTime/this.attractionTimeMax,this.y=this.attractionPosition.y+(this.attractionTarget.y-20-this.attractionPosition.y)*this.attractionTime/this.attractionTimeMax,this.sprite.scale.x=1-this.attractionTime/this.attractionTimeMax,this.sprite.scale.y=1-this.attractionTime/this.attractionTimeMax}},s.prototype.pickup=function(t){if(this.collidable)return this.collidable=!1,this.attracted=!0,this.attractionTarget=t,this.attractionPosition.set(this.x,this.y),this.playSound("sfx_usb_pickup_00"),this.timeline&&(this.timeline.kill(),this.timeline=this.level.scene.createTimeline(),this.timeline.to(this.glow.scale,this.attractionTimeMax,{x:0,y:0,ease:Quad.easeOut},0)),n.savedData.collectibleCollected(this.level.levelIndex,this.index),this.level.scene.gameUI.updateCollectibles(),n.goalsManager.trackEvent("collectibles"),!0}},{"../../../Common":3,"../../GameObject":20}],49:[function(t,e,i){function s(){o.call(this,"cage",!0),this.level=null,this.config=null,this.timeline=null}var n=t("../../../Common"),o=t("../../GameObject"),a=t("../../effects/EffectCageBurst");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.init=function(t){null==this.sprite&&(this.sprite=new PIXI.Sprite,this.addChild(this.sprite))},s.prototype.reset=function(){this.level=null,this.config=null},s.prototype.configure=function(t,e){this.level=t,this.config=e,this.x=this.config.position.x,this.y=this.config.position.y,this.sprite.texture=n.assets.getTexture(this.config.texture),this.sprite.anchor.set(this.config.anchor.x,this.config.anchor.y),this.sprite.scale.set(this.config.scale.x,this.config.scale.y),this.rotation=this.config.rotation*PIXI.DEG_TO_RAD,this.collidable=!0,this.sprite.visible=!0;var i=this.sprite.width,s=this.sprite.height;this.collisionRect=new PIXI.Rectangle(-i*this.sprite.anchor.x,-this.sprite.anchor.y*s,i,s),this.level.debug&&this.drawCollision(),this.collectibles=[];for(var o=this.level.objectManager.getObjectsOfType("collectible"),a=0;a<o.length;a++)o[a].collidable&&(o[a].x<this.x+this.collisionRect.x||o[a].y<this.y+this.collisionRect.y||o[a].x>this.x+this.collisionRect.x+this.collisionRect.width||o[a].y>this.y+this.collisionRect.y+this.collisionRect.height||(o[a].collidable=!1,this.collectibles.push(o[a])))},s.prototype.dispose=function(){},s.prototype.update=function(){},s.prototype.hit=function(){this.collidable=!1,this.sprite.visible=!1;for(var t=0;t<this.collectibles.length;t++)this.collectibles[t].collidable=!0;this.level.addEffect(new a(this.level,this.x-this.sprite.width/4,this.y-this.sprite.height/2)),this.playSound("sfx_hulk_smash_cage_00")}},{"../../../Common":3,"../../GameObject":20,"../../effects/EffectCageBurst":29}],50:[function(t,e,i){"use strict";function s(t){this.level=null,this.config=null,this.sprite=null,this.effectData=t,this.effects=[],o.call(this,"decoration",!0)}var n=t("../../../Common"),o=t("../../GameObject"),a=t("../../effects/Fire");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.init=function(t){null==this.sprite&&(this.sprite=new PIXI.Sprite,this.addChild(this.sprite))},s.prototype.reset=function(){for(this.level=null,this.config=null,this.visible=!0;this.effects.length>0;)this.effects[0].dispose(),this.removeChild(this.effects[0]),this.effects.splice(0,1)},s.prototype.configure=function(t,e){if(this.level=t,this.config=e,this.x=this.config.position.x,this.y=this.config.position.y,this.sprite.texture=n.assets.getTexture(this.config.texture),this.sprite.anchor.set(this.config.anchor.x,this.config.anchor.y),this.sprite.scale.set(this.config.scale.x,this.config.scale.y),this.sprite.rotation=this.config.rotation*PIXI.DEG_TO_RAD,""!=this.config.data)try{JSON.parse(this.config.data)}catch(i){console.error("Decoration data error %s",this.config.data)}for(var s in this.effectData){var o;"fire"==this.effectData[s].effect&&(o=new a),o&&(o.x=this.effectData[s].x,o.y=this.effectData[s].y,o.depth=this.effectData[s].depth,this.effects.push(o))}this.effects.sort(function(t,e){return t.depth-e.depth});for(var s=0;s<this.effects.length;s++)this.effects[s].depth>0&&(0==s||this.effects[s-1].depth<0)&&this.addChild(this.sprite),this.addChild(this.effects[s]),s==this.effects.length-1&&this.effects[s].depth<=0&&this.addChild(this.sprite)},s.prototype.dispose=function(){},s.prototype.update=function(){}},{"../../../Common":3,"../../GameObject":20,"../../effects/Fire":34}],51:[function(t,e,i){function s(t){this.level=null,this.config=null,this.sprite=null,this.effectData=t,this.effects=[],o.call(this,"hint",!0)}var n=t("../../../Common"),o=t("../../GameObject");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.init=function(t){null==this.sprite&&(this.sprite=new PIXI.Sprite,this.sprite.anchor.set(.5),this.addChild(this.sprite),this.portrait=new PIXI.Sprite,this.portrait.anchor.set(.5),this.sprite.addChild(this.portrait))},s.prototype.reset=function(){this.level=null,this.config=null,this.visible=!0},s.prototype.configure=function(t,e){if(this.level=t,this.config=e,""!=this.config.data)try{var i=JSON.parse(this.config.data)}catch(s){console.error("Decoration data error %s",this.config.data)}this.x=this.config.position.x,this.y=this.config.position.y,this.sprite.texture=n.assets.getTexture(e.id),this.portrait.texture=n.assets.getTexture("hint_"+(i.character||"captain_america")),this.timeline?this.timeline.resume():(this.timeline=this.level.scene.createTimeline(),this.timeline.fromTo(this.sprite,.25,{y:-5},{y:5,ease:Sine.easeInOut,repeat:-1,yoyo:!0},0))},s.prototype.dispose=function(){this.timeline&&this.timeline.pause()},s.prototype.update=function(){}},{"../../../Common":3,"../../GameObject":20}],52:[function(t,e,i){function s(){o.call(this,"switch",!0),this.level=null,this.config=null,this.timeline=null}var n=t("../../../Common"),o=t("../../GameObject");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.init=function(t){null==this.sprite&&(this.sprite=new PIXI.Sprite,this.addChild(this.sprite))},s.prototype.reset=function(){this.level=null,this.config=null},s.prototype.configure=function(t,e){this.level=t,this.config=e,this.x=this.config.position.x,this.y=this.config.position.y,this.sprite.texture=n.assets.getTexture(this.config.texture),this.sprite.anchor.set(this.config.anchor.x,this.config.anchor.y),this.sprite.scale.set(this.config.scale.x,this.config.scale.y),this.rotation=this.config.rotation*PIXI.DEG_TO_RAD,this.collidable=!0,this.sprite.visible=!0;var i=this.sprite.width,s=this.sprite.height;this.collisionRect=new PIXI.Rectangle(-i*this.sprite.anchor.x,-this.sprite.anchor.y*s,i,s),this.level.debug&&this.drawCollision()},s.prototype.dispose=function(){},s.prototype.update=function(){},s.prototype.hit=function(){}},{"../../../Common":3,"../../GameObject":20}],53:[function(t,e,i){"use strict";function s(){o.call(this,"obstacle",!0),this.level=null,this.config=null,this.removeWhenOutside=!0,this.speed=0,this.destroyed=!1,this.sprite=null}var n=t("../../../Common"),o=t("../../GameObject");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.init=function(t){null==this.sprite&&(this.sprite=new PIXI.Sprite,this.addChild(this.sprite))},s.prototype.reset=function(){this.level=null,this.config=null},s.prototype.configure=function(t,e){this.level=t,this.config=e,this.gravity=t.avatar.gravity,this.x=this.config.position.x,this.y=this.config.position.y,this.sprite.texture=n.assets.getTexture(this.config.texture),this.sprite.anchor.set(.5),this.sprite.scale.set(1),this.sprite.visible=!0,this.destroyed=!1,this.collidable=!0;var i=.5*this.sprite.width,s=.75*this.sprite.height;this.collisionRect=new PIXI.Rectangle(-i*this.sprite.anchor.x,-s*this.sprite.anchor.y,i,s),this.level.debug&&this.drawCollision()},s.prototype.dispose=function(){},s.prototype.hit=function(){this.collidable&&(this.collidable=!1,n.audio.playSound(["sfx_hit_00","sfx_hit_01"]))},s.prototype.update=function(){}},{"../../../Common":3,"../../GameObject":20}],54:[function(t,e,i){"use strict";function s(){o.call(this,"camera_zoom",!0),this.level=null,this.config=null,this.cameraZoom={zoom:0,time:.4,delay:0}}var n=t("../../../Common"),o=t("../../GameObject");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.init=function(t){null==this.sprite&&(this.sprite=new PIXI.Sprite,this.addChild(this.sprite))},s.prototype.reset=function(){this.level=null,this.config=null},s.prototype.configure=function(t,e){if(this.level=t,this.config=e,this.x=this.config.position.x,this.y=this.config.position.y,this.sprite.texture=n.assets.getTexture(this.config.texture),this.sprite.anchor.set(this.config.anchor.x,this.config.anchor.y),this.sprite.scale.set(this.config.scale.x,this.config.scale.y),this.rotation=this.config.rotation*PIXI.DEG_TO_RAD,""!=this.config.data)try{var i=JSON.parse(this.config.data);this.cameraZoom.zoom=i.zoom?i.zoom:this.cameraZoom.zoom,this.cameraZoom.time=i.time?i.time:this.cameraZoom.time,this.cameraZoom.delay=i.delay?i.delay:this.cameraZoom.delay}catch(s){console.error("Camera zoom object data error %s",this.config.data)}this.collidable=!0,this.sprite.visible=this.level.debug;var o=this.sprite.width,a=this.sprite.height;this.collisionRect=new PIXI.Rectangle(-o*this.sprite.anchor.x,-this.sprite.anchor.y*a,o,a)},s.prototype.dispose=function(){},s.prototype.update=function(){},s.prototype.hit=function(){this.collidable&&(this.collidable=!1,this.level.changeZoom(this.level.defaultZoom+this.cameraZoom.zoom,this.cameraZoom.time,this.cameraZoom.delay))}},{"../../../Common":3,"../../GameObject":20}],55:[function(t,e,i){"use strict";function s(t){o.call(this,"obstacle",!0),this.level=null,this.config=null,this.fallenOffLevel=!0}var n=t("../../../Common"),o=t("../../GameObject");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.init=function(t){null==this.sprite&&(this.sprite=new PIXI.Sprite,this.addChild(this.sprite))},s.prototype.reset=function(){this.level=null,this.config=null},s.prototype.configure=function(t,e){this.level=t,this.config=e,this.x=this.config.position.x,this.y=this.config.position.y,this.sprite.texture=n.assets.getTexture(this.config.texture),this.sprite.anchor.set(this.config.anchor.x,this.config.anchor.y),this.sprite.scale.set(this.config.scale.x,this.config.scale.y),this.rotation=this.config.rotation*PIXI.DEG_TO_RAD,this.collidable=!0,this.sprite.visible=this.level.debug;var i=this.sprite.width,s=this.sprite.height;this.collisionRect=new PIXI.Rectangle(-i*this.sprite.anchor.x,-this.sprite.anchor.y*s,i,s)},s.prototype.dispose=function(){},s.prototype.update=function(){},s.prototype.hit=function(){}},{"../../../Common":3,"../../GameObject":20}],56:[function(t,e,i){"use strict";function s(){o.call(this,"level_bullettime",!0),this.level=null,this.config=null,this.bulletTime={value:.25,inTime:.5,outTime:.5,time:2,delay:0}}var n=t("../../../Common"),o=t("../../GameObject");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.init=function(t){null==this.sprite&&(this.sprite=new PIXI.Sprite,this.addChild(this.sprite))},s.prototype.reset=function(){this.level=null,this.config=null},s.prototype.configure=function(t,e){if(this.level=t,this.config=e,this.x=this.config.position.x,this.y=this.config.position.y,this.sprite.texture=n.assets.getTexture(this.config.texture),this.sprite.anchor.set(this.config.anchor.x,this.config.anchor.y),this.sprite.scale.set(this.config.scale.x,this.config.scale.y),this.rotation=this.config.rotation*PIXI.DEG_TO_RAD,""!=this.config.data)try{var i=JSON.parse(this.config.data);if(this.bulletTime.value=i.value?i.value:this.bulletTime.value,this.bulletTime.lerpTime=i.lerpTime?i.lerpTime:this.bulletTime.lerpTime,this.bulletTime.time=i.time?i.time:this.bulletTime.time,this.bulletTime.delay=i.delay?i.delay:this.bulletTime.delay,this.level.endless){var s=20;this.bulletTime.value=1-this.bulletTime.value*(1-Math.min(1,this.level.endlessPieceCount/s))}}catch(o){console.error("Camera zoom object data error %s",this.config.data)}this.collidable=!0,this.sprite.visible=this.level.debug;var a=this.sprite.width,r=this.sprite.height;this.collisionRect=new PIXI.Rectangle(-a*this.sprite.anchor.x,-this.sprite.anchor.y*r,a,r)},s.prototype.dispose=function(){},s.prototype.update=function(){},s.prototype.hit=function(){this.collidable&&(this.collidable=!1,this.level.bulletTime(this.bulletTime.value,this.bulletTime.time,this.bulletTime.inTime,this.bulletTime.outTime,this.bulletTime.delay))}},{"../../../Common":3,"../../GameObject":20}],57:[function(t,e,i){"use strict";function s(t){o.call(this,"level_end",!0),this.level=null,this.config=null,this.gameOver=!t}var n=t("../../../Common"),o=t("../../GameObject");t("../../Force");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.init=function(t){null==this.sprite&&(this.sprite=new PIXI.Sprite,this.addChild(this.sprite))},s.prototype.reset=function(){this.level=null,this.config=null},s.prototype.configure=function(t,e){this.level=t,this.config=e,this.x=this.config.position.x,this.y=this.config.position.y,this.sprite.texture=n.assets.getTexture(this.config.texture),this.sprite.anchor.set(this.config.anchor.x,this.config.anchor.y),this.sprite.scale.set(this.config.scale.x,this.config.scale.y),this.rotation=this.config.rotation*PIXI.DEG_TO_RAD,this.collidable=!0,this.sprite.visible=this.level.debug;var i=this.sprite.width,s=this.sprite.height;this.collisionRect=new PIXI.Rectangle(-i*this.sprite.anchor.x,-this.sprite.anchor.y*s,i,s)},s.prototype.dispose=function(){},s.prototype.update=function(){},s.prototype.hit=function(){this.collidable&&(this.collidable=!1)}},{"../../../Common":3,"../../Force":19,"../../GameObject":20}],58:[function(t,e,i){function s(t){o.call(this,"roll_lock",!0),this.level=null,this.config=null,this.gameOver=!t}var n=t("../../../Common"),o=t("../../GameObject");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.init=function(t){null==this.sprite&&(this.sprite=new PIXI.Sprite,this.addChild(this.sprite))},s.prototype.reset=function(){this.level=null,this.config=null},s.prototype.configure=function(t,e){this.level=t,this.config=e,this.x=this.config.position.x,this.y=this.config.position.y,this.sprite.texture=n.assets.getTexture(this.config.texture),this.sprite.anchor.set(this.config.anchor.x,this.config.anchor.y),this.sprite.scale.set(this.config.scale.x,this.config.scale.y),this.rotation=this.config.rotation*PIXI.DEG_TO_RAD,this.collidable=!0,this.sprite.visible=this.level.debug;var i=this.sprite.width,s=this.sprite.height;this.collisionRect=new PIXI.Rectangle(-i*this.sprite.anchor.x,-this.sprite.anchor.y*s,i,s)},s.prototype.dispose=function(){},s.prototype.update=function(){},s.prototype.hit=function(){this.collidable&&(this.collidable=!1)}},{"../../../Common":3,"../../GameObject":20}],59:[function(t,e,i){function s(t){o.call(this,"roll_unlock",!0),this.level=null,this.config=null,this.gameOver=!t}var n=t("../../../Common"),o=t("../../GameObject");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.init=function(t){null==this.sprite&&(this.sprite=new PIXI.Sprite,this.addChild(this.sprite))},s.prototype.reset=function(){this.level=null,this.config=null},s.prototype.configure=function(t,e){this.level=t,this.config=e,this.x=this.config.position.x,this.y=this.config.position.y,this.sprite.texture=n.assets.getTexture(this.config.texture),this.sprite.anchor.set(this.config.anchor.x,this.config.anchor.y),this.sprite.scale.set(this.config.scale.x,this.config.scale.y),this.rotation=this.config.rotation*PIXI.DEG_TO_RAD,this.collidable=!0,this.sprite.visible=this.level.debug;var i=this.sprite.width,s=this.sprite.height;this.collisionRect=new PIXI.Rectangle(-i*this.sprite.anchor.x,-this.sprite.anchor.y*s,i,s)},s.prototype.dispose=function(){},s.prototype.update=function(){},s.prototype.hit=function(){this.collidable&&(this.collidable=!1)}},{"../../../Common":3,"../../GameObject":20}],60:[function(t,e,i){function s(){o.call(this,"tutorial",!1),this.level=null,this.config=null,this.text="",this.time=5}var n=t("../../../Common"),o=t("../../GameObject");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.init=function(t){null==this.sprite&&(this.sprite=new PIXI.Sprite,this.addChild(this.sprite))},s.prototype.reset=function(){this.level=null,this.config=null},s.prototype.configure=function(t,e){if(this.level=t,this.config=e,this.x=this.config.position.x,this.y=this.config.position.y,this.sprite.texture=n.assets.getTexture(this.config.texture),this.sprite.anchor.set(this.config.anchor.x,this.config.anchor.y),this.sprite.scale.set(this.config.scale.x,this.config.scale.y),this.rotation=this.config.rotation*PIXI.DEG_TO_RAD,""!=this.config.data)try{var i=JSON.parse(this.config.data);this.text=i.text,void 0!=i.time&&(this.time=i.time)}catch(s){console.error("Tutorial object data error %s",this.config.data)}this.collidable=!0,this.sprite.visible=this.level.debug;var o=this.sprite.width,a=this.sprite.height;this.collisionRect=new PIXI.Rectangle(-o*this.sprite.anchor.x,-this.sprite.anchor.y*a,o,a)},s.prototype.dispose=function(){},s.prototype.update=function(){},s.prototype.hit=function(){if(this.collidable&&(this.collidable=!1,this.text)){var t=n.copy[this.text]?n.copy[this.text][n.language]:this.text;this.level.scene.gameUI.tutorial(t,this.time)}}},{"../../../Common":3,"../../GameObject":20}],61:[function(t,e,i){function s(){this._activeGoalsCount=3,this._activeGoals=null,this._activeGoalsCompleted=null,this._gameScene=null}var n=t("../Common");e.exports=s,s.prototype.init=function(){var t=n.assets.getJSON("config");this.goals=t.goals;for(var e=0;e<this.goals.length;e++)this.goals[e].value>1&&n.copy.goal_labels[this.goals[e].type+"_plural"]?this.goals[e].label=n.copy.goal_labels[this.goals[e].type+"_plural"][n.language].replace("{value}",this.goals[e].value):this.goals[e].label=n.copy.goal_labels[this.goals[e].type][n.language].replace("{value}",this.goals[e].value),this.goals[e].icon=t.goal_icons[this.goals[e].type]},s.prototype.startRun=function(t){this._gameScene=t,this._activeGoals=this.getActiveGoals(),this._activeGoalsCompleted=[],this._events=[]},s.prototype.getGoalById=function(t){for(var e=0;e<this.goals.length;e++)if(this.goals[e].id==t)return this.goals[e]},s.prototype.getGoalStatus=function(t){if(!n.savedData.goals[t])return 0;var e=this.getGoalById(t);return Math.min(1,n.savedData.goals[t]/e.value)},s.prototype.getActiveGoals=function(){for(var t=[],e=0;e<this.goals.length&&t.length<this._activeGoalsCount;e++)this.getGoalStatus(this.goals[e].id)<1&&t.push(this.goals[e]);return t},s.prototype.trackEvent=function(t,e){e=e?e:1,save=!1,this._events[t]?this._events[t]+=e:this._events[t]=e;for(var i=0;i<this._activeGoals.length;i++){var s=this._activeGoals[i];if(n.savedData.goals[s.id]||(n.savedData.goals[s.id]=0),s.type==t){if(n.savedData.goals[s.id]>=s.value)break;n.savedData.goals[s.id]++,n.savedData.goals[s.id]>=s.value&&(console.log("Goal %s completed",s.id),this.goalCompleted(s),save=!0)}else if(s.type==t+"_run"){if(this._events[t]>s.value)break;this._events[t]>n.savedData.goals[s.id]&&(n.savedData.goals[s.id]=this._events[t]),this._events[t]==s.value&&(console.log("Goal %s completed",s.id),this.goalCompleted(s),save=!0)}}save&&n.savedData.save()},s.prototype.getRunCompletedGoalsIds=function(){for(var t=[],e=0;e<this._activeGoalsCompleted.length;e++)t.push(this._activeGoalsCompleted[e].id);return t},s.prototype.goalCompleted=function(t){n.savedData.coins+=t.reward,this._gameScene.gameUI.queueGoal(t.label,t.reward),this._activeGoalsCompleted.push(t);
}},{"../Common":3}],62:[function(t,e,i){"use strict";function s(t,e,i,s,o,a,r,h,l,c){this.texture=t,this.imageScale=e||1,this.xBuffer=i||0,this.yBuffer=s||0,this.boundWidth=o||n.STAGE_WIDTH,this.boundHeight=a||n.STAGE_HEIGHT,this.repeatX=void 0==r||r,this.repeatY=void 0==h||h,this.offsetX=l||0,this.offsetY=c||0,this.id=null,this.textureWidth=null,this.textureHeight=null,this.totalTextureWidth=null,this.totalTextureHeight=null,this.pool=null,this.tilePosition=new PIXI.Point(0,0),PIXI.Container.call(this),this.init()}var n=t("../Common");e.exports=s,s.prototype=Object.create(PIXI.Container.prototype),s.prototype.constructor=s,s.prototype.init=function(){this.pool=[],this.textureWidth=this.texture.orig.width*this.imageScale,this.textureHeight=this.texture.orig.height*this.imageScale,this.totalTextureWidth=this.textureWidth+this.xBuffer,this.totalTextureHeight=this.textureHeight+this.yBuffer;for(var t=this.repeatX?Math.ceil(this.boundWidth/this.totalTextureWidth):1,e=this.repeatY?Math.ceil(this.boundHeight/this.totalTextureHeight):1,i=0;i<t*e;i++){var s=n.displayObjects.createSprite({texture:this.texture,parent:this,scale:this.imageScale});this.addChild(s),this.pool.push(s)}},s.prototype.fill=function(){var t,e,i=this.tilePosition.x+this.offsetX,s=this.tilePosition.y+this.offsetY;this.repeatX?(t=-i%this.totalTextureWidth,t>0&&(t=-(this.totalTextureWidth*Math.ceil(t/this.totalTextureWidth))+t%this.totalTextureWidth)):t=-i+this.xBuffer,this.repeatY?(e=-s%this.totalTextureHeight,e>0&&(e=-(this.totalTextureHeight*Math.ceil(e/this.totalTextureHeight))+e%this.totalTextureHeight)):e=-s+this.yBuffer;var o=t,a=t+this.totalTextureWidth,r=e+this.totalTextureHeight;"bg_statue_0"==this.id&&console.log(t,a),this.repeatX&&(a=this.boundWidth-t),this.repeatY&&(r=this.boundHeight-e);for(var h=-1;e<r;){for(;t<a;){if(h++,h==this.pool.length){var l=n.displayObjects.createSprite({texture:this.texture,parent:this,scale:this.imageScale});this.addChild(l),this.pool.push(l)}this.pool[h].x=t,this.pool[h].y=e,this.pool[h].visible=!0,t+=this.totalTextureWidth}e+=this.totalTextureHeight,t=o}for(var c=h+1;c<this.pool.length;c++)this.pool[c].visible=!1},Object.defineProperty(s.prototype,"tileX",{set:function(t){return this.tilePosition.x=t,this.tilePosition.x},get:function(t){return this.tilePosition.x}}),Object.defineProperty(s.prototype,"tileY",{set:function(t){return this.tilePosition.y=t,this.tilePosition.y},get:function(t){return this.tilePosition.y}})},{"../Common":3}],63:[function(t,e,i){(function(e){"use strict";var i=t("./Main");e.Main=i}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./Main":4}],64:[function(t,e,i){function s(t){this._gameName=t}t("../Common");e.exports=s,s.prototype.track=function(t,e){return console.info('[Stats] Tracking "%s".',t,e),"undefined"==typeof Uatu?void console.error("[Stats] Library Uatu not found"):void(t&&(e||(e={}),e.game_name=this._gameName,Uatu.warn(t,e)))}},{"../Common":3}],65:[function(t,e,i){function s(){this.SAVE_NAME="avengers",this.SAVE_VERSION="0.1.0",this.SAVE_SEED="y5k0Eo6R177mUkb",this.character=n.config.playableCharacters[0],this.charactersUnlocked=[this.character],this.charactersAbilities={},this.levelDebug=!1,this.levelIndex=0,this.levelsScore={},this.levelsUnlocked=0,this.collectibles={},this.coins=0,this.goals={},this.dailyBonusDate=null,this.endlessRecord=0,this.endless=!1,this.tutorial=!1,this.unlockedLevelAnimation=!1,this.unlockedCharacterAnimation=!1,this.showAllLevelsDoneScene=!1,this.showAllCollectiblesScene=!1,this.lastGame={hasWon:null,coins:0,style:0,score:0,distance:0,endless:!1}}var n=t("../Common");e.exports=s,s.prototype.init=function(){window.localStorage[this.SAVE_NAME+"_"+this.SAVE_VERSION]?this.load():(this.reset(),this.save())},s.prototype.reset=function(){console.log("[Saved data] Reset")},s.prototype.load=function(){console.log("[Saved data] Load");var t=window.localStorage[this.SAVE_NAME+"_"+this.SAVE_VERSION];t=JSON.parse(t),this.character=t.character,this.charactersUnlocked=t.charactersUnlocked,this.charactersAbilities=t.charactersAbilities,this.levelDebug=t.levelDebug,this.levelIndex=t.levelIndex,this.levelsScore=t.levelsScore,this.levelsUnlocked=t.levelsUnlocked,this.collectibles=t.collectibles,this.coins=t.coins,this.goals=t.goals,this.dailyBonusDate=t.dailyBonusDate,this.endlessRecord=t.endlessRecord,this.unlockedLevelAnimation=t.unlockedLevelAnimation,this.unlockedCharacterAnimation=t.unlockedCharacterAnimation,this.tutorial=t.tutorial,this.showAllLevelsDoneScene=t.showAllLevelsDoneScene,this.showAllCollectiblesScene=t.showAllCollectiblesScene},s.prototype.save=function(){console.log("[Saved data] Save");var t={coins:this.coins,character:this.character,charactersUnlocked:this.charactersUnlocked,charactersAbilities:this.charactersAbilities,levelDebug:this.levelDebug,levelIndex:this.levelIndex,levelsScore:this.levelsScore,levelsUnlocked:this.levelsUnlocked,collectibles:this.collectibles,goals:this.goals,dailyBonusDate:this.dailyBonusDate,endlessRecord:this.endlessRecord,unlockedLevelAnimation:this.unlockedLevelAnimation,unlockedCharacterAnimation:this.unlockedCharacterAnimation,tutorial:this.tutorial,showAllLevelsDoneScene:this.showAllLevelsDoneScene,showAllCollectiblesScene:this.showAllCollectiblesScene};window.localStorage[this.SAVE_NAME+"_"+this.SAVE_VERSION]=JSON.stringify(t)},s.prototype.getCoins=function(){return this.coins},s.prototype.addCoins=function(t){this.coins+=t},s.prototype.saveLastGame=function(t){console.info("Saving last game",t),this.lastGame=t,this.lastGame.endless?(this.submitEndlessDistance(this.lastGame.distance),this.addCoins(this.lastGame.coins)):(this.lastGame.score=0,this.lastGame.score+=this.lastGame.distance*n.config.score.distance,this.lastGame.score+=this.lastGame.coins*n.config.score.coins,this.lastGame.score+=this.lastGame.style,this.submitLevelScore(this.lastGame.levelIndex,this.lastGame.score),this.addCoins(this.lastGame.coins),this.lastGame.hasWon&&this.lastGame.levelIndex==this.levelsUnlocked&&this.lastGame.levelIndex<n.config.data.levels&&(this.levelsUnlocked++,this.unlockedLevelAnimation=!0),this.lastGame.hasWon&&this.unlockCharacter(this.lastGame.levelIndex+1),this.lastGame.hasWon||n.stats.track("game_failure",{game_level:this.lastGame.levelIndex+1})),this.save()},s.prototype.getLastGameHighscore=function(){return this.lastGame.endless?this.endlessRecord:this.getLevelHisghscore(this.lastGame.levelIndex)},s.prototype.submitLevelScore=function(t,e){return"undefined"==typeof this.levelsScore[t]&&(this.levelsScore[t]=0),this.levelsScore[t]<e&&(this.levelsScore[t]=e,!0)},s.prototype.getLevelHisghscore=function(t){return"undefined"==typeof this.levelsScore[t]?0:this.levelsScore[t]},s.prototype.submitEndlessDistance=function(t){return t>this.endlessRecord&&(this.endlessRecord=t,!0)},s.prototype.canAwardDailyBonus=function(){null==this.dailyBonusDate&&this.awardDailyBonus(0);var t=new Date;return null!=this.dailyBonusDate&&this.dailyBonusDate!=t.getFullYear()+"_"+(t.getMonth()+1)+"_"+t.getDate()},s.prototype.awardDailyBonus=function(t){this.addCoins(t);var e=new Date;this.dailyBonusDate=e.getFullYear()+"_"+(e.getMonth()+1)+"_"+e.getDate(),this.save()},s.prototype.getCollectiblesCollectedPercentage=function(){for(var t=0,e=0;e<n.config.data.levels;e++)t+=this.getLevelCollectiblesCollectedPercentage(e);return t/=n.config.data.levels},s.prototype.getLevelCollectiblesCollected=function(t){if(!this.collectibles[t])return 0;for(var e=0,i=0;i<n.config.data.collectibles;i++)this.collectibles[t][i]&&e++;return e},s.prototype.getLevelCollectiblesCollectedPercentage=function(t){return this.getLevelCollectiblesCollected(t)/n.config.data.collectibles},s.prototype.isCollectibleCollected=function(t,e){if(this.collectibles[t])return!!this.collectibles[t][e]},s.prototype.collectibleCollected=function(t,e){if(!(t<0||t>=n.config.data.levels||e<0||e>=n.config.data.collectibles)){if(!this.collectibles[t]){this.collectibles[t]=[];for(var i=0;i<n.config.data.collectibles;i++)this.collectibles[t][i]=!1}this.collectibles[t][e]=!0,this.save()}},s.prototype.getUnlockedCharacters=function(){return n.config.cheats.unlockAllCharacters?n.config.playableCharacters:this.charactersUnlocked},s.prototype.getCharacterData=function(t){var t=t||this.character,e=n.config.characters[t];return e.name=this.getCharaceterName(t),e},s.prototype.isCharacterUnlocked=function(t){return!!n.config.cheats.unlockAllCharacters||(t||(t=n.savedData.character),this.charactersUnlocked.indexOf(t)!=-1)},s.prototype.changeCharacter=function(t){if(0!=t){var e=n.config.playableCharacters.indexOf(this.character);e==-1&&(e=0);for(var i=1;i<n.config.playableCharacters.length;i++){var s=e+i*Math.sign(t);return s<0&&(s+=n.config.playableCharacters.length),s>=n.config.playableCharacters.length&&(s-=n.config.playableCharacters.length),this.character=n.config.playableCharacters[s],this.save(),this.character}return this.character}},s.prototype.unlockCharacter=function(t){for(var e=0;e<n.config.playableCharacters.length;e++){var i=n.config.playableCharacters[e],s=this.getCharacterData(i);if(s.level==t)return this.isCharacterUnlocked(s.id)||(this.charactersUnlocked.push(s.id),this.unlockedCharacterAnimation=s.id),void this.save()}},s.prototype.getCharaceterName=function(t){return n.copy.characters[t].name[n.language].toUpperCase()},s.prototype.getCharacterSkillLevel=function(t,e){var e=e||this.character;return this.charactersAbilities[e]&&this.charactersAbilities[e][t]?this.charactersAbilities[e][t]:0},s.prototype.getSkillData=function(t){for(var e=0;e<n.config.skills.length;e++)if(n.config.skills[e].id==t)return n.config.skills[e];return null},s.prototype.getNextSkillLevelCost=function(t,e){var i=this.getSkillData(t);if(!i)return 0;var s=this.getCharacterSkillLevel(t,e);return i.cost[s]},s.prototype.buySkill=function(t,e){var i=this.getSkillData(t);if(!i)return!1;var e=e||this.character,s=this.getCharacterSkillLevel(t,e),n=i.cost[s];return!(this.coins<n)&&(this.coins-=n,this.charactersAbilities[e]||(this.charactersAbilities[e]={}),this.charactersAbilities[e][t]=s+1,void this.save())}},{"../Common":3}],66:[function(t,e,i){function s(){o.call(this),this._parallaxItems=[],this.signals.skillUpgrade=new signals.Signal,this.signals.showUnlockedCharacter=new signals.Signal}var n=t("../Common"),o=t("./SimpleScene"),a=(t("../ui/MapButton"),t("../ui/MenuPanel")),r=t("../game/effects/EffectSplashDust");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.init=function(){o.prototype.init.call(this),this._container=new PIXI.Container,this._container.x=n.STAGE_WIDTH/2,this._container.y=n.STAGE_HEIGHT/2,this.addChild(this._container),this._bg=new PIXI.Sprite(n.assets.getTexture("splash_bg")),this._bg.x=n.STAGE_WIDTH/2,this._bg.y=n.STAGE_HEIGHT/2,this._bg.interactive=!0,this._bg.anchor.set(.5),this.addChild(this._bg),this.spine=new PIXI.spine.Spine(Spine.rays),this.spine.skeleton.setToSetupPose(),this.spine.skeleton.setSkin(null),this.spine.skeleton.setSkinByName("default"),this.spine.x=n.STAGE_WIDTH/2,this.spine.y=n.STAGE_HEIGHT/2+120,this.spine.autoUpdate=!0,this.spine.update(0),this.spine.state.setAnimation(0,"default",!0,1),this.spine.state.timeScale=.33,this.addChild(this.spine),this._mg=new PIXI.Sprite(n.assets.getTexture("ui_splash_mg")),this._mg.anchor.set(.5,1),this._mg.x=n.STAGE_WIDTH/2+300,this._mg.y=n.STAGE_HEIGHT,this.addChild(this._mg),this.addParallaxItem(this._mg,.01),this._smoke=new PIXI.Container,this._smoke.x=n.STAGE_WIDTH/2+400,this._smoke.y=n.STAGE_HEIGHT,this.addChild(this._smoke),this._smokePS=new r(this._smoke),this._panel=new a,this._panel.x=-450,this._panel.initCharacterPanel(300),this.addChild(this._panel),this.addParallaxItem(this._panel,.02),this.addBackButton(),this.addMuteButton(),this.addHelpButton(),this.addCoinCounter(),this._playButton=this.addNextButton(),this._playButton.visible=n.savedData.isCharacterUnlocked();var t=new p3.ButtonStates(n.assets.getTexture("btns/ui_btn_side_out_left"),n.assets.getTexture("btns/ui_btn_side_over_left"),n.assets.getTexture("btns/ui_btn_side_down_left"),n.assets.getTexture("btns/ui_icon_prev_big_left"));this._prevButton=new p3.Button(t),this._prevButton.animate=!1,this._prevButton.children[1].x-=10,this._prevButton.y=n.STAGE_HEIGHT/2,this._prevButton.signals.down.add(this.onPrevButtonClick,this),this._prevButton.signals.down.add(this.onPrevButtonClick,this),this.addChild(this._prevButton),this._prevButton.signals.down.add(function(){n.audio.playSound("sfx_btn_click_00")},this),this._prevButton.signals.over.add(function(){n.audio.playSound("sfx_btn_rollover_00")},this);var t=new p3.ButtonStates(n.assets.getTexture("btns/ui_btn_side_out_right"),n.assets.getTexture("btns/ui_btn_side_over_right"),n.assets.getTexture("btns/ui_btn_side_down_right"),n.assets.getTexture("btns/ui_icon_prev_big_right"));if(this._nextButton=new p3.Button(t),this._nextButton.animate=!1,this._nextButton.children[1].x+=10,this._nextButton.y=n.STAGE_HEIGHT/2,this._nextButton.signals.down.add(this.onNextButtonClick,this),this._nextButton.signals.down.add(this.onNextButtonClick,this),this.addChild(this._nextButton),this._nextButton.signals.down.add(function(){n.audio.playSound("sfx_btn_click_00")},this),this._nextButton.signals.over.add(function(){n.audio.playSound("sfx_btn_rollover_00")},this),n.savedData.getUnlockedCharacters().length>1){this._prevButton.glow=new PIXI.Sprite(n.assets.getTexture("btns/ui_btn_side_glow_left")),this._prevButton.glow.anchor.set(.5),this._prevButton.glow.x+=5,this._prevButton.glow.blendMode=1,this._prevButton.addChildAt(this._prevButton.glow,0),this._nextButton.glow=new PIXI.Sprite(n.assets.getTexture("btns/ui_btn_side_glow_right")),this._nextButton.glow.anchor.set(.5),this._nextButton.glow.x-=5,this._nextButton.glow.blendMode=1,this._nextButton.addChildAt(this._nextButton.glow,0);var e=this.createTimeline();e.to(this._nextButton.glow,.5,{alpha:.2,yoyo:!0,repeat:-1},0),e.to(this._prevButton.glow,.5,{alpha:.2,yoyo:!0,repeat:-1},0)}this.onMouseMove(),n.savedData.unlockedCharacterAnimation&&this.delay(.5,function(){this.signals.showUnlockedCharacter.dispatch(n.savedData.unlockedCharacterAnimation),n.savedData.unlockedCharacterAnimation=!1,n.savedData.save()},null,this)},s.prototype.show=function(){this._bg.on("mousemove",this.onMouseMove.bind(this))},s.prototype.appear=function(){this._bg.on("mousemove",this.onMouseMove.bind(this))},s.prototype.hide=function(){this._bg.off("mousemove")},s.prototype.destroy=function(){this._bg.off("mousemove"),this._smokePS.destroy(),o.prototype.destroy.call(this)},s.prototype.update=function(){o.prototype.update.call(this)},s.prototype.resize=function(){o.prototype.resize.call(this),this._prevButton&&(this._prevButton.x=this._leftEdge+58),this._nextButton&&(this._nextButton.x=this._rightEdge-58)},s.prototype.dispose=function(){},s.prototype.animateIn=function(t,e){o.prototype.animateIn.call(this),t&&t.call(e)},s.prototype.animateOut=function(t,e){o.prototype.animateOut.call(this),t&&t.call(e)},s.prototype.buySkill=function(t){n.savedData.buySkill(t),this._panel.changeCharacter(0)},s.prototype.addParallaxItem=function(t,e){t.parallax=e,this._parallaxItems.push(t)},s.prototype.onNextButtonClicked=function(){n.savedData.isCharacterUnlocked()&&this.signals.next.dispatch()},s.prototype.onPrevButtonClick=function(){this._panel.changeCharacter(-1),this._playButton.visible=n.savedData.isCharacterUnlocked()},s.prototype.onNextButtonClick=function(){this._panel.changeCharacter(1),this._playButton.visible=n.savedData.isCharacterUnlocked()},s.prototype.onMouseMove=function(t){for(var e=t?t.data.getLocalPosition(this).x:n.STAGE_WIDTH/2,i=-(e-n.STAGE_WIDTH/2),s=0;s<this._parallaxItems.length;s++)this._parallaxItems[s].orX||(this._parallaxItems[s].orX=this._parallaxItems[s].x),this._parallaxItems[s].destX=this._parallaxItems[s].orX+i*this._parallaxItems[s].parallax;this._panel.applyParallax(i,.02)}},{"../Common":3,"../game/effects/EffectSplashDust":33,"../ui/MapButton":83,"../ui/MenuPanel":84,"./SimpleScene":77}],67:[function(t,e,i){function s(t){this._characterId=t||n.savedData.character,this._characterData=n.savedData.getCharacterData(this._characterId),o.call(this)}var n=t("../Common"),o=t("./SimpleScene"),a=t("../ui/MenuPanel");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.init=function(){o.prototype.init.call(this),this._bg=new PIXI.Sprite(n.assets.getTexture("ui_map_bg_0.5x")),this._bg.anchor.set(.5),this._bg.scale.set(2),this._bg.interactive=!0,this._bg.x=n.STAGE_WIDTH/2,this._bg.y=n.STAGE_HEIGHT/2,this.addChild(this._bg);var t=new PIXI.Sprite(n.assets.getTexture("ui_map_red_overlay_0.1x"));t.anchor.set(.5),t.scale.set(10),this._bg.addChild(t);var e=n.assets.getTexture("ui_map_grid_tile"),i=new PIXI.extras.TilingSprite(e,this._bg.width,n.STAGE_HEIGHT);i.anchor.set(.5),i.alpha=.5,this._bg.addChild(i),this._leftPanel=new a,this._leftPanel.x=-1230,this.addChild(this._leftPanel),this._rightPanel=new a,this._rightPanel.x=1230,this.addChild(this._rightPanel),this._container=new PIXI.Container,this._container.x=n.STAGE_WIDTH/2,this._container.y=n.STAGE_HEIGHT/2,this.addChild(this._container),this._rays=new PIXI.Container,this._rays.position.set(-50,50),this._container.addChild(this._rays);var s=new PIXI.Sprite(n.assets.getTexture("ui_rays"));s.anchor.set(.5),s.scale.set(4),s.tint=16711680,this._rays.addChild(s);var r=new PIXI.Sprite(n.assets.getTexture("ui_rays"));r.anchor.set(.5),r.scale.set(4),r.tint=16711680,this._rays.addChild(r);var h=this.createTimeline();h.to(s,7,{rotation:2*-Math.PI,repeat:-1,ease:Linear.easeNone},0),h.to(r,11,{rotation:2*+Math.PI,repeat:-1,ease:Linear.easeNone},0),this._title=n.createText("GOOD_JOB",{bitmapFont:n.bitmapFontTitle,size:80}),this._title.x=-100,this._title.y=-180,this._container.addChild(this._title),this._messageBox=new PIXI.Sprite(n.assets.getTexture("ui_results_panel_bg")),this._messageBox.anchor.set(.5),this._messageBox.x=-50,this._messageBox.y=100,this._container.addChild(this._messageBox),this._messageBox.description=n.createText("UNLOCKED_CHARACTER",{size:60}),this._messageBox.description.text=this._messageBox.description.text.replace("{NAME}",this._characterData.name),this._messageBox.description.x=-80,this._messageBox.description.y=-28,this._messageBox.addChild(this._messageBox.description),this._character=new PIXI.Sprite(n.assets.getTexture("ui_char_sel_"+this._characterId)),this._character.anchor.set(.5,1),this._character.position.set(200,n.STAGE_HEIGHT/2),this._character.parallax=.04,this._container.addChild(this._character),"falcon"==this._characterId&&(this._character.rotation-=15*PIXI.DEG_TO_RAD,this._character.x+=30,this._character.y+=30),this.delay(3,function(){this.animateOut(function(){this.signals.previous.dispatch()},this)},[],this)},s.prototype.update=function(){},s.prototype.resize=function(){o.prototype.resize.call(this)},s.prototype.dispose=function(){},s.prototype.animateIn=function(t,e){o.prototype.animateIn.call(this);var i=this.createTimeline({onCompleteScope:e,onComplete:t});i.from(this._bg,.5,{alpha:0,ease:Sine.easeInOut},0);var s=this._messageBox.x;i.fromTo(this._messageBox,.25,{x:s-450},{x:s-50,ease:Linear.easeNone},.1),i.to(this._messageBox,.5,{x:s,ease:Back.easeOut},.35),i.from(this._messageBox,.35,{alpha:0,ease:Sine.easeOut},.1);var s=this._character.x;i.fromTo(this._character,.25,{x:s+450},{x:s+50,ease:Linear.easeNone},0),i.to(this._character,.5,{x:s,ease:Back.easeOut},.25),i.from(this._character,.35,{alpha:0,ease:Sine.easeOut},0),i.from(this._title.scale,.75,{x:0,y:0,ease:Back.easeOut},0),i.from(this._rays.scale,1,{x:0,y:0,ease:Back.easeOut},.25),i.from(this._leftPanel,.65,{x:this._leftPanel.x-500,ease:Back.easeOut},0),i.from(this._rightPanel,.65,{x:this._rightPanel.x+500,ease:Back.easeOut},0)},s.prototype.animateOut=function(t,e){o.prototype.animateOut.call(this);var i=this.createTimeline({onCompleteScope:e,onComplete:t});i.to(this,.25,{alpha:0,ease:Sine.easeIn},0)},s.prototype.onPrevButtonClick=function(){this.animateOut(function(){this.signals.next.dispatch()},this)}},{"../Common":3,"../ui/MenuPanel":84,"./SimpleScene":77}],68:[function(t,e,i){function s(t){switch(this._what=t,this._characterId=n.savedData.character,this._characterData=n.savedData.getCharacterData(this._characterId),t){case"collectibles":this._title="COMPLETIONIST_TITLE",this._description="COMPLETIONIST_DESCRIPTION";break;default:this._title="ENDGAME_TITLE",this._description="ENDGAME_DESCRIPTION"}o.call(this)}var n=t("../Common"),o=t("./SimpleScene"),a=t("../ui/MenuPanel");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.init=function(){o.prototype.init.call(this),this._bg=new PIXI.Sprite(n.assets.getTexture("ui_map_bg_0.5x")),this._bg.anchor.set(.5),this._bg.scale.set(2),this._bg.interactive=!0,this._bg.x=n.STAGE_WIDTH/2,this._bg.y=n.STAGE_HEIGHT/2,this.addChild(this._bg);var t=new PIXI.Sprite(n.assets.getTexture("ui_map_red_overlay_0.1x"));t.anchor.set(.5),t.scale.set(10),this._bg.addChild(t);var e=n.assets.getTexture("ui_map_grid_tile"),i=new PIXI.extras.TilingSprite(e,this._bg.width,n.STAGE_HEIGHT);i.anchor.set(.5),i.alpha=.5,this._bg.addChild(i),this._leftPanel=new a,this._leftPanel.x=-1230,this.addChild(this._leftPanel),this._rightPanel=new a,this._rightPanel.x=1230,this.addChild(this._rightPanel),this._container=new PIXI.Container,this._container.x=n.STAGE_WIDTH/2,this._container.y=n.STAGE_HEIGHT/2,this.addChild(this._container),this._rays=new PIXI.Container,this._rays.position.set(-50,50),this._container.addChild(this._rays);var s=new PIXI.Sprite(n.assets.getTexture("ui_rays"));s.anchor.set(.5),s.scale.set(4),s.tint=16711680,this._rays.addChild(s);var r=new PIXI.Sprite(n.assets.getTexture("ui_rays"));r.anchor.set(.5),r.scale.set(4),r.tint=16711680,this._rays.addChild(r);var h=this.createTimeline();h.to(s,7,{rotation:2*-Math.PI,repeat:-1,ease:Linear.easeNone},0),h.to(r,11,{rotation:2*+Math.PI,repeat:-1,ease:Linear.easeNone},0),this._title=n.createText(this._title,{bitmapFont:n.bitmapFontTitle,size:80}),this._title.x=-100,this._title.y=-180,this._container.addChild(this._title),this._messageBox=new PIXI.Sprite(n.assets.getTexture("ui_results_panel_bg")),this._messageBox.anchor.set(.5),this._messageBox.x=-50,this._messageBox.y=100,this._container.addChild(this._messageBox),this._messageBox.description=n.createText(this._description,{size:50}),this._messageBox.description.x=-80,this._messageBox.description.y=-28,this._messageBox.addChild(this._messageBox.description),this._character=new PIXI.Sprite(n.assets.getTexture("ui_char_sel_"+n.savedData.character)),this._character.anchor.set(.5,1),this._character.position.set(200,n.STAGE_HEIGHT/2),this._character.parallax=.04,this._container.addChild(this._character),"falcon"==n.savedData.character&&(this._character.rotation-=15*PIXI.DEG_TO_RAD,this._character.x+=30,this._character.y+=30),this.addNextButton()},s.prototype.update=function(){},s.prototype.resize=function(){o.prototype.resize.call(this)},s.prototype.dispose=function(){},s.prototype.animateIn=function(t,e){o.prototype.animateIn.call(this);var i=this.createTimeline({onCompleteScope:e,onComplete:t});i.from(this._bg,.5,{alpha:0,ease:Sine.easeInOut},0);var s=this._messageBox.x;i.fromTo(this._messageBox,.25,{x:s-450},{x:s-50,ease:Linear.easeNone},.1),i.to(this._messageBox,.5,{x:s,ease:Back.easeOut},.35),i.from(this._messageBox,.35,{alpha:0,ease:Sine.easeOut},.1);var s=this._character.x;i.fromTo(this._character,.25,{x:s+450},{x:s+50,ease:Linear.easeNone},0),i.to(this._character,.5,{x:s,ease:Back.easeOut},.25),i.from(this._character,.35,{alpha:0,ease:Sine.easeOut},0),i.from(this._title.scale,.75,{x:0,y:0,ease:Back.easeOut},0),i.from(this._rays.scale,1,{x:0,y:0,ease:Back.easeOut},.25),i.from(this._leftPanel,.65,{x:this._leftPanel.x-500,ease:Back.easeOut},0),i.from(this._rightPanel,.65,{x:this._rightPanel.x+500,ease:Back.easeOut},0)},s.prototype.animateOut=function(t,e){o.prototype.animateOut.call(this);var i=this.createTimeline({onCompleteScope:e,onComplete:t});i.to(this,.25,{alpha:0,ease:Sine.easeIn},0)},s.prototype.onNextButtonClicked=function(){this.animateOut(function(){this.signals.next.dispatch()},this)}},{"../Common":3,"../ui/MenuPanel":84,"./SimpleScene":77}],69:[function(t,e,i){"use strict";function s(){o.call(this)}var n=t("../Common"),o=t("./SimpleScene"),a=t("../ui/MenuPanel"),r=t("../ui/RotatingToken");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.init=function(){o.prototype.init.call(this),this._container=new PIXI.Container,this._container.x=n.STAGE_WIDTH/2,this._container.y=n.STAGE_HEIGHT/2,this.addChild(this._container),this._bg=new PIXI.Sprite(PIXI.Texture.WHITE),this._bg.anchor.set(.5),this._bg.width=1920,this._bg.height=768,this._bg.tint=728641,this._container.addChild(this._bg);var t=new PIXI.Sprite(n.assets.getTexture("ui_map_red_overlay_0.1x"));t.anchor.set(.5),t.scale.set(10),this._container.addChild(t);var e=n.assets.getTexture("ui_map_grid_tile");this._grid=new PIXI.extras.TilingSprite(e,this._bg.width,n.STAGE_HEIGHT),this._grid.anchor.set(.5),this._grid.alpha=.5,this._container.addChild(this._grid),this._title=new PIXI.Container,this._title.y=-300,this._container.addChild(this._title);var i=new PIXI.Sprite(n.assets.getTexture("ui_title_frame"));i.anchor.set(.5,.45),this._title.addChild(i),this._title.addChild(n.createText("DAILY_BONUS",{bitmapFont:n.bitmapFontTitle}));var s=p3.Utils.shuffleArray(n.config.dailyBonus.splice(0));this._tokens=[],this._tokenContainer=new PIXI.Container,this._container.addChild(this._tokenContainer);for(var h=[[-250,-80],[0,-120],[250,-80],[-120,100],[120,100]],l=0;l<h.length;l++){var c=new r(s[l]);c.x=h[l][0],c.y=h[l][1],this._tokenContainer.addChild(c),this._tokens.push(c),c.on("mousedown",this.onCoinClicked.bind(this)),c.on("touchend",this.onCoinClicked.bind(this))}this._description=new PIXI.Sprite(n.assets.getTexture("ui_text_panel")),this._description.anchor.set(.5,.45),this._description.y=280,this._container.addChild(this._description),this._description.label=n.createText("DAILY_BONUS_DESC",{size:30}),this._description.addChild(this._description.label),this._leftPanel=new a,this._leftPanel.x=-1210,this.addChild(this._leftPanel),this._rightPanel=new a,this._rightPanel.x=1210,this.addChild(this._rightPanel),this.addCoinCounter(),this._continueButton=this.addNextButton(),this._continueButton.scale.set(0),this._messageBox=new PIXI.Sprite(n.assets.getTexture("ui_panel")),this._messageBox.anchor.set(.5),this._messageBox.x=0,this._messageBox.y=30,this._messageBox.scale.set(0),this._container.addChild(this._messageBox);var p=new PIXI.Sprite(PIXI.Texture.WHITE);p.anchor.set(.5),p.width=662,p.height=440,this._messageBox.addChild(p);var d=new PIXI.Sprite(n.assets.getTexture("ui_rays"));d.anchor.set(.5),d.scale.set(4),d.tint=16711680,d.mask=p,this._messageBox.addChild(d);var u=new PIXI.Sprite(n.assets.getTexture("ui_rays"));u.anchor.set(.5),u.scale.set(4),u.tint=16711680,u.mask=p,this._messageBox.addChild(u);var _=this.createTimeline();_.to(d,7,{rotation:2*-Math.PI,repeat:-1,ease:Linear.easeNone},0),_.to(u,11,{rotation:2*+Math.PI,repeat:-1,ease:Linear.easeNone},0);var c=new PIXI.Sprite(n.assets.getTexture("btns/token_05"));c.anchor.set(.5),c.scale.set(1),c.x=-115,this._messageBox.addChild(c),this._messageBox.amount=n.createText("1000",{size:100}),this._messageBox.amount.x=-c.x,this._messageBox.amount.y=-20,this._messageBox.addChild(this._messageBox.amount);var g=new p3.ButtonStates(n.assets.getTexture("btns/ui_btn_blue_out"),n.assets.getTexture("btns/ui_btn_blue_over"),n.assets.getTexture("btns/ui_btn_blue_down"),n.assets.getTexture("btns/ui_icon_cross"));this._closeButton=new p3.Button(g),this._closeButton.x=340,this._closeButton.y=-230,this._closeButton.signals.down.addOnce(this.onCloseClick,this),this._messageBox.addChild(this._closeButton);var m=new PIXI.Sprite(n.assets.getTexture("ui_text_panel"));m.anchor.set(.5,.45),m.y=240,this._messageBox.addChild(m),this._messageBox.label=n.createText("PLACEHOLDER",{size:30}),m.addChild(this._messageBox.label)},s.prototype.appear=function(t,e){o.prototype.animateIn.call(this),t&&t.call(e),this._coinIntroTimeline=this.createTimeline({onCompleteScope:this,onComplete:function(){this._coinIntroTimeline=null}});for(var i=0;i<this._tokens.length;i++){var s=1,n=.15*i;this._coinIntroTimeline.from(this._tokens[i],s,{y:this._tokens[i].y-700,ease:Bounce.easeOut,onStartScope:this,onStartParams:[this._tokens[i]],onStart:function(t){t.spin(p3.Utils.randomRange(270,270)*(2*p3.Utils.randomInt(0,1)-1))}},n),this._coinIntroTimeline.from(this._tokens[i],.1*s,{alpha:0,ease:Linear.easeNone},n)}},s.prototype.hide=function(){},s.prototype.destroy=function(t){o.prototype.destroy.call(this,t)},s.prototype.update=function(){o.prototype.update.call(this);for(var t=0;t<this._tokens.length;t++)this._tokens[t].update()},s.prototype.resize=function(){o.prototype.resize.call(this)},s.prototype.animateOut=function(t,e){o.prototype.animateOut.call(this),t&&t.call(e)},s.prototype.onCoinClicked=function(t){if(!this._coinIntroTimeline){var e=t.currentTarget.bonus;n.savedData.awardDailyBonus(e),this._coinOutroTimeline=this.createTimeline();for(var i=0;i<this._tokens.length;i++){var s=1.25,o=.2*Math.random(),a=this._tokens[i];a.stopSpin(),a.showValue(.35),a.interactive=!1,a!=t.currentTarget?(this._coinOutroTimeline.to(a.scale,s,{x:.5,y:.5,ease:Sine.easeIn},o),this._coinOutroTimeline.to(a,s,{y:a.y+600,alpha:0,ease:Sine.easeIn},o)):(this._coinOutroTimeline.to(a.scale,s,{x:1.5,y:1.5,ease:Sine.easeInOut},o),this._coinOutroTimeline.to(a,s,{x:0,y:0,ease:Sine.easeInOut},o))}this._coinOutroTimeline.to(this._description,.5,{alpha:0,ease:Sine.easeInOut,onCompleteScope:this,onComplete:function(){this._messageBox.label.text=n.copy.REWARD_MESSAGE[n.language].replace("{value}",e).toUpperCase(),this._messageBox.amount.text=e}},0),this._coinOutroTimeline.to(this._messageBox.scale,.5,{x:1,y:1,ease:Back.easeOut},1.75)}},s.prototype.onCloseClick=function(t){this.signals.next.dispatch()}},{"../Common":3,"../ui/MenuPanel":84,"../ui/RotatingToken":86,"./SimpleScene":77}],70:[function(t,e,i){function s(){o.call(this),this.id="EditorScene"}var n=t("../Common"),o=t("./SimpleScene"),a=t("../editor/Editor");e.exports=s,s.prototype=Object.create(p3.Scene.prototype),s.prototype.constructor=s,s.prototype.init=function(){console.log("EDITOR INITIALIZED"),this.interactiveArea=new PIXI.Sprite(PIXI.Texture.WHITE),this.interactiveArea.alpha=0,this.interactiveArea.tint=16711680,this.interactiveArea.interactive=!0,this.addChild(this.interactiveArea),this.mouse={position:new PIXI.Point(0,0),lastPosition:new PIXI.Point(0,0),movement:new PIXI.Point(0,0),leftPressed:!1,leftJustPressed:!1,centerPressed:!1,rightPressed:!1,rightJustPressed:!1,update:function(){this.leftJustPressed=!1,this.rightJustPressed=!1,this.movement.x=this.position.x-this.lastPosition.x,this.movement.y=this.position.y-this.lastPosition.y,this.lastPosition.x=this.position.x,this.lastPosition.y=this.position.y}},this.interactiveArea.mousedown=function(t){switch(t.data.originalEvent.which){case 1:this.mouse.leftPressed=!0,this.mouse.leftJustPressed=!0;break;case 2:this.mouse.centerPressed=!0}}.bind(this),this.interactiveArea.mouseup=this.interactiveArea.mouseupoutside=function(t){switch(t.data.originalEvent.which){case 1:this.mouse.leftPressed=!1;break;case 2:this.mouse.centerPressed=!1}}.bind(this),this.interactiveArea.rightdown=function(t){this.mouse.rightPressed=!0,this.mouse.rightJustPressed=!0}.bind(this),this.interactiveArea.rightup=this.interactiveArea.rightupoutside=function(t){this.mouse.rightPressed=!1}.bind(this),this.interactiveArea.mousemove=function(t){this.mouse.position.x=t.data.getLocalPosition(this).x,this.mouse.position.y=t.data.getLocalPosition(this).y}.bind(this),this.editor=new a,this.editor.mouse=this.mouse,this.editor.init(),this.addChild(this.editor),
p3.Scene.prototype.init.call(this),n.view.signals.resize.add(this.onCanvasResize,this),this.onCanvasResize()},s.prototype.update=function(){this.editor.update(),this.mouse.update()},s.prototype.onCanvasResize=function(){this.interactiveArea.width=window.innerWidth,this.interactiveArea.height=window.innerHeight},s.prototype.dispose=function(){},s.prototype.animateIn=function(t,e){p3.Scene.prototype.animateIn.call(this)},s.prototype.animateOut=function(t,e){p3.Scene.prototype.animateOut.call(this)}},{"../Common":3,"../editor/Editor":14,"./SimpleScene":77}],71:[function(t,e,i){"use strict";function s(){o.call(this),this._parallaxItems=[],this.signals.home=new signals.Signal,this.signals.restart=new signals.Signal,this.signals.showCongratulations=new signals.Signal,n.audio.playMusic("music_menu_map_loop",{loop:!0,fadeIn:1})}var n=t("../Common"),o=t("./SimpleScene"),a=t("../ui/MenuPanel");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.init=function(){o.prototype.init.call(this),this._container=new PIXI.Container,this._container.x=n.STAGE_WIDTH/2,this._container.y=n.STAGE_HEIGHT/2,this.addChild(this._container),this._bg=new PIXI.Sprite(n.assets.getTexture("ui_map_bg_0.5x")),this._bg.anchor.set(.5),this._bg.scale.set(2),this._bg.interactive=!0,this._container.addChild(this._bg);var t=new PIXI.Sprite(n.assets.getTexture("ui_map_red_overlay_0.1x"));t.anchor.set(.5),t.scale.set(10),this._container.addChild(t);var e=n.assets.getTexture("ui_map_grid_tile"),i=new PIXI.extras.TilingSprite(e,n.STAGE_WIDTH,n.STAGE_HEIGHT);i.anchor.set(.5),i.alpha=.5,this._container.addChild(i),this._bgBox=new PIXI.Sprite(n.assets.getTexture("ui_results_panel_bg")),this._bgBox.anchor.set(.5),this._bgBox.position.set(100,70),this._container.addChild(this._bgBox),this.addParallaxItem(this._bgBox,.003),n.savedData.lastGame.endless&&(this._distanceBox=new PIXI.Sprite(n.assets.getTexture("ui_results_panel_distance")),this._distanceBox.anchor.set(.5),this._distanceBox.position.set(90,140),this._container.addChild(this._distanceBox),this.addParallaxItem(this._distanceBox,.015),this._distanceContainer=new PIXI.Container,this._distanceContainer.x=-180,this._distanceContainer.y=0,this._distanceBox.addChild(this._distanceContainer),this._distanceContainer.bg=new PIXI.Sprite(n.assets.getTexture("ui_distance_bg")),this._distanceContainer.bg.anchor.set(0,.5),this._distanceContainer.bg.x+=10,this._distanceContainer.addChild(this._distanceContainer.bg),this._distanceContainer.label=n.createText(n.savedData.lastGame.distance,{size:60}),this._distanceContainer.label.x=220,this._distanceContainer.label.y=-12,this._distanceContainer.addChild(this._distanceContainer.label)),this._hiscoreBox=new PIXI.Sprite(n.assets.getTexture("ui_results_panel_hi_score_bg")),this._hiscoreBox.anchor.set(.5),this._hiscoreBox.position.set(-20,250),this._container.addChild(this._hiscoreBox),this.addParallaxItem(this._hiscoreBox,.006),n.savedData.lastGame.endless&&this._hiscoreBox.position.set(-20,290);var s=n.createText("HIGHSCORE",{size:30});s.x=10,s.y-=45,this._hiscoreBox.addChild(s);var s=n.createText(n.savedData.getLastGameHighscore(),{size:50});if(s.x=0,s.y+=0,this._hiscoreBox.addChild(s),!n.savedData.lastGame.endless){this._scoreBox=new PIXI.Sprite(n.assets.getTexture("ui_results_panel_score_bg")),this._scoreBox.anchor.set(.5),this._scoreBox.position.set(240,250),this._container.addChild(this._scoreBox),this.addParallaxItem(this._scoreBox,.009);var s=n.createText("SCORE",{size:40});s.x=10,s.y-=30,this._scoreBox.addChild(s);var s=n.createText(n.savedData.lastGame.score,{size:60});s.x=0,s.y+=25,this._scoreBox.addChild(s)}this._coinsBox=new PIXI.Sprite(n.assets.getTexture("ui_results_panel_tokens_bg")),this._coinsBox.anchor.set(.5),this._coinsBox.scale.set(.85),this._coinsBox.position.set(180,-80),this._container.addChild(this._coinsBox),this.addParallaxItem(this._coinsBox,.012),n.savedData.lastGame.endless&&this._coinsBox.position.set(220,-20),this._coinsContainer=new PIXI.Container,this._coinsContainer.x=-160,this._coinsContainer.y=-25,this._coinsContainer.scale.set(1/this._coinsBox.scale.x),this._coinsBox.addChild(this._coinsContainer),n.savedData.lastGame.endless&&(this._coinsContainer.y+=5),this._coinsContainer.bg=new PIXI.Sprite(n.assets.getTexture("ui_tokens_bg")),this._coinsContainer.bg.anchor.set(0,.5),this._coinsContainer.bg.scale.set(.8),this._coinsContainer.bg.x+=10,this._coinsContainer.addChild(this._coinsContainer.bg),this._coinsContainer.label=n.createText(n.savedData.lastGame.coins,{size:60}),this._coinsContainer.label.x=180,this._coinsContainer.label.y=-12,this._coinsContainer.addChild(this._coinsContainer.label),this._coinsContainer.coin=new PIXI.Sprite(PIXI.Texture.WHITE),this._coinsContainer.coin.anchor.set(.5),this._coinsContainer.coin.position.x=60,this._coinsContainer.coin.visible=!1,this._coinsContainer.addChild(this._coinsContainer.coin),n.savedData.lastGame.endless||(this._progressBox=new PIXI.Sprite(n.assets.getTexture("ui_results_panel_progress")),this._progressBox.anchor.set(.5),this._progressBox.position.set(240,90),this._container.addChild(this._progressBox),this.addParallaxItem(this._progressBox,.015),this._collectiblesContainer=new PIXI.Container,this._collectiblesContainer.x=-180,this._collectiblesContainer.y=-10,this._progressBox.addChild(this._collectiblesContainer),this._collectiblesContainer.bg=new PIXI.Sprite(n.assets.getTexture("ui_progress_bg")),this._collectiblesContainer.bg.anchor.set(0,.5),this._collectiblesContainer.addChild(this._collectiblesContainer.bg),this._collectiblesContainer.fill=new PIXI.Sprite(n.assets.getTexture("ui_progress_fill")),this._collectiblesContainer.fill.anchor.set(-.315,.65),this._collectiblesContainer.fill.x=-208*(1-n.savedData.getLevelCollectiblesCollectedPercentage(n.savedData.levelIndex)),this._collectiblesContainer.addChild(this._collectiblesContainer.fill),this._collectiblesContainer.fill.mask=new PIXI.Sprite(n.assets.getTexture("ui_progress_fill")),this._collectiblesContainer.fill.mask.anchor.copy(this._collectiblesContainer.fill.anchor),this._collectiblesContainer.addChild(this._collectiblesContainer.fill.mask),this._collectiblesContainer.icon=new PIXI.Sprite(n.assets.getTexture("ui_progress_icon")),this._collectiblesContainer.icon.anchor.set(.5),this._collectiblesContainer.icon.x=100,this._collectiblesContainer.addChild(this._collectiblesContainer.icon)),this._leftPanel=new a,this._leftPanel.x=-1230,this.addChild(this._leftPanel),this._rightPanel=new a,this._rightPanel.x=1230,this.addChild(this._rightPanel),this._character=new PIXI.Sprite(n.assets.getTexture("ui_char_sel_"+n.savedData.character)),this._character.anchor.set(.5,1),this._character.position.set(n.STAGE_WIDTH/2-470,n.STAGE_HEIGHT),this.addChild(this._character),this.addParallaxItem(this._character,.04),"hulk"==n.savedData.character&&(this._character.y+=70),"thor"==n.savedData.character&&(this._character.x-=50),this._messageBox=new PIXI.Sprite(n.assets.getTexture("ui_results_panel_text")),this._messageBox.anchor.set(.5),this._messageBox.position.set(n.STAGE_WIDTH/2-30,n.STAGE_HEIGHT/2-190),this.addChild(this._messageBox),this.addParallaxItem(this._messageBox,.05);var s=n.createText(n.savedData.lastGame.hasWon||n.savedData.lastGame.endless?"WELL_DONE":"NICE_TRY",{size:30});s.y-=5,this._messageBox.addChild(s),this._title=new PIXI.Container,this._title.position.set(n.STAGE_WIDTH/2,n.STAGE_HEIGHT/2-300),this.addChild(this._title),this.addParallaxItem(this._title,.035);var r=new PIXI.Sprite(n.assets.getTexture("ui_title_frame"));r.anchor.set(.5),this._title.addChild(r);var s=n.createText("RESULTS",{bitmapFont:n.bitmapFontTitle});s.y=-5,this._title.addChild(s),this.addHomeButton(),this.addMuteButton(),this.addNextButton(),this.addRestartButton(),this.addCoinCounter(),this.onMouseMove(),!n.savedData.showAllLevelsDoneScene&&n.savedData.lastGame.hasWon&&n.savedData.lastGame.levelIndex==n.config.data.levels-1?this.delay(.5,function(){n.stats.track("game_complete"),this.signals.showCongratulations.dispatch("levels"),n.savedData.showAllLevelsDoneScene=!0,n.savedData.save()},null,this):n.savedData.showCompletionistScene||1!=n.savedData.getCollectiblesCollectedPercentage()||this.delay(.5,function(){this.signals.showCongratulations.dispatch("collectibles"),n.savedData.showCompletionistScene=!0,n.savedData.save()},null,this)},s.prototype.show=function(){this._bg.on("mousemove",this.onMouseMove.bind(this))},s.prototype.appear=function(){this._bg.on("mousemove",this.onMouseMove.bind(this)),this.animateCoins(n.savedData.lastGame.coins,1.3),this._animateInTimeline=this.createTimeline(),this._animateInTimeline.from(this._leftPanel,1,{x:this._leftPanel.x-500,ease:Back.easeOut},0),this._animateInTimeline.from(this._rightPanel,1,{x:this._rightPanel.x+500,ease:Back.easeOut},0),n.savedData.lastGame.endless?(this._animateInTimeline.from(this._coinCounter,.5,{y:this._coinCounter.y-100,alpha:0,ease:Back.easeOut},.3),this._animateInTimeline.from(this._title,.3,{y:this._title.y-100,alpha:0,ease:Sine.easeOut},.4),this._animateInTimeline.from(this._bgBox,.5,{y:this._bgBox.y+600,alpha:0,ease:Back.easeOut},.5),this._animateInTimeline.from(this._coinsBox,.5,{y:this._coinsBox.y+600,alpha:0,ease:Back.easeOut},.6),this._animateInTimeline.from(this._distanceBox,.5,{y:this._distanceBox.y+600,alpha:0,ease:Back.easeOut},.7),this._animateInTimeline.from(this._hiscoreBox,.5,{y:this._hiscoreBox.y+600,alpha:0,ease:Back.easeOut},.8),this._animateInTimeline.from(this._messageBox,.8,{x:this._messageBox.x+300,alpha:0,ease:Back.easeOut},.7),this._animateInTimeline.from(this._character,.6,{x:this._character.x-300,alpha:0,ease:Sine.easeOut},.5)):(this._animateInTimeline.from(this._coinCounter,.5,{y:this._coinCounter.y-100,alpha:0,ease:Back.easeOut},.3),this._animateInTimeline.from(this._title,.3,{y:this._title.y-100,alpha:0,ease:Sine.easeOut},.4),this._animateInTimeline.from(this._bgBox,.5,{y:this._bgBox.y+600,alpha:0,ease:Back.easeOut},.5),this._animateInTimeline.from(this._coinsBox,.5,{y:this._coinsBox.y+600,alpha:0,ease:Back.easeOut},.6),this._animateInTimeline.from(this._progressBox,.5,{y:this._progressBox.y+600,alpha:0,ease:Back.easeOut},.7),this._animateInTimeline.from(this._scoreBox,.5,{y:this._scoreBox.y+600,alpha:0,ease:Back.easeOut},.8),this._animateInTimeline.from(this._hiscoreBox,.5,{y:this._hiscoreBox.y+600,alpha:0,ease:Back.easeOut},.9),this._animateInTimeline.from(this._messageBox,.8,{x:this._messageBox.x+300,alpha:0,ease:Back.easeOut},.8),this._animateInTimeline.from(this._character,.6,{x:this._character.x-300,alpha:0,ease:Sine.easeOut},.6))},s.prototype.hide=function(){this._bg.off("mousemove")},s.prototype.destroy=function(){this._bg.off("mousemove"),o.prototype.destroy.call(this)},s.prototype.update=function(){o.prototype.update.call(this)},s.prototype.resize=function(){o.prototype.resize.call(this)},s.prototype.animateIn=function(t,e){o.prototype.animateIn.call(this),t&&t.call(e)},s.prototype.animateOut=function(t,e){o.prototype.animateOut.call(this),t&&t.call(e)},s.prototype.addParallaxItem=function(t,e){t.parallax=e,this._parallaxItems.push(t)},s.prototype.animateCoins=function(t,e){this._coinCounter.label.text=this._coinCounter.value-t;for(var i=[],s=0;s<10;s++){var o=new PIXI.Sprite(n.assets.getTexture("ui_icon_ability_token"));o.anchor.set(.5),o.alpha=0,this.addChild(o),i.push(o)}for(var a=this.createTimeline({delay:e||0,onStartScope:this,onStart:function(){this._coinCounter.value=parseInt(this._coinCounter.label.text)}}),s=i.length-1;s>=0;s--){var r=this.toLocal(new PIXI.Point(0,0),this._coinsContainer.coin),h=this.toLocal(new PIXI.Point(0,0),this._coinCounter);h.x+=40;var e=.1*s;a.fromTo(i[s].scale,1,{x:1,y:1},{x:.85,y:.85,ease:Quart.easeOut,onStart:function(){n.audio.playSound("sfx_coin_reward_loop_00")}},e),a.fromTo(i[s],1,{x:r.x,y:r.y},{x:h.x,y:h.y,ease:Sine.easeInOut},e),a.to(i[s],1,{rotation:2*Math.PI,ease:Sine.easeInOut},e),a.to(i[s],.1,{alpha:1,ease:Linear.easeNone},e),a.to(i[s],.1,{alpha:0,ease:Linear.easeNone},e+.9)}},s.prototype.onMouseMove=function(t){for(var e=t?t.data.getLocalPosition(this).x:n.STAGE_WIDTH/2,i=-(e-n.STAGE_WIDTH/2),s=0;s<this._parallaxItems.length;s++)this._parallaxItems[s].orX||(this._parallaxItems[s].orX=this._parallaxItems[s].x),this._parallaxItems[s].destX=this._parallaxItems[s].orX+i*this._parallaxItems[s].parallax;this._leftPanel.applyParallax(i,.02),this._rightPanel.applyParallax(i,.02)},s.prototype.onNextButtonClicked=function(t){o.prototype.onNextButtonClicked.call(this,t)},s.prototype.onGUIButtonClicked=function(t){"restart"==t.id&&(n.savedData.lastGame.hasWon&&!n.savedData.lastGame.endless||(n.savedData.lastGame.endless?n.stats.track("level_continue",{game_level:"endless"}):n.stats.track("level_continue",{game_level:n.savedData.lastGame.levelIndex+1}))),o.prototype.onGUIButtonClicked.call(this,t)}},{"../Common":3,"../ui/MenuPanel":84,"./SimpleScene":77}],72:[function(t,e,i){function s(){switch(o.call(this),this.id="GameScene",this.character=n.savedData.character,this.levelIndex=n.savedData.levelIndex||0,this.endless=n.savedData.endless||!1,this.collectibles=[],this.character){default:var t="music_ingame_action";break;case"black_widow":case"hawkeye":case"black_panther":var t="music_ingame_stealth"}n.audio.playMusic(t,{loop:!0,fadeIn:1}),this.signals.help=new signals.Signal}var n=t("../Common"),o=t("./SimpleScene"),a=t("../game/Level"),r=t("../game/GameUI");t("../general/ScrollingContainer");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.init=function(){if(o.prototype.init.call(this),this.interactiveArea=new PIXI.Sprite(PIXI.Texture.BLANK),this.interactiveArea.width=n.STAGE_WIDTH,this.interactiveArea.height=n.STAGE_HEIGHT,this.interactiveArea.interactive=!0,""==n.savedData.levelDebug||this.endless)if(this.endless)this.level=new a(this,(!0),{start:["endless_start"],parts:["endless_000","endless_001","endless_002","endless_003","endless_004","endless_005","endless_006","endless_007","endless_008","endless_009","endless_010","endless_011","endless_012","endless_013"]},"outside"),n.stats.track("game_next_level",{game_level:"endless"});else{var t=n.config.levels[this.levelIndex].level;this.level=new a(this,this.endless,t,n.config.levels[this.levelIndex].bg,this.levelIndex);for(var e=n.assets.getJSON(t),i=0;i<e.layers.length;i++)for(var s=0;s<e.layers[i].objects.length;s++)"collectible"==e.layers[i].objects[s].id&&this.collectibles.push(e.layers[i].objects[s].position.x/e.length);this.collectibles.sort(function(t,e){return t-e}),this.collectibles.length!=n.config.data.collectibles&&console.error("Incorrect number of collectibles. %i found, %i expected",this.collectibles.length,n.config.data.collectibles),n.savedData.lastGame.hasWon===!0?n.stats.track("game_next_level",{game_level:this.endless?"endless":this.levelIndex+1}):n.savedData.lastGame.hasWon===!1&&n.stats.track("game_continue",{game_level:this.endless?"endless":this.levelIndex+1})}else{var h=JSON.parse(n.savedData.levelDebug);h.length&&(this.level=new a(this,(!1),null,"outside"),this.level.config=JSON.parse(n.savedData.levelDebug))}this.level.init(),this.addChild(this.level),this.gameUI=new r(this,this.level),this.gameUI.init(),this.gameUI.addProgressBarCollectibles(this.collectibles),this.addChild(this.gameUI),this.interactiveArea.touchstart=this.interactiveArea.mousedown=this.onTouchStart.bind(this),this.interactiveArea.touchend=this.interactiveArea.mouseup=this.onTouchEnd.bind(this),this.addPauseButton(),this._muteButton=this.addMuteButton(),n.goalsManager.startRun(this),this.startGame(),n.savedData.tutorial||this.delay(2,function(){n.savedData.tutorial=!0,this.signals.help.dispatch()},null,this)},s.prototype.startGame=function(){this.showGUI(),this.delay(.25,function(){this.gameUI.showGoals(!1)},null,this)},s.prototype.update=function(){!this.paused&&this.level&&n.currentScene==this&&(this.level.update(),this.gameUI.update())},s.prototype.resize=function(){o.prototype.resize.call(this),this.gameUI.resize()},s.prototype.show=function(){this._muteButton.syncIcon()},s.prototype.destroy=function(t){this.level.destroy({children:!0}),o.prototype.destroy.call(this,t)},s.prototype.animateIn=function(t,e){o.prototype.animateIn.call(this),t&&t.call(e)},s.prototype.animateOut=function(t,e){o.prototype.animateOut.call(this),t&&t.call(e)},s.prototype.hideGUI=function(t,e){o.prototype.hideGUI.call(this),TweenMax.pauseAll(),this.gameOverTimer&&this.gameOverTimer.stop(),this.paused=!0},s.prototype.showGUI=function(){o.prototype.showGUI.call(this),TweenMax.resumeAll(),this.gameOverTimer&&this.gameOverTimer.start(),this.paused=!1},s.prototype.gameOver=function(t){var e={hasWon:t,endless:this.endless,levelIndex:this.levelIndex,distance:this.level.avatar.distance,style:this.level.styleScore,coins:this.level.coins};n.savedData.saveLastGame(e),n.audio.stopMusic(),n.audio.playSound(t?"music_game_win_sting":"music_game_over_sting",{loop:!1}),this.gameUI.showGoals(!0,t?0:1.5),t||this.gameUI.showRedOverlay(),this.delay(t?3:4,function(){this.signals.next.dispatch()},null,this)},s.prototype.tempTutorial=function(){var t=n.displayObjects.createContainer({alpha:0,x:n.STAGE_WIDTH/2,y:n.STAGE_HEIGHT/2,parent:this}),e=new PIXI.Graphics;e.lineStyle(1,16777215),e.moveTo(0,-300),e.lineTo(0,300),t.addChild(e);var i=new PIXI.Text("SPECIAL\nMOVE",{fontFamily:"Arial",fontSize:36,fill:16777215,align:"center"});i.anchor.set(.5),i.x=-250,i.y=-200,t.addChild(i);var s=new PIXI.Text("JUMP",{fontFamily:"Arial",fontSize:36,fill:16777215,align:"center"});s.anchor.set(.5),s.x=250,s.y=-200,t.addChild(s);var o=this.createTimeline();o.to(t,1,{alpha:1,delay:1}),o.to(t,1,{alpha:0,delay:4})},s.prototype.onTouchStart=function(t){var e=t.data.getLocalPosition(this);e.x>n.STAGE_WIDTH/2?this.level.avatar.kJumpStart=!0:this.level.avatar.special()},s.prototype.onTouchEnd=function(t){this.level.avatar.kJumpEnd=!0},s.prototype.onTouchMove=function(t){},s.prototype.restart=function(){this.signals.previous.dispatch()}},{"../Common":3,"../game/GameUI":21,"../game/Level":22,"../general/ScrollingContainer":62,"./SimpleScene":77}],73:[function(t,e,i){function s(t){switch(this._screenIndex=0,this._screens=[],this._content=[],t){default:case"splash":this._content.push({image:["help/ui_help_splash_bg","help/ui_help_splash_1"],text:"HELP_MAIN_0"}),this._content.push({image:["help/ui_help_splash_bg","help/ui_help_splash_2"],text:"HELP_MAIN_1"}),this._content.push({image:["help/ui_help_splash_bg","help/ui_help_splash_2"],text:"HELP_MAIN_2"}),this._content.push({image:["help/ui_help_goals"],text:"HELP_GOALS_0"});break;case"map":this._content.push({image:["help/ui_help_map"],text:"HELP_MAP_0"}),this._content.push({image:["help/ui_help_map"],text:"HELP_MAP_1"}),this._content.push({image:["help/ui_help_map"],text:"HELP_MAP_2"});break;case"character":this._content.push({image:["help/ui_help_characters_bg","help/ui_help_characters_1a","help/ui_help_characters_1b"],text:"HELP_CHARACTER_0"}),this._content.push({image:["help/ui_help_characters_bg","help/ui_help_characters_2","help/ui_help_characters_3a","help/ui_help_characters_3b"],text:"HELP_CHARACTER_1"}),this._content.push({image:["help/ui_help_characters_bg","help/ui_help_characters_3a"],text:"HELP_CHARACTER_2"}),this._content.push({image:["help/ui_help_characters_bg","help/ui_help_characters_3b"],text:"HELP_CHARACTER_3"}),this._content.push({image:["help/ui_help_characters_bg","help/ui_help_characters_4"],text:"HELP_CHARACTER_4"});break;case"game":this._content.push({image:["help/ui_help_gameplay_bg","help/ui_help_gameplay_bg_1"+(p3.Device.isMobile?"_mobile":""),"help/ui_help_gameplay_bg_2"+(p3.Device.isMobile?"_mobile":""),"help/ui_help_gameplay_bg_3"+(p3.Device.isMobile?"_mobile":""),"help/ui_help_gameplay_1","help/ui_help_jump_button"+(p3.Device.isMobile?"_mobile":"_desktop")],text:"HELP_GENERIC_0_"+(p3.Device.isMobile?"MOB":"PC")}),this._content.push({image:["help/ui_help_gameplay_bg","help/ui_help_gameplay_bg_1"+(p3.Device.isMobile?"_mobile":""),"help/ui_help_gameplay_bg_2"+(p3.Device.isMobile?"_mobile":""),"help/ui_help_gameplay_bg_3"+(p3.Device.isMobile?"_mobile":""),"help/ui_help_gameplay_2","help/ui_help_jump_button"+(p3.Device.isMobile?"_mobile":"_desktop")],text:"HELP_GENERIC_1_"+(p3.Device.isMobile?"MOB":"PC")}),this._content.push({image:["help/ui_help_gameplay_bg","help/ui_help_gameplay_bg_1"+(p3.Device.isMobile?"_mobile":""),"help/ui_help_gameplay_bg_2"+(p3.Device.isMobile?"_mobile":""),"help/ui_help_gameplay_bg_3"+(p3.Device.isMobile?"_mobile":""),"help/ui_help_gameplay_3","help/ui_help_attack_button"+(p3.Device.isMobile?"_mobile":"_desktop")],text:"HELP_GENERIC_2_"+(p3.Device.isMobile?"MOB":"PC")}),this._content.push({image:["help/ui_help_gameplay_bg","help/ui_help_gameplay_bg_1"+(p3.Device.isMobile?"_mobile":""),"help/ui_help_gameplay_bg_2"+(p3.Device.isMobile?"_mobile":""),"help/ui_help_gameplay_bg_3"+(p3.Device.isMobile?"_mobile":""),"help/ui_help_gameplay_4","help/ui_help_special_button"+(p3.Device.isMobile?"_mobile":"_desktop")],text:"HELP_GENERIC_3_"+(p3.Device.isMobile?"MOB":"PC")}),this._content.push({image:["help/ui_help_gameplay_bg","help/ui_help_gameplay_bg_1"+(p3.Device.isMobile?"_mobile":""),"help/ui_help_gameplay_bg_2"+(p3.Device.isMobile?"_mobile":""),"help/ui_help_gameplay_bg_3"+(p3.Device.isMobile?"_mobile":""),"help/ui_help_gameplay_5"],text:"HELP_GENERIC_4"}),this._content.push({image:["help/ui_help_gameplay_bg","help/ui_help_gameplay_bg_1"+(p3.Device.isMobile?"_mobile":""),"help/ui_help_gameplay_bg_2"+(p3.Device.isMobile?"_mobile":""),"help/ui_help_gameplay_bg_3"+(p3.Device.isMobile?"_mobile":""),"help/ui_help_gameplay_6"],text:"HELP_GENERIC_5"})}o.call(this)}var n=t("../Common"),o=t("./SimpleScene");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.init=function(){o.prototype.init.call(this),this._bg=this.addOverlay(),this._container=new PIXI.Container,this._container.x=n.STAGE_WIDTH/2,this._container.y=n.STAGE_HEIGHT/2,this.addChild(this._container),this._title=new PIXI.Container,this._title.y=-300,this._container.addChild(this._title);var t=new PIXI.Sprite(n.assets.getTexture("ui_title_frame"));t.anchor.set(.5),this._title.addChild(t);var e=n.createText("HELP",{bitmapFont:n.bitmapFontTitle});e.y=-5,this._title.addChild(e),this._helpBox=new PIXI.Sprite(n.assets.getTexture("ui_panel")),this._helpBox.anchor.set(.5),this._helpBox.x=0,this._helpBox.y=20,this._container.addChild(this._helpBox);for(var i=0;i<this._content.length;i++){var s=new PIXI.Container;s.visible=!1;for(var a=0;a<this._content[i].image.length;a++){var r=n.assets.getTexture(this._content[i].image[a]);if(r){var h=new PIXI.Sprite(r);h.anchor.set(.5),s.addChild(h)}}this._screens.push(s),this._helpBox.addChild(s)}var l=new PIXI.Sprite(n.assets.getTexture("ui_text_panel"));l.anchor.set(.5),l.y=270,this._helpBox.addChild(l),this._description=n.createText("PLACEHOLDER",{size:24}),this._description.y=-5,l.addChild(this._description),this._prevButton=this._generateButton("btns/ui_icon_prev_left","left","blue"),this._prevButton.x=-430,this._prevButton.signals.up.add(this.onPrevButtonClick,this),this._helpBox.addChild(this._prevButton),this._nextButton=this._generateButton("btns/ui_icon_prev_right","right","blue"),this._nextButton.x=430,this._nextButton.signals.up.add(this.onNextButtonClick,this),this._helpBox.addChild(this._nextButton),this._closeButton=this._generateButton("btns/ui_icon_cross","close","blue"),this._closeButton.x=340,this._closeButton.y=-230,this._closeButton.signals.down.addOnce(this.onCloseClick,this),this._helpBox.addChild(this._closeButton),this.changeScreen(0)},s.prototype.update=function(){},s.prototype.resize=function(){o.prototype.resize.call(this)},s.prototype.dispose=function(){},s.prototype.animateIn=function(t,e){o.prototype.animateIn.call(this);var i=this.createTimeline({onCompleteScope:e,onComplete:t});i.fromTo(this._bg,.5,{alpha:0},{alpha:this._bg.alpha,ease:Sine.easeOut},0),i.fromTo(this._title.scale,.5,{x:0,y:0},{x:1,y:1,ease:Back.easeOut},0),i.fromTo(this._helpBox.scale,.5,{x:0,y:0},{x:1,y:1,ease:Back.easeOut},0),i.fromTo(this._closeButton.scale,.5,{x:0,y:0},{x:1,y:1,ease:Back.easeOut},.6)},s.prototype.animateOut=function(t,e){o.prototype.animateOut.call(this);var i=this.createTimeline({onCompleteScope:e,onComplete:t});i.to(this._bg,.5,{alpha:0,ease:Sine.easeIn},0),i.to(this._title.scale,.5,{x:0,y:0,ease:Back.easeIn},0),i.to(this._helpBox.scale,.5,{x:0,y:0,ease:Back.easeIn},0)},s.prototype.changeScreen=function(t){this._screens[this._screenIndex].visible=!1,this._screenIndex+=t,this._screenIndex<0&&(this._screenIndex+=this._screens.length),this._screenIndex>=this._screens.length&&(this._screenIndex-=this._screens.length),this._screens[this._screenIndex].visible=!0,this._description.text=n.copy[this._content[this._screenIndex].text][n.language].toUpperCase()},s.prototype.onPrevButtonClick=function(){this.changeScreen(-1)},s.prototype.onNextButtonClick=function(){this.changeScreen(1)},s.prototype.onCloseClick=function(){this.animateOut(function(){this.signals.previous.dispatch()},this)}},{"../Common":3,"./SimpleScene":77}],74:[function(t,e,i){function s(){o.call(this),this._parallaxItems=[],n.audio.playMusic("music_menu_map_loop",{loop:!0,fadeIn:1})}var n=t("../Common"),o=t("./SimpleScene"),a=t("../ui/MapButton"),r=t("../ui/MenuPanel");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.init=function(){o.prototype.init.call(this),this._container=new PIXI.Container,this._container.x=n.STAGE_WIDTH/2,this._container.y=n.STAGE_HEIGHT/2,this.addChild(this._container),this._bg=new PIXI.Sprite(n.assets.getTexture("ui_map_bg_0.5x")),this._bg.anchor.set(.5),this._bg.scale.set(2),this._bg.interactive=!0,this._container.addChild(this._bg);var t=new PIXI.Sprite(n.assets.getTexture("ui_map_red_overlay_0.1x"));t.anchor.set(.5),t.scale.set(10),this._container.addChild(t);var e=n.assets.getTexture("ui_map_grid_tile"),i=new PIXI.extras.TilingSprite(e,this._bg.width,n.STAGE_HEIGHT);i.anchor.set(.5),i.alpha=.5,this._container.addChild(i),this._logo=new PIXI.Sprite(n.assets.getTexture("ui_logo")),this._logo.anchor.set(.5),this._logo.y=-280,this._logo.scale.set(.5),this._container.addChild(this._logo),this.addParallaxItem(this._logo,.015);var s=new PIXI.Sprite(n.assets.getTexture("ui_title"));s.anchor.set(.5),s.y=106,this._logo.addChild(s),this._buttonsContainer=new PIXI.Container,this._buttonsContainer.y=-30,this._container.addChild(this._buttonsContainer),this.addParallaxItem(this._buttonsContainer,.01);for(var h=[[-300,-215],[-430,-25],[-370,215],[-150,235],[-220,-10],[0,0],[165,-130],[390,-120],[240,65],[60,215],[260,300],[430,180]],l=this.createTimeline(),c=0;c<h.length-1;c++){var p=new PIXI.Sprite(n.assets.getTexture("ui_map_line"));p.anchor.set(.5),p.x=(h[c][0]+h[c+1][0])/2,p.y=(h[c][1]+h[c+1][1])/2,p.alpha=c+1<n.savedData.levelsUnlocked?1:.5,p.rotation=Math.atan2(h[c+1][1]-h[c][1],h[c+1][0]-h[c][0]),this._buttonsContainer.addChild(p),l.to(p,p3.Utils.randomRange(.1,.15),{alpha:.85*p.alpha,ease:Sine.easeInOut,yoyo:!0,repeat:-1},0)}for(var c=0;c<h.length;c++){var d=c<=n.savedData.levelsUnlocked||n.config.cheats.unlockAllLevels,u=n.savedData.getLevelCollectiblesCollectedPercentage(c),_=new a(c,d,u);_.x=h[c][0],_.y=h[c][1],this._buttonsContainer.addChild(_),d&&_.signals.up.add(this.onLevelClicked,this)}this._leftPanel=new r,this._leftPanel.x=-1230,this.addChild(this._leftPanel),this.addParallaxItem(this._leftPanel,.02),this._rightPanel=new r,this._rightPanel.x=1230,this.addChild(this._rightPanel),this.addParallaxItem(this._rightPanel,.02),this.addBackButton(),this.addMuteButton(),this.addHelpButton(),this.onMouseMove()},s.prototype.show=function(){this._bg.on("mousemove",this.onMouseMove.bind(this))},s.prototype.appear=function(){this._bg.on("mousemove",this.onMouseMove.bind(this))},s.prototype.hide=function(){this._bg.off("mousemove")},s.prototype.destroy=function(){this._bg.off("mousemove"),o.prototype.destroy.call(this)},s.prototype.update=function(){},s.prototype.resize=function(){o.prototype.resize.call(this)},s.prototype.destroy=function(t){o.prototype.destroy.call(this,t)},s.prototype.animateIn=function(t,e){o.prototype.animateIn.call(this),t&&t.call(e)},s.prototype.animateOut=function(t,e){o.prototype.animateOut.call(this),t&&t.call(e)},s.prototype.addParallaxItem=function(t,e){t.parallax=e,this._parallaxItems.push(t)},s.prototype.onLevelClicked=function(t){n.savedData.levelIndex=t.levelIndex,this.signals.next.dispatch()},s.prototype.onMouseMove=function(t){for(var e=t?t.data.getLocalPosition(this).x:n.STAGE_WIDTH/2,i=-(e-n.STAGE_WIDTH/2),s=0;s<this._parallaxItems.length;s++)this._parallaxItems[s].orX||(this._parallaxItems[s].orX=this._parallaxItems[s].x),this._parallaxItems[s].destX=this._parallaxItems[s].orX+i*this._parallaxItems[s].parallax;this._leftPanel.applyParallax(i,this._leftPanel.parallax),this._rightPanel.applyParallax(i,this._rightPanel.parallax)}},{"../Common":3,"../ui/MapButton":83,"../ui/MenuPanel":84,"./SimpleScene":77}],75:[function(t,e,i){function s(t){a.call(this),this.signals.home=new signals.Signal,this.signals.restart=new signals.Signal,this.signals.help=new signals.Signal,this._screenIndex=0,this._screens=[],this._content=[],this._content.push({image:["help/ui_help_gameplay_bg","help/ui_help_gameplay_bg_1"+(p3.Device.isMobile?"_mobile":""),"help/ui_help_gameplay_bg_2"+(p3.Device.isMobile?"_mobile":""),"help/ui_help_gameplay_bg_3"+(p3.Device.isMobile?"_mobile":""),"help/ui_help_gameplay_1","help/ui_help_jump_button"+(p3.Device.isMobile?"_mobile":"_desktop")],text:"HELP_GENERIC_0_"+(p3.Device.isMobile?"MOB":"PC")}),this._content.push({image:["help/ui_help_gameplay_bg","help/ui_help_gameplay_bg_1"+(p3.Device.isMobile?"_mobile":""),"help/ui_help_gameplay_bg_2"+(p3.Device.isMobile?"_mobile":""),"help/ui_help_gameplay_bg_3"+(p3.Device.isMobile?"_mobile":""),"help/ui_help_gameplay_2","help/ui_help_jump_button"+(p3.Device.isMobile?"_mobile":"_desktop")],text:"HELP_GENERIC_1_"+(p3.Device.isMobile?"MOB":"PC")}),this._content.push({image:["help/ui_help_gameplay_bg","help/ui_help_gameplay_bg_1"+(p3.Device.isMobile?"_mobile":""),"help/ui_help_gameplay_bg_2"+(p3.Device.isMobile?"_mobile":""),"help/ui_help_gameplay_bg_3"+(p3.Device.isMobile?"_mobile":""),"help/ui_help_gameplay_3","help/ui_help_attack_button"+(p3.Device.isMobile?"_mobile":"_desktop")],text:"HELP_GENERIC_2_"+(p3.Device.isMobile?"MOB":"PC")}),this._content.push({image:["help/ui_help_gameplay_bg","help/ui_help_gameplay_bg_1"+(p3.Device.isMobile?"_mobile":""),"help/ui_help_gameplay_bg_2"+(p3.Device.isMobile?"_mobile":""),"help/ui_help_gameplay_bg_3"+(p3.Device.isMobile?"_mobile":""),"help/ui_help_gameplay_4","help/ui_help_special_button"+(p3.Device.isMobile?"_mobile":"_desktop")],text:"HELP_GENERIC_3_"+(p3.Device.isMobile?"MOB":"PC")}),this._content.push({image:["help/ui_help_gameplay_bg","help/ui_help_gameplay_bg_1"+(p3.Device.isMobile?"_mobile":""),"help/ui_help_gameplay_bg_2"+(p3.Device.isMobile?"_mobile":""),"help/ui_help_gameplay_bg_3"+(p3.Device.isMobile?"_mobile":""),"help/ui_help_gameplay_5"],text:"HELP_GENERIC_4"}),this._content.push({image:["help/ui_help_gameplay_bg","help/ui_help_gameplay_bg_1"+(p3.Device.isMobile?"_mobile":""),"help/ui_help_gameplay_bg_2"+(p3.Device.isMobile?"_mobile":""),"help/ui_help_gameplay_bg_3"+(p3.Device.isMobile?"_mobile":""),"help/ui_help_gameplay_6"],text:"HELP_GENERIC_5"})}var n=t("../Common"),o=t("../ui/MuteButton"),a=t("./SimpleScene");e.exports=s,s.prototype=Object.create(a.prototype),s.prototype.constructor=s,s.prototype.init=function(){a.prototype.init.call(this),this._bg=this.addOverlay(),this._container=new PIXI.Container,this._container.x=n.STAGE_WIDTH/2,this._container.y=n.STAGE_HEIGHT/2,this.addChild(this._container),this._title=new PIXI.Container,this._title.y=-300,this._container.addChild(this._title);var t=new PIXI.Sprite(n.assets.getTexture("ui_title_frame"));t.anchor.set(.5),this._title.addChild(t);
var e=n.createText("PAUSE",{bitmapFont:n.bitmapFontTitle});e.y=-5,this._title.addChild(e),this._messageBox=new PIXI.Sprite(n.assets.getTexture("ui_panel")),this._messageBox.anchor.set(.5),this._messageBox.x=0,this._messageBox.y=30,this._container.addChild(this._messageBox);var i=new PIXI.Sprite(PIXI.Texture.WHITE);i.anchor.set(.5),i.width=662,i.height=440,this._messageBox.addChild(i);var s=new PIXI.Sprite(n.assets.getTexture("ui_rays"));s.anchor.set(.5),s.y=-65,s.scale.set(3.33),s.tint=16711680,s.mask=i,s.alpha=.55,this._messageBox.addChild(s);var r=new PIXI.Sprite(n.assets.getTexture("ui_rays"));r.anchor.set(.5),r.y=-65,r.scale.set(3.33),r.tint=16711680,r.mask=i,r.alpha=.55,this._messageBox.addChild(r);var h=this.createTimeline();h.to(s,7,{rotation:2*-Math.PI,repeat:-1,ease:Linear.easeNone},0),h.to(r,11,{rotation:2*+Math.PI,repeat:-1,ease:Linear.easeNone},0),this._closeButton=this._generateButton("btns/ui_icon_cross","close","blue"),this._closeButton.x=340,this._closeButton.y=-230,this._closeButton.signals.down.addOnce(this.onCloseClick,this),this._messageBox.addChild(this._closeButton),this._playButton=this._generateButton("btns/ui_icon_play","play","red"),this._playButton.x=0,this._playButton.y=-60,this._playButton.signals.down.addOnce(this.onCloseClick,this),this._messageBox.addChild(this._playButton);for(var l=[{id:"restart",icon:"restart_small"},{id:"home",icon:"home"},{id:"help",icon:"help"},{id:"mute"}],c=0;c<l.length;c++){if("mute"==l[c].id)var p=new p3.ButtonStates(n.assets.getTexture("btns/ui_btn_blue_out"),n.assets.getTexture("btns/ui_btn_blue_over"),n.assets.getTexture("btns/ui_btn_blue_down"),n.assets.getTexture("btns/ui_icon_sound_"+(n.audio.isMute?"off":"on"))),d=new o(p,n.assets.getTexture("btns/ui_icon_sound_on"),n.assets.getTexture("btns/ui_icon_sound_off"));else{var d=this._generateButton("btns/ui_icon_"+l[c].icon,l[c].icon,"blue");d.signals.down.addOnce(this.onButtonClick,this)}d.x=120*(c-1.5),d.y=130,d.id=l[c].id,this._messageBox.addChild(d),this["_"+l[c].id]=d}this._helpBox=new PIXI.Sprite(n.assets.getTexture("ui_panel")),this._helpBox.anchor.set(.5),this._helpBox.x=0,this._helpBox.y=20,this._helpBox.scale.set(0),this._container.addChild(this._helpBox);for(var c=0;c<this._content.length;c++){var u=new PIXI.Container;u.visible=!1;for(var _=0;_<this._content[c].image.length;_++){var g=n.assets.getTexture(this._content[c].image[_]);if(g){var m=new PIXI.Sprite(g);m.anchor.set(.5),u.addChild(m)}}this._screens.push(u),this._helpBox.addChild(u)}var y=new PIXI.Sprite(n.assets.getTexture("ui_text_panel"));y.anchor.set(.5),y.y=270,this._helpBox.addChild(y),this._description=n.createText("PLACEHOLDER",{size:24}),this._description.y=-5,y.addChild(this._description),this._prevButton=this._generateButton("btns/ui_icon_prev_left","help_left","blue"),this._prevButton.x=-430,this._prevButton.signals.up.add(this.onPrevButtonClick,this),this._helpBox.addChild(this._prevButton),this._nextButton=this._generateButton("btns/ui_icon_prev_right","help_right","blue"),this._nextButton.x=430,this._nextButton.signals.up.add(this.onNextButtonClick,this),this._helpBox.addChild(this._nextButton),this._closeButton=this._generateButton("btns/ui_icon_cross","help_close","blue"),this._closeButton.x=340,this._closeButton.y=-230,this._closeButton.signals.down.addOnce(this.onCloseClick,this),this._helpBox.addChild(this._closeButton)},s.prototype.update=function(){},s.prototype.resize=function(){a.prototype.resize.call(this)},s.prototype.dispose=function(){},s.prototype.animateIn=function(t,e){a.prototype.animateIn.call(this);var i=this.createTimeline({onCompleteScope:e,onComplete:t});i.fromTo(this._bg,.5,{alpha:0},{alpha:this._bg.alpha,ease:Sine.easeOut},0),i.fromTo(this._title.scale,.5,{x:0,y:0},{x:1,y:1,ease:Back.easeOut},0),i.fromTo(this._messageBox.scale,.5,{x:0,y:0},{x:1,y:1,ease:Back.easeOut},0),i.fromTo(this._closeButton.scale,.5,{x:0,y:0},{x:1,y:1,ease:Back.easeOut},.6)},s.prototype.animateOut=function(t,e){a.prototype.animateOut.call(this);var i=this.createTimeline({onCompleteScope:e,onComplete:t});i.to(this._bg,.5,{alpha:0,ease:Sine.easeIn},0),i.to(this._title.scale,.5,{x:0,y:0,ease:Back.easeIn},0),i.to(this._messageBox.scale,.5,{x:0,y:0,ease:Back.easeIn},0),i.to(this._helpBox.scale,.5,{x:0,y:0,ease:Back.easeIn},0)},s.prototype.onCloseClick=function(){this.animateOut(function(){this.signals.previous.dispatch()},this)},s.prototype.onButtonClick=function(t){var e=t.id;switch(this.signals[e].dispatch(),e){case"restart":break;case"home":break;case"help":this.changeScreen(0);var i=this.createTimeline();i.to(this._messageBox.scale,.5,{x:0,y:0,ease:Back.easeIn},0),i.to(this._helpBox.scale,.5,{x:1,y:1,ease:Back.easeOut},.5)}},s.prototype.changeScreen=function(t){this._screens[this._screenIndex].visible=!1,this._screenIndex+=t,this._screenIndex<0&&(this._screenIndex+=this._screens.length),this._screenIndex>=this._screens.length&&(this._screenIndex-=this._screens.length),this._screens[this._screenIndex].visible=!0,this._description.text=n.copy[this._content[this._screenIndex].text][n.language].toUpperCase()},s.prototype.onPrevButtonClick=function(){this.changeScreen(-1)},s.prototype.onNextButtonClick=function(){this.changeScreen(1)}},{"../Common":3,"../ui/MuteButton":85,"./SimpleScene":77}],76:[function(t,e,i){function s(){o.call(this),this.loaded=0,this.animated=!1,this.finished=!1,this._playButton=null}var n=t("../Common"),o=t("./SimpleScene");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.init=function(){this._bg=new PIXI.Sprite(n.assets.getTexture("preloader_bg")),this._bg.x=n.STAGE_WIDTH/2,this._bg.y=n.STAGE_HEIGHT/2,this._bg.anchor.set(.5),this.addChild(this._bg),this._barContainer=new PIXI.Container,this._barContainer.y=100,this._bg.addChild(this._barContainer);var t=new PIXI.Sprite(n.assets.getTexture("ui_loading_bar_bg"));t.anchor.set(.5),this._barContainer.addChild(t),this._barContainer.fill=new PIXI.Sprite(n.assets.getTexture("ui_loading_bar_fill")),this._barContainer.fill.anchor.set(.5),this._barContainer.fill.x=-this._barContainer.fill.width,this._barContainer.addChild(this._barContainer.fill);var e=new PIXI.Sprite(n.assets.getTexture("ui_loading_bar_fill"));e.anchor.set(.5),this._barContainer.addChild(e),this._barContainer.fill.mask=e;var i=new p3.ButtonStates(p3.AssetManager.instance.getTexture("btns/ui_btn_red_out"),p3.AssetManager.instance.getTexture("btns/ui_btn_red_over"),p3.AssetManager.instance.getTexture("btns/ui_btn_red_down"),p3.AssetManager.instance.getTexture("btns/ui_icon_play"));this._playButton=new p3.Button(i),this._playButton.x=.5*n.STAGE_WIDTH,this._playButton.y=.5*n.STAGE_HEIGHT+100,this._playButton.animate=!0,this._playButton.visible=!1,this._playButton.signals.click.addOnce(this.onPlayButtonClick,this),this.addChild(this._playButton)},s.prototype.destroy=function(){o.prototype.destroy.call(this)},s.prototype.appear=function(){o.prototype.appear.call(this),this.animateIn()},s.prototype.show=function(){},s.prototype.animateIn=function(t,e){},s.prototype.animateOut=function(t,e){},s.prototype.resize=function(){this.x=.5*(p3.View.width-n.STAGE_WIDTH),this.y=.5*(p3.View.height-n.STAGE_HEIGHT)},s.prototype.update=function(){var t=Math.min(1,this.loaded),e=this._barContainer.fill.x,i=-(1-t)*this._barContainer.fill.width,s=i-e;if(this._barContainer.fill.x=e+.1*s,1==this.loaded)if(this._barContainer.fill.x=0,p3.Device.isMobile){if(!this._playButton.visible){this._playButton.scale.set(0),this._playButton.visible=!0;var n=this.createTimeline();n.to(this._barContainer.scale,.2,{x:0,y:0,ease:Back.easeIn},0),n.to(this._playButton.scale,.34,{delay:.14,x:1,y:1,ease:Back.easeOut,easeParams:[2]})}}else this.signals.next.dispatch(this)},s.prototype.onPlayButtonClick=function(t){this._playButton.interactive=!1,this._playButton.onMouseOut(),p3.Device.isAndroid&&screenfull.enabled&&(screenfull.request(),setTimeout(function(){n.view.resize()},100));var e=this.createTimeline();e.to(this._playButton.scale,.34,{x:0,y:0,ease:Back.easeIn,easeParams:[2],onComplete:function(){this.signals.next.dispatch(this)},onCompleteScope:this})}},{"../Common":3,"./SimpleScene":77}],77:[function(t,e,i){"use strict";function s(){p3.Scene.call(this),this.signals.next=new signals.Signal,this.signals.previous=new signals.Signal,this.signals.guiClick=new signals.Signal,this._centre=new PIXI.Point(n.STAGE_WIDTH/2,n.STAGE_HEIGHT/2),this._leftEdge=0,this._rightEdge=0,this._guiButtonMargins={top:60,bottom:50,right:70,left:70,minSpacing:100},this._guiButtons={},this._timelines=[],this._parallaxItems=[]}var n=t("../Common"),o=t("../ui/GUIbuttonData");e.exports=s,s.prototype=Object.create(p3.Scene.prototype),s.prototype.constructor=s,s.prototype.init=function(){},s.prototype.destroy=function(t){for(var e in this.signals)this.signals[e].dispose();for(var i=0;i<this._timelines.length;i++)this._timelines[i].kill();PIXI.Container.prototype.destroy.call(this,{children:!0})},s.prototype.update=function(){this._coinCounter&&this._coinCounter.value!=n.savedData.coins&&(this._coinCounter.valueAnimation||(this._coinCounter.valueAnimation=this._coinCounter.value),this._coinCounter.value=n.savedData.coins,this._coinCounter.label.timeline&&this._coinCounter.label.timeline.kill(),this._coinCounter.label.timeline=this.createTimeline(),this._coinCounter.label.timeline.to(this._coinCounter,1,{valueAnimation:this._coinCounter.value,ease:Sine.easeOut,onUpdateScope:this,onUpdate:function(){this._coinCounter.label.text=Math.round(this._coinCounter.valueAnimation)+""}},0))},s.prototype.createTimeline=function(t){var e=new TimelineMax(t);return this._timelines.push(e),e},s.prototype.delay=function(t,e,i,s){var i=i||null,n=this.createTimeline();return n.to(this,t,{onCompleteScope:s,onComplete:e,onCompleteParams:i}),n},s.prototype.addPauseButton=function(t,e){var i=this._generateButton("btns/ui_icon_pause","pause","blue");return i.signals.up.add(this.onGUIButtonClicked,this),void 0==e?i.y=this._guiButtonMargins.top:i.y=e,void 0==t?(this._guiButtons.pause=new o(i,function(){i.x=this._rightEdge-this._guiButtonMargins.right}.bind(this)),this.resize()):i.x=t,this.addChild(i),i},s.prototype.addHelpButton=function(t,e){var i=this._generateButton("btns/ui_icon_help","help","blue");return i.signals.up.add(this.onGUIButtonClicked,this),void 0==e?i.y=this._guiButtonMargins.top:i.y=e,void 0==t?(this._guiButtons.help=new o(i,function(){i.x=this._rightEdge-this._guiButtonMargins.right,this._guiButtons.pause&&(i.x-=this._guiButtonMargins.minSpacing)}.bind(this)),this.resize()):i.x=t,this.addChild(i),i},s.prototype.addBackButton=function(t,e,i){var s=this._generateButton(i||"btns/ui_icon_back","back","blue");return s.signals.up.addOnce(this.onPreviousButtonClicked,this),void 0==e?s.y=this._guiButtonMargins.top:s.y=e,void 0==t?(this._guiButtons.back=new o(s,function(){s.x=this._leftEdge+this._guiButtonMargins.left,p3.Device.isMobile&&(s.x+=80)}.bind(this)),this.resize()):s.x=t,this.addChild(s),s},s.prototype.addRestartButton=function(t,e,i){var s=this._generateButton("btns/ui_icon_restart","restart","red");return s.signals.up.addOnce(this.onGUIButtonClicked,this),void 0==e?s.y=n.STAGE_HEIGHT-this._guiButtonMargins.bottom-50:s.y=e,void 0==t?(this._guiButtons.restart=new o(s,function(){s.x=this._leftEdge+2*this._guiButtonMargins.right}.bind(this)),this.resize()):s.x=t,this.addChild(s),s},s.prototype.addNextButton=function(t,e,i){var s=this._generateButton(i||"btns/ui_icon_play","next","red");return s.signals.up.addOnce(this.onNextButtonClicked,this),void 0==e?s.y=n.STAGE_HEIGHT-this._guiButtonMargins.bottom-50:s.y=e,void 0==t?(this._guiButtons.next=new o(s,function(){s.x=this._rightEdge-2*this._guiButtonMargins.right}.bind(this)),this.resize()):s.x=t,this.addChild(s),s},s.prototype.addRightButton=function(t,e){var i=this._generateButton("icon_arrow_scroll_right","right",null);return i.signals.up.add(this.onInternalButtonClicked,this),void 0==e?i.y=n.STAGE_HEIGHT/2:i.y=e,void 0==t?(this._guiButtons.right=new o(i,function(){i.x=this._rightEdge-this._guiButtonMargins.right}.bind(this)),this.resize()):i.x=t,this.addChild(i),i},s.prototype.addLeftButton=function(t,e){var i=this._generateButton("icon_arrow_scroll_left","left",null);return i.signals.up.add(this.onInternalButtonClicked,this),void 0==e?i.y=n.STAGE_HEIGHT/2:i.y=e,void 0==t?(this._guiButtons.left=new o(i,function(){i.x=this._leftEdge+this._guiButtonMargins.left}.bind(this)),this.resize()):i.x=t,this.addChild(i),i},s.prototype.addMuteButton=function(t,e){var i=this._generateButton("btns/ui_icon_sound_on","mute","blue");return void 0==e?i.y=this._guiButtonMargins.top:i.y=e,void 0==t?(this._guiButtons.mute=new o(i,function(){i.x=this._rightEdge-this._guiButtonMargins.right,this._guiButtons.pause&&(i.x-=this._guiButtonMargins.minSpacing),this._guiButtons.help&&(i.x-=this._guiButtonMargins.minSpacing)}.bind(this)),this.resize()):i.x=t,this.addChild(i),i},s.prototype.addHomeButton=function(t,e){var i=this._generateButton("btns/ui_icon_home","home","blue");return i.signals.up.addOnce(this.onGUIButtonClicked,this),void 0==e?i.y=this._guiButtonMargins.top:i.y=e,void 0==t?(this._guiButtons.home=new o(i,function(){i.x=this._leftEdge+this._guiButtonMargins.left,p3.Device.isMobile&&(i.x+=80)}.bind(this)),this.resize()):i.x=t,this.addChild(i),i},s.prototype.addCoinCounter=function(t,e){var i=new PIXI.Sprite(n.assets.getTexture("ui_tokens_bg"));return i.scale.set(.65),i.anchor.set(0,.5),i.label=n.createText(n.savedData.coins,{size:60}),i.label.x=200,i.label.y=-12,i.addChild(i.label),void 0==e?i.y=this._guiButtonMargins.top:i.y=e,void 0==t?(this._guiButtons.coin=new o(i,function(){i.x=this._leftEdge+this._guiButtonMargins.left,(this._guiButtons.back||this._guiButtons.home)&&(i.x+=this._guiButtonMargins.minSpacing-40),p3.Device.isMobile&&(i.x+=80)}.bind(this)),this.resize()):i.x=t,this.addChild(i),this._coinCounter=i,this._coinCounter.value=n.savedData.coins,i},s.prototype.addOverlay=function(){var t=new PIXI.Sprite(PIXI.Texture.WHITE);return t.alpha=.85,t.tint=0,t.width=n.STAGE_WIDTH,t.height=n.STAGE_HEIGHT,t.hitArea=new PIXI.Rectangle(0,0,n.STAGE_WIDTH,n.STAGE_HEIGHT),t.interactive=!0,this.addChild(t),t},s.prototype.hideButton=function(t,e,i){t.interactive=!1,n.animator.add(TweenMax.to(t.scale,void 0==i?.3:i,{delay:e||0,x:0,y:0,ease:Back.easeIn}))},s.prototype.showButton=function(t,e,i){n.animator.add(TweenMax.to(t.scale,void 0==i?.3:i,{delay:e||0,x:t.defaultScale.x,y:t.defaultScale.y,ease:Back.easeOut,onCompleteScope:this,onComplete:function(){t.interactive=!0}}))},s.prototype.resize=function(){this.x=.5*(p3.View.width-n.STAGE_WIDTH),this._rightEdge=this._centre.x+p3.View.width/2,this._leftEdge=this._centre.x-p3.View.width/2;for(var t in this._guiButtons)this._guiButtons[t].setX&&this._guiButtons[t].setX()},s.prototype.hideGUI=function(){TweenMax.pauseAll();for(var t in this._guiButtons)this._guiButtons[t].button.interactive&&(this._guiButtons[t].button.visible=!1)},s.prototype.showGUI=function(){TweenMax.resumeAll();for(var t in this._guiButtons)this._guiButtons[t].button.interactive&&(this._guiButtons[t].button.visible=!0)},s.prototype._generateButton=function(t,e,i){var s,o="string"==typeof t?n.assets.getTexture(t):t,a=new p3.ButtonStates(null==i?o:n.assets.getTexture("btns/ui_btn_"+i+"_out"),null==i?o:n.assets.getTexture("btns/ui_btn_"+i+"_over"),null==i?o:n.assets.getTexture("btns/ui_btn_"+i+"_down"),o);return"mute"==e?(a.iconAlt=n.assets.getTexture("btns/ui_icon_sound_off"),s=new p3.MuteButton(a)):s=new p3.Button(a),s.id=e,s.signals.up.add(function(){n.audio.playSound("sfx_btn_click_00")},this),s.signals.over.add(function(){n.audio.playSound("sfx_btn_rollover_00")},this),s},s.prototype._generatePlaceholderButtonRect=function(t,e,i){return n.displayObjects.generatePlaceholderButton("rectangle",t,e,i)},s.prototype._generatePlaceholderButtonCirc=function(t,e,i){return n.displayObjects.generatePlaceholderButton("circle",t,e,i)},s.prototype.onGUIButtonClicked=function(t){"back"==t.id?this.signals.previous.dispatch(t.id):this.signals.guiClick.dispatch(t.id)},s.prototype.onInternalButtonClicked=function(t){},s.prototype.onNextButtonClicked=function(t){this.signals.next.dispatch(t.id)},s.prototype.onPreviousButtonClicked=function(t){this.signals.previous.dispatch(t.id)}},{"../Common":3,"../ui/GUIbuttonData":82}],78:[function(t,e,i){function s(t){this._skillId=t||"magnet",this._skillData=n.savedData.getSkillData(this._skillId),this._skillCost=n.savedData.getNextSkillLevelCost(this._skillId),this._skillLevel=n.savedData.getCharacterSkillLevel(this._skillId),this._canBeBought=this._skillCost<=n.savedData.coins,o.call(this)}var n=t("../Common"),o=t("./SimpleScene");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.init=function(){o.prototype.init.call(this),this._bg=this.addOverlay(),this._container=new PIXI.Container,this._container.x=n.STAGE_WIDTH/2,this._container.y=n.STAGE_HEIGHT/2,this.addChild(this._container),this._messageBox=new PIXI.Sprite(n.assets.getTexture("ui_results_panel_bg")),this._messageBox.anchor.set(.5),this._messageBox.x=0,this._messageBox.y=-110,this._container.addChild(this._messageBox),this._messageBox.icon=new PIXI.Sprite(n.assets.getTexture(this._skillData.texture)),this._messageBox.icon.anchor.set(.5),this._messageBox.icon.y=-160,this._messageBox.addChild(this._messageBox.icon),this._messageBox.skillName=n.createText(this._skillData.label,{size:60}),this._messageBox.skillName.text+=" "+(this._skillLevel+1),this._messageBox.skillName.y=-60,this._messageBox.addChild(this._messageBox.skillName),this._messageBox.description=n.createText(this._canBeBought?"ARE_YOU_SURE":"NOT_ENOUGH_COINS",{size:40}),this._messageBox.description.y=20,this._messageBox.description.tint=16761610,this._messageBox.addChild(this._messageBox.description),this._priceBox=new PIXI.Sprite(n.assets.getTexture("ui_results_panel_tokens_bg")),this._priceBox.anchor.set(.5),this._priceBox.x=0,this._priceBox.y=100,this._container.addChild(this._priceBox),this._priceBox.coins=new PIXI.Sprite(n.assets.getTexture("ui_tokens_bg")),this._priceBox.coins.anchor.set(.5),this._priceBox.coins.y=-10,this._priceBox.addChild(this._priceBox.coins),this._priceBox.coins.label=n.createText("-"+this._skillCost,{size:60}),this._priceBox.coins.label.x=40,this._priceBox.coins.label.y=-12,this._priceBox.coins.addChild(this._priceBox.coins.label),this._buyButton=this._generateButton("btns/ui_icon_tick_big","confir,","red"),this._buyButton.x=120,this._buyButton.y=280,this._buyButton.signals.down.addOnce(this.onBuyClick,this),this._canBeBought&&this._container.addChild(this._buyButton),this._closeButton=this._generateButton("btns/ui_icon_cross_big","cancel","red"),this._closeButton.x=this._canBeBought?-this._buyButton.x:0,this._closeButton.y=this._buyButton.y,this._closeButton.signals.down.addOnce(this.onCloseClick,this),this._container.addChild(this._closeButton);var t=this.addBackButton();t.visible=!1},s.prototype.update=function(){},s.prototype.resize=function(){o.prototype.resize.call(this)},s.prototype.dispose=function(){},s.prototype.animateIn=function(t,e){o.prototype.animateIn.call(this);var i=this.createTimeline({onCompleteScope:e,onComplete:t});i.from(this._bg,.5,{alpha:0,ease:Sine.easeInOut},0);var s=this._messageBox.x;i.fromTo(this._messageBox,.25,{x:s+600},{x:s+90,ease:Linear.easeNone},0),i.to(this._messageBox,.5,{x:s,ease:Back.easeOut},.25),i.from(this._messageBox,.35,{alpha:0,ease:Sine.easeOut},0);var s=this._priceBox.x,n=.2;i.fromTo(this._priceBox,.25,{x:s-450},{x:s-45,ease:Linear.easeNone},n),i.to(this._priceBox,.5,{x:s,ease:Back.easeOut},n+.25),i.from(this._priceBox,.35,{alpha:0,ease:Sine.easeOut},n),i.from(this._buyButton.scale,.5,{x:0,y:0,ease:Back.easeOut},.75),i.from(this._closeButton.scale,.5,{x:0,y:0,ease:Back.easeOut},.9),i.from(this._messageBox.icon,.5,{y:0,ease:Back.easeOut},.35),i.from(this._messageBox.icon,.5,{alpha:0,ease:Sine.easeOut},.35),i.from(this._messageBox.skillName,.5,{alpha:0,ease:Sine.easeOut},.35),i.from(this._messageBox.description,.5,{alpha:0,ease:Sine.easeOut},.35),i.from(this._priceBox.coins,.5,{alpha:0,ease:Sine.easeOut},.35)},s.prototype.animateOut=function(t,e){o.prototype.animateOut.call(this);var i=this.createTimeline({onCompleteScope:e,onComplete:t});i.to(this,.25,{alpha:0,ease:Sine.easeIn},0)},s.prototype.onCloseClick=function(){this.animateOut(function(){this.signals.previous.dispatch()},this)},s.prototype.onBuyClick=function(){this.animateOut(function(){this.signals.next.dispatch(this._skillId)},this)}},{"../Common":3,"./SimpleScene":77}],79:[function(t,e,i){function s(){o.call(this),this._navIndex=0,this._parallaxItems=[],n.audio.playMusic("music_main_menu_oop",{loop:!0,fadeIn:1})}var n=t("../Common"),o=t("./SimpleScene"),a=t("../ui/MenuPanel"),r=t("../game/effects/EffectSplashDust");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.init=function(){o.prototype.init.call(this),this._panels=new PIXI.Container,this.addChild(this._panels),this._bg=new PIXI.Sprite(n.assets.getTexture("splash_bg")),this._bg.x=n.STAGE_WIDTH/2,this._bg.y=n.STAGE_HEIGHT/2,this._bg.anchor.set(.5),this._bg.interactive=!0,this._panels.addChild(this._bg),this.spine=new PIXI.spine.Spine(Spine.rays),this.spine.skeleton.setToSetupPose(),this.spine.skeleton.setSkin(null),this.spine.skeleton.setSkinByName("default"),this.spine.x=n.STAGE_WIDTH/2,this.spine.y=n.STAGE_HEIGHT/2+120,this.spine.autoUpdate=!0,this.spine.update(0),this.spine.state.setAnimation(0,"default",!0,1),this.spine.state.timeScale=.33,this._panels.addChild(this.spine),this.spine=new PIXI.spine.Spine(Spine.rays),this.spine.skeleton.setToSetupPose(),this.spine.skeleton.setSkin(null),this.spine.skeleton.setSkinByName("default"),this.spine.x=n.STAGE_WIDTH/2,this.spine.y=n.STAGE_HEIGHT/2+120,this.spine.autoUpdate=!0,this.spine.update(0),this.spine.state.setAnimation(0,"default",!0,1),this.spine.state.timeScale=.245765,this._panels.addChild(this.spine),this._container=new PIXI.Container,this._container.x=n.STAGE_WIDTH/2,this._container.y=n.STAGE_HEIGHT,this._panels.addChild(this._container),this._mg=new PIXI.Sprite(n.assets.getTexture("ui_splash_mg")),this._mg.anchor.set(.5,1),this._container.addChild(this._mg),this.addParallaxItem(this._mg,.02);for(var t=[{texture:"ui_splash_rock_01",x:-600,y:-650,parallax:.08,"float":!0},{texture:"ui_splash_rock_02",x:230,y:-570,parallax:.07,"float":!0},{texture:"ui_splash_rock_03",x:620,y:-700,parallax:.06,"float":!0},{texture:"ui_splash_rock_04",x:-300,y:-350,parallax:.05,"float":!0},{texture:"ui_splash_rock_05",x:340,y:-270,parallax:.04,"float":!0},{texture:"ui_char_falcon",x:520,y:-440,parallax:.03,"float":!0},{texture:"ui_char_black_panther",x:520,y:-250,parallax:.04,"float":!0},{texture:"ui_char_hawkeye",x:-610,y:-290,parallax:.04,"float":!0},{texture:"ui_char_thor",x:-320,y:-300,parallax:.06,"float":!0},{texture:"ui_char_iron_man",x:240,y:-240,parallax:.06,"float":!0},{texture:"ui_char_hulk",x:0,y:-40,parallax:.05,"float":!1},{texture:"ui_char_captain_america",x:-440,y:-10,parallax:.07,"float":!1},{texture:"ui_char_black_widow",x:460,y:-20,parallax:.07,"float":!1}],e=0;e<t.length;e++){var i=new PIXI.Sprite(n.assets.getTexture(t[e].texture));if(i.anchor.set(.5,1),i.x=.8*t[e].x,i.y=t[e].y,i.originalPosition=new PIXI.Point(i.x,i.y),this._container.addChild(i),this.addParallaxItem(i,t[e].parallax),t[e]["float"]){var s=120*t[e].parallax,h=this.createTimeline();h.fromTo(i,p3.Utils.randomRange(2,4),{y:i.y+s},{y:i.y-s,ease:Sine.easeInOut,repeat:-1,yoyo:!0},0).seek(Math.random())}}this._smoke=new PIXI.Container,this._container.addChild(this._smoke),this._smokePS=new r(this._smoke);var l=new PIXI.Sprite(n.assets.getTexture("copyright_marvel"));l.anchor.set(.5),l.y=-20,this._container.addChild(l),this._logo=new PIXI.Sprite(n.assets.getTexture("ui_logo")),this._logo.anchor.set(.5),this._logo.y=-n.STAGE_HEIGHT/2-260,this._logo.scale.set(.75),this._container.addChild(this._logo),this.addParallaxItem(this._logo,.09);var c=new PIXI.Sprite(n.assets.getTexture("ui_title"));c.anchor.set(.5),c.y=106,this._logo.addChild(c),this._playButton=this._generateButton("btns/ui_icon_play","play","red"),this._playButton.x=-200,this._playButton.y=-n.STAGE_HEIGHT/2+120,this._playButton.signals.up.add(this.onPlayStoryButtonClick,this),this._container.addChild(this._playButton),this._playButtonLabel=new PIXI.Sprite(n.assets.getTexture("ui_mode_bg")),this._playButtonLabel.anchor.set(.475,.5),this._playButtonLabel.x=this._playButton.x,this._playButtonLabel.y=this._playButton.y+110,this._container.addChild(this._playButtonLabel);var p=n.createText("STORY",{size:35,bitmapFont:n.bitmapFontTitle});p.y=-5,this._playButtonLabel.addChild(p),this._endlessButton=this._generateButton("btns/ui_icon_play","play","red"),this._endlessButton.x=-this._playButton.x,this._endlessButton.y=this._playButton.y,this._endlessButton.signals.up.add(this.onPlayEndlessButtonClick,this),this._container.addChild(this._endlessButton),this._endlessButtonLabel=new PIXI.Sprite(n.assets.getTexture("ui_mode_bg")),this._endlessButtonLabel.anchor.set(.475,.5),this._endlessButtonLabel.x=this._endlessButton.x,this._endlessButtonLabel.y=this._playButtonLabel.y,this._container.addChild(this._endlessButtonLabel);var p=n.createText("ENDLESS",{size:35,bitmapFont:n.bitmapFontTitle});p.y=-5,this._endlessButtonLabel.addChild(p),this._endlessScoreLabel=new PIXI.Sprite(n.assets.getTexture("ui_distance_bg")),this._endlessScoreLabel.anchor.set(.5),this._endlessScoreLabel.x=this._endlessButtonLabel.x,this._endlessScoreLabel.y=this._endlessButtonLabel.y+50,this._endlessScoreLabel.scale.set(.5),this._container.addChild(this._endlessScoreLabel);var d=n.createText(n.savedData.endlessRecord,{size:60});d.x=35,d.y=-15,this._endlessScoreLabel.addChild(d),this._leftPanel=new a,this._leftPanel.x=-1330,this._panels.addChild(this._leftPanel),this._leftPanel.initGoalsPanel(),this._rightPanel=new a,this._rightPanel.x=1330,this._panels.addChild(this._rightPanel);var u=[];u.push({text:"TIPS_CAPTAIN_AMERICA",images:["help/ui_help_gameplay_bg","tips/ui_tips_captain_america","tips/ui_tips_enemy_alive"]}),u.push({text:"TIPS_IRON_MAN",images:["help/ui_help_gameplay_bg","tips/ui_tips_iron_man","tips/ui_tips_enemy_alive"]}),u.push({text:"TIPS_BLACK_WIDOW",images:["help/ui_help_gameplay_bg","tips/ui_tips_black_widow","tips/ui_tips_enemy_alive"]}),u.push({text:"TIPS_THOR",images:["help/ui_help_gameplay_bg","tips/ui_tips_switch","tips/ui_tips_thor"]}),u.push({text:"TIPS_FALCON",images:["help/ui_help_gameplay_bg","tips/ui_tips_falcon","tips/ui_tips_enemy_alive"]}),u.push({text:"TIPS_BLACK_PANTHER",images:["help/ui_help_gameplay_bg","tips/ui_tips_black_panther","tips/ui_tips_enemy_alive"]}),u.push({text:"TIPS_HAWKEYE",images:["help/ui_help_gameplay_bg","tips/ui_tips_hawkeye","tips/ui_tips_enemy_dead"]}),u.push({text:"TIPS_HULK",images:["help/ui_help_gameplay_bg","tips/ui_tips_hulk","tips/ui_tips_cage"]}),this._rightPanel.initComPanel(u),this.addMuteButton(),this.addHelpButton();var _=new p3.ButtonStates(n.assets.getTexture("btns/ui_btn_side_out_left"),n.assets.getTexture("btns/ui_btn_side_over_left"),n.assets.getTexture("btns/ui_btn_side_down_left"),n.assets.getTexture("btns/ui_icon_prev_big_left"));this._prevButton=new p3.Button(_),this._prevButton.animate=!1,this._prevButton.children[1].x-=10,this._prevButton.y=n.STAGE_HEIGHT/2,this._prevButton.signals.down.add(this.onPrevButtonClick,this),this.addChild(this._prevButton),this._prevButton.signals.down.add(function(){n.audio.playSound("sfx_btn_click_00")},this),this._prevButton.signals.over.add(function(){n.audio.playSound("sfx_btn_rollover_00")},this);var _=new p3.ButtonStates(n.assets.getTexture("btns/ui_btn_side_out_right"),n.assets.getTexture("btns/ui_btn_side_over_right"),n.assets.getTexture("btns/ui_btn_side_down_right"),n.assets.getTexture("btns/ui_icon_prev_big_right"));this._nextButton=new p3.Button(_),this._nextButton.animate=!1,this._nextButton.children[1].x+=10,this._nextButton.y=n.STAGE_HEIGHT/2,this._nextButton.signals.down.add(this.onNextButtonClick,this),this.addChild(this._nextButton),this._nextButton.signals.down.add(function(){n.audio.playSound("sfx_btn_click_00")},this),this._nextButton.signals.over.add(function(){n.audio.playSound("sfx_btn_rollover_00")},this)},s.prototype.show=function(){},s.prototype.hide=function(){},s.prototype.destroy=function(){this._smokePS.destroy(),o.prototype.destroy.call(this)},s.prototype.update=function(){},s.prototype.resize=function(){o.prototype.resize.call(this),this._introTimeline&&(this._introTimeline.progress(1,!1).kill(),this._introTimeline=null),this._prevButton&&(this._prevButton.x=this._leftEdge+58),this._nextButton&&(this._nextButton.x=this._rightEdge-58)},s.prototype.dispose=function(){},s.prototype.appear=function(t,e){o.prototype.animateIn.call(this),t&&t.call(e),this._prevButton.interactive=!1,this._nextButton.interactive=!1,this._introTimeline=this.createTimeline({delay:0,onCompleteScope:this,onComplete:function(){this._prevButton.interactive=!0,this._nextButton.interactive=!0,this._introTimeline.kill(),this._introTimeline=null}}),this._introTimeline.from(this._container.scale,1,{x:.8,y:.8,ease:Sine.easeInOut},0),this._introTimeline.from(this._leftPanel,1,{x:this._leftPanel.x+400,ease:Sine.easeInOut},0),this._introTimeline.from(this._rightPanel,1,{x:this._rightPanel.x-400,ease:Sine.easeInOut},0),this._introTimeline.fromTo(this._prevButton,.5,{x:this._prevButton.x-this._prevButton.width},{x:this._prevButton.x,ease:Quad.easeOut},1),this._introTimeline.fromTo(this._nextButton,.5,{x:this._nextButton.x+this._nextButton.width},{x:this._nextButton.x,ease:Quad.easeOut},1)},s.prototype.animateOut=function(t,e){o.prototype.animateOut.call(this),t&&t.call(e)},s.prototype.movePanels=function(t){if(!this._navAnimation){this._navIndex+=t,this._navAnimation=this.createTimeline({onCompleteScope:this,onComplete:function(){this._navAnimation=null}}),this._navAnimation.to(this._panels,.5,{x:-1030*this._navIndex,ease:Sine.easeInOut},0),this._prevButton.interactive=this._navIndex>-1,this._nextButton.interactive=this._navIndex<1,this._navAnimation.to(this._prevButton,.5,{alpha:this._prevButton.interactive?1:0,ease:Sine.easeInOut},0),this._navAnimation.to(this._nextButton,.5,{alpha:this._nextButton.interactive?1:0,ease:Sine.easeInOut},0),this._navAnimation.to(this._leftPanel,.5,{x:this._leftPanel.x-300*t,ease:Sine.easeInOut},0),this._navAnimation.to(this._rightPanel,.5,{x:this._rightPanel.x-300*t,ease:Sine.easeInOut},0);var e=0==this._navIndex?1:0;this._navAnimation.to(this._playButton,.5,{alpha:e,ease:Sine.easeInOut},0),this._navAnimation.to(this._endlessButton,.5,{alpha:e,ease:Sine.easeInOut},0),this._navAnimation.to(this._playButtonLabel,.5,{alpha:e,ease:Sine.easeInOut},0),this._navAnimation.to(this._endlessButtonLabel,.5,{alpha:e,ease:Sine.easeInOut},0),this._navAnimation.to(this._endlessScoreLabel,.5,{alpha:e,ease:Sine.easeInOut},0)}},s.prototype.addParallaxItem=function(t,e){t.parallax=e,this._parallaxItems.push(t)},s.prototype.onPlayStoryButtonClick=function(){n.savedData.endless=!1,this.signals.next.dispatch()},s.prototype.onPlayEndlessButtonClick=function(){n.savedData.endless=!0,this.signals.next.dispatch()},s.prototype.onPrevButtonClick=function(){this._navIndex<=-1||this.movePanels(-1)},s.prototype.onNextButtonClick=function(){this._navIndex>=1||this.movePanels(1)},s.prototype.onMouseMove=function(t){for(var e=t?t.data.getLocalPosition(this).x:n.STAGE_WIDTH/2,i=-(e-n.STAGE_WIDTH/2),s=0;s<this._parallaxItems.length;s++)this._parallaxItems[s].orX||(this._parallaxItems[s].orX=this._parallaxItems[s].x),this._parallaxItems[s].destX=this._parallaxItems[s].orX+i*this._parallaxItems[s].parallax;this._leftPanel.applyParallax(i,.02),this._rightPanel.applyParallax(i,.02)}},{"../Common":3,"../game/effects/EffectSplashDust":33,"../ui/MenuPanel":84,"./SimpleScene":77}],80:[function(t,e,i){function s(t){this.maskSprite=t,this.maskMatrix=new PIXI.Matrix;
var e="varying lowp vec2 vFilterCoord;    varying lowp vec2 vTextureCoord;    uniform lowp sampler2D uSampler;    uniform lowp float percentage;    uniform lowp float alphaDisabled;    uniform mat3 mappedMatrix;    float atan2(float y, float x){return 2.0 * atan(y / (sqrt(x * x + y * y) + x));}    float when_lt(float x, float y){return max(sign(y - x), 0.0);}    void main(){        lowp vec2 center  = vec2(0.52, 0.45);        lowp float pi     = 3.14;        lowp vec3 uv      = vec3(vTextureCoord, 1.0) * mappedMatrix;        lowp float pAngle = atan2(uv.x - center.x, uv.y - center.y);        lowp vec4 color = texture2D(uSampler, vTextureCoord);        color.a   *= mix(alphaDisabled, 1.0, when_lt((pAngle+pi)/(2.0 * pi), percentage));        color.rgb *= color.a;        gl_FragColor = color;    }";PIXI.Filter.call(this,null,e,{percentage:{type:"f",value:1},alphaDisabled:{type:"f",value:0},mappedMatrix:{type:"mat3",value:this.maskMatrix}})}e.exports=s,s.prototype=Object.create(PIXI.Filter.prototype),s.prototype.constructor=s,s.prototype.apply=function(t,e,i){this.maskSprite?this.uniforms.mappedMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite):t.calculateNormalizedScreenSpaceMatrix(this.uniforms.mappedMatrix),t.applyFilter(this,e,i)}},{}],81:[function(t,e,i){function s(t,e){t=t||1,PIXI.Filter.call(this,"attribute vec2 aVertexPosition;attribute vec2 aTextureCoord;uniform mat3 projectionMatrix;varying vec2 vTextureCoord;void main(void){gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);vTextureCoord = aTextureCoord;}","varying vec2 vTextureCoord;uniform sampler2D uSampler;uniform float thickness;uniform vec4 outlineColor;uniform vec4 filterArea;uniform vec4 filterClamp;vec2 px = vec2(1.0 / filterArea.x, 1.0 / filterArea.y);void main(void) {const float PI = 3.14159265358979323846264;vec4 ownColor = texture2D(uSampler, vTextureCoord);vec4 curColor;float maxAlpha = 0.;vec2 displaced;for (float angle = 0.; angle < PI * 2.; angle += %THICKNESS% ) {displaced.x = vTextureCoord.x + thickness * px.x * cos(angle);displaced.y = vTextureCoord.y + thickness * px.y * sin(angle);curColor = texture2D(uSampler, clamp(displaced, filterClamp.xy, filterClamp.zw));maxAlpha = max(maxAlpha, curColor.a);}float resultAlpha = max(maxAlpha, ownColor.a);gl_FragColor = vec4((ownColor.rgb + outlineColor.rgb * (1. - ownColor.a)) * resultAlpha, resultAlpha); }".replace(/%THICKNESS%/gi,(1/t).toFixed(7))),this.uniforms.thickness=t,this.uniforms.outlineColor=new Float32Array([0,0,0,1]),e&&(this.color=e)}s.prototype=Object.create(PIXI.Filter.prototype),s.prototype.constructor=s,e.exports=s,s.prototype.highlight=function(t,e){this._highlightTimeline&&this._highlightTimeline.kill(),this._highlightTimeline=new TimelineMax,this._highlightTimeline.c=this.color,this._highlightTimeline.b=this.color%256,this._highlightTimeline.g=Math.floor(this.color/256)%256,this._highlightTimeline.r=Math.floor(this.color/65536)%256,this._highlightTimeline.b2=t%256,this._highlightTimeline.g2=Math.floor(t/256)%256,this._highlightTimeline.r2=Math.floor(t/65536)%256,this._highlightTimeline.v=0,this._highlightTimeline.to(this._highlightTimeline,e,{v:1,repeat:-1,yoyo:!0,ease:Sine.easeInOut,onUpdateScope:this,onUpdate:function(){var t=this._highlightTimeline.r+(this._highlightTimeline.r2-this._highlightTimeline.r)*this._highlightTimeline.v,e=this._highlightTimeline.g+(this._highlightTimeline.g2-this._highlightTimeline.g)*this._highlightTimeline.v,i=this._highlightTimeline.b+(this._highlightTimeline.b2-this._highlightTimeline.b)*this._highlightTimeline.v;this.color=(Math.round(t)<<16)+(Math.round(e)<<8)+Math.round(i)}},0)},s.prototype.stopHighlight=function(){this._highlightTimeline&&(this.color=this._highlightTimeline.c,this._highlightTimeline.kill())},Object.defineProperties(s.prototype,{color:{get:function(){return PIXI.utils.rgb2hex(this.uniforms.outlineColor)},set:function(t){PIXI.utils.hex2rgb(t,this.uniforms.outlineColor)}}})},{}],82:[function(t,e,i){"use strict";function s(t,e,i,s){this.button=t,this.setX=e}t("../Common");e.exports=s},{"../Common":3}],83:[function(t,e,i){"use strict";function s(t,e,i){var s=new p3.ButtonStates(n.assets.getTexture("btns/ui_btn_map_out"),n.assets.getTexture("btns/ui_btn_map_over"),n.assets.getTexture("btns/ui_btn_map_down"),n.assets.getTexture(e?"btns/ui_icon_play_small":"btns/ui_icon_lock"));if(p3.Button.call(this,s),this.interactive=e,this.alpha=e?1:.5,this.levelIndex=t,this._label=n.createText(t+1),this._label.y=-75,this.addChild(this._label),e){this._progressBar=new PIXI.Container,this._progressBar.x=-20,this._progressBar.y=60,this._progressBar.scale.set(.5),this.addChild(this._progressBar),this._progressBar.bg=new PIXI.Sprite(n.assets.getTexture("ui_progress_bg")),this._progressBar.bg.anchor.set(.5),this._progressBar.addChild(this._progressBar.bg),this._progressBar.fill=new PIXI.Sprite(n.assets.getTexture("ui_progress_fill")),this._progressBar.fill.anchor.set(0,.5),this._progressBar.fill.x=-240+146*i,this._progressBar.fill.y=-4,this._progressBar.fill.visible=i>0,this._progressBar.addChild(this._progressBar.fill);var o=new PIXI.Sprite(PIXI.Texture.WHITE);o.anchor.set(0,.5),o.width=300,o.height=60,o.x=-80,this._progressBar.addChild(o),this._progressBar.fill.mask=o,this._progressBar.icon=new PIXI.Sprite(n.assets.getTexture("ui_progress_icon")),this._progressBar.icon.anchor.set(.5),this._progressBar.icon.x=-40,this._progressBar.icon.y=8,this._progressBar.addChild(this._progressBar.icon),this.signals.up.add(function(){n.audio.playSound("sfx_btn_click_00")},this),this.signals.over.add(function(){n.audio.playSound("sfx_btn_rollover_00")},this)}}var n=t("../Common");e.exports=s,s.prototype=Object.create(p3.Button.prototype),s.prototype.constructor=s},{"../Common":3}],84:[function(t,e,i){function s(){PIXI.Container.call(this),this._parallaxItems=[],this.init()}var n=t("../Common"),o=t("../shaders/OutlineFilter");e.exports=s,s.prototype=Object.create(PIXI.Container.prototype),s.prototype.constructor=s,s.prototype.init=function(){this._panel=new PIXI.Container,this._panel.x=n.STAGE_WIDTH/2,this._panel.y=n.STAGE_HEIGHT/2,this.addChild(this._panel),this._panel.bg=new PIXI.Sprite(n.assets.getTexture("ui_bg_00")),this._panel.bg.anchor.set(.5),this._panel.addChild(this._panel.bg),this._panel.overlay=new PIXI.Container,this._panel.addChild(this._panel.overlay),this._panel.overlay.lines=new PIXI.Container,this._panel.overlay.addChild(this._panel.overlay.lines);var t=new PIXI.Sprite(n.assets.getTexture("ui_bg_04"));t.anchor.set(0,.5),t.x=-this._panel.bg.width/2+74,this._panel.overlay.lines.addChild(t),this.addParallaxItem(t,.15);var t=new PIXI.Sprite(n.assets.getTexture("ui_bg_04"));t.anchor.set(0,.5),t.x=+this._panel.bg.width/2-74,t.scale.x*=-1,this._panel.overlay.lines.addChild(t),this.addParallaxItem(t,.15),this._panel.overlay.left=new PIXI.Container,this._panel.overlay.left.x-=this._panel.bg.width/2,this._panel.overlay.addChild(this._panel.overlay.left);var e=new PIXI.Sprite(n.assets.getTexture("ui_bg_01"));e.anchor.set(.5),e.x=20,e.y=420,this._panel.overlay.left.addChild(e),this.addParallaxItem(e,.3);var e=new PIXI.Sprite(n.assets.getTexture("ui_bg_01"));e.anchor.set(.5),e.x=160,e.y=300,e.scale.set(.5),this._panel.overlay.left.addChild(e),this.addParallaxItem(e,.5);var e=new PIXI.Sprite(n.assets.getTexture("ui_bg_01"));e.anchor.set(.5),e.x=236,e.y=-250,this._panel.overlay.left.addChild(e),this.addParallaxItem(e,.2);var e=new PIXI.Sprite(n.assets.getTexture("ui_bg_01"));e.anchor.set(.5),e.x=190,e.y=-250,e.scale.set(.5),this._panel.overlay.left.addChild(e),this.addParallaxItem(e,.4),this._panel.overlay.right=new PIXI.Container,this._panel.overlay.right.x+=this._panel.bg.width/2+30,this._panel.overlay.right.scale.x*=-1,this._panel.overlay.addChild(this._panel.overlay.right);var e=new PIXI.Sprite(n.assets.getTexture("ui_bg_01"));e.anchor.set(.5),e.x=65,e.y=420,this._panel.overlay.right.addChild(e),this.addParallaxItem(e,-.3);var e=new PIXI.Sprite(n.assets.getTexture("ui_bg_01"));e.anchor.set(.5),e.x=190,e.y=300,e.scale.set(.5),this._panel.overlay.right.addChild(e),this.addParallaxItem(e,-.5);var e=new PIXI.Sprite(n.assets.getTexture("ui_bg_01"));e.anchor.set(.5),e.x=266,e.y=-250,this._panel.overlay.right.addChild(e),this.addParallaxItem(e,-.2);var e=new PIXI.Sprite(n.assets.getTexture("ui_bg_01"));e.anchor.set(.5),e.x=220,e.y=-250,e.scale.set(.5),this._panel.overlay.right.addChild(e),this.addParallaxItem(e,-.3),this.content=new PIXI.Container,this._panel.addChild(this.content)},s.prototype.update=function(){for(var t=0;t<this._parallaxItems.length;t++)this._parallaxItems[t].x+=.1*(this._parallaxItems[t].destX-this._parallaxItems[t].x)},s.prototype.initTitle=function(t){this.content.title=new PIXI.Container,this.content.title.y=-300,this.content.addChild(this.content.title),this.addParallaxItem(this.content.title,.6);var e=new PIXI.Sprite(n.assets.getTexture("ui_title_frame"));e.anchor.set(.5),this.content.title.addChild(e);var t=n.createText(t,{bitmapFont:n.bitmapFontTitle});t.y-=6,this.content.title.addChild(t)},s.prototype.initComPanel=function(t){this.initTitle("TIPS"),this.content.com=new PIXI.Container,this.content.com.y=10,this.content.com.slides=t,this.content.com.slideIndex=0,this.content.addChild(this.content.com),this.addParallaxItem(this.content.com,.7);var e=new PIXI.Sprite(n.assets.getTexture("ui_bg_02"));e.anchor.set(.5,1),e.x=180,e.y=n.STAGE_HEIGHT/2-this.content.com.y,this.content.com.addChild(e);var e=new PIXI.Sprite(n.assets.getTexture("ui_bg_03"));e.anchor.set(.5,1),e.x=-330,e.y=n.STAGE_HEIGHT/2-this.content.com.y-60,this.content.com.addChild(e);var i=new PIXI.Sprite(n.assets.getTexture("ui_panel"));i.anchor.set(.5),this.content.com.addChild(i),this.content.com.images=new PIXI.Container,this.content.com.addChild(this.content.com.images);var s=new PIXI.Sprite(n.assets.getTexture("ui_text_panel"));s.anchor.set(.5),s.y=280,this.content.com.addChild(s),this.content.com.label=n.createText("PLACEHOLDER",{size:26}),this.content.com.label.y=-6,s.addChild(this.content.com.label),this.content.com.prevButton=n.currentScene._generateButton("btns/ui_icon_prev_left","left","blue"),this.content.com.prevButton.x=-340,this.content.com.prevButton.signals.up.add(function(){a(-1)},this),this.content.com.addChild(this.content.com.prevButton),this.content.com.nextButton=n.currentScene._generateButton("btns/ui_icon_prev_right","right","blue"),this.content.com.nextButton.x=340,this.content.com.nextButton.signals.up.add(function(){a(1)},this),this.content.com.addChild(this.content.com.nextButton);var o=function(){this.content.com.label.text=n.copy[this.content.com.slides[this.content.com.slideIndex].text][n.language].toUpperCase();for(var t=0;t<this.content.com.slides[this.content.com.slideIndex].images.length;t++){if(this.content.com.images.children.length<=t){var e=new PIXI.Sprite(PIXI.Texture.BLANK);e.anchor.set(.5),this.content.com.images.addChild(e)}this.content.com.images.children[t].texture=n.assets.getTexture(this.content.com.slides[this.content.com.slideIndex].images[t]),this.content.com.images.children[t].visible=!0}for(var t=this.content.com.slides[this.content.com.slideIndex].images.length;t<this.content.com.images.children.length;t++)this.content.com.images.children[t].visible=!1}.bind(this),a=function(t){this.content.com.slideIndex+=t,this.content.com.slideIndex<0&&(this.content.com.slideIndex+=this.content.com.slides.length),this.content.com.slideIndex>=this.content.com.slides.length&&(this.content.com.slideIndex-=this.content.com.slides.length),o()}.bind(this);o()},s.prototype.initGoalsPanel=function(){this.initTitle("GOALS"),this.content.goals=new PIXI.Container,this.content.goals.y=30,this.content.addChild(this.content.goals),this.addParallaxItem(this.content.goals,.7);var t=new PIXI.Sprite(n.assets.getTexture("ui_panel"));t.anchor.set(.5),this.content.goals.addChild(t);var e=new PIXI.Sprite(n.assets.getTexture("ui_bg_02"));e.anchor.set(.5,1),e.x=180,e.y=n.STAGE_HEIGHT/2-this.content.goals.y,this.content.goals.addChild(e);var e=new PIXI.Sprite(n.assets.getTexture("ui_bg_03"));e.anchor.set(.5,1),e.x=-330,e.y=n.STAGE_HEIGHT/2-this.content.goals.y-60,this.content.goals.addChild(e),this.content.goals.list=new PIXI.Container,this.content.goals.addChild(this.content.goals.list);for(var i=n.goalsManager.getActiveGoals(),s=1;s>=0;s--)for(var o=0;o<n.goalsManager.goals.length;o++){for(var a=n.goalsManager.goals[o].id,r=n.goalsManager.getGoalStatus(a),h=0==s,l=0;l<i.length;l++)if(i[l].id==a){h=!h;break}if(h){var c=new PIXI.Sprite(n.assets.getTexture("ui_goal_bg"));if(c.anchor.set(.5),c.y=100*this.content.goals.list.children.length-160,this.content.goals.list.addChild(c),r>0){var p=new PIXI.Sprite(n.assets.getTexture("ui_goal_fill"));p.anchor.set(.4,.5),p.x=-(1-r)*p.width,p.tint=1==r?3530019:15261205,c.addChild(p)}var d=new PIXI.Sprite(n.assets.getTexture(n.goalsManager.goals[o].icon));d.anchor.set(0,.5),d.x=-c.width/2,c.addChild(d);var u=n.createText(n.goalsManager.goals[o].label,{size:26});if(u.x=n.r2l?300:-180,u.y=-5,u.anchor.set(n.r2l?1:0,.5),c.addChild(u),1==r){var _=new PIXI.Sprite(n.assets.getTexture("ui_goal_badge"));_.anchor.set(.5),_.x=270,c.addChild(_)}}}var g=new PIXI.Sprite(PIXI.Texture.WHITE);g.anchor.set(.5),g.width=634,g.height=440,this.content.goals.addChild(g),this.content.goals.list.mask=g,this.content.goals.scrollHandle=new PIXI.Sprite(n.assets.getTexture("btns/ui_scroll_out")),this.content.goals.scrollHandle.anchor.set(.5),this.content.goals.scrollHandle.x=372,this.content.goals.scrollHandle.yMin=-150,this.content.goals.scrollHandle.yMax=150,this.content.goals.scrollHandle.y=this.content.goals.scrollHandle.yMin,this.content.goals.scrollHandle.interactive=!0,this.content.goals.addChild(this.content.goals.scrollHandle);var m=function(t){this.content.goals.scrollHandle.texture=n.assets.getTexture("btns/ui_scroll_down"),this.content.goals.scrollHandle.yNow=t.data.getLocalPosition(this).y,this.content.goals.scrollHandle.on("mousemove",f.bind(this)),this.content.goals.scrollHandle.on("touchmove",f.bind(this)),this.content.goals.scrollHandle.on("mousemoveoutside",f.bind(this)),this.content.goals.scrollHandle.on("touchmoveoutside",f.bind(this)),this.content.goals.scrollHandle.on("mouseup",y.bind(this)),this.content.goals.scrollHandle.on("touchend",y.bind(this)),this.content.goals.scrollHandle.on("mouseupoutside",y.bind(this)),this.content.goals.scrollHandle.on("touchendoutside",y.bind(this))}.bind(this),y=function(t){this.content.goals.scrollHandle.texture=n.assets.getTexture("btns/ui_scroll_out"),this.content.goals.scrollHandle.off("mousemove"),this.content.goals.scrollHandle.off("touchmove"),this.content.goals.scrollHandle.off("mousemoveoutside"),this.content.goals.scrollHandle.off("touchmoveoutside"),this.content.goals.scrollHandle.off("mouseup"),this.content.goals.scrollHandle.off("touchend"),this.content.goals.scrollHandle.off("mouseupoutside"),this.content.goals.scrollHandle.off("touchendoutside")}.bind(this),f=function(t){var e=t.data.getLocalPosition(this).y,i=e-this.content.goals.scrollHandle.yNow;this.content.goals.scrollHandle.yNow=e,this.content.goals.scrollHandle.y+=i,this.content.goals.scrollHandle.y=Math.max(this.content.goals.scrollHandle.yMin,this.content.goals.scrollHandle.y),this.content.goals.scrollHandle.y=Math.min(this.content.goals.scrollHandle.yMax,this.content.goals.scrollHandle.y);var s=(this.content.goals.scrollHandle.y-this.content.goals.scrollHandle.yMin)/(this.content.goals.scrollHandle.yMax-this.content.goals.scrollHandle.yMin);this.content.goals.list.y=-(this.content.goals.list.height-420)*s}.bind(this);this.content.goals.scrollHandle.on("mousedown",m.bind(this)),this.content.goals.scrollHandle.on("touchstart",m.bind(this))},s.prototype.initCharacterPanel=function(t){this.content.character=new PIXI.Container,this.content.character.x=t||0,this.content.character.y=-30,this.content.addChildAt(this.content.character);var e=new PIXI.Sprite(n.assets.getTexture("ui_bg_02"));e.anchor.set(.5,1),e.x=140+t,e.y=n.STAGE_HEIGHT/2,this._panel.overlay.lines.addChild(e);var e=new PIXI.Sprite(n.assets.getTexture("ui_bg_03"));e.anchor.set(.5,1),e.x=-220+t,e.y=n.STAGE_HEIGHT/2-60,this._panel.overlay.lines.addChild(e);var i=new PIXI.Container;this.content.character.addChild(i),this.addParallaxItem(i,.6),this.content.character.image=new PIXI.Sprite(n.assets.getTexture("ui_char_thor")),this.content.character.image.anchor.set(.5,1),this.content.character.image.x=250,this.content.character.image.y=n.STAGE_HEIGHT/2-this.content.character.y,this.content.character.image.outline=new o(2,16777215),i.addChild(this.content.character.image);var s=new PIXI.Container;this.content.character.addChild(s),this.addParallaxItem(s,.7),this.content.character.title=n.createText("PLACEHOLDERMAN",{bitmapFont:n.bitmapFontTitle,size:80}),this.content.character.title.y=-160,s.addChild(this.content.character.title),this.content.character.skills=[];for(var a=0;a<n.config.skills.length;a++){var r=new PIXI.Container;this.content.character.addChild(r),this.addParallaxItem(r,.8+.2*a);var h=new PIXI.Sprite(n.assets.getTexture("ui_ability_bg"));h.anchor.set(.5),h.id=n.config.skills[a].id,h.x=20+20*a,h.y=50+180*a,h.scale.set(.9),r.addChild(h);var l=new PIXI.Sprite(n.assets.getTexture(n.config.skills[a].texture));l.anchor.set(.5),l.x=-210,l.scale.set(.75),h.addChild(l);var c=n.createText(n.config.skills[a].label,{size:40});c.anchor.set(0,.5),c.x=-130,c.y=-36,h.addChild(c),h.bars=[];for(var p=0;p<3;p++){var d=new PIXI.Sprite(n.assets.getTexture("ui_ability_fill"));d.anchor.set(.5),d.x=126*p-78,d.y=25.5,h.addChild(d),h.bars.push(d)}var u=function(t){var e=t.id;n.currentScene.signals.skillUpgrade.dispatch(e)};h.plusButton=n.currentScene._generateButton(null,"upgrade","upgrade"),h.plusButton.id=n.config.skills[a].id,h.plusButton.position.copy(h.bars[0].position),h.plusButton.signals.up.add(u,this),h.addChild(h.plusButton),h.plusButton.disabledFilter=new PIXI.filters.ColorMatrixFilter,h.plusButton.disabledFilter.desaturate(),h.plusButton.filters=[],h.plusButton.timeline=n.currentScene.createTimeline(),h.plusButton.timeline.to(h.plusButton.scale,1,{x:1.2,y:1.2,ease:Sine.easeInOut,repeat:-1,yoyo:!0},0),this.content.character.skills.push(h)}this.changeCharacter(0)},s.prototype.changeCharacter=function(t){if(this.content.character&&!this._characterTimeline){n.savedData.changeCharacter(t||0);var e=n.savedData.isCharacterUnlocked(),i=function(){var t=n.savedData.getCharacterData();if(this.content.character.title.scale.set(1),this.content.character.title.text=e?t.name:n.copy.LOCKED[n.language].toUpperCase(),this.content.character.title.y=e?-160:0,this.content.character.title.width>500&&(this.content.character.title.text=n.copy.characters[t.id].name[n.language].replace(" ","\n").toUpperCase()),0==(this.content.character.title.text.match(/\n/g)||[]).length)for(;this.content.character.title.width<400&&this.content.character.title.scale.x<1.5;)this.content.character.title.scale.set(this.content.character.title.scale.x+.05)}.bind(this),s=function(){var t=n.savedData.getCharacterData();this.content.character.image.texture=n.assets.getTexture("ui_char_sel_"+t.id),this.content.character.image.tint=e?16777215:1644851,this.content.character.image.filters=e?[]:[this.content.character.image.outline]}.bind(this),o=function(t){var i=this.content.character.skills[t].id,s=n.savedData.getCharacterSkillLevel(i);this.content.character.skills[t].visible=e;for(var o=0;o<3;o++)this.content.character.skills[t].bars[o].visible=o<s;var a=this.content.character.skills[t].plusButton;if(a.visible=s<3,a.visible){a.position.copy(this.content.character.skills[t].bars[s].position);var r=n.savedData.getNextSkillLevelCost(i);r>n.savedData.coins&&0==a.filters.length?(a.filters=[a.disabledFilter],a.timeline.seek(0).stop()):r<=n.savedData.coins&&0!=a.filters.length&&(a.filters=[],a.timeline.play())}}.bind(this),a=function(){for(var t=0;t<this.content.character.skills.length;t++)o(t)}.bind(this);if(0==t)i(),s(),a();else{this._characterTimeline=new TimelineMax({onCompleteScope:this,onComplete:function(){this._characterTimeline=null}});var r=.25;this._characterTimeline.to(this.content.character.title,r,{alpha:0,x:this.content.character.title.x+100*Math.sign(t),ease:Sine.easeOut,onCompleteScope:this,onComplete:function(e){this.content.character.title.x-=200*Math.sign(t),i()}},0),this._characterTimeline.to(this.content.character.title,r,{alpha:1,x:this.content.character.title.x,ease:Sine.easeOut},r);for(var h=0;h<this.content.character.skills.length;h++){var l=.1*(h+1);this._characterTimeline.to(this.content.character.skills[h],r,{alpha:0,x:this.content.character.skills[h].x+50*Math.sign(t),ease:Sine.easeOut,onCompleteParams:[h],onCompleteScope:this,onComplete:function(e){this.content.character.skills[e].x-=100*Math.sign(t),o(e)}},l),this._characterTimeline.to(this.content.character.skills[h],r,{alpha:1,x:this.content.character.skills[h].x,ease:Sine.easeOut},r+l)}this._characterTimeline.to(this.content.character.image,r,{alpha:0,x:this.content.character.image.x+150*Math.sign(t),ease:Sine.easeOut,onCompleteScope:this,onComplete:function(){this.content.character.image.x-=300*Math.sign(t),s()}},0),this._characterTimeline.to(this.content.character.image,r,{alpha:1,x:this.content.character.image.x,ease:Sine.easeOut},r)}}},s.prototype.addParallaxItem=function(t,e){t.parallax=e,this._parallaxItems.push(t)},s.prototype.applyParallax=function(t,e){for(var i=0;i<this._parallaxItems.length;i++)this._parallaxItems[i].orX||(this._parallaxItems[i].orX=this._parallaxItems[i].x),this._parallaxItems[i].destX=this._parallaxItems[i].orX+this._parallaxItems[i].parallax*t*e}},{"../Common":3,"../shaders/OutlineFilter":81}],85:[function(t,e,i){function s(t,e,i){p3.Button.call(this,t),this._onIconTexture=e,this._offIconTexture=i,this.updateIcon()}var n=t("../Common");e.exports=s,s.prototype=Object.create(p3.Button.prototype),s.prototype.constructor=s,s.prototype.onMouseDown=function(t){n.audio.mute(!n.audio.isMute),this.updateIcon(),p3.Button.prototype.onMouseDown.call(this,t)},s.prototype.updateIcon=function(){this._currentIconTexture=this.isEnabled()?this._onIconTexture:this._offIconTexture,this._icon.texture=this._currentIconTexture},s.prototype.isEnabled=function(){return!!p3.Button.audio&&!p3.Button.audio.isMute}},{"../Common":3}],86:[function(t,e,i){function s(t){PIXI.Container.call(this),this._angle=90,this._spin=!1,this._spinSpeed=0,this._bonus=t,this.init()}var n=t("../Common");e.exports=s,s.prototype=Object.create(PIXI.Container.prototype),s.prototype.constructor=s,s.prototype.init=function(){this._sprite=new PIXI.Sprite(n.assets.getTexture("btns/token_05")),this._sprite.anchor.set(.5),this._sprite.scale.set(.75),this.addChild(this._sprite),this._value=n.createText(""+this._bonus,{size:60}),this._value.y-=10,this._value.alpha=0,this.addChild(this._value),this.interactive=!0,this.buttonMode=!0},s.prototype.update=function(){this._angle+=this._spinSpeed*p3.Timestep.deltaTime,this._angle<0?this._angle=180-Math.abs(this._angle)%180:this._angle=this._angle%180;var t=Math.floor(this._angle/18);this._sprite.texture=n.assets.getTexture("btns/token_0"+t),this._spin||0==this._spinSpeed||5!=t||(this._spinSpeed=0)},s.prototype.spin=function(t){this._spin=!0,this._spinSpeed=t||270},s.prototype.stopSpin=function(){this._spin=!1},s.prototype.showValue=function(t,e){var i=n.currentScene.createTimeline();i.to(this._value,t||1,{alpha:1,ease:Sine.easeInOut},e||0)},Object.defineProperty(s.prototype,"bonus",{get:function(){return this._bonus}})},{"../Common":3}]},{},[63]);