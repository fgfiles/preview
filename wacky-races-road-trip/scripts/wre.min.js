!function t(e,i,s){function n(a,r){if(!i[a]){if(!e[a]){var h="function"==typeof require&&require;if(!r&&h)return h(a,!0);if(o)return o(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var u=i[a]={exports:{}};e[a][0].call(u.exports,function(t){var i=e[a][1][t];return n(i?i:t)},u,u.exports,t,e,i,s)}return i[a].exports}for(var o="function"==typeof require&&require,a=0;a<s.length;a++)n(s[a]);return n}({1:[function(t,e,i){(function(i){t("./polyfill");var s=e.exports=t("./core");Object.assign(s,t("./extras")),i.WRE=s}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./core":93,"./extras":127,"./polyfill":132}],2:[function(t,e,i){"use strict";function s(t,e,i){this.fn=t,this.context=e,this.once=i||!1}function n(){}var o=Object.prototype.hasOwnProperty,a="function"!=typeof Object.create&&"~";n.prototype._events=void 0,n.prototype.eventNames=function(){var t,e=this._events,i=[];if(!e)return i;for(t in e)o.call(e,t)&&i.push(a?t.slice(1):t);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},n.prototype.listeners=function(t,e){var i=a?a+t:t,s=this._events&&this._events[i];if(e)return!!s;if(!s)return[];if(s.fn)return[s.fn];for(var n=0,o=s.length,r=new Array(o);n<o;n++)r[n]=s[n].fn;return r},n.prototype.emit=function(t,e,i,s,n,o){var r=a?a+t:t;if(!this._events||!this._events[r])return!1;var h,l,u=this._events[r],p=arguments.length;if("function"==typeof u.fn){switch(u.once&&this.removeListener(t,u.fn,void 0,!0),p){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,e),!0;case 3:return u.fn.call(u.context,e,i),!0;case 4:return u.fn.call(u.context,e,i,s),!0;case 5:return u.fn.call(u.context,e,i,s,n),!0;case 6:return u.fn.call(u.context,e,i,s,n,o),!0}for(l=1,h=new Array(p-1);l<p;l++)h[l-1]=arguments[l];u.fn.apply(u.context,h)}else{var c,d=u.length;for(l=0;l<d;l++)switch(u[l].once&&this.removeListener(t,u[l].fn,void 0,!0),p){case 1:u[l].fn.call(u[l].context);break;case 2:u[l].fn.call(u[l].context,e);break;case 3:u[l].fn.call(u[l].context,e,i);break;default:if(!h)for(c=1,h=new Array(p-1);c<p;c++)h[c-1]=arguments[c];u[l].fn.apply(u[l].context,h)}}return!0},n.prototype.on=function(t,e,i){var n=new s(e,i||this),o=a?a+t:t;return this._events||(this._events=a?{}:Object.create(null)),this._events[o]?this._events[o].fn?this._events[o]=[this._events[o],n]:this._events[o].push(n):this._events[o]=n,this},n.prototype.once=function(t,e,i){var n=new s(e,i||this,(!0)),o=a?a+t:t;return this._events||(this._events=a?{}:Object.create(null)),this._events[o]?this._events[o].fn?this._events[o]=[this._events[o],n]:this._events[o].push(n):this._events[o]=n,this},n.prototype.removeListener=function(t,e,i,s){var n=a?a+t:t;if(!this._events||!this._events[n])return this;var o=this._events[n],r=[];if(e)if(o.fn)(o.fn!==e||s&&!o.once||i&&o.context!==i)&&r.push(o);else for(var h=0,l=o.length;h<l;h++)(o[h].fn!==e||s&&!o[h].once||i&&o[h].context!==i)&&r.push(o[h]);return r.length?this._events[n]=1===r.length?r[0]:r:delete this._events[n],this},n.prototype.removeAllListeners=function(t){return this._events?(t?delete this._events[a?a+t:t]:this._events=a?{}:Object.create(null),this):this},n.prototype.off=n.prototype.removeListener,n.prototype.addListener=n.prototype.on,n.prototype.setMaxListeners=function(){return this},n.prefixed=a,"undefined"!=typeof e&&(e.exports=n)},{}],3:[function(t,e,i){"use strict";function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){return t._head?(t._tail._next=e,e._prev=t._tail,t._tail=e):(t._head=e,t._tail=e),e._owner=t,e}Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),a=function(){function t(e,i,n){void 0===i&&(i=!1),s(this,t),this._fn=e,this._once=i,this._thisArg=n,this._next=this._prev=this._owner=null}return o(t,[{key:"detach",value:function(){return null!==this._owner&&(this._owner.detach(this),!0)}}]),t}(),r=function(){function t(){s(this,t),this._head=this._tail=void 0}return o(t,[{key:"handlers",value:function(){var t=!(arguments.length<=0||void 0===arguments[0])&&arguments[0],e=this._head;if(t)return!!e;for(var i=[];e;)i.push(e),e=e._next;return i}},{key:"has",value:function(t){if(!(t instanceof a))throw new Error("MiniSignal#has(): First arg must be a MiniSignalBinding object.");return t._owner===this}},{key:"dispatch",value:function(){var t=this._head;if(!t)return!1;for(;t;)t._once&&this.detach(t),t._fn.apply(t._thisArg,arguments),t=t._next;return!0}},{key:"add",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1];if("function"!=typeof t)throw new Error("MiniSignal#add(): First arg must be a Function.");return n(this,new a(t,(!1),e))}},{key:"once",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1];if("function"!=typeof t)throw new Error("MiniSignal#once(): First arg must be a Function.");return n(this,new a(t,(!0),e))}},{key:"detach",value:function(t){if(!(t instanceof a))throw new Error("MiniSignal#detach(): First arg must be a MiniSignalBinding object.");return t._owner!==this?this:(t._prev&&(t._prev._next=t._next),t._next&&(t._next._prev=t._prev),t===this._head?(this._head=t._next,null===t._next&&(this._tail=null)):t===this._tail&&(this._tail=t._prev,this._tail._next=null),t._owner=null,this)}},{key:"detachAll",value:function(){var t=this._head;if(!t)return this;for(this._head=this._tail=null;t;)t._owner=null,t=t._next;return this}}]),t}();r.MiniSignalBinding=a,i["default"]=r,e.exports=i["default"]},{}],4:[function(t,e,i){"use strict";function s(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}e.exports=Object.assign||function(t,e){for(var i,n,o=s(t),a=1;a<arguments.length;a++){i=arguments[a],n=Object.keys(Object(i));for(var r=0;r<n.length;r++)o[n[r]]=i[n[r]]}return o}},{}],5:[function(t,e,i){!function(){function t(t,e,i){return t.call.apply(t.bind,arguments)}function i(t,e,i){if(!t)throw Error();if(2<arguments.length){var s=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,s),t.apply(e,i)}}return function(){return t.apply(e,arguments)}}function s(e,n,o){return s=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?t:i,s.apply(null,arguments)}function n(t,e){this.a=t,this.o=e||t,this.c=this.o.document}function o(t,e,i,s){if(e=t.c.createElement(e),i)for(var n in i)i.hasOwnProperty(n)&&("style"==n?e.style.cssText=i[n]:e.setAttribute(n,i[n]));return s&&e.appendChild(t.c.createTextNode(s)),e}function a(t,e,i){t=t.c.getElementsByTagName(e)[0],t||(t=document.documentElement),t.insertBefore(i,t.lastChild)}function r(t){t.parentNode&&t.parentNode.removeChild(t)}function h(t,e,i){e=e||[],i=i||[];for(var s=t.className.split(/\s+/),n=0;n<e.length;n+=1){for(var o=!1,a=0;a<s.length;a+=1)if(e[n]===s[a]){o=!0;break}o||s.push(e[n])}for(e=[],n=0;n<s.length;n+=1){for(o=!1,a=0;a<i.length;a+=1)if(s[n]===i[a]){o=!0;break}o||e.push(s[n])}t.className=e.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function l(t,e){for(var i=t.className.split(/\s+/),s=0,n=i.length;s<n;s++)if(i[s]==e)return!0;return!1}function u(t){return t.o.location.hostname||t.a.location.hostname}function p(t,e,i){function s(){l&&n&&r&&(l(h),l=null)}e=o(t,"link",{rel:"stylesheet",href:e,media:"all"});var n=!1,r=!0,h=null,l=i||null;it?(e.onload=function(){n=!0,s()},e.onerror=function(){n=!0,h=Error("Stylesheet failed to load"),s()}):setTimeout(function(){n=!0,s()},0),a(t,"head",e)}function c(t,e,i,s){var n=t.c.getElementsByTagName("head")[0];if(n){var a=o(t,"script",{src:e}),r=!1;return a.onload=a.onreadystatechange=function(){r||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(r=!0,i&&i(null),a.onload=a.onreadystatechange=null,"HEAD"==a.parentNode.tagName&&n.removeChild(a))},n.appendChild(a),setTimeout(function(){r||(r=!0,i&&i(Error("Script load timeout")))},s||5e3),a}return null}function d(){this.a=0,this.c=null}function g(t){return t.a++,function(){t.a--,m(t)}}function y(t,e){t.c=e,m(t)}function m(t){0==t.a&&t.c&&(t.c(),t.c=null)}function f(t){this.a=t||"-"}function w(t,e){this.c=t,this.f=4,this.a="n";var i=(e||"n4").match(/^([nio])([1-9])$/i);i&&(this.a=i[1],this.f=parseInt(i[2],10))}function x(t){return T(t)+" "+(t.f+"00")+" 300px "+v(t.c)}function v(t){var e=[];t=t.split(/,\s*/);for(var i=0;i<t.length;i++){var s=t[i].replace(/['"]/g,"");-1!=s.indexOf(" ")||/^\d/.test(s)?e.push("'"+s+"'"):e.push(s)}return e.join(",")}function S(t){return t.a+t.f}function T(t){var e="normal";return"o"===t.a?e="oblique":"i"===t.a&&(e="italic"),e}function b(t){var e=4,i="n",s=null;return t&&((s=t.match(/(normal|oblique|italic)/i))&&s[1]&&(i=s[1].substr(0,1).toLowerCase()),(s=t.match(/([1-9]00|normal|bold)/i))&&s[1]&&(/bold/i.test(s[1])?e=7:/[1-9]00/.test(s[1])&&(e=parseInt(s[1].substr(0,1),10)))),i+e}function P(t,e){this.c=t,this.f=t.o.document.documentElement,this.h=e,this.a=new f("-"),this.j=!1!==e.events,this.g=!1!==e.classes}function _(t){t.g&&h(t.f,[t.a.c("wf","loading")]),C(t,"loading")}function I(t){if(t.g){var e=l(t.f,t.a.c("wf","active")),i=[],s=[t.a.c("wf","loading")];e||i.push(t.a.c("wf","inactive")),h(t.f,i,s)}C(t,"inactive")}function C(t,e,i){t.j&&t.h[e]&&(i?t.h[e](i.c,S(i)):t.h[e]())}function M(){this.c={}}function k(t,e,i){var s,n=[];for(s in e)if(e.hasOwnProperty(s)){var o=t.c[s];o&&n.push(o(e[s],i))}return n}function O(t,e){this.c=t,this.f=e,this.a=o(this.c,"span",{"aria-hidden":"true"},this.f)}function B(t){a(t.c,"body",t.a)}function A(t){return"display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+v(t.c)+";"+("font-style:"+T(t)+";font-weight:"+(t.f+"00")+";")}function E(t,e,i,s,n,o){this.g=t,this.j=e,this.a=s,this.c=i,this.f=n||3e3,this.h=o||void 0}function D(t,e,i,s,n,o,a){this.v=t,this.B=e,this.c=i,this.a=s,this.s=a||"BESbswy",this.f={},this.w=n||3e3,this.u=o||null,this.m=this.j=this.h=this.g=null,this.g=new O(this.c,this.s),this.h=new O(this.c,this.s),this.j=new O(this.c,this.s),this.m=new O(this.c,this.s),t=new w(this.a.c+",serif",S(this.a)),t=A(t),this.g.a.style.cssText=t,t=new w(this.a.c+",sans-serif",S(this.a)),t=A(t),this.h.a.style.cssText=t,t=new w("serif",S(this.a)),t=A(t),this.j.a.style.cssText=t,t=new w("sans-serif",S(this.a)),t=A(t),this.m.a.style.cssText=t,B(this.g),B(this.h),B(this.j),B(this.m)}function L(){if(null===nt){var t=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent);nt=!!t&&(536>parseInt(t[1],10)||536===parseInt(t[1],10)&&11>=parseInt(t[2],10))}return nt}function j(t,e,i){for(var s in st)if(st.hasOwnProperty(s)&&e===t.f[st[s]]&&i===t.f[st[s]])return!0;return!1}function G(t){var e,i=t.g.a.offsetWidth,s=t.h.a.offsetWidth;(e=i===t.f.serif&&s===t.f["sans-serif"])||(e=L()&&j(t,i,s)),e?et()-t.A>=t.w?L()&&j(t,i,s)&&(null===t.u||t.u.hasOwnProperty(t.a.c))?z(t,t.v):z(t,t.B):X(t):z(t,t.v)}function X(t){setTimeout(s(function(){G(this)},t),50)}function z(t,e){setTimeout(s(function(){r(this.g.a),r(this.h.a),r(this.j.a),r(this.m.a),e(this.a)},t),0)}function R(t,e,i){this.c=t,this.a=e,this.f=0,this.m=this.j=!1,this.s=i}function H(t){0==--t.f&&t.j&&(t.m?(t=t.a,t.g&&h(t.f,[t.a.c("wf","active")],[t.a.c("wf","loading"),t.a.c("wf","inactive")]),C(t,"active")):I(t.a))}function N(t){this.j=t,this.a=new M,this.h=0,this.f=this.g=!0}function W(t,e,i,n,o){var a=0==--t.h;(t.f||t.g)&&setTimeout(function(){var t=o||null,r=n||null||{};if(0===i.length&&a)I(e.a);else{e.f+=i.length,a&&(e.j=a);var l,u=[];for(l=0;l<i.length;l++){var p=i[l],c=r[p.c],d=e.a,g=p;if(d.g&&h(d.f,[d.a.c("wf",g.c,S(g).toString(),"loading")]),C(d,"fontloading",g),d=null,null===ot)if(window.FontFace){var g=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent),y=/OS X.*Version\/10\..*Safari/.exec(window.navigator.userAgent)&&/Apple/.exec(window.navigator.vendor);ot=g?42<parseInt(g[1],10):!y}else ot=!1;d=ot?new E(s(e.g,e),s(e.h,e),e.c,p,e.s,c):new D(s(e.g,e),s(e.h,e),e.c,p,e.s,t,c),u.push(d)}for(l=0;l<u.length;l++)u[l].start()}},0)}function F(t,e,i){var s=[],n=i.timeout;_(e);var s=k(t.a,i,t.c),o=new R(t.c,e,n);for(t.h=s.length,e=0,i=s.length;e<i;e++)s[e].load(function(e,i,s){W(t,o,e,i,s)})}function U(t,e){this.c=t,this.a=e}function Y(t,e){this.c=t,this.a=e}function V(t,e){t?this.c=t:this.c=at,this.a=[],this.f=[],this.g=e||""}function J(t,e){for(var i=e.length,s=0;s<i;s++){var n=e[s].split(":");3==n.length&&t.f.push(n.pop());var o="";2==n.length&&""!=n[1]&&(o=":"),t.a.push(n.join(o))}}function K(t){if(0==t.a.length)throw Error("No fonts to load!");if(-1!=t.c.indexOf("kit="))return t.c;for(var e=t.a.length,i=[],s=0;s<e;s++)i.push(t.a[s].replace(/ /g,"+"));return e=t.c+"?family="+i.join("%7C"),0<t.f.length&&(e+="&subset="+t.f.join(",")),0<t.g.length&&(e+="&text="+encodeURIComponent(t.g)),e}function q(t){this.f=t,this.a=[],this.c={}}function $(t){for(var e=t.f.length,i=0;i<e;i++){var s=t.f[i].split(":"),n=s[0].replace(/\+/g," "),o=["n4"];if(2<=s.length){var a,r=s[1];if(a=[],r)for(var r=r.split(","),h=r.length,l=0;l<h;l++){var u;if(u=r[l],u.match(/^[\w-]+$/)){var p=ut.exec(u.toLowerCase());if(null==p)u="";else{if(u=p[2],u=null==u||""==u?"n":lt[u],p=p[1],null==p||""==p)p="4";else var c=ht[p],p=c?c:isNaN(p)?"4":p.substr(0,1);u=[u,p].join("")}}else u="";u&&a.push(u)}0<a.length&&(o=a),3==s.length&&(s=s[2],a=[],s=s?s.split(","):a,0<s.length&&(s=rt[s[0]])&&(t.c[n]=s))}for(t.c[n]||(s=rt[n])&&(t.c[n]=s),s=0;s<o.length;s+=1)t.a.push(new w(n,o[s]))}}function Z(t,e){this.c=t,this.a=e}function Q(t,e){this.c=t,this.a=e}function tt(t,e){this.c=t,this.f=e,this.a=[]}var et=Date.now||function(){return+new Date},it=!!window.FontFace;f.prototype.c=function(t){for(var e=[],i=0;i<arguments.length;i++)e.push(arguments[i].replace(/[\W_]+/g,"").toLowerCase());return e.join(this.a)},E.prototype.start=function(){var t=this.c.o.document,e=this,i=et(),s=new Promise(function(s,n){function o(){et()-i>=e.f?n():t.fonts.load(x(e.a),e.h).then(function(t){1<=t.length?s():setTimeout(o,25)},function(){n()})}o()}),n=null,o=new Promise(function(t,i){n=setTimeout(i,e.f)});Promise.race([o,s]).then(function(){n&&(clearTimeout(n),n=null),e.g(e.a)},function(){e.j(e.a)})};var st={D:"serif",C:"sans-serif"},nt=null;D.prototype.start=function(){this.f.serif=this.j.a.offsetWidth,this.f["sans-serif"]=this.m.a.offsetWidth,this.A=et(),G(this)};var ot=null;R.prototype.g=function(t){var e=this.a;e.g&&h(e.f,[e.a.c("wf",t.c,S(t).toString(),"active")],[e.a.c("wf",t.c,S(t).toString(),"loading"),e.a.c("wf",t.c,S(t).toString(),"inactive")]),C(e,"fontactive",t),this.m=!0,H(this)},R.prototype.h=function(t){var e=this.a;if(e.g){var i=l(e.f,e.a.c("wf",t.c,S(t).toString(),"active")),s=[],n=[e.a.c("wf",t.c,S(t).toString(),"loading")];i||s.push(e.a.c("wf",t.c,S(t).toString(),"inactive")),h(e.f,s,n)}C(e,"fontinactive",t),H(this)},N.prototype.load=function(t){this.c=new n(this.j,t.context||this.j),this.g=!1!==t.events,this.f=!1!==t.classes,F(this,new P(this.c,t),t)},U.prototype.load=function(t){function e(){if(o["__mti_fntLst"+s]){var i,n=o["__mti_fntLst"+s](),a=[];if(n)for(var r=0;r<n.length;r++){var h=n[r].fontfamily;void 0!=n[r].fontStyle&&void 0!=n[r].fontWeight?(i=n[r].fontStyle+n[r].fontWeight,a.push(new w(h,i))):a.push(new w(h))}t(a)}else setTimeout(function(){e()},50)}var i=this,s=i.a.projectId,n=i.a.version;if(s){var o=i.c.o;c(this.c,(i.a.api||"https://fast.fonts.net/jsapi")+"/"+s+".js"+(n?"?v="+n:""),function(n){n?t([]):(o["__MonotypeConfiguration__"+s]=function(){return i.a},e())}).id="__MonotypeAPIScript__"+s}else t([])},Y.prototype.load=function(t){var e,i,s=this.a.urls||[],n=this.a.families||[],o=this.a.testStrings||{},a=new d;for(e=0,i=s.length;e<i;e++)p(this.c,s[e],g(a));var r=[];for(e=0,i=n.length;e<i;e++)if(s=n[e].split(":"),s[1])for(var h=s[1].split(","),l=0;l<h.length;l+=1)r.push(new w(s[0],h[l]));else r.push(new w(s[0]));y(a,function(){t(r,o)})};var at="https://fonts.googleapis.com/css",rt={latin:"BESbswy","latin-ext":"çöüğş",cyrillic:"йяЖ",greek:"αβΣ",khmer:"កខគ",Hanuman:"កខគ"},ht={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},lt={i:"i",italic:"i",n:"n",normal:"n"},ut=/^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/,pt={Arimo:!0,Cousine:!0,Tinos:!0};Z.prototype.load=function(t){var e=new d,i=this.c,s=new V(this.a.api,this.a.text),n=this.a.families;J(s,n);var o=new q(n);$(o),p(i,K(s),g(e)),y(e,function(){t(o.a,o.c,pt)})},Q.prototype.load=function(t){var e=this.a.id,i=this.c.o;e?c(this.c,(this.a.api||"https://use.typekit.net")+"/"+e+".js",function(e){if(e)t([]);else if(i.Typekit&&i.Typekit.config&&i.Typekit.config.fn){e=i.Typekit.config.fn;for(var s=[],n=0;n<e.length;n+=2)for(var o=e[n],a=e[n+1],r=0;r<a.length;r++)s.push(new w(o,a[r]));try{i.Typekit.load({events:!1,classes:!1,async:!0})}catch(h){}t(s)}},2e3):t([])},tt.prototype.load=function(t){var e=this.f.id,i=this.c.o,s=this;e?(i.__webfontfontdeckmodule__||(i.__webfontfontdeckmodule__={}),i.__webfontfontdeckmodule__[e]=function(e,i){for(var n=0,o=i.fonts.length;n<o;++n){var a=i.fonts[n];s.a.push(new w(a.name,b("font-weight:"+a.weight+";font-style:"+a.style)))}t(s.a)},c(this.c,(this.f.api||"https://f.fontdeck.com/s/css/js/")+u(this.c)+"/"+e+".js",function(e){e&&t([])})):t([])};var ct=new N(window);ct.a.c.custom=function(t,e){return new Y(e,t)},ct.a.c.fontdeck=function(t,e){return new tt(e,t)},ct.a.c.monotype=function(t,e){return new U(e,t)},ct.a.c.typekit=function(t,e){return new Q(e,t)},ct.a.c.google=function(t,e){return new Z(e,t)};var dt={load:s(ct.load,ct)};"function"==typeof define&&define.amd?define(function(){return dt}):"undefined"!=typeof e&&e.exports?e.exports=dt:(window.WebFont=dt,window.WebFontConfig&&ct.load(window.WebFontConfig))}()},{}],6:[function(t,e,i){"use strict";function s(){this._keysDown=null,this._keysPressed=null,this._keysUp=null,this._keysDownBuffer=[],this._keysDownBufferLength=500}e.exports=s,s.prototype.KEY_TAB=9,s.prototype.KEY_ENTER=13,s.prototype.KEY_SHIFT=16,s.prototype.KEY_CTRL=17,s.prototype.KEY_ALT=18,s.prototype.KEY_ESC=27,s.prototype.KEY_SPACE=32,s.prototype.KEY_LEFT=37,s.prototype.KEY_UP=38,s.prototype.KEY_RIGHT=39,s.prototype.KEY_DOWN=40,s.prototype.KEY_DELETE=46,s.prototype.KEY_A=65,s.prototype.KEY_B=66,s.prototype.KEY_C=67,s.prototype.KEY_D=68,s.prototype.KEY_E=69,s.prototype.KEY_F=70,s.prototype.KEY_G=71,s.prototype.KEY_H=72,s.prototype.KEY_I=73,s.prototype.KEY_J=74,s.prototype.KEY_K=75,s.prototype.KEY_L=76,s.prototype.KEY_M=77,s.prototype.KEY_N=78,s.prototype.KEY_O=79,s.prototype.KEY_P=80,s.prototype.KEY_Q=81,s.prototype.KEY_R=82,s.prototype.KEY_S=83,s.prototype.KEY_T=84,s.prototype.KEY_U=85,s.prototype.KEY_V=86,s.prototype.KEY_W=87,s.prototype.KEY_X=88,s.prototype.KEY_Y=89,s.prototype.KEY_Z=90,s.prototype.KEY_PLUS=187,s.prototype.KEY_MINUS=189,s.prototype.KEY_F1=112,s.prototype.KEY_F2=113,s.prototype.KEY_F3=114,s.prototype.KEY_F4=115,s.prototype.KEY_F5=116,s.prototype.KEY_F6=117,s.prototype.KEY_F7=118,s.prototype.KEY_F8=119,s.prototype.KEY_F9=120,s.prototype.KEY_F10=121,s.prototype.KEY_F11=122,s.prototype.KEY_F12=123,s.prototype.init=function(t){this.reset(),t.onkeydown=function(t){var e;e=window.event?t.keyCode:t.which,this._keysDown[e]=!this._keysPressed[e],this._keysPressed[e]=!0,window.og&&"editor"!=window.og.mode&&(e!=s.prototype.KEY_UP&&e!=s.prototype.KEY_DOWN&&e!=s.prototype.KEY_RIGHT&&e!=s.prototype.KEY_LEFT&&e!=s.prototype.KEY_SPACE||t.preventDefault()),this._keysDown[e]&&(this._keysDownBuffer.push(e),this._keysDownBuffer.length>=2*this._keysDownBufferLength&&this._keysDownBuffer.splice(this._keysDownBufferLength))}.bind(this),t.onkeyup=function(t){var e;e=window.event?t.keyCode:t.which,this._keysDown[e]=!1,this._keysPressed[e]=!1,this._keysUp[e]=!0}.bind(this),t.focus()},s.prototype.update=function(){this._keysDown={},this._keysUp={}},s.prototype.reset=function(){this._keysDown={},this._keysPressed={},this._keysUp={}},s.prototype.getKeyPressed=function(t){if(t instanceof Array){for(var e=0;e<t.length;e++)if(!this.getKeyPressed(t[e]))return!1;return!0}return this._keysPressed[t]},s.prototype.getKeyJustPressed=function(t){if(t instanceof Array){for(var e=0,i=0;i<t.length;i++)if(this.getKeyJustPressed(t[i]))e++;else if(!this.getKeyPressed(t[i]))return!1;return e>=1}return!!this._keysDown[t]},s.prototype.getKeyJustReleased=function(t){if(t instanceof Array){for(var e=0;e<t.length;e++)if(this.getKeyJustReleased(t[e]))return!0;return!1}return this._keysUp[t]},s.prototype.clearBuffer=function(){this._keysDownBuffer=[]},s.prototype.getLastKeyPressed=function(){return this._keysDownBuffer.length>0&&this._keysDownBuffer[this._keysDownBuffer.length-1]},s.prototype.getKeycodeName=function(t){switch(t){case 8:return"Backspace";case 9:return"Tab";case 12:return"Numpad Middle";case 13:return"Enter";case 16:return"Shift";case 17:return"Ctrl";case 18:return"Alt";case 19:return"Pause";case 20:return"Caps Lock";case 27:return"Escape";case 32:return"Space";case 33:return"Page Up";case 34:return"Page Down";case 35:return"End";case 36:return"Home";case 37:return"◀";case 38:return"▲";case 39:return"▶";case 40:return"▼";case 44:return"Print Screen";case 45:return"Insert";case 46:return"Delete";case 48:return"0";case 49:return"1";case 50:return"2";case 51:return"3";case 52:return"4";case 53:return"5";case 54:return"6";case 55:return"7";case 56:return"8";case 57:return"9";case 65:return"A";case 66:return"B";case 67:return"C";case 68:return"D";case 69:return"E";case 70:return"F";case 71:return"G";case 72:return"H";case 73:return"I";case 74:return"J";case 75:return"K";case 76:return"L";case 77:return"M";case 78:return"N";case 79:return"O";case 80:return"P";case 81:return"Q";case 82:return"R";case 83:return"S";case 84:return"T";case 85:return"U";case 86:return"V";case 87:return"W";case 88:return"X";case 89:return"Y";case 90:return"Z";case 91:return"Left Windows";case 92:return"Right Windows";case 93:return"Menu Key";case 96:return"Numpad 0";case 97:return"Numpad 1";case 98:return"Numpad 2";case 99:return"Numpad 3";case 100:return"Numpad 4";case 101:return"Numpad 5";case 102:return"Numpad 6";case 103:return"Numpad 7";case 104:return"Numpad 8";case 105:return"Numpad 9";case 106:return"Numpad *";case 107:return"Numpad +";case 109:return"Numpad -";case 110:return"Numpad .";case 111:return"Numpad /";case 112:return"F1";case 113:return"F2";case 114:return"F3";case 115:return"F4";case 116:return"F5";case 117:return"F6";case 118:return"F7";case 119:return"F8";case 120:return"F9";case 121:return"F10";case 122:return"F11";case 123:return"F12";case 144:return"Num Lock";case 145:return"Scroll Lock";case 160:return"Left Shift";case 161:return"Right Shift";case 162:return"Left Ctrl";case 163:return"Right Ctrl";case 164:return"Left Alt";case 165:return"Right Alt";case 186:return";";case 187:return"=";case 189:return"-";case 192:return"`";case 188:return",";case 190:return".";case 191:return"/";case 219:return"[";case 220:return"\\";case 221:return"]";case 222:return"'";default:return"Key "+t}},s.prototype.getKeyString=function(t){if(t instanceof Array){for(var e=[],i=0;i<t.length;i++)e.push(this.getKeycodeName(t[i]));return e.join(" + ")}return this.getKeycodeName(t)}},{}],7:[function(t,e,i){function s(){this.init()}var n=t("./common"),o=t("./preloader/preloader"),a=t("./loader/loader"),r=t("./screens/title"),h=t("./screens/character"),l=t("./screens/game"),u=t("./screens/howToPlay"),p=t("./screens/pause"),c=t("./screens/results"),d=t("./screens/editor"),g={map:{main:t("./challenges/map/challenge-map"),pause:t("./challenges/map/challenge-map-pause"),results:t("./challenges/challenge-results")},fuel:{main:t("./challenges/fuel/challenge-fuel"),pause:t("./challenges/fuel/challenge-fuel-pause"),results:t("./challenges/challenge-results")},wheel:{main:t("./challenges/wheel/challenge-wheel"),pause:t("./challenges/wheel/challenge-wheel-pause"),results:t("./challenges/challenge-results")},clean:{main:t("./challenges/clean/challenge-clean"),pause:t("./challenges/clean/challenge-clean-pause"),results:t("./challenges/challenge-results")},cool:{main:t("./challenges/cool/challenge-cool"),pause:t("./challenges/cool/challenge-cool-pause"),results:t("./challenges/challenge-results")},way:{main:t("./challenges/way/challenge-way"),pause:t("./challenges/way/challenge-way-pause"),results:t("./challenges/challenge-results")},tyre:{main:t("./challenges/tyre/challenge-tyre"),pause:t("./challenges/tyre/challenge-tyre-pause"),results:t("./challenges/challenge-results")}};e.exports=s,s.prototype.init=function(){"editor"===n.gameParams.mode?this.createEditorScreen():this.createPreloaderScreen()},s.prototype.createEditorScreen=function(){var t=new d;return n.sceneManager.add(t),n.currentScreen=t,t},s.prototype.createPreloaderScreen=function(){var t=new o(n.gameParams.debug);return n.sceneManager.add(t),t.signals.next.addOnce(function(){this.createLoaderScreen()},this),n.currentScreen=t,t},s.prototype.createLoaderScreen=function(){var t=new a(n.gameParams.debug);return n.sceneManager.add(t),t.signals.next.addOnce(function(){this.createTitleScreen()},this),n.currentScreen=t,t},s.prototype.createTitleScreen=function(){var t=new r;return n.sceneManager.add(t,this._getTransition()),t.signals.next.addOnce(function(){this.createCharacterScreen(!1)},this),t.signals.challenge.add(function(t){this.createChallengeScreen(t)},this),n.currentScreen=t,t},s.prototype.createCharacterScreen=function(){var t=new h;return n.sceneManager.add(t,this._getTransition()),t.signals.previous.addOnce(function(){this.createTitleScreen()},this),t.signals.next.addOnce(function(){this.createMapScreen()},this),n.currentScreen=t,t},s.prototype.createMapScreen=function(){var t=new g.map.main;return n.sceneManager.add(t,this._getTransition()),t.signals.previous.add(function(){this.createTitleScreen()},this),t.signals.next.add(function(){this.createGameScreen(!1)},this),n.currentScreen=t,t},s.prototype.createGameScreen=function(t,e){var i=new l(t,e);return n.sceneManager.add(i,this._getTransition()),i.signals.howToPlay.add(function(){this.createHowToPlayScreen()},this),i.signals.challenge.add(function(t){this.createChallengeScreen(t)},this),i.signals.pause.add(function(){this.createPauseScreen()},this),i.signals.next.add(function(){this.createResultsScreen()},this),n.currentScreen=i,i},s.prototype.createPauseScreen=function(){n.currentScreen.pause&&n.currentScreen.pause();var t=new p3.Transition;t.push=!0,t.replace=!1;var e=new p;return n.sceneManager.add(e,t),e.signals.previous.addOnce(function(){this.createTitleScreen()},this),e.signals.next.addOnce(function(){n.sceneManager.remove(),n.currentScreen.resume&&n.currentScreen.resume()},this),e},s.prototype.createHowToPlayScreen=function(){null!==n.currentSubScreen&&n.currentSubScreen.pause?n.currentSubScreen.pause():n.currentScreen.pause&&(n.storage_data.tutorial=!1,n.storage.save(),n.currentScreen.pause());var t=new p3.Transition;t.push=!0,t.replace=!1;var e=new u;return n.sceneManager.add(e,t),e.signals.previous.addOnce(function(){n.sceneManager.remove(),null!==n.currentSubScreen&&n.currentSubScreen.pause?n.currentSubScreen.resume():n.currentScreen.resume&&n.currentScreen.resume()},this),e},s.prototype.createResultsScreen=function(){n.currentScreen.pause&&n.currentScreen.pause();var t=new p3.Transition;t.push=!0,t.replace=!1;var e=new c;return n.sceneManager.add(e,t),e.signals.previous.addOnce(function(){this.createTitleScreen()},this),e.signals.next.addOnce(function(){n.reset(),n.randomizeLevel(),this.createGameScreen()},this),e},s.prototype.createChallengeScreen=function(t){var e=new g[t].main;return n.previousChallenge=t,n.sceneManager.add(e,this._getTransition()),e.signals.next.addOnce(function(e){this.createChallengeResultsScreen(t,e)},this),e.signals.pause.add(function(){this.createChallengePauseScreen(t)},this),n.currentScreen=e,e},s.prototype.createChallengePauseScreen=function(t){n.currentScreen.pause&&n.currentScreen.pause();var e=new p3.Transition;e.push=!0,e.replace=!1;var i=new g[t].pause;return n.sceneManager.add(i,e),i.signals.previous.addOnce(function(){this.createTitleScreen()},this),i.signals.next.addOnce(function(){n.sceneManager.remove(),n.currentScreen.resume&&n.currentScreen.resume()},this),i.signals.previous.addOnce(function(){n.sceneManager.remove(),this.createTitleScreen()},this),n.currentSubScreen=i,i},s.prototype.createChallengeResultsScreen=function(t,e){var i=new g[t].results(t,e),s=new p3.Transition;return s.push=!0,s.replace=!1,n.sceneManager.add(i,s),i.signals.next.add(function(){0===n.playersPositions.length?this.createTitleScreen():this.createGameScreen(!0,t)},this),n.currentSubScreen=i,i},s.prototype._getTransition=function(){var t=new p3.FadeTransition(n.TRANSITION_COLOR,n.TRANSITION_DURATION);return t.wait=!1,t}},{"./challenges/challenge-results":12,"./challenges/clean/challenge-clean":17,"./challenges/clean/challenge-clean-pause":16,"./challenges/cool/challenge-cool":22,"./challenges/cool/challenge-cool-pause":21,"./challenges/fuel/challenge-fuel":26,"./challenges/fuel/challenge-fuel-pause":24,"./challenges/map/challenge-map":30,"./challenges/map/challenge-map-pause":28,"./challenges/tyre/challenge-tyre":34,"./challenges/tyre/challenge-tyre-pause":33,"./challenges/way/challenge-way":36,"./challenges/way/challenge-way-pause":35,"./challenges/wheel/challenge-wheel":39,"./challenges/wheel/challenge-wheel-pause":38,"./common":42,"./loader/loader":98,"./preloader/preloader":104,"./screens/character":106,"./screens/editor":107,"./screens/game":108,"./screens/howToPlay":109,"./screens/pause":110,"./screens/results":111,"./screens/title":112}],8:[function(t,e,i){function s(t){return window.Howl||window.Howler?(this.noAudio=Howler.noAudio,n.call(this),this.game=t,this.sounds=[],this._playList=[],this._isMuted=!1,Howler.unload(),this.on(o.EVENTS.AUDIOMANAGER.LOADED,this._onProgress.bind(this)),void this.on(o.EVENTS.AUDIOMANAGER.ERROR,this._onError.bind(this))):(console.log("ENEA.AudioManager : Howler not present!"),this.noAudio=!1,null)}var n=t("eventemitter3"),o=t("./const"),a=t("../utils");s.prototype=Object.create(n.prototype),s.prototype.constructor=s,e.exports=s,s.prototype._onProgress=function(t){this.onLoadProgress&&this.onLoadProgress.call(this,t)},s.prototype._onError=function(t){this.onLoadError&&this.onLoadError.call(this,t)},s.prototype.load=function(t,e,i){if(this.noAudio)return console.log("ENEA.AudioManager : no audio support on this device"),void this.emit(o.EVENTS.AUDIOMANAGER.ERROR,this);var s=this,n={volume:1,autoplay:!1,loop:!1};n=a.mergeParams(n,i);var r=null,h=!0;("string"==typeof t||t instanceof String)&&(h=!1),r=new Howl({src:e,sprite:h?t:{},volume:n.volume,autoplay:!h&&n.autoplay,loop:!h&&n.loop,onload:function(){s._addSound(r,t,h),s.emit(o.EVENTS.AUDIOMANAGER.LOADED,t)},onloaderror:function(e){s.emit(o.EVENTS.AUDIOMANAGER.ERROR,t)},onplay:function(t){var e=s._getByID(t);null===e&&s._playList.push({source:r,id:t})},onend:function(t){s._removePlaying(t)}})},s.prototype._isDuplicate=function(t){return!!this.sounds[t]},s.prototype._addSound=function(t,e,i){if(i)for(var s in e)this._isDuplicate(this.sounds[s])||(this.sounds[s]={type:"sprite",source:t});else this._isDuplicate(e)||(this.sounds[e]={type:"normal",source:t})},s.prototype._getByID=function(t){for(var e=0;e<this._playList.length;e++)if(this._playList[e].id===t)return this._playList[e];
return null},s.prototype._removePlaying=function(t){for(var e=0;e<this._playList.length;e++)if(this._playList[e].id===t){this._playList.splice(e,1);break}},s.prototype.isPlaying=function(t){var e=this._getByID(t);return null!==e},s.prototype.play=function(t,e){if(!this.noAudio&&null!==t){var i=null,s={volume:1,loop:!1};s=a.mergeParams(s,e);var n;return n=t instanceof Array?t[Math.floor(Math.random()*t.length)]:t,this.sounds[n]?(i="sprite"===this.sounds[n].type?this.sounds[n].source.play(n):this.sounds[n].source.play(),this.sounds[n].source.volume(s.volume,i),this.sounds[n].source.loop(s.loop,i)):console.log("ENEA.AudioManager : sound not found ("+n+")"),i}},s.prototype.fade=function(t,e,i,s){var n=this._getByID(t);n&&n.source.fade(e,i,s,t)},s.prototype.stop=function(t){var e=this._getByID(t);e&&(e.source.stop(e.id),this._removePlaying(e.id))},s.prototype.stopByName=function(t){for(var e=[],i=0;i<this._playList.length;i++)this._playList[i].source._src.replace(/\.[^\/.]+$/,"")===t&&e.push(this._playList[i].id);for(i=0;i<e.length;i++){var s=this._getByID(e[i]);s&&(s.source.stop(s.id),this._removePlaying(s.id))}},s.prototype.pause=function(t){var e=this._getByID(t);e&&e.source.pause(e.id)},s.prototype.resume=function(t){var e=this._getByID(t);e&&e.source.play(e.id)},s.prototype.stopAll=function(){for(var t;this._playList.length>0;)t=this._playList[0],this.stop(t.id),this._removePlaying(t.id)},s.prototype.pauseAll=function(){for(var t,e=0;e<this._playList.length;e++)t=this._playList[e],t.source.pause(t.id)},s.prototype.resumeAll=function(){for(var t,e=0;e<this._playList.length;e++)t=this._playList[e],t.source.play(t.id)},s.prototype.removeSound=function(t){this.sounds.hasOwnProperty(t)&&(this.isPlaying(t)&&this.stop(t),this.sounds[t].source.unload(),this.sounds[t].source=null,this.sounds[t]=null,delete this.sounds[t])},s.prototype._mute=function(){this.noAudio||(Howler.mute(!0),Howler.volume(0))},s.prototype._unmute=function(){this.noAudio||(Howler.mute(!1),Howler.volume(1))},Object.defineProperty(s.prototype,"mute",{get:function(){return this._isMuted},set:function(t){this._isMuted=t,this._isMuted?this._mute():this._unmute()}})},{"../utils":116,"./const":9,eventemitter3:2}],9:[function(t,e,i){var s={EVENTS:{AUDIOMANAGER:{LOADED:"audiomanager-loaded",ERROR:"audiomanager-error",ONEND:"audiomanager-on-end"}}};e.exports=s},{}],10:[function(t,e,i){e.exports=t("./audiomanager")},{"./audiomanager":8}],11:[function(t,e,i){function s(){p3.Scene.call(this),n.viewManager.add(n.assetManager.getJSON("loaderView")),this.layout=n.viewManager.get(n.viewManager.activeLayout),n.assetManager.signals.progress.add(this.onProgress,this),this.tl=null,this.logoTl=null}var n=t("../common");e.exports=s,s.prototype=Object.create(p3.Scene.prototype),s.prototype.constructor=s,s.prototype.init=function(){this.bgSprite=n.viewManager.addSprite(this.layout.bg).addTo(this),this.logo=n.viewManager.addSprite(this.layout.logo).addTo(this),this.wheel=n.viewManager.addSprite(this.layout.wheel).addTo(this),this.progressBar=n.viewManager.addProgressBar(this.layout.progressBar).addTo(this),this.progressBar.bar.value=0},s.prototype.onProgress=function(t,e,i){this.tl=new TimelineMax,this.tl.to(this.wheel,.8,{rotation:2*Math.PI*(100/i),ease:Sine.easeInOut}),this.progressBar.bar.value=i/100},s.prototype.update=function(){},s.prototype.appear=function(){this.logoTl=new TimelineMax,this.logoTl.to(this.logo.scale,1,{x:1.1,y:1.1,repeat:-1,yoyo:!0,ease:Sine.easeInOut})},s.prototype.destroy=function(){null!==this.tl&&this.tl.kill(),null!==this.logoTl&&this.logoTl.kill(),n.assetManager.signals.progress.remove(this.onProgress),this.progressBar.bar.doSeppuku(),p3.Scene.prototype.destroy.call(this)},s.prototype.resize=function(){this.x=Math.floor((p3.View.width-n.STAGE_WIDTH)/2)}},{"../common":42}],12:[function(t,e,i){function s(t,e){p3.Scene.call(this),this.gameName=t,this.stars=e;var i=WRE.cloneObj(n.assetManager.getJSON("challengeResultsView"));i.challengeResultsView.character.texture=i.challengeResultsView.character.texture.replaceAll("#CARCOLOR#",n.carColors[n.currentCar]),i.challengeResultsView.character2.texture=i.challengeResultsView.character2.texture.replaceAll("#CARCOLOR#",n.carColors[n.currentCar]),n.viewManager.add(i),this.layout=n.viewManager.get(n.viewManager.activeLayout),this.screenDim=null}var n=t("../common"),o=t("../screendim/screendim");e.exports=s,s.prototype=Object.create(p3.Scene.prototype),s.prototype.constructor=s,s.prototype.init=function(){if(this.layout.dim){var t=this.layout.dim.color?this.layout.dim.color:null,e=this.layout.dim.duration?this.layout.dim.duration:null,i=this.layout.dim.alphaIn?this.layout.dim.alphaIn:null,s=this.layout.dim.alphaOut?this.layout.dim.alphaOut:null;this.layout.dim.alphaIn||this.layout.dim.alphaOut||!this.layout.dim.alpha||(i=this.layout.dim.alpha,s=0),this.screenDim=new o(t,e,i,s).addTo(this)}if(this.bg=n.viewManager.addSprite(this.layout.bg).addTo(this),this.shine1=n.viewManager.addSprite(this.layout.shine1).addTo(this),this.shine2=n.viewManager.addSprite(this.layout.shine2).addTo(this),this.character=n.viewManager.addSprite(this.layout.character).addTo(this),this.character2=n.viewManager.addSprite(this.layout.character2).addTo(this),0!==n.currentCar&&3!==n.currentCar||(this.character2.visible=!0,3===n.currentCar&&(this.character2.scaleX=-1)),this.particleContainer=(new WRE.Container).addTo(this),this.layout.dialog){this.dialogContainer=(new WRE.Container).addTo(this),this.initDialogElements();for(var a=1;a<=this.stars;a++)this["star"+a].texture=n.assetManager.getTexture("ui_result_star_on"),this["star"+a].hasSound=!0}},s.prototype.initDialogElements=function(){this.dialogSprite=n.viewManager.addSprite(this.layout.dialog.main).addTo(this.dialogContainer);for(var t in this.layout.dialog.children)switch(t){case"star1":this.star1=n.viewManager.addSprite(this.layout.dialog.children.star1).addTo(this.dialogSprite),this.star1PS=new PIXI.particles.Emitter(this.particleContainer,[n.assetManager.getTexture("ui_result_star_particle")],n.assetManager.getJSON("rewardStarsBurst")),this.star1PS.updateSpawnPos(this.dialogSprite.x+this.star1.x,this.dialogSprite.y+this.star1.y),this.star1PS.emit=!1;break;case"star2":this.star2=n.viewManager.addSprite(this.layout.dialog.children.star2).addTo(this.dialogSprite),this.star2PS=new PIXI.particles.Emitter(this.particleContainer,[n.assetManager.getTexture("ui_result_star_particle")],n.assetManager.getJSON("rewardStarsBurst")),this.star2PS.updateSpawnPos(this.dialogSprite.x+this.star2.x,this.dialogSprite.y+this.star2.y),this.star2PS.emit=!1;break;case"star3":this.star3=n.viewManager.addSprite(this.layout.dialog.children.star3).addTo(this.dialogSprite),this.star3PS=new PIXI.particles.Emitter(this.particleContainer,[n.assetManager.getTexture("ui_result_star_particle")],n.assetManager.getJSON("rewardStarsBurst")),this.star3PS.updateSpawnPos(this.dialogSprite.x+this.star3.x,this.dialogSprite.y+this.star3.y),this.star3PS.emit=!1;break;case"amazing":this.amazing=n.viewManager.addSprite(this.layout.dialog.children.amazing).addTo(this.dialogSprite);break;case"amazingText":this.amazingText=n.viewManager.addText(this.layout.dialog.children.amazingText).addTo(this.dialogSprite),this.amazingText.text=n.language.get("challenge_stars")}},s.prototype.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},s.prototype.runNextScene=function(){this.signals.next.dispatch()},s.prototype.requestNextScene=function(){n.viewManager.hasHideTweens?(this.screenDim&&this.screenDim.out(),n.viewManager.hideTweensComplete.detachAll(),n.viewManager.hideTweensComplete.add(function(){this.runNextScene()},this),n.viewManager.runHideTweens()):this.runNextScene()},s.prototype.requestPreviousScene=function(){n.viewManager.hasHideTweens?(this.screenDim&&this.screenDim.out(),n.viewManager.hideTweensComplete.detachAll(),n.viewManager.hideTweensComplete.add(function(){this.runPreviousScene()},this),n.viewManager.runHideTweens()):this.runPreviousScene()},s.prototype.animateShine=function(){TweenMax.from(this.shine1,.2,{delay:.2,alpha:0}),TweenMax.from(this.shine2,.2,{delay:.3,alpha:0}),TweenMax.to(this.shine1,8,{rotation:2*Math.PI,repeat:-1,ease:Linear.easeNone}),TweenMax.to(this.shine2,8,{rotation:-2*Math.PI,repeat:-1,ease:Linear.easeNone}),TweenMax.from(this.shine1.scale,.4,{delay:.2,x:0,y:0,ease:Back.easeOut}),TweenMax.from(this.shine2.scale,.4,{delay:.3,x:0,y:0,ease:Back.easeOut})},s.prototype.animateStars=function(){TweenMax.from(this.star1.scale,.4,{delay:.1,x:0,y:0,ease:Back.easeOut,onStart:function(){this.star1.hasSound&&(this.star1PS.emit=!0,n.audio.play("challengeStarReward1"))},onStartScope:this,onComplete:function(){n.audio.play("challengeFanfare")}}),TweenMax.from(this.star2.scale,.4,{delay:.16,x:0,y:0,ease:Back.easeOut,onStart:function(){this.star2.hasSound&&(this.star2PS.emit=!0,n.audio.play("challengeStarReward2"))},onStartScope:this}),TweenMax.from(this.star3.scale,.4,{delay:.22,x:0,y:0,ease:Back.easeOut,onStart:function(){this.star3.hasSound&&(this.star3PS.emit=!0,n.audio.play("challengeStarReward3"))},onStartScope:this})},s.prototype.animateAmazing=function(){TweenMax.from(this.amazing,.45,{delay:.1,y:800,ease:Cubic.easeOut}),TweenMax.from(this.amazingText,.45,{delay:.1,y:800,ease:Cubic.easeOut})},s.prototype.animateCharacter=function(){var t=new TimelineMax;t.from(this.character,.3,{delay:.1,y:1800,ease:Cubic.easeOut},"start"),t.to(this.character.scale,.1,{delay:.2,y:1.1,repeat:1,yoyo:!0,ease:Sine.easeInOut},"start"),this.character2.visible&&(t.from(this.character2,.3,{delay:.15,y:1800,ease:Cubic.easeOut},"start"),t.to(this.character2.scale,.1,{delay:.25,y:1.1,repeat:1,yoyo:!0,ease:Sine.easeInOut},"start"))},s.prototype.animateShineOut=function(){TweenMax.to(this.shine1.scale,.2,{x:0,y:0,ease:Back.easeIn}),TweenMax.to(this.shine2.scale,.2,{x:0,y:0,ease:Back.easeIn}),TweenMax.to(this.shine1,.2,{alpha:0,ease:Linear.easeNone}),TweenMax.to(this.shine2,.2,{alpha:0,ease:Linear.easeNone})},s.prototype.animateCharacterOut=function(){var t=new TimelineMax;t.to(this.character.scale,.1,{y:1.1,repeat:1,yoyo:!0,ease:Sine.easeInOut},"start"),t.to(this.character,.4,{delay:.1,y:1800,ease:Cubic.easeOut},"start"),this.character2.visible&&(t.to(this.character2.scale,.1,{y:1.15,repeat:1,yoyo:!0,ease:Sine.easeInOut},"start"),t.to(this.character2,.4,{delay:.15,y:1800,ease:Cubic.easeOut},"start"))},s.prototype.appear=function(){this.screenDim&&this.screenDim["in"](),n.viewManager.showTweensComplete.add(this.onShowTweensComplete.bind(this)),n.viewManager.runShowTweens(),this.animateShine(),this.animateStars(),this.animateAmazing(),this.animateCharacter(),n.stopMusic()},s.prototype.onShowTweensComplete=function(){n.animator.setTimeout(function(){this.animateShineOut(),this.animateCharacterOut(),this.requestNextScene()},n.config.challengesSetup.results.dismiss,this)},s.prototype.destroy=function(){this.star1PS.emit=!1,this.star1PS.destroy(),this.star2PS.emit=!1,this.star3PS.destroy(),this.star3PS.emit=!1,this.star3PS.destroy(),n.viewManager.showTweensComplete.detachAll(),n.viewManager.hideTweensComplete.detachAll(),this.amazingText&&this.amazingText.destroy(n.destroyAllOptions),n.memoryManager.free(this.gameName),TweenMax.killAll(),p3.Scene.prototype.destroy.call(this)},s.prototype.update=function(){this.star1PS.update(p3.Timestep.deltaTime),this.star2PS.update(p3.Timestep.deltaTime),this.star3PS.update(p3.Timestep.deltaTime)},s.prototype.resize=function(){this.x=Math.round((p3.View.width-n.STAGE_WIDTH)/2),this.screenDim&&(this.screenDim.resize(),this.screenDim.x=-this.x),n.viewManager.repositionDynElements()}},{"../common":42,"../screendim/screendim":105}],13:[function(t,e,i){function s(t,e,i){PIXI.Container.call(this),this.spineName=t,this.animations={};var s=WRE.cloneObj(e.animations);for(var o in s)this.animations[o]=WRE.cloneObj(s[o]);return this.sources=e.sources,this.scales=e.scales,this.skin=i,this._spines=[],this._currentSpine=0,this._lastTrack=null,this.mixTime=.2,this.spineEvent=new n,this.init(),this}var n=t("mini-signals"),o=t("../common");e.exports=s,s.prototype=Object.create(PIXI.Container.prototype),s.prototype.constructor=s,s.prototype.init=function(){var t,e;for(t=0;t<this.sources.length;t++){var i=new PIXI.spine.Spine(o.assetManager.getSpineData(this.sources[t]));i.autoUpdate=!1,i.skeleton.setSkin(null),"undefined"!=typeof this.skin&&i.skeleton.setSkinByName(this.skin),i.skeleton.setSlotsToSetupPose(),i.scaleXY=this.scales[t],this.addChild(i),this._spines.push(i)}var s=[];for(t in this.animations)for(e=0;e<this.animations[t].name.length;e++)s.push({name:this.animations[t].name[e],source:this.animations[t].source});for(t=0;t<s.length;t++)for(e=0;e<s.length;e++)t!==e&&s[t].source===s[e].source&&this._spines[s[t].source].stateData.setMix(s[t].name,s[e].name,this.mixTime);this.spineIndex=0;var n={event:this.onSpineEvent.bind(this)};for(t=0;t<this._spines.length;t++)this._spines[t].state.addListener(n)},s.prototype.onSpineEvent=function(t,e){this.spineEvent.dispatch(t,e)},s.prototype.play=function(t,e){e="undefined"!=typeof e&&e;for(var i=null,s=null,n=null,o=null,a=[],r=[],h=0;h<t.length;h++)i=this.animations[t[h]],"undefined"==typeof i&&console.log("Spine: can not find anim : ["+this.spineName+"] ("+t[h]+")"),s=i.name[Math.floor(Math.random()*i.name.length)],a.push({name:s,source:i.source}),r.push(s);if(!(r[0]===this.currentTrack||this._lastTrack&&1===a.length&&this._lastTrack.name===a[0].name&&this._lastTrack.loop)){for(h=0;h<a.length;h++)i=a[h],this.spineIndex!==i.source&&(this.spineIndex=i.source),0===h?n=this._spines[this.spineIndex].state.setAnimation(0,i.name,!(a.length>1)&&e):o=this._spines[this.spineIndex].state.addAnimation(0,i.name,h===a.length-1&&e,0);this._lastTrack=a[a.length-1],this._lastTrack.loop=e}},s.prototype.setSkin=function(t,e){"undefined"==typeof t?this._spines[0].skeleton.setSkinByName(this.skin):this._spines[e].skeleton.setSkinByName(this.skin)},s.prototype.getAnimationNames=function(t){for(var e=[],i=0;i<t.length;i++)e=e.concat(this.animations[t[i]].name);return e},s.prototype.changeSpineSource=function(){for(var t=0;t<this._spines.length;t++)t!==this._currentSpine&&(this._spines[t].visible=!1);this._spines[this.spineIndex].visible=!0},s.prototype.update=function(t){null!==this._spines&&this._spines[this.spineIndex].update(t)},s.prototype.doSeppuku=function(t){for(var e=0;e<this._spines.length;e++)this._spines[e].state.clearListeners();this.spineEvent.detachAll(),this.spineName=null,this.animations=null,this.skin=null,this._spines=null,this.sources=null,this.destroy(t)},Object.defineProperty(s.prototype,"spineIndex",{get:function(){return this._currentSpine},set:function(t){this._currentSpine=t,this.changeSpineSource()}}),Object.defineProperty(s.prototype,"currentTrack",{get:function(){return this._spines[this.spineIndex].state.getCurrent(0)?this._spines[this.spineIndex].state.getCurrent(0).animation.name:null}}),Object.defineProperty(s.prototype,"currentSpine",{get:function(){return this._spines[this.spineIndex]}}),Object.defineProperty(s.prototype,"time",{get:function(){return this._spines[this.spineIndex].state.getCurrent(0).trackTime},set:function(t){this._spines[this.spineIndex].state.getCurrent(0).trackTime=t,this._spines[this.spineIndex].update(0)}}),Object.defineProperty(s.prototype,"duration",{get:function(){return this._spines[this.spineIndex].state.getCurrent(0).animation.duration}})},{"../common":42,"mini-signals":3}],14:[function(t,e,i){var s={sources:["tutorialHandSpine"],scales:[.5],animations:{place:{name:["place"],source:0},swipe:{name:["swipe_clean"],source:0},tap:{name:["tap"],source:0}}};e.exports=s},{}],15:[function(t,e,i){function s(){this.maxTime=1e4,this.startTime=Date.now(),this.endTime=Date.now(),this.onComplete=new n,this.fired=!0}var n=t("mini-signals");e.exports=s,s.prototype.start=function(){this.fired=!1,this.reset()},s.prototype.reset=function(){this.startTime=Date.now(),this.endTime=this.startTime+this.maxTime},s.prototype.update=function(){this.fired||(this.endTime-=PIXI.ticker.shared.elapsedMS,this.endTime<this.startTime&&(this.fired=!0,this.onComplete.dispatch()))},s.prototype.doSeppuku=function(){this.fired=!0,this.onComplete.detachAll()}},{"mini-signals":3}],16:[function(t,e,i){function s(t){p3.Scene.call(this),this.gameName=t,n.viewManager.add(n.assetManager.getJSON("cleanPauseView")),this.layout=n.viewManager.get(n.viewManager.activeLayout),this.pages=[n.assetManager.getTexture("ui_help_05")],this.tints=[16777215],this.topPos=-631,this.maskTopPos=101,this.currentPage=0,this.screenDim=null,this.popup=null,this.maskTL=null}var n=t("../../common"),o=t("../../screendim/screendim"),a=t("../../help-text");e.exports=s,s.prototype=Object.create(p3.Scene.prototype),s.prototype.constructor=s,s.prototype.init=function(){if(this.layout.dim){var t=this.layout.dim.color?this.layout.dim.color:null,e=this.layout.dim.duration?this.layout.dim.duration:null,i=this.layout.dim.alphaIn?this.layout.dim.alphaIn:null,s=this.layout.dim.alphaOut?this.layout.dim.alphaOut:null;this.layout.dim.alphaIn||this.layout.dim.alphaOut||!this.layout.dim.alpha||(i=this.layout.dim.alpha,s=0),this.screenDim=new o(t,e,i,s).addTo(this)}this.board=n.viewManager.addSprite(this.layout.board).addTo(this);for(var r=40,h=0;h<4;h++)this["pagination"+h]=n.viewManager.addSprite(this.layout.pagination).addTo(this.board),this["pagination"+h].x=-1.5*r+r*h,this["pagination"+h].y=-50-h%2*10,this["pagination"+h].alpha=0,this["pagination"+h].scaleXY=0;this["pagination"+this.currentPage].texture=n.assetManager.getTexture("ui_pagination_on"),this.pausedText=n.viewManager.addText(this.layout.pausedText).addTo(this.board),this.page=n.viewManager.addSprite(this.layout.page).addTo(this.board),this.maskSprite=new WRE.Sprite({texture:PIXI.Texture.WHITE,x:950-this.board.width/2,y:this.maskTopPos-this.board.height,width:this.board.width,height:400}).addTo(this),this.page.mask=this.maskSprite,this.roll=n.viewManager.addSprite(this.layout.roll).addTo(this.board),this.roll.y=this.topPos;var l={bg:{texture:n.assetManager.getTexture("ui_help_copy_bg"),nineSlice:[40,40,40,40]},choices:["ui_help_05"]};this.popup=new a(l).addTo(this),this.popup.init(),this.popup.x=950,this.popup.y=640,this.popup.show(),this.initUiElements()},s.prototype.initUiElements=function(){this.uiContainer=(new WRE.Container).addTo(this);for(var t in this.layout.ui)switch(t){case"homeButton":this.homeButton=n.viewManager.addButton(this.layout.ui.homeButton).addTo(this.uiContainer),this.homeButton.on("button-on-click",this.onHomeButtonClick.bind(this));break;case"soundButton":this.soundButton=n.viewManager.addSwitchButton(this.layout.ui.soundButton).addTo(this.uiContainer),this.soundButton.on("button-on-click",this.onSoundButtonClick.bind(this)),this.soundButton.state=n.storage_data.muted?1:0;break;case"continueButton":this.continueButton=n.viewManager.addButton(this.layout.ui.continueButton).addTo(this.uiContainer),this.continueButton.on("button-on-click",this.onContinueButtonClick.bind(this));break;case"restartButton":this.restartButton=n.viewManager.addButton(this.layout.ui.restartButton).addTo(this.uiContainer),this.restartButton.on("button-on-click",this.onRestartButtonClick.bind(this));break;case"previousButton":break;case"nextButton":}},s.prototype.animateBoardIn=function(){var t=new TimelineMax({onComplete:function(){this.animatePageIn()},onCompleteScope:this});t.from(this.board,.3,{delay:.1,y:1800,ease:Cubic.easeOut},"start"),t.to(this.board.scale,.1,{delay:.2,y:1.1,repeat:1,yoyo:!0,ease:Sine.easeInOut},"start")},s.prototype.animateBoardOut=function(){var t=new TimelineMax;t.to(this.board.scale,.1,{y:1.1,repeat:1,yoyo:!0,ease:Sine.easeInOut},"start"),t.to(this.board,.4,{delay:.1,y:1800,ease:Cubic.easeOut},"start")},s.prototype.destroyUiElements=function(){for(var t=0;t<this.uiContainer.children.length;t++)this.uiContainer.children[t].doSeppuku&&this.uiContainer.children[t].doSeppuku();this.uiContainer.destroy(n.destroyOptions)},s.prototype.requestNextScene=function(){n.viewManager.hasHideTweens?(this.animateBoardOut(),this.screenDim&&this.screenDim.out(),this.popup&&this.popup.hide(),n.viewManager.hideTweensComplete.detachAll(),n.viewManager.hideTweensComplete.add(function(){this.runNextScene()},this),n.viewManager.runHideTweens()):this.runNextScene()},s.prototype.runNextScene=function(){this.signals.next.dispatch()},s.prototype.onRestartButtonClick=function(){},s.prototype.onContinueButtonClick=function(){this.requestNextScene()},s.prototype.onHomeButtonClick=function(){this.signals.previous.dispatch()},s.prototype.onSoundButtonClick=function(t){n.toggleMute("challengeCleanMusic"),t.state=n.storage_data.muted?1:0},s.prototype.onPreviousButtonClick=function(){this.currentPage--,this.currentPage<0&&(this.currentPage=this.pages.length-1),this.updatePage()},s.prototype.onNextButtonClick=function(){this.currentPage++,this.currentPage>this.pages.length-1&&(this.currentPage=0),this.updatePage()},s.prototype.showPagination=function(t){for(var e=0;e<4;e++)this["pagination"+e].alpha=t?0:1;for(e=0;e<4;e++)TweenMax.to(this["pagination"+e],.1+(t?.1:0),{delay:t?.07*e:0,alpha:t?1:0}),TweenMax.to(this["pagination"+e].scale,.15+(t?.1:0),{delay:t?.07*e:0,x:t?1:0,y:t?1:0,ease:Back.easeOut})},s.prototype.updatePage=function(){this.page.texture=this.pages[this.currentPage],this.page.tint=this.tints[this.currentPage],this.maskTL&&(this.maskTL.kill(),this.maskTL=null);var t=.5;this.maskTL=new TimelineMax({onStart:function(){this.roll.alpha=1,this.roll.visible=!0},onStartScope:this,onComplete:function(){this.roll.visible=!1},onCompleteScope:this}),this.maskTL.fromTo(this.maskSprite,t,{y:this.maskTopPos-this.maskSprite.height},{y:this.maskTopPos,ease:Cubic.easeInOut},"start"),this.maskTL.fromTo(this.roll,t,{y:this.topPos},{y:this.topPos+340,ease:Cubic.easeInOut},"start"),this.maskTL.fromTo(this.roll.scale,t,{x:1,y:1},{x:.9,y:0},"start"),this.maskTL.fromTo(this.roll,.1,{alpha:1},{delay:.4,alpha:0},"start");for(var e=0;e<4;e++)this["pagination"+e].texture=n.assetManager.getTexture("ui_pagination_off");this["pagination"+this.currentPage].texture=n.assetManager.getTexture("ui_pagination_on")},s.prototype.animatePageIn=function(){this.page.visible=!0,this.updatePage()},s.prototype.appear=function(){this.screenDim&&this.screenDim["in"](),this.setUiVisible(!1),n.viewManager.done=!1,n.viewManager.showTweensComplete.add(this.onShowTweensComplete.bind(this)),n.viewManager.setShowTweensTime(.005),this.setUiVisible(!0),n.viewManager.runShowTweens(),this.animateBoardIn()},s.prototype.setUiVisible=function(t){if(this.uiContainer)for(var e=0;e<this.uiContainer.children.length;e++)this.uiContainer.children[e].visible=t},s.prototype.pause=function(){this.interactive=!1,this.interactiveChildren=!1},s.prototype.resume=function(){n.viewManager.activeLayout="cleanPauseView",this.interactive=!0,this.interactiveChildren=!0},s.prototype.onShowTweensComplete=function(){n.viewManager.done=!0},s.prototype.destroy=function(){this.screenDim&&this.screenDim.out(),this.maskTL&&(this.maskTL.kill(),this.maskTL=null),this.popup&&this.popup.doSeppuku(),this.destroyUiElements(),this.pausedText.destroy(n.destroyAllOptions),p3.Scene.prototype.destroy.call(this)},s.prototype.update=function(){},s.prototype.resize=function(){this.x=Math.round((p3.View.width-n.STAGE_WIDTH)/2),this.screenDim&&(this.screenDim.resize(),this.screenDim.x=-this.x),n.viewManager.repositionDynElements()}},{"../../common":42,"../../help-text":92,"../../screendim/screendim":105}],17:[function(t,e,i){function s(t){p3.Scene.call(this),this.isBusy=!1,this.responsive=!0,this.interactiveChildren=!0,this.inputPos=new PIXI.Point;var e=n.assetManager.getJSON("cleanGameView");e.cleanGameView.playerImage.texture=e.cleanGameView.playerImage.texture.replaceAll("#CARCOLOR#",n.carColors[n.currentCar]),e.cleanGameView.playerImage2.texture=e.cleanGameView.playerImage2.texture.replaceAll("#CARCOLOR#",n.carColors[n.currentCar]),e.cleanGameView.carImage.texture=e.cleanGameView.carImage.texture.replaceAll("#CARCOLOR#",n.carColors[n.currentCar]),n.viewManager.add(e),this.layout=n.viewManager.get(n.viewManager.activeLayout),this.stars=3,this.bubblesPS=null,this.donePS=null,this.squeakID=null,this.oldPos=new PIXI.Point((-1),(-1)),this.isDown=!1,this.tick=0,this.preloadStuff()}var n=t("../../common"),o=t("../challenge-preloader"),a=t("../../loader/audio-loader"),r=t("../challenge-spine"),h=t("../challenge-tutorial-hand-anims"),l=t("../challenge-tutorial-timer"),u={challengeStarReward1:{type:"sound",url:"sfx/challenges/shared/sfx_star_reward_1",soundId:"challengeStarReward1"},challengeStarReward2:{type:"sound",url:"sfx/challenges/shared/sfx_star_reward_2",soundId:"challengeStarReward2"},challengeStarReward3:{type:"sound",url:"sfx/challenges/shared/sfx_star_reward_3",soundId:"challengeStarReward3"},challengeFanfare:{type:"sound",url:"sfx/challenges/shared/sfx_minigame_complete_fanfare_00",soundId:"challengeFanfare"},challengeCleanPickUp:{type:"sound",url:"sfx/challenges/clean/sfx_window_clean_pickup_02",soundId:"challengeCleanPickUp"},challengeCleanDrop:{type:"sound",url:"sfx/challenges/clean/sfx_window_clean_drop_02",soundId:"challengeCleanDrop"},challengeCleanSqueak:{type:"sound",url:"sfx/challenges/clean/sfx_window_clean_loop_02",soundId:"challengeCleanSqueak"},challengeCleanMusic:{type:"sound",url:"music/challenges/clean/music_challenge_clean_00",soundId:"challengeCleanMusic"},challengeStart:{type:"sound",url:"music/challenges/shared/music_race_challenge_start_00",soundId:"challengeStart"},challengeEnd:{type:"sound",url:"music/challenges/shared/music_race_challenge_end_00",soundId:"challengeEnd"}},p=[{name:"screenBg",url:n.PATHS.IMAGES+"endgame_bg.jpg",destroyId:"screenBg"},{name:"selectAtlas",url:n.PATHS.IMAGES+"character/ui_vehicle_select_0.8x.json",destroyId:"ui_char_brown"},{name:"level_background",url:n.PATHS.IMAGES+"level/#LEVEL#/level_background.png",destroyId:"level_background"},{name:"cleanSponge",url:n.PATHS.IMAGES+"challenges/clean/challenge_clean_sponge_alone.png",destroyId:"cleanSponge"},{name:"cleanSpongeAlpha",url:n.PATHS.IMAGES+"challenges/clean/challenge_clean_sponge_alpha.png",destroyId:"cleanSpongeAlpha"},{name:"cleanAtlas",url:n.PATHS.IMAGES+"challenges/clean/challenge_clean_atlas_0_1x.json",destroyId:"challenge_clean_progressbar_fg"},{name:"cleanBubblesParticles",url:n.PATHS.DATA+"particles/challenge_clean_bubbles_00.json"},{name:"cleanCompleteParticles",url:n.PATHS.DATA+"particles/challenge_clean_sparkles_00.json"},{name:"tutorialHandSpine",url:n.PATHS.IMAGES+"tutorial/tutorial_hand.json",destroyId:"tutorialHandSpine_atlas_page_tutorial_hand"}],c=[];e.exports=s,s.prototype=Object.create(p3.Scene.prototype),s.prototype.constructor=s,s.prototype.preloadStuff=function(){n.memoryManager.resetLoader();var t=0;c=WRE.cloneObj(p);for(t in c)c[t].url=c[t].url.replaceAll("#LEVEL#",n.currentLevel);for(t in c)c[t].hasOwnProperty("destroyId")&&n.memoryManager.store("clean",c[t].destroyId);for(t in u)u[t].hasOwnProperty("soundId")&&n.memoryManager.storeSound("clean",u[t].soundId);this.audioLoader=new a(u,(!1)),this.audioLoader.start()},s.prototype.preloader=function(){return new o},s.prototype.load=function(){return c},s.prototype.init=function(){this.bgSprite=n.viewManager.addSprite(this.layout.backgroundImage).addTo(this),this.bgSprite.filters=[new PIXI.filters.BlurFilter(1.4)],this.playerSprite2=n.viewManager.addSprite(this.layout.playerImage2).addTo(this),this.playerSprite=n.viewManager.addSprite(this.layout.playerImage).addTo(this),this.playerSprite.filters=[new PIXI.filters.BlurFilter(1)],0!==n.currentCar&&3!==n.currentCar||(this.playerSprite2.filters=[new PIXI.filters.BlurFilter(1)],this.playerSprite2.visible=!0,3===n.currentCar&&(this.playerSprite2.x+=100)),this.windshieldSprite=n.viewManager.addSprite(this.layout.windshieldImage).addTo(this),this.carSprite=n.viewManager.addSprite(this.layout.carImage).addTo(this);var t=n.assetManager.getTexture("challenge_clean_dirty");this.w=t.width,this.h=t.height,this.drawingCanvas=document.createElement("canvas"),this.drawingCanvas.width=this.w,this.drawingCanvas.height=this.h,this.drawingContext=this.drawingCanvas.getContext("2d"),this.drawingContext.drawImage(t.baseTexture.source,t.frame.x,t.frame.y,t.frame.width,t.frame.height,0,0,t.frame.width,t.frame.height),this.drawingContext.globalCompositeOperation="destination-out",this.tr=this.getTransparent(),this.wh=this.w*this.h-this.tr,this.rt=PIXI.Texture.fromCanvas(this.drawingCanvas),this.spr=new PIXI.Sprite(this.rt).addTo(this),this.spr.anchorX=.5,this.spr.anchorY=.5,this.spr.x=950,this.spr.y=384,this.spr.responsive=!0,this.spr.on("pointerdown",this.onPointerDown,this),this.spr.on("pointermove",this.onPointerMove,this),this.spr.on("pointerup",this.onPointerUp,this),this.spr.on("pointerupoutside",this.onPointerUp,this),this.spongeTexture=n.assetManager.getTexture("cleanSpongeAlpha"),this.particleContainer=(new WRE.Container).addTo(this),this.initBubblesParticles(),this.sponge=new WRE.Sprite({texture:n.assetManager.getTexture("cleanSponge"),anchorXY:.5,x:this.spr.x,y:this.spr.y}).addTo(this),this.spongeImage=this.spongeTexture.baseTexture.source,this.tutorialContainer=new WRE.Container({visible:!1,interactive:!1,interactiveChildren:!1}).addTo(this),this.tutorialSpine=new r("tutorialHandSpine",h).addTo(this.tutorialContainer),this.timer=new l,this.timer.onComplete.add(this.playTutorial,this),this.layout.ui&&(this.uiContainer=(new WRE.Container).addTo(this),this.initUiElements())},s.prototype.playTutorial=function(t){var e="undefined"!=typeof t?t:1;this.tutorialContainer.visible=!0,this.tutorialSpine.x=this.sponge.x+50,this.tutorialSpine.y=this.sponge.y+66,this.tutorialSpine.play(["swipe"],1!==e),this.tutorialSpine.time=0,window.delay(function(){n.storage_data.tutorial[0]=1,n.storage.save(),this.tutorialContainer&&(this.tutorialContainer.visible=!1),this.timer&&this.timer.start()},this.tutorialSpine.duration*e,this)},s.prototype.initBubblesParticles=function(){this.bubblesPS=new PIXI.particles.Emitter(this.particleContainer,[n.assetManager.getTexture("challenge_clean_particle_bubble")],n.assetManager.getJSON("cleanBubblesParticles")),this.bubblesPS.updateSpawnPos(0,0),this.bubblesPS&&(this.bubblesPS.emit=!1)},s.prototype.initCompleteParticles=function(t,e){this.cleanPSContainer=new WRE.Container({interactive:!1,interactiveChildren:!1}).addTo(this),this.donePS=new PIXI.particles.Emitter(this.cleanPSContainer,[n.assetManager.getTexture("challenge_clean_sparkle_1"),n.assetManager.getTexture("challenge_clean_sparkle_2")],n.assetManager.getJSON("cleanCompleteParticles")),this.donePS.updateSpawnPos(t,e),this.donePS.emit=!0},s.prototype.getTransparent=function(){for(var t=this.drawingContext.getImageData(0,0,this.w,this.h),e=0,i=0;i<t.data.length;i+=4)t.data[i+3]<3&&e++;return e},s.prototype.initUiElements=function(){for(var t in this.layout.ui)switch(t){case"progressBar":this.progressBar=n.viewManager.addProgressBar(this.layout.ui.progressBar).addTo(this.uiContainer),this.progressBar.bar.value=0;break;case"pauseButton":this.pauseButton=n.viewManager.addButton(this.layout.ui.pauseButton).addTo(this.uiContainer),this.pauseButton.on("button-on-click",this.onPauseButtonClick.bind(this))}},s.prototype.onPauseButtonClick=function(){this.signals.pause.dispatch()},s.prototype.onPointerDown=function(t){this.isDown||(this.timer.reset(),this.inputPos.x=this.toLocal(t.data.global).x,this.inputPos.y=this.toLocal(t.data.global).y,n.audio.play("challengeCleanPickUp"),this.isDown=!0,this.bubblesPS&&(this.bubblesPS.emit=!0,this.bubblesPS.updateSpawnPos(this.inputPos.x,this.inputPos.y),this.bubblesPS.resetPositionTracking()),this.onPointerMove(t))},s.prototype.onPointerMove=function(t){if(this.isDown){this.timer.reset(),null===this.squeakID&&(this.squeakID=n.audio.play("challengeCleanSqueak",{loop:!0})),this.inputPos.x=this.toLocal(t.data.global).x,this.inputPos.y=this.toLocal(t.data.global).y,this.bubblesPS&&this.bubblesPS.updateSpawnPos(this.inputPos.x,this.inputPos.y);
var e=this.spr.toLocal(t.data.global).x+this.w/2,i=this.spr.toLocal(t.data.global).y+this.h/2;this.drawingContext.drawImage(this.spongeImage,e-this.spongeImage.width/2,i-this.spongeImage.height/2),this.sponge.x=this.toLocal(t.data.global).x,this.sponge.y=this.toLocal(t.data.global).y,this.progressBar.bar.value=(this.getTransparent()-this.tr)/this.wh,this.rt.baseTexture.update(),this.tick+=.1,this.progressBar.bar.value>n.config.challengesSetup.clean.barComplete&&this.onGameOver()}},s.prototype.onPointerUp=function(t){this.isDown&&(this.timer.reset(),null!==this.squeakID&&(n.audio.stop(this.squeakID),this.squeakID=null),this.oldPos.x=-1,this.oldPos.y=-1,n.audio.stopByName(n.PATHS.SOUNDS+u.challengeCleanSqueak.url),this.squeakID=null,n.audio.play("challengeCleanDrop"),this.bubblesPS.emit=!1,this.isDown=!1)},s.prototype.animateCharacters=function(){TweenMax.to(this.playerSprite,2,{scaleY:1.02,repeat:-1,yoyo:!0,ease:Sine.easeInOut}),TweenMax.to(this.playerSprite2,2,{delay:.5,scaleY:1.02,repeat:-1,yoyo:!0,ease:Sine.easeInOut})},s.prototype.onGameOver=function(){this.bubblesPS&&(this.bubblesPS.emit=!1),this.donePS&&(this.donePS.emit=!1),this.spr.responsive=!1,null!==this.squeakID&&(n.audio.stop(this.squeakID),this.squeakID=null),TweenMax.to(this.spr,.7,{alpha:0}),TweenMax.to(this.sponge,.7,{alpha:0}),TweenMax.to(this.progressBar.bar,.7,{value:1}),this.initCompleteParticles(950,400),this.requestGameOver()},s.prototype.appear=function(){n.memoryManager.free("game"),n.playMusic("challengeCleanMusic"),n.viewManager.runShowTweens(),n.audio.play("challengeStart"),this.animateCharacters(),0===n.storage_data.tutorial[0]?window.delay(function(){this.playTutorial()},1,this):this.timer.start()},s.prototype.pause=function(){this.interactive=!1,this.interactiveChildren=!1,this.isBusy=!0},s.prototype.resume=function(){n.viewManager.activeLayout="cleanGameView",this.interactive=!0,this.interactiveChildren=!0,this.isBusy=!1},s.prototype.runNextScene=function(){this.signals.next.dispatch(this.stars)},s.prototype.requestGameOver=function(){n.audio.play("challengeEnd"),n.animator.setTimeout(function(){n.viewManager.hasHideTweens?(n.viewManager.hideTweensComplete.detachAll(),n.viewManager.hideTweensComplete.add(function(){this.runNextScene()},this),n.viewManager.runHideTweens()):this.runNextScene()},1,this)},s.prototype.update=function(){this.timer&&this.timer.update(),this.tutorialContainer.visible&&this.tutorialSpine.update(p3.Timestep.deltaTime),this.bubblesPS&&this.bubblesPS.update(p3.Timestep.deltaTime),this.oldPos.x===this.inputPos.x&&this.oldPos.y===this.inputPos.y?(n.audio.stopByName(n.PATHS.SOUNDS+u.challengeCleanSqueak.url),this.squeakID=null):(this.tick+=.02,this.sponge.scaleX=1+.05*Math.sin(this.tick),this.sponge.scaleY=1+.025*Math.cos(this.tick),this.sponge.rotation=.025*Math.cos(this.tick)),this.isDown&&(this.oldPos.x=this.inputPos.x,this.oldPos.y=this.inputPos.y),n.paused||this.isBusy||this.donePS&&this.donePS.update(p3.Timestep.deltaTime)},s.prototype.destroy=function(){this.bubblesPS&&(this.bubblesPS.emit=!1,this.bubblesPS.destroy()),this.donePS&&(this.donePS.emit=!1,this.donePS.destroy()),this.bgSprite.filters=[],this.playerSprite.filters=[],this.playerSprite2.filters=[],this.inputPos=null,this.spr.destroy(n.destroyAllOptions),TweenMax.killAll(),this.tutorialSpine.doSeppuku(),this.timer.doSeppuku(),this.timer=null,p3.Scene.prototype.destroy.call(this)},s.prototype.resize=function(){this.x=Math.round((p3.View.width-n.STAGE_WIDTH)/2),n.currentSubScreen&&n.currentSubScreen.resize&&n.currentSubScreen.resize(),n.viewManager.repositionDynElements()}},{"../../common":42,"../../loader/audio-loader":97,"../challenge-preloader":11,"../challenge-spine":13,"../challenge-tutorial-hand-anims":14,"../challenge-tutorial-timer":15}],18:[function(t,e,i){var s={sources:["coolEngineSpine"],scales:[.5],animations:{engineOn:{name:["engine_on"],source:0}}};e.exports=s},{}],19:[function(t,e,i){var s={sources:["coolFanSpine"],scales:[.5],animations:{fanIdle:{name:["fan_idle"],source:0},fanStart:{name:["fan_default"],source:0},fanStop:{name:["fan_stop"],source:0}}};e.exports=s},{}],20:[function(t,e,i){function s(){return PIXI.Container.call(this),this.signals={},this.createSignals(),this}var n=t("../../mini-runner");e.exports=s,s.prototype=Object.create(PIXI.Container.prototype),s.prototype.constructor=s,s.prototype.create=function(){this.move=new WRE.Sprite({texture:PIXI.Texture.WHITE,anchorXY:0,alpha:0}).addTo(this),this.move.responsive=!0,this.move.on("pointerdown",this.onInputDown,this),this.move.on("pointermove",this.onInputMove,this),this.move.on("pointerout",this.onInputUp,this),this.move.on("pointerup",this.onInputUp,this),this.move.on("pointerupoutside ",this.onInputUp,this)},s.prototype.createSignals=function(){this.signals.down=new n("onInputDown"),this.signals.move=new n("onInputMove"),this.signals.up=new n("onInputUp")},s.prototype.destroySignals=function(){for(var t in this.signals)this.signals[t]instanceof n&&this.signals[t].destroy();this.signals=null},s.prototype.onInputDown=function(t){this.signals.down.dispatch(t)},s.prototype.onInputMove=function(t){this.signals.move.dispatch(t)},s.prototype.onInputUp=function(t){this.signals.up.dispatch(t)},s.prototype.doSeppuku=function(){this.destroySignals(),this.destroy()},s.prototype.resize=function(){this.move.x=game.globalX(0),this.move.y=game.globalY(0),this.move.width=game.globalX(1)-game.globalX(0),this.move.height=game.globalY(1)},Object.defineProperty(s.prototype,"enabled",{get:function(){return this.move.interactive},set:function(t){this.move.interactive=t}})},{"../../mini-runner":103}],21:[function(t,e,i){function s(t){p3.Scene.call(this),this.gameName=t,n.viewManager.add(n.assetManager.getJSON("coolPauseView")),this.layout=n.viewManager.get(n.viewManager.activeLayout),this.pages=[n.assetManager.getTexture("ui_help_06")],this.tints=[16777215],this.topPos=-631,this.maskTopPos=101,this.currentPage=0,this.screenDim=null,this.popup=null,this.maskTL=null}var n=t("../../common"),o=t("../../screendim/screendim"),a=t("../../help-text");e.exports=s,s.prototype=Object.create(p3.Scene.prototype),s.prototype.constructor=s,s.prototype.init=function(){if(this.layout.dim){var t=this.layout.dim.color?this.layout.dim.color:null,e=this.layout.dim.duration?this.layout.dim.duration:null,i=this.layout.dim.alphaIn?this.layout.dim.alphaIn:null,s=this.layout.dim.alphaOut?this.layout.dim.alphaOut:null;this.layout.dim.alphaIn||this.layout.dim.alphaOut||!this.layout.dim.alpha||(i=this.layout.dim.alpha,s=0),this.screenDim=new o(t,e,i,s).addTo(this)}this.board=n.viewManager.addSprite(this.layout.board).addTo(this);for(var r=40,h=0;h<4;h++)this["pagination"+h]=n.viewManager.addSprite(this.layout.pagination).addTo(this.board),this["pagination"+h].x=-1.5*r+r*h,this["pagination"+h].y=-50-h%2*10,this["pagination"+h].alpha=0,this["pagination"+h].scaleXY=0;this["pagination"+this.currentPage].texture=n.assetManager.getTexture("ui_pagination_on"),this.pausedText=n.viewManager.addText(this.layout.pausedText).addTo(this.board),this.page=n.viewManager.addSprite(this.layout.page).addTo(this.board),this.maskSprite=new WRE.Sprite({texture:PIXI.Texture.WHITE,x:950-this.board.width/2,y:this.maskTopPos-this.board.height,width:this.board.width,height:400}).addTo(this),this.page.mask=this.maskSprite,this.roll=n.viewManager.addSprite(this.layout.roll).addTo(this.board),this.roll.y=this.topPos;var l={bg:{texture:n.assetManager.getTexture("ui_help_copy_bg"),nineSlice:[40,40,40,40]},choices:["ui_help_06"]};this.popup=new a(l).addTo(this),this.popup.init(),this.popup.x=950,this.popup.y=640,this.popup.show(),this.initUiElements()},s.prototype.initUiElements=function(){this.uiContainer=(new WRE.Container).addTo(this);for(var t in this.layout.ui)switch(t){case"homeButton":this.homeButton=n.viewManager.addButton(this.layout.ui.homeButton).addTo(this.uiContainer),this.homeButton.on("button-on-click",this.onHomeButtonClick.bind(this));break;case"soundButton":this.soundButton=n.viewManager.addSwitchButton(this.layout.ui.soundButton).addTo(this.uiContainer),this.soundButton.on("button-on-click",this.onSoundButtonClick.bind(this)),this.soundButton.state=n.storage_data.muted?1:0;break;case"continueButton":this.continueButton=n.viewManager.addButton(this.layout.ui.continueButton).addTo(this.uiContainer),this.continueButton.on("button-on-click",this.onContinueButtonClick.bind(this));break;case"restartButton":this.restartButton=n.viewManager.addButton(this.layout.ui.restartButton).addTo(this.uiContainer),this.restartButton.on("button-on-click",this.onRestartButtonClick.bind(this));break;case"previousButton":break;case"nextButton":}},s.prototype.animateBoardIn=function(){var t=new TimelineMax({onComplete:function(){this.animatePageIn()},onCompleteScope:this});t.from(this.board,.3,{delay:.1,y:1800,ease:Cubic.easeOut},"start"),t.to(this.board.scale,.1,{delay:.2,y:1.1,repeat:1,yoyo:!0,ease:Sine.easeInOut},"start")},s.prototype.animateBoardOut=function(){var t=new TimelineMax;t.to(this.board.scale,.1,{y:1.1,repeat:1,yoyo:!0,ease:Sine.easeInOut},"start"),t.to(this.board,.4,{delay:.1,y:1800,ease:Cubic.easeOut},"start")},s.prototype.destroyUiElements=function(){for(var t=0;t<this.uiContainer.children.length;t++)this.uiContainer.children[t].doSeppuku&&this.uiContainer.children[t].doSeppuku();this.uiContainer.destroy(n.destroyOptions)},s.prototype.requestNextScene=function(){n.viewManager.hasHideTweens?(this.animateBoardOut(),this.screenDim&&this.screenDim.out(),this.popup&&this.popup.hide(),n.viewManager.hideTweensComplete.detachAll(),n.viewManager.hideTweensComplete.add(function(){this.runNextScene()},this),n.viewManager.runHideTweens()):this.runNextScene()},s.prototype.runNextScene=function(){this.signals.next.dispatch()},s.prototype.onRestartButtonClick=function(){},s.prototype.onContinueButtonClick=function(){this.requestNextScene()},s.prototype.onHomeButtonClick=function(){this.signals.previous.dispatch()},s.prototype.onSoundButtonClick=function(t){n.toggleMute("challengeCoolMusic"),t.state=n.storage_data.muted?1:0},s.prototype.onPreviousButtonClick=function(){this.currentPage--,this.currentPage<0&&(this.currentPage=this.pages.length-1),this.updatePage()},s.prototype.onNextButtonClick=function(){this.currentPage++,this.currentPage>this.pages.length-1&&(this.currentPage=0),this.updatePage()},s.prototype.showPagination=function(t){for(var e=0;e<4;e++)this["pagination"+e].alpha=t?0:1;for(e=0;e<4;e++)TweenMax.to(this["pagination"+e],.1+(t?.1:0),{delay:t?.07*e:0,alpha:t?1:0}),TweenMax.to(this["pagination"+e].scale,.15+(t?.1:0),{delay:t?.07*e:0,x:t?1:0,y:t?1:0,ease:Back.easeOut})},s.prototype.updatePage=function(){this.page.texture=this.pages[this.currentPage],this.page.tint=this.tints[this.currentPage],this.maskTL&&(this.maskTL.kill(),this.maskTL=null);var t=.5;this.maskTL=new TimelineMax({onStart:function(){this.roll.alpha=1,this.roll.visible=!0},onStartScope:this,onComplete:function(){this.roll.visible=!1},onCompleteScope:this}),this.maskTL.fromTo(this.maskSprite,t,{y:this.maskTopPos-this.maskSprite.height},{y:this.maskTopPos,ease:Cubic.easeInOut},"start"),this.maskTL.fromTo(this.roll,t,{y:this.topPos},{y:this.topPos+340,ease:Cubic.easeInOut},"start"),this.maskTL.fromTo(this.roll.scale,t,{x:1,y:1},{x:.9,y:0},"start"),this.maskTL.fromTo(this.roll,.1,{alpha:1},{delay:.4,alpha:0},"start");for(var e=0;e<4;e++)this["pagination"+e].texture=n.assetManager.getTexture("ui_pagination_off");this["pagination"+this.currentPage].texture=n.assetManager.getTexture("ui_pagination_on")},s.prototype.animatePageIn=function(){this.page.visible=!0,this.updatePage()},s.prototype.appear=function(){this.screenDim&&this.screenDim["in"](),this.setUiVisible(!1),n.viewManager.done=!1,n.viewManager.showTweensComplete.add(this.onShowTweensComplete.bind(this)),n.viewManager.setShowTweensTime(.005),this.setUiVisible(!0),n.viewManager.runShowTweens(),this.animateBoardIn()},s.prototype.setUiVisible=function(t){if(this.uiContainer)for(var e=0;e<this.uiContainer.children.length;e++)this.uiContainer.children[e].visible=t},s.prototype.pause=function(){this.interactive=!1,this.interactiveChildren=!1},s.prototype.resume=function(){n.viewManager.activeLayout="coolPauseView",this.interactive=!0,this.interactiveChildren=!0},s.prototype.onShowTweensComplete=function(){n.viewManager.done=!0},s.prototype.destroy=function(){this.screenDim&&this.screenDim.out(),this.maskTL&&(this.maskTL.kill(),this.maskTL=null),this.popup&&this.popup.doSeppuku(),this.destroyUiElements(),this.pausedText.destroy(n.destroyAllOptions),p3.Scene.prototype.destroy.call(this)},s.prototype.update=function(){},s.prototype.resize=function(){this.x=Math.round((p3.View.width-n.STAGE_WIDTH)/2),this.screenDim&&(this.screenDim.resize(),this.screenDim.x=-this.x),n.viewManager.repositionDynElements()}},{"../../common":42,"../../help-text":92,"../../screendim/screendim":105}],22:[function(t,e,i){function s(t){p3.Scene.call(this),this.isBusy=!1,this.interactive=!0,this.interactiveChildren=!0;var e=n.assetManager.getJSON("coolGameView");e.coolGameView.backgroundImage.texture=e.coolGameView.backgroundImage.texture.replaceAll("#CARCOLOR#",n.carColors[n.currentCar]),n.viewManager.add(e),this.layout=n.viewManager.get(n.viewManager.activeLayout),this.stars=3,this.smokePS1=null,this.smokePS2=null,this.windPS=null,this.smokeFGain=.001,this.smokeFDecay=5e-4,this.smokeFMin=.001,this.smokeFMax=.1,this.isGameOver=!1,this.inputPos=new PIXI.Point,this.isDown=!1,this.hotSpotPositions=[{x:1200,y:550,ox:0,oy:-130},{x:800,y:290,ox:-140,oy:-30},{x:1054,y:208,ox:0,oy:-90},{x:940,y:570,ox:50,oy:-80},{x:850,y:480,ox:-20,oy:-100}],this.currentHotSpot=Math.floor(Math.random()*this.hotSpotPositions.length),this.theSpot=new PIXI.Circle(this.hotSpotPositions[this.currentHotSpot].x,this.hotSpotPositions[this.currentHotSpot].y,n.config.challengesSetup.cool.spot.radius),this.fanID=null,this.prevVolume=1,this.steamID=null,this.preloadStuff()}var n=t("../../common"),o=t("../challenge-preloader"),a=t("../../loader/audio-loader"),r=t("../challenge-spine"),h=t("./challenge-cool-engine-anims"),l=t("./challenge-cool-fan-anims"),u=t("./challenge-cool-input"),p=t("../challenge-tutorial-hand-anims"),c=t("../challenge-tutorial-timer"),d={challengeStarReward1:{type:"sound",url:"sfx/challenges/shared/sfx_star_reward_1",soundId:"challengeStarReward1"},challengeStarReward2:{type:"sound",url:"sfx/challenges/shared/sfx_star_reward_2",soundId:"challengeStarReward2"},challengeStarReward3:{type:"sound",url:"sfx/challenges/shared/sfx_star_reward_3",soundId:"challengeStarReward3"},challengeFanfare:{type:"sound",url:"sfx/challenges/shared/sfx_minigame_complete_fanfare_00",soundId:"challengeFanfare"},challengeCoolPickUp:{type:"sound",url:"sfx/challenges/cool/sfx_engine_fan_on_00",soundId:"challengeCoolPickUp"},challengeCoolDrop:{type:"sound",url:"sfx/challenges/cool/sfx_engine_fan_off_00",soundId:"challengeCoolDrop"},challengeCoolFan:{type:"sound",url:"sfx/challenges/cool/sfx_engine_fan_loop_00",soundId:"challengeCoolFan"},challengeCoolSteam:{type:"sound",url:"sfx/challenges/cool/sfx_engine_steam_escaping_loop_00",soundId:"challengeCoolSteam"},challengeCoolEngineStart:{type:"sound",url:"sfx/challenges/cool/sfx_engine_idle_start_00",soundId:"challengeCoolEngineStart"},challengeCoolMusic:{type:"sound",url:"music/challenges/cool/music_challenge_cool_00",soundId:"challengeCoolMusic"},challengeStart:{type:"sound",url:"music/challenges/shared/music_race_challenge_start_00",soundId:"challengeStart"},challengeEnd:{type:"sound",url:"music/challenges/shared/music_race_challenge_end_00",soundId:"challengeEnd"}},g=[{name:"screenBg",url:n.PATHS.IMAGES+"endgame_bg.jpg",destroyId:"screenBg"},{name:"selectAtlas",url:n.PATHS.IMAGES+"character/ui_vehicle_select_0.8x.json",destroyId:"ui_char_brown"},{name:"coolAtlas",url:n.PATHS.IMAGES+"challenges/cool/challenge_cool_atlas_0_1x.json",destroyId:"challenge_cool_particle_01"},{name:"coolEngineSpine",url:n.PATHS.IMAGES+"challenges/cool/engine.json",destroyId:"coolEngineSpine_atlas_page_engine"},{name:"coolFanSpine",url:n.PATHS.IMAGES+"challenges/cool/fan.json",destroyId:"coolFanSpine_atlas_page_fan"},{name:"coolSmokeParticles",url:n.PATHS.DATA+"particles/challenge_cool_particles.json"},{name:"coolWindParticles",url:n.PATHS.DATA+"particles/challenge_cool_wind_emitter.json"},{name:"tutorialHandSpine",url:n.PATHS.IMAGES+"tutorial/tutorial_hand.json",destroyId:"tutorialHandSpine_atlas_page_tutorial_hand"}];e.exports=s,s.prototype=Object.create(p3.Scene.prototype),s.prototype.constructor=s,s.prototype.preloadStuff=function(){n.memoryManager.resetLoader();for(var t in g)g[t].hasOwnProperty("destroyId")&&n.memoryManager.store("cool",g[t].destroyId);for(t in d)d[t].hasOwnProperty("soundId")&&n.memoryManager.storeSound("cool",d[t].soundId);this.audioLoader=new a(d,(!1)),this.audioLoader.start()},s.prototype.preloader=function(){return new o},s.prototype.load=function(){return g},s.prototype.init=function(){this.gameContainer=(new WRE.Container).addTo(this),this.bgSprite=n.viewManager.addSprite(this.layout.backgroundImage).addTo(this.gameContainer),this.engineSpine=new r("engineSpine",h).addTo(this.gameContainer),this.engineSpine.x=this.layout.engineSpine.x,this.engineSpine.y=this.layout.engineSpine.y,this.engineSpine.play(["engineOn"],!0),this.engineSpine.time=0,this.lidSprite=n.viewManager.addSprite(this.layout.lidImage).addTo(this.gameContainer),this.heatsContainer=new WRE.Container({x:this.hotSpotPositions[this.currentHotSpot].x,y:this.hotSpotPositions[this.currentHotSpot].y,scaleXY:.8,alpha:.5}).addTo(this.gameContainer),this.heat0=new WRE.Sprite({texture:n.assetManager.getTexture("challenge_cool_heat_yellow"),alpha:.5,anchorXY:.5,blendMode:PIXI.BLEND_MODES.ADD}).addTo(this.heatsContainer),this.heat1=new WRE.Sprite({texture:n.assetManager.getTexture("challenge_cool_heat_orange"),alpha:.75,anchorXY:.5,scaleXY:.8,blendMode:PIXI.BLEND_MODES.ADD}).addTo(this.heatsContainer),this.heat2=new WRE.Sprite({texture:n.assetManager.getTexture("challenge_cool_heat_red"),anchorXY:.5,scaleXY:.7,blendMode:PIXI.BLEND_MODES.ADD}).addTo(this.heatsContainer),this.s1c=new WRE.Container({x:this.hotSpotPositions[this.currentHotSpot].x+this.hotSpotPositions[this.currentHotSpot].ox-10,y:this.hotSpotPositions[this.currentHotSpot].y+this.hotSpotPositions[this.currentHotSpot].oy,interactive:!1,interactiveChildren:!1}).addTo(this.gameContainer),this.s2c=new WRE.Container({x:this.hotSpotPositions[this.currentHotSpot].x+this.hotSpotPositions[this.currentHotSpot].ox+10,y:this.hotSpotPositions[this.currentHotSpot].y+this.hotSpotPositions[this.currentHotSpot].oy,interactive:!1,interactiveChildren:!1}).addTo(this.gameContainer),this.windContainer=(new WRE.Container).addTo(this),this.initWindParticles(),this.fanOffset={x:-54,y:340},this.fanSpine=new r("fanSpine",l).addTo(this),this.fanSpine.x=1250+this.fanOffset.x,this.fanSpine.y=520+this.fanOffset.y,this.fanSpine.scaleX=-1,this.fanSpine.play(["fanIdle"],!1),this.tutorialContainer=new WRE.Container({visible:!1,interactive:!1,interactiveChildren:!1}).addTo(this),this.tutorialSpine=new r("tutorialHandSpine",p).addTo(this.tutorialContainer),this.timer=new c,this.timer.onComplete.add(this.playTutorial,this),this.input=(new u).addTo(this),this.input.create(),this.input.signals.down.add(this),this.input.signals.move.add(this),this.input.signals.up.add(this),this.layout.ui&&(this.uiContainer=(new WRE.Container).addTo(this),this.initUiElements())},s.prototype.playTutorial=function(t){var e="undefined"!=typeof t?t:1;this.tutorialContainer.visible=!0,this.tutorialSpine.x=this.theSpot.x+50,this.tutorialSpine.y=this.theSpot.y+66,this.tutorialSpine.play(["tap"],1!==e),this.tutorialSpine.time=0,window.delay(function(){n.storage_data.tutorial[1]=1,n.storage.save(),this.tutorialContainer&&(this.tutorialContainer.visible=!1),this.timer&&this.timer.start()},this.tutorialSpine.duration*e,this)},s.prototype.initParticles=function(){this.smokePS1=new PIXI.particles.Emitter(this.s1c,[n.assetManager.getTexture("challenge_cool_particle_01"),n.assetManager.getTexture("challenge_cool_particle_02"),n.assetManager.getTexture("challenge_cool_particle_03")],n.assetManager.getJSON("coolSmokeParticles")),this.smokePS1.updateSpawnPos(0,0),this.smokePS1.frequency=this.smokeFMin,this.smokePS1.emit=!0,this.smokePS2=new PIXI.particles.Emitter(this.s2c,[n.assetManager.getTexture("challenge_cool_particle_01"),n.assetManager.getTexture("challenge_cool_particle_02"),n.assetManager.getTexture("challenge_cool_particle_03")],n.assetManager.getJSON("coolSmokeParticles")),this.smokePS2.updateSpawnPos(0,0),this.smokePS2.frequency=this.smokeFMin,this.smokePS2.emit=!0,n.config.challengesSetup.cool.debugSpot&&(this.dg=new PIXI.Graphics,this.addChild(this.dg),this.dg.lineStyle(2,65280),this.dg.drawCircle(this.theSpot.x,this.theSpot.y,this.theSpot.radius))},s.prototype.initWindParticles=function(){this.windPS=new PIXI.particles.Emitter(this.windContainer,[n.assetManager.getTexture("challenge_cool_wind_particle")],n.assetManager.getJSON("coolWindParticles")),this.windPS.updateSpawnPos(0,0),this.windPS.emit=!1},s.prototype.initUiElements=function(){for(var t in this.layout.ui)switch(t){case"progressBar":this.progressBar=n.viewManager.addProgressBar(this.layout.ui.progressBar).addTo(this.uiContainer),this.progressBar.bar.value=1;break;case"pauseButton":this.pauseButton=n.viewManager.addButton(this.layout.ui.pauseButton).addTo(this.uiContainer),this.pauseButton.on("button-on-click",this.onPauseButtonClick.bind(this))}},s.prototype.onPauseButtonClick=function(){this.signals.pause.dispatch()},s.prototype.distance=function(t,e){var i=t.x-e.x,s=t.y-e.y;return Math.sqrt(i*i+s*s)},s.prototype.angle=function(t,e){return Math.atan2(e.y-t.y,e.x-t.x)},s.prototype.appear=function(){n.memoryManager.free("game"),n.viewManager.done=!1,n.viewManager.showTweensComplete.add(this.onShowTweensComplete.bind(this)),n.playMusic("challengeCoolMusic"),n.viewManager.runShowTweens(),this.initParticles(),this.animateHeats(),n.audio.play("challengeStart"),0===n.storage_data.tutorial[1]?window.delay(function(){this.playTutorial()},1,this):this.timer.start()},s.prototype.onShowTweensComplete=function(){this.steamID=n.audio.play("challengeCoolSteam",{loop:!0})},s.prototype.pause=function(){this.interactive=!1,this.interactiveChildren=!1,this.isBusy=!0},s.prototype.resume=function(){n.viewManager.activeLayout="coolGameView",this.interactive=!0,this.interactiveChildren=!0,this.isBusy=!1},s.prototype.destroy=function(){this.smokePS1&&(this.smokePS1.emit=!1,this.smokePS1.destroy()),this.smokePS2&&(this.smokePS2.emit=!1,this.smokePS2.destroy()),this.windPS&&(this.windPS.emit=!1,this.windPS.destroy()),this.engineSpine.doSeppuku(),this.fanSpine.doSeppuku(),this.input.doSeppuku(),TweenMax.killAll(),this.tutorialSpine.doSeppuku(),this.timer.doSeppuku(),this.timer=null,p3.Scene.prototype.destroy.call(this)},s.prototype.runNextScene=function(){this.signals.next.dispatch(this.stars)},s.prototype.requestGameOver=function(){n.audio.play("challengeEnd"),n.animator.setTimeout(function(){n.viewManager.hasHideTweens?(n.viewManager.hideTweensComplete.detachAll(),n.viewManager.hideTweensComplete.add(function(){n.audio.stopByName(n.PATHS.SOUNDS+d.challengeCoolSteam.url),this.runNextScene()},this),n.viewManager.runHideTweens()):this.runNextScene()},1,this)},s.prototype.lerp=function(t,e,i){return t*(1-i)+e*i},s.prototype.update=function(){if(this.timer&&this.timer.update(),this.tutorialContainer.visible&&this.tutorialSpine.update(p3.Timestep.deltaTime),this.smokePS1&&this.smokePS1.update(p3.Timestep.deltaTime),this.smokePS2&&this.smokePS2.update(p3.Timestep.deltaTime),this.windPS&&this.windPS.update(p3.Timestep.deltaTime),!n.paused&&!this.isBusy){if(this.fanSpine.update(p3.Timestep.deltaTime),this.isGameOver)return void this.engineSpine.update(p3.Timestep.deltaTime);if(this.isDown&&this.theSpot.contains(this.inputPos.x,this.inputPos.y)){var t=this.theSpot.radius-this.distance(this.theSpot,this.inputPos);this.smokePS1.frequency+=this.smokeFGain*t*.005,this.smokePS1.frequency>this.smokeFMax&&(this.smokePS1.frequency=this.smokeFMax),this.smokePS2.frequency=this.smokePS1.frequency}this.smokePS1.frequency-=this.smokeFDecay,this.smokePS1.frequency<this.smokeFMin&&(this.smokePS1.frequency=this.smokeFMin,this.smokePS2.frequency=this.smokeFMin),this.progressBar.bar.value=1-(this.smokePS1.frequency-this.smokeFMin)/(this.smokeFMax-this.smokeFMin),null!==this.steamID&&n.audio.fade(this.steamID,this.prevVolume,this.progressBar.bar.value,1),this.prevVolume=this.progressBar.bar.value,this.heatsContainer.alpha=this.progressBar.bar.value/2,this.progressBar.bar.value<=this.smokeFGain+.01&&!this.isGameOver&&(this.heatsContainer.visible=!1,this.onGameOver())}},s.prototype.animateHeats=function(){var t=this.heat0.scaleX,e=this.heat1.scaleX,i=this.heat2.scaleX,s=1.5;TweenMax.to(this.heat0.scale,s+.15*Math.random(),{delay:.3*Math.random(),x:.8*t,y:.8*t,repeat:-1,yoyo:!0,ease:Sine.easeInOut}),TweenMax.to(this.heat1.scale,s+.15*Math.random(),{delay:.3*Math.random(),x:.8*e,y:.8*e,repeat:-1,yoyo:!0,ease:Sine.easeInOut}),TweenMax.to(this.heat2.scale,s+.15*Math.random(),{delay:.3*Math.random(),x:.8*i,y:.8*i,repeat:-1,yoyo:!0,ease:Sine.easeInOut})},s.prototype.onInputDown=function(t){this.isGameOver||this.isDown||(this.timer.reset(),n.audio.play("challengeCoolPickUp"),this.fanSpine.play(["fanStart"],!0),this.windPS.emit=!0,this.isDown=!0,this.inputPos.x=t.data.getLocalPosition(this.input).x,this.inputPos.y=t.data.getLocalPosition(this.input).y,null===this.fanID&&(this.fanID=n.audio.play("challengeCoolFan",{loop:!0})),this.onInputMove(t))},s.prototype.onInputMove=function(t){this.isDown&&(this.timer.reset(),this.inputPos.x=t.data.getLocalPosition(this.input).x,this.inputPos.y=t.data.getLocalPosition(this.input).y,this.fanSpine.x=this.inputPos.x+this.fanOffset.x,this.fanSpine.y=this.inputPos.y+this.fanOffset.y,this.windContainer.x=this.inputPos.x,this.windContainer.y=this.inputPos.y,this.windContainer.scaleX=-1)},s.prototype.onInputUp=function(t){this.isDown&&(this.timer.reset(),null!==this.fanID&&(n.audio.stop(this.fanID),this.fanID=null),n.audio.play("challengeCoolDrop"),this.fanSpine.play(["fanStop"],!1),this.windPS.emit=!1,this.isDown=!1)},s.prototype.onGameOver=function(){null!==this.fanID&&(n.audio.stop(this.fanID),this.fanID=null),this.isGameOver=!0,this.progressBar.bar.value=0,this.smokePS1.emit=!1,this.smokePS2.emit=!1,this.windPS.emit=!1,n.audio.play("challengeCoolEngineStart"),TweenMax.to(this.gameContainer,.5,{delay:.2,alpha:1,onUpdate:function(){this.gameContainer.x=10*Math.random()-5,this.gameContainer.y=10*Math.random()-5},onUpdateScope:this,onComplete:function(){this.gameContainer.x=0,this.gameContainer.y=0},onCompleteScope:this}),TweenMax.to(this.fanSpine,.7,{alpha:0}),this.requestGameOver()},s.prototype.resize=function(){this.x=Math.round((p3.View.width-n.STAGE_WIDTH)/2),this.input.move.x=0,this.input.move.y=0,this.input.move.width=n.STAGE_WIDTH,this.input.move.height=n.STAGE_HEIGHT,n.currentSubScreen&&n.currentSubScreen.resize&&n.currentSubScreen.resize(),n.viewManager.repositionDynElements()}},{"../../common":42,"../../loader/audio-loader":97,"../challenge-preloader":11,"../challenge-spine":13,"../challenge-tutorial-hand-anims":14,"../challenge-tutorial-timer":15,"./challenge-cool-engine-anims":18,"./challenge-cool-fan-anims":19,"./challenge-cool-input":20}],23:[function(t,e,i){arguments[4][20][0].apply(i,arguments)},{"../../mini-runner":103,dup:20}],24:[function(t,e,i){function s(t){p3.Scene.call(this),this.gameName=t,n.viewManager.add(n.assetManager.getJSON("fuelPauseView")),this.layout=n.viewManager.get(n.viewManager.activeLayout),this.pages=[n.assetManager.getTexture("ui_help_07")],this.tints=[16777215],this.topPos=-631,this.maskTopPos=101,this.currentPage=0,this.screenDim=null,this.popup=null,this.maskTL=null}var n=t("../../common"),o=t("../../screendim/screendim"),a=t("../../help-text");e.exports=s,s.prototype=Object.create(p3.Scene.prototype),s.prototype.constructor=s,s.prototype.init=function(){if(this.layout.dim){var t=this.layout.dim.color?this.layout.dim.color:null,e=this.layout.dim.duration?this.layout.dim.duration:null,i=this.layout.dim.alphaIn?this.layout.dim.alphaIn:null,s=this.layout.dim.alphaOut?this.layout.dim.alphaOut:null;this.layout.dim.alphaIn||this.layout.dim.alphaOut||!this.layout.dim.alpha||(i=this.layout.dim.alpha,s=0),this.screenDim=new o(t,e,i,s).addTo(this)}this.board=n.viewManager.addSprite(this.layout.board).addTo(this);for(var r=40,h=0;h<4;h++)this["pagination"+h]=n.viewManager.addSprite(this.layout.pagination).addTo(this.board),this["pagination"+h].x=-1.5*r+r*h,this["pagination"+h].y=-50-h%2*10,this["pagination"+h].alpha=0,this["pagination"+h].scaleXY=0;this["pagination"+this.currentPage].texture=n.assetManager.getTexture("ui_pagination_on"),this.pausedText=n.viewManager.addText(this.layout.pausedText).addTo(this.board),this.page=n.viewManager.addSprite(this.layout.page).addTo(this.board),this.maskSprite=new WRE.Sprite({texture:PIXI.Texture.WHITE,x:950-this.board.width/2,y:this.maskTopPos-this.board.height,width:this.board.width,height:400}).addTo(this),this.page.mask=this.maskSprite,this.roll=n.viewManager.addSprite(this.layout.roll).addTo(this.board),this.roll.y=this.topPos;var l={bg:{texture:n.assetManager.getTexture("ui_help_copy_bg"),nineSlice:[40,40,40,40]},choices:["ui_help_07"]};this.popup=new a(l).addTo(this),this.popup.init(),this.popup.x=950,this.popup.y=640,this.popup.show(),this.initUiElements()},s.prototype.initUiElements=function(){this.uiContainer=(new WRE.Container).addTo(this);for(var t in this.layout.ui)switch(t){case"pausedText":this.pausedText=n.viewManager.addText(this.layout.ui.pausedText).addTo(this.uiContainer);break;case"homeButton":this.homeButton=n.viewManager.addButton(this.layout.ui.homeButton).addTo(this.uiContainer),this.homeButton.on("button-on-click",this.onHomeButtonClick.bind(this));break;case"soundButton":this.soundButton=n.viewManager.addSwitchButton(this.layout.ui.soundButton).addTo(this.uiContainer),this.soundButton.on("button-on-click",this.onSoundButtonClick.bind(this)),this.soundButton.state=n.storage_data.muted?1:0;break;case"continueButton":this.continueButton=n.viewManager.addButton(this.layout.ui.continueButton).addTo(this.uiContainer),this.continueButton.on("button-on-click",this.onContinueButtonClick.bind(this));break;case"restartButton":this.restartButton=n.viewManager.addButton(this.layout.ui.restartButton).addTo(this.uiContainer),this.restartButton.on("button-on-click",this.onRestartButtonClick.bind(this));break;case"previousButton":break;case"nextButton":}},s.prototype.animateBoardIn=function(){var t=new TimelineMax({onComplete:function(){this.animatePageIn()},onCompleteScope:this});t.from(this.board,.3,{delay:.1,y:1800,ease:Cubic.easeOut},"start"),t.to(this.board.scale,.1,{delay:.2,y:1.1,repeat:1,yoyo:!0,ease:Sine.easeInOut},"start")},s.prototype.animateBoardOut=function(){var t=new TimelineMax;t.to(this.board.scale,.1,{y:1.1,repeat:1,yoyo:!0,ease:Sine.easeInOut},"start"),t.to(this.board,.4,{delay:.1,y:1800,ease:Cubic.easeOut},"start")},s.prototype.destroyUiElements=function(){for(var t=0;t<this.uiContainer.children.length;t++)this.uiContainer.children[t].doSeppuku&&this.uiContainer.children[t].doSeppuku();this.uiContainer.destroy(n.destroyOptions)},s.prototype.requestNextScene=function(){n.viewManager.hasHideTweens?(this.animateBoardOut(),this.screenDim&&this.screenDim.out(),this.popup&&this.popup.hide(),n.viewManager.hideTweensComplete.detachAll(),n.viewManager.hideTweensComplete.add(function(){this.runNextScene()},this),n.viewManager.runHideTweens()):this.runNextScene()},s.prototype.runNextScene=function(){this.signals.next.dispatch()},s.prototype.onRestartButtonClick=function(){},s.prototype.onContinueButtonClick=function(){this.requestNextScene()},s.prototype.onHomeButtonClick=function(){this.signals.previous.dispatch()},s.prototype.onSoundButtonClick=function(t){
n.toggleMute("challengeFuelMusic"),t.state=n.storage_data.muted?1:0},s.prototype.onPreviousButtonClick=function(){this.currentPage--,this.currentPage<0&&(this.currentPage=this.pages.length-1),this.updatePage()},s.prototype.onNextButtonClick=function(){this.currentPage++,this.currentPage>this.pages.length-1&&(this.currentPage=0),this.updatePage()},s.prototype.showPagination=function(t){for(var e=0;e<4;e++)this["pagination"+e].alpha=t?0:1;for(e=0;e<4;e++)TweenMax.to(this["pagination"+e],.1+(t?.1:0),{delay:t?.07*e:0,alpha:t?1:0}),TweenMax.to(this["pagination"+e].scale,.15+(t?.1:0),{delay:t?.07*e:0,x:t?1:0,y:t?1:0,ease:Back.easeOut})},s.prototype.updatePage=function(){this.page.texture=this.pages[this.currentPage],this.page.tint=this.tints[this.currentPage],this.maskTL&&(this.maskTL.kill(),this.maskTL=null);var t=.5;this.maskTL=new TimelineMax({onStart:function(){this.roll.alpha=1,this.roll.visible=!0},onStartScope:this,onComplete:function(){this.roll.visible=!1},onCompleteScope:this}),this.maskTL.fromTo(this.maskSprite,t,{y:this.maskTopPos-this.maskSprite.height},{y:this.maskTopPos,ease:Cubic.easeInOut},"start"),this.maskTL.fromTo(this.roll,t,{y:this.topPos},{y:this.topPos+340,ease:Cubic.easeInOut},"start"),this.maskTL.fromTo(this.roll.scale,t,{x:1,y:1},{x:.9,y:0},"start"),this.maskTL.fromTo(this.roll,.1,{alpha:1},{delay:.4,alpha:0},"start");for(var e=0;e<4;e++)this["pagination"+e].texture=n.assetManager.getTexture("ui_pagination_off");this["pagination"+this.currentPage].texture=n.assetManager.getTexture("ui_pagination_on")},s.prototype.animatePageIn=function(){this.page.visible=!0,this.updatePage()},s.prototype.appear=function(){this.screenDim&&this.screenDim["in"](),this.setUiVisible(!1),n.viewManager.done=!1,n.viewManager.showTweensComplete.add(this.onShowTweensComplete.bind(this)),n.viewManager.setShowTweensTime(.005),this.setUiVisible(!0),n.viewManager.runShowTweens(),this.animateBoardIn()},s.prototype.setUiVisible=function(t){if(this.uiContainer)for(var e=0;e<this.uiContainer.children.length;e++)this.uiContainer.children[e].visible=t},s.prototype.pause=function(){this.interactive=!1,this.interactiveChildren=!1},s.prototype.resume=function(){n.viewManager.activeLayout="fuelPauseView",this.interactive=!0,this.interactiveChildren=!0},s.prototype.onShowTweensComplete=function(){n.viewManager.done=!0},s.prototype.destroy=function(){this.screenDim&&this.screenDim.out(),this.maskTL&&(this.maskTL.kill(),this.maskTL=null),this.popup&&this.popup.doSeppuku(),this.destroyUiElements(),this.pausedText.destroy(n.destroyAllOptions),p3.Scene.prototype.destroy.call(this)},s.prototype.update=function(){},s.prototype.resize=function(){this.x=Math.round((p3.View.width-n.STAGE_WIDTH)/2),this.screenDim&&(this.screenDim.resize(),this.screenDim.x=-this.x),n.viewManager.repositionDynElements()}},{"../../common":42,"../../help-text":92,"../../screendim/screendim":105}],25:[function(t,e,i){Pool=function(t){this.container=t.container,this.maxItems=t.maxItems||10,this.itemParams=t.itemParams,this.items=[],this.add(this.maxItems)},e.exports=Pool,Pool.prototype.add=function(t){for(var e=0;e<t;e++){var i=new WRE.Sprite(this.itemParams);i.visible=this.itemParams.visible,this.items.push(i),this.container.addChild(i)}},Pool.prototype.get=function(){for(var t=0;t<this.maxItems;t++)if(this.items[t].visible===!1){this.items[t].visible=!0;break}return t===this.maxItems&&this.expand(),this.items[t]},Pool.prototype.expand=function(){this.maxItems++,this.add(1)},Pool.prototype.hideAll=function(){for(var t=0;t<this.items.length;t++)this.items[t].visible=!1},Pool.prototype.doSeppuku=function(){this.hideAll();for(var t=0;t<this.items.length;t++)this.items[t].destroy(),this.items[t]=null;this.items=[]},Object.defineProperty(Pool.prototype,"length",{get:function(t){return this.items.length}})},{}],26:[function(t,e,i){function s(t){p3.Scene.call(this),this.isBusy=!1,this.interactive=!0,this.interactiveChildren=!0,this.canUpdate=!0;var e=n.assetManager.getJSON("fuelGameView");e.fuelGameView.backgroundImage.texture=e.fuelGameView.backgroundImage.texture.replaceAll("#CARCOLOR#",n.carColors[n.currentCar]),n.viewManager.add(e),this.layout=n.viewManager.get(n.viewManager.activeLayout),this.minScale=.5,this.stars=1,this.fuelPS=null,this.tubePS=null,this.spillPS=null,this.nozzleTween=null,this.wiggleTween=null,this.hasStarted=!1,this.isGameOver=!1,this.fillingID=null,this.pumpID=null,this.inputPos=new PIXI.Point,this.isDown=!1,this.lockPosition=new PIXI.Circle(950,340,60),this.hotSpot=new PIXI.Circle(1200,650,n.config.challengesSetup.fuel.radius),this.scaling={shadow:.1,cont:5e-4},this.bubbleSpeed={min:n.config.challengesSetup.fuel.speed.min,max:n.config.challengesSetup.fuel.speed.max},this.tickDefault=n.config.challengesSetup.fuel.spawnTick,this.tick=0,this.bubbles=[],this.tutTL=null,this.addValue=n.config.challengesSetup.fuel.barGain,this.preloadStuff()}var n=t("../../common"),o=t("../challenge-preloader"),a=t("../../loader/audio-loader"),r=t("./challenge-fuel-input"),h=t("./challenge-fuel-pool"),l=t("../challenge-spine"),u=t("../challenge-tutorial-hand-anims"),p=t("../challenge-tutorial-timer"),c={challengeStarReward1:{type:"sound",url:"sfx/challenges/shared/sfx_star_reward_1",soundId:"challengeStarReward1"},challengeStarReward2:{type:"sound",url:"sfx/challenges/shared/sfx_star_reward_2",soundId:"challengeStarReward2"},challengeStarReward3:{type:"sound",url:"sfx/challenges/shared/sfx_star_reward_3",soundId:"challengeStarReward3"},challengeFanfare:{type:"sound",url:"sfx/challenges/shared/sfx_minigame_complete_fanfare_00",soundId:"challengeFanfare"},challengeFuelPickup:{type:"sound",url:"sfx/challenges/fuel/sfx_fuel_pickup_nozzle_00",soundId:"challengeFuelPickup"},challengeFuelDrop:{type:"sound",url:"sfx/challenges/fuel/sfx_fuel_drop_nozzle_00",soundId:"challengeFuelDrop"},challengeFuelLock:{type:"sound",url:"sfx/challenges/fuel/sfx_fuel_lock_in_nozzle_00",soundId:"challengeFuelLock"},challengeFuelUnlock:{type:"sound",url:"sfx/challenges/fuel/sfx_fuel_lock_out_nozzle_00",soundId:"challengeFuelUnlock"},challengeFuelFilling:{type:"sound",url:"sfx/challenges/fuel/sfx_fuel_fill_loop_01",soundId:"challengeFuelFilling"},challengeFuelPump:{type:"sound",url:"sfx/challenges/fuel/sfx_fuel_pump_loop",soundId:"challengeFuelPump"},challengeFuelOverfull:{type:"sound",url:"sfx/challenges/fuel/sfx_fuel_overfill_loop_00",soundId:"challengeFuelOverfull"},challengeFuelMusic:{type:"sound",url:"music/challenges/fuel/music_challenge_fuel_00",soundId:"challengeFuelMusic"},challengeStart:{type:"sound",url:"music/challenges/shared/music_race_challenge_start_00",soundId:"challengeStart"},challengeEnd:{type:"sound",url:"music/challenges/shared/music_race_challenge_end_00",soundId:"challengeEnd"}},d=[{name:"screenBg",url:n.PATHS.IMAGES+"endgame_bg.jpg",destroyId:"screenBg"},{name:"selectAtlas",url:n.PATHS.IMAGES+"character/ui_vehicle_select_0.8x.json",destroyId:"ui_char_brown"},{name:"fuelAtlas",url:n.PATHS.IMAGES+"challenges/fuel/challenge_fuel_atlas_0_1x.json",destroyId:"challenge_fuel_nozzle"},{name:"fuelSpillParticles",url:n.PATHS.DATA+"particles/challenge_fuel_spill_particles.json"},{name:"fuelBarParticles",url:n.PATHS.DATA+"particles/challenge_fuel_particles.json"},{name:"fuelTubeParticles",url:n.PATHS.DATA+"particles/challenge_fuel_hose_bubbles_.json"},{name:"tutorialHandSpine",url:n.PATHS.IMAGES+"tutorial/tutorial_hand.json",destroyId:"tutorialHandSpine_atlas_page_tutorial_hand"}];e.exports=s,s.prototype=Object.create(p3.Scene.prototype),s.prototype.constructor=s,s.prototype.preloadStuff=function(){n.memoryManager.resetLoader();for(var t in d)d[t].hasOwnProperty("destroyId")&&n.memoryManager.store("fuel",d[t].destroyId);for(t in c)c[t].hasOwnProperty("soundId")&&n.memoryManager.storeSound("fuel",c[t].soundId);this.audioLoader=new a(c,(!1)),this.audioLoader.start()},s.prototype.preloader=function(){return new o},s.prototype.load=function(){return d},s.prototype.initSpillParticles=function(){this.spillPS=new PIXI.particles.Emitter(this.nozzleContainer,[n.assetManager.getTexture("challenge_fuel_particle1"),n.assetManager.getTexture("challenge_fuel_particle2"),n.assetManager.getTexture("challenge_fuel_particle3")],n.assetManager.getJSON("fuelSpillParticles")),this.spillPS.updateSpawnPos(0,0),this.spillPS.emit=!0},s.prototype.initBarParticles=function(){var t=(new WRE.Container).addTo(this),e=new WRE.Sprite({texture:n.assetManager.getTexture("challenge_fuel_progressbar_fg"),anchorX:0,anchorY:.5}).addTo(this);this.fuelPS=new PIXI.particles.Emitter(t,[n.assetManager.getTexture("challenge_fuel_bar_particle")],n.assetManager.getJSON("fuelBarParticles")),this.fuelPS.updateSpawnPos(this.progressBar.x+this.progressBar.bar.x+10,this.progressBar.y+this.progressBar.bar.y),e.x=this.progressBar.x+this.progressBar.bar.x,e.y=this.progressBar.y+this.progressBar.bar.y,t.mask=e,this.fuelPS.emit=!0},s.prototype.initTubeParticles=function(){var t=n.assetManager.getJSON("fuelTubeParticles");t.spawnRect.x=0,t.spawnRect.w=this.tubeRight.x-450,this.tubePS=new PIXI.particles.Emitter(this.tubeContainer,[n.assetManager.getTexture("challenge_fuel_particle1"),n.assetManager.getTexture("challenge_fuel_particle2"),n.assetManager.getTexture("challenge_fuel_particle3")],t),this.tubePS.updateSpawnPos(0,this.tubeMiddle.y-44),this.tubePS.emit=!0},s.prototype.init=function(){this.bgSprite=n.viewManager.addSprite(this.layout.backgroundImage).addTo(this),this.holeSprite=n.viewManager.addSprite(this.layout.holeImage).addTo(this),this.trimLeftSprite=n.viewManager.addSprite(this.layout.trimLeft).addTo(this),this.trimRightSprite=n.viewManager.addSprite(this.layout.trimRight).addTo(this),this.nozzleContainer=new WRE.Container({x:1200,y:500}).addTo(this),this.shadowSprite=n.viewManager.addSprite(this.layout.shadowImage).addTo(this.nozzleContainer),this.extensionSprite=n.viewManager.addSprite(this.layout.extensionImage).addTo(this.nozzleContainer),this.nozzleSprite=n.viewManager.addSprite(this.layout.nozzleImage).addTo(this.nozzleContainer);var t=this.distance(this.nozzleContainer,this.lockPosition);this.shadowSprite.x=-1.5*Math.abs(t*this.scaling.shadow),this.shadowSprite.y=Math.abs(t*this.scaling.shadow),this.nozzleContainer.scaleXY=1+Math.abs(t*this.scaling.cont),this.capSprite=n.viewManager.addSprite(this.layout.capImage).addTo(this),this.tubeContainer=new WRE.Container({visible:!1}).addTo(this),this.tubeMiddle=new WRE.Sprite({texture:n.assetManager.getTexture("challenge_fuel_target"),anchorXY:.5,x:this.hotSpot.x,y:this.hotSpot.y,responsive:!0}).addTo(this.tubeContainer),this.tubeMiddle.on("pointerdown",this.onHotSpotDown,this),this.tubeLeft=new WRE.Sprite({texture:n.assetManager.getTexture("challenge_fuel_tube"),anchorX:1,anchorY:.5,x:this.tubeMiddle.x-this.tubeMiddle.texture.width/2,y:this.tubeMiddle.y,width:1900-(1900-this.tubeMiddle.x)-this.tubeMiddle.texture.width/2}).addTo(this.tubeContainer),this.tubeRight=new WRE.Sprite({texture:n.assetManager.getTexture("challenge_fuel_target fail"),anchorX:0,anchorY:.5,x:this.tubeMiddle.x+this.tubeMiddle.texture.width/2,y:this.tubeMiddle.y}).addTo(this.tubeContainer);var e={container:this.tubeContainer,maxItems:10,itemParams:{texture:n.assetManager.getTexture("challenge_fuel_bloob_off"),anchorXY:.5,speed:0,visible:!1}};this.bubblesPool=new h(e),this.initTubeParticles(),n.gameParams.debug&&(this.g=(new PIXI.Graphics).addTo(this.tubeContainer),this.g.lineStyle(2,16711935),this.g.drawCircle(this.hotSpot.x,this.hotSpot.y,this.hotSpot.radius),this.g.drawCircle(this.lockPosition.x,this.lockPosition.y,this.lockPosition.radius)),this.tutorialContainer=new WRE.Container({visible:!1,interactive:!1,interactiveChildren:!1}).addTo(this),this.tutorialSpine=new l("tutorialHandSpine",u).addTo(this.tutorialContainer),this.timer=new p,this.timer.onComplete.add(this.playTutorial,this),this.input=(new r).addTo(this),this.input.create(),this.input.signals.down.add(this),this.input.signals.move.add(this),this.input.signals.up.add(this),this.layout.ui&&(this.uiContainer=(new WRE.Container).addTo(this),this.initUiElements())},s.prototype.playTutorial=function(t){if(1!==n.storage_data.tutorial[2]||!this.tubeContainer.visible){var e="undefined"!=typeof t?t:1;this.tutorialContainer.visible=!0,this.tubeContainer.visible?(this.tutorialSpine.x=this.hotSpot.x+47,this.tutorialSpine.y=this.hotSpot.y+53,this.tutorialSpine.time=0,this.tutorialSpine.play(["tap"],1!==e)):(this.tutorialSpine.x=1070,this.tutorialSpine.y=534,this.tutorialSpine.play(["place"],1!==e),this.tutorialSpine.time=0),this.tutTL&&this.tutTL.kill(),this.tutTL=window.delay(function(){this.tutorialContainer&&(this.tutorialContainer.visible=!1),this.timer&&(this.timer.maxTime=1e4,this.timer.start())},this.tutorialSpine.duration*e,this)}},s.prototype.initUiElements=function(){for(var t in this.layout.ui)switch(t){case"progressBar":this.progressBar=n.viewManager.addProgressBar(this.layout.ui.progressBar).addTo(this.uiContainer),this.progressBar.bar.value=0;break;case"pauseButton":this.pauseButton=n.viewManager.addButton(this.layout.ui.pauseButton).addTo(this.uiContainer),this.pauseButton.on("button-on-click",this.onPauseButtonClick.bind(this))}},s.prototype.onHotSpotDown=function(){for(var t=this.bubbles.length-1;t>=0;t--)this.hotSpot.contains(this.bubbles[t].x,this.bubbles[t].y)&&(this.bubbles[t].visible=!1,this.bubbles.splice(t,1),this.progressBar.bar.value+=this.addValue,this.wiggleNozzle(),n.audio.play("challengeFuelFilling",{loop:!1}))},s.prototype.onPauseButtonClick=function(){this.signals.pause.dispatch()},s.prototype.distance=function(t,e){var i=t.x-e.x,s=t.y-e.y;return Math.sqrt(i*i+s*s)},s.prototype.onInputDown=function(t){this.isGameOver||this.isDown||(n.audio.play("challengeFuelPickup"),this.isDown=!0,this.inputPos.x=t.data.getLocalPosition(this.input).x,this.inputPos.y=t.data.getLocalPosition(this.input).y,this.onInputMove(t))},s.prototype.onInputMove=function(t){if(this.isDown){this.inputPos.x=t.data.getLocalPosition(this.input).x,this.inputPos.y=t.data.getLocalPosition(this.input).y,this.hasStarted||(this.nozzleContainer.x=this.inputPos.x,this.nozzleContainer.y=this.inputPos.y);var e=this.distance(this.nozzleContainer,this.lockPosition);this.shadowSprite.x=-1.5*Math.abs(e*this.scaling.shadow),this.shadowSprite.y=Math.abs(e*this.scaling.shadow),this.nozzleContainer.scaleXY=1+Math.abs(e*this.scaling.cont),e<this.lockPosition.radius&&!this.hasStarted&&(this.isDown=!1,this.animateNozzleIn(),this.input.enabled=!1)}},s.prototype.onInputUp=function(t){this.isDown&&(this.timer.reset(),n.audio.play("challengeFuelDrop"),this.isDown=!1)},s.prototype.animateTubeIn=function(){this.tutTL&&this.tutTL.kill(),this.tutorialContainer.visible=!1,this.timer.start(),this.tubeContainer.visible=!0,TweenMax.from(this.tubeContainer,.4,{y:200,ease:Back.easeOut})},s.prototype.animateTubeOut=function(){this.tubeContainer.visible=!0,TweenMax.to(this.tubeContainer,.34,{y:240,ease:Back.easeIn})},s.prototype.wiggleNozzle=function(){null===this.wiggleTween&&(this.wiggleTween=new TimelineMax({onComplete:function(){this.wiggleTween=null,n.storage_data.tutorial[2]=1,n.storage.save(),this.canUpdate=!0},onCompleteScope:this}),this.wiggleTween.to(this.nozzleContainer,.2,{rotation:.1,ease:Sine.easeOut}),this.wiggleTween.to(this.nozzleContainer,.4,{rotation:0,ease:Sine.easeInOut}))},s.prototype.animateNozzleIn=function(){this.nozzleTween=new TimelineMax,this.nozzleTween.to(this.extensionSprite,.2,{alpha:0},"start"),this.nozzleTween.to(this.nozzleContainer,.5,{x:918,y:346,ease:Cubic.easeOut,onUpdate:function(){var t=this.distance(this.nozzleContainer,this.lockPosition);this.shadowSprite.x=-1.5*Math.abs(t*this.scaling.shadow),this.shadowSprite.y=Math.abs(t*this.scaling.shadow)},onUpdateScope:this,onComplete:function(){n.audio.play("challengeFuelLock"),this.pumpID=n.audio.play("challengeFuelPump",{loop:!0}),this.animateTubeIn(),this.hasStarted=!0},onCompleteScope:this},"start")},s.prototype.animateNozzleOut=function(){null!==this.nozzleTween&&this.nozzleTween.kill(),null!==this.fillingID&&(n.audio.stop(this.fillingID),this.fillingID=null),null!==this.pumpID&&(n.audio.stop(this.pumpID),this.pumpID=null),this.nozzleTween=new TimelineMax({onStart:function(){},onStartScope:this,onComplete:function(){this.requestGameOver()},onCompleteScope:this}),this.nozzleTween.to(this.nozzleContainer,.5,{rotation:0,ease:Cubic.easeOut},"start"),this.nozzleTween.to(this.extensionSprite,.2,{alpha:1},"start"),this.nozzleTween.to(this.nozzleContainer.position,.9,{x:1200,y:376,ease:Cubic.easeOut,onUpdate:function(){var t=this.distance(this.nozzleContainer,this.lockPosition);this.shadowSprite.x=-1.5*Math.abs(t*this.scaling.shadow),this.shadowSprite.y=Math.abs(t*this.scaling.shadow)},onUpdateScope:this},"start")},s.prototype.animateNozzleOutFail=function(){this.spillPS.emit=!1,this.off("pointerdown",this.animateNozzleOutFail,this),null!==this.nozzleTween&&this.nozzleTween.kill(),null!==this.fillingID&&(n.audio.stop(this.fillingID),this.fillingID=null),this.nozzleTween=new TimelineMax({onStart:function(){},onStartScope:this,onComplete:function(){this.requestGameOver()},onCompleteScope:this}),this.nozzleTween.to(this.extensionSprite,.2,{alpha:1},"start"),this.nozzleTween.to(this.nozzleContainer,.5,{rotation:.3,ease:Cubic.easeOut},"start"),this.nozzleTween.to(this.nozzleContainer.position,.9,{x:1100,y:820,ease:Cubic.easeOut,onUpdate:function(){var t=this.distance(this.nozzleContainer,this.lockPosition);this.shadowSprite.x=-1.5*Math.abs(t*this.scaling.shadow),this.shadowSprite.y=Math.abs(t*this.scaling.shadow)},onUpdateScope:this},"start")},s.prototype.appear=function(){n.memoryManager.free("game"),n.playMusic("challengeFuelMusic"),n.viewManager.showTweensComplete.detachAll(),n.viewManager.showTweensComplete.add(function(){this.initBarParticles()},this),n.viewManager.runShowTweens(),n.audio.play("challengeStart"),0===n.storage_data.tutorial[2]?window.delay(function(){this.playTutorial()},.3,this):this.timer.start()},s.prototype.pause=function(){this.interactive=!1,this.interactiveChildren=!1,this.isBusy=!0},s.prototype.resume=function(){n.viewManager.activeLayout="fuelGameView",this.interactive=!0,this.interactiveChildren=!0,this.isBusy=!1},s.prototype.runNextScene=function(){n.renderer.textureManager.updateTexture(n.assetManager.getTexture("ui_char_"+n.carColors[n.currentCar])),this.signals.next.dispatch(this.stars)},s.prototype.requestGameOver=function(){n.audio.play("challengeEnd"),this.fuelPS.emit=!1,n.animator.setTimeout(function(){this.animateTubeOut(),n.viewManager.hasHideTweens?(n.viewManager.hideTweensComplete.detachAll(),n.viewManager.hideTweensComplete.add(function(){this.runNextScene()},this),n.viewManager.runHideTweens()):this.runNextScene()},1,this)},s.prototype.addBubble=function(){var t=this.bubblesPool.get();t.texture=n.assetManager.getTexture("challenge_fuel_bloob_off"),t.speed=WRE.randomInterval(this.bubbleSpeed.min,this.bubbleSpeed.max),t.x=n.viewManager.getDynPosition(0).x-t.texture.width,t.y=this.tubeMiddle.y,this.isGameOver?t.scaleXY=this.minScale:t.scaleXY=1,this.bubbles.push(t)},s.prototype.updateBubbles=function(){if(this.canUpdate){this.tick--,this.tick<0&&(this.tick=this.tickDefault,this.addBubble());for(var t=this.bubbles.length-1;t>=0;t--)this.bubbles[t].x+=this.bubbles[t].speed,this.bubbles[t].x>this.hotSpot.x+this.hotSpot.radius&&(this.bubbles[t].texture=n.assetManager.getTexture("challenge_fuel_bloob_off"),this.onGameOver(!1)),this.bubbles[t].x>1900+this.bubbles[t].texture.width/2&&(this.bubbles[t].visible=!1),this.isGameOver?(this.bubbles[t].speed*=.985,this.bubbles[t].speed<1&&(this.bubbles[t].speed=1)):this.hotSpot.contains(this.bubbles[t].x,this.bubbles[t].y)&&(this.bubbles[t].texture=n.assetManager.getTexture("challenge_fuel_bloob_on"),this.bubbles[t].x>=this.hotSpot.x-this.bubbles[t].speed&&0===n.storage_data.tutorial[2]&&(this.bubbles[t].x=this.hotSpot.x,this.canUpdate=!1,this.timer.maxTime=100,this.timer.start()))}},s.prototype.update=function(){this.timer&&this.timer.update(),this.tutorialContainer.visible&&this.tutorialSpine.update(p3.Timestep.deltaTime),this.spillPS&&this.spillPS.update(p3.Timestep.deltaTime),this.fuelPS&&this.fuelPS.update(p3.Timestep.deltaTime),this.tubePS&&this.tubePS.update(p3.Timestep.deltaTime*(this.isGameOver?.5:1)),n.paused||this.isBusy||this.hasStarted&&(this.updateBubbles(),1!==this.progressBar.bar.value||this.isGameOver||this.onGameOver(!0))},s.prototype.onGameOver=function(t){if(!this.isGameOver)if(this.tubeMiddle.responsive=!1,n.audio.play("challengeFuelUnlock"),this.isGameOver=!0,this.progressBar.bar.value>.66&&(this.stars=2),t)this.stars=3,this.capSprite.visible=!0,TweenMax.to(this.capSprite,.2,{delay:.2,alpha:1}),this.animateNozzleOut();else{for(var e=this.bubbles.length-1;e>=0;e--)this.bubbles[e].x<this.hotSpot.x-this.hotSpot.radius&&TweenMax.to(this.bubbles[e].scale,.6,{delay:.2*Math.random(),x:this.minScale,y:this.minScale,ease:Elastic.easeOut});n.audio.play("challengeFuelOverfull"),this.initSpillParticles(0,0),n.animator.setTimeout(function(){this.requestGameOver()},1,this)}},s.prototype.destroy=function(){this.input.doSeppuku(),this.bubblesPool.doSeppuku(),this.hotSpot=null,this.spillPS&&(this.spillPS.emit=!1,this.spillPS.destroy()),this.fuelPS&&(this.fuelPS.emit=!1,this.fuelPS.destroy()),this.tubePS&&(this.tubePS.emit=!1,this.tubePS.destroy()),null!==this.nozzleTween&&this.nozzleTween.kill(),null!==this.wiggleTween&&this.wiggleTween.kill(),this.g&&this.g.destroy(),TweenMax.killAll(),this.tutorialSpine.doSeppuku(),this.timer.doSeppuku(),this.timer=null,p3.Scene.prototype.destroy.call(this)},s.prototype.resize=function(){this.x=Math.round((p3.View.width-n.STAGE_WIDTH)/2),this.input.move.x=0,this.input.move.y=0,this.input.move.width=n.STAGE_WIDTH,this.input.move.height=n.STAGE_HEIGHT,n.currentSubScreen&&n.currentSubScreen.resize&&n.currentSubScreen.resize(),n.viewManager.repositionDynElements()}},{"../../common":42,"../../loader/audio-loader":97,"../challenge-preloader":11,"../challenge-spine":13,"../challenge-tutorial-hand-anims":14,"../challenge-tutorial-timer":15,"./challenge-fuel-input":23,"./challenge-fuel-pool":25}],27:[function(t,e,i){function s(){return PIXI.Container.call(this),this.isDown=!1,this.touchMove=new PIXI.Point(0,0),this.init(),this}var n=t("../../common");e.exports=s,s.prototype=Object.create(PIXI.Container.prototype),s.prototype.constructor=s,s.prototype.init=function(){this.interactive=!0,this.hitArea=new PIXI.Rectangle(0,0,n.STAGE_WIDTH,n.STAGE_HEIGHT),this.on("mousedown",this.onInputDown.bind(this)),this.on("mouseup",this.onInputUp.bind(this)),this.on("mouseupoutside",this.onInputUp.bind(this)),this.on("mousemove",this.onInputMove.bind(this)),this.on("touchstart",this.onInputDown.bind(this)),this.on("touchend",this.onInputUp.bind(this)),this.on("touchendoutside",this.onInputUp.bind(this)),this.on("touchmove",this.onInputMove.bind(this))},s.prototype.onInputDown=function(t){this.isDown||(this.isDown=!0,this.touchMove.x=t.data.getLocalPosition(this).x,this.touchMove.y=t.data.getLocalPosition(this).y,this.emit("input-down",this,this.touchMove))},s.prototype.onInputUp=function(){this.isDown&&(this.isDown=!1,this.emit("input-up",this,this.touchMove))},s.prototype.onInputMove=function(t){this.isDown&&(this.touchMove.x=t.data.getLocalPosition(this).x,this.touchMove.y=t.data.getLocalPosition(this).y,this.emit("input-move",this,this.touchMove))},s.prototype.doSeppuku=function(){this.off("mousedown",this.onInputDown.bind(this)),this.off("mouseup",this.onInputUp.bind(this)),this.off("mouseupoutside",this.onInputUp.bind(this)),this.off("mousemove",this.onInputMove.bind(this)),this.off("touchstart",this.onInputDown.bind(this)),this.off("touchend",this.onInputUp.bind(this)),this.off("touchendoutside",this.onInputUp.bind(this)),this.off("touchmove",this.onInputMove.bind(this)),this.destroy()},s.prototype.resize=function(){this.hitArea.x=Math.floor((n.STAGE_WIDTH-p3.View.width)/2),this.hitArea.y=0,this.hitArea.width=p3.View.width,this.hitArea.height=n.STAGE_HEIGHT}},{"../../common":42}],28:[function(t,e,i){function s(t){p3.Scene.call(this),this.gameName=t,n.viewManager.add(n.assetManager.getJSON("mapPauseView")),this.layout=n.viewManager.get(n.viewManager.activeLayout),this.screenDim=null}var n=t("../../common"),o=t("../../screendim/screendim");e.exports=s,s.prototype=Object.create(p3.Scene.prototype),s.prototype.constructor=s,s.prototype.init=function(){if(this.layout.dim){var t=this.layout.dim.color?this.layout.dim.color:null,e=this.layout.dim.duration?this.layout.dim.duration:null,i=this.layout.dim.alphaIn?this.layout.dim.alphaIn:null,s=this.layout.dim.alphaOut?this.layout.dim.alphaOut:null;this.layout.dim.alphaIn||this.layout.dim.alphaOut||!this.layout.dim.alpha||(i=this.layout.dim.alpha,s=0),this.screenDim=new o(t,e,i,s).addTo(this)}this.layout.dialog&&(this.dialogContainer=(new WRE.Container).addTo(this),this.initDialogElements())},s.prototype.initDialogElements=function(){this.dialogSprite=n.viewManager.addSprite(this.layout.dialog.main).addTo(this.dialogContainer);for(var t in this.layout.dialog.children)switch(t){case"pausedText":this.pausedText=n.viewManager.addText(this.layout.dialog.children.pausedText).addTo(this.dialogSprite);break;case"continueButton":this.continueButton=n.viewManager.addButton(this.layout.dialog.children.continueButton).addTo(this.dialogSprite),this.continueButton.on("button-on-click",this.onContinueButtonClick.bind(this));break;case"soundButton":this.soundButton=n.viewManager.addSwitchButton(this.layout.dialog.children.soundButton).addTo(this.dialogSprite),this.soundButton.on("button-on-click",this.onSoundButtonClick.bind(this)),this.soundButton.state=n.storage_data.muted?1:0;break;case"resetButton":this.resetButton=n.viewManager.addButton(this.layout.dialog.children.resetButton).addTo(this.dialogSprite),this.resetButton.on("button-on-click",this.onResetButtonClick.bind(this))}},s.prototype.requestNextScene=function(t){n.viewManager.hasHideTweens?(this.screenDim&&this.screenDim.out(),n.viewManager.hideTweensComplete.detachAll(),n.viewManager.hideTweensComplete.add(function(){this.runNextScene(t)},this),n.viewManager.runHideTweens()):this.runNextScene(t)},s.prototype.runNextScene=function(t){this.signals[t].dispatch()},s.prototype.onSoundButtonClick=function(t){n.toggleMute("challengeMapMusic"),t.state=n.storage_data.muted?1:0},s.prototype.onContinueButtonClick=function(){this.requestNextScene("next")},s.prototype.onResetButtonClick=function(t,e){this.requestNextScene("previous")},s.prototype.appear=function(){this.screenDim&&this.screenDim["in"](),n.viewManager.runShowTweens()},s.prototype.pause=function(){this.interactive=!1,this.interactiveChildren=!1},s.prototype.resume=function(){n.viewManager.activeLayout="mapPauseView",this.interactive=!0,this.interactiveChildren=!0},s.prototype.destroy=function(){this.screenDim&&this.screenDim.out(),this.pausedText.destroy(n.destroy),p3.Scene.prototype.destroy.call(this)},s.prototype.update=function(){},s.prototype.resize=function(){this.x=Math.round((p3.View.width-n.STAGE_WIDTH)/2),this.screenDim&&(this.screenDim.resize(),this.screenDim.x=-this.x),n.viewManager.repositionDynElements()}},{"../../common":42,"../../screendim/screendim":105}],29:[function(t,e,i){e.exports={timeToCompleteGame:60,timeMultiplier:16.7,gameSuccess:100,switchShapesDelay:1.5,gameOverDelay:1,snapTolerance:60,disconnectTolerance:110,debugDraw:!1,shapeTutorial:{show:!0,duration:4,fade:.5},shapes:[{connector:{visible:!1,step:1,color:"#e93232",width:20,alpha:.8},position:{x:571,y:212},data:[{moveTo:[34.511266,181.14189]},{bezierCurveTo:[34.511266,181.14189,184.32727,185.16888999999998,267.42327,206.42789]},{bezierCurveTo:[388.04827,177.99688999999998,408.64927,173.36989,472.85827,165.51089]},{bezierCurveTo:[537.06727,157.65188999999998,560.74127,143.69888999999998,560.74127,143.69888999999998]},{bezierCurveTo:[560.74127,143.69888999999998,631.95227,235.78088999999997,682.51027,268.96587999999997]},{bezierCurveTo:[733.06827,302.15088,793.72627,297.20988,793.72627,297.20988]}]},{connector:{visible:!1,step:1,color:"#e93232",width:20,alpha:.8},position:{x:520,y:75},data:[{moveTo:[86.96152,310.60665]},{bezierCurveTo:[96.96152,310.60665,73.560673,344.58512,37.30913499999999,382.19058]},{bezierCurveTo:[1.044982499999989,419.80912,1.2751345999999941,509.06758,43.56813499999999,545.83358]},{bezierCurveTo:[85.86113499999999,582.59958,136.99232999999998,584.37004,136.99232999999998,584.37004]},{bezierCurveTo:[136.99232999999998,584.37004,156.32943999999998,386.34369000000004,339.03986999999995,334.75673]},{bezierCurveTo:[481.01066999999995,294.67231,578.84818,298.41365,610.8131799999999,286.64265]},{bezierCurveTo:[521.1641799999999,203.35765,445.9788299999999,151.58008,368.31036999999986,122.64004]}]},{connector:{visible:!1,step:1,color:"#e93232",width:20,alpha:.8},position:{x:514,y:42},data:[{moveTo:[93.351621,316.3038]},{bezierCurveTo:[93.351621,316.3038,100.83730999999999,308.77978,74.620548,275.85763000000003]},{bezierCurveTo:[40.79143,233.37614,-37.241688,158.80129,48.117312,113.52829]},{bezierCurveTo:[133.47631,68.255288,229.25393,127.18825,273.91693,146.32925]},{bezierCurveTo:[318.57993,165.47025,360.23131,158.69994,360.23131,158.69994]},{bezierCurveTo:[360.23131,158.69994,474.94393,173.01525,618.24293,320.57725]},{bezierCurveTo:[651.61293,305.03525,707.31693,284.34225,722.30893,243.59224999999998]},{bezierCurveTo:[745.03993,181.80924999999996,717.31593,97.04325099999997,717.31593,97.04325099999997]}]},{connector:{visible:!1,step:1,color:"#e93232",width:20,alpha:.8},position:{x:512,y:126},data:[{moveTo:[369.21552,69.822348]},{bezierCurveTo:[369.21552,69.822348,385.12753000000004,70.54518200000001,434.6673,95.835812]},{bezierCurveTo:[454.70946000000004,106.06757,479.05240000000003,120.54605000000001,507.89564,141.03276]},{bezierCurveTo:[549.27675,172.62001,587.58317,202.59592,618.17017,231.43173000000002]},{bezierCurveTo:[593.49661,239.69917,564.46903,246.73447000000002,530.34845,252.86052]},{bezierCurveTo:[503.52410999999995,257.67659000000003,473.55204,261.9307,440.07316999999995,265.77973000000003]},{bezierCurveTo:[394.98414999999994,270.96357,359.37816999999995,280.04173000000003,327.4901699999999,293.26973000000004]},{bezierCurveTo:[361.1316599999999,300.30481000000003,395.36725999999993,309.09453,427.9287299999999,320.07895]},{bezierCurveTo:[461.14197999999993,331.28325,493.07285999999993,346.14937000000003,520.3952499999999,362.38756]},{bezierCurveTo:[545.5222899999999,377.321,566.6807999999999,393.20228000000003,582.91739,413.15138]},{bezierCurveTo:[598.18063,431.90458,614.6613299999999,456.00743,618.8581399999999,479.81571]}]},{connector:{visible:!1,step:1,color:"#e93232",width:20,alpha:.8},position:{x:0,y:4},data:[{moveTo:[1125.5694,601.8548]},{bezierCurveTo:[1117.7915,572.6638399999999,1102.4738,545.2045599999999,1081.6155,523.60663]},{bezierCurveTo:[1044.4441,485.11717,991.5174099999999,460.00273,939.7366399999999,443.39963]},{bezierCurveTo:[901.8733599999998,431.25905,869.8840599999999,421.03873,842.0020299999999,415.02438]},{bezierCurveTo:[875.4610299999999,400.13638000000003,900.5439499999999,392.56793,949.3659799999999,386.95526]},{bezierCurveTo:[1004.0115000000002,380.67311,1050.2261,373.7805,1087.9343000000001,364.59496]},{bezierCurveTo:[1156.0418,350.32476,1198.2915999999998,328.14647,1221.0747999999999,297.30355000000003]},{bezierCurveTo:[1248.4210999999998,260.28327,1246.562,196.85722000000004,1238.8699,139.55007000000003]}]},{connector:{visible:!1,step:1,color:"#e93232",width:20,alpha:.8},position:{x:0,y:6},data:[{moveTo:[1122.9516,603.32774]},{bezierCurveTo:[1104.6686000000002,601.02874,1090.1936,600.6567399999999,1071.6846,602.05274]},{bezierCurveTo:[1040.6931,604.38778,991.89155,621.8891,935.09586,637.12257]},{bezierCurveTo:[886.79079,650.07872,832.7030500000001,661.3944,778.87156,660.34374]},{bezierCurveTo:[778.87156,660.34374,697.07757,667.04845,627.6559500000001,647.0724200000001]},{bezierCurveTo:[575.47197,632.0565100000001,530.2789600000001,601.9647100000001,532.07356,542.61674]
},{bezierCurveTo:[535.57356,426.93374000000006,615.7345600000001,436.3177400000001,603.18556,362.02574000000004]},{bezierCurveTo:[590.63656,287.73374,442.37356,183.72274000000004,576.22956,141.43373000000005]},{bezierCurveTo:[645.2424599999999,119.62899000000006,696.44642,143.41736000000006,750.14638,165.12543000000005]},{bezierCurveTo:[806.48275,187.89926000000006,865.5662100000001,208.38351000000006,950.8415600000001,171.53274000000005]},{bezierCurveTo:[978.1003000000001,159.75319000000005,1029.5278,145.80471000000006,1087.8755,136.83503000000005]},{bezierCurveTo:[1132.7349000000002,129.93889000000004,1181.6848,125.98570000000005,1226.8866,128.22373000000005]},{bezierCurveTo:[1273.9476,130.55473000000003,1320.2425,139.76573000000005,1347.8655,159.05774000000005]}]},{connector:{visible:!1,step:1,color:"#e93232",width:20,alpha:.8},position:{x:512,y:121},data:[{moveTo:[91.062,246.706]},{bezierCurveTo:[86.236052,218.13565,61.338832,185.17007,40.13466,153.00997]},{bezierCurveTo:[6.201239,101.54357,-18.274221,52.13999,64.105,26.114]},{bezierCurveTo:[140.87802,1.8574298,195.6119,34.023846,256.26017,56.981871]},{bezierCurveTo:[307.3245,76.311958,362.58167,89.114012,438.717,56.213]},{bezierCurveTo:[468.65863,43.274068,527.98986,27.739764,593.49033,19.053038]},{bezierCurveTo:[633.26415,13.7782,675.31274,11.028254,714.437,12.9175]},{lineTo:[717.027,24.404]},{bezierCurveTo:[738.7562300000001,107.06961,734.8521000000001,162.87919,684.83954,201.69040999999999]},{bezierCurveTo:[641.42221,235.38354,563.25539,256.2659,436.943,270.787]}]},{connector:{visible:!1,step:1,color:"#e93232",width:20,alpha:.8},position:{x:0,y:5},data:[{moveTo:[1346.8576,160.19982]},{bezierCurveTo:[1384.5517,186.52474999999998,1389.5152,214.46974999999998,1376.4694,253.14511]},{bezierCurveTo:[1363.3599,292.00937,1347.5527,339.54181,1345.9179,395.42882]},{bezierCurveTo:[1344.5028,443.80681999999996,1354.2602,478.43433999999996,1365.4822,506.75534]},{bezierCurveTo:[1383.8901999999998,553.21434,1402.2776,583.33034,1368.0046,623.61634]},{bezierCurveTo:[1316.2856,684.41034,1191.9856,594.0488200000001,1070.6786,603.1928]},{bezierCurveTo:[1013.3285999999999,607.51382,894.9906,663.76982,777.8656,661.4838199999999]},{bezierCurveTo:[777.8656,661.4838199999999,717.4336,666.7498199999999,655.7855999999999,655.03582]},{bezierCurveTo:[668.36871,595.1015399999999,688.32048,542.95641,715.61474,505.52203999999995]},{bezierCurveTo:[741.40097,471.0972699999999,779.2352599999999,437.89118999999994,835.4746,414.73581999999993]},{bezierCurveTo:[791.4184,405.3381299999999,748.77061,399.0913299999999,712.29153,394.9457999999999]},{bezierCurveTo:[648.0636,387.64685,602.9585999999999,386.86181999999997,602.9585999999999,386.8618199999999]},{bezierCurveTo:[604.2575999999999,379.32482,603.8874999999999,373.27883999999995,602.1795999999999,363.1678199999999]},{bezierCurveTo:[597.10474,333.1238599999999,569.83472,298.21957999999995,548.0039599999999,264.5026299999999]},{bezierCurveTo:[515.8521399999998,214.84510999999995,495.4984699999999,167.76298999999995,575.2225999999999,142.5758199999999]},{bezierCurveTo:[632.67282,124.42418999999997,677.7817299999999,137.86787999999996,722.26272,155.40511999999995]},{bezierCurveTo:[769.4068,173.99230999999995,815.84552,197.17787999999996,875.5246,192.2188199999999]}]}]}},{}],30:[function(t,e,s){function n(t){if(p3.Scene.call(this),this.isBusy=!1,this.signals.howToPlay=new signals.Signal,this.interactive=!0,this.interactiveChildren=!0,this.obstacleSprites=[],this.obstacles=[[{texture:"challenge_map_hole",anchorXY:.5,x:660,y:660},{texture:"challenge_map_barrier_landscape",anchorXY:.5,x:522,y:217},{texture:"challenge_map_barrier_portrait",anchorXY:.5,x:798,y:208},{texture:"challenge_map_rocks_1",anchorXY:.5,x:1124,y:606},{texture:"challenge_map_rocks_2",anchorXY:.5,x:1198,y:311},{texture:"challenge_map_endpoint_1",anchorXY:.5,x:1361,y:502}],[{texture:"challenge_map_hole",anchorXY:.5,x:715,y:402},{texture:"challenge_map_barrier_landscape",anchorXY:.5,x:522,y:217},{texture:"challenge_map_barrier_landscape",anchorXY:.5,x:1266,y:615},{texture:"challenge_map_barrier_portrait",anchorXY:.5,x:798,y:208},{texture:"challenge_map_rocks_1",anchorXY:.5,x:1124,y:606},{texture:"challenge_map_rocks_2",anchorXY:.5,x:1198,y:311},{texture:"challenge_map_rocks_2",anchorXY:.5,x:1360,y:513},{texture:"challenge_map_endpoint_1",anchorXY:.5,x:899,y:193}],[{texture:"challenge_map_hole",anchorXY:.5,x:715,y:402},{texture:"challenge_map_barrier_landscape",anchorXY:.5,x:582,y:425},{texture:"challenge_map_barrier_landscape",anchorXY:.5,x:1181,y:402},{texture:"challenge_map_barrier_portrait",anchorXY:.5,x:734,y:238},{texture:"challenge_map_rocks_1",anchorXY:.5,x:962,y:171},{texture:"challenge_map_rocks_2",anchorXY:.5,x:1014,y:383},{texture:"challenge_map_endpoint_2",anchorXY:.5,x:1234,y:129}],[{texture:"challenge_map_hole",anchorXY:.5,x:715,y:402},{texture:"challenge_map_hole",anchorXY:.5,x:651,y:660},{texture:"challenge_map_barrier_landscape",anchorXY:.5,x:582,y:425},{texture:"challenge_map_barrier_landscape",anchorXY:.5,x:1181,y:402},{texture:"challenge_map_barrier_portrait",anchorXY:.5,x:734,y:238},{texture:"challenge_map_rocks_1",anchorXY:.5,x:962,y:171},{texture:"challenge_map_rocks_2",anchorXY:.5,x:1233,y:137},{texture:"challenge_map_endpoint_2",anchorXY:.5,x:1144,y:610}],[{texture:"challenge_map_hole",anchorXY:.5,x:664,y:661},{texture:"challenge_map_barrier_landscape",anchorXY:.5,x:770,y:403},{texture:"challenge_map_barrier_landscape",anchorXY:.5,x:1212,y:429},{texture:"challenge_map_barrier_portrait",anchorXY:.5,x:1027,y:147},{texture:"challenge_map_rocks_1",anchorXY:.5,x:1357,y:515},{texture:"challenge_map_rocks_2",anchorXY:.5,x:988,y:243},{texture:"challenge_map_endpoint_2",anchorXY:.5,x:1237,y:122}],[{texture:"challenge_map_hole",anchorXY:.5,x:818,y:418},{texture:"challenge_map_hole",anchorXY:.5,x:888,y:433},{texture:"challenge_map_barrier_landscape",anchorXY:.5,x:648,y:319},{texture:"challenge_map_barrier_landscape",anchorXY:.5,x:1242,y:177},{texture:"challenge_map_barrier_portrait",anchorXY:.5,x:648,y:386},{texture:"challenge_map_rocks_1",anchorXY:.5,x:988,y:243},{texture:"challenge_map_rocks_2",anchorXY:.5,x:1356,y:509},{texture:"challenge_map_endpoint_1",anchorXY:.5,x:1346,y:160}],[{texture:"challenge_map_hole",anchorXY:.5,x:818,y:418},{texture:"challenge_map_hole",anchorXY:.5,x:888,y:433},{texture:"challenge_map_barrier_landscape",anchorXY:.5,x:693,y:270},{texture:"challenge_map_barrier_landscape",anchorXY:.5,x:1266,y:131},{texture:"challenge_map_barrier_portrait",anchorXY:.5,x:588,y:418},{texture:"challenge_map_rocks_1",anchorXY:.5,x:970,y:226},{texture:"challenge_map_rocks_2",anchorXY:.5,x:1189,y:415},{texture:"challenge_map_endpoint_1",anchorXY:.5,x:948,y:387}],[{texture:"challenge_map_hole",anchorXY:.5,x:961,y:392},{texture:"challenge_map_hole",anchorXY:.5,x:1107,y:559},{texture:"challenge_map_barrier_landscape",anchorXY:.5,x:693,y:270},{texture:"challenge_map_barrier_landscape",anchorXY:.5,x:1266,y:131},{texture:"challenge_map_barrier_portrait",anchorXY:.5,x:588,y:418},{texture:"challenge_map_rocks_1",anchorXY:.5,x:1289,y:503},{texture:"challenge_map_rocks_2",anchorXY:.5,x:1132,y:353},{texture:"challenge_map_endpoint_1",anchorXY:.5,x:873,y:196}]],o.viewManager.add(o.assetManager.getJSON("mapGameView")),this.layout=o.viewManager.get(o.viewManager.activeLayout),this.easyMode=!0,this.easyModeSnapTolerance=20,0===o.mapPaths.length){for(var e=0;e<o.availableMapPaths.length;e++)o.mapPaths.push(o.availableMapPaths[e]);this.shuffle(o.mapPaths)}this.currentShape=o.mapPaths.pop(),this.pathLength=0,this.shapesToCompleteGame=1,this.shapePosition=null,this.isGameOver=!1,this.shapeGraphics=null,this.shapePoints=[],this.startedShape=!1,this.lastIndexIn=0,this.inCircle=new PIXI.Circle(0,0,r.snapTolerance),this.disconnectTolerance=r.disconnectTolerance,this.debugDraw=r.debugDraw,this.pointerGraphics=null,this.pathPS=null,this.sparklePS=null,this.soundID=null,this.soundEndID=null,this.tweenSprite=null,this.tweenTl=null,this.hintTimer=0,this.stars=4,this.preloadStuff()}var o=t("../../common"),a=t("./challenge-map-input"),r=t("./challenge-map-setup.json"),h=t("../challenge-preloader"),l=t("../../loader/audio-loader"),u=t("../challenge-spine"),p=t("../challenge-tutorial-hand-anims"),c=t("../challenge-tutorial-timer"),d={challengeMapMusic:{type:"sound",url:"music/challenges/map/music_challenge_map_00",soundId:"challengeMapMusic"},challengeMapStart:{type:"sound",url:"sfx/challenges/map/sfx_map_draw_start_00",soundId:"challengeMapStart"},challengeMapDrawing:{type:"sound",url:"sfx/challenges/map/sfx_map_draw_loop_00",soundId:"challengeMapDrawing"},challengeMapStop:{type:"sound",url:"sfx/challenges/map/sfx_map_draw_end_00",soundId:"challengeMapStop"},challengeStart:{type:"sound",url:"music/challenges/shared/music_race_challenge_start_00",soundId:"challengeStart"},challengeEnd:{type:"sound",url:"music/challenges/shared/music_race_challenge_end_00",soundId:"challengeEnd"}},g=[{name:"selectAtlas",url:o.PATHS.IMAGES+"character/ui_vehicle_select_0.8x.json",destroyId:"ui_char_brown"},{name:"mapBackground",url:o.PATHS.IMAGES+"challenges/map/challenge_map_bg.jpg",destroyId:"mapBackground"},{name:"mapAtlas",url:o.PATHS.IMAGES+"challenges/map/challenge_map_atlas_0_1x.json",destroyId:"challenge_map_route_1"},{name:"mapPathParticles",url:o.PATHS.DATA+"particles/map-path-particles.json"},{name:"mapCompleteParticles",url:o.PATHS.DATA+"particles/map-complete-particles.json"},{name:"tutorialHandSpine",url:o.PATHS.IMAGES+"tutorial/tutorial_hand.json",destroyId:"tutorialHandSpine_atlas_page_tutorial_hand"}];e.exports=n,n.prototype=Object.create(p3.Scene.prototype),n.prototype.constructor=n,n.prototype.preloadStuff=function(){o.memoryManager.resetLoader();for(var t in g)g[t].hasOwnProperty("destroyId")&&o.memoryManager.store("map",g[t].destroyId);for(t in d)d[t].hasOwnProperty("soundId")&&o.memoryManager.storeSound("map",d[t].soundId);this.audioLoader=new l(d,(!1)),this.audioLoader.start()},n.prototype.preloader=function(){return new h},n.prototype.load=function(){return g},n.prototype.init=function(){this.bgSprite=o.viewManager.addSprite(this.layout.backgroundImage).addTo(this),this.bgSprite.scaleX=1900/1024,this.debugDraw&&(this.debugContainer=(new WRE.Container).addTo(this)),this.connectorContainer=(new WRE.Container).addTo(this),this.connectorGraphics=new PIXI.Graphics,this.connectorGraphics.alpha=0,this.connectorContainer.addChild(this.connectorGraphics),this.controller=(new a).addTo(this),this.controller.on("input-down",this.onInputDown.bind(this)),this.controller.on("input-move",this.onInputMove.bind(this)),this.controller.on("input-up",this.onInputUp.bind(this)),this.initShape(),this.obstacleContainer=(new WRE.Container).addTo(this),this.drawObstacles(),this.hand=new WRE.Sprite({texture:o.assetManager.getTexture("ui_tut_hand"),anchorX:.13,anchorY:.1}).addTo(this),this.hand.x=this.shapePoints[this.lastIndexIn].x,this.hand.y=this.shapePoints[this.lastIndexIn].y,this.interaction=o.renderer.plugins.interaction,this.interaction.on("pointermove",this.onInteraction,this),this.tutorialContainer=new WRE.Container({visible:!1,interactive:!1,interactiveChildren:!1}).addTo(this),this.tutorialSpine=new u("tutorialHandSpine",p).addTo(this.tutorialContainer),this.tutorialSpine.x=50,this.tutorialSpine.y=62,this.timer=new c,this.timer.onComplete.add(this.playTutorial,this),this.pathPSContainer=new WRE.Container({interactive:!1,interactiveChildren:!1}).addTo(this),this.pathPS=new PIXI.particles.Emitter(this.pathPSContainer,[o.assetManager.getTexture("challenge_map_sparkle_1"),o.assetManager.getTexture("challenge_map_sparkle_2")],o.assetManager.getJSON("mapPathParticles")),this.pathPS.emit=!1,this.initUiElements()},n.prototype.initUiElements=function(){this.uiContainer=(new WRE.Container).addTo(this);for(var t in this.layout.ui)switch(t){case"soundButton":this.soundButton=o.viewManager.addSwitchButton(this.layout.ui.soundButton).addTo(this.uiContainer),this.soundButton.on("button-on-click",this.onSoundButtonClick.bind(this)),this.soundButton.state=o.storage_data.muted?1:0;break;case"homeButton":this.homeButton=o.viewManager.addButton(this.layout.ui.homeButton).addTo(this.uiContainer),this.homeButton.on("button-on-click",this.onHomeButtonClick.bind(this))}},n.prototype.destroyUiElements=function(){for(var t=0;t<this.uiContainer.children.length;t++)this.uiContainer.children[t].doSeppuku&&this.uiContainer.children[t].doSeppuku();this.uiContainer.destroy(o.destroyOptions)},n.prototype.onInteraction=function(t){var e=this.toLocal(t.data.global);this.hand.x=e.x,this.hand.y=e.y},n.prototype.playTutorial=function(t){if(!this.isGameOver){var e="undefined"!=typeof t?t:1,i=r.shapeTutorial.duration*((this.shapePoints.length-.5*this.lastIndexIn)/this.shapePoints.length),s=r.shapeTutorial.fade;this.tutorialContainer.alpha=0,this.tutorialContainer.x=this.shapePoints[this.lastIndexIn].x,this.tutorialContainer.y=this.shapePoints[this.lastIndexIn].y,this.tutorialSpine.play(["tap"],!1),this.tutorialSpine.time=.5,this.tweenTl&&this.tweenTl.kill(),this.tweenTl=new TimelineMax({onStart:function(){this.tutorialContainer.visible=!0},onStartScope:this,onComplete:function(){this.tutorialContainer.visible=!1},onCompleteScope:this}),this.tweenTl.to(this.tutorialContainer,.5*s,{alpha:1,ease:Linear.easeNone}),this.tweenTl.to(this.tutorialContainer.position,i,{delay:.5*s,bezier:{type:"thru",values:this.shapePoints.slice(this.lastIndexIn)},ease:Cubic.easeInOut},"start"),this.tweenTl.to(this.tutorialContainer,s,{delay:s+i-s,alpha:0,ease:Linear.easeNone},"start"),window.delay(function(){o.storage_data.tutorial[3]=1,o.storage.save(),this.timer&&this.timer.start()},i*e+2*s,this)}},n.prototype.initParticles=function(t,e){this.sparklePSContainer=new WRE.Container({interactive:!1,interactiveChildren:!1}).addTo(this),this.sparklePS=new PIXI.particles.Emitter(this.sparklePSContainer,[o.assetManager.getTexture("challenge_map_sparkle_1"),o.assetManager.getTexture("challenge_map_sparkle_2")],o.assetManager.getJSON("mapCompleteParticles")),this.sparklePS.updateSpawnPos(t,e),this.sparklePS.emit=!0},n.prototype.shuffle=function(t){var e,i,s;for(s=t.length-1;s>0;s--)e=Math.floor(Math.random()*(s+1)),i=t[s],t[s]=t[e],t[e]=i;return t},n.prototype.initShape=function(){this.isGameOver||(this.shapePosition=r.shapes[this.currentShape].position,this.pointerGraphics=null,this.shapeGraphics=null,this.shapePoints=[],this.startedShape=!1,this.connectorContainer.visible=!r.shapes[this.currentShape].connector.visible||r.shapes[this.currentShape].connector.visible,this.connectorGraphics.clear(),this.connectorColor=r.shapes[this.currentShape].connector.color?parseInt(r.shapes[this.currentShape].connector.color.replace(/^#/,""),16):16777215,this.connectorWidth=r.shapes[this.currentShape].connector.width?r.shapes[this.currentShape].connector.width:2,this.connectorAlpha=r.shapes[this.currentShape].connector.alpha?r.shapes[this.currentShape].connector.alpha:.5,this.resetConnector(),this.getShapePoints(),this.offsetShapePoints(),this.drawPath(),this.debugDraw&&(this.drawShapePoints(),null===this.pointerGraphics&&(this.pointerGraphics=new PIXI.Graphics,this.p.addChild(this.pointerGraphics))))},n.prototype.getDot=function(){var t=new WRE.Sprite({texture:o.assetManager.getTexture("challenge_map_route_dot"),anchorX:.5,anchorY:.5,visible:!1}).addTo(this);return t},n.prototype.drawPath=function(){this.prettyPoints=[];for(var t=0;t<this.shapePoints.length;t++){var e=this.getDot();e.x=this.shapePoints[t].x,e.y=this.shapePoints[t].y,this.prettyPoints.push(e)}this.startPoint=new WRE.Sprite({texture:o.assetManager.getTexture("challenge_map_startpoint"),anchorX:.5,anchorY:.93,x:this.shapePoints[0].x,y:this.shapePoints[0].y}).addTo(this)},n.prototype.onSoundButtonClick=function(t){o.toggleMute("challengeMapMusic"),t.state=o.storage_data.muted?1:0},n.prototype.onHomeButtonClick=function(){o.raceStarted=!1,this.signals.previous.dispatch()},n.prototype.drawObstacles=function(){for(var t=0;t<this.obstacles[this.currentShape].length;t++){var e=WRE.cloneObj(this.obstacles[this.currentShape][t]);e.texture=o.assetManager.getTexture(e.texture);var i=new WRE.Sprite(e).addTo(this);this.obstacleSprites.push(i)}},n.prototype.checkForInPoints=function(t){for(var e=!1;this.lastIndexIn<this.shapePoints.length&&!e;)this.inCircle.contains(this.shapePoints[this.lastIndexIn].x,this.shapePoints[this.lastIndexIn].y)?(this.lastIndexIn++,this.clearRedundantConnectorPoints(),this.lastIndexIn===this.shapePoints.length&&(this.lastIndexIn=this.shapePoints.length-1,e=!0)):e=!0},n.prototype.resetConnector=function(){this.connectorPoints=[],this.lastIndexIn=0,this.redrawConnector()},n.prototype.clearRedundantConnectorPoints=function(){this.connectorPoints.splice(this.lastIndexIn,this.connectorPoints.length-this.lastIndexIn)},n.prototype.onInputDown=function(t,e){if(!this.startedShape){if(this.inCircle.x=e.x,this.inCircle.y=e.y,this.easyMode?(o.audio.play("challengeMapStart"),this.stars--,this.stars<1&&(this.stars=1)):this.resetConnector(),!this.inCircle.contains(this.shapePoints[this.lastIndexIn].x,this.shapePoints[this.lastIndexIn].y))return;null===this.soundID&&(this.soundID=o.audio.play("challengeMapDrawing",{loop:!0})),this.startedShape=!0,this.checkForInPoints(),this.connectorContainer&&(this.clearRedundantConnectorPoints(),this.connectorPoints.push({x:e.x,y:e.y}),this.cnt=0,this.updatePathPS(e.x,e.y)),this.selectShapePoints()}},n.prototype.onInputMove=function(t,e){!this.isGameOver&&this.startedShape&&(this.inCircle.x=e.x,this.inCircle.y=e.y,this.checkForInPoints(),this.selectShapePoints(),this.timer.reset(),this.cnt--,this.cnt<=0&&(this.cnt=r.shapes[this.currentShape].connector.step,this.connectorPoints.push({x:e.x,y:e.y}),this.redrawConnector()),this.lastIndexIn+1<this.shapePoints.length-1&&(this.distance(e,this.shapePoints[this.lastIndexIn])>this.disconnectTolerance&&this.distance(e,this.shapePoints[this.lastIndexIn+1])>this.disconnectTolerance?this.onInputUp():this.updatePathPS(e.x,e.y)),this.lastIndexIn===this.shapePoints.length-1&&this.distance(e,this.shapePoints[this.lastIndexIn])<=r.snapTolerance&&(this.highlightShapePoints(),this.updatePathPS(e.x,e.y),!this.isGameOver&&this.shapesToCompleteGame>1?(null!==this.soundID&&(o.audio.stop(this.soundID),this.soundID=null),this.soundEndID=o.audio.play("challengeMapStop"),this.clearConnector(),this.onInputUp(),this.addScore(),o.animator.setTimeout(function(){this.currentShape++,this.initShape()},r.switchShapesDelay,this)):(this.initParticles(950,384),this.onShapesComplete())),this.hintTimer=0)},n.prototype.redrawConnector=function(t){if(this.connectorContainer&&(this.connectorGraphics.clear(),!(this.connectorPoints.length<2))){this.connectorGraphics.lineStyle(this.connectorWidth,this.connectorColor,this.connectorAlpha),this.connectorGraphics.moveTo(this.connectorPoints[0].x,this.connectorPoints[0].y);for(var e=1;e<this.connectorPoints.length;e++)this.connectorGraphics.lineTo(this.connectorPoints[e].x,this.connectorPoints[e].y);if(this.debugDraw){this.connectorGraphics.lineStyle(2,16711935),this.connectorGraphics.moveTo(this.connectorPoints[0].x,this.connectorPoints[0].y);for(var i=1;i<this.connectorPoints.length;i++)this.connectorGraphics.drawCircle(this.connectorPoints[i].x,this.connectorPoints[i].y,3)}}},n.prototype.getLastValidPoint=function(){var t,e=!0;do{for(t=this.connectorPoints.length-1,i=this.shapePoints.length-1;i>=0;i--)if(this.distance(this.connectorPoints[t],this.shapePoints[i])<this.easyModeSnapTolerance){this.lastIndexIn=i,this.lastIndexIn<0&&(this.lastIndexIn=0),e=!1;break}i===-1&&(this.connectorPoints.splice(t,1),this.startedShape=!1,this.onInputUp()),this.connectorPoints.length<=0&&(this.lastIndexIn=0,e=!1)}while(e);for(var s=0;s<this.shapePoints.length;s++)this.prettyPoints[s].visible=!1;for(s=0;s<this.lastIndexIn+1;s++)this.prettyPoints[s].visible=!0;this.redrawConnector(),this.selectShapePoints()},n.prototype.onInputUp=function(t,e){this.startedShape&&!this.isGameOver&&(null!==this.soundID&&(o.audio.stop(this.soundID),this.soundID=null),o.audio.stopByName(o.PATHS.SOUNDS+d.challengeMapDrawing.url),this.soundID=null,this.soundEndID=o.audio.play("challengeMapStop"),this.startedShape=!1,this.easyMode?(this.getLastValidPoint(),this.connectorPoints.length>0?this.updatePathPS(this.connectorPoints[this.connectorPoints.length-1].x,this.connectorPoints[this.connectorPoints.length-1].y):this.updatePathPS(this.shapePoints[0].x,this.shapePoints[0].y)):(this.resetConnector(),this.updatePathPS(this.shapePoints[0].x,this.shapePoints[0].y),this.deselectShapePoints()))},n.prototype.updatePathPS=function(t,e){this.pathPS.updateSpawnPos(t,e)},n.prototype.appear=function(){o.memoryManager.free("game"),o.playMusic("challengeMapMusic"),o.score=0,o.viewManager.runShowTweens(),o.audio.play("challengeStart"),this.updatePathPS(this.shapePoints[0].x,this.shapePoints[0].y),this.pathPS.emit=!0,0===o.storage_data.tutorial[3]?window.delay(function(){this.playTutorial()},1,this):this.timer.start()},n.prototype.pause=function(){this.interactive=!1,this.interactiveChildren=!1,this.isBusy=!0},n.prototype.resume=function(){o.viewManager.activeLayout="mapGameView",this.interactive=!0,this.interactiveChildren=!0,this.isBusy=!1},n.prototype.clearConnector=function(){this.connectorContainer&&(this.startedShape=!1,this.connectorGraphics.clear())},n.prototype.onShapesComplete=function(){this.isGameOver||(this.pauseButton&&(this.pauseButton.interactive=!1),this.hand.destroy(),this.interaction.off("pointermove",this.onInteraction,this),this.isGameOver=!0,this.requestGameOver(),o.audio.stopByName(o.PATHS.SOUNDS+d.challengeMapDrawing.url),this.soundID=null,o.audio.play("challengeMapStop"))},n.prototype.bounceElement=function(t){if(!t.isBouncing){t.isBouncing=!0;var e=t.y;this.bounceTl=TweenMax.fromTo(t,.8,{y:e},{y:e-10,repeat:-1,yoyo:!0,ease:Cubic.easeOut})}},n.prototype.pulseElement=function(t){TweenMax.fromTo(t.scale,.25,{x:1,y:1},{x:1.05,y:1.05,repeat:1,yoyo:!0,ease:Sine.easeInOut})},n.prototype.addScore=function(){o.score++},n.prototype.getGameResults=function(){var t=!1,e=o.score/this.shapesToCompleteGame*100;return e>=r.gameSuccess&&(t=!0),t},n.prototype.runNextScene=function(){this.signals.next.dispatch(this.stars)},n.prototype.requestGameOver=function(){o.audio.play("challengeEnd"),null!==this.tweenSprite&&TweenMax.to(this.tweenSprite,r.shapeTutorial.fade,{alpha:0,ease:Linear.easeNone}),o.animator.setTimeout(function(){this.pathPS.emit=!1},.15,this),o.animator.setTimeout(function(){o.viewManager.hasHideTweens?(o.viewManager.hideTweensComplete.detachAll(),o.viewManager.hideTweensComplete.add(function(){this.runNextScene()},this),this.bounceTl&&this.bounceTl.kill(),o.viewManager.runHideTweens()):this.runNextScene()},r.gameOverDelay,this)},n.prototype.update=function(){o.paused||this.isBusy||(this.timer&&this.timer.update(),this.pathPS&&this.pathPS.update(p3.Timestep.deltaTime),this.sparklePS&&this.sparklePS.update(p3.Timestep.deltaTime),this.debugDraw&&this.drawPointer())},n.prototype.drawPointer=function(){this.p&&(this.pointerGraphics.clear(),this.startedShape&&(this.pointerGraphics.lineStyle(4,255,1),this.pointerGraphics.drawCircle(this.inCircle.x,this.inCircle.y,this.inCircle.radius)))},n.prototype.drawShapePoints=function(){this.p&&(this.p.parent.removeChild(this.p),this.p=null),this.p=(new WRE.Container).addTo(this.debugContainer);for(var t=0;t<this.shapePoints.length;t++){new WRE.Sprite({texture:PIXI.Texture.WHITE,x:this.shapePoints[t].x,y:this.shapePoints[t].y,scaleXY:.3,tint:16711680,anchorXY:.5}).addTo(this.p)}},n.prototype.deselectShapePoints=function(){if(this.p)for(var t=0;t<this.shapePoints.length;t++)this.p.children[t].tint=16711680},n.prototype.highlightShapePoints=function(){if(this.p)for(var t=0;t<this.shapePoints.length;t++)this.p.children[t].tint=16777215},n.prototype.selectShapePoints=function(){for(var t=0;t<this.lastIndexIn;t++)this.prettyPoints[t].visible=!0;if(this.p&&this.lastIndexIn<this.shapePoints.length){for(var e=0;e<this.lastIndexIn;e++)this.p.children[e].tint=65280;for(e=this.lastIndexIn;e<this.shapePoints.length;e++)this.p.children[e].tint=16711680}},n.prototype.offsetShapePoints=function(){for(var t=0;t<this.shapePoints.length;t++)this.shapePoints[t].x+=this.shapePosition.x,this.shapePoints[t].y+=this.shapePosition.y},n.prototype.distance=function(t,e){var i=t.x-e.x,s=t.y-e.y;return Math.sqrt(i*i+s*s)},n.prototype.bezierCurveLength=function(t,e,i,s,n,o,a,r){for(var h=10,l=0,u=0,p=0,c=0,d=0,g=0,y=0,m=0,f=0,w=0,x=0,v=t,S=e,T=1;T<=h;++T)u=T/h,p=u*u,c=p*u,d=1-u,g=d*d,y=g*d,m=y*t+3*g*u*i+3*d*p*n+c*a,f=y*e+3*g*u*s+3*d*p*o+c*r,w=v-m,x=S-f,v=m,S=f,l+=Math.sqrt(w*w+x*x);return l},n.prototype.getShapePoints=function(){null===this.shapeGraphics&&(this.shapeGraphics=new PIXI.Graphics),this.shapeGraphics.clear(),this.shapeGraphics.lineStyle(4,16777215,1);var t,e,i,s,n,o;for(t in r.shapes[this.currentShape].data)switch(i=r.shapes[this.currentShape].data[t],s=i[Object.keys(i)[0]],Object.keys(i)[0].toLowerCase()){case"moveto":this.shapeGraphics.moveTo(s[0],s[1]),n=s[0],o=s[1];break;case"lineto":this.shapeGraphics.lineTo(s[0],s[1]);break;case"beziercurveto":this.pathLength+=this.bezierCurveLength(n,o,s[0],s[1],s[2],s[3],s[4],s[5]),this.shapeGraphics.bezierCurveTo(s[0],s[1],s[2],s[3],s[4],s[5]),n=s[4],o=s[5];break;case"quadraticcurveto":this.shapeGraphics.quadraticCurveTo(s[0],s[1],s[2],s[3])}var a=[];for(t=0;t<this.shapeGraphics.graphicsData.length;t++)if(void 0!==this.shapeGraphics.graphicsData[t].shape.points)for(e=0;e<this.shapeGraphics.graphicsData[t].shape.points.length;e+=2)a.push({x:this.shapeGraphics.graphicsData[t].shape.points[e],y:this.shapeGraphics.graphicsData[t].shape.points[e+1]});var h=Math.floor(this.pathLength),l=4.5,u={x:a[0].x,y:a[0].y},p=TweenMax.to(u,h/l,{bezier:{values:a,curviness:1.5},ease:Linear.easeNone});for(t=0;t<h;t+=l)p.time(t),this.shapePoints.push({x:u.x,y:u.y})},n.prototype.destroy=function(){this.signals.howToPlay.dispose(),this.tweenTl&&this.tweenTl.kill(),null!==this.tweenSprite&&(this.tweenSprite.parent.removeChild(this.tweenSprite),this.tweenSprite.destroy(),this.tweenSprite=null),this.sparklePS&&this.sparklePS.destroy(),null!==this.soundID&&o.audio.stop(this.soundID),null!==this.soundEndID&&o.audio.stop(this.soundEndID),o.memoryManager.free("map"),o.stopMusic();for(var t=0;t<this.prettyPoints.length;t++)this.prettyPoints[t].destroy();for(t=0;t<this.obstacleSprites.length;t++)this.obstacleSprites[t].destroy();TweenMax.killAll(),this.tutorialSpine.doSeppuku(),this.timer.doSeppuku(),this.timer=null,p3.Scene.prototype.destroy.call(this)},n.prototype.resize=function(){this.x=Math.round((p3.View.width-o.STAGE_WIDTH)/2),this.controller&&this.controller.resize(),o.currentSubScreen&&o.currentSubScreen.resize&&o.currentSubScreen.resize(),o.viewManager.repositionDynElements()}},{"../../common":42,"../../loader/audio-loader":97,"../challenge-preloader":11,"../challenge-spine":13,"../challenge-tutorial-hand-anims":14,"../challenge-tutorial-timer":15,"./challenge-map-input":27,"./challenge-map-setup.json":29}],31:[function(t,e,i){var s={sources:["tyreSpine"],scales:[.5],animations:{pumpit:{name:["pumpit"],source:0}}};e.exports=s},{}],32:[function(t,e,i){arguments[4][20][0].apply(i,arguments)},{"../../mini-runner":103,dup:20}],33:[function(t,e,i){function s(t){p3.Scene.call(this),this.gameName=t,n.viewManager.add(n.assetManager.getJSON("tyrePauseView")),this.layout=n.viewManager.get(n.viewManager.activeLayout),this.pages=[n.assetManager.getTexture("ui_help_09")],this.tints=[16777215],this.topPos=-631,this.maskTopPos=101,this.currentPage=0,this.screenDim=null,this.popup=null,this.maskTL=null}var n=t("../../common"),o=t("../../screendim/screendim"),a=t("../../help-text");e.exports=s,s.prototype=Object.create(p3.Scene.prototype),s.prototype.constructor=s,s.prototype.init=function(){if(this.layout.dim){var t=this.layout.dim.color?this.layout.dim.color:null,e=this.layout.dim.duration?this.layout.dim.duration:null,i=this.layout.dim.alphaIn?this.layout.dim.alphaIn:null,s=this.layout.dim.alphaOut?this.layout.dim.alphaOut:null;this.layout.dim.alphaIn||this.layout.dim.alphaOut||!this.layout.dim.alpha||(i=this.layout.dim.alpha,s=0),this.screenDim=new o(t,e,i,s).addTo(this)}this.board=n.viewManager.addSprite(this.layout.board).addTo(this);for(var r=40,h=0;h<4;h++)this["pagination"+h]=n.viewManager.addSprite(this.layout.pagination).addTo(this.board),this["pagination"+h].x=-1.5*r+r*h,this["pagination"+h].y=-50-h%2*10,this["pagination"+h].alpha=0,this["pagination"+h].scaleXY=0;this["pagination"+this.currentPage].texture=n.assetManager.getTexture("ui_pagination_on"),this.pausedText=n.viewManager.addText(this.layout.pausedText).addTo(this.board),this.page=n.viewManager.addSprite(this.layout.page).addTo(this.board),this.maskSprite=new WRE.Sprite({texture:PIXI.Texture.WHITE,x:950-this.board.width/2,y:this.maskTopPos-this.board.height,width:this.board.width,height:400}).addTo(this),this.page.mask=this.maskSprite,this.roll=n.viewManager.addSprite(this.layout.roll).addTo(this.board),this.roll.y=this.topPos;var l={bg:{texture:n.assetManager.getTexture("ui_help_copy_bg"),nineSlice:[40,40,40,40]},choices:["ui_help_09"]};this.popup=new a(l).addTo(this),this.popup.init(),this.popup.x=950,this.popup.y=640,this.popup.show(),this.initUiElements()},s.prototype.initUiElements=function(){this.uiContainer=(new WRE.Container).addTo(this);for(var t in this.layout.ui)switch(t){case"pausedText":this.pausedText=n.viewManager.addText(this.layout.ui.pausedText).addTo(this.uiContainer);break;case"homeButton":this.homeButton=n.viewManager.addButton(this.layout.ui.homeButton).addTo(this.uiContainer),this.homeButton.on("button-on-click",this.onHomeButtonClick.bind(this));break;case"soundButton":this.soundButton=n.viewManager.addSwitchButton(this.layout.ui.soundButton).addTo(this.uiContainer),this.soundButton.on("button-on-click",this.onSoundButtonClick.bind(this)),this.soundButton.state=n.storage_data.muted?1:0;break;case"continueButton":this.continueButton=n.viewManager.addButton(this.layout.ui.continueButton).addTo(this.uiContainer),this.continueButton.on("button-on-click",this.onContinueButtonClick.bind(this));break;case"restartButton":this.restartButton=n.viewManager.addButton(this.layout.ui.restartButton).addTo(this.uiContainer),this.restartButton.on("button-on-click",this.onRestartButtonClick.bind(this));break;case"previousButton":break;case"nextButton":}},s.prototype.animateBoardIn=function(){var t=new TimelineMax({onComplete:function(){this.animatePageIn()},onCompleteScope:this});t.from(this.board,.3,{delay:.1,y:1800,ease:Cubic.easeOut},"start"),t.to(this.board.scale,.1,{delay:.2,y:1.1,repeat:1,yoyo:!0,ease:Sine.easeInOut},"start")},s.prototype.animateBoardOut=function(){var t=new TimelineMax;t.to(this.board.scale,.1,{y:1.1,repeat:1,yoyo:!0,ease:Sine.easeInOut},"start"),t.to(this.board,.4,{delay:.1,y:1800,ease:Cubic.easeOut},"start")},s.prototype.destroyUiElements=function(){for(var t=0;t<this.uiContainer.children.length;t++)this.uiContainer.children[t].doSeppuku&&this.uiContainer.children[t].doSeppuku();this.uiContainer.destroy(n.destroyOptions)},s.prototype.requestNextScene=function(){n.viewManager.hasHideTweens?(this.animateBoardOut(),this.screenDim&&this.screenDim.out(),this.popup&&this.popup.hide(),n.viewManager.hideTweensComplete.detachAll(),n.viewManager.hideTweensComplete.add(function(){this.runNextScene()},this),n.viewManager.runHideTweens()):this.runNextScene()},s.prototype.runNextScene=function(){this.signals.next.dispatch()},s.prototype.onRestartButtonClick=function(){},s.prototype.onContinueButtonClick=function(){this.requestNextScene()},s.prototype.onHomeButtonClick=function(){this.signals.previous.dispatch()},s.prototype.onSoundButtonClick=function(t){n.toggleMute("challengeTyreMusic"),t.state=n.storage_data.muted?1:0},s.prototype.onPreviousButtonClick=function(){this.currentPage--,this.currentPage<0&&(this.currentPage=this.pages.length-1),
this.updatePage()},s.prototype.onNextButtonClick=function(){this.currentPage++,this.currentPage>this.pages.length-1&&(this.currentPage=0),this.updatePage()},s.prototype.showPagination=function(t){for(var e=0;e<4;e++)this["pagination"+e].alpha=t?0:1;for(e=0;e<4;e++)TweenMax.to(this["pagination"+e],.1+(t?.1:0),{delay:t?.07*e:0,alpha:t?1:0}),TweenMax.to(this["pagination"+e].scale,.15+(t?.1:0),{delay:t?.07*e:0,x:t?1:0,y:t?1:0,ease:Back.easeOut})},s.prototype.updatePage=function(){this.page.texture=this.pages[this.currentPage],this.page.tint=this.tints[this.currentPage],this.maskTL&&(this.maskTL.kill(),this.maskTL=null);var t=.5;this.maskTL=new TimelineMax({onStart:function(){this.roll.alpha=1,this.roll.visible=!0},onStartScope:this,onComplete:function(){this.roll.visible=!1},onCompleteScope:this}),this.maskTL.fromTo(this.maskSprite,t,{y:this.maskTopPos-this.maskSprite.height},{y:this.maskTopPos,ease:Cubic.easeInOut},"start"),this.maskTL.fromTo(this.roll,t,{y:this.topPos},{y:this.topPos+340,ease:Cubic.easeInOut},"start"),this.maskTL.fromTo(this.roll.scale,t,{x:1,y:1},{x:.9,y:0},"start"),this.maskTL.fromTo(this.roll,.1,{alpha:1},{delay:.4,alpha:0},"start");for(var e=0;e<4;e++)this["pagination"+e].texture=n.assetManager.getTexture("ui_pagination_off");this["pagination"+this.currentPage].texture=n.assetManager.getTexture("ui_pagination_on")},s.prototype.animatePageIn=function(){this.page.visible=!0,this.updatePage()},s.prototype.appear=function(){this.screenDim&&this.screenDim["in"](),this.setUiVisible(!1),n.viewManager.done=!1,n.viewManager.showTweensComplete.add(this.onShowTweensComplete.bind(this)),n.viewManager.setShowTweensTime(.005),this.setUiVisible(!0),n.viewManager.runShowTweens(),this.animateBoardIn()},s.prototype.setUiVisible=function(t){if(this.uiContainer)for(var e=0;e<this.uiContainer.children.length;e++)this.uiContainer.children[e].visible=t},s.prototype.pause=function(){this.interactive=!1,this.interactiveChildren=!1},s.prototype.resume=function(){n.viewManager.activeLayout="tyrePauseView",this.interactive=!0,this.interactiveChildren=!0},s.prototype.onShowTweensComplete=function(){n.viewManager.done=!0},s.prototype.destroy=function(){this.screenDim&&this.screenDim.out(),this.maskTL&&(this.maskTL.kill(),this.maskTL=null),this.popup&&this.popup.doSeppuku(),this.destroyUiElements(),this.pausedText.destroy(n.destroyAllOptions),p3.Scene.prototype.destroy.call(this)},s.prototype.update=function(){},s.prototype.resize=function(){this.x=Math.round((p3.View.width-n.STAGE_WIDTH)/2),this.screenDim&&(this.screenDim.resize(),this.screenDim.x=-this.x),n.viewManager.repositionDynElements()}},{"../../common":42,"../../help-text":92,"../../screendim/screendim":105}],34:[function(t,e,i){function s(t){p3.Scene.call(this),this.isBusy=!1,this.interactive=!0,this.interactiveChildren=!0;var e=n.assetManager.getJSON("tyreGameView");if(this.backup=n.currentCar,3===n.currentCar)do n.currentCar=Math.floor(Math.random()*n.carColors.length);while(3===n.currentCar);e.tyreGameView.carImage.texture=e.tyreGameView.carImage.texture.replaceAll("#CARCOLOR#",n.carColors[n.currentCar]),n.viewManager.add(e),this.layout=n.viewManager.get(n.viewManager.activeLayout),this.gain=n.config.challengesSetup.tyre.barGain,this.decay=n.config.challengesSetup.tyre.barDecay,this.delayTime=n.config.challengesSetup.tyre.barDelay,this.currentTime=this.delayTime,this.stars=3,this.gameTimer=0,this.bumpTL=null,this.bounceTL=null,this.handleTwen=null,this.isDown=!1,this.hissID=null,this.isGameOver=!1,this.puncturePS=null,this.pumpPS=[],this.isDeflating=!1,this.preloadStuff()}var n=t("../../common"),o=t("../challenge-preloader"),a=t("../../loader/audio-loader"),r=t("../challenge-spine"),h=t("./challenge-tyre-anims"),l=t("./challenge-tyre-input"),u=t("../challenge-tutorial-hand-anims"),p=t("../challenge-tutorial-timer"),c={challengeStarReward1:{type:"sound",url:"sfx/challenges/shared/sfx_star_reward_1",soundId:"challengeStarReward1"},challengeStarReward2:{type:"sound",url:"sfx/challenges/shared/sfx_star_reward_2",soundId:"challengeStarReward2"},challengeStarReward3:{type:"sound",url:"sfx/challenges/shared/sfx_star_reward_3",soundId:"challengeStarReward3"},challengeFanfare:{type:"sound",url:"sfx/challenges/shared/sfx_minigame_complete_fanfare_00",soundId:"challengeFanfare"},challengeTyreHiss:{type:"sound",url:"sfx/challenges/tyre/sfx_tyre_air_escape_00",soundId:"challengeTyreHiss"},challengeTyrePump:{type:"sound",url:"sfx/challenges/tyre/sfx_tyre_pump_fast_00",soundId:"challengeTyrePump"},challengeTyreMusic:{type:"sound",url:"music/challenges/tyre/music_challenge_tyre_00",soundId:"challengeTyreMusic"},challengeStart:{type:"sound",url:"music/challenges/shared/music_race_challenge_start_00",soundId:"challengeStart"},challengeEnd:{type:"sound",url:"music/challenges/shared/music_race_challenge_end_00",soundId:"challengeEnd"}},d=[{name:"screenBg",url:n.PATHS.IMAGES+"endgame_bg.jpg",destroyId:"screenBg"},{name:"selectAtlas",url:n.PATHS.IMAGES+"character/ui_vehicle_select_0.8x.json",destroyId:"ui_char_brown"},{name:"tyreBackground",url:n.PATHS.IMAGES+"challenges/tyre/challenge_tyre_bg.jpg",destroyId:"tyreBackground"},{name:"tyreAtlas",url:n.PATHS.IMAGES+"challenges/tyre/challenge_tyre_atlas_0_1x.json",destroyId:"challenge_tyre_bg_car_brown"},{name:"tyreSpine",url:n.PATHS.IMAGES+"challenges/tyre/tyre.json",destroyId:"tyreSpine_atlas_page_tyre"},{name:"tyrePumpParticles",url:n.PATHS.DATA+"particles/challenge_tyre_pump_rightside.json"},{name:"tyrePunctureParticles",url:n.PATHS.DATA+"particles/challenge_tyre_puncture_emitter.json"},{name:"tutorialHandSpine",url:n.PATHS.IMAGES+"tutorial/tutorial_hand.json",destroyId:"tutorialHandSpine_atlas_page_tutorial_hand"}];e.exports=s,s.prototype=Object.create(p3.Scene.prototype),s.prototype.constructor=s,s.prototype.preloadStuff=function(){n.memoryManager.resetLoader();for(var t in d)d[t].hasOwnProperty("destroyId")&&n.memoryManager.store("tyre",d[t].destroyId);for(t in c)c[t].hasOwnProperty("soundId")&&n.memoryManager.storeSound("tyre",c[t].soundId);this.audioLoader=new a(c,(!1)),this.audioLoader.start()},s.prototype.preloader=function(){return new o},s.prototype.load=function(){return d},s.prototype.init=function(){this.bgSprite=n.viewManager.addSprite(this.layout.backgroundImage).addTo(this),this.carSprite=n.viewManager.addSprite(this.layout.carImage).addTo(this),this.hubSprite=n.viewManager.addSprite(this.layout.hubImage).addTo(this),this.hubSprite.y=this.carSprite.y;var t=["car_pussycat","car_turboterrific","car_meanmachine","skin_thatdoesnexist","car_roaringroger","car_doombuggy"];this.layout.tyreSpine.skin=t[n.currentCar],this.tyreSpine=new r("tyreSpine",h,this.layout.tyreSpine.skin).addTo(this),this.tyreSpine.x=this.layout.tyreSpine.x,this.tyreSpine.y=this.layout.tyreSpine.y,this.tyreSpine.play(["pumpit"],!1),this.hubSprite.x=this.tyreSpine.x,this.input=(new l).addTo(this),this.input.create(),this.input.signals.down.add(this),this.input.signals.up.add(this),this.handleSprite=n.viewManager.addSprite(this.layout.handleImage).addTo(this),this.pumpSprite=n.viewManager.addSprite(this.layout.pumpImage).addTo(this),this.pumpPSContainer=(new WRE.Container).addTo(this),this.puncturePos=new PIXI.Point(640,40),this.tutorialContainer=new WRE.Container({visible:!1,interactive:!1,interactiveChildren:!1}).addTo(this),this.tutorialSpine=new r("tutorialHandSpine",u).addTo(this.tutorialContainer),this.timer=new p,this.timer.onComplete.add(this.playTutorial,this),this.layout.ui&&(this.uiContainer=(new WRE.Container).addTo(this),this.initUiElements())},s.prototype.playTutorial=function(t){var e="undefined"!=typeof t?t:2;this.tutorialContainer.visible=!0,this.tutorialSpine.x=this.handleSprite.x+50,this.tutorialSpine.y=this.handleSprite.y+66-this.handleSprite.texture.height,this.tutorialSpine.play(["tap"],1!==e),this.tutorialSpine.time=0,window.delay(function(){n.storage_data.tutorial[4]=1,n.storage.save(),this.tutorialContainer&&(this.tutorialContainer.visible=!1),this.timer&&this.timer.start()},this.tutorialSpine.duration*e/2,this)},s.prototype.initUiElements=function(){for(var t in this.layout.ui)switch(t){case"progressBar":this.progressBar=n.viewManager.addProgressBar(this.layout.ui.progressBar).addTo(this.uiContainer),this.progressBar.bar.value=0;break;case"pauseButton":this.pauseButton=n.viewManager.addButton(this.layout.ui.pauseButton).addTo(this.uiContainer),this.pauseButton.on("button-on-click",this.onPauseButtonClick.bind(this))}},s.prototype.initPumpParticles=function(t,e){var i=new PIXI.particles.Emitter(this.pumpPSContainer,[n.assetManager.getTexture("challenge_tyre_air_particle")],n.assetManager.getJSON("tyrePumpParticles"));i.updateSpawnPos(t,e),i.emit=!0,this.pumpPS.push(i)},s.prototype.initTyreParticles=function(t,e){this.puncturePS=new PIXI.particles.Emitter(this.pumpPSContainer,[n.assetManager.getTexture("challenge_tyre_air_particle")],n.assetManager.getJSON("tyrePunctureParticles")),this.puncturePS.updateSpawnPos(t,e),this.puncturePS.emit=!0},s.prototype.onPauseButtonClick=function(){this.signals.pause.dispatch()},s.prototype.appear=function(){n.memoryManager.free("game"),n.playMusic("challengeTyreMusic"),n.viewManager.runShowTweens(),this.isDeflating=!0,this.progressBar.bar.value=.1,n.audio.play("challengeStart"),0===n.storage_data.tutorial[4]?window.delay(function(){this.playTutorial()},1,this):this.timer.start()},s.prototype.pause=function(){this.interactive=!1,this.interactiveChildren=!1,this.isBusy=!0},s.prototype.resume=function(){n.viewManager.activeLayout="tyreGameView",this.interactive=!0,this.interactiveChildren=!0,this.isBusy=!1},s.prototype.runNextScene=function(){n.currentCar=this.backup,this.signals.next.dispatch(this.stars)},s.prototype.requestGameOver=function(){n.audio.play("challengeEnd"),n.animator.setTimeout(function(){n.viewManager.hasHideTweens?(n.viewManager.hideTweensComplete.detachAll(),n.viewManager.hideTweensComplete.add(function(){this.runNextScene()},this),n.viewManager.runHideTweens()):this.runNextScene()},1,this)},s.prototype.update=function(){for(var t=0;t<this.pumpPS.length;t++)this.pumpPS[t].update(p3.Timestep.deltaTime);this.puncturePS&&this.puncturePS.update(p3.Timestep.deltaTime),n.paused||this.isBusy||this.isGameOver||(this.timer&&this.timer.update(),this.tutorialContainer.visible&&this.tutorialSpine.update(2*p3.Timestep.deltaTime),this.tyreSpine.time=this.progressBar.bar.value,this.isDown?(this.bounceTL&&this.bounceTL.kill(),this.bounceTL=new TimelineMax,this.bounceTL.to(this.carSprite,.2,{y:this.layout.carImage.y-135*this.progressBar.bar.value,ease:Back.easeOut},"start"),this.bounceTL.to(this.hubSprite,.2,{y:this.layout.carImage.y-135*this.progressBar.bar.value,ease:Back.easeOut},"start")):(this.carSprite.y=this.layout.carImage.y-130*this.progressBar.bar.value,this.hubSprite.y=this.carSprite.y),this.puncturePS&&this.puncturePS.updateSpawnPos(this.puncturePos.x,this.layout.carImage.y-130*this.progressBar.bar.value+this.puncturePos.y),this.gameTimer+=PIXI.ticker.shared.elapsedMS,this.currentTime-=PIXI.ticker.shared.elapsedMS,this.currentTime<0&&(this.isDown&&(this.isDown=!1,this.handleTwen&&this.handleTwen.kill(),this.handleTwen=TweenMax.to(this.handleSprite,1.5,{y:this.layout.handleImage.y,ease:Cubic.easeOut})),null===this.hissID&&this.progressBar.bar.value>0&&!n.audio.isPlaying("challengeTyreHiss")&&(this.hissID=n.audio.play("challengeTyreHiss",{loop:!0})),this.puncturePS&&this.puncturePS.emit===!1&&(this.puncturePS.emit=!0),this.progressBar.bar.value-=this.decay*PIXI.ticker.shared.deltaTime,0===this.progressBar.bar.value&&(this.puncturePS&&this.puncturePS.emit===!0&&(this.puncturePS.emit=!1),n.audio.stopByName(n.PATHS.SOUNDS+c.challengeTyreHiss.url),this.hissID=null)),this.isDeflating&&0===this.progressBar.bar.value?(this.isDeflating=!1,this.puncturePS.emit=!1):null===this.puncturePS&&this.initTyreParticles(this.puncturePos.x,this.carSprite.y+this.puncturePos.y))},s.prototype.onInputDown=function(t){this.isDeflating||(this.timer.reset(),this.handleTwen&&this.handleTwen.kill(),n.audio.stopByName(n.PATHS.SOUNDS+c.challengeTyreHiss.url),this.hissID=null,this.puncturePS&&(this.puncturePS.emit=!1),n.audio.stopByName(n.PATHS.SOUNDS+c.challengeTyrePump.url),n.audio.play("challengeTyrePump"),this.initPumpParticles(this.pumpSprite.x+40,this.pumpSprite.y+200),this.isDown=!0,this.currentTime=this.delayTime,this.bumpTL&&this.bumpTL.kill(),this.bumpTL=TweenMax.to(this.progressBar.bar,.1,{value:this.progressBar.bar.value+this.gain*PIXI.ticker.shared.deltaTime,ease:Back.easeOut}),1!==this.progressBar.bar.value||this.isGameOver||this.onGameOver(),this.handleSprite.y=this.layout.handleImage.y+80)},s.prototype.onInputUp=function(t){this.isDown&&(this.handleSprite.y=this.layout.handleImage.y),this.isDown=!1},s.prototype.onGameOver=function(){this.input.enabled=!1,null!==this.hissID&&(n.audio.stop(this.hissID),this.hissID=null),this.handleTwen&&this.handleTwen.kill(),this.handleTwen=TweenMax.to(this.handleSprite,1.5,{y:this.layout.handleImage.y,ease:Cubic.easeOut}),this.gameTimer>15e3&&(this.stars=2),this.gameTimer>25e3&&(this.stars=1),this.isGameOver=!0,this.bounceTL&&this.bounceTL.kill(),this.bounceTL=new TimelineMax,this.bounceTL.to(this.carSprite,.2,{y:this.layout.carImage.y-130*this.progressBar.bar.value,ease:Back.easeOut},"start"),this.bounceTL.to(this.hubSprite,.2,{y:this.layout.carImage.y-130*this.progressBar.bar.value,ease:Cubic.easeOut},"start"),this.requestGameOver()},s.prototype.destroy=function(){this.handleTwen&&this.handleTwen.kill(),this.bumpTL&&this.bumpTL.kill(),this.bounceTL&&this.bounceTL.kill();for(var t=0;t<this.pumpPS.length;t++)this.pumpPS[t].emit=!1,this.pumpPS[t].destroy();this.puncturePS&&(this.puncturePS.emit=!1,this.puncturePS.destroy()),this.tyreSpine.doSeppuku(),this.input.doSeppuku(),TweenMax.killAll(),this.tutorialSpine.doSeppuku(),this.timer.doSeppuku(),this.timer=null,p3.Scene.prototype.destroy.call(this)},s.prototype.resize=function(){this.x=Math.round((p3.View.width-n.STAGE_WIDTH)/2),this.input.move.x=0,this.input.move.y=0,this.input.move.width=n.STAGE_WIDTH,this.input.move.height=n.STAGE_HEIGHT,n.currentSubScreen&&n.currentSubScreen.resize&&n.currentSubScreen.resize(),n.viewManager.repositionDynElements()}},{"../../common":42,"../../loader/audio-loader":97,"../challenge-preloader":11,"../challenge-spine":13,"../challenge-tutorial-hand-anims":14,"../challenge-tutorial-timer":15,"./challenge-tyre-anims":31,"./challenge-tyre-input":32}],35:[function(t,e,i){function s(t){p3.Scene.call(this),this.gameName=t,n.viewManager.add(n.assetManager.getJSON("wayPauseView")),this.layout=n.viewManager.get(n.viewManager.activeLayout),this.pages=[n.assetManager.getTexture("ui_help_10")],this.tints=[16777215],this.topPos=-631,this.maskTopPos=101,this.currentPage=0,this.screenDim=null,this.popup=null,this.maskTL=null}var n=t("../../common"),o=t("../../screendim/screendim"),a=t("../../help-text");e.exports=s,s.prototype=Object.create(p3.Scene.prototype),s.prototype.constructor=s,s.prototype.init=function(){if(this.layout.dim){var t=this.layout.dim.color?this.layout.dim.color:null,e=this.layout.dim.duration?this.layout.dim.duration:null,i=this.layout.dim.alphaIn?this.layout.dim.alphaIn:null,s=this.layout.dim.alphaOut?this.layout.dim.alphaOut:null;this.layout.dim.alphaIn||this.layout.dim.alphaOut||!this.layout.dim.alpha||(i=this.layout.dim.alpha,s=0),this.screenDim=new o(t,e,i,s).addTo(this)}this.board=n.viewManager.addSprite(this.layout.board).addTo(this);for(var r=40,h=0;h<4;h++)this["pagination"+h]=n.viewManager.addSprite(this.layout.pagination).addTo(this.board),this["pagination"+h].x=-1.5*r+r*h,this["pagination"+h].y=-50-h%2*10,this["pagination"+h].alpha=0,this["pagination"+h].scaleXY=0;this["pagination"+this.currentPage].texture=n.assetManager.getTexture("ui_pagination_on"),this.pausedText=n.viewManager.addText(this.layout.pausedText).addTo(this.board),this.page=n.viewManager.addSprite(this.layout.page).addTo(this.board),this.maskSprite=new WRE.Sprite({texture:PIXI.Texture.WHITE,x:950-this.board.width/2,y:this.maskTopPos-this.board.height,width:this.board.width,height:400}).addTo(this),this.page.mask=this.maskSprite,this.roll=n.viewManager.addSprite(this.layout.roll).addTo(this.board),this.roll.y=this.topPos;var l={bg:{texture:n.assetManager.getTexture("ui_help_copy_bg"),nineSlice:[40,40,40,40]},choices:["ui_help_10"]};this.popup=new a(l).addTo(this),this.popup.init(),this.popup.x=950,this.popup.y=640,this.popup.show(),this.initUiElements()},s.prototype.initUiElements=function(){this.uiContainer=(new WRE.Container).addTo(this);for(var t in this.layout.ui)switch(t){case"pausedText":this.pausedText=n.viewManager.addText(this.layout.ui.pausedText).addTo(this.uiContainer);break;case"homeButton":this.homeButton=n.viewManager.addButton(this.layout.ui.homeButton).addTo(this.uiContainer),this.homeButton.on("button-on-click",this.onHomeButtonClick.bind(this));break;case"soundButton":this.soundButton=n.viewManager.addSwitchButton(this.layout.ui.soundButton).addTo(this.uiContainer),this.soundButton.on("button-on-click",this.onSoundButtonClick.bind(this)),this.soundButton.state=n.storage_data.muted?1:0;break;case"continueButton":this.continueButton=n.viewManager.addButton(this.layout.ui.continueButton).addTo(this.uiContainer),this.continueButton.on("button-on-click",this.onContinueButtonClick.bind(this));break;case"restartButton":this.restartButton=n.viewManager.addButton(this.layout.ui.restartButton).addTo(this.uiContainer),this.restartButton.on("button-on-click",this.onRestartButtonClick.bind(this));break;case"previousButton":break;case"nextButton":}},s.prototype.animateBoardIn=function(){var t=new TimelineMax({onComplete:function(){this.animatePageIn()},onCompleteScope:this});t.from(this.board,.3,{delay:.1,y:1800,ease:Cubic.easeOut},"start"),t.to(this.board.scale,.1,{delay:.2,y:1.1,repeat:1,yoyo:!0,ease:Sine.easeInOut},"start")},s.prototype.animateBoardOut=function(){var t=new TimelineMax;t.to(this.board.scale,.1,{y:1.1,repeat:1,yoyo:!0,ease:Sine.easeInOut},"start"),t.to(this.board,.4,{delay:.1,y:1800,ease:Cubic.easeOut},"start")},s.prototype.destroyUiElements=function(){for(var t=0;t<this.uiContainer.children.length;t++)this.uiContainer.children[t].doSeppuku&&this.uiContainer.children[t].doSeppuku();this.uiContainer.destroy(n.destroyOptions)},s.prototype.requestNextScene=function(){n.viewManager.hasHideTweens?(this.animateBoardOut(),this.screenDim&&this.screenDim.out(),this.popup&&this.popup.hide(),n.viewManager.hideTweensComplete.detachAll(),n.viewManager.hideTweensComplete.add(function(){this.runNextScene()},this),n.viewManager.runHideTweens()):this.runNextScene()},s.prototype.runNextScene=function(){this.signals.next.dispatch()},s.prototype.onRestartButtonClick=function(){},s.prototype.onContinueButtonClick=function(){this.requestNextScene()},s.prototype.onHomeButtonClick=function(){this.signals.previous.dispatch()},s.prototype.onSoundButtonClick=function(t){n.toggleMute("challengeWayMusic"),t.state=n.storage_data.muted?1:0},s.prototype.onPreviousButtonClick=function(){this.currentPage--,this.currentPage<0&&(this.currentPage=this.pages.length-1),this.updatePage()},s.prototype.onNextButtonClick=function(){this.currentPage++,this.currentPage>this.pages.length-1&&(this.currentPage=0),this.updatePage()},s.prototype.showPagination=function(t){for(var e=0;e<4;e++)this["pagination"+e].alpha=t?0:1;for(e=0;e<4;e++)TweenMax.to(this["pagination"+e],.1+(t?.1:0),{delay:t?.07*e:0,alpha:t?1:0}),TweenMax.to(this["pagination"+e].scale,.15+(t?.1:0),{delay:t?.07*e:0,x:t?1:0,y:t?1:0,ease:Back.easeOut})},s.prototype.updatePage=function(){this.page.texture=this.pages[this.currentPage],this.page.tint=this.tints[this.currentPage],this.maskTL&&(this.maskTL.kill(),this.maskTL=null);var t=.5;this.maskTL=new TimelineMax({onStart:function(){this.roll.alpha=1,this.roll.visible=!0},onStartScope:this,onComplete:function(){this.roll.visible=!1},onCompleteScope:this}),this.maskTL.fromTo(this.maskSprite,t,{y:this.maskTopPos-this.maskSprite.height},{y:this.maskTopPos,ease:Cubic.easeInOut},"start"),this.maskTL.fromTo(this.roll,t,{y:this.topPos},{y:this.topPos+340,ease:Cubic.easeInOut},"start"),this.maskTL.fromTo(this.roll.scale,t,{x:1,y:1},{x:.9,y:0},"start"),this.maskTL.fromTo(this.roll,.1,{alpha:1},{delay:.4,alpha:0},"start");for(var e=0;e<4;e++)this["pagination"+e].texture=n.assetManager.getTexture("ui_pagination_off");this["pagination"+this.currentPage].texture=n.assetManager.getTexture("ui_pagination_on")},s.prototype.animatePageIn=function(){this.page.visible=!0,this.updatePage()},s.prototype.appear=function(){this.screenDim&&this.screenDim["in"](),this.setUiVisible(!1),n.viewManager.done=!1,n.viewManager.showTweensComplete.add(this.onShowTweensComplete.bind(this)),n.viewManager.setShowTweensTime(.005),this.setUiVisible(!0),n.viewManager.runShowTweens(),this.animateBoardIn()},s.prototype.setUiVisible=function(t){if(this.uiContainer)for(var e=0;e<this.uiContainer.children.length;e++)this.uiContainer.children[e].visible=t},s.prototype.pause=function(){this.interactive=!1,this.interactiveChildren=!1},s.prototype.resume=function(){n.viewManager.activeLayout="wayPauseView",this.interactive=!0,this.interactiveChildren=!0},s.prototype.onShowTweensComplete=function(){n.viewManager.done=!0},s.prototype.destroy=function(){this.screenDim&&this.screenDim.out(),this.maskTL&&(this.maskTL.kill(),this.maskTL=null),this.popup&&this.popup.doSeppuku(),this.destroyUiElements(),this.pausedText.destroy(n.destroyAllOptions),p3.Scene.prototype.destroy.call(this)},s.prototype.update=function(){},s.prototype.resize=function(){this.x=Math.round((p3.View.width-n.STAGE_WIDTH)/2),this.screenDim&&(this.screenDim.resize(),this.screenDim.x=-this.x),n.viewManager.repositionDynElements()}},{"../../common":42,"../../help-text":92,"../../screendim/screendim":105}],36:[function(t,e,i){function s(t){p3.Scene.call(this),this.good=61440,this.bad=15728640,this.god=3,this.isBusy=!1,this.responsive=!0,this.interactiveChildren=!0,n.viewManager.add(n.assetManager.getJSON("wayGameView")),this.layout=n.viewManager.get(n.viewManager.activeLayout),this.stars=1,this.sprayDecay=n.config.challengesSetup.way.sprayDecay,this.isDown=!1,this.waterID=null,this.jetPS=null,this.splashPS=null,this.sparklePS=null,this.pathPS=null,this.isButtons=!1,this.buttonsTL=null,this.routeIcons=[[{x:-294,y:-147,path:[[154.17282,473.6305],[154.17282,441.03094999999996,152.91282,408.72215,152.91282,377.78566],[107.30724000000001,377.78566,61.701665000000006,377.78566,16.09608700000001,377.78566],[17.18460300000001,397.05217,16.64900000000001,416.31869,16.09608700000001,435.5852],[39.264696000000015,435.5852,62.43330600000001,435.5852,85.601915,435.5852],[86.39578800000001,382.99217,86.487008,328.29118,85.601915,270.66125],[117.66642,270.66125,147.61546,270.66125,176.32531,270.66125],[176.32531,230.66492,176.32531,187.51859,176.32531,147.52224999999999],[295.91691000000003,147.52224999999999,412.7065,147.52224999999999,528.97594,147.52224999999999],[529.96373,129.98742,529.65592,111.1214,528.97594,90.25101999999998],[364.3568700000001,90.25101999999998,199.73780000000005,90.25101999999998,35.118735000000015,90.25101999999998]]},{x:39,y:-223,path:[[502.10854,473.39387],[502.10854,422.3511,502.10854,375.1619,502.10854,329.12428],[549.02489,329.12428,594.83785,329.12428,640.0781400000001,329.12428],[640.0781400000001,352.0486,640.0781400000001,372.9748,640.0781400000001,390.8641],[570.8201000000001,390.8641,505.1205800000001,390.8641,439.10873000000004,390.8641],[439.10873000000004,353.58568,439.10873000000004,315.7872,439.10873000000004,276.83444],[385.11383,276.83444,328.03824000000003,276.83444,269.00922,276.83444],[268.06089000000003,186.8397,268.28387000000004,100.35887999999997,269.00922,15.38519599999995],[300.34736000000004,15.38519599999995,333.02567000000005,15.38519599999995,366.02894000000003,15.38519599999995]]},{x:299,y:-182,path:[[325.07906,474.02386],[324.55695000000003,424.64501,324.37599,375.60731,325.07906,327.45364],[222.38000000000002,327.45364,119.68095000000002,327.45364,16.98189000000002,327.45364],[16.98189000000002,291.48603,16.98189000000002,256.05023,16.98189000000002,221.31298],[163.90624000000003,221.31298,311.77562,221.31298,461.15866,221.31298],[461.15866,209.41394000000003,461.15866,198.03579000000002,461.15866,186.74470000000002],[484.04859,186.74470000000002,506.93853,186.74470000000002,529.82846,186.74470000000002],[529.82846,218.3059,529.82846,243.46561000000003,529.82846,263.19383000000005],[563.09696,263.19383000000005,595.5507799999999,263.19383000000005,626.84818,263.19383000000005],[626.84818,195.03820000000005,626.84818,125.17637000000005,626.84818,55.07508100000004]]}],[{x:-294,y:-161,path:[[153.1736,474.57468],[153.81009,389.70922,153.78949,303.52957000000004,153.1736,216.15935000000002],[105.67332999999999,216.89871000000002,60.12362499999999,216.66279000000003,15.108959999999996,216.15935000000002],[15.108959999999996,289.66675000000004,15.108959999999996,363.86623000000003,15.108959999999996,438.62577],[38.380233,439.15424,61.651506999999995,439.34361,84.92278,438.62577],[84.31817000000001,383.65719,84.275242,328.12693,84.92278,271.9062],[124.01156,271.9062,164.20163000000002,271.9062,205.79447,271.9062],[205.79447,230.57364,205.79447,189.24108,205.79447,147.90852],[253.04653,148.61061,298.58271,148.45476000000002,343.33811000000003,147.90852],[343.33811000000003,129.72992000000002,343.33811000000003,111.07017000000002,343.33811000000003,91.64067200000001],[283.59129,91.64067200000001,223.02707000000004,91.64067200000001,162.03058000000001,91.64067200000001],[162.03058000000001,119.27886000000001,162.03058000000001,145.69914,162.03058000000001,170.83247],[142.73427,170.83247,119.61463,170.83247,95.34275300000002,170.83247],[95.34275300000002,144.26154,95.34275300000002,117.69060999999999,95.34275300000002,91.119674],[75.82875800000002,91.119674,55.12586500000002,91.119674,34.385911000000014,91.119674]]},{x:37,y:-222,path:[[501.4418,475.48859],[501.4418,464.86151,501.4418,452.83203,501.4418,441.00549],[543.58782,440.5901,585.73383,440.19635,627.87985,441.00549],[627.87985,424.14914,627.87985,407.75929,627.87985,392.15352],[613.03296,392.15352,598.18606,392.15352,583.3391700000001,392.15352],[582.7299,319.96543,582.69618,247.20179000000002,583.3391700000001,173.76143000000002],[544.3079000000001,173.76143000000002,504.8747000000001,173.76143000000002,463.3658000000001,173.76143000000002],[462.84843000000006,261.76676000000003,462.6383200000001,350.07934,463.3658000000001,439.32952],[442.7029100000001,439.32952,423.17113000000006,439.32952,403.7396700000001,439.32952],[403.7396700000001,414.2133,403.7396700000001,388.34928,403.7396700000001,361.98171],[358.6403400000001,361.98171,313.5410100000001,361.98171,268.44168000000013,361.98171],[268.44168000000013,248.65501,268.44168000000013,132.92687,268.44168000000013,17.150667999999996],[300.42598000000015,17.150667999999996,333.14714000000015,17.150667999999996,366.38298000000015,17.150667999999996]]},{x:299,y:-198,path:[[324.54136,475.13884],[324.54136,453.45548,324.54136,431.56434,324.54136,403.74913000000004],[280.07935,404.4458,235.61734,404.30138000000005,191.15533,403.74913000000004],[191.15533,376.20102,191.15533,346.28101000000004,191.15533,314.98167],[247.81583,314.98167,305.4737,314.98167,365.87225,314.98167],[365.11545,284.29662,365.38976,253.61157,365.87225,222.92652],[380.76697,222.92652,396.22262,222.92652,412.36948,222.92652],[412.36948,177.25103000000001,412.36948,129.25711,412.36948,77.32909500000002],[450.83327,76.81035000000003,489.60826000000003,76.60280100000003,529.31709,77.32909500000002],[529.31709,138.40914000000004,529.31709,199.94105000000002,529.31709,264.72707],[561.72426,265.32208,594.13143,265.38388000000003,626.5386,264.72707],[626.5386,198.48005,626.5386,127.23895000000002,626.5386,54.784977000000026]]}],[{x:-294,y:-147,path:[[145.35661,473.04231],[145.35661,413.17926,145.35661,353.31620999999996,145.35661,293.45316],[255.07628,293.45316,364.79594999999995,293.45316,474.51562,293.45316],[474.51562,266.24268,474.51562,239.03220000000002,474.51562,211.82172000000003],[351.9807,211.82172000000003,229.44577,211.82172000000003,106.91085000000004,211.82172000000003],[106.91085000000004,286.78220000000005,106.91085000000004,361.74268000000006,106.91085000000004,436.70316],[79.17371600000004,436.70316,51.43658200000004,436.70316,23.699448000000032,436.70316],[23.699448000000032,381.58000000000004,23.699448000000032,326.45683,23.699448000000032,271.33367],[32.30147000000003,271.33367,40.90349300000003,271.33367,49.50551500000003,271.33367],[49.50551500000003,237.62778999999998,49.50551500000003,203.9219,49.50551500000003,170.21602],[66.35845700000003,170.21602,83.21139800000003,170.21602,100.06434000000003,170.21602],[100.06434000000003,158.98073,100.06434000000003,147.74544999999998,100.06434000000003,136.5101599999999],[178.71140000000003,136.51015999999998,257.35845,136.51015999999998,336.00551,136.51015999999998],[336.00551,121.06162999999998,336.00551,105.61309999999999,336.00551,90.1645639999999],[295.80422,90.16456399999998,255.60294000000002,90.16456399999998,215.40165000000002,90.1645639999999],[215.40165000000002,76.99820399999999,215.40165000000002,63.831842999999985,215.40165000000002,50.66548299999999],[185.73345,50.66548299999999,156.06526000000002,50.66548299999999,126.39706000000002,50.6654829999999],[126.39706000000002,63.831842999999985,126.39706000000002,76.99820399999999,126.39706000000002,90.16456399999998],[93.04228000000003,90.16456399999998,59.68750000000003,90.16456399999998,26.332720000000023,90.16456399999998]]},{x:39,y:-223,path:[[317.04595,474.6223],[317.04595,449.69399,317.04595,424.76568,317.04595,399.83736999999996],[278.77573,399.83736999999996,240.50551000000002,399.83736999999996,202.23529000000002,399.8373699999999],[202.23529000000002,380.00005,202.23529000000002,360.16274,202.23529000000002,340.32541999999995],[313.00827000000004,340.32541999999995,423.78125,340.32541999999995,534.55423,340.32541999999995],[534.55423,365.60482999999994,534.55423,390.88424999999995,534.55423,416.16365999999994],[548.2472399999999,416.16365999999994,561.94026,416.16365999999994,575.6332699999999,416.16365999999994],[575.6332699999999,320.31255999999996,575.6332699999999,224.46144999999993,575.6332699999999,128.61034999999993],[512.4347399999999,128.61034999999993,449.2362099999999,128.61034999999993,386.0376799999999,128.6103499999999],[386.0376799999999,111.05519999999993,386.0376799999999,93.50005499999992,386.0376799999999,75.9449069999999],[431.1544099999999,75.94490699999992,476.2711399999999,75.94490699999992,521.3878699999999,75.9449069999999],[521.3878699999999,130.3658599999999,521.3878699999999,184.78681999999992,521.3878699999999,239.2077799999999],[554.0404399999999,239.20777999999993,586.6930199999999,239.20777999999993,619.3455899999999,239.2077799999999],[619.3455899999999,177.41365999999994,619.3455899999999,115.61953999999993,619.3455899999999,53.82542199999992]]},{x:290,y:-182,path:[[494.00183,474.09564],[494.00183,462.15814,494.00183,450.22064,494.00183,438.28314],[452.04503,438.28314,410.08822999999995,438.28314,368.13142999999997,438.28314],[368.13142999999997,422.83461,368.13142999999997,407.38608,368.13142999999997,391.93755],[378.63127999999995,391.93755,389.13113,391.93755,399.63097,391.93755],[399.63097,344.71421,399.63097,297.49086,399.63097,250.26752],[331.90134,250.26752,264.17172,250.26752,196.44208999999998,250.26752],[196.44208999999998,224.98811,196.44208999999998,199.70869,196.44208999999998,174.42928],[281.58456,174.42928,366.72702,174.42928,451.86949,174.42928],[451.86949,121.58829,451.86949,68.747297,451.86949,15.906305000000003],[420.44577,15.906305000000003,389.02206,15.906305000000003,357.59834,15.906305000000003]]}],[{x:-294,y:-147,path:[[130.43291,473.12689],[130.43291,443.16365,130.43291,413.20042,130.43291,383.23718],[161.45006,383.23718,192.46722,383.23718,223.48437,383.23718],[223.48437,364.81255000000004,223.48437,346.38792,223.48437,327.96329000000003],[159.85478,327.96329000000003,96.22518300000002,327.96329000000003,32.59558800000002,327.96329000000003],[32.59558800000002,292.30428,32.59558800000002,256.64527000000004,32.59558800000002,220.98627000000005],[173.79841000000002,220.98627000000005,315.00123,220.98627000000005,456.20405,220.98627000000005],[456.20405,254.20226000000005,456.20405,287.41825000000006,456.20405,320.63424000000003],[489.1728,320.63424000000003,522.14154,320.63424000000003,555.11029,320.63424000000003],[555.11029,301.69399000000004,555.11029,282.75373,555.11029,263.81347000000005],[578.14338,263.81347000000005,601.17647,263.81347000000005,624.20956,263.81347000000005],[624.20956,236.05367000000007,624.20956,208.29386000000005,624.20956,180.53406000000007],[601.59804,180.53406000000007,578.98652,180.53406000000007,556.375,180.53406000000007],[556.375,147.46947000000006,556.375,114.40488000000006,556.375,81.34028700000007],[578.96078,81.34028700000007,601.54657,81.34028700000007,624.13235,81.34028700000007],[624.12835,72.19291200000008,624.1243499999999,63.04553600000007,624.12105,53.89816100000007]]
},{x:294,y:-210,path:[[555.56342,473.64803],[555.56342,441.59625,555.56342,409.54448,555.56342,377.4927],[535.08701,377.4927,514.6106,377.4927,494.13418999999993,377.4927],[494.13418999999993,397.1272,494.13418999999993,416.7617,494.13418999999993,436.39619],[356.66022999999996,436.39619,219.18626999999992,436.39619,81.71231599999993,436.39619],[81.71231599999993,381.02089,81.71231599999993,325.64558,81.71231599999993,270.27027],[111.90164999999993,270.27027,142.09098999999992,270.27027,172.28032999999994,270.27027],[172.28032999999994,221.20225,172.28032999999994,172.13423999999998,172.28032999999994,123.0662199999999],[268.2662399999999,123.06621999999999,364.25213999999994,123.06621999999999,460.23804999999993,123.06621999999999],[460.23804999999993,102.72430999999999,460.23804999999993,82.38240199999998,460.23804999999993,62.04049099999999],[341.88694999999996,62.04049099999999,223.53583999999992,62.04049099999999,105.18473999999992,62.04049099999999],[105.18473999999992,71.635162,105.18473999999992,81.22983199999999,105.18473999999992,90.82450299999999],[80.76991499999991,90.82450299999999,56.35508599999992,90.82450299999999,31.940256999999917,90.82450299999999]]},{x:39,y:-223,path:[[339.54044,473.32909],[339.54044,424.60115,339.54044,375.87321000000003,339.54044,327.14527],[314.83088,327.14527,290.12131999999997,327.14527,265.41175999999996,327.14527],[265.41175999999996,306.58277,265.41175999999996,286.02027,265.41175999999996,265.4577],[345.58822999999995,265.45777,425.7647099999999,265.45777,505.9411799999999,265.45777],[505.9411799999999,231.24453,505.9411799999999,197.0313,505.9411799999999,162.81806],[425.7647099999999,162.81806,345.5882399999999,162.81806,265.41176999999993,162.81806],[265.41176999999993,113.39895,265.41176999999993,63.97982900000001,265.41176999999993,14.560711999999995],[297.55146999999994,14.560711999999995,329.6911799999999,14.560711999999995,361.8308799999999,14.560711999999995]]}]],this.inputPos=new PIXI.Point,this.isGameOver=!1,this.preloadStuff()}var n=t("../../common"),o=t("../challenge-preloader"),a=t("../../loader/audio-loader"),r=t("../challenge-spine"),h=t("../challenge-tutorial-hand-anims"),l=t("../challenge-tutorial-timer"),u={challengeStarReward1:{type:"sound",url:"sfx/challenges/shared/sfx_star_reward_1",soundId:"challengeStarReward1"},challengeStarReward2:{type:"sound",url:"sfx/challenges/shared/sfx_star_reward_2",soundId:"challengeStarReward2"},challengeStarReward3:{type:"sound",url:"sfx/challenges/shared/sfx_star_reward_3",soundId:"challengeStarReward3"},challengeFanfare:{type:"sound",url:"sfx/challenges/shared/sfx_minigame_complete_fanfare_00",soundId:"challengeFanfare"},challengeWayDrop:{type:"sound",url:"sfx/challenges/way/sfx_water_jet_end_00",soundId:"challengeWayDrop"},challengeWayCorrect:{type:"sound",url:"sfx/challenges/way/sfx_way_correct_00",soundId:"challengeWayCorrect"},challengeWayIncorrect:{type:"sound",url:"sfx/challenges/way/sfx_way_incorrect_00",soundId:"challengeWayIncorrect"},challengeWayWater:{type:"sound",url:"sfx/challenges/way/sfx_water_jet_loop_00",soundId:"challengeWayWater"},challengeWayMusic:{type:"sound",url:"music/challenges/way/music_challenge_way_00",soundId:"challengeWayMusic"},challengeStart:{type:"sound",url:"music/challenges/shared/music_race_challenge_start_00",soundId:"challengeStart"},challengeEnd:{type:"sound",url:"music/challenges/shared/music_race_challenge_end_00",soundId:"challengeEnd"}},p=[{name:"screenBg",url:n.PATHS.IMAGES+"endgame_bg.jpg",destroyId:"screenBg"},{name:"selectAtlas",url:n.PATHS.IMAGES+"character/ui_vehicle_select_0.8x.json",destroyId:"ui_char_brown"},{name:"level_background",url:n.PATHS.IMAGES+"level/#LEVEL#/level_background.png",destroyId:"level_background"},{name:"wayBrush",url:n.PATHS.IMAGES+"challenges/way/challenge_way_brush_alone.png",destroyId:"wayBrush"},{name:"wayCleaner",url:n.PATHS.IMAGES+"challenges/way/challenge_way_cleaner.png",destroyId:"wayCleaner"},{name:"wayAtlas0",url:n.PATHS.IMAGES+"challenges/way/challenge_way_atlas_0_1x.json",destroyId:"challenge_map_sparkle_1"},{name:"wayAtlas1",url:n.PATHS.IMAGES+"challenges/way/challenge_way_atlas_1_1x.json",destroyId:"challenge_way_route_2_path2"},{name:"wayJetParticles",url:n.PATHS.DATA+"particles/challenge_way_water_jet.json"},{name:"waySplashParticles",url:n.PATHS.DATA+"particles/challenge_way_water_splash.json"},{name:"waySparkleParticles",url:n.PATHS.DATA+"particles/challenge_way_sparkles_00.json"},{name:"wayPathParticles",url:n.PATHS.DATA+"particles/challenge_way_path_sparkles_00.json"},{name:"tutorialHandSpine",url:n.PATHS.IMAGES+"tutorial/tutorial_hand.json",destroyId:"tutorialHandSpine_atlas_page_tutorial_hand"}],c=[];e.exports=s,s.prototype=Object.create(p3.Scene.prototype),s.prototype.constructor=s,s.prototype.preloadStuff=function(){n.memoryManager.resetLoader();var t=0;c=WRE.cloneObj(p);for(t in c)c[t].url=c[t].url.replaceAll("#LEVEL#",n.currentLevel);for(t in c)c[t].hasOwnProperty("destroyId")&&n.memoryManager.store("way",c[t].destroyId);for(t in u)u[t].hasOwnProperty("soundId")&&n.memoryManager.storeSound("way",u[t].soundId);this.audioLoader=new a(u,(!1)),this.audioLoader.start()},s.prototype.preloader=function(){return new o},s.prototype.load=function(){return c},s.prototype.init=function(){this.routes=[[n.assetManager.getTexture("challenge_way_route_1_path1"),n.assetManager.getTexture("challenge_way_route_1_path2"),n.assetManager.getTexture("challenge_way_route_1_path3")],[n.assetManager.getTexture("challenge_way_route_2_path1"),n.assetManager.getTexture("challenge_way_route_2_path2"),n.assetManager.getTexture("challenge_way_route_2_path3")],[n.assetManager.getTexture("challenge_way_route_3_path1"),n.assetManager.getTexture("challenge_way_route_3_path2"),n.assetManager.getTexture("challenge_way_route_3_path3")],[n.assetManager.getTexture("challenge_way_route_4_path1"),n.assetManager.getTexture("challenge_way_route_4_path2"),n.assetManager.getTexture("challenge_way_route_4_path3")]],this.routeIdx=Math.floor(Math.random()*this.routes.length),this.bgSprite=n.viewManager.addSprite(this.layout.bgImage).addTo(this),this.bgSprite.filters=[new PIXI.filters.BlurFilter(1.4)],this.signBgSprite=n.viewManager.addSprite(this.layout.signBgImage).addTo(this),this.leftLegSprite=n.viewManager.addSprite(this.layout.leftLegImage).addTo(this),this.rightLegSprite=n.viewManager.addSprite(this.layout.rightLegImage).addTo(this),this.route2=n.viewManager.addSprite(this.layout.routeImage).addTo(this),this.route2.texture=this.routes[this.routeIdx][2],this.route1=n.viewManager.addSprite(this.layout.routeImage).addTo(this),this.route1.texture=this.routes[this.routeIdx][1],this.route0=n.viewManager.addSprite(this.layout.routeImage).addTo(this),this.route0.texture=this.routes[this.routeIdx][0],this.selectedRoute=n.viewManager.addSprite(this.layout.routeImage).addTo(this),this.selectedRoute.visible=!1,this.icon0=n.viewManager.addSprite(this.layout.routeIcon).addTo(this),this.icon0.x=this.route0.x+this.routeIcons[this.routeIdx][0].x,this.icon0.y=this.route0.y+this.routeIcons[this.routeIdx][0].y,this.icon1=n.viewManager.addSprite(this.layout.routeIcon).addTo(this),this.icon1.x=this.route0.x+this.routeIcons[this.routeIdx][1].x,this.icon1.y=this.route0.y+this.routeIcons[this.routeIdx][1].y,this.icon2=n.viewManager.addSprite(this.layout.routeIcon).addTo(this),this.icon2.x=this.route0.x+this.routeIcons[this.routeIdx][2].x,this.icon2.y=this.route0.y+this.routeIcons[this.routeIdx][2].y,this.theChoosenOne=Math.floor(3*Math.random()),this["icon"+this.theChoosenOne].texture=n.assetManager.getTexture("challenge_way_icon_flag"),this.w=n.assetManager.getTexture("challenge_way_dirt").width,this.h=n.assetManager.getTexture("challenge_way_dirt").height,this.drawingCanvas=document.createElement("canvas"),this.drawingCanvas.width=this.w,this.drawingCanvas.height=this.h,this.drawingContext=this.drawingCanvas.getContext("2d");var t=n.assetManager.getTexture("challenge_way_dirt");this.drawingContext.drawImage(t.baseTexture.source,t.frame.x,t.frame.y,t.frame.width,t.frame.height,0,0,t.frame.width,t.frame.height);for(var e=n.assetManager.getTexture("challenge_way_stain"),i=0;i<3;i++){var s=30+Math.floor(Math.random()*(t.width-e.width-60)),o=30+Math.floor(Math.random()*(t.height-e.height-60));this.drawingContext.drawImage(e.baseTexture.source,e.frame.x,e.frame.y,e.frame.width,e.frame.height,s,o,e.frame.width,e.frame.height)}this.drawingContext.globalAlpha=n.config.challengesSetup.way.sprayIntensity,this.drawingContext.globalCompositeOperation="destination-out",this.rt=PIXI.Texture.fromCanvas(this.drawingCanvas),this.spr=new PIXI.Sprite(this.rt).addTo(this),this.spr.anchorX=.5,this.spr.anchorY=.5,this.spr.x=this.signBgSprite.x,this.spr.y=this.signBgSprite.y,this.spr.responsive=!0,this.spr.on("pointerdown",this.onPointerDown,this),this.spr.on("pointermove",this.onPointerMove,this),this.spr.on("pointerup",this.onPointerUp,this),this.spr.on("pointerupoutside",this.onPointerUp,this),this.particlesContainer=(new WRE.Container).addTo(this),this.initJetParticles(),this.initSplashParticles(),this.spray=new WRE.Sprite({texture:n.assetManager.getTexture("challenge_way_spray"),anchorXY:0,x:this.spr.x,y:this.spr.y}).addTo(this),this.brushImage=n.assetManager.getTexture("wayBrush").baseTexture.source,this.cleanerImage=n.assetManager.getTexture("wayCleaner").baseTexture.source,this.tutorialContainer=new WRE.Container({visible:!1,interactive:!1,interactiveChildren:!1}).addTo(this),this.tutorialSpine=new r("tutorialHandSpine",h).addTo(this.tutorialContainer),this.timer=new l,this.timer.onComplete.add(this.playTutorial,this),this.leftButton=n.viewManager.addButton(this.layout.buttonLeft).addTo(this),this.leftButton.scaleXY=0,this.leftButton.visible=!1,this.leftButton.on("button-on-click",this.onLeftButtonClick.bind(this)),this.middleButton=n.viewManager.addButton(this.layout.buttonMiddle).addTo(this),this.middleButton.scaleXY=0,this.middleButton.visible=!1,this.middleButton.on("button-on-click",this.onMiddleButtonClick.bind(this)),this.rightButton=n.viewManager.addButton(this.layout.buttonRight).addTo(this),this.rightButton.scaleXY=0,this.rightButton.visible=!1,this.rightButton.on("button-on-click",this.onRightButtonClick.bind(this)),this.layout.ui&&(this.uiContainer=(new WRE.Container).addTo(this),this.initUiElements())},s.prototype.playTutorial=function(t){var e="undefined"!=typeof t?t:1;this.isButtons?this.isGameOver||this.playButtons():(this.tutorialContainer.visible=!0,this.tutorialSpine.x=this.spray.x+90,this.tutorialSpine.y=this.spray.y+100,this.tutorialSpine.play(["swipe"],1!==e),this.tutorialSpine.time=0,window.delay(function(){n.storage_data.tutorial[5]=1,n.storage.save(),this.tutorialContainer&&(this.tutorialContainer.visible=!1),this.timer&&this.timer.start()},this.tutorialSpine.duration*e,this))},s.prototype.playButtons=function(){this.buttonsTL&&this.buttonsTL.kill(),this.leftButton.scaleXY=1,this.middleButton.scaleXY=1,this.rightButton.scaleXY=1,this.buttonsTL=new TimelineMax({onComplete:function(){this.timer&&this.timer.start()},onCompleteScope:this}),this.buttonsTL.to(this.leftButton.scale,.2,{delay:0,x:1.2,y:1.2,repeat:1,yoyo:!0,ease:Sine.easeInOut},"start"),this.buttonsTL.to(this.middleButton.scale,.2,{delay:.15,x:1.2,y:1.2,repeat:1,yoyo:!0,ease:Sine.easeInOut},"start"),this.buttonsTL.to(this.rightButton.scale,.2,{delay:.3,x:1.2,y:1.2,repeat:1,yoyo:!0,ease:Sine.easeInOut},"start")},s.prototype.initUiElements=function(){for(var t in this.layout.ui)switch(t){case"progressBar":this.progressBar=n.viewManager.addProgressBar(this.layout.ui.progressBar).addTo(this.uiContainer),this.progressBar.bar.value=1;break;case"pauseButton":this.pauseButton=n.viewManager.addButton(this.layout.ui.pauseButton).addTo(this.uiContainer),this.pauseButton.on("button-on-click",this.onPauseButtonClick.bind(this))}},s.prototype.initJetParticles=function(){this.jetPS=new PIXI.particles.Emitter(this.particlesContainer,[n.assetManager.getTexture("challenge_way_particle1"),n.assetManager.getTexture("challenge_way_particle2"),n.assetManager.getTexture("challenge_way_particle3")],n.assetManager.getJSON("wayJetParticles")),this.jetPS.updateSpawnPos(0,0),this.jetPS.emit=!1},s.prototype.initSplashParticles=function(){this.splashPS=new PIXI.particles.Emitter(this.particlesContainer,[n.assetManager.getTexture("challenge_way_particle1"),n.assetManager.getTexture("challenge_way_particle2"),n.assetManager.getTexture("challenge_way_particle3")],n.assetManager.getJSON("waySplashParticles")),this.splashPS.updateSpawnPos(0,0),this.splashPS.emit=!1},s.prototype.initSparkleParticles=function(t,e){this.sparklePS=new PIXI.particles.Emitter(this,[n.assetManager.getTexture("challenge_map_sparkle_1"),n.assetManager.getTexture("challenge_map_sparkle_2")],n.assetManager.getJSON("waySparkleParticles")),this.sparklePS.updateSpawnPos(t,e),this.sparklePS.emit=!0},s.prototype.initPathParticles=function(t,e){this.onGameOver(),this.pathPS=new PIXI.particles.Emitter(this,[n.assetManager.getTexture("challenge_map_sparkle_1"),n.assetManager.getTexture("challenge_map_sparkle_2")],n.assetManager.getJSON("wayPathParticles"));for(var i=[],s=0;s<this.routeIcons[this.routeIdx][t].path.length;s++)for(var o=this.routeIcons[this.routeIdx][t].path[s],a=0;a<o.length;a+=2)i.push({x:o[a]+this.route0.x-this.route0.texture.width/2,y:o[a+1]+this.route0.y-this.route0.texture.height/2});this.pathSprite=new WRE.Sprite({texture:PIXI.Texture.EMPTY,anchorXY:.5,x:i[0].x,y:i[0].y}).addTo(this),this.pathPS.updateSpawnPos(this.pathSprite.x,this.pathSprite.y),this.pathPS.emit=!0;var r=new PIXI.Point(544,84);this.drawingContext.globalAlpha=.9,TweenMax.to(this.pathSprite,this.god,{bezier:{type:"thru",values:i},ease:Linear.easeNone,onUpdate:function(){this.drawingContext.drawImage(this.cleanerImage,this.pathSprite.x-r.x-this.cleanerImage.width/2,this.pathSprite.y-r.y-this.cleanerImage.height/2),this.rt.baseTexture.update(),this.pathPS.updateSpawnPos(this.pathSprite.x,this.pathSprite.y)},onUpdateScope:this,onComplete:function(){this.drawingContext.globalAlpha=1,this.drawingContext.drawImage(this.brushImage,this.pathSprite.x-r.x-this.brushImage.width/2,this.pathSprite.y-r.y-this.brushImage.height/2),this.rt.baseTexture.update(),this.pathPS.emit=!1,this.pulse(e),this.buttonsTL&&this.buttonsTL.kill(),n.animator.setTimeout(function(){this.hideWayButtons(),this.requestGameOver()},1,this)},onCompleteScope:this},"start")},s.prototype.onSoundButtonClick=function(t){n.toggleMute(),t.state=n.storage_data.muted?1:0},s.prototype.onPauseButtonClick=function(){this.signals.pause.dispatch()},s.prototype.pulse=function(t){var e=this["icon"+t];3===this.stars&&this.initSparkleParticles(950,384),TweenMax.to(e.scale,.25,{x:1.2,y:1.2,repeat:5,yoyo:!0,ease:Sine.easeInOut})},s.prototype.playSound=function(){3===this.stars?n.audio.play("challengeWayCorrect"):n.audio.play("challengeWayIncorrect")},s.prototype.tintRoute=function(t,e){var i=this.bad;e&&(i=this.good);var s=this["route"+t];window.delay(function(){this.selectedRoute.texture=s.texture,this.selectedRoute.tint=i,this.selectedRoute.visible=!0,this.selectedRoute.alpha=0,TweenMax.to(this.selectedRoute,.5,{alpha:1,ease:Cubic.easeOut})},this.god,this)},s.prototype.onLeftButtonClick=function(){switch(this.leftButton.responsive=!1,this.middleButton.responsive=!1,this.rightButton.responsive=!1,(this.routeIdx<3&&0===this.theChoosenOne||3===this.routeIdx&&1===this.theChoosenOne)&&(this.stars=3),0===this.routeIdx&&(0===this.theChoosenOne?this.tintRoute(2,!0):this.tintRoute(2,!1)),1===this.routeIdx&&(0===this.theChoosenOne?this.tintRoute(0,!0):this.tintRoute(0,!1)),2===this.routeIdx&&(0===this.theChoosenOne?this.tintRoute(0,!0):this.tintRoute(0,!1)),3===this.routeIdx&&(1===this.theChoosenOne?this.tintRoute(0,!0):this.tintRoute(0,!1)),n.animator.setTimeout(function(){this.playSound()},this.god,this),this.routeIdx){case 0:case 1:case 2:this.initPathParticles(0,0);break;case 3:this.initPathParticles(0,1)}},s.prototype.onMiddleButtonClick=function(){switch(this.leftButton.responsive=!1,this.middleButton.responsive=!1,this.rightButton.responsive=!1,(this.routeIdx<3&&2===this.theChoosenOne||3===this.routeIdx&&2===this.theChoosenOne)&&(this.stars=3),0===this.routeIdx&&(2===this.theChoosenOne?this.tintRoute(0,!0):this.tintRoute(0,!1)),1===this.routeIdx&&(2===this.theChoosenOne?this.tintRoute(2,!0):this.tintRoute(2,!1)),2===this.routeIdx&&(2===this.theChoosenOne?this.tintRoute(2,!0):this.tintRoute(2,!1)),3===this.routeIdx&&(2===this.theChoosenOne?this.tintRoute(1,!0):this.tintRoute(1,!1)),n.animator.setTimeout(function(){this.playSound()},this.god,this),this.routeIdx){case 0:case 1:this.initPathParticles(2,2);break;case 2:this.initPathParticles(1,2);break;case 3:this.initPathParticles(2,2)}},s.prototype.onRightButtonClick=function(){switch(this.leftButton.responsive=!1,this.middleButton.responsive=!1,this.rightButton.responsive=!1,(this.routeIdx<3&&1===this.theChoosenOne||3===this.routeIdx&&0===this.theChoosenOne)&&(this.stars=3),0===this.routeIdx&&(1===this.theChoosenOne?this.tintRoute(1,!0):this.tintRoute(1,!1)),1===this.routeIdx&&(1===this.theChoosenOne?this.tintRoute(1,!0):this.tintRoute(1,!1)),2===this.routeIdx&&(1===this.theChoosenOne?this.tintRoute(1,!0):this.tintRoute(1,!1)),3===this.routeIdx&&(0===this.theChoosenOne?this.tintRoute(2,!0):this.tintRoute(2,!1)),n.animator.setTimeout(function(){this.playSound()},this.god,this),this.routeIdx){case 0:case 1:this.initPathParticles(1,1);break;case 2:this.initPathParticles(2,1);break;case 3:this.initPathParticles(1,0)}},s.prototype.onPointerDown=function(t){this.isDown||(this.timer.reset(),this.isDown=!0,this.inputPos.x=this.toLocal(t.data.global).x,this.inputPos.y=this.toLocal(t.data.global).y,this.jetPS&&(this.jetPS.cleanup(),this.jetPS.updateSpawnPos(this.inputPos.x+40,this.inputPos.y+40),this.jetPS.resetPositionTracking(),this.jetPS.emit=!0),this.splashPS&&(this.splashPS.cleanup(),this.splashPS.updateSpawnPos(this.inputPos.x-60,this.inputPos.y-20),this.splashPS.resetPositionTracking(),this.splashPS.emit=!0),this.onPointerMove(t))},s.prototype.onPointerMove=function(t){this.isDown&&(this.timer.reset(),this.inputPos.x=this.spr.toLocal(t.data.global).x+this.w/2,this.inputPos.y=this.spr.toLocal(t.data.global).y+this.h/2,this.spray.x=this.toLocal(t.data.global).x,this.spray.y=this.toLocal(t.data.global).y,this.jetPS&&this.jetPS.updateSpawnPos(this.spray.x+40,this.spray.y+40),this.splashPS&&this.splashPS.updateSpawnPos(this.spray.x-60,this.spray.y-20),null===this.waterID&&(this.waterID=n.audio.play("challengeWayWater",{loop:!0})))},s.prototype.onPointerUp=function(t){this.isDown&&(this.timer.reset(),null!==this.waterID&&(n.audio.stop(this.waterID),this.waterID=null),n.audio.play("challengeWayDrop"),this.jetPS.emit=!1,this.splashPS.emit=!1,this.isDown=!1)},s.prototype.onGameOver=function(){this.isGameOver=!0,this.isDown=!1,null!==this.waterID&&(n.audio.stop(this.waterID),this.waterID=null),this.spr.responsive=!1,TweenMax.to(this.spray,.7,{alpha:0}),this.jetPS.emit=!1,this.splashPS.emit=!1},s.prototype.showWayButtons=function(){this.leftButton.visible=!0,this.middleButton.visible=!0,this.rightButton.visible=!0,TweenMax.to(this.leftButton.scale,.5,{delay:0,x:1,y:1,ease:Back.easeOut}),TweenMax.to(this.middleButton.scale,.5,{delay:.05,x:1,y:1,ease:Back.easeOut}),TweenMax.to(this.rightButton.scale,.5,{delay:.1,x:1,y:1,ease:Back.easeOut})},s.prototype.hideWayButtons=function(){this.leftButton.scaleXY=1,this.middleButton.scaleXY=1,this.rightButton.scaleXY=1,TweenMax.to(this.leftButton.scale,.5,{delay:0,x:0,y:0,ease:Back.easeIn}),TweenMax.to(this.middleButton.scale,.5,{delay:.05,x:0,y:0,ease:Back.easeIn}),TweenMax.to(this.rightButton.scale,.5,{delay:.1,x:0,y:0,ease:Back.easeIn})},s.prototype.appear=function(){n.memoryManager.free("game"),n.playMusic("challengeWayMusic"),n.viewManager.runShowTweens(),0===n.storage_data.tutorial[5]?window.delay(function(){this.playTutorial()},1,this):this.timer.start()},s.prototype.pause=function(){this.interactive=!1,this.interactiveChildren=!1,this.isBusy=!0},s.prototype.resume=function(){n.viewManager.activeLayout="wayGameView",this.interactive=!0,this.interactiveChildren=!0,this.isBusy=!1},s.prototype.runNextScene=function(){this.signals.next.dispatch(this.stars)},s.prototype.requestGameOver=function(){n.audio.play("challengeEnd"),n.animator.setTimeout(function(){n.viewManager.hasHideTweens?(n.viewManager.hideTweensComplete.detachAll(),n.viewManager.hideTweensComplete.add(function(){this.runNextScene()},this),n.viewManager.runHideTweens()):this.runNextScene()},1,this)},s.prototype.update=function(){this.timer&&this.timer.update(),this.tutorialContainer.visible&&this.tutorialSpine.update(p3.Timestep.deltaTime),this.jetPS&&this.jetPS.update(p3.Timestep.deltaTime),this.splashPS&&this.splashPS.update(p3.Timestep.deltaTime),this.sparklePS&&this.sparklePS.update(p3.Timestep.deltaTime),this.pathPS&&this.pathPS.update(p3.Timestep.deltaTime),n.paused||this.isBusy||!this.isDown||(this.drawingContext.drawImage(this.brushImage,this.inputPos.x-this.brushImage.width+15,this.inputPos.y-this.brushImage.height/2-30),this.progressBar.bar.value-=this.sprayDecay,this.rt.baseTexture.update(),this.progressBar.bar.value<=.25&&!this.isButtons&&(this.isButtons=!0,this.timer&&(this.timer.maxTime=5e3,this.timer.start()),this.showWayButtons()),0===this.progressBar.bar.value&&this.onGameOver())},s.prototype.destroy=function(){this.jetPS&&(this.jetPS.emit=!1,this.jetPS.destroy()),this.splashPS&&(this.splashPS.emit=!1,this.splashPS.destroy()),this.sparklePS&&(this.sparklePS.emit=!1,this.sparklePS.destroy()),this.pathPS&&(this.pathPS.emit=!1,this.pathPS.destroy()),this.bgSprite.filters=[],this.leftButton.doSeppuku(),this.middleButton.doSeppuku(),this.rightButton.doSeppuku(),this.spr.destroy(n.destroyAllOptions),this.inputPos=null,TweenMax.killAll(),this.tutorialSpine.doSeppuku(),this.timer.doSeppuku(),this.timer=null,p3.Scene.prototype.destroy.call(this)},s.prototype.resize=function(){this.x=Math.round((p3.View.width-n.STAGE_WIDTH)/2),n.currentSubScreen&&n.currentSubScreen.resize&&n.currentSubScreen.resize(),n.viewManager.repositionDynElements()}},{"../../common":42,"../../loader/audio-loader":97,"../challenge-preloader":11,"../challenge-spine":13,"../challenge-tutorial-hand-anims":14,"../challenge-tutorial-timer":15}],37:[function(t,e,i){function s(t,e){PIXI.Container.call(this),this.x=t,this.y=e,this._isValid=null,this.g=(new PIXI.Graphics).addTo(this),this._angle=0,this.create()}var n=t("../../common");e.exports=s,s.prototype=Object.create(PIXI.Container.prototype),s.prototype.constructor=s,s.prototype.create=function(){this.sprite=new WRE.Sprite({texture:n.assetManager.getTexture("challenge_wheel_nut_result_ok"),anchorXY:.5,mask:this.g}).addTo(this),this.icon=new WRE.Sprite({texture:PIXI.Texture.EMPTY,anchorXY:.5,scaleXY:.8}).addTo(this)},s.prototype.rotateXY=function(t,e){var i=Math.cos(this._angle),s=Math.sin(this._angle);return new PIXI.Point(i*t-s*e,s*t+i*e)},s.prototype.computeMask=function(t){var e=30,i=this.rotateXY(0,-2*e,this._angle),s=[new PIXI.Point(0,-2*e),new PIXI.Point(0,0),new PIXI.Point(i.x,i.y)];return this._angle>3*Math.PI/2&&s.push(new PIXI.Point(-2*e,0)),this._angle>Math.PI&&s.push(new PIXI.Point(0,2*e)),this._angle>Math.PI/2&&s.push(new PIXI.Point(2*e,0)),s},s.prototype.updateMask=function(){this.g.clear();var t=this.computeMask();this.g.beginFill(16777215),this.g.moveTo(t[0].x,t[0].y);for(var e=1;e<t.length;++e)this.g.lineTo(t[e].x,t[e].y);for(this.g.lineTo(t[0].x,t[0].y),this.g.endFill(),e=0;e<t.length;e++)t[e]=null},s.prototype.doSeppuku=function(){this.g.destroy(),this.destroy({children:!0})},Object.defineProperty(s.prototype,"isValid",{get:function(){return this._isValid},set:function(t){this._isValid=t,t?(this.sprite.texture=n.assetManager.getTexture("challenge_wheel_nut_result_ok"),this.icon.texture=n.assetManager.getTexture("icon_tick_off")):(this.sprite.texture=n.assetManager.getTexture("challenge_wheel_nut_result_wrong"),this.icon.texture=n.assetManager.getTexture("icon_cross_off"))}}),Object.defineProperty(s.prototype,"angle",{get:function(){return this._angle},set:function(t){t>6.2822&&(t=6.2822),this._angle=t,this.updateMask()}})},{"../../common":42}],38:[function(t,e,i){function s(t){p3.Scene.call(this),this.gameName=t,n.viewManager.add(n.assetManager.getJSON("wheelPauseView")),this.layout=n.viewManager.get(n.viewManager.activeLayout),this.pages=[n.assetManager.getTexture("ui_help_11")],this.tints=[16777215],this.topPos=-631,this.maskTopPos=101,this.currentPage=0,this.screenDim=null,this.popup=null,this.maskTL=null}var n=t("../../common"),o=t("../../screendim/screendim"),a=t("../../help-text");e.exports=s,s.prototype=Object.create(p3.Scene.prototype),s.prototype.constructor=s,s.prototype.init=function(){if(this.layout.dim){var t=this.layout.dim.color?this.layout.dim.color:null,e=this.layout.dim.duration?this.layout.dim.duration:null,i=this.layout.dim.alphaIn?this.layout.dim.alphaIn:null,s=this.layout.dim.alphaOut?this.layout.dim.alphaOut:null;this.layout.dim.alphaIn||this.layout.dim.alphaOut||!this.layout.dim.alpha||(i=this.layout.dim.alpha,s=0),this.screenDim=new o(t,e,i,s).addTo(this)}this.board=n.viewManager.addSprite(this.layout.board).addTo(this);for(var r=40,h=0;h<4;h++)this["pagination"+h]=n.viewManager.addSprite(this.layout.pagination).addTo(this.board),this["pagination"+h].x=-1.5*r+r*h,this["pagination"+h].y=-50-h%2*10,this["pagination"+h].alpha=0,this["pagination"+h].scaleXY=0;this["pagination"+this.currentPage].texture=n.assetManager.getTexture("ui_pagination_on"),this.pausedText=n.viewManager.addText(this.layout.pausedText).addTo(this.board),this.page=n.viewManager.addSprite(this.layout.page).addTo(this.board),this.maskSprite=new WRE.Sprite({texture:PIXI.Texture.WHITE,x:950-this.board.width/2,y:this.maskTopPos-this.board.height,width:this.board.width,height:400}).addTo(this),this.page.mask=this.maskSprite,this.roll=n.viewManager.addSprite(this.layout.roll).addTo(this.board),this.roll.y=this.topPos;var l={bg:{texture:n.assetManager.getTexture("ui_help_copy_bg"),nineSlice:[40,40,40,40]},choices:["ui_help_11"]};this.popup=new a(l).addTo(this),this.popup.init(),this.popup.x=950,this.popup.y=640,this.popup.show(),this.initUiElements()},s.prototype.initUiElements=function(){this.uiContainer=(new WRE.Container).addTo(this);for(var t in this.layout.ui)switch(t){case"pausedText":this.pausedText=n.viewManager.addText(this.layout.ui.pausedText).addTo(this.uiContainer);break;case"homeButton":this.homeButton=n.viewManager.addButton(this.layout.ui.homeButton).addTo(this.uiContainer),this.homeButton.on("button-on-click",this.onHomeButtonClick.bind(this));break;case"soundButton":this.soundButton=n.viewManager.addSwitchButton(this.layout.ui.soundButton).addTo(this.uiContainer),this.soundButton.on("button-on-click",this.onSoundButtonClick.bind(this)),this.soundButton.state=n.storage_data.muted?1:0;break;case"continueButton":this.continueButton=n.viewManager.addButton(this.layout.ui.continueButton).addTo(this.uiContainer),this.continueButton.on("button-on-click",this.onContinueButtonClick.bind(this));break;case"restartButton":this.restartButton=n.viewManager.addButton(this.layout.ui.restartButton).addTo(this.uiContainer),this.restartButton.on("button-on-click",this.onRestartButtonClick.bind(this));break;case"previousButton":break;case"nextButton":}},s.prototype.animateBoardIn=function(){var t=new TimelineMax({onComplete:function(){this.animatePageIn()},onCompleteScope:this});t.from(this.board,.3,{delay:.1,y:1800,ease:Cubic.easeOut},"start"),t.to(this.board.scale,.1,{delay:.2,y:1.1,repeat:1,yoyo:!0,ease:Sine.easeInOut},"start")},s.prototype.animateBoardOut=function(){var t=new TimelineMax;t.to(this.board.scale,.1,{y:1.1,repeat:1,yoyo:!0,ease:Sine.easeInOut},"start"),t.to(this.board,.4,{delay:.1,y:1800,ease:Cubic.easeOut},"start")},s.prototype.destroyUiElements=function(){for(var t=0;t<this.uiContainer.children.length;t++)this.uiContainer.children[t].doSeppuku&&this.uiContainer.children[t].doSeppuku();this.uiContainer.destroy(n.destroyOptions)},s.prototype.requestNextScene=function(){n.viewManager.hasHideTweens?(this.animateBoardOut(),this.screenDim&&this.screenDim.out(),this.popup&&this.popup.hide(),n.viewManager.hideTweensComplete.detachAll(),n.viewManager.hideTweensComplete.add(function(){this.runNextScene()},this),n.viewManager.runHideTweens()):this.runNextScene()},s.prototype.runNextScene=function(){this.signals.next.dispatch()},s.prototype.onRestartButtonClick=function(){},s.prototype.onContinueButtonClick=function(){this.requestNextScene()},s.prototype.onHomeButtonClick=function(){this.signals.previous.dispatch()},s.prototype.onSoundButtonClick=function(t){n.toggleMute("challengeWheelMusic"),t.state=n.storage_data.muted?1:0},s.prototype.onPreviousButtonClick=function(){this.currentPage--,this.currentPage<0&&(this.currentPage=this.pages.length-1),this.updatePage()},s.prototype.onNextButtonClick=function(){this.currentPage++,this.currentPage>this.pages.length-1&&(this.currentPage=0),this.updatePage()},s.prototype.showPagination=function(t){for(var e=0;e<4;e++)this["pagination"+e].alpha=t?0:1;for(e=0;e<4;e++)TweenMax.to(this["pagination"+e],.1+(t?.1:0),{delay:t?.07*e:0,alpha:t?1:0}),TweenMax.to(this["pagination"+e].scale,.15+(t?.1:0),{delay:t?.07*e:0,x:t?1:0,y:t?1:0,ease:Back.easeOut})},s.prototype.updatePage=function(){this.page.texture=this.pages[this.currentPage],this.page.tint=this.tints[this.currentPage],this.maskTL&&(this.maskTL.kill(),this.maskTL=null);var t=.5;this.maskTL=new TimelineMax({onStart:function(){this.roll.alpha=1,this.roll.visible=!0},onStartScope:this,onComplete:function(){this.roll.visible=!1},onCompleteScope:this}),this.maskTL.fromTo(this.maskSprite,t,{y:this.maskTopPos-this.maskSprite.height},{y:this.maskTopPos,ease:Cubic.easeInOut},"start"),this.maskTL.fromTo(this.roll,t,{y:this.topPos},{y:this.topPos+340,ease:Cubic.easeInOut},"start"),this.maskTL.fromTo(this.roll.scale,t,{x:1,y:1},{x:.9,y:0},"start"),this.maskTL.fromTo(this.roll,.1,{alpha:1},{delay:.4,alpha:0},"start");for(var e=0;e<4;e++)this["pagination"+e].texture=n.assetManager.getTexture("ui_pagination_off");this["pagination"+this.currentPage].texture=n.assetManager.getTexture("ui_pagination_on")},s.prototype.animatePageIn=function(){this.page.visible=!0,this.updatePage()},s.prototype.appear=function(){this.screenDim&&this.screenDim["in"](),this.setUiVisible(!1),n.viewManager.done=!1,n.viewManager.showTweensComplete.add(this.onShowTweensComplete.bind(this)),n.viewManager.setShowTweensTime(.005),this.setUiVisible(!0),n.viewManager.runShowTweens(),this.animateBoardIn()},s.prototype.setUiVisible=function(t){if(this.uiContainer)for(var e=0;e<this.uiContainer.children.length;e++)this.uiContainer.children[e].visible=t},s.prototype.pause=function(){this.interactive=!1,this.interactiveChildren=!1},s.prototype.resume=function(){n.viewManager.activeLayout="wheelPauseView",this.interactive=!0,this.interactiveChildren=!0},s.prototype.onShowTweensComplete=function(){n.viewManager.done=!0},s.prototype.destroy=function(){this.screenDim&&this.screenDim.out(),this.maskTL&&(this.maskTL.kill(),this.maskTL=null),this.popup&&this.popup.doSeppuku(),this.destroyUiElements(),this.pausedText.destroy(n.destroyAllOptions),p3.Scene.prototype.destroy.call(this)},s.prototype.update=function(){},s.prototype.resize=function(){this.x=Math.round((p3.View.width-n.STAGE_WIDTH)/2),this.screenDim&&(this.screenDim.resize(),this.screenDim.x=-this.x),n.viewManager.repositionDynElements()}},{"../../common":42,"../../help-text":92,"../../screendim/screendim":105}],39:[function(t,e,i){function s(t){p3.Scene.call(this),this.isBusy=!1,this.interactive=!0,this.interactiveChildren=!0;var e=n.assetManager.getJSON("wheelGameView");e.wheelGameView.carImage.texture=e.wheelGameView.carImage.texture.replaceAll("#CARCOLOR#",n.carColors[n.currentCar]),e.wheelGameView.wheelImage.texture=e.wheelGameView.wheelImage.texture.replaceAll("#CARCOLOR#",n.carColors[n.currentCar]),
n.viewManager.add(e),this.layout=n.viewManager.get(n.viewManager.activeLayout),this.stars=1,this.defaultWheelPos=new PIXI.Point(500,300),this.wheelPos={x:0,y:30,snap:50};var i=64;this.nutPos=[{x:0,y:-i},{x:+i,y:0},{x:0,y:+i},{x:-i,y:0}],this.tutPos=[{x:45,y:45},{x:58,y:58},{x:42,y:70},{x:30,y:54}],this.nutId=null,this.nutProgress=0,this.nutMax=n.config.challengesSetup.wheel.nutMax,this.isDown=!1,this.downPos=new PIXI.Point,this.inUseID=null,this.isWheelDown=!1,this.drillTween=null,this.isGameOver=!1,this.sparkPS=null,this.smokePS=null,this.bounceTL=null,this.preloadStuff()}var n=t("../../common"),o=t("../challenge-preloader"),a=t("../../loader/audio-loader"),r=t("./challenge-wheel-nut"),h=t("../challenge-spine"),l=t("../challenge-tutorial-hand-anims"),u=t("../challenge-tutorial-timer"),p={challengeStarReward1:{type:"sound",url:"sfx/challenges/shared/sfx_star_reward_1",soundId:"challengeStarReward1"},challengeStarReward2:{type:"sound",url:"sfx/challenges/shared/sfx_star_reward_2",soundId:"challengeStarReward2"},challengeStarReward3:{type:"sound",url:"sfx/challenges/shared/sfx_star_reward_3",soundId:"challengeStarReward3"},challengeFanfare:{type:"sound",url:"sfx/challenges/shared/sfx_minigame_complete_fanfare_00",soundId:"challengeFanfare"},challengeWheelGrab:{type:"sound",url:"sfx/challenges/wheel/sfx_wheel_grab",soundId:"challengeWheelGrab"},challengeWheelLockIn:{type:"sound",url:"sfx/challenges/wheel/sfx_wheel_lock_in_00",soundId:"challengeWheelLockIn"},challengeWheelBounce1:{type:"sound",url:"sfx/challenges/wheel/sfx_wheel_bounce1",soundId:"challengeWheelBounce1"},challengeWheelBounce2:{type:"sound",url:"sfx/challenges/wheel/sfx_wheel_bounce1",soundId:"challengeWheelBounce2"},challengeWheelBounce3:{type:"sound",url:"sfx/challenges/wheel/sfx_wheel_bounce1",soundId:"challengeWheelBounce3"},challengeWheelLock:{type:"sound",url:"sfx/challenges/wheel/sfx_wheelgun_start_normal_00",soundId:"challengeWheelLock"},challengeWheelUnlock:{type:"sound",url:"sfx/challenges/wheel/sfx_wheelgun_end_normal_00",soundId:"challengeWheelUnlock"},challengeWheelInUse:{type:"sound",url:"sfx/challenges/wheel/sfx_wheelgun_loop_normal_00",soundId:"challengeWheelInUse"},challengeWheelOvertight:{type:"sound",url:"sfx/challenges/wheel/sfx_wheelgun_loop_overtight_02",soundId:"challengeWheelOvertight"},challengeWheelMusic:{type:"sound",url:"music/challenges/wheel/music_challenge_wheel_00",soundId:"challengeWheelMusic"},challengeStart:{type:"sound",url:"music/challenges/shared/music_race_challenge_start_00",soundId:"challengeStart"},challengeEnd:{type:"sound",url:"music/challenges/shared/music_race_challenge_end_00",soundId:"challengeEnd"}},c=[{name:"screenBg",url:n.PATHS.IMAGES+"endgame_bg.jpg",destroyId:"screenBg"},{name:"selectAtlas",url:n.PATHS.IMAGES+"character/ui_vehicle_select_0.8x.json",destroyId:"ui_char_brown"},{name:"wheelBackground",url:n.PATHS.IMAGES+"challenges/wheel/challenge_wheel_bg.jpg",destroyId:"wheelBackground"},{name:"wheelAtlas0",url:n.PATHS.IMAGES+"challenges/wheel/challenge_wheel_atlas_0_1x.json",destroyId:"challenge_particle_smoke"},{name:"wheelAtlas1",url:n.PATHS.IMAGES+"challenges/wheel/challenge_wheel_atlas_1_1x.json",destroyId:"challenge_wheel_blue"},{name:"wheelSmokeParticles",url:n.PATHS.DATA+"particles/challenge_wheel_nut_smoke.json"},{name:"wheelSparkParticles",url:n.PATHS.DATA+"particles/challenge_wheel_nut_sparks.json"},{name:"tutorialHandSpine",url:n.PATHS.IMAGES+"tutorial/tutorial_hand.json",destroyId:"tutorialHandSpine_atlas_page_tutorial_hand"}];e.exports=s,s.prototype=Object.create(p3.Scene.prototype),s.prototype.constructor=s,s.prototype.preloadStuff=function(){n.memoryManager.resetLoader();for(var t in c)c[t].hasOwnProperty("destroyId")&&n.memoryManager.store("wheel",c[t].destroyId);for(t in p)p[t].hasOwnProperty("soundId")&&n.memoryManager.storeSound("wheel",p[t].soundId);this.audioLoader=new a(p,(!1)),this.audioLoader.start()},s.prototype.preloader=function(){return new o},s.prototype.load=function(){return c},s.prototype.init=function(){this.gameContainer=new WRE.Container({x:n.STAGE_WIDTH>>1,y:n.STAGE_HEIGHT>>1}).addTo(this),this.bgSprite=n.viewManager.addSprite(this.layout.backgroundImage).addTo(this.gameContainer),this.carSprite=n.viewManager.addSprite(this.layout.carImage).addTo(this.gameContainer),this.hubSprite=n.viewManager.addSprite(this.layout.hubImage).addTo(this.gameContainer),this.wheelSprite=n.viewManager.addSprite(this.layout.wheelImage).addTo(this.gameContainer),this.wheelSprite.x=this.defaultWheelPos.x,this.wheelSprite.y=this.defaultWheelPos.y,this.wheelSprite.responsive=!0,this.wheelSprite.on("pointerdown",this.onWheelDown,this),this.wheelSprite.on("pointermove",this.onWheelMove,this),this.wheelSprite.on("pointerup",this.onWheelUp,this);for(var t=0;t<4;t++)this["nut"+t+"Sprite"]=n.viewManager.addSprite(this.layout.nutImage).addTo(this.gameContainer),this["nut"+t+"Sprite"].x=this.wheelPos.x+this.nutPos[t].x,this["nut"+t+"Sprite"].y=this.wheelPos.y+this.nutPos[t].y,this["nut"+t+"Sprite"].id=t,this["nut"+t+"Sprite"].isValid=!0,this["nut"+t+"Sprite"].progress=0,this["nut"+t+"Sprite"].interactive=!0,this["nut"+t+"Sprite"].on("pointerdown",this.onNutDown,this),this["nut"+t+"Sprite"].on("pointerup",this.onNutUp,this),this["nut"+t+"Sprite"].on("pointerupoutside",this.onNutUp,this);this.particlesContainer=(new WRE.Container).addTo(this.gameContainer),this.initSparksParticles(),this.initSmokeParticles(),this.drillContainer=new WRE.Container({visible:!1}).addTo(this.gameContainer),this.drillShadow=n.viewManager.addSprite(this.layout.shadowImage).addTo(this.drillContainer),this.drillSprite=n.viewManager.addSprite(this.layout.drillImage).addTo(this.drillContainer),this.tutorialContainer=new WRE.Container({visible:!1,interactive:!1,interactiveChildren:!1}).addTo(this),this.tutorialSpine=new h("tutorialHandSpine",l).addTo(this.tutorialContainer),this.timer=new u,this.timer.onComplete.add(this.playTutorial,this),this.layout.ui&&(this.uiContainer=(new WRE.Container).addTo(this),this.initUiElements())},s.prototype.playTutorial=function(t){var e="undefined"!=typeof t?t:1;this.tutorialContainer.visible=!0,this.tutorialSpine.x=this.gameContainer.x+this.wheelSprite.x,this.tutorialSpine.y=this.gameContainer.y+this.wheelSprite.y,this.tutorialSpine.play(["tap"],1!==e),this.tutorialSpine.time=0,TweenMax.to(this.tutorialSpine,this.tutorialSpine.duration-.1,{x:984,y:466,ease:Cubic.easeOut}),window.delay(function(){this.tutorialContainer&&(this.tutorialContainer.visible=!1),this.timer&&this.timer.start()},this.tutorialSpine.duration*e,this)},s.prototype.playTutorial2=function(){this.timer.maxTime=1e4,this.tutorialContainer.visible=!0;for(var t=0;t<4&&this["nut"+t+"Sprite"].texture!==n.assetManager.getTexture("challenge_wheel_nut");t++);4!==t&&(this.tutorialSpine.x=this.gameContainer.x+this["nut"+t+"Sprite"].x+this.tutPos[t].x,this.tutorialSpine.y=this.gameContainer.y+this["nut"+t+"Sprite"].y+this.tutPos[t].y,this.tutorialSpine.play(["tap"],!1),this.tutorialSpine.time=0,window.delay(function(){n.storage_data.tutorial[6]=1,n.storage.save(),this.tutorialContainer&&(this.tutorialContainer.visible=!1),this.timer&&this.timer.start()},this.tutorialSpine.duration,this))},s.prototype.initUiElements=function(){for(var t in this.layout.ui)switch(t){case"scoreBar":this.scoreBar=n.viewManager.addSprite(this.layout.ui.scoreBar).addTo(this.uiContainer);for(var e=0;e<4;e++)this["progressNut"+e]=new r(90*e-135,0).addTo(this.scoreBar);break;case"pauseButton":this.pauseButton=n.viewManager.addButton(this.layout.ui.pauseButton).addTo(this.uiContainer),this.pauseButton.on("button-on-click",this.onPauseButtonClick.bind(this))}},s.prototype.initSparksParticles=function(){this.sparkPS=new PIXI.particles.Emitter(this.particlesContainer,[n.assetManager.getTexture("challenge_particle_spark")],n.assetManager.getJSON("wheelSparkParticles")),this.sparkPS.updateSpawnPos(0,0),this.sparkPS.emit=!1},s.prototype.initSmokeParticles=function(){this.smokePS=new PIXI.particles.Emitter(this.particlesContainer,[n.assetManager.getTexture("challenge_particle_smoke")],n.assetManager.getJSON("wheelSmokeParticles")),this.smokePS.updateSpawnPos(0,0),this.smokePS.emit=!1},s.prototype.onSoundButtonClick=function(t){n.toggleMute(),t.state=n.storage_data.muted?1:0},s.prototype.onPauseButtonClick=function(){this.signals.pause.dispatch()},s.prototype.distance=function(t,e,i,s){var n=t-i,o=e-s;return Math.sqrt(n*n+o*o)},s.prototype.onWheelDown=function(t){this.isWheelDown||(this.bounceTL&&(this.bounceTL.kill(),this.bounceTL=null),n.audio.play("challengeWheelGrab"),this.isWheelDown=!0,this.downPos.x=this.gameContainer.toLocal(t.data.global).x,this.downPos.y=this.gameContainer.toLocal(t.data.global).y)},s.prototype.onWheelMove=function(t){if(this.isWheelDown){this.timer.reset(),this.wheelSprite.x=this.gameContainer.toLocal(t.data.global).x,this.wheelSprite.y=this.gameContainer.toLocal(t.data.global).y;var e=1;this.wheelSprite.x>this.downPos.x&&(e=-1),this.wheelSprite.rotation+=e*this.distance(this.wheelSprite.x,this.wheelSprite.y,this.downPos.x,this.downPos.y)*1e-5,this.distance(this.wheelSprite.x,this.wheelSprite.y,this.wheelPos.x,this.wheelPos.y)<this.wheelPos.snap&&(this.onWheelUp(),n.audio.play("challengeWheelLockIn"),this.scoreBar.visible=!0,TweenMax.from(this.scoreBar,.5,{y:-100,ease:Back.easeOut}),this.wheelSprite.responsive=!1,this.wheelSprite.x=this.wheelPos.x,this.wheelSprite.y=this.wheelPos.y,TweenMax.to(this.wheelSprite,.68,{rotation:0}),TweenMax.to(this.gameContainer.scale,.7,{x:1.23,y:1.23,ease:Back.easeOut,onComplete:function(){this.nut0Sprite.visible=!0,this.nut1Sprite.visible=!0,this.nut2Sprite.visible=!0,this.nut3Sprite.visible=!0,this.drillContainer.alpha=n.config.challengesSetup.wheel.gunGhostOpacity,this.drillContainer.visible=!0,this.drillContainer.x=this.nut1Sprite.x+n.config.challengesSetup.wheel.gunToNutDistance.x,this.drillContainer.y=this.nut1Sprite.y+n.config.challengesSetup.wheel.gunToNutDistance.y,this.timer.maxTime=2e3,this.timer.start(),this.timer.onComplete.detachAll(),this.timer.onComplete.add(this.playTutorial2,this)},onCompleteScope:this}))}},s.prototype.onWheelUp=function(){this.isWheelDown&&(this.isWheelDown=!1,this.distance(this.wheelSprite.x,this.wheelSprite.y,this.wheelPos.x,this.wheelPos.y)<this.wheelPos.snap||(this.bounceTL&&(this.bounceTL.kill(),this.bounceTL=null),this.bounceTL=new TimelineMax,this.bounceTL.to(this.wheelSprite,1,{y:this.defaultWheelPos.y,ease:Bounce.easeOut}),n.animator.setTimeout(function(){n.audio.play(["challengeWheelBounce1","challengeWheelBounce2","challengeWheelBounce3"])},.4,this),n.animator.setTimeout(function(){n.audio.play(["challengeWheelBounce1","challengeWheelBounce2","challengeWheelBounce3"])},.7,this),n.animator.setTimeout(function(){n.audio.play(["challengeWheelBounce1","challengeWheelBounce2","challengeWheelBounce3"])},.9,this)))},s.prototype.onNutDown=function(t){this.isBusy||(this.isDown=!0,this.timer.reset(),n.audio.play("challengeWheelLock"),this.nutId=t.target.id,this.nutProgress=this["nut"+this.nutId+"Sprite"].progress,this.drillContainer.x=this["nut"+this.nutId+"Sprite"].x,this.drillContainer.y=this["nut"+this.nutId+"Sprite"].y,this.drillContainer.visible=!0,this.drillTween&&this.drillTween.kill(),this.drillTween=TweenMax.from(this.drillContainer.position,.1,{x:this.drillContainer.x+n.config.challengesSetup.wheel.gunToNutDistance.x,y:this.drillContainer.y+n.config.challengesSetup.wheel.gunToNutDistance.y,ease:Cubic.easeIn},"start"),this.drillTween=TweenMax.to(this.drillContainer,.1,{alpha:1},"start"),this.sparkPS&&(this.sparkPS.cleanup(),this.sparkPS.updateSpawnPos(this["nut"+this.nutId+"Sprite"].x,this["nut"+this.nutId+"Sprite"].y),this.sparkPS.resetPositionTracking(),this.sparkPS.emit=!0))},s.prototype.onNutUp=function(t,e){if(null!==this.nutId){this.isDown=!1,this.timer.reset(),null!==this.inUseID&&(n.audio.stop(this.inUseID),this.inUseID=null),n.audio.play("challengeWheelUnlock"),this["nut"+this.nutId+"Sprite"].progress=this.nutProgress,this.nutProgress>=1&&(this["nut"+this.nutId+"Sprite"].responsive=!1,this["progressNut"+this.nutId].isValid=!0);var i=e?.5:0;this.drillTween&&this.drillTween.kill(),e&&(this["progressNut"+this.nutId].isValid=!1,this.isBusy=!0,this.drillTween=TweenMax.to(this.drillContainer,i,{alpha:1,onUpdate:function(){this.drillSprite.rotation=10*(.075*Math.random()/4-.075/8)},onUpdateScope:this},"start")),this.drillTween=TweenMax.to(this.drillContainer.position,.1,{delay:i,x:this.drillContainer.x+n.config.challengesSetup.wheel.gunToNutDistance.x,y:this.drillContainer.y+n.config.challengesSetup.wheel.gunToNutDistance.y,ease:Cubic.easeOut},"start"),this.drillTween=TweenMax.to(this.drillContainer,.1,{delay:i,alpha:n.config.challengesSetup.wheel.gunGhostOpacity,onComplete:function(){0===n.config.challengesSetup.wheel.gunGhostOpacity&&(this.drillContainer.visible=!1),this.isBusy=!1},onCompleteScope:this},"start"),this.nutId=null,this.drillSprite.rotation=0,this.sparkPS.emit=!1}},s.prototype.appear=function(){n.memoryManager.free("game"),n.playMusic("challengeWheelMusic"),n.viewManager.runShowTweens(),n.audio.play("challengeStart"),0===n.storage_data.tutorial[6]?window.delay(function(){this.playTutorial()},1,this):this.timer.start()},s.prototype.pause=function(){this.interactive=!1,this.interactiveChildren=!1,this.isBusy=!0},s.prototype.resume=function(){n.viewManager.activeLayout="wheelGameView",this.interactive=!0,this.interactiveChildren=!0,this.isBusy=!1},s.prototype.runNextScene=function(){this.signals.next.dispatch(this.stars)},s.prototype.requestGameOver=function(){n.audio.play("challengeEnd"),null!==this.inUseID&&(n.audio.stop(this.inUseID),this.inUseID=null),n.animator.setTimeout(function(){n.viewManager.hasHideTweens?(n.viewManager.hideTweensComplete.detachAll(),n.viewManager.hideTweensComplete.add(function(){this.runNextScene()},this),n.viewManager.runHideTweens()):this.runNextScene()},1,this)},s.prototype.getValid=function(){for(var t=0,e=0;e<4;e++)this["nut"+e+"Sprite"].isValid&&t++;return t},s.prototype.checkGameOver=function(){for(var t=0,e=0;e<4;e++)this["nut"+e+"Sprite"].interactive===!1&&t++;if(4===t){this.isGameOver=!0;var i=this.getValid();i>1&&(this.stars=2),i>2&&(this.stars=3),this.requestGameOver()}},s.prototype.update=function(){this.sparkPS&&this.sparkPS.update(p3.Timestep.deltaTime),this.smokePS&&this.smokePS.update(p3.Timestep.deltaTime),this.timer&&this.timer.update(),this.tutorialContainer.visible&&this.tutorialSpine.update(p3.Timestep.deltaTime),n.paused||this.isBusy||(this.isDown&&(this.nutProgress+=n.config.challengesSetup.wheel.nutGain*PIXI.ticker.shared.deltaTime,this["progressNut"+this.nutId].angle=2*Math.PI*this.nutProgress,null===this.inUseID&&(this.inUseID=n.audio.play("challengeWheelInUse",{loop:!0})),this.drillSprite.rotation=.075*Math.random()/4-.075/8,this["nut"+this.nutId+"Sprite"].rotation+=n.config.challengesSetup.wheel.nutRotation,this.nutProgress>=.98&&(this.drillSprite.rotation*=10,this["nut"+this.nutId+"Sprite"].texture=n.assetManager.getTexture("challenge_wheel_nut_green")),this.nutProgress>=1&&(this["progressNut"+this.nutId].isValid=!0),this.nutProgress>=this.nutMax&&this["nut"+this.nutId+"Sprite"].isValid&&(n.audio.stopByName(n.PATHS.SOUNDS+p.challengeWheelInUse.url),this.inUseID=null,n.audio.play("challengeWheelOvertight"),this["nut"+this.nutId+"Sprite"].isValid=!1,this["nut"+this.nutId+"Sprite"].texture=n.assetManager.getTexture("challenge_wheel_nut_red"),this.smokePS.updateSpawnPos(this["nut"+this.nutId+"Sprite"].x,this["nut"+this.nutId+"Sprite"].y),this.smokePS.resetPositionTracking(),this.smokePS.emit=!0,n.animator.setTimeout(function(){this.smokePS.emit=!1},.5,this),this.onNutUp(void 0,!0))),this.isGameOver||this.checkGameOver())},s.prototype.destroy=function(){this.bounceTL&&(this.bounceTL.kill(),this.bounceTL=null),this.sparkPS&&(this.sparkPS.emit=!1,this.sparkPS.destroy()),this.smokePS&&(this.smokePS.emit=!1,this.smokePS.destroy());for(var t=0;t<4;t++)this["progressNut"+t].destroy();TweenMax.killAll(),this.tutorialSpine.doSeppuku(),this.timer.doSeppuku(),this.timer=null,p3.Scene.prototype.destroy.call(this)},s.prototype.resize=function(){this.x=Math.round((p3.View.width-n.STAGE_WIDTH)/2),n.currentSubScreen&&n.currentSubScreen.resize&&n.currentSubScreen.resize(),n.viewManager.repositionDynElements()}},{"../../common":42,"../../loader/audio-loader":97,"../challenge-preloader":11,"../challenge-spine":13,"../challenge-tutorial-hand-anims":14,"../challenge-tutorial-timer":15,"./challenge-wheel-nut":37}],40:[function(t,e,i){var s={setup:{ground:{closed:!1,depth:0,collisions:1,texFillPadding:1024,texFillSize:240,texGroundSize:144,texGroundDelta:.3,texWallSize:160,texWallDelta:.15,texWallAngle:36,texGroundEdgeSide:"none",data:""},platform:{closed:!1,depth:0,collisions:1,texFillPadding:98,texFillSize:240,texGroundSize:144,texGroundDelta:.3,texWallSize:160,texWallDelta:.15,texWallAngle:36,texGroundEdgeSide:"",data:""},hole:{closed:!1,depth:0,collisions:0,texFillPadding:1024,texFillSize:240,texGroundSize:144,texGroundDelta:.3,texWallSize:160,texWallDelta:.15,texWallAngle:36,texGroundEdgeSide:"none",data:""}},textures:{ground:{texFill:"level_fill",texGround:"level_ground",texGroundEdge:"level_ground_edge",texWall:""},platform:{texFill:"level_fill",texGround:"level_ground",texGroundEdge:"level_ground_edge",texWall:""},hole:{texFill:"",texGround:"",texGroundEdge:"",texWall:""}},data:[{type:"ground",points:[{x:0,y:0},{x:300,y:0},{x:600,y:0},{x:1e3,y:0}],bounds:[0,1e3]},{type:"ground",points:[{x:0,y:0},{x:300,y:0},{x:600,y:-250},{x:1e3,y:-250}],bounds:[0,1e3]},{type:"ground",points:[{x:0,y:-250},{x:300,y:-250},{x:600,y:-250},{x:1e3,y:-250}],bounds:[0,1e3]},{type:"ground",points:[{x:0,y:-250},{x:300,y:-250},{x:600,y:0},{x:1e3,y:0}],bounds:[0,1e3]},{type:"ground",points:[{x:0,y:0},{x:300,y:0},{x:600,y:-125},{x:1e3,y:-125}],bounds:[0,1e3]},{type:"ground",points:[{x:0,y:-125},{x:300,y:-125},{x:600,y:-125},{x:1e3,y:-125}],bounds:[0,1e3]},{type:"ground",points:[{x:0,y:-125},{x:300,y:-125},{x:600,y:0},{x:1e3,y:0}],bounds:[0,1e3]},{type:"ground",points:[{x:0,y:0},{x:300,y:0},{x:600,y:125},{x:1e3,y:125}],bounds:[0,1e3]},{type:"ground",points:[{x:0,y:125},{x:300,y:125},{x:600,y:125},{x:1e3,y:125}],bounds:[0,1e3]},{type:"ground",points:[{x:0,y:125},{x:300,y:125},{x:600,y:0},{x:1e3,y:0}],bounds:[0,1e3]},{type:"ground",points:[{x:0,y:0},{x:300,y:0},{x:600,y:250},{x:1e3,y:250}],bounds:[0,1e3]},{type:"ground",points:[{x:0,y:250},{x:300,y:250},{x:600,y:250},{x:1e3,y:250}],bounds:[0,1e3]},{type:"ground",points:[{x:0,y:250},{x:300,y:250},{x:600,y:0},{x:1e3,y:0}],bounds:[0,1e3]},{type:"ground",points:[{x:0,y:0},{x:300,y:0},{x:250,y:-62.5},{x:500,y:-62.5},{x:750,y:-62.5},{x:600,y:0},{x:1e3,y:0}],bounds:[0,1e3]},{type:"ground",points:[{x:0,y:0},{x:300,y:0},{x:250,y:62.5},{x:500,y:62.5},{x:750,y:62.5},{x:600,y:0},{x:1e3,y:0}],bounds:[0,1e3]},{type:"hole",points:[{x:0,y:0},{x:125,y:0},{x:125,y:0},{x:250,y:0}],bounds:[0,250]},{type:"hole",points:[{x:0,y:0},{x:250,y:0},{x:250,y:0},{x:500,y:0}],bounds:[0,500]},{type:"platform",points:[{x:0,y:0},{x:125,y:0},{x:125,y:0},{x:250,y:0}],bounds:[0,250]},{type:"platform",points:[{x:0,y:-125},{x:125,y:-125},{x:125,y:-125},{x:250,y:-125}],bounds:[0,250]},{type:"platform",points:[{x:0,y:-250},{x:125,y:-250},{x:125,y:-250},{x:250,y:-250}],bounds:[0,250]},{type:"platform",points:[{x:0,y:125},{x:125,y:125},{x:125,y:125},{x:250,y:125}],bounds:[0,250]},{type:"platform",points:[{x:0,y:250},{x:125,y:250},{x:125,y:250},{x:250,y:250}],bounds:[0,250]},{type:"platform",points:[{x:0,y:0},{x:250,y:0},{x:250,y:0},{x:500,y:0}],bounds:[0,500]},{type:"platform",points:[{x:0,y:-125},{x:200,y:-125},{x:250,y:-125},{x:500,y:-125}],bounds:[0,500]},{type:"platform",points:[{x:0,y:-250},{x:250,y:-250},{x:250,y:-250},{x:500,y:-250}],bounds:[0,500]},{type:"platform",points:[{x:0,y:125},{x:250,y:125},{x:250,y:125},{x:500,y:125}],bounds:[0,500]},{type:"platform",points:[{x:0,y:250},{x:250,y:250},{x:250,y:250},{x:500,y:250}],bounds:[0,500]}]};e.exports=s},{}],41:[function(t,e,i){e.exports=t("./chunks")},{"./chunks":40}],42:[function(t,e,i){var s={version:"0.9.9",storage:null,storage_data:null,isIE:!1,debugDraw:!1,gameParams:null,raceStarted:!1,pickableList:["powerup","challenge","challengeParticle"],lastPickedIdx:0,carColors:["pink","red","purple","yellow","brown","blue"],carSelect:[],powerups:["balloons","banana","bats","bowling_ball","bubbles","butterfly","nails","nitro","oil","smoke","spring"],currentCar:0,opponentsResults:[],currentLevel:0,raceMusicTrack:-1,playersPositions:[],playersSpeeds:[],challengeNames:["clean","cool","fuel","map","tyre","way","wheel"],gameChallengeNames:[],previousChallenge:"none",gamePowerups:[],challengeResults:[0,0,0,0,0,0,0],gameContent:null,spineStep:0,timeStep:0,spineSpeed:.001,availableMapPaths:[0,1,2],mapPaths:[],config:{},finishLine:0,repeat:0,results:{pickables:0},languages:{},chunks:{},pickablesDeltaVertical:0,pickablesDeltaParabola:0,chapter:0,level:0,speedMultiplier:1,powerupType:{time:1,invulnerability:2,superPickable:3},animator:null,assetManager:null,audio:null,language:null,viewManager:null,renderer:null,isWebGL:!1,canvas:null,stage:null,sceneManager:null,currentScreen:null,currentSubScreen:null,memoryManager:null,paused:!1,gameMusicID:null,gameMusicName:"",gameMusicFadeTime:.01,destroyOptions:{children:!0},destroyAllOptions:{children:!0,texture:!0,baseTexture:!0},UICONFIG:{PADDING:0,SPACING:0},STAGE_WIDTH:1900,STAGE_HEIGHT:768,TRANSITION_COLOR:0,TRANSITION_DURATION:1,PATHS:{SCRIPTS:"scripts/",DATA:"data/",IMAGES:"assets/images/",FONTS:"assets/fonts/",SOUNDS:"assets/sounds/",PARTICLES:"assets/particles/"}};s.toggleMute=function(t){s.storage_data.muted=!s.storage_data.muted,s.storage.save(),s.audio.mute=s.storage_data.muted,null!==s.gameMusicID&&(s.storage_data.muted?(Howler.volume(0),s.gameMusicName="",s.audio.stop(s.gameMusicID)):(Howler.volume(1),s.playMusic("undefined"!=typeof t?t:"gameMusic")))},s.destroyTextures=function(t){for(var e=0;e<t.length;e++){var i=s.assetManager.getTexture(t[e]);i.destroy(!0)}},s.playMusic=function(t){s.gameMusicName!==t&&(s.stopMusic(),s.animator.setTimeout(function(){s.gameMusicName=t,s.gameMusicID=s.audio.play(s.gameMusicName,{loop:!0}),s.fadeMusicIn(s.gameMusicID)},null!==s.gameMusicID?s.gameMusicFadeTime+.1:.1,this))},s.stopMusic=function(t){if(null!==s.gameMusicID){var e=s.gameMusicID;s.animator.setTimeout(function(){s.audio.stopAll(),s.gameMusicID=null,s.gameMusicName=""},"undefined"!=typeof t?t:s.gameMusicFadeTime,this),s.fadeMusicOut(e,t)}},s.fadeMusicIn=function(t){s.audio.fade(t,0,1,1e3*s.gameMusicFadeTime)},s.fadeMusicOut=function(t,e){s.audio.fade(t,1,0,"undefined"!=typeof e?e:1e3*s.gameMusicFadeTime)},s.reset=function(){s.raceStarted=!1,s.lastPickedIdx=0,s.playersPositions=[],s.challengeResults=[0,0,0,0,0,0,0]},s.randomizeLevel=function(){var t=s.currentLevel;do s.currentLevel=Math.floor(5*Math.random());while(t===s.currentLevel)},s.randomizeMusic=function(){var t=s.raceMusicTrack;do s.raceMusicTrack=WRE.randomIntInterval(0,5);while(t===s.raceMusicTrack)},e.exports=s},{}],43:[function(t,e,i){function s(){this.points=[],this.quadWidth=96,this.cacheDrawingPoints=!0,this._drawingPoints=null,this._drawingPointsNormals=null}t("../common");e.exports=s,s.prototype.addPoint=function(t,e,i){i?this.points.splice(i,0,{x:t,y:e}):this.points.push({x:t,y:e})},s.prototype.deletePoint=function(t){this.points.splice(t,1)},s.prototype.getFirstPoint=function(){return this.points[0]},s.prototype.getLastPoint=function(){return this.points[this.points.length-1]},s.prototype.getPenultimatePoint=function(){return this.points[this.points.length-2]},s.prototype.getWidth=function(){return this.getLastPoint().x-this.getFirstPoint().x},s.prototype.calculateBezierPoint=function(t,e,i,s,n){var o=1-t,a=t*t,r=o*o,h=r*o,l=a*t,u={x:h*e.x,y:h*e.y};return u.x+=3*r*t*i.x,u.y+=3*r*t*i.y,u.x+=3*o*a*s.x,u.y+=3*o*a*s.y,u.x+=l*n.x,u.y+=l*n.y,u},s.prototype.getDrawingPoints=function(){this._drawingPoints=[];for(var t=0;t<this.points.length-3;t+=3){var e=this.points[t],i=this.points[t+1],s=this.points[t+2],n=this.points[t+3],o=Math.sqrt(Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2)),a=Math.ceil(o/this.quadWidth);0==t&&this._drawingPoints.push(this.calculateBezierPoint(0,e,i,s,n));for(var r=1;r<=a;r++){var h=r/a;this._drawingPoints.push(this.calculateBezierPoint(h,e,i,s,n))}}return this._drawingPoints},s.prototype.getDrawingPointsNormals=function(){var t=this.getDrawingPoints();this._drawingPointsNormals=[];for(var e=1;e<t.length-1;e++){var i=t[e-1],s=t[e+1],n={x:s.x-i.x,y:s.y-i.y},o={x:-n.y,y:n.x},a=Math.sqrt(o.x*o.x+o.y*o.y),r={x:o.x/a,y:o.y/a};this._drawingPointsNormals[e]=r}return this._drawingPointsNormals[0]={x:0,y:1},this._drawingPointsNormals[t.length-1]={x:0,y:1},this._drawingPointsNormals},s.prototype.getGroundSegments=function(t,e){for(var i=[],s=null,n=this.getDrawingPoints(),o=this.getDrawingPointsNormals(),a=0;a<n.length-1;a++){var r=Math.abs(Math.atan2(n[a+1].y-n[a].y,n[a+1].x-n[a].x)*PIXI.RAD_TO_DEG);if(r<t||r>e){if(null==s)continue;i.push(s),s=null}else null==s&&(s={points:[n[a]],normals:[o[a]]}),s.points.push(n[a+1]),s.normals.push(o[a+1])}null!=s&&i.push(s);for(var a=0;a<i.length;a++)i[a].normals.length>2&&(i[a].normals[0]=i[a].normals[1],i[a].normals[i[a].normals.length-1]=i[a].normals[i[a].normals.length-2]);return i}},{"../common":42}],44:[function(t,e,i){function s(){PIXI.Container.call(this),this.assetManager=p3.AssetManager.instance,this.levels=[],this.level=null,this.snapGrid=16,this.grid=null,this.cmb=!1,this.panMousePosition=null,this.zoomLevels=[.025,.05,.125,.25,.333,.5,.666,1,2,3,4,5,6,8],this.config=this.assetManager.getJSON("editorConfig");for(var t=33,t=33,e=0;e<this.config.objects.length;e++){var i=new PIXI.Sprite(this.assetManager.getTexture(this.config.objects[e].texture)),s=Math.min(1/(i.width/t),1/(i.height/t)),o=PIXI.RenderTexture.create(t,t),a=new PIXI.Matrix;a.translate(i.width<i.height?(i.height-i.width)/2:1,i.height<i.width?(i.width-i.height)/2:1),a.scale(s,s),n.renderer.render(i,o,!0,a),this.config.objects[e].textureBase64=n.renderer.extract.base64(o)}this.history=[],this.historyIndex=0,this.gui={selector:"#controls",levelTemplate:_.template($("#template-level").html(),{variable:"editor"}),layerTemplate:_.template($("#template-layer").html(),{variable:"editor"}),pathTemplate:_.template($("#template-path").html(),{variable:"editor"}),objectTemplate:_.template($("#template-object").html(),{variable:"editor"})}}var n=t("../common"),o=t("../editor/Level");t("../editor/LevelLayer");e.exports=s,s.prototype=Object.create(PIXI.Container.prototype),s.prototype.constructor=s,s.prototype.init=function(){this.titleContainer=new PIXI.Container,this.titleContainer.x=0,this.titleContainer.y=0,this.addChild(this.titleContainer),this.title=new PIXI.Text("",{fontFamily:"Arial",fontSize:36,fill:16777215,align:"left"}),this.title.anchor.set(0,0),this.title.alpha=.5,this.titleContainer.addChild(this.title),this.levelContainer=new PIXI.Container,this.addChildAt(this.levelContainer,0),this.renderGrid(),this.newLevel(),document.addEventListener("mousewheel",function(t){0!=$("#canvas:hover").length&&this.zoomDelta(Math.sign(t.wheelDelta))}.bind(this),!1),$("body").on("click",".level_new",function(t){this.newLevel()}.bind(this)),$("body").on("click",".level_export",function(t){this["export"]()}.bind(this)),$("body").on("click",".level_import",function(t){this.load($("textarea[name=level_import_text]").val())}.bind(this)),$("body").on("click",".level_image",function(t){var e=this.level.toImage();if(e){var i=window.open(e,"level_image");i.focus()}}.bind(this)),$("body").on("click",".level_debug, #play",function(t){this.playLevel()}.bind(this)),$("body").on("change","input[name=level_name]",function(t){this.level.setName($(t.currentTarget).val()),$("textarea[name=level_import_text]").val(JSON.stringify(this.level["export"]()))}.bind(this)),$("body").on("click",".new_layer",function(t){this.level.newLayer()}.bind(this)),$("body").on("click",".edit_layer",function(t){var e=parseInt($(t.currentTarget).attr("data-index"));this.level.selectLayer(this.level.getLayerAtIndex(e))}.bind(this)),$("body").on("click",".back",function(t){this.back()}.bind(this)),$("body").on("change","input[name=layer_name]",function(t){this.level.layer.setName($(t.currentTarget).val())}.bind(this)),$("body").on("click",".delete_layer",function(t){this.level.deleteLayer(this.level.layer),this.back()}.bind(this)),$("body").on("change","input[name=layer_depth]",function(t){this.level.layer.setDepth(parseInt($(t.currentTarget).val())),this.render()}.bind(this)),$("body").on("change","input[name=layer_parallax]",function(t){this.level.layer.setParallax(parseFloat($(t.currentTarget).val())),this.render()}.bind(this)),$("body").on("click",".objects li:not(.selected)",function(t){$(".objects li.selected").removeClass("selected"),this.level.layer.setIdObject($(t.currentTarget).attr("data-id")),$(t.currentTarget).addClass("selected")}.bind(this)),$("body").on("change","select[name=path_open]",function(t){this.level.layer.selected.setConfig("closed",!parseInt($(t.currentTarget).val()),"change"==t.type),this.render()}.bind(this)),$("body").on("click",".delete_path",function(t){this.level.layer.deletePath(this.level.layer.selected),this.back()}.bind(this)),$("body").on("click",".clone_path",function(t){this.level.layer.clonePath(this.level.layer.selected)}.bind(this)),$("body").on("click",".flip_h_path",function(t){this.level.layer.selected.flipH(),this.render()}.bind(this)),$("body").on("click",".flip_v_path",function(t){this.level.layer.selected.flipV(),this.render()}.bind(this)),$("body").on("change","input[name=path_depth], input[name=object_depth]",function(t){this.level.layer.setSelectedDepth(parseInt($(t.currentTarget).val())),this.render()}.bind(this)),$("body").on("change","select[name=path_collisions]",function(t){this.level.layer.selected.setConfig("collisions",parseInt($(t.currentTarget).val()),"change"==t.type)}.bind(this)),$("body").on("change input","input[name=path_texture_walls_angle]",function(t){this.level.layer.selected.setConfig("texWallAngle",parseInt($(t.currentTarget).val()),"change"==t.type),this.level.layer.selected.render()}.bind(this)),$("body").on("change input","input[name=path_texture_fill_size]",function(t){this.level.layer.selected.setConfig("texFillSize",parseInt($(t.currentTarget).val()),"change"==t.type),this.level.layer.selected.render()}.bind(this)),$("body").on("change input","input[name=path_texture_fill_padding]",function(t){this.level.layer.selected.setConfig("texFillPadding",parseInt($(t.currentTarget).val()),"change"==t.type),this.level.layer.selected.render()}.bind(this)),$("body").on("change input","input[name=path_texture_ground_size]",function(t){this.level.layer.selected.setConfig("texGroundSize",parseInt($(t.currentTarget).val()),"change"==t.type),this.level.layer.selected.render()}.bind(this)),$("body").on("change input","input[name=path_texture_ground_delta]",function(t){this.level.layer.selected.setConfig("texGroundDelta",parseFloat($(t.currentTarget).val()),"change"==t.type),this.level.layer.selected.render()}.bind(this)),$("body").on("change input","input[name=path_texture_walls_size]",function(t){this.level.layer.selected.setConfig("texWallSize",parseInt($(t.currentTarget).val()),"change"==t.type),this.level.layer.selected.render()}.bind(this)),$("body").on("change input","input[name=path_texture_walls_delta]",function(t){this.level.layer.selected.setConfig("texWallDelta",parseFloat($(t.currentTarget).val()),"change"==t.type),this.level.layer.selected.render()}.bind(this)),$("body").on("change","select[name=path_texture_fill]",function(t){this.level.layer.selected.setConfig("texFill",$(t.currentTarget).val(),"change"==t.type),this.level.layer.selected.render()}.bind(this)),$("body").on("change","select[name=path_texture_ground]",function(t){this.level.layer.selected.setConfig("texGround",$(t.currentTarget).val(),"change"==t.type),this.level.layer.selected.render();
}.bind(this)),$("body").on("change","select[name=path_texture_ground_edge]",function(t){this.level.layer.selected.setConfig("texGroundEdge",$(t.currentTarget).val(),"change"==t.type),this.level.layer.selected.render()}.bind(this)),$("body").on("change","select[name=path_texture_ground_edge_side]",function(t){this.level.layer.selected.setConfig("texGroundEdgeSide",$(t.currentTarget).val(),"change"==t.type),this.level.layer.selected.render()}.bind(this)),$("body").on("change","select[name=path_texture_wall]",function(t){this.level.layer.selected.setConfig("texWall",$(t.currentTarget).val(),"change"==t.type),this.level.layer.selected.render()}.bind(this)),$("body").on("change input","textarea[name=path_data], textarea[name=object_data]",function(t){this.level.layer.selected.setConfig("data",$(t.currentTarget).val(),"change"==t.type)}.bind(this)),$("body").on("change","select[name=move_path_to_layer]",function(t){var e=this.level.getLayerAtIndex($(t.currentTarget).val());e.adoptPath(this.level.layer.selected),this.level.layer.selected.render()}.bind(this)),$("body").on("click",".delete_object",function(t){this.level.layer.deleteObject(this.level.layer.selected),this.back()}.bind(this)),$("body").on("change input","input[name=object_scale]",function(t){this.level.layer.selected.setScale(parseFloat($(t.currentTarget).val()),"change"==t.type)}.bind(this)),$("body").on("change input","input[name=object_rotation]",function(t){this.level.layer.selected.setRotation(parseFloat($(t.currentTarget).val()),"change"==t.type)}.bind(this)),$("body").on("change input","input[name=object_flip_x]",function(t){this.level.layer.selected.setFlipX(parseInt($(t.currentTarget).val()),"change"==t.type)}.bind(this)),$("body").on("change","input[type=range]",function(t){$(this).blur()}),n.storage_data.levelDebug&&($("textarea[name=level_import_text]").val(n.storage_data.levelDebug),this.load($("textarea[name=level_import_text]").val())),n.canvas.signals.resize.removeAll(),n.canvas.signals.resize.add(this.onCanvasResize,this),this.onCanvasResize()},s.prototype.update=function(){this.mouse.centerPressed?this.cmb?(this.level.x+=(this.mouse.position.x-this.panMousePosition.x)*(1/this.zoom),this.level.y+=(this.mouse.position.y-this.panMousePosition.y)*(1/this.zoom),this.panMousePosition=new PIXI.Point(this.mouse.position.x,this.mouse.position.y),this.updateGridPosition()):(this.cmb=!0,this.panMousePosition=new PIXI.Point(this.mouse.position.x,this.mouse.position.y)):this.cmb&&(this.cmb=!1),null!=this.level&&(n.keyboard.getKeyJustPressed([n.keyboard.KEY_CTRL,n.keyboard.KEY_Z,n.keyboard.KEY_SHIFT])?this.historyRedo():n.keyboard.getKeyJustPressed([n.keyboard.KEY_CTRL,n.keyboard.KEY_Z])?this.historyUndo():n.keyboard.getKeyJustPressed([n.keyboard.KEY_F2])&&this.playLevel(),this.level.update())},s.prototype.render=function(){null!=this.level&&(this.level.render(),this.level.renderGUI())},s.prototype.getMousePosition=function(){return new PIXI.Point(n.STAGE_WIDTH/2+(this.mouse.position.x-n.STAGE_WIDTH/2)/this.zoom-this.level.x,n.STAGE_HEIGHT/2+(this.mouse.position.y-n.STAGE_HEIGHT/2)/this.zoom-this.level.y)},s.prototype.zoomDelta=function(t){var t=Math.sign(t),e=this.zoomLevels.indexOf(this.zoom);if(!(t==-1&&e<=0||1==t&&e>=this.zoomLevels.length-1)){var i=n.STAGE_WIDTH*this.zoom,s=n.STAGE_HEIGHT*this.zoom;this.zoom=this.zoomLevels[e+t];var o=n.STAGE_WIDTH*this.zoom,a=n.STAGE_HEIGHT*this.zoom;this.levelContainer.x+=(i-o)/2,this.levelContainer.y+=(s-a)/2,this.updateGridPosition()}},s.prototype.renderGUI=function(t){switch(t){case"level":var e=this.gui.levelTemplate(this);break;case"layer":var e=this.gui.layerTemplate(this);break;case"path":var e=this.gui.pathTemplate(this);break;case"object":var e=this.gui.objectTemplate(this);break;default:console.error("GUI level not found")}$(this.gui.selector).html(e)},s.prototype.back=function(){this.level&&(this.level.back(),this.render())},s.prototype.renderGrid=function(){var t=this.snapGrid*this.zoom;if(t<10)return void(this.grid.visible=!1);var e=document.createElement("canvas");e.width=t,e.height=t;var i=e.getContext("2d");i.beginPath(),i.strokeStyle="#666666",i.lineWidth=1,i.moveTo(.5,0),i.lineTo(.5,e.height),i.moveTo(0,e.height-.5),i.lineTo(e.width,e.height-.5),i.stroke();var s=PIXI.Texture.fromCanvas(e,PIXI.SCALE_MODES.NEAREST);s.baseTexture.mipmap=!1,this.grid?this.grid.texture=s:(this.grid=new PIXI.extras.TilingSprite(s,e.width,e.height),this.grid.alpha=.3,this.addChildAt(this.grid,0)),this.updateGridPosition(),this.grid.visible=!0},s.prototype.updateGridPosition=function(){this.grid.width=n.renderer.width,this.grid.height=n.renderer.height,this.grid.tilePosition.x=Math.round(((this.level?this.level.x:0)+this.levelContainer.x/this.zoom)%this.snapGrid*this.zoom),this.grid.tilePosition.y=Math.round(((this.level?this.level.y:0)+this.levelContainer.y/this.zoom)%this.snapGrid*this.zoom)},s.prototype.newLevel=function(){null!=this.level&&this.levelContainer.removeChild(this.level);var t=new o(this);this.level=t,this.level.init(),this.levels.push(t),this.levelContainer.addChild(this.level),this.render(),this.updateGridPosition(),this.historyReset()},s.prototype.getObject=function(t){for(var e=0;e<this.config.objects.length;e++)if(this.config.objects[e].id==t)return this.config.objects[e];return null},s.prototype.load=function(t){var e=JSON.parse(t);this.newLevel(),this.level["import"](e),this.render()},s.prototype["import"]=function(){$("#level_import").replaceWith($("#level_import").val("").clone(!0)),$("#level_import").trigger("click")},s.prototype["export"]=function(){var t=JSON.stringify(this.level["export"]()),e=this.level.name+"_"+Math.floor(Date.now()/1e3)+".json",i=document.createElement("a");i.setAttribute("href","data:application/json;charset=utf-8,"+encodeURIComponent(t)),i.setAttribute("download",e),i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i)},s.prototype.playLevel=function(){n.storage_data.levelDebug=JSON.stringify(this.level["export"]()),n.storage.save();var t=window.open("index.html","level_debug");t.focus()},s.prototype.historyReset=function(){console.info("Resetting history"),this.history=[JSON.stringify(this.level["export"]())],this.historyIndex=0},s.prototype.historyAddState=function(){var t=JSON.stringify(this.level["export"]());this.historyIndex<this.history.length-1&&this.history.splice(this.historyIndex+1,1e4),t!=this.history[this.history.length-1]&&(this.history.push(t),this.historyIndex++)},s.prototype.historyUndo=function(){0!=this.historyIndex&&(this.historyIndex--,console.info("Undo state %i",this.historyIndex),this.historyRestore())},s.prototype.historyRedo=function(){this.historyIndex!=this.history.length-1&&(this.historyIndex++,console.info("Redo state %i",this.historyIndex),this.historyRestore())},s.prototype.historyRestore=function(){this.level.reset(),this.level["import"](JSON.parse(this.history[this.historyIndex])),this.render()},s.prototype.onCanvasResize=function(){n.renderer.view.style.width=window.innerWidth+"px",n.renderer.view.style.height=window.innerHeight+"px",n.renderer.resize(window.innerWidth,window.innerHeight),this.updateGridPosition()},Object.defineProperty(s.prototype,"zoom",{get:function(){return this.levelContainer.scale.x},set:function(t){this.zoom!=t&&(this.levelContainer.scale.set(t),this.level.layer?this.level.render():this.level.renderDot(),this.renderGrid())}})},{"../common":42,"../editor/Level":45,"../editor/LevelLayer":46}],45:[function(t,e,i){function s(t){this.editor=t,this.name="New level",this.layers=[],this.layer=null,this.lmb=!1,this.rmb=!1,this.dragMovement=null,PIXI.Container.call(this)}var n=t("../common"),o=(t("../editor/Editor"),t("../editor/LevelLayer"));e.exports=s,s.prototype=Object.create(PIXI.Container.prototype),s.prototype.constructor=s,s.prototype.init=function(){this.reset(),this.x=n.STAGE_WIDTH/4,this.y=n.STAGE_HEIGHT/2},s.prototype.reset=function(){this.removeChildren(),this.startingPoint||(this.startingPoint=new PIXI.Graphics,this.startingPoint.beginFill(65280),this.startingPoint.drawCircle(0,0,5),this.startingPoint.endFill()),this.addChild(this.startingPoint),this.layers=[],this.layer=null},s.prototype.update=function(){if(null!=this.layer)this.layer.update();else if(this.editor.mouse.rightPressed){this.editor.getMousePosition();if(this.rmb){var t=this.editor.mouse.movement;t.multiply(1/this.editor.zoom);for(var e=0;e<this.layers.length;e++)this.layers[e].moveAll(new PIXI.Point(-Math.round(this.dragMovement.x/this.editor.snapGrid)*this.editor.snapGrid,-Math.round(this.dragMovement.y/this.editor.snapGrid)*this.editor.snapGrid));this.dragMovement.x+=t.x,this.dragMovement.y+=t.y;for(var e=0;e<this.layers.length;e++)this.layers[e].moveAll(new PIXI.Point(Math.round(this.dragMovement.x/this.editor.snapGrid)*this.editor.snapGrid,Math.round(this.dragMovement.y/this.editor.snapGrid)*this.editor.snapGrid)),this.layers[e].render()}else this.rmb=!0,this.dragMovement=new PIXI.Point(0,0)}else this.rmb&&(this.rmb=!1,this.renderGUI(),this.editor.historyAddState())},s.prototype.renderDot=function(){this.startingPoint.scale.set(1/this.editor.zoom),this.addChild(this.startingPoint)},s.prototype.render=function(){this.renderDot();for(var t=0;t<this.layers.length;t++)this.layers[t].render()},s.prototype.renderGUI=function(){this.editor.title.text="",this.layer?this.layer.renderGUI():this.editor.renderGUI("level")},s.prototype.back=function(){this.layer&&this.layer.back()},s.prototype.newLayer=function(t){this.layer=new o(this,t),this.layers.push(this.layer),this.layer.init(),this.addChild(this.layer),this.selectLayer(this.layer),this.editor.historyAddState()},s.prototype.deleteLayer=function(t){var e=this.layers.indexOf(t);e>-1&&(this.removeChild(this.layers[e]),this.layers.splice(e,1),this.editor.historyAddState())},s.prototype.selectLayer=function(t){this.layer=t,this.render(),this.renderGUI()},s.prototype.getLayerAtIndex=function(t){return this.layers[t]?this.layers[t]:null},s.prototype["export"]=function(){for(var t={name:this.name,layers:[],length:this.getLength()},e=0;e<this.layers.length;e++)t.layers.push(this.layers[e]["export"]());return t},s.prototype.getLength=function(){for(var t=0;t<this.layers.length;t++)for(var e=0;e<this.layers[t].objects.length;e++)if("level_end"==this.layers[t].objects[e].config.id)return Math.round(this.layers[t].objects[e].x-this.layers[t].objects[e].width);return 0},s.prototype.getBounds=function(){for(var t=0,e=0,i=0,s=0,n=0;n<this.layers.length;n++)for(var o=0;o<this.layers[n].paths.length;o++)for(var a=0;a<this.layers[n].paths[o].bezier.points.length;a++)this.layers[n].paths[o].bezier.points[a].x<t?t=this.layers[n].paths[o].bezier.points[a].x:this.layers[n].paths[o].bezier.points[a].x>e&&(e=this.layers[n].paths[o].bezier.points[a].x),this.layers[n].paths[o].bezier.points[a].y<i?i=this.layers[n].paths[o].bezier.points[a].y:this.layers[n].paths[o].bezier.points[a].y>s&&(s=this.layers[n].paths[o].bezier.points[a].y);return[t,i,e,s]},s.prototype.setName=function(t){t=$.trim(t),""!=t&&(this.name=t,this.editor.historyAddState())},s.prototype["import"]=function(t){this.name=t.name;for(var e=0;e<t.layers.length;e++){var i=new o(this,"");i["import"](t.layers[e]),this.layers.push(i),this.addChild(i)}},s.prototype.toImage=function(){var t=this.getBounds();if(t[2]!=t[0]){t[0]-=128,t[1]-=256,t[2]+=128,t[3]+=256;var e=t[2]-t[0],i=t[3]-t[1],s=1,o=PIXI.RenderTexture.create(e*s,i*s),a=new PIXI.Matrix;a.translate(-t[0]-this.x,-t[1]-this.y),n.renderer.render(this,o,!0,a);var r=n.renderer.extract.base64(o);return console.log(r),r}}},{"../common":42,"../editor/Editor":44,"../editor/LevelLayer":46}],46:[function(t,e,i){function s(t,e){this.editor=t.editor,this.level=t,this.name=e?e:"New layer #"+(this.level.layers.length+1),this.paths=[],this.objects=[],this.depth=0,this.parallax=0,this.idObject="",this.selected=null,this.lmb=!1,this.rmb=!1,this.dragMovement=null,PIXI.Container.call(this)}var n=(t("../common"),t("../editor/Editor"),t("../editor/Level"),t("../editor/LevelPath")),o=t("../editor/LevelObject");e.exports=s,s.prototype=Object.create(PIXI.Container.prototype),s.prototype.constructor=s,s.prototype.init=function(){},s.prototype.update=function(){if(null!=this.selected)this.selected.update();else{if(this.editor.mouse.leftPressed){var t=this.editor.getMousePosition();if(!this.lmb){this.lmb=!0;var e=this.getObjectAtPoint(t);if(null!=e)this.selectObject(e);else{var i=this.getPathAtPoint(t,50);null!=i?this.selectObject(i):""==this.idObject?this.newPath(t):this.newObject(this.idObject,t)}}}else this.lmb&&(this.lmb=!1);if(this.editor.mouse.rightPressed){var t=this.editor.getMousePosition();if(this.rmb){var s=this.editor.mouse.movement;s.multiply(1/this.editor.zoom),this.moveAll(new PIXI.Point(-Math.round(this.dragMovement.x/this.editor.snapGrid)*this.editor.snapGrid,-Math.round(this.dragMovement.y/this.editor.snapGrid)*this.editor.snapGrid)),this.dragMovement.x+=s.x,this.dragMovement.y+=s.y,this.moveAll(new PIXI.Point(Math.round(this.dragMovement.x/this.editor.snapGrid)*this.editor.snapGrid,Math.round(this.dragMovement.y/this.editor.snapGrid)*this.editor.snapGrid)),this.render()}else this.rmb=!0,this.dragMovement=new PIXI.Point(0,0)}else this.rmb&&(this.rmb=!1,this.editor.historyAddState())}if(null==this.selected&&!this.lmb&&!this.rmb){for(var t=this.editor.getMousePosition(),e=this.getObjectAtPoint(t),i=this.getPathAtPoint(t,50),n=0;n<this.paths.length;n++)this.paths[n].alpha=1,this.paths[n].wireframe.alpha=1,this.paths[n].wireframe.visible=!1;for(var n=0;n<this.objects.length;n++)this.objects[n].alpha=1,this.objects[n].wireframe.alpha=1,this.objects[n].wireframe.visible=!1;if(null!=e)e.wireframe.visible=!0,e.wireframe.alpha=.75;else if(null!=i){i.wireframe.visible=!0,i.wireframe.alpha=.5;for(var n=0;n<this.paths.length;n++)this.paths[n]!=i&&(this.paths[n].alpha=.75)}}$("input:focus, textarea:focus").length>0},s.prototype.render=function(){for(var t=-10,e=10,i=t;i<=e;i++){for(var s=0;s<this.paths.length;s++)this.paths[s].config.depth==i&&(this.addChild(this.paths[s]),this.paths[s].render());for(var s=0;s<this.objects.length;s++)this.objects[s].config.depth==i&&(this.addChild(this.objects[s]),this.objects[s].render())}null!=this.level.layer&&this.level.layer!=this?this.alpha=.5:this.alpha=1},s.prototype.renderGUI=function(){this.updateTitle(),this.selected?this.selected.renderGUI():this.editor.renderGUI("layer")},s.prototype.updateTitle=function(){this.editor.title.text="LAYER: "+this.name},s.prototype.back=function(){this.selected?this.selected.back():(this.level.layer=null,this.idObject="",this.editor.historyAddState())},s.prototype.setIdObject=function(t){this.level.layer.idObject!=t&&(this.level.layer.idObject=t,this.editor.historyAddState())},s.prototype.selectObject=function(t){this.selected=t,this.render(),this.renderGUI(),this.editor.historyAddState()},s.prototype.newObject=function(t,e){var i=this.editor.getObject(t);if(null!=i){var s=new o(this);s.init(i),s.x=e.x,s.y=e.y,this.objects.push(s),this.addChild(s),this.selectObject(s)}},s.prototype.deleteObject=function(t){var e=this.objects.indexOf(t);e>-1&&(this.removeChild(this.objects[e]),this.objects.splice(e,1),this.editor.historyAddState())},s.prototype.newPath=function(t){var e=new n(this);e.init(),e.addPoint(t.x,t.y),this.paths.push(e),this.addChild(e),this.selectObject(e),this.editor.historyAddState()},s.prototype.deletePath=function(t){var e=this.paths.indexOf(t);e!=-1&&(this.removeChild(this.paths[e]),this.paths.splice(e,1),this.editor.historyAddState())},s.prototype.adoptPath=function(t){var e=t.layer.paths.indexOf(t);if(e!=-1){var i=t["export"]();t.layer.removeChild(t),t.layer.paths.splice(e,1),t.layer.selected=null,this.level.selectLayer(this);var s=new n(this);s["import"](i),this.paths.push(s),this.addChild(s),this.selectObject(s),this.editor.historyAddState()}},s.prototype.clonePath=function(t){var e=this.paths.indexOf(t);if(e!=-1){var i=t["export"]();if(i.points.length<=1)return t;var s=new n(this);s["import"](i),s.move(Math.round(50/this.editor.snapGrid)*this.editor.snapGrid,Math.round(50/this.editor.snapGrid)*this.editor.snapGrid),this.paths.push(s),this.addChild(s),this.selectObject(s),this.editor.historyAddState()}},s.prototype.splitPath=function(t,e){if(e%3==0){var i=this.paths.indexOf(t);if(i!=-1){var s=t["export"]();if(s.points.length<=1)return t;var o=new n(this);o["import"](s);for(var a=t.pointsCount-1;a>=0;a--)a<e&&o.deletePoint(a),a>e&&t.deletePoint(a);this.paths.push(o),this.addChild(o),this.selectObject(o),this.editor.historyAddState()}}},s.prototype.moveAll=function(t){t.x=Math.round(t.x/this.editor.snapGrid)*this.editor.snapGrid,t.y=Math.round(t.y/this.editor.snapGrid)*this.editor.snapGrid;for(var e=0;e<this.paths.length;e++)this.paths[e].move(t.x,t.y);for(var e=0;e<this.objects.length;e++)this.objects[e].x+=t.x,this.objects[e].y+=t.y},s.prototype.getObjectAtPoint=function(t){for(var e=null,i=this.objects.length-1;i>=0;i--)this.objects[i].isPointInside(t)&&(null==e||e.depth<this.objects[i].depth||i>this.objects.indexOf(e))&&(e=this.objects[i]);return e},s.prototype.getPathAtPoint=function(t,e){for(var i=null,s=0;s<this.paths.length;s++)for(var n=this.paths[s].bezier.getDrawingPoints(),o=0;o<n.length-1;o++){var a=new PIXI.Point(n[o+1].x-n[o].x,n[o+1].y-n[o].y),r=new PIXI.Point(a.x,a.y);r.normalize();var h=new PIXI.Point(t.x-n[o].x,t.y-n[o].y),l=h.dotProduct(a)/a.getLength(),u=new PIXI.Point(r.x*l,r.y*l);if((u.x/a.x<0||u.x/a.x>1)&&u.x!=a.x||u.y/a.y<0||u.y/a.y>1)var p=new PIXI.Point(t.x-n[o].x,t.y-n[o].y),c=new PIXI.Point(t.x-n[o+1].x,t.y-n[o+1].y),d=Math.min(p.getLength(),c.getLength());else var g=new PIXI.Point(h.x-u.x,h.y-u.y),d=g.getLength();(null==i||this.paths[s].depth>i.depth||s>this.paths.indexOf(i))&&d<e&&(i=this.paths[s])}return i},s.prototype.setName=function(t){t=$.trim(t),""!=t&&(this.name=t,this.updateTitle(),this.editor.historyAddState())},s.prototype.setDepth=function(t){this.depth=t,this.level.children.sort(function(t,e){return t.depth-e.depth}),this.level.layers.sort(function(t,e){return t.depth-e.depth}),this.editor.historyAddState()},s.prototype.setSelectedDepth=function(t){null!=this.selected&&(this.selected.config.depth=t,this.children.sort(function(t,e){return t.config.depth-e.config.depth}),this.paths.sort(function(t,e){return t.depth-e.depth}),this.objects.sort(function(t,e){return t.depth-e.depth}),this.editor.historyAddState())},s.prototype.setParallax=function(t){this.parallax=t||0,this.editor.historyAddState()},s.prototype["export"]=function(){var t={name:this.name,depth:this.depth,parallax:this.parallax,paths:[],objects:[]};this.level.layer==this&&(t.selected=!0,t.idObject=this.idObject);for(var e=0;e<this.objects.length;e++)t.objects.push(this.objects[e]["export"]());for(var e=0;e<this.paths.length;e++)t.paths.push(this.paths[e]["export"]());return t.objects.sort(function(t,e){return t.x-e.x}),t.paths.sort(function(t,e){return t.bounds[0]-e.bounds[0]}),t},s.prototype["import"]=function(t){this.name=t.name,this.depth=t.depth,this.parallax=t.parallax||0;for(var e=0;e<t.objects.length;e++){var i=new o(this);i["import"](t.objects[e]),this.objects.push(i)}for(var e=0;e<t.paths.length;e++){var s=new n(this);s["import"](t.paths[e]),this.paths.push(s)}t.selected&&(this.level.layer=this,this.idObject=t.idObject)}},{"../common":42,"../editor/Editor":44,"../editor/Level":45,"../editor/LevelObject":47,"../editor/LevelPath":48}],47:[function(t,e,i){function s(t){this.editor=t.editor,this.layer=t,this.assetManager=p3.AssetManager.instance,this.config={id:"",texture:"",anchor:{x:.5,y:.5},scale:{x:1,y:1},rotation:0,depth:0,data:""},this.sprite=null,this.wireframe=null,this.isDragging=!1,this.lmb=!1,PIXI.Container.call(this)}var n=t("../common");t("../editor/Editor"),t("../editor/Level"),t("../editor/LevelLayer");e.exports=s,s.prototype=Object.create(PIXI.Container.prototype),s.prototype.constructor=s,s.prototype.init=function(t){if(this.config.id=t.id,this.config.texture=Array.isArray(t.texture)?t.texture[p3.Utils.randomInt(0,t.texture.length-1)]:t.texture,this.config.anchor=t.anchor,t.scale){if(Array.isArray(t.scale))var e=Math.round(10*p3.Utils.randomRange(t.scale[0],t.scale[1]))/10;else var e=t.scale;this.config.scale={x:e,y:e}}t.data&&(this.config.data=t.data),t.depth&&(this.config.depth=t.depth),this.lmb=!0,this.isDragging=!0},s.prototype.update=function(){if(this.editor.mouse.leftPressed){var t=this.editor.getMousePosition();if(this.lmb){if(this.isDragging){var e=this.editor.mouse.movement;e.multiply(1/this.editor.zoom),this.x+=e.x,this.y+=e.y}}else{var t=this.editor.getMousePosition(),i=this.layer.getObjectAtPoint(t);if(this.isPointInside(t)||i==this)this.isDragging=!0;else{if(null==i)return void this.layer.newObject(this.config.id,t);var i=this.layer.getObjectAtPoint(t);if(null!=i)return void this.layer.selectObject(i)}this.lmb=!0}}else this.lmb&&(this.lmb=!1,this.isDragging=!1,this.editor.historyAddState());var s=$("input:focus, textarea:focus").length>0;!n.keyboard.getKeyJustPressed(n.keyboard.KEY_C)||n.keyboard.getKeyPressed(n.keyboard.KEY_CTRL)||s||($("select:focus").blur(),$(".delete_object").trigger("click")),!n.keyboard.getKeyJustPressed(n.keyboard.KEY_B)||n.keyboard.getKeyPressed(n.keyboard.KEY_CTRL)||s||($("select:focus").blur(),$(".back").trigger("click"))},s.prototype.render=function(){this.rotation=this.config.rotation*PIXI.DEG_TO_RAD,this.scale=new PIXI.Point(this.config.scale.x,this.config.scale.y),this.sprite||(this.sprite=new PIXI.Sprite(PIXI.Texture.EMPTY),this.addChild(this.sprite)),this.sprite.texture=this.assetManager.getTexture(this.config.texture),this.sprite.anchor.set(this.config.anchor.x,this.config.anchor.y),this.renderWireframe()},s.prototype.renderWireframe=function(){this.wireframe&&(this.removeChild(this.wireframe),this.wireframe.destroy(!0));var t=1/(this.editor.zoom*Math.abs(this.scale.x));this.wireframe=new PIXI.Graphics,this.addChild(this.wireframe),this.wireframe.lineStyle(t,16711680,1),this.wireframe.moveTo(-this.sprite.anchor.x*this.sprite.width,-this.sprite.anchor.y*this.sprite.height),this.wireframe.lineTo(+(1-this.sprite.anchor.x)*this.sprite.width,-this.sprite.anchor.y*this.sprite.height),this.wireframe.lineTo(+(1-this.sprite.anchor.x)*this.sprite.width,+(1-this.sprite.anchor.y)*this.sprite.height),this.wireframe.lineTo(-this.sprite.anchor.x*this.sprite.width,+(1-this.sprite.anchor.y)*this.sprite.height),this.wireframe.lineTo(-this.sprite.anchor.x*this.sprite.width,-this.sprite.anchor.y*this.sprite.height),this.wireframe.beginFill(16711680),this.wireframe.drawCircle(0,0,5*t),this.wireframe.endFill,this.wireframe.visible=this.layer.selected==this},s.prototype.renderGUI=function(){this.editor.renderGUI("object")},s.prototype.back=function(){this.layer.selected=null,this.editor.historyAddState()},s.prototype.setScale=function(t,e){this.config.scale.x=t*Math.sign(this.config.scale.x),this.config.scale.y=t*Math.sign(this.config.scale.y),this.scale.set(this.config.scale.x,this.config.scale.y),e&&this.editor.historyAddState(),this.renderWireframe()},s.prototype.setFlipX=function(t,e){this.config.scale.x=Math.abs(this.config.scale.x)*Math.sign(t),this.scale.x=this.config.scale.x,e&&this.editor.historyAddState()},s.prototype.setFlipY=function(t,e){this.config.scale.y=Math.abs(this.config.scale.y)*Math.sign(t),this.scale.y=this.config.scale.y,e&&this.editor.historyAddState()},s.prototype.setRotation=function(t,e){this.config.rotation=t,this.rotation=this.config.rotation*PIXI.DEG_TO_RAD,e&&this.editor.historyAddState()},s.prototype.setConfig=function(t,e,i){this.config[t]=e,i&&this.editor.historyAddState()},s.prototype.isPointInside=function(t){var e=new PIXI.Point(t.x,t.y);0!=this.rotation&&e.rotateAround(new PIXI.Point(this.x,this.y),-this.rotation);var i=this.x-this.sprite.width*this.scale.x*this.sprite.anchor.x,s=this.x+this.sprite.width*this.scale.x*(1-this.sprite.anchor.x),n=this.y-this.sprite.height*this.scale.y*this.sprite.anchor.y,o=this.y+this.sprite.height*this.scale.y*(1-this.sprite.anchor.y);return!(e.x<Math.min(i,s))&&(!(e.x>Math.max(i,s))&&(!(e.y<Math.min(n,o))&&!(e.y>Math.max(n,o))))},s.prototype["export"]=function(){var t=jQuery.extend(!0,{},this.config);return t.position={x:Math.round(this.x),y:Math.round(this.y)},this.layer.selected==this&&(t.selected=!0),t},s.prototype["import"]=function(t){this.x=t.position.x,this.y=t.position.y,this.config.id=t.id,this.config.texture=t.texture,this.config.anchor={x:t.anchor.x,y:t.anchor.y},this.config.scale={x:t.scale.x,y:t.scale.y},this.config.rotation=t.rotation,this.config.depth=t.depth,this.config.data=t.data,t.selected&&(this.layer.selected=this)},Object.defineProperty(s.prototype,"depth",{get:function(){return this.config.depth}})},{"../common":42,"../editor/Editor":44,"../editor/Level":45,"../editor/LevelLayer":46}],48:[function(t,e,i){function s(t){this.editor=t.editor,this.layer=t,this.assetManager=p3.AssetManager.instance,this.config={closed:!1,depth:0,collisions:1,texFill:this.editor.config.path.fill[0],texGround:this.editor.config.path.ground[0],texGroundEdge:this.editor.config.path.ground_edge[0],texWall:this.editor.config.path.wall[0],texFillPadding:512,texFillSize:256,texGroundSize:160,texGroundDelta:.1,texWallSize:160,texWallDelta:.1,texWallAngle:70,texGroundEdgeSide:"",data:""},this.bezier=new o,this.bezier.cacheDrawingPoints=!1,this.pointIndex=-1,this.wireframe=null,this.textures=null,this.lmb=!1,this.rmb=!1,this.dragMovement=null,PIXI.Container.call(this)}var n=t("../common"),o=(t("../editor/Editor"),t("../editor/Level"),t("../editor/LevelLayer"),t("../editor/BezierPath"));e.exports=s,s.prototype=Object.create(PIXI.Container.prototype),s.prototype.constructor=s,s.prototype.init=function(){},s.prototype.update=function(){if(this.editor.mouse.leftPressed){var t=this.editor.getMousePosition();if(!this.lmb&&this.editor.mouse.leftJustPressed){if(this.lmb=!0,this.pointIndex=this.getClosestPointTo(t.x,t.y),this.pointIndex==-1){var e=this.bezier.points[this.bezier.points.length-1],i=t;if(this.config.closed||e.x<i.x)this.addPoint(e.x+(i.x-e.x)/2,e.y),this.addPoint(i.x-(i.x-e.x)/2,i.y),this.addPoint(i.x,i.y),this.pointIndex=this.bezier.points.length-1;else if(this.bezier.points.length>1&&i.x>this.bezier.getFirstPoint().x)for(var s=3;s<this.bezier.points.length;s+=3)if(this.bezier.points[s].x>i.x){var e=this.bezier.points[s-3],o=this.bezier.points[s];this.addPoint(o.x-(o.x-i.x)/2,i.y,s-1),this.addPoint(i.x,i.y,s-1),this.addPoint(e.x+(i.x-e.x)/2,i.y,s-1),this.pointIndex=s;break}this.render()}}else if(this.lmb&&this.pointIndex!=-1){var a=n.keyboard.getKeyPressed(n.keyboard.KEY_SHIFT),r=this.movePoint(this.pointIndex,t.x,t.y,a);r&&this.render()}}else this.lmb&&(this.lmb=!1,this.render(),this.editor.historyAddState());if(this.editor.mouse.rightPressed){var t=this.editor.getMousePosition();if(this.rmb){var h=this.editor.mouse.movement;h.multiply(1/this.editor.zoom),this.move(-Math.round(this.dragMovement.x/this.editor.snapGrid)*this.editor.snapGrid,-Math.round(this.dragMovement.y/this.editor.snapGrid)*this.editor.snapGrid),this.dragMovement.x+=h.x,this.dragMovement.y+=h.y,this.move(Math.round(this.dragMovement.x/this.editor.snapGrid)*this.editor.snapGrid,Math.round(this.dragMovement.y/this.editor.snapGrid)*this.editor.snapGrid),this.render()}else this.rmb=!0,this.dragMovement=new PIXI.Point(0,0)}else this.rmb&&(this.rmb=!1,this.editor.historyAddState());if(this.rmb)this.hoverGfx.visible=!1;else{var t=this.editor.getMousePosition(),l=this.getClosestPointTo(t.x,t.y);l!=-1?(this.hoverGfx.visible=!0,this.hoverGfx.x=this.bezier.points[l].x,this.hoverGfx.y=this.bezier.points[l].y):this.hoverGfx.visible=!1}var u=$("input:focus, textarea:focus").length>0;if(n.keyboard.getKeyJustPressed(n.keyboard.KEY_C)&&!n.keyboard.getKeyPressed(n.keyboard.KEY_CTRL)&&!u&&this.pointIndex%3==0&&this.bezier.points.length>1){var p=this.pointIndex==this.bezier.points.length-1;this.deletePoint(this.pointIndex),p&&(this.pointIndex-=3),this.render()}!n.keyboard.getKeyJustPressed(n.keyboard.KEY_K)||n.keyboard.getKeyPressed(n.keyboard.KEY_CTRL)||u||this.pointIndex%3==0&&this.bezier.points.length>1&&(this.splitPathAtPoint(this.pointIndex),this.render()),!n.keyboard.getKeyJustPressed(n.keyboard.KEY_B)||n.keyboard.getKeyPressed(n.keyboard.KEY_CTRL)||u||($("select:focus").blur(),$(".back").trigger("click")),n.keyboard.getKeyJustPressed(n.keyboard.KEY_W)&&!u&&(this.wireframe.visible=!this.wireframe.visible)},s.prototype.render=function(){if(this.hoverGfx?this.hoverGfx.clear():this.hoverGfx=new PIXI.Graphics,this.hoverGfx.beginFill(16737792,.6),this.hoverGfx.drawCircle(0,0,this.editor.snapGrid/this.editor.zoom),this.hoverGfx.endFill(),this.hoverGfx.visible=!1,null!=this.wireframe&&(this.removeChild(this.wireframe),this.wireframe.destroy(!0)),null!=this.textures&&this.removeChild(this.textures),this.wireframe=new PIXI.Graphics,this.textures=new PIXI.Container,this.bezier.points.length>1){var t=this.bezier.getDrawingPoints();if(""!=this.config.texFill){for(var e=null,i=[],s=0;s<t.length;s++)i.push(new poly2tri.Point(t[s].x,t[s].y)),(null==e||e<t[s].y)&&(e=t[s].y);this.config.closed?i[0].x==i[i.length-1].x&&i[0].y==i[i.length-1].y&&i.splice(i.length-1,1):(i.push(new poly2tri.Point(t[t.length-1].x,e+this.config.texFillPadding)),i.push(new poly2tri.Point(t[0].x,e+this.config.texFillPadding)));for(var s=0;s<i.length;s++)i[s].x=Math.round(i[s].x),i[s].y=Math.round(i[s].y);try{var n=new poly2tri.SweepContext(i);n.triangulate();var o=n.getTriangles()}catch(a){console.log("Triangulation failed",a)}if(o){var r=this.assetManager.getTexture(this.config.texFill);r.baseTexture.wrapMode=1;for(var h=new Float32Array(6*o.length),l=new Float32Array(6*o.length),u=new Uint16Array(3*o.length),p=this.config.texFillSize,s=0;s<o.length;s++){var c=o[s].getPoints();h.set([c[0].x,c[0].y,c[1].x,c[1].y,c[2].x,c[2].y],6*s),l.set([c[0].x/p,c[0].y/p,c[1].x/p,c[1].y/p,c[2].x/p,c[2].y/p],6*s),u.set([0+3*s,1+3*s,2+3*s],3*s)}var d=new PIXI.mesh.Mesh(r,h,l,u,PIXI.mesh.Mesh.DRAW_MODES.TRIANGLES);this.textures.addChild(d)}}if(""!=this.config.texWall){for(var g=this.bezier.getGroundSegments(this.config.texWallAngle,360),y=this.config.texWallSize,m=this.config.texWallDelta,f=0,w=0;w<g.length;w++)f+=g[w].points.length-1;var r=this.assetManager.getTexture(this.config.texWall);r.baseTexture.wrapMode=1;for(var h=new Float32Array(8*f),l=new Float32Array(8*f),u=new Uint16Array(6*f),x=0,w=0;w<g.length;w++)for(var v=0,S=0,s=0;s<g[w].normals.length-1;s++){h.set([g[w].points[s].x-g[w].normals[s].x*(y*m),g[w].points[s].y-g[w].normals[s].y*(y*m),g[w].points[s+1].x-g[w].normals[s+1].x*(y*m),g[w].points[s+1].y-g[w].normals[s+1].y*(y*m),g[w].points[s+1].x+g[w].normals[s+1].x*(y*(1-m)),g[w].points[s+1].y+g[w].normals[s+1].y*(y*(1-m)),g[w].points[s].x+g[w].normals[s].x*(y*(1-m)),g[w].points[s].y+g[w].normals[s].y*(y*(1-m))],8*x);var T=new PIXI.Point(g[w].points[s].x-g[w].points[s+1].x,g[w].points[s].y-g[w].points[s+1].y);S=T.getLength(),l.set([v/y,0,(v+S)/y,0,(v+S)/y,1,v/y,1],8*x),u.set([0+4*x,1+4*x,2+4*x,0+4*x,2+4*x,3+4*x],6*x),v+=S,x++}var d=new PIXI.mesh.Mesh(r,h,l,u,PIXI.mesh.Mesh.DRAW_MODES.TRIANGLES);this.textures.addChild(d)}var g=this.bezier.getGroundSegments(0,this.config.texWallAngle,""==this.config.texGroundEdge),b=this.config.texGroundSize,m=this.config.texGroundDelta;if(""!=this.config.texGround){for(var f=0,w=0;w<g.length;w++)f+=g[w].points.length-1;var r=this.assetManager.getTexture(this.config.texGround);r.baseTexture.wrapMode=1;for(var h=new Float32Array(8*f),l=new Float32Array(8*f),u=new Uint16Array(6*f),x=0,w=0;w<g.length;w++){0!=w||"right"!=this.config.texGroundEdgeSide&&"none"!=this.config.texGroundEdgeSide||(g[w].normals[0]={x:0,y:1}),w!=g.length-1||"left"!=this.config.texGroundEdgeSide&&"none"!=this.config.texGroundEdgeSide||(g[w].normals[g[w].normals.length-1]={x:0,y:1});for(var S=0,s=0;s<g[w].normals.length-1;s++){var T=new PIXI.Point(g[w].points[s].x-g[w].points[s+1].x,g[w].points[s].y-g[w].points[s+1].y);S+=T.getLength()}for(var y=S/Math.max(1,Math.round(S/b)),v=0,S=0,s=0;s<g[w].normals.length-1;s++){
h.set([g[w].points[s].x-g[w].normals[s].x*(y*m),g[w].points[s].y-g[w].normals[s].y*(b*m),g[w].points[s+1].x-g[w].normals[s+1].x*(y*m),g[w].points[s+1].y-g[w].normals[s+1].y*(b*m),g[w].points[s+1].x+g[w].normals[s+1].x*(y*(1-m)),g[w].points[s+1].y+g[w].normals[s+1].y*(b*(1-m)),g[w].points[s].x+g[w].normals[s].x*(y*(1-m)),g[w].points[s].y+g[w].normals[s].y*(b*(1-m))],8*x);var T=new PIXI.Point(g[w].points[s].x-g[w].points[s+1].x,g[w].points[s].y-g[w].points[s+1].y);S=T.getLength(),l.set([v/y,0,(v+S)/y,0,(v+S)/y,1,v/y,1],8*x),u.set([0+4*x,1+4*x,2+4*x,0+4*x,2+4*x,3+4*x],6*x),v+=S,x++}}var d=new PIXI.mesh.Mesh(r,h,l,u,PIXI.mesh.Mesh.DRAW_MODES.TRIANGLES);this.textures.addChild(d)}if(""!=this.config.texGroundEdge){for(var r=this.assetManager.getTexture(this.config.texGroundEdge),h=new Float32Array(16*g.length),l=new Float32Array(16*g.length),u=new Uint16Array(12*g.length),w=0;w<g.length;w++){for(var S=0,s=0;s<g[w].normals.length-1;s++){var T=new PIXI.Point(g[w].points[s].x-g[w].points[s+1].x,g[w].points[s].y-g[w].points[s+1].y);S+=T.getLength()}var y=S/Math.round(S/b);if(w>0||"left"==this.config.texGroundEdgeSide||""==this.config.texGroundEdgeSide){var P=g[w].points[0],_=g[w].normals[0],T=new PIXI.Point(g[w].points[0].x-g[w].points[1].x,g[w].points[0].y-g[w].points[1].y);T.normalize(),h.set([P.x-_.x*(y*m)+T.x*y,P.y-_.y*(b*m-T.y*b),P.x-_.x*(y*m),P.y-_.y*(b*m),P.x+_.x*(y*(1-m)),P.y+_.y*(b*(1-m)),P.x+_.x*(y*(1-m))+T.x*y,P.y+_.y*(b*(1-m)+T.y*b)],8*w*2),l.set([0,0,1,0,1,1,0,1],8*w*2),u.set([0+2*w*4,1+2*w*4,2+2*w*4,0+2*w*4,2+2*w*4,3+2*w*4],6*w*2)}if(w<g.length-1||"right"==this.config.texGroundEdgeSide||""==this.config.texGroundEdgeSide){var I=g[w].normals.length-1,P=g[w].points[g[w].normals.length-1],_=g[w].normals[g[w].normals.length-1],T=new PIXI.Point(g[w].points[I].x-g[w].points[I-1].x,g[w].points[I].y-g[w].points[I-1].y);T.normalize(),h.set([P.x-_.x*(y*m)+T.x*y,P.y-_.y*(b*m-T.y*b),P.x-_.x*(y*m),P.y-_.y*(b*m),P.x+_.x*(y*(1-m)),P.y+_.y*(b*(1-m)),P.x+_.x*(y*(1-m))+T.x*y,P.y+_.y*(b*(1-m)+T.y*b)],8*(2*w+1)),l.set([0,0,1,0,1,1,0,1],8*(2*w+1)),u.set([0+4*(2*w+1),1+4*(2*w+1),2+4*(2*w+1),0+4*(2*w+1),2+4*(2*w+1),3+4*(2*w+1)],6*(2*w+1))}}var d=new PIXI.mesh.Mesh(r,h,l,u,PIXI.mesh.Mesh.DRAW_MODES.TRIANGLES);this.textures.addChild(d)}}this.wireframe.moveTo(this.bezier.points[0].x,this.bezier.points[0].y),this.wireframe.lineStyle(2/this.editor.zoom,16711680);for(var s=1;s<this.bezier.points.length;s+=3)this.wireframe.bezierCurveTo(this.bezier.points[s].x,this.bezier.points[s].y,this.bezier.points[s+1].x,this.bezier.points[s+1].y,this.bezier.points[s+2].x,this.bezier.points[s+2].y);this.wireframe.lineStyle(2/this.editor.zoom,10027008,.5);for(var s=0;s<this.bezier.points.length-1;s+=3)this.wireframe.moveTo(this.bezier.points[s].x,this.bezier.points[s].y),this.wireframe.lineTo(this.bezier.points[s+1].x,this.bezier.points[s+1].y),this.wireframe.moveTo(this.bezier.points[s+2].x,this.bezier.points[s+2].y),this.wireframe.lineTo(this.bezier.points[s+3].x,this.bezier.points[s+3].y);for(var s=0;s<this.bezier.points.length;s++)s%3==0&&(s==this.pointIndex?this.wireframe.lineStyle(2/this.editor.zoom,65280,1):this.wireframe.lineStyle(0/this.editor.zoom,16711680,0),this.wireframe.beginFill(16711680),this.wireframe.drawCircle(this.bezier.points[s].x,this.bezier.points[s].y,5/this.editor.zoom),this.wireframe.endFill());for(var s=0;s<this.bezier.points.length;s++)s%3!=0&&(s==this.pointIndex?this.wireframe.lineStyle(2/this.editor.zoom,65280,1):this.wireframe.lineStyle(0/this.editor.zoom,16711680,0),this.wireframe.beginFill(10027212),this.wireframe.drawCircle(this.bezier.points[s].x,this.bezier.points[s].y,4/this.editor.zoom),this.wireframe.endFill());this.addChild(this.textures),this.addChild(this.hoverGfx),this.addChild(this.wireframe),this.wireframe.visible=this.layer.selected==this},s.prototype.renderGUI=function(){this.editor.renderGUI("path")},s.prototype.back=function(){this.layer.selected=null,this.bezier.points.length<=1&&this.layer.deletePath(this),this.hoverGfx.visible=!1,this.editor.historyAddState()},s.prototype.addPoint=function(t,e,i){t=Math.round(t/this.editor.snapGrid)*this.editor.snapGrid,e=Math.round(e/this.editor.snapGrid)*this.editor.snapGrid,this.bezier.addPoint(t,e,i)},s.prototype.deletePoint=function(t){if(t%3==0){var e=0==t,i=t==this.bezier.points.length-1;e&&this.bezier.deletePoint(t+2),i||this.bezier.deletePoint(t+1),this.bezier.deletePoint(t),e||this.bezier.deletePoint(t-1),i&&this.bezier.deletePoint(t-2)}},s.prototype.splitPathAtPoint=function(t){var e=0==t,i=t==this.bezier.points.length-1;e||i||this.layer.splitPath(this,t)},s.prototype.movePoint=function(t,e,i,s){var n=new PIXI.Point(this.bezier.points[t].x,this.bezier.points[t].y);if(this.bezier.points[t].x=Math.round(e/this.editor.snapGrid)*this.editor.snapGrid,this.bezier.points[t].y=Math.round(i/this.editor.snapGrid)*this.editor.snapGrid,this.bezier.points[t].x==n.x&&this.bezier.points[t].y==n.y)return!1;if(t%3==0)t>0&&(this.bezier.points[t-1].x+=this.bezier.points[t].x-n.x,this.bezier.points[t-1].y+=this.bezier.points[t].y-n.y),t<this.bezier.points.length-1&&(this.bezier.points[t+1].x+=this.bezier.points[t].x-n.x,this.bezier.points[t+1].y+=this.bezier.points[t].y-n.y);else if(s){if(1==t||t==this.bezier.points.length-2)return!0;if(t%3==1)var o=this.bezier.points[t-1],a=this.bezier.points[t-2];else var o=this.bezier.points[t+1],a=this.bezier.points[t+2];var r=new PIXI.Point(this.bezier.points[t].x-o.x,this.bezier.points[t].y-o.y);a.x=o.x-r.x,a.y=o.y-r.y}return!0},s.prototype.getPointIndexAt=function(t,e){t=Math.round(t/this.editor.snapGrid)*this.editor.snapGrid,e=Math.round(e/this.editor.snapGrid)*this.editor.snapGrid;for(var i=this.bezier.points.length-1;i>=0;i--)if(i%3!=0&&this.bezier.points[i].x==t&&this.bezier.points[i].y==e)return i;for(var i=this.bezier.points.length-1;i>=0;i--)if(i%3==0&&this.bezier.points[i].x==t&&this.bezier.points[i].y==e)return i;return-1},s.prototype.getClosestPointTo=function(t,e,i){for(var i=i||1*this.editor.snapGrid/this.editor.zoom,s=this.bezier.points.length-1;s>=0;s--)if(s%3!=0){var n=Math.sqrt(Math.pow(this.bezier.points[s].x-t,2)+Math.pow(this.bezier.points[s].y-e,2));if(n<i)return s}for(var s=this.bezier.points.length-1;s>=0;s--)if(s%3==0){var n=Math.sqrt(Math.pow(this.bezier.points[s].x-t,2)+Math.pow(this.bezier.points[s].y-e,2));if(n<i)return s}return-1},s.prototype.move=function(t,e){for(var i=0;i<this.bezier.points.length;i++)this.bezier.points[i].x+=t,this.bezier.points[i].y+=e},s.prototype.flipH=function(){for(var t=null,e=null,i=[],s=0;s<this.bezier.points.length;s++)(null==t||this.bezier.points[s].x<t)&&(t=this.bezier.points[s].x),(null==e||this.bezier.points[s].x>e)&&(e=this.bezier.points[s].x);for(var n=e-t,i=[],s=this.bezier.points.length-1;s>=0;s--){var o=(this.bezier.points[s].x-t)/n;i.push({x:t+(1-o)*n,y:this.bezier.points[s].y})}this.bezier.points=i},s.prototype.flipV=function(){for(var t=null,e=null,i=[],s=0;s<this.bezier.points.length;s++)(null==t||this.bezier.points[s].y<t)&&(t=this.bezier.points[s].y),(null==e||this.bezier.points[s].y>e)&&(e=this.bezier.points[s].y);for(var n=e-t,i=[],s=this.bezier.points.length-1;s>=0;s--){var o=(this.bezier.points[s].y-t)/n;i.push({x:this.bezier.points[s].x,y:t+(1-o)*n})}this.bezier.points=i},s.prototype.setConfig=function(t,e,i){this.config[t]=e,i&&this.editor.historyAddState()},s.prototype["export"]=function(){var t=jQuery.extend(!0,{},this.config);t.points=this.bezier.points,t.bounds=[null,null];for(var e=0;e<this.bezier.points.length;e++)t.bounds[0]=null===t.bounds[0]?this.bezier.points[e].x:Math.min(t.bounds[0],this.bezier.points[e].x),t.bounds[1]=null===t.bounds[1]?this.bezier.points[e].x:Math.max(t.bounds[1],this.bezier.points[e].x);return this.layer.selected==this&&(t.selected=!0,t.pointIndex=this.pointIndex),t},s.prototype["import"]=function(t){this.config.closed=t.closed,this.config.depth=t.depth,this.config.collisions=t.collisions,this.config.texFill=t.texFill,this.config.texGround=t.texGround,this.config.texGroundEdge=t.texGroundEdge,this.config.texGroundEdgeSide=t.texGroundEdgeSide,this.config.texWall=t.texWall,this.config.texFillPadding=t.texFillPadding,this.config.texFillSize=t.texFillSize,this.config.texGroundSize=t.texGroundSize,this.config.texGroundDelta=t.texGroundDelta,this.config.texWallSize=t.texWallSize,this.config.texWallDelta=t.texWallDelta,this.config.texWallAngle=t.texWallAngle,this.config.data=t.data,t.selected&&(this.layer.selected=this,this.pointIndex=t.pointIndex);for(var e=0;e<t.points.length;e++)this.bezier.addPoint(t.points[e].x,t.points[e].y)},Object.defineProperty(s.prototype,"depth",{get:function(){return this.config.depth}}),Object.defineProperty(s.prototype,"pointsCount",{get:function(){return this.bezier.points.length}}),Object.defineProperty(s.prototype,"visiblePointsCount",{get:function(){return Math.floor((this.bezier.points.length+2)/3)}})},{"../common":42,"../editor/BezierPath":43,"../editor/Editor":44,"../editor/Level":45,"../editor/LevelLayer":46}],49:[function(t,e,i){function s(){this.x=0,this.y=0,this.xInc=0,this.yInc=0,this.xMax=null,this.yMax=null,this.xMin=null,this.yMin=null}e.exports=s,s.prototype.update=function(t){this.x+=this.xInc*t,this.y+=this.yInc*t,this.xMax&&(this.x=Math.min(this.x,this.xMax)),this.xMin&&(this.x=Math.max(this.x,this.xMin)),this.yMax&&(this.y=Math.min(this.y,this.yMax)),this.yMin&&(this.y=Math.max(this.y,this.yMin))}},{}],50:[function(t,e,i){function s(t,e){this.signals={},this.signals.disposed=new signals.Signal,this.type=t,this.collisionRect=null,this.collisionRectangle=null,this.collisionCircle=null,this.areaRect=null,this.collidable=!1,this.removeWhenOutside=e,this.layer=null,this._sounds=[],this.collisionGraphic=null,PIXI.Container.call(this)}var n=t("../common");e.exports=s,s.prototype=Object.create(PIXI.Container.prototype),s.prototype.constructor=s,s.prototype.init=function(){},s.prototype.destroy=function(t){this.dispose(),PIXI.Container.prototype.destroy.call(this,t)},s.prototype.update=function(){},s.prototype.reset=function(){this.x=0,this.y=0,this.removeMe=!1},s.prototype.dispose=function(){this.signals.disposed.dispatch(this),this.removed=!0,this.stopSound(),this.layer=null},s.prototype.pause=function(){},s.prototype.resume=function(){},s.prototype.drawCollision=function(){this.collisionGraphic&&this.removeChild(this.collisionGraphic),this.collisionGraphic=new PIXI.Graphics,this.addChild(this.collisionGraphic),this.collisionGraphic.lineStyle(2,16191773),null!=this.collisionRect&&this.collisionGraphic.drawRect(this.collisionRect.x,this.collisionRect.y,this.collisionRect.width,this.collisionRect.height),null!=this.collisionCircle&&this.collisionGraphic.drawCircle(this.collisionCircle.x,this.collisionCircle.y,this.collisionCircle.radius),null!==this.collisionRectangle&&this.collisionGraphic.drawRect(this.collisionRectangle.x,this.collisionRectangle.y,this.collisionRectangle.width,this.collisionRectangle.height)},s.prototype.playSound=function(t,e){return this._sounds[t]=n.audio.play(t,e),this._sounds[t].playing=!0,this._sounds[t].volume=1,this._sounds[t]},s.prototype.playRandomSound=function(t,e){return this.playSound(t,e)},s.prototype.stopSound=function(t){for(var e in this._sounds)t&&t!=e||n.audio.stopSound(e,this._sounds[e].id)},s.prototype.isPointWithinScreenBounds=function(t,e){var i=t||0,s=e||0,n=this.worldTransform;return i+=n.tx,s+=n.ty,i>0&&i<p3.View.width&&s>0&&s<p3.View.height}},{"../common":42}],51:[function(t,e,i){function s(t,e){PIXI.Container.call(this),this.scene=t,this.debug=n.gameParams.debug,this.numOpponents="undefined"!=typeof n.config.numOpponents?Math.min(n.config.numOpponents,n.carColors.length-1):n.carColors.length-1,this.data=e,this.levelIndex=0,this.oldPosition=new PIXI.Point(0,0),this.layerContainer=null,this.layers=[],this.objectManager=null,this.completed=!1,this.defaultZoom=.75,this._deltaTime=0,this._deltaTimeScale=1,this.styleScore=0,this.coins=0,this.collectibleIndex=0,null!==e&&(this.config=n.assets.getJSON(e));var i=20;switch(this.scene.character){case"blue":this.avatar=new f(this.scene.character,i);break;case"brown":this.avatar=new w(this.scene.character,i);break;case"pink":this.avatar=new x(this.scene.character,i);break;case"purple":this.avatar=new v(this.scene.character,i);break;case"red":this.avatar=new S(this.scene.character,i);break;case"yellow":this.avatar=new T(this.scene.character,i);break;default:console.log("Something is wrong")}this.avatar.isPlayer=!0,this.avatar.runSpeedMin=1.05*this.avatar.bgConst,this.avatar.runSpeedMax*=1.05,this.opponents=[];var s;i=0;var o=3;if(0!==n.playersPositions.length)for(var a=1;a<n.playersPositions.length;a++)i+=o,s=new(b[n.carColors.indexOf(n.playersPositions[a][0])])(n.playersPositions[a][0],i),this.opponents.push(s);else this.setOpponents();this.focusPoint=new PIXI.Point(this.avatar.focusPointLand.point.x,this.avatar.focusPointLand.point.y),this.focusXActive=!0,this.focusYActive=!0,this.focusPosition=new PIXI.Point(0,0),this.focusPointTween=null,this.zoom=1,this.zoomTarget=1,this.zoomTween=null,this._isShake=!1,this._shakeTime=0,this._shakeTimeEnd=1,this._shakeStrength=new PIXI.Point(10,10),this.effects=[]}var n=t("../common"),o=(t("../editor/BezierPath"),t("../game/LevelLayer")),a=(t("../game/LevelPath"),t("../game/LevelRecord"),t("../game/ObjectManager")),r=t("../game/objects/decoration/ObjectDecoration"),h=t("../game/objects/triggers/ObjectLevelEnd"),l=t("../game/objects/triggers/ObjectGameOver"),u=t("../game/objects/triggers/ObjectCameraZoom"),p=t("../game/objects/triggers/ObjectTutorial"),c=t("../game/objects/collectibles/ObjectCoin"),d=t("../game/objects/collectibles/ObjectPowerup"),g=t("../game/objects/collectibles/ObjectChallenge"),y=t("../game/objects/collectibles/ObjectChallengeDummy"),m=t("../game/objects/collectibles/ObjectChallengeParticle"),f=(t("../game/objects/collectibles/ObjectCollectible"),t("../game/objects/avatar/Avatar"),t("../game/objects/avatar/AvatarBlue")),w=t("../game/objects/avatar/AvatarBrown"),x=t("../game/objects/avatar/AvatarPink"),v=t("../game/objects/avatar/AvatarPurple"),S=t("../game/objects/avatar/AvatarRed"),T=t("../game/objects/avatar/AvatarYellow"),b=(t("../game/objects/decoration/ObjectHint"),[t("../game/objects/avatar/AvatarPink"),t("../game/objects/avatar/AvatarRed"),t("../game/objects/avatar/AvatarPurple"),t("../game/objects/avatar/AvatarYellow"),t("../game/objects/avatar/AvatarBrown"),t("../game/objects/avatar/AvatarBlue")]);e.exports=s,s.prototype=Object.create(PIXI.Container.prototype),s.prototype.constructor=s,s.prototype.init=function(){var t=[{id:"level_end",pool:"level_end",base:h,args:[!0]},{id:"level_gameover",pool:"level_gameover",base:l,args:[!1]},{id:"camera_zoom",pool:"camera_zoom",base:u,args:[]},{id:"tutorial",pool:"tutorial",base:p,args:[]},{id:"coin",pool:"coin",base:c,args:[]},{id:"powerup",pool:"powerup",base:d,args:[]},{id:"challenge",pool:"challenge",base:g,args:[!0]},{id:"challengeDummy",pool:"challengeDummy",base:y,args:[!0]},{id:"challengeParticle",pool:"challengeParticle",base:m,args:[!0]},{id:"default",pool:"default",base:r,args:[],quantity:20}];this.objectManager=new a(t),this.objectManager.init(),this.layerContainer=new PIXI.Container,this.addChild(this.layerContainer),this.createBackgroundLayers();for(var e=0;e<this.config.layers.length;e++){var i=this.addLayer(this.config.layers[e].name,new PIXI.Point(0,0),this.config.layers[e]);i.init()}this.addLayer("opponents",new PIXI.Point(0,0),{name:"opponents",depth:2});for(var e=0;e<this.opponents.length;e++)this.getLayer("opponents").addChild(this.opponents[e]),this.opponents[e].init(this),this.opponents[e].x=0!==n.playersPositions.length?n.playersPositions[e+1][1]:0,this.opponents[e].y=0!==n.playersPositions.length?n.playersPositions[e+1][2]-60:-60;this.addLayer("avatar",new PIXI.Point(0,0),{name:"avatar",depth:3}),this.getLayer("avatar").addChild(this.avatar),this.avatar.init(this),this.avatar.x=0!==n.playersPositions.length?n.playersPositions[0][1]:0,this.avatar.y=0!==n.playersPositions.length?n.playersPositions[0][2]-100:0,this.createForegroundLayers(),this.sortChildren(),this.zoom=this.defaultZoom+.5,this.changeZoom(this.defaultZoom,3)},s.prototype.setOpponents=function(){for(var t=0,e=3,i=[],s=0;s<this.numOpponents;s++){do var o=Math.floor(Math.random()*n.carColors.length);while(this.scene.character===n.carColors[o]||i.indexOf(o)!==-1);i.push(o),t+=e;var a=new b[o](n.carColors[o],t);this.opponents.push(a)}},s.prototype.lerp=function(t,e,i){return t*(1-i)+e*i},s.prototype.update=function(){if(!this.parent.isBusy){this._deltaTime=p3.Timestep.deltaTime,this.oldPosition.x=this.avatar.x,this.oldPosition.y=this.avatar.y,this.avatar.update();for(var t=0;t<this.opponents.length;t++)!this.opponents[t].isGrounded&&n.raceStarted||this.opponents[t].update();this._isShake&&(this._shakeTime+=this._deltaTime,this._shakeTime>=this._shakeTimeEnd&&(this._shakeTime=0,this._isShake=!1)),this.focusXActive&&(this.focusPosition.x=this.avatar.x),this.focusYActive&&(this.focusPosition.y=this.avatar.y),this.x=n.STAGE_WIDTH*this.focusPoint.x-this.focusPosition.x*this.zoom,this.y=n.STAGE_HEIGHT*this.focusPoint.y-this.focusPosition.y*this.zoom,this._isShake&&(this.x+=p3.Utils.randomInt(-1,1)*(this._shakeStrength.x*(1-this._shakeTime/this._shakeTimeEnd)),this.y+=p3.Utils.randomInt(-1,1)*(this._shakeStrength.y*(1-this._shakeTime/this._shakeTimeEnd))),this.scale.x=this.zoom,this.scale.y=this.zoom;for(var e=new PIXI.Point(this.focusXActive?this.avatar.x-this.oldPosition.x:0,this.focusYActive?this.avatar.y-this.oldPosition.y:0),t=0;t<this.layers.length;t++)this.layers[t].update(e);this.updateEffects()}},s.prototype.destroy=function(t){this.clearEffects(),PIXI.Container.prototype.destroy.call(this,t)},s.prototype.addLayer=function(t,e,i){var s=new o(t,e,i?i:{name:t,depth:0});return s.level=this,this.layers.push(s),this.layerContainer.addChild(s),s},s.prototype.getLayer=function(t){for(var e=0;e<this.layers.length;e++)if(this.layers[e].id==t)return this.layers[e];return null},s.prototype.getPathsByType=function(t){for(var e=[],i=0;i<this.layers.length;i++)e=e.concat(this.layers[i].getPathsByType(t));return e},s.prototype.createBackgroundLayers=function(){var t=[];t.push({id:"layer_0",image:"level_background",xScale:3,yScale:3,xSpeed:.05,y:0,alpha:1}),t.push({id:"layer_1",image:"level_midground1",xScale:2,yScale:2,xSpeed:.1,y:0,alpha:1}),t.push({id:"layer_2",image:"level_midground2",xScale:2,yScale:2,xSpeed:.2,y:0,alpha:1});for(var e=0;e<t.length;e++){var i=this.addLayer(t[e].id,new PIXI.Point(t[e].xSpeed,0),{name:t[e].id,depth:-1e3+e});i.setBackground(t[e].image,t[e].y,new PIXI.Point(t[e].xScale,t[e].yScale),t[e].alpha)}},s.prototype.createForegroundLayers=function(){var t=[];t.push({id:"layer_3",image:"level_foreground1",xScale:2,yScale:2,xSpeed:2,y:200,alpha:1}),t.push({id:"layer_4",image:"level_foreground2",xScale:2,yScale:2,xSpeed:3,y:0,alpha:1});for(var e=0;e<t.length;e++){var i=this.addLayer(t[e].id,new PIXI.Point(t[e].xSpeed,0),{name:t[e].id,depth:1e3+e});i.setBackground(t[e].image,t[e].y,new PIXI.Point(t[e].xScale,t[e].yScale),t[e].alpha)}},s.prototype.sortChildren=function(){this.layerContainer.children.sort(function(t,e){return t.config.depth-e.config.depth})},s.prototype.changeZoom=function(t,e,i){null!=this.zoomTween&&this.zoomTween.kill(),t!=this.zoom&&(this.zoomTween=new TimelineMax,this.zoomTween.to(this,e,{zoom:t,ease:Sine.easeInOut},i?i:0),this.zoomTarget=t)},s.prototype.changeFocusPoint=function(t,e,i){null!=this.focusPointTween&&this.focusPointTween.kill(),this.focusPoint.equal(t)||(this.focusPointTween=new TimelineMax,this.focusPointTween.to(this.focusPoint,e,{x:t.x,y:t.y,ease:Sine.easeInOut},i?i:0))},s.prototype.shake=function(t,e){this._isShake=!0,this._shakeTime=0,this._shakeTimeEnd=t,this._shakeStrength=e},s.prototype.bulletTime=function(t,e,i,s,n){if(this.inBulletTime=!0,null!=this.bulletTimeTimeline&&this.bulletTimeTimeline.kill(),t!=this._deltaTimeScale){var n=n?n:0;this.bulletTimeTimeline=new TimelineMax,this.bulletTimeTimeline.to(this,i,{_deltaTimeScale:t,ease:Sine.easeInOut},n),s&&this.bulletTimeTimeline.to(this,s,{_deltaTimeScale:1,ease:Sine.easeInOut},n+e)}},s.prototype.gameOver=function(t){this.parent.gameOver(t)},s.prototype.addEffect=function(t){return this.effects.push(t),t.level=this,t},s.prototype.updateEffects=function(){for(var t=0;t<this.effects.length;t++)this.effects[t].update(p3.Timestep.deltaTime)},s.prototype.clearEffects=function(){for(var t=this.effects.length-1;t>=0;t--)this.effects[t].destroy();this.effects=[]},Object.defineProperty(s.prototype,"deltaTime",{get:function(){return this._deltaTime*this._deltaTimeScale}})},{"../common":42,"../editor/BezierPath":43,"../game/LevelLayer":52,"../game/LevelPath":53,"../game/LevelRecord":54,"../game/ObjectManager":55,"../game/objects/avatar/Avatar":70,"../game/objects/avatar/AvatarBlue":71,"../game/objects/avatar/AvatarBrown":72,"../game/objects/avatar/AvatarPink":73,"../game/objects/avatar/AvatarPurple":74,"../game/objects/avatar/AvatarRed":75,"../game/objects/avatar/AvatarYellow":76,"../game/objects/collectibles/ObjectChallenge":78,"../game/objects/collectibles/ObjectChallengeDummy":79,"../game/objects/collectibles/ObjectChallengeParticle":80,"../game/objects/collectibles/ObjectCoin":81,"../game/objects/collectibles/ObjectCollectible":82,"../game/objects/collectibles/ObjectPowerup":83,"../game/objects/decoration/ObjectDecoration":84,"../game/objects/decoration/ObjectHint":85,"../game/objects/triggers/ObjectCameraZoom":86,"../game/objects/triggers/ObjectGameOver":87,"../game/objects/triggers/ObjectLevelEnd":88,"../game/objects/triggers/ObjectTutorial":89}],52:[function(t,e,i){function s(t,e,i){this.level=null,this.id=t,this.parallax="undefined"!=typeof e?e:new PIXI.Point(1,1),this.bg=null,this.config=i?i:null,this.paths=[],this.objects=[],this.childrenPaths=[],this.childrenObjects=[],this.assetManager=p3.AssetManager.instance,PIXI.Container.call(this)}var n=t("../common"),o=t("../game/LevelPath");t("../general/ScrollingContainer");e.exports=s,s.prototype=Object.create(PIXI.Container.prototype),s.prototype.constructor=s,s.prototype.init=function(){if(null!=this.config){for(this.queuePaths(this.config.paths),this.queueObjects(this.config.objects);this.paths.length>0;){var t=new o(this,this.paths[0]);t.init(),t.render(),this.addChild(t),this.childrenPaths.push(t),this.paths.splice(0,1),newElements=!0}var e,i,s=0,a=0,r=0;for(e=0;e<this.objects.length;e++)if("challenge"===this.objects[e].id){for(this.objects[e].data=JSON.parse(this.objects[e].data),"random"===this.objects[e].data.challenge&&(this.objects[e].data.challenge=n.gameChallengeNames[r],r++),this.objects[e].data.forceTexture=this.objects[e].data.challenge,a=this.objects[e].data.id,i=0;i<this.objects.length;i++)"challengeDummy"===this.objects[i].id&&("string"==typeof this.objects[i].data&&(this.objects[i].data=JSON.parse(this.objects[i].data)),this.objects[i].data.id===a&&(this.objects[i].data.forceTexture=this.objects[e].data.challenge));for(i=0;i<this.objects.length;i++)"challengeParticle"===this.objects[i].id&&("string"==typeof this.objects[i].data&&(this.objects[i].data=JSON.parse(this.objects[i].data)),this.objects[i].data.id===a&&(this.objects[i].data.forceParticle=this.objects[e].data.challenge))}for(;this.objects.length>0;)n.pickableList.indexOf(this.objects[0].id)!==-1?(s++,s>n.lastPickedIdx&&this.addObject(this.objects[0].id,this.objects[0])):this.addObject(this.objects[0].id,this.objects[0]),this.objects.splice(0,1)}},s.prototype.update=function(t){if(this.bg)this.x=1*-this.level.x/this.level.zoom,this.y=1*-this.level.y/this.level.zoom,this.bg.tilePosition.x-=t.x*this.parallax.x,this.bg.tilePosition.y-=t.y*this.parallax.y,this.bg.scale=new PIXI.Point(1/this.level.zoom,1/this.level.zoom),this.bg.y=1*this.bg.yOr/this.level.zoom,this.xTiling&&(this.bg.tilePosition.x+=p3.Timestep.deltaTime*this.xTiling);else{0!=this.parallax.x&&(this.x+=t.x*this.parallax.x),0!=this.parallax.y&&(this.y+=t.y*this.parallax.y);for(var e=!1,i=0;i<this.childrenPaths.length;i++)this.childrenPaths[i].update();for(;this.paths.length>0&&this.paths[0].bounds[0]<(n.STAGE_WIDTH-this.level.x)*(1/this.level.zoom)&&this.paths[0].bounds[1]>-this.level.x*(1/this.level.zoom);){var s=new o(this,this.paths[0]);s.init(),s.render(),this.addChild(s),this.childrenPaths.push(s),this.paths.splice(0,1),e=!0}for(var i=this.childrenPaths.length-1;i>=0;i--)(2*this.childrenPaths[i].config.bounds[1]<-this.level.x*(1/this.level.zoom)||this.childrenPaths[i].toDelete)&&(this.childrenPaths[i].dispose(),this.removeChild(this.childrenPaths[i]),this.childrenPaths.splice(i,1));for(var i=0;i<this.childrenObjects.length;i++){var a=this.childrenObjects[i].x;this.childrenObjects[i].collisionRect&&(a+=this.childrenObjects[i].collisionRect.x+this.childrenObjects[i].collisionRect.width),this.childrenObjects[i].removeWhenOutside&&a<-this.level.x*(1/this.level.zoom)&&(this.childrenObjects[i].dispose(),this.level.objectManager.dispose(this.childrenObjects[i]),this.removeChild(this.childrenObjects[i]),this.childrenObjects.splice(i,1))}e&&this.sortChildren()}for(var i=0;i<this.childrenObjects.length;i++)this.childrenObjects[i].update()},s.prototype.queuePaths=function(t,e){for(var i=0;i<t.length;i++){if("undefined"!=typeof e){for(var s=0;s<t[i].points.length;s++)t[i].points[s].x+=e.x,t[i].points[s].y+=e.y;t[i].bounds[0]+=e.x,t[i].bounds[1]+=e.x}this.paths.push(t[i])}this.paths.sort(function(t,e){return t.bounds[0]-e.bounds[0]})},s.prototype.queueObjects=function(t,e){e||(e=new PIXI.Point(0,0));for(var i=0;i<t.length;i++)"undefined"!=typeof e&&(t[i].position.x+=e.x,t[i].position.y+=e.y),this.objects.push(t[i]);this.objects.sort(function(t,e){return t.position.x-e.position.x})},s.prototype.addObject=function(t,e){var i=this.level.objectManager.generate(t);return i.layer=this,i.configure(this.level,e),this.addChild(i),this.childrenObjects.push(i),i},s.prototype.setBackground=function(t,e,i,s){var o=this.assetManager.getTexture(t);this.bg=new PIXI.extras.TilingSprite(o,n.STAGE_WIDTH,o.height*i.y),this.bg.tileScale=new PIXI.Point(i.x,i.y),this.bg.y=e,this.bg.alpha=s,this.addChild(this.bg),this.bg.yOr=e},s.prototype.sortChildren=function(){this.children.sort(function(t,e){return t.config.depth<e.config.depth?-1:t.config.depth>e.config.depth?1:t.config.bounds&&!e.config.bounds?-1:!t.config.bounds&&e.config.bounds?1:t.config.bounds&&e.config.bounds?t.config.bounds[0]<e.config.bounds[0]?-1:1:0})},s.prototype.getPathsByType=function(t){for(var e=[],i=0;i<this.childrenPaths.length;i++)this.childrenPaths[i].type===t&&e.push(this.childrenPaths[i]);return e},s.prototype.addExtraPath=function(t){var e=new o(this,t);return e.init(),e.render(),this.addChild(e),this.childrenPaths.push(e),e.layerArrIndex=this.childrenPaths.length-1,e},s.prototype.removeExtraPath=function(t){t.toDelete=!0}},{"../common":42,"../game/LevelPath":53,"../general/ScrollingContainer":90}],53:[function(t,e,i){function s(t,e){this.assetManager=p3.AssetManager.instance,this.layerArrIndex=null,this.layer=t,this.level=t.level,this.config=e,this.bezier=new n,this.wireframe=null,this.textures=null,this.toDelete=!1,this.assetManager=p3.AssetManager.instance,PIXI.Container.call(this)}var n=(t("../common"),t("../editor/BezierPath"));e.exports=s,s.prototype=Object.create(PIXI.Container.prototype),s.prototype.constructor=s,s.prototype.collisions={SOLID:0,NONE:1,PASSTHROUGH:2},s.prototype.init=function(){for(var t=0;t<this.config.points.length;t++)this.bezier.addPoint(this.config.points[t].x,this.config.points[t].y);if(""!=this.config.data)try{this.config.data=JSON.parse(this.config.data)}catch(e){console.error("Couldn't parse path JSON"),console.info(e)}},s.prototype.update=function(){},s.prototype.render=function(){if(null!=this.textures&&this.removeChild(this.textures),this.textures=new PIXI.Container,this.level.debug&&(null!=this.wireframe&&this.removeChild(this.wireframe),this.wireframe=new PIXI.Graphics),this.bezier.points.length>1){var t=this.bezier.getDrawingPoints();if(""!=this.config.texFill&&!this.isHidden()){for(var e=null,i=[],s=0;s<t.length;s++)i.push(new poly2tri.Point(t[s].x,t[s].y)),(null==e||e<t[s].y)&&(e=t[s].y);this.config.closed?i[0].x==i[i.length-1].x&&i[0].y==i[i.length-1].y&&i.splice(i.length-1,1):(i.push({x:t[t.length-1].x,y:e+this.config.texFillPadding}),i.push({x:t[0].x,y:e+this.config.texFillPadding}));for(var s=0;s<i.length;s++)i[s].x=Math.round(i[s].x),i[s].y=Math.round(i[s].y);try{var n=new poly2tri.SweepContext(i);n.triangulate();var o=n.getTriangles()}catch(a){console.log("Triangulation failed",a)}if(o){var r=this.assetManager.getTexture(this.config.texFill);r.baseTexture.wrapMode=1;for(var h=new Float32Array(6*o.length),l=new Float32Array(6*o.length),u=new Uint16Array(3*o.length),p=this.config.texFillSize,s=0;s<o.length;s++){var c=o[s].getPoints();h.set([c[0].x,c[0].y,c[1].x,c[1].y,c[2].x,c[2].y],6*s),l.set([c[0].x/p,c[0].y/p,c[1].x/p,c[1].y/p,c[2].x/p,c[2].y/p],6*s),u.set([0+3*s,1+3*s,2+3*s],3*s),this.level.debug}var d=new PIXI.mesh.Mesh(r,h,l,u,PIXI.mesh.Mesh.DRAW_MODES.TRIANGLES);this.textures.addChild(d)}}if(""!=this.config.texWall&&!this.isHidden()){for(var g=this.bezier.getGroundSegments(this.config.texWallAngle,360),y=this.config.texWallSize,m=this.config.texWallDelta,f=0,w=0;w<g.length;w++)f+=g[w].points.length-1;var r=this.assetManager.getTexture(this.config.texWall);r.baseTexture.wrapMode=1;for(var h=new Float32Array(8*f),l=new Float32Array(8*f),u=new Uint16Array(6*f),x=0,w=0;w<g.length;w++)for(var v=0,S=0,s=0;s<g[w].normals.length-1;s++){h.set([g[w].points[s].x-g[w].normals[s].x*(y*m),g[w].points[s].y-g[w].normals[s].y*(y*m),g[w].points[s+1].x-g[w].normals[s+1].x*(y*m),g[w].points[s+1].y-g[w].normals[s+1].y*(y*m),g[w].points[s+1].x+g[w].normals[s+1].x*(y*(1-m)),g[w].points[s+1].y+g[w].normals[s+1].y*(y*(1-m)),g[w].points[s].x+g[w].normals[s].x*(y*(1-m)),g[w].points[s].y+g[w].normals[s].y*(y*(1-m))],8*x);var T=new PIXI.Point(g[w].points[s].x-g[w].points[s+1].x,g[w].points[s].y-g[w].points[s+1].y);S=T.getLength(),l.set([v/y,0,(v+S)/y,0,(v+S)/y,1,v/y,1],8*x),u.set([0+4*x,1+4*x,2+4*x,0+4*x,2+4*x,3+4*x],6*x),v+=S,this.level.debug&&(this.wireframe.lineStyle(1,65280,.5),this.wireframe.moveTo(h[8*x+0],h[8*x+0+1]),this.wireframe.lineTo(h[8*x+2],h[8*x+2+1]),this.wireframe.lineTo(h[8*x+4],h[8*x+4+1]),this.wireframe.lineTo(h[8*x+6],h[8*x+6+1]),this.wireframe.lineTo(h[8*x+0],h[8*x+0+1]),this.wireframe.lineTo(h[8*x+4],h[8*x+4+1])),x++}var d=new PIXI.mesh.Mesh(r,h,l,u,PIXI.mesh.Mesh.DRAW_MODES.TRIANGLES);this.textures.addChild(d)}var g=this.bezier.getGroundSegments(0,this.config.texWallAngle,""==this.config.texGroundEdge),b=this.config.texGroundSize,m=this.config.texGroundDelta;if(""!=this.config.texGround&&!this.isHidden()){for(var f=0,w=0;w<g.length;w++)f+=g[w].points.length-1;var r=this.assetManager.getTexture(this.config.texGround);r.baseTexture.wrapMode=1;for(var h=new Float32Array(8*f),l=new Float32Array(8*f),u=new Uint16Array(6*f),x=0,w=0;w<g.length;w++){0!=w||"right"!=this.config.texGroundEdgeSide&&"none"!=this.config.texGroundEdgeSide||(g[w].normals[0]={x:0,y:1}),w!=g.length-1||"left"!=this.config.texGroundEdgeSide&&"none"!=this.config.texGroundEdgeSide||(g[w].normals[g[w].normals.length-1]={x:0,y:1});for(var S=0,s=0;s<g[w].normals.length-1;s++){var T=new PIXI.Point(g[w].points[s].x-g[w].points[s+1].x,g[w].points[s].y-g[w].points[s+1].y);S+=T.getLength()}for(var y=S/Math.max(1,Math.round(S/b)),v=0,S=0,s=0;s<g[w].normals.length-1;s++){h.set([g[w].points[s].x-g[w].normals[s].x*(y*m),g[w].points[s].y-g[w].normals[s].y*(b*m),g[w].points[s+1].x-g[w].normals[s+1].x*(y*m),g[w].points[s+1].y-g[w].normals[s+1].y*(b*m),g[w].points[s+1].x+g[w].normals[s+1].x*(y*(1-m)),g[w].points[s+1].y+g[w].normals[s+1].y*(b*(1-m)),g[w].points[s].x+g[w].normals[s].x*(y*(1-m)),g[w].points[s].y+g[w].normals[s].y*(b*(1-m))],8*x);var T=new PIXI.Point(g[w].points[s].x-g[w].points[s+1].x,g[w].points[s].y-g[w].points[s+1].y);S=T.getLength(),l.set([v/y,0,(v+S)/y,0,(v+S)/y,1,v/y,1],8*x),
u.set([0+4*x,1+4*x,2+4*x,0+4*x,2+4*x,3+4*x],6*x),v+=S,this.level.debug&&(this.wireframe.lineStyle(1,65280,.5),this.wireframe.moveTo(h[8*x+0],h[8*x+0+1]),this.wireframe.lineTo(h[8*x+2],h[8*x+2+1]),this.wireframe.lineTo(h[8*x+4],h[8*x+4+1]),this.wireframe.lineTo(h[8*x+6],h[8*x+6+1]),this.wireframe.lineTo(h[8*x+0],h[8*x+0+1]),this.wireframe.lineTo(h[8*x+4],h[8*x+4+1])),x++}}var d=new PIXI.mesh.Mesh(r,h,l,u,PIXI.mesh.Mesh.DRAW_MODES.TRIANGLES);this.textures.addChild(d)}if(""!=this.config.texGroundEdge&&!this.isHidden()){for(var r=this.assetManager.getTexture(this.config.texGroundEdge),h=new Float32Array(16*g.length),l=new Float32Array(16*g.length),u=new Uint16Array(12*g.length),w=0;w<g.length;w++){for(var S=0,s=0;s<g[w].normals.length-1;s++){var T=new PIXI.Point(g[w].points[s].x-g[w].points[s+1].x,g[w].points[s].y-g[w].points[s+1].y);S+=T.getLength()}var y=S/Math.max(1,Math.round(S/b));if(w>0||"left"==this.config.texGroundEdgeSide||""==this.config.texGroundEdgeSide){var P=g[w].points[0],_=g[w].normals[0],T=new PIXI.Point(g[w].points[0].x-g[w].points[1].x,g[w].points[0].y-g[w].points[1].y);T.normalize(),h.set([P.x-_.x*(y*m)+T.x*y,P.y-_.y*(b*m-T.y*b),P.x-_.x*(y*m),P.y-_.y*(b*m),P.x+_.x*(y*(1-m)),P.y+_.y*(b*(1-m)),P.x+_.x*(y*(1-m))+T.x*y,P.y+_.y*(b*(1-m)+T.y*b)],8*w*2),l.set([0,0,1,0,1,1,0,1],8*w*2),u.set([0+2*w*4,1+2*w*4,2+2*w*4,0+2*w*4,2+2*w*4,3+2*w*4],6*w*2),this.level.debug&&(this.wireframe.lineStyle(1,65280,.5),this.wireframe.moveTo(h[2*w*8+0],h[2*w*8+0+1]),this.wireframe.lineTo(h[2*w*8+2],h[2*w*8+2+1]),this.wireframe.lineTo(h[2*w*8+4],h[2*w*8+4+1]),this.wireframe.lineTo(h[2*w*8+6],h[2*w*8+6+1]),this.wireframe.lineTo(h[2*w*8+0],h[2*w*8+0+1]),this.wireframe.lineTo(h[2*w*8+4],h[2*w*8+4+1]))}if(w<g.length-1||"right"==this.config.texGroundEdgeSide||""==this.config.texGroundEdgeSide){var I=g[w].normals.length-1,P=g[w].points[g[w].normals.length-1],_=g[w].normals[g[w].normals.length-1],T=new PIXI.Point(g[w].points[I].x-g[w].points[I-1].x,g[w].points[I].y-g[w].points[I-1].y);T.normalize(),h.set([P.x-_.x*(y*m)+T.x*y,P.y-_.y*(b*m-T.y*b),P.x-_.x*(y*m),P.y-_.y*(b*m),P.x+_.x*(y*(1-m)),P.y+_.y*(b*(1-m)),P.x+_.x*(y*(1-m))+T.x*y,P.y+_.y*(b*(1-m)+T.y*b)],8*(2*w+1)),l.set([0,0,1,0,1,1,0,1],8*(2*w+1)),u.set([0+4*(2*w+1),1+4*(2*w+1),2+4*(2*w+1),0+4*(2*w+1),2+4*(2*w+1),3+4*(2*w+1)],6*(2*w+1)),this.level.debug&&(this.wireframe.lineStyle(1,65280,.5),this.wireframe.moveTo(h[8*(2*w+1)+0],h[8*(2*w+1)+0+1]),this.wireframe.lineTo(h[8*(2*w+1)+2],h[8*(2*w+1)+2+1]),this.wireframe.lineTo(h[8*(2*w+1)+4],h[8*(2*w+1)+4+1]),this.wireframe.lineTo(h[8*(2*w+1)+6],h[8*(2*w+1)+6+1]),this.wireframe.lineTo(h[8*(2*w+1)+0],h[8*(2*w+1)+0+1]),this.wireframe.lineTo(h[8*(2*w+1)+4],h[8*(2*w+1)+4+1]))}}var d=new PIXI.mesh.Mesh(r,h,l,u,PIXI.mesh.Mesh.DRAW_MODES.TRIANGLES);this.textures.addChild(d)}}if(this.addChild(this.textures),this.level.debug){this.wireframe.moveTo(this.bezier.points[0].x,this.bezier.points[0].y),this.wireframe.lineStyle(2,16711680);for(var s=1;s<this.bezier.points.length;s+=3)this.wireframe.bezierCurveTo(this.bezier.points[s].x,this.bezier.points[s].y,this.bezier.points[s+1].x,this.bezier.points[s+1].y,this.bezier.points[s+2].x,this.bezier.points[s+2].y);for(var s=0;s<this.bezier.points.length;s++)s%3==0&&(s==this.pointIndex?this.wireframe.lineStyle(2,65280,1):this.wireframe.lineStyle(0,16711680,0),this.wireframe.beginFill(16711680),this.wireframe.drawCircle(this.bezier.points[s].x,this.bezier.points[s].y,5),this.wireframe.endFill());this.addChild(this.wireframe)}},s.prototype.dispose=function(){this.iceBridgePS&&this.iceBridgePS.destroy()},s.prototype.isHidden=function(){return""!=this.config.data&&!!this.config.data.hidden},s.prototype.isRollPath=function(){return"roll"==this.type},Object.defineProperty(s.prototype,"type",{get:function(){return this.config.data&&this.config.data.type?this.config.data.type:"default"}})},{"../common":42,"../editor/BezierPath":43}],54:[function(t,e,i){function s(t){PIXI.Container.call(this),this.level=null,this.record=t,this.config={depth:100},this.visible=!1}var n=t("../common"),o=t("./GameObject");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.init=function(t){this.level=t,this.x=this.record*n.config.data.unit;var e=n.assets.getTexture("ui_endless_marker");this._sprite=new PIXI.extras.TilingSprite(e,e.width,n.STAGE_HEIGHT),this._sprite.anchor.set(1,0),this._sprite.blendMode=1,this.addChild(this._sprite)},s.prototype.dispose=function(){},s.prototype.update=function(){this.visible=this.x>this.level.avatar.x-n.STAGE_WIDTH&&this.x<this.level.avatar.x+n.STAGE_WIDTH,this.visible&&(this.y=1*-this.level.y/this.level.zoom,this.scale.set(1/this.level.zoom))}},{"../common":42,"./GameObject":50}],55:[function(t,e,i){function s(t){this.assetManager=p3.AssetManager.instance,this._poolData=t,this._pools=null,this._objects=[],this._id2Pool=[],PIXI.Container.call(this)}t("../common");e.exports=s,s.prototype=Object.create(PIXI.Container.prototype),s.prototype.constructor=s,s.prototype.init=function(){this._pools={};for(var t=0;t<this._poolData.length;t++)this._pools[this._poolData[t].pool]||(this._pools[this._poolData[t].pool]=new p3.ObjectPool(this._poolData[t].base,this._poolData[t].quantity?this._poolData[t].quantity:1,this._poolData[t].args)),this._id2Pool[this._poolData[t].id]=this._poolData[t].pool},s.prototype.generate=function(t){if(this._id2Pool[t]&&this._pools[this._id2Pool[t]])var e=this._pools[this._id2Pool[t]];else var e=this._pools["default"];var i=e.create();return null==i&&(e.expand(2),i=e.create()),this._objects[i.type]||(this._objects[i.type]=[]),this._objects[i.type].push(i),i},s.prototype.dispose=function(t){for(var e in this._pools)if(this._pools[e]._used.indexOf(t)>-1){this._pools[e].free(t);var i=this._objects[t.type].indexOf(t);i!=-1&&this._objects[t.type].splice(i,1)}},s.prototype.getObjectsOfType=function(t){return this._objects[t]?this._objects[t]:[]}},{"../common":42}],56:[function(t,e,i){function s(t,e,i){PIXI.particles.Emitter.call(this,t,e,i)}t("../../common");e.exports=s,s.prototype=Object.create(PIXI.particles.Emitter.prototype),s.prototype.constructor=s,s.prototype.destroy=function(){if(this.world){var t=this.world.effects.indexOf(this);t!=-1&&this.world.effects.splice(t,1)}this.cleanup(),PIXI.particles.Emitter.prototype.destroy.call(this)}},{"../../common":42}],57:[function(t,e,i){function s(t,e,i,s){n.call(this,t,e.textures,e.data),this.updateOwnerPos(i,s),this.playOnceAndDestroy()}var n=(t("../../common"),t("./Effect"));e.exports=s,s.prototype=Object.create(n.prototype),s.prototype.constructor=s},{"../../common":42,"./Effect":56}],58:[function(t,e,i){function s(t,e,i){o.call(this,t,[n.assets.getTexture("race_dust_particle")],n.assets.getJSON("raceDust0")),this.updateOwnerPos(e,i),this.playOnceAndDestroy()}var n=t("../../common"),o=t("./Effect");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s},{"../../common":42,"./Effect":56}],59:[function(t,e,i){function s(t,e,i){o.call(this,t,[n.assets.getTexture("particles_powerup_balloon_00"),n.assets.getTexture("particles_powerup_balloon_01"),n.assets.getTexture("particles_powerup_balloon_02"),n.assets.getTexture("particles_powerup_balloon_03"),n.assets.getTexture("particles_powerup_balloon_04")],n.assets.getJSON("raceBalloons")),this.updateOwnerPos(e,i),this.playOnceAndDestroy()}var n=t("../../common"),o=t("./Effect");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s},{"../../common":42,"./Effect":56}],60:[function(t,e,i){function s(t,e,i){o.call(this,t,[n.assets.getTexture("particles_powerup_banana_00")],n.assets.getJSON("raceBanana")),this.updateOwnerPos(e,i),this.playOnceAndDestroy()}var n=t("../../common"),o=t("./Effect");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s},{"../../common":42,"./Effect":56}],61:[function(t,e,i){function s(t,e,i){this.emitter=new PIXI.particles.Emitter(t,{framerate:8,loop:!0,textures:["particles_powerup_batflap_00.png","particles_powerup_batflap_01.png","particles_powerup_batflap_02.png"]},n.assets.getJSON("raceBats")),this.emitter.particleConstructor=PIXI.particles.AnimatedParticle,this.emitter.updateOwnerPos(e,i),this.emitter.playOnceAndDestroy()}var n=t("../../common");t("./Effect");e.exports=s,s.prototype.update=function(){this.emitter.update(p3.Timestep.deltaTime)},s.prototype.destroy=function(){if(this.world){var t=this.world.effects.indexOf(this.emitter);t!=-1&&this.world.effects.splice(t,1)}this.emitter.cleanup(),this.emitter.destroy()}},{"../../common":42,"./Effect":56}],62:[function(t,e,i){function s(t,e,i){o.call(this,t,[n.assets.getTexture("particles_powerup_bubble_00"),n.assets.getTexture("particles_powerup_bubble_01"),n.assets.getTexture("particles_powerup_bubble_02")],n.assets.getJSON("raceBubbles")),this.updateOwnerPos(e,i),this.playOnceAndDestroy()}var n=t("../../common"),o=t("./Effect");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s},{"../../common":42,"./Effect":56}],63:[function(t,e,i){function s(t,e,i){o.call(this,t,[n.assets.getTexture("particles_powerup_butterfly_00"),n.assets.getTexture("particles_powerup_butterfly_01"),n.assets.getTexture("particles_powerup_butterfly_02")],n.assets.getJSON("raceButterfly")),this.updateOwnerPos(e,i),this.playOnceAndDestroy()}var n=t("../../common"),o=t("./Effect");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s},{"../../common":42,"./Effect":56}],64:[function(t,e,i){function s(t,e,i){o.call(this,t,[n.assets.getTexture("particles_powerup_bowling_ball_00")],n.assets.getJSON("raceCannonball")),this.updateOwnerPos(e,i),this.playOnceAndDestroy()}var n=t("../../common"),o=t("./Effect");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s},{"../../common":42,"./Effect":56}],65:[function(t,e,i){function s(t){o.call(this,t,[n.assets.getTexture("race_dust_particle")],n.assets.getJSON("raceDust"+n.currentLevel)),this.autoUpdate=!1}var n=t("../../common"),o=t("./Effect");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s},{"../../common":42,"./Effect":56}],66:[function(t,e,i){function s(t,e,i){o.call(this,t,[n.assets.getTexture("particles_powerup_tack_00"),n.assets.getTexture("particles_powerup_tack_01")],n.assets.getJSON("raceNails")),this.updateOwnerPos(e,i),this.playOnceAndDestroy()}var n=t("../../common"),o=t("./Effect");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s},{"../../common":42,"./Effect":56}],67:[function(t,e,i){function s(t,e,i){o.call(this,t,[n.assets.getTexture("game_powerup_oil")],n.assets.getJSON("raceOil")),this.updateOwnerPos(e,i),this.playOnceAndDestroy()}var n=t("../../common"),o=t("./Effect");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s},{"../../common":42,"./Effect":56}],68:[function(t,e,i){function s(t,e,i){o.call(this,t,[n.assets.getTexture("particles_smoke_00"),n.assets.getTexture("particles_smoke_01"),n.assets.getTexture("particles_smoke_02"),n.assets.getTexture("particles_smoke_03")],n.assets.getJSON("raceSmoke")),this.updateOwnerPos(e,i),this.playOnceAndDestroy()}var n=t("../../common"),o=t("./Effect");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s},{"../../common":42,"./Effect":56}],69:[function(t,e,i){function s(t,e,i){o.call(this,t,[n.assets.getTexture("particle_powerup_spring_00"),n.assets.getTexture("particle_powerup_spring_01"),n.assets.getTexture("particle_powerup_spring_02")],n.assets.getJSON("raceBalloons")),this.updateOwnerPos(e,i),this.playOnceAndDestroy()}var n=t("../../common"),o=t("./Effect");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s},{"../../common":42,"./Effect":56}],70:[function(t,e,i){function s(t){o.call(this,"avatar"),this.character=t,this.isPlayer=!1,this.animationHolder=null,this.spine=null,this.powerupHolder=null,this.currentPowerup=null,this.powerupDuration={balloons:4,banana:5,bats:5,bowling_ball:5,bubbles:5,butterfly:5,nails:5,nitro:5,oil:5,smoke:5,spring:5},this.jumpTL=null,this.jumpSpeedMultiplier=1,this.flySpeedMultiplier=1,this.powerupTick=-1,this.isFlying=!1,this.powerupTL=null,this.isPlayingPup=!1,this.powerupSprite=null,this.config={depth:0},this.areInputActive=!1,this.isDead=!1,this.isImmortal=!1,this.isGrounded=!1,this.isAccelerating=!0,this.hasLevelEnded=!1,this.isPerformingSpecial=!1,this.canPerformSpecial=!0,this.velocity=new p3.Vector2(0,0),this.oldVelocity=new p3.Vector2(this.velocity.x,this.velocity.y),this.jumpEnabled=!0,this.jumpTime=.45,this.jumpHeightMin=125,this.jumpHeight=300,this.doubleJumpHeightMin=100,this.doubleJumpHeight=200,this.jumpSlopeAngleMax=65,this.isTumbling=!1,this.speedDelta=0;var e=Math.random()*(200*n.config.player.speed)-100*n.config.player.speed;this.bgConst=600*n.config.player.speed,this.runSpeedMin=this.bgConst+e,this.runSpeedMinDefault=.8*this.bgConst,this.runSpeedMax=1.3*this.bgConst,this.slidingSpeedMax=1200,this.accelerationSliding=350,this.accelerationSlopeDown=100,this.accelerationSlopeUp=-500,this.accelerationNormal=-200,this.runSpeed=this.runSpeedMin,this.decceleration=0,this.fallTime=0,this.fallTimeToLand=.7,this.canSlide=!1,this.isSliding=!1,this.timeUnsliding=0,this.timeUnslidingEnd=.2,this.slidingAngleStart=35,this.slidingAngleEnd=15,this.canTumble=!1,this.isTumbling=!1,this.tumbleSpeed=0,this.tumbleSpeedMin=180,this.tumbleSpeedMax=720,this.tumbleSpeedTime=.4,this.tumbleAngle=0,this.tumbleSpeedYStart=0,this.tumbleDeathAngle={min:130,max:130},this.runUpAngle=-10,this.runDownAngle=10,this.rotation=0,this.angleTarget=0,this.angleSpeed=.2,this.collisionCircleRadius=80,this.pickupCircle=null,this.pickupCircleRadius=140,this.attackCircleRadius=150,this.attackCooldown=0,this.attackCooldownMax=.5,this.attackDamageDelay=.1,this.specialCooldown=0,this.specialCooldownMax=2.5,this.focusPointLand={point:new PIXI.Point(.4,.5),time:1.4,delay:0},this.focusPointJump={point:new PIXI.Point(.42,.35),time:.4,delay:0},this.focusPointFall={point:new PIXI.Point(.42,.3),time:.4,delay:.1},this.focusPointSlide={point:new PIXI.Point(.38,.5),time:1,delay:0},this.focusPointDeath={point:new PIXI.Point(.5,.6),time:2,delay:0},this.focusPointEnd={point:new PIXI.Point(.5,.6),time:2,delay:0},this.zoomSlide={zoom:-.25,time:1},this.zoomSlideEnd={zoom:0,time:1.5},this.zoomDeath={zoom:.4,time:2},this.kJumpStart=!1,this.kJumpPressed=!1,this.kJumpEnd=!1,this.kSpecial=!1,this.kAttack=!1,this.jumpStartPoint=new PIXI.Point(0,0),this.animationLock=!1}var n=t("../../../common"),o=t("./RunningEntity"),a=t("../../effects/EffectRaceDust"),r=t("../../effects/EffectRaceBanana"),h=t("../../effects/EffectRaceBallons"),l=t("../../effects/EffectRaceBubbles"),u=t("../../effects/EffectRaceCannonball"),p=t("../../effects/EffectRaceNails"),c=t("../../effects/EffectRaceOil"),d=t("../../effects/EffectRaceSmoke"),g=t("../../effects/EffectRaceSpring");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.init=function(t){if(o.prototype.init.call(this,t),this.zoomSlide.zoom+=this.level.defaultZoom,this.zoomSlideEnd.zoom+=this.level.defaultZoom,this.zoomDeath.zoom+=this.level.defaultZoom,this.collisionCircle=new PIXI.Circle(0,0,this.collisionCircleRadius),this.pickupCircle=new PIXI.Circle((-10),(-50),this.pickupCircleRadius),this.attackCircle=new PIXI.Circle(0,0,this.attackCircleRadius),this.jumpSpeed=2*this.jumpHeight/this.jumpTime,this.gravity=this.jumpSpeed/this.jumpTime,this.jumpTimeMin=Math.sqrt(2*this.jumpHeightMin/this.gravity),this.jumpSpeedMin=this.gravity*this.jumpTimeMin,this.doubleJumpTimeMin=Math.sqrt(2*this.doubleJumpHeightMin/this.gravity),this.doubleJumpSpeedMin=this.gravity*this.doubleJumpTimeMin,this.doubleJumpTime=Math.sqrt(2*this.doubleJumpHeight/this.gravity),this.doubleJumpSpeed=this.gravity*this.doubleJumpTime,this.dustPS=this.level.addEffect(new a(this.animationHolder)),this.dustPS.updateSpawnPos(this.leftWheel.x,this.leftWheel.y+this.leftWheel.height/2),this.dustPS.emit=!1,this.level.debug){this.drawCollision();var e=new PIXI.Graphics;this.addChild(e),e.lineStyle(1,16191773),e.drawCircle(0,0,this.pickupCircle.radius),e.x=this.pickupCircle.x,e.y=this.pickupCircle.y;var i=new PIXI.Graphics;this.addChild(i),i.lineStyle(1,65280),i.drawCircle(0,0,this.attackCircle.radius),i.x=this.attackCircle.x,i.y=this.attackCircle.y}},s.prototype.getPowerupTexture=function(t){return n.assetManager.getTexture("game_powerup_"+t)},s.prototype.animatePowerupIn=function(){this.powerupSprite.scaleXY=0,this.powerupSprite.visible=!0,TweenMax.to(this.powerupSprite.scale,.2,{x:1,y:1,ease:Back.easeOut})},s.prototype.animatePowerup=function(){this.isPlayingPup||(this.powerupTL&&this.powerupTL.kill(),this.powerupTL=new TimelineMax({onStart:function(){this.isPlayingPup=!0},onStartScope:this,onComplete:function(){this.isPlayingPup=!1},onCompleteScope:this}),this.powerupTL.to(this.powerupSprite.scale,.2,{x:.9,y:.9,repeat:1,yoyo:!0,ease:Sine.easeInOut}))},s.prototype.animatePowerupOut=function(){TweenMax.to(this.powerupSprite.scale,.2,{x:0,y:0,ease:Back.easeIn,onComplete:function(){this.powerupSprite.visible=!1},onCompleteScope:this})},s.prototype.startPowerup=function(t){switch(this.powerupTick=this.powerupDuration[t],this.currentPowerup=t,null===this.powerupSprite?this.powerupSprite=new WRE.Sprite({texture:this.getPowerupTexture(t),anchorX:.5,anchorY:1}).addTo(this.powerupHolder):this.powerupSprite.texture=this.getPowerupTexture(t),this.animatePowerupIn(),t){case"balloons":this.jumpStartPoint.y=this.y,this.isFlying=!0,this.flySpeedMultiplier=1.3,this.isGrounded=!1,this.velocity.y-=this.jumpSpeed/4,this.shadow.visible=!1,this.dustPS.emit=!1}},s.prototype.stopPowerup=function(t){this.powerupTick!==-1&&(this.isFlying=!1,this.currentPowerup=null,this.animatePowerupOut(),this.jumpSpeedMultiplier=1,this.flySpeedMultiplier=1,this.powerupTick=-1,this.level.parent.onPowerupEnd())},s.prototype.executePowerup=function(){if(null!==this.currentPowerup)switch(this.animatePowerup(),this.currentPowerup){case"balloons":this.jumpStartPoint.y=this.y,this.level.addEffect(new h(this.emitterHolder,0,0)),this.shadow.visible=!1,this.dustPS.emit=!1,this.velocity.y-=this.jumpSpeed/8,this.level.parent.onPowerupBalloons();break;case"banana":this.level.addEffect(new r(this.emitterHolder,(-100),0)),this.level.parent.onPowerupBanana();break;case"bats":this.level.parent.onPowerupBats();break;case"bubbles":this.level.addEffect(new l(this.emitterHolder,(-100),0)),this.level.parent.onPowerupBubbles();break;case"butterfly":this.level.parent.onPowerupButterfly();break;case"bowling_ball":this.level.addEffect(new u(this.emitterHolder,(-100),0)),this.level.parent.onPowerupCannonball();break;case"nails":this.level.addEffect(new p(this.emitterHolder,(-100),0)),this.level.parent.onPowerupNails();break;case"nitro":this.level.parent.onPowerupNitro();break;case"oil":this.level.addEffect(new c(this.emitterHolder,(-100),0)),this.level.parent.onPowerupOil();break;case"smoke":this.level.addEffect(new d(this.emitterHolder,(-100),0)),this.level.parent.onPowerupSmoke();break;case"spring":this.level.addEffect(new g(this.level.getLayer("challenges"),this.x+50,this.y)),this.jump()}},s.prototype.dropNails=function(){},s.prototype.update=function(){this.distance;this.powerupTick>=0&&(this.powerupTick-=this.level.deltaTime,this.powerupTick<0&&this.stopPowerup()),this.isDead||(this.isGrounded&&!this.isFlying?(this.jumpSpeedMultiplier=1,this.shadow.visible=!0):this.hasLevelEnded&&this.isGrounded?this.setAnimation("idle",!0):this.isTumbling?(this.tumbleSpeed+=(this.tumbleSpeedMax-this.tumbleSpeedMin)*(this.level.deltaTime/this.tumbleSpeedTime),this.tumbleSpeed>this.tumbleSpeedMax&&(this.tumbleSpeed=this.tumbleSpeedMax),this.kJumpPressed?("tumble"!=this.currentAnimation&&""!=this.currentAnimation&&this.level.changeFocusPoint(this.focusPointFall.point,this.focusPointFall.time,this.focusPointFall.delay),this.setAnimation("tumble",!0),this.tumbleAngle+=this.tumbleSpeed*this.level.deltaTime*PIXI.DEG_TO_RAD):this.isTumbling=!1):this.isGrounded&&!this.isSliding&&this.collisionPoint?this.setAnimation("run",!0):!this.isGrounded&&this.isAccelerating&&this.velocity.y>0&&"fall"!=this.currentAnimation&&""!=this.currentAnimation&&(this.setAnimation("fall",!1),this.level.changeFocusPoint(this.focusPointFall.point,this.focusPointFall.time,this.focusPointFall.delay))),this.oldVelocity.x=this.velocity.x,this.oldVelocity.y=this.velocity.y;var t=this.isSliding,e=this.isGrounded;if(this.isDead||this.hasLevelEnded)this.dustPS.emit=!1,this.velocity.x=0;else if(n.raceStarted){this.kJumpStart=this.kJumpStart||n.keyboard.getKeyJustPressed(n.keyboard.KEY_UP),this.kJumpEnd=this.kJumpEnd||n.keyboard.getKeyJustReleased(n.keyboard.KEY_UP),this.kSpecial=this.kSpecial||n.keyboard.getKeyJustPressed(n.keyboard.KEY_C),this.kAttack=this.kAttack||n.keyboard.getKeyJustPressed(n.keyboard.KEY_X),this.areInputActive&&(this.kJumpStart&&this.isGrounded?(this.jump(),this.kJumpPressed=!0):this.kJumpEnd?(this.jumpEnd(),this.kJumpPressed=!1):this.kSpecial?this.special():this.kAttack&&this.attack()),this.kJumpStart=!1,this.kJumpEnd=!1,this.kSpecial=!1,this.kAttack=!1;var i=this.accelerationNormal;this.isSliding?i=this.accelerationSliding:this.isGrounded&&this.collisionPoint.angle*PIXI.RAD_TO_DEG>this.runDownAngle?i=this.accelerationSlopeDown:this.isGrounded&&this.collisionPoint.angle*PIXI.RAD_TO_DEG<this.runUpAngle&&(i=this.accelerationSlopeUp),this.isAccelerating?this.runSpeed+=i*this.level.deltaTime:this.runSpeed=this.velocity.x*(1-this.decceleration);var s=this.runSpeedMax;this.isSliding&&(s=this.slidingSpeedMax),this.runSpeed=this.runSpeedMin,this.velocity.x=this.runSpeed*this.jumpSpeedMultiplier*this.flySpeedMultiplier,!this.isSliding&&this.canSlide&&this.isGrounded&&this.collisionPoint.angle*PIXI.RAD_TO_DEG>this.slidingAngleStart?(this.specialEnd(),this.isSliding=!0,this.timeUnsliding=0,this.setAnimation("slide",!0),this.angleTarget=0,this.level.changeZoom(this.zoomSlide.zoom,this.zoomSlide.time),this.level.changeFocusPoint(this.focusPointSlide.point,this.focusPointSlide.time,this.focusPointSlide.delay)):this.isSliding&&(!this.collisionPoint||this.collisionPoint.angle*PIXI.RAD_TO_DEG<this.slidingAngleEnd)&&(this.timeUnsliding+=this.level.deltaTime,this.setAnimation("slide",!0),this.timeUnsliding>=this.timeUnslidingEnd&&(this.isSliding=!1,this.setAnimation("run",!0))),!this.isSliding}if(this.isFlying?this.velocity.y+=this.gravity/4*this.level.deltaTime:this.velocity.y+=this.gravity*this.level.deltaTime,this.velocity.y>=this.gravity/2&&(this.velocity.y=this.gravity/2),this.isTumbling)this.animationHolder.rotation=this.angleTarget;else{var o=Math.atan2(Math.sin(this.angleTarget-this.animationHolder.rotation),Math.cos(this.angleTarget-this.animationHolder.rotation));this.animationHolder.rotation=this.animationHolder.rotation+o*this.angleSpeed}this.move(this.velocity),this.isGrounded&&(this.velocity.y=0,e||this.isDead||this.land()),!this.isGrounded&&this.velocity.y>0?this.fallTime+=this.level.deltaTime:0!=this.fallTime&&(this.fallTime=0),this.isPlayer?this.collisions():this.nonPlayerCollisions(),this.isDead||(t&&!this.isSliding&&(this.level.changeZoom(this.zoomSlideEnd.zoom,this.zoomSlideEnd.time),this.isGrounded&&this.level.changeFocusPoint(this.focusPointLand.point,this.focusPointLand.time,this.focusPointLand.delay)),this.canTumble&&!this.isGrounded&&this.oldVelocity.y<=this.tumbleSpeedYStart&&this.velocity.y>this.tumbleSpeedYStart&&this.kJumpPressed&&(this.isTumbling=!0,this.tumbleAngle=0,this.canTumble=!1,this.canDoubleJump=!1,this.tumbleSpeed=this.tumbleSpeedMin)),this.velocity.x<300?this.dustPS.emit&&(this.dustPS.emit=!1):!this.dustPS.emit&&this.isGrounded&&(this.dustPS.emit=!0,this.shadow.visible=!1)},s.prototype.collisions=function(){if(!this.isDead){var t=new PIXI.Circle(this.x+this.collisionCircle.x,this.y+this.collisionCircle.y,this.collisionCircle.radius),e=new PIXI.Circle(this.x+this.pickupCircle.x,this.y+this.pickupCircle.y,this.pickupCircle.radius),i=[{id:"coin",circle:e},{id:"powerup",circle:e},{id:"challenge",circle:e},{id:"challengeParticle",circle:e},{id:"collectible",circle:e},{id:"camera_zoom",circle:t},{id:"level_end",circle:t},{id:"level_bullettime",circle:t},{id:"tutorial",circle:t},{id:"decoration_interactive",circle:t}],s=null,n=this.level.objectManager.getObjectsOfType("challenge");for(var o in n)if(n[o].collidable&&this.checkPowerupCollision(e,n[o])){s=n[o];break}for(var a in i){var n=this.level.objectManager.getObjectsOfType(i[a].id);for(var o in n)if(n[o].collidable&&this.checkCollision(i[a].circle,n[o]))switch(i[a].id){case"coin":n[o].pickup(this),this.level.parent.onPickableHit();break;case"powerup":n[o].pickup(this),s=null,this.level.parent.onPowerupHit(n[o].cfgData);break;case"challenge":n[o].pickup(this),this.level.parent.onChallengeHit(n[o].config.data);break;case"challengeParticle":n[o].hit(this),this.level.parent.onChallengeParticleHit(n[o].config.data);break;case"collectible":n[o].pickup(this);break;case"level_end":this.onLevelEnd(),n[o].hit(this);break;default:n[o].hit(this)}}null!==s&&(s.collidable=!1,this.level.parent.onPowerupNotHit(n[o].cfgData))}},s.prototype.nonPlayerCollisions=function(){if(!this.isDead){var t=new PIXI.Circle(this.x+this.collisionCircle.x,this.y+this.collisionCircle.y,this.collisionCircle.radius),e=[{id:"level_end",circle:t}];for(var i in e){var s=this.level.objectManager.getObjectsOfType(e[i].id);for(var n in s)if(s[n].collidable&&this.checkCollision(e[i].circle,s[n]))switch(e[i].id){case"level_end":this.onOpponentLevelEnd()}}}},s.prototype.animateJump=function(){this.jumpTL&&this.jumpTL.kill(),this.jumpTL=new TimelineMax,this.jumpTL.to(this.animationHolder.scale,.1,{y:.8,ease:Cubic.easeOut}),this.jumpTL.to(this.animationHolder.scale,1.2,{y:1.1,ease:Elastic.easeOut}),this.jumpTL.to(this.animationHolder.scale,.3,{y:1,ease:Cubic.easeOut})},s.prototype.funJump=function(){!this.isDead&&this.jumpEnabled&&this.isGrounded&&(this.jumpStartPoint.y=this.y,n.audio.play(["carJump0","carJump1"]),this.isGrounded=!1,this.velocity.y=.75*-this.jumpSpeed,this.setAnimation("jump",!1),this.shadow.visible=!1,this.dustPS.emit=!1)},s.prototype.jump=function(){!this.isDead&&this.jumpEnabled&&this.isGrounded&&(this.collisionPoint&&this.collisionPoint.angle*PIXI.RAD_TO_DEG<-this.jumpSlopeAngleMax||(this.jumpStartPoint.y=this.y,this.level.parent.onPowerupSpring(),this.canDoubleJump=!0,this.isSliding=!1,this.rotation=0,this.angleTarget=0,this.isGrounded=!1,this.canTumble=!0,this.jumpSpeedMultiplier=1.5,this.animateJump(),this.velocity.y=-this.jumpSpeed,this.setAnimation("jump",!1),this.shadow.visible=!1,this.dustPS.emit=!1,this.level.changeFocusPoint(this.focusPointJump.point,this.focusPointJump.time,this.focusPointJump.delay)))},s.prototype.jumpEnd=function(){this.isDead||this.isGrounded||this.canDoubleJump&&this.velocity.y<-this.jumpSpeedMin&&this.velocity.y>=-this.jumpSpeed&&(this.velocity.y=-this.jumpSpeedMin)},s.prototype.land=function(){this.animationLock=!1,this.canDoubleJump=!1,this.fallTime>=this.fallTimeToLand?(this.setAnimation("land",!1),this.level.shake(.25,new PIXI.Point(8,12)),this.distance>5):this.distance>5,this.isTumbling=!1;Math.floor((this.animationHolder.rotation*PIXI.RAD_TO_DEG+180)/360);this.animationHolder.rotation=this.animationHolder.rotation%(2*Math.PI);var t=this.animationHolder.rotation*PIXI.RAD_TO_DEG;this.tumbleDeathAngle.min!=this.tumbleDeathAngle.max&&t>this.tumbleDeathAngle.min&&t<this.tumbleDeathAngle.max&&!this.isImmortal&&this.death(),this.level.changeFocusPoint(this.focusPointLand.point,this.focusPointLand.time,this.focusPointLand.delay)},s.prototype.setAnimation=function(t,e){this.animationLock||(this.currentAnimation=t)},s.prototype.addAnimation=function(t,e){this.animationLock||(this.currentAnimation=t)},s.prototype.checkIfAnimationExists=function(t){for(var e=0;e<this.spine.spineData.animations.length;e++)if(this.spine.spineData.animations[e].name==t)return!0;return!1},s.prototype.stop=function(t){"undefined"==typeof t&&(t=1),this.decceleration=Math.max(0,Math.min(1,t)),this.isAccelerating=!1},s.prototype.resume=function(){this.isAccelerating=!0},s.prototype.specialEnd=function(){},s.prototype.canAttack=function(){return!this.isDead},s.prototype.attack=function(){this.canAttack()&&this.setAnimation("attack")},s.prototype.onLevelEnd=function(){this.level.changeFocusPoint(this.focusPointEnd.point,this.focusPointEnd.time,this.focusPointEnd.delay),this.animationLock=!1,this.jumpEnabled=!1,this.canPerformSpecial=!1,this.isPerformingSpecial=!1,this.level.gameOver(!0)},s.prototype.onOpponentLevelEnd=function(){this.animationLock=!1,this.jumpEnabled=!1,this.canPerformSpecial=!1,this.isPerformingSpecial=!1},s.prototype.onDeath=function(t){this.isDead||this.isImmortal&&!t||(this.isDead=!0,this.isSliding=!1,this.animationLock=!1,this.stopSound(),t?this.level.focusYActive=!1:(this.gravity=0,this.velocity.y=0,this.setAnimation("death",!0),this.level.changeZoom(this.zoomDeath.zoom,this.zoomDeath.time),this.level.changeFocusPoint(this.focusPointDeath.point,this.focusPointDeath.time,this.focusPointDeath.delay)),this.level.gameOver(!1))},s.prototype.showBonusText=function(t){this.bonusText.visible=!0,this.bonusText.label.text=t,this.bonusText.coin.x=this.bonusText.label.width+5,this._bonusTimeline&&this._bonusTimeline.kill(),this._bonusTimeline=this.level.scene.createTimeline(),this._bonusTimeline.fromTo(this.bonusText,1,{y:-50},{y:-150,ease:Sine.easeInOut},0),this._bonusTimeline.fromTo(this.bonusText,.5,{alpha:0},{alpha:1,ease:Sine.easeOut},0),this._bonusTimeline.to(this.bonusText,.5,{alpha:0,ease:Sine.easeIn},.5)},Object.defineProperty(s.prototype,"distance",{get:function(){return Math.floor(this.x/n.config.data.unit)}}),Object.defineProperty(s.prototype,"hasPowerup",{get:function(){return this.powerupTick!==-1}})},{"../../../common":42,"../../effects/EffectRaceBallons":59,"../../effects/EffectRaceBanana":60,"../../effects/EffectRaceBubbles":62,"../../effects/EffectRaceCannonball":64,"../../effects/EffectRaceDust":65,"../../effects/EffectRaceNails":66,"../../effects/EffectRaceOil":67,"../../effects/EffectRaceSmoke":68,"../../effects/EffectRaceSpring":69,"./RunningEntity":77}],71:[function(t,e,i){function s(t,e){o.call(this,t),this.animationHolder=new PIXI.Container,this.addChild(this.animationHolder),this.spine=(new WRE.Container).addTo(this.animationHolder),this.collisionCircleRadius=144,this.chasis=new WRE.Sprite({texture:n.assetManager.getTexture("car_"+this.character),y:e,anchorX:.5,anchorY:.35}).addTo(this.spine),this.shadow=new WRE.Sprite({texture:n.assetManager.getTexture("car_"+this.character+"_shadow"),anchorX:.5,anchorY:0,scaleX:1.6,x:this.chasis.x,y:156}).addTo(this.spine),this.leftWheel=new WRE.Sprite({texture:n.assetManager.getTexture("car_"+this.character+"_wheel"),anchorXY:.5,x:-86,y:70+e}).addTo(this.spine),this.rightWheel=new WRE.Sprite({texture:n.assetManager.getTexture("car_"+this.character+"_wheel"),anchorXY:.5,x:86,y:70+e}).addTo(this.spine),this.powerupHolder=new WRE.Container({x:0,y:10}).addTo(this),this.emitterHolder=new WRE.Container({x:0,y:10}).addTo(this.animationHolder,0)}var n=t("../../../common"),o=t("./Avatar");t("../../Force");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.init=function(t){o.prototype.init.call(this,t)},s.prototype.update=function(){o.prototype.update.call(this),this.leftWheel.rotation+=n.config.wheelSpeedMultiplier*this.velocity.x,this.rightWheel.rotation+=n.config.wheelSpeedMultiplier*this.velocity.x}},{"../../../common":42,"../../Force":49,"./Avatar":70}],72:[function(t,e,i){function s(t,e){o.call(this,t),this.animationHolder=new PIXI.Container,this.addChild(this.animationHolder),this.spine=(new WRE.Container).addTo(this.animationHolder),this.collisionCircleRadius=170,this.chasis=new WRE.Sprite({texture:n.assetManager.getTexture("car_"+this.character),y:e,anchorX:.5,anchorY:.35}).addTo(this.spine),this.shadow=new WRE.Sprite({texture:n.assetManager.getTexture("car_"+this.character+"_shadow"),
anchorX:.5,anchorY:0,x:this.chasis.x,y:167}).addTo(this.spine),this.leftWheel=new WRE.Sprite({texture:n.assetManager.getTexture("car_"+this.character+"_wheel_back"),anchorXY:.5,x:-78,y:132+e}).addTo(this.spine),this.rightWheel=new WRE.Sprite({texture:n.assetManager.getTexture("car_"+this.character+"_wheel_front"),anchorXY:.5,x:70,y:150+e}).addTo(this.spine),this.powerupHolder=new WRE.Container({x:0,y:80}).addTo(this),this.emitterHolder=new WRE.Container({x:0,y:80}).addTo(this.animationHolder,0)}var n=t("../../../common"),o=t("./Avatar");t("../../Force");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.init=function(t){o.prototype.init.call(this,t)},s.prototype.update=function(){o.prototype.update.call(this),this.leftWheel.rotation+=n.config.wheelSpeedMultiplier*this.velocity.x,this.rightWheel.rotation+=n.config.wheelSpeedMultiplier*this.velocity.x}},{"../../../common":42,"../../Force":49,"./Avatar":70}],73:[function(t,e,i){function s(t,e){o.call(this,t),this.animationHolder=new PIXI.Container,this.addChild(this.animationHolder),this.spine=(new WRE.Container).addTo(this.animationHolder),this.collisionCircleRadius=74,this.leftWheel=new WRE.Sprite({texture:n.assetManager.getTexture("car_pink_wheel"),anchorXY:.5,x:-88,y:44+e}).addTo(this.spine),this.rightWheel=new WRE.Sprite({texture:n.assetManager.getTexture("car_pink_wheel"),anchorXY:.5,x:94,y:44+e}).addTo(this.spine),this.chasis=new WRE.Sprite({texture:n.assetManager.getTexture("car_"+this.character),y:e,anchorX:.5,anchorY:.28}).addTo(this.spine),this.shadow=new WRE.Sprite({texture:n.assetManager.getTexture("car_"+this.character+"_shadow"),anchorX:.5,anchorY:0,x:this.chasis.x,y:this.chasis.y+(1-this.chasis.anchorY)*this.chasis.texture.height}).addTo(this.spine,0),this.powerupHolder=new WRE.Container({x:0,y:10}).addTo(this),this.emitterHolder=new WRE.Container({x:0,y:10}).addTo(this.animationHolder,0)}var n=t("../../../common"),o=t("./Avatar");t("../../Force");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.init=function(t){o.prototype.init.call(this,t)},s.prototype.update=function(){o.prototype.update.call(this),this.leftWheel.rotation+=n.config.wheelSpeedMultiplier*this.velocity.x,this.rightWheel.rotation+=n.config.wheelSpeedMultiplier*this.velocity.x}},{"../../../common":42,"../../Force":49,"./Avatar":70}],74:[function(t,e,i){function s(t,e){o.call(this,t),this.animationHolder=new PIXI.Container,this.addChild(this.animationHolder),this.spine=(new WRE.Container).addTo(this.animationHolder),this.collisionCircleRadius=86,this.leftWheel=new WRE.Sprite({texture:n.assetManager.getTexture("car_"+this.character+"_wheel"),anchorXY:.5,x:-92,y:60+e}).addTo(this.spine),this.rightWheel=new WRE.Sprite({texture:n.assetManager.getTexture("car_"+this.character+"_wheel"),anchorXY:.5,x:84,y:60+e}).addTo(this.spine),this.chasis=new WRE.Sprite({texture:n.assetManager.getTexture("car_"+this.character),y:e,anchorX:.5,anchorY:.35}).addTo(this.spine),this.shadow=new WRE.Sprite({texture:n.assetManager.getTexture("car_"+this.character+"_shadow"),anchorX:.5,anchorY:0,x:this.chasis.x,y:this.chasis.y+(1-this.chasis.anchorY)*this.chasis.texture.height}).addTo(this.spine,0),this.powerupHolder=new WRE.Container({x:-20,y:0}).addTo(this),this.emitterHolder=new WRE.Container({x:-20,y:0}).addTo(this.animationHolder,0)}var n=t("../../../common"),o=t("./Avatar");t("../../Force");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.init=function(t){o.prototype.init.call(this,t)},s.prototype.update=function(){o.prototype.update.call(this),this.leftWheel.rotation+=n.config.wheelSpeedMultiplier*this.velocity.x,this.rightWheel.rotation+=n.config.wheelSpeedMultiplier*this.velocity.x}},{"../../../common":42,"../../Force":49,"./Avatar":70}],75:[function(t,e,i){function s(t,e){o.call(this,t),this.animationHolder=new PIXI.Container,this.addChild(this.animationHolder),this.spine=(new WRE.Container).addTo(this.animationHolder),this.collisionCircleRadius=66,this.chasis=new WRE.Sprite({texture:n.assetManager.getTexture("car_"+this.character),y:e,anchorX:.5,anchorY:.35}).addTo(this.spine),this.shadow=new WRE.Sprite({texture:n.assetManager.getTexture("car_"+this.character+"_shadow"),anchorX:.5,anchorY:0,x:this.chasis.x,y:this.chasis.y+(1-this.chasis.anchorY)*this.chasis.texture.height}).addTo(this.spine),this.leftWheel=new WRE.Sprite({texture:n.assetManager.getTexture("car_"+this.character+"_wheel_back"),anchorXY:.5,x:-90,y:20+e}).addTo(this.spine),this.rightWheel=new WRE.Sprite({texture:n.assetManager.getTexture("car_"+this.character+"_wheel_front"),anchorXY:.5,x:120,y:48+e}).addTo(this.spine),this.powerupHolder=new WRE.Container({x:-20,y:10}).addTo(this),this.emitterHolder=new WRE.Container({x:-20,y:10}).addTo(this.animationHolder,0)}var n=t("../../../common"),o=t("./Avatar");t("../../Force");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.init=function(t){o.prototype.init.call(this,t)},s.prototype.update=function(){o.prototype.update.call(this),this.leftWheel.rotation+=n.config.wheelSpeedMultiplier*this.velocity.x,this.rightWheel.rotation+=n.config.wheelSpeedMultiplier*this.velocity.x}},{"../../../common":42,"../../Force":49,"./Avatar":70}],76:[function(t,e,i){function s(t,e){o.call(this,t),this.animationHolder=new PIXI.Container,this.addChild(this.animationHolder),this.spine=(new WRE.Container).addTo(this.animationHolder),this.collisionCircleRadius=66,this.chasis=new WRE.Sprite({texture:n.assetManager.getTexture("car_"+this.character),y:e,anchorX:.5,anchorY:.35}).addTo(this.spine),this.shadow=new WRE.Sprite({texture:n.assetManager.getTexture("car_"+this.character+"_shadow"),anchorX:.5,anchorY:0,x:this.chasis.x,y:this.chasis.y+(1-this.chasis.anchorY)*this.chasis.texture.height}).addTo(this.spine),this.leftWheel=new WRE.Sprite({texture:PIXI.Texture.EMPTY,anchorXY:.5,x:-120,y:30+e,visible:!1}).addTo(this.spine),this.rightWheel=new WRE.Sprite({texture:PIXI.Texture.EMPTY,anchorXY:.5,visible:!1}).addTo(this.spine),this.powerupHolder=new WRE.Container({x:-10,y:0}).addTo(this),this.emitterHolder=new WRE.Container({x:-10,y:0}).addTo(this.animationHolder,0)}var n=t("../../../common"),o=t("./Avatar");t("../../Force");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.init=function(t){o.prototype.init.call(this,t)},s.prototype.update=function(){o.prototype.update.call(this)}},{"../../../common":42,"../../Force":49,"./Avatar":70}],77:[function(t,e,i){function s(t,e){n.call(this,t,!!e),this.level=null,this.allowPathCollisions=!0,this.allowPassthroughCollisions=!0,this.collisionPoint=null,this.angleTarget=0,this.velocity=new PIXI.Point,this.currentPath=null,this.ignoreRollPaths=!1,this.canStickToCeiling=!1}var n=(t("../../../common"),t("../../GameObject"));e.exports=s,s.prototype=Object.create(n.prototype),s.prototype.constructor=s,s.prototype.init=function(t){this.level=t},s.prototype.move=function(t){var e=Math.sign(t.y),t=new PIXI.Point(t.x*this.level.deltaTime,t.y*this.level.deltaTime);if(t.y>0&&t.y>=this.collisionCircle.radius&&(t.y=.99*this.collisionCircle.radius),this.isGrounded&&this.collisionPoint&&(t.x*=Math.cos(this.collisionPoint.angle)),this.x+=t.x,this.y+=t.y,this.allowPathCollisions){var i=this.isGrounded;this.collisionPoint=null,this.isGrounded=!1,this.level.debug&&(this.wireframe&&this.level.removeChild(this.wireframe),this.wireframe=new PIXI.Graphics,this.wireframe.config={depth:1e3},this.level.addChild(this.wireframe)),this.currentPath=null;for(var s=0;s<this.level.layers.length;s++)for(var n=0;n<this.level.layers[s].childrenPaths.length;n++)if(1==this.level.layers[s].childrenPaths[n].config.collisions&&!(this.level.layers[s].childrenPaths[n].config.bounds[0]>this.x+this.collisionCircle.x+2*this.collisionCircle.radius||this.level.layers[s].childrenPaths[n].config.bounds[1]<this.x+this.collisionCircle.x-2*this.collisionCircle.radius))for(var o=this.level.layers[s].childrenPaths[n].bezier.getDrawingPoints(),a=0;a<o.length-1;a++){var r=o[a+1],h=o[a];if(!(r.x>h.x)){var l=new PIXI.Point(this.x+this.collisionCircle.x,this.y+this.collisionCircle.y);if(!(r.x>l.x+this.collisionCircle.radius||h.x<l.x-this.collisionCircle.radius||r.y>l.y+this.collisionCircle.radius&&h.y>l.y+this.collisionCircle.radius||r.y<l.y-this.collisionCircle.radius&&h.y<l.y-this.collisionCircle.radius)){var u=new PIXI.Point(o[a+1].x-o[a].x,o[a+1].y-o[a].y),p=new PIXI.Point(u.x,u.y);p.normalize();var c=new PIXI.Point(this.x+this.collisionCircle.x-o[a].x,this.y+this.collisionCircle.y-o[a].y),d=c.dotProduct(u)/u.getLength(),g=new PIXI.Point(p.x*d,p.y*d);g.x!=u.x?(g.x/u.x<0&&(g=new PIXI.Point(0,0)),g.x/u.x>1&&(g=new PIXI.Point(u.x,u.y))):(g.y/u.y<0&&(g=new PIXI.Point(0,0)),g.y/u.y>1&&(g=new PIXI.Point(u.x,u.y)));var y=new PIXI.Point(g.x-c.x,g.y-c.y),m=y.getLength();this.level.debug&&(this.wireframe.lineStyle(8,16777215,1),this.wireframe.moveTo(r.x,r.y),this.wireframe.lineTo(h.x,h.y),this.wireframe.lineStyle(6,255,1),this.wireframe.moveTo(l.x,l.y),this.wireframe.lineTo(l.x-c.x,l.y-c.y)),m<this.collisionCircle.radius&&(this.level.debug&&(this.wireframe.lineStyle(3,16711935,1),this.wireframe.moveTo(o[a].x,o[a].y),this.wireframe.lineTo(o[a].x+g.x,o[a].y+g.y),this.wireframe.lineStyle(5,65280,1),this.wireframe.moveTo(o[a].x+g.x,o[a].y+g.y),this.wireframe.lineTo(o[a].x+g.x-y.x,o[a].y+g.y-y.y)),this.velocity.y<=0&&(this.y+=this.collisionCircle.radius-m-.001,this.velocity.y=0),0!=t.x&&(this.x+=-Math.sign(t.x)*(this.collisionCircle.radius-m)))}}}for(var f=80,s=0;s<this.level.layers.length;s++)for(var n=0;n<this.level.layers[s].childrenPaths.length;n++){var w=this.level.layers[s].childrenPaths[n];if(w.config.collisions!=w.collisions.SOLID&&(w.config.collisions!=w.collisions.PASSTHROUGH||!(e<0)&&this.allowPassthroughCollisions)&&!(w.config.bounds[0]>this.x+this.collisionCircle.x+2*this.collisionCircle.radius||w.config.bounds[1]<this.x+this.collisionCircle.x-2*this.collisionCircle.radius||this.ignoreRollPaths&&this.level.layers[s].childrenPaths[n].isRollPath())){var o=w.bezier.getDrawingPoints();do for(var x=!1,a=0;a<o.length-1;a++){var r=o[a],h=o[a+1];if(!(r.x>h.x)){var l=new PIXI.Point(this.x+this.collisionCircle.x,this.y+this.collisionCircle.y);if(!(r.x>l.x+this.collisionCircle.radius||h.x<l.x-this.collisionCircle.radius||r.y>l.y+this.collisionCircle.radius&&h.y>l.y+this.collisionCircle.radius||r.y<l.y-this.collisionCircle.radius&&h.y<l.y-this.collisionCircle.radius)){var v=Math.atan2(h.y-r.y,h.x-r.x);if(!(Math.abs(v*PIXI.RAD_TO_DEG)>=f)){if(2==w.config.collisions){if(!i){var S=(l.x-r.x)/(h.x-r.x);S=Math.min(Math.max(S,0),1);var T=r.y+(h.y-r.y)*S;if(l.y>T)continue}if(Math.abs(v*PIXI.RAD_TO_DEG)>=w.config.texWallAngle)continue}var u=new PIXI.Point(o[a+1].x-o[a].x,o[a+1].y-o[a].y),p=new PIXI.Point(u.x,u.y);p.normalize();var c=new PIXI.Point(this.x+this.collisionCircle.x-o[a].x,this.y+this.collisionCircle.y-o[a].y),d=c.dotProduct(u)/u.getLength(),g=new PIXI.Point(p.x*d,p.y*d);if(g.x!=u.x){if(g.x/u.x<0&&!i)continue;g.x/u.x<0&&(g=new PIXI.Point(0,0)),g.x/u.x>1&&(g=new PIXI.Point(u.x,u.y))}else g.y/u.y<0&&(g=new PIXI.Point(0,0)),g.y/u.y>1&&(g=new PIXI.Point(u.x,u.y));var y=new PIXI.Point(g.x-c.x,g.y-c.y),m=y.getLength();if(this.level.debug&&(this.wireframe.lineStyle(8,16777215,1),this.wireframe.moveTo(r.x,r.y),this.wireframe.lineTo(h.x,h.y),this.wireframe.lineStyle(6,255,1),this.wireframe.moveTo(l.x,l.y),this.wireframe.lineTo(l.x-c.x,l.y-c.y)),m<this.collisionCircle.radius){this.level.debug&&(this.wireframe.lineStyle(3,16711935,1),this.wireframe.moveTo(o[a].x,o[a].y),this.wireframe.lineTo(o[a].x+g.x,o[a].y+g.y),this.wireframe.lineStyle(5,16711680,1),this.wireframe.moveTo(o[a].x+g.x,o[a].y+g.y),this.wireframe.lineTo(o[a].x+g.x-y.x,o[a].y+g.y-y.y)),t.y=0,this.isGrounded=!0,y.normalize();var b=y.angle(new PIXI.Point(0,1)),P=Math.sin(Math.acos(Math.sin(b)))*this.collisionCircle.radius-Math.abs(Math.cos(b))*m;this.y-=P,this.collisionPoint={path:w,position:{x:o[a].x+g.x,y:o[a].y+g.y},angle:v},this.currentPath=w,P>=1&&(x=!0)}}}}}while(x)}}if(!this.isGrounded&&i&&t.y>0){for(var f=80,_=50,I=_,s=0;s<this.level.layers.length;s++)for(var n=0;n<this.level.layers[s].childrenPaths.length;n++){var w=this.level.layers[s].childrenPaths[n];if(w.config.collisions!=w.collisions.SOLID&&(w.config.collisions!=w.collisions.PASSTHROUGH||!(e<0)&&this.allowPassthroughCollisions)&&!(w.config.bounds[0]>this.x+this.collisionCircle.x+2*this.collisionCircle.radius||w.config.bounds[1]<this.x+this.collisionCircle.x-2*this.collisionCircle.radius||this.ignoreRollPaths&&this.level.layers[s].childrenPaths[n].isRollPath()))for(var o=w.bezier.getDrawingPoints(),a=0;a<o.length-1;a++){var r=o[a],h=o[a+1];if(!(r.x>h.x)){var l=new PIXI.Point(this.x+this.collisionCircle.x,this.y+this.collisionCircle.y);if(!(r.x>l.x+this.collisionCircle.radius||h.x<l.x-this.collisionCircle.radius||r.y<l.y-this.collisionCircle.radius&&h.y<l.y-this.collisionCircle.radius||r.y>l.y+this.collisionCircle.radius+50&&h.y>l.y+this.collisionCircle.radius+50)){var v=Math.atan2(h.y-r.y,h.x-r.x);if(!(Math.abs(v*PIXI.RAD_TO_DEG)>f)){var u=new PIXI.Point(o[a+1].x-o[a].x,o[a+1].y-o[a].y),p=new PIXI.Point(u.x,u.y);p.normalize();var c=new PIXI.Point(this.x+this.collisionCircle.x-o[a].x,this.y+this.collisionCircle.y-o[a].y),d=c.dotProduct(u)/u.getLength(),g=new PIXI.Point(p.x*d,p.y*d);g.x!=u.x?(g.x/u.x<0&&(g=new PIXI.Point(0,0)),g.x/u.x>1&&(g=new PIXI.Point(u.x,u.y))):(g.y/u.y<0&&(g=new PIXI.Point(0,0)),g.y/u.y>1&&(g=new PIXI.Point(u.x,u.y)));var y=new PIXI.Point(g.x-c.x,g.y-c.y),m=y.getLength();if(this.level.debug&&(this.wireframe.lineStyle(8,16777215,1),this.wireframe.moveTo(r.x,r.y),this.wireframe.lineTo(h.x,h.y),this.wireframe.lineStyle(6,255,1),this.wireframe.moveTo(l.x,l.y),this.wireframe.lineTo(l.x-c.x,l.y-c.y)),y.y>0&&m>this.collisionCircle.radius){this.level.debug&&(this.wireframe.lineStyle(3,16711935,1),this.wireframe.moveTo(o[a].x,o[a].y),this.wireframe.lineTo(o[a].x+g.x,o[a].y+g.y),this.wireframe.lineStyle(5,16737792,1),this.wireframe.moveTo(o[a].x+g.x,o[a].y+g.y),this.wireframe.lineTo(o[a].x+g.x-y.x,o[a].y+g.y-y.y)),y.normalize();var b=y.angle(new PIXI.Point(0,1)),C=m-this.collisionCircle.radius,M=C*Math.sin(b)/Math.cos(b),k=Math.sqrt(Math.pow(C,2)+Math.pow(M,2));k<I&&(I=k,this.collisionPoint={path:w,position:{x:o[a].x+g.x,y:o[a].y+g.y},angle:v},this.currentPath=w)}}}}}}I<_&&(t.y=0,this.y+=I,this.isGrounded=!0)}this.isGrounded&&(!this.isSliding||0!=this.timeUnsliding||null!=this.vehicle&&this.isSliding)?this.angleTarget=this.collisionPoint.angle:this.isTumbling?this.angleTarget=0+this.tumbleAngle:this.angleTarget=0}},s.prototype.checkPowerupCollision=function(t,e){if(null===e.collisionRectangle)return!1;var i=[];i.push(new PIXI.Point(e.x+e.collisionRectangle.x,e.y+e.collisionRectangle.y)),i.push(new PIXI.Point(e.x+e.collisionRectangle.x+e.collisionRectangle.width,e.y+e.collisionRectangle.y)),i.push(new PIXI.Point(e.x+e.collisionRectangle.x+e.collisionRectangle.width,e.y+e.collisionRectangle.y+e.collisionRectangle.height)),i.push(new PIXI.Point(e.x+e.collisionRectangle.x,e.y+e.collisionRectangle.y+e.collisionRectangle.height));for(var s=new PIXI.Point(e.x,e.y),n=0;n<i.length;n++)i[n].rotateAround(s,e.rotation);for(var n=0;n<i.length;n++)if(Math.sqrt(Math.pow(i[n].x-t.x,2)+Math.pow(i[n].y-t.y,2))<t.radius)return!0;for(var o=0;o<i.length;o++){var a=new PIXI.Point(i[(o+1)%i.length].x-i[o].x,i[(o+1)%i.length].y-i[o].y),r=new PIXI.Point(a.x,a.y);r.normalize();var h=new PIXI.Point(t.x-i[o].x,t.y-i[o].y),l=h.dotProduct(a)/a.getLength(),u=new PIXI.Point(r.x*l,r.y*l);if(u.x!=a.x){if(u.x/a.x<0)continue;if(u.x/a.x>1)continue}else{if(u.y/a.y<0)continue;if(u.y/a.y>1)continue}var p=new PIXI.Point(u.x-h.x,u.y-h.y),c=p.getLength();if(c<t.radius)return!0}},s.prototype.checkCollision=function(t,e){if(null!=e.collisionRect){var i=[];i.push(new PIXI.Point(e.x+e.collisionRect.x,e.y+e.collisionRect.y)),i.push(new PIXI.Point(e.x+e.collisionRect.x+e.collisionRect.width,e.y+e.collisionRect.y)),i.push(new PIXI.Point(e.x+e.collisionRect.x+e.collisionRect.width,e.y+e.collisionRect.y+e.collisionRect.height)),i.push(new PIXI.Point(e.x+e.collisionRect.x,e.y+e.collisionRect.y+e.collisionRect.height));for(var s=new PIXI.Point(e.x,e.y),n=0;n<i.length;n++)i[n].rotateAround(s,e.rotation);for(var n=0;n<i.length;n++)if(Math.sqrt(Math.pow(i[n].x-t.x,2)+Math.pow(i[n].y-t.y,2))<t.radius)return!0;for(var o=0;o<i.length;o++){var a=new PIXI.Point(i[(o+1)%i.length].x-i[o].x,i[(o+1)%i.length].y-i[o].y),r=new PIXI.Point(a.x,a.y);r.normalize();var h=new PIXI.Point(t.x-i[o].x,t.y-i[o].y),l=h.dotProduct(a)/a.getLength(),u=new PIXI.Point(r.x*l,r.y*l);if(u.x!=a.x){if(u.x/a.x<0)continue;if(u.x/a.x>1)continue}else{if(u.y/a.y<0)continue;if(u.y/a.y>1)continue}var p=new PIXI.Point(u.x-h.x,u.y-h.y),c=p.getLength();if(c<t.radius)return!0}}else if(null!=e.collisionCircle){var d=new PIXI.Circle(e.x,e.y,e.collisionCircle.radius),g=new PIXI.Point(t.x-d.x,t.y-d.y);return Math.sqrt(Math.pow(g.x,2)+Math.pow(g.y,2))<=t.radius+d.radius}return!1}},{"../../../common":42,"../../GameObject":50}],78:[function(t,e,i){function s(){o.call(this,"challenge",!0),this.level=null,this.config=null,this.sprite=null,this.attracted=!1,this.attractionTimeMax=.3,this.attractionPosition=new PIXI.Point,this.timeline=null,this.forceTexture=null}var n=t("../../../common"),o=t("../../GameObject");t("../../effects/EffectCoinCollect");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.init=function(t){null==this.sprite&&(this.sprite=new PIXI.Sprite,this.addChild(this.sprite))},s.prototype.reset=function(){this.level=null,this.config=null},s.prototype.configure=function(t,e){this.level=t,this.config=e,this.x=this.config.position.x,this.y=this.config.position.y,this.sprite.texture=n.assets.getTexture("level_challenge"),this.sprite.anchor.set(.5),this.sprite.scale.set(1),this.sprite.visible=!0,this.collidable=!0,this.sprite.visible=!0,this.attracted=!1,this.attractionTarget=0,this.attractionTime=0,this.rotation=Math.random(0,360)*PIXI.DEG_TO_RAD,this.collisionCircle=new PIXI.Circle((-50),(-50),120),""!==this.config.data&&("string"==typeof this.config.data?this.cfgData=JSON.parse(this.config.data):this.cfgData=this.config.data,this.cfgData.forceTexture&&"undefined"!==this.cfgData.forceTexture&&(this.sprite.texture=n.assets.getTexture("challenge_"+this.cfgData.forceTexture+"_icon"))),this.timeline?this.timeline.resume():(this.sprite.position.set(0,-10),this.timeline=this.level.scene.createTimeline(),this.timeline.to(this.sprite,.75,{y:10,ease:Sine.easeInOut,repeat:-1,yoyo:!0},Math.random()),this.timeline.to(this.sprite.scale,.5,{x:1.3,y:1.3,ease:Sine.easeInOut,repeat:-1,yoyo:!0},0)),this.level.debug&&this.drawCollision()},s.prototype.dispose=function(){this.timeline&&this.timeline.pause()},s.prototype.update=function(){if(this.attracted){if(this.attractionTime+=p3.Timestep.deltaTime,this.attractionTime>this.attractionTimeMax)return this.sprite.visible=!1,void(this.attracted=!1);this.x=this.attractionPosition.x+(this.attractionTarget.x-20-this.attractionPosition.x)*this.attractionTime/this.attractionTimeMax,this.y=this.attractionPosition.y+(this.attractionTarget.y-20-this.attractionPosition.y)*this.attractionTime/this.attractionTimeMax,this.sprite.scale.x=1-this.attractionTime/this.attractionTimeMax,this.sprite.scale.y=1-this.attractionTime/this.attractionTimeMax}},s.prototype.pickup=function(t){if(this.collidable)return this.collidable=!1,this.attracted=!0,this.attractionTarget=t,this.attractionPosition.set(this.x,this.y),!0}},{"../../../common":42,"../../GameObject":50,"../../effects/EffectCoinCollect":58}],79:[function(t,e,i){function s(){o.call(this,"challengeDummy",!0),this.level=null,this.config=null,this.sprite=null,this.attracted=!1,this.attractionTimeMax=.3,this.attractionPosition=new PIXI.Point,this.forceTexture=null}var n=t("../../../common"),o=t("../../GameObject");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.init=function(t){null==this.sprite&&(this.sprite=new PIXI.Sprite,this.addChild(this.sprite))},s.prototype.reset=function(){this.level=null,this.config=null},s.prototype.configure=function(t,e){this.level=t,this.config=e,this.x=this.config.position.x,this.y=this.config.position.y,this.sprite.texture=n.assets.getTexture("editor_challengeDummy"),this.sprite.anchor.set(.5,.9),this.sprite.scale.set(1),this.sprite.visible=!0,this.collidable=!1,this.sprite.visible=!0,this.attracted=!1,this.attractionTarget=0,this.attractionTime=0,this.rotation=Math.random(0,360)*PIXI.DEG_TO_RAD,this.collisionCircle=new PIXI.Circle(0,0,55),""!==this.config.data&&("string"==typeof this.config.data?this.cfgData=JSON.parse(this.config.data):this.cfgData=this.config.data,this.cfgData.forceTexture&&"undefined"!==this.cfgData.forceTexture&&("way"===this.cfgData.forceTexture&&"way"===n.previousChallenge?this.sprite.texture=n.assets.getTexture("challenge_"+this.cfgData.forceTexture+"_object_clean"):this.sprite.texture=n.assets.getTexture("challenge_"+this.cfgData.forceTexture+"_object"))),this.level.debug&&this.drawCollision()},s.prototype.setTexture=function(t){this.sprite.texture=n.assets.getTexture("challenge_icon_"+t)},s.prototype.update=function(){},s.prototype.pickup=function(t){},s.prototype.dispose=function(){}},{"../../../common":42,"../../GameObject":50}],80:[function(t,e,i){function s(){o.call(this,"challengeParticle",!0),this.level=null,this.config=null}var n=t("../../../common"),o=t("../../GameObject"),a=t("../../effects/EffectChallengeParticle");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.init=function(t){null==this.sprite&&(this.sprite=new PIXI.Sprite,this.addChild(this.sprite))},s.prototype.reset=function(){this.level=null,this.config=null},s.prototype.configure=function(t,e){this.level=t,this.config=e,this.x=this.config.position.x,this.y=this.config.position.y,this.sprite.texture=n.assets.getTexture(this.config.texture),this.sprite.anchor.set(this.config.anchor.x,this.config.anchor.y),this.sprite.scale.set(this.config.scale.x,this.config.scale.y),""!==this.config.data&&("string"==typeof this.config.data?this.cfgData=JSON.parse(this.config.data):this.cfgData=this.config.data,this.cfgData.forceParticle&&"undefined"!==this.cfgData.forceParticle),this.collidable=!0,this.sprite.visible=this.level.debug;var i=this.sprite.width,s=this.sprite.height;this.collisionRect=new PIXI.Rectangle(-i*this.sprite.anchor.x,-this.sprite.anchor.y*s,i,s)},s.prototype.dispose=function(){},s.prototype.update=function(){},s.prototype.hit=function(){if(this.collidable){this.collidable=!1;var t={textures:[n.assets.getTexture("race_dust_particle")],data:n.assets.getJSON("raceDust0")};this.level.addEffect(new a(this.level,t,this.x,this.y))}}},{"../../../common":42,"../../GameObject":50,"../../effects/EffectChallengeParticle":57}],81:[function(t,e,i){function s(){o.call(this,"coin",!0),this.level=null,this.config=null,this.sprite=null,this.attracted=!1,this.attractionTimeMax=.3,this.attractionPosition=new PIXI.Point,this.timeline=null}var n=t("../../../common"),o=t("../../GameObject"),a=t("../../effects/EffectCoinCollect");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.init=function(t){null==this.sprite&&(this.sprite=new PIXI.Sprite,this.addChild(this.sprite))},s.prototype.reset=function(){this.level=null,this.config=null},s.prototype.configure=function(t,e){this.level=t,this.config=e,this.x=this.config.position.x,this.y=this.config.position.y,this.sprite.texture=n.assets.getTexture("level_pickable"),this.sprite.anchor.set(.5),this.sprite.scale.set(1),this.sprite.visible=!0,this.collidable=!0,this.sprite.visible=!0,this.attracted=!1,this.attractionTarget=0,this.attractionTime=0,this.rotation=Math.random(0,360)*PIXI.DEG_TO_RAD,this.collisionCircle=new PIXI.Circle(0,0,55),this.timeline?this.timeline.resume():(this.sprite.position.set(0,-10),this.timeline=this.level.scene.createTimeline(),this.timeline.to(this.sprite,.75,{y:10,ease:Sine.easeInOut,repeat:-1,yoyo:!0},Math.random()),this.timeline.to(this.sprite.scale,.5,{x:1.3,y:1.3,ease:Sine.easeInOut,repeat:-1,yoyo:!0},0)),this.level.debug&&this.drawCollision()},s.prototype.dispose=function(){this.timeline&&this.timeline.pause()},s.prototype.update=function(){if(this.attracted){if(this.attractionTime+=p3.Timestep.deltaTime,this.attractionTime>this.attractionTimeMax)return this.sprite.visible=!1,void(this.attracted=!1);this.x=this.attractionPosition.x+(this.attractionTarget.x-20-this.attractionPosition.x)*this.attractionTime/this.attractionTimeMax,this.y=this.attractionPosition.y+(this.attractionTarget.y-20-this.attractionPosition.y)*this.attractionTime/this.attractionTimeMax,this.sprite.scale.x=1-this.attractionTime/this.attractionTimeMax,this.sprite.scale.y=1-this.attractionTime/this.attractionTimeMax}},s.prototype.pickup=function(t){if(this.collidable)return this.collidable=!1,this.attracted=!0,this.attractionTarget=t,this.attractionPosition.set(this.x,this.y),this.level.addEffect(new a(this.level,this.x,this.y)),!0}},{"../../../common":42,"../../GameObject":50,"../../effects/EffectCoinCollect":58}],82:[function(t,e,i){function s(){o.call(this,"collectible",!0),this.level=null,this.config=null,this.sprite=null,this.attracted=!1,this.attractionTimeMax=.3,this.attractionPosition=new PIXI.Point,this.timeline=null}var n=t("../../../common"),o=t("../../GameObject");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.init=function(t){null==this.sprite&&(this.glow=new PIXI.Sprite(n.assets.getTexture("ui_rays")),this.glow.anchor.set(.5),this.glow.tint=16759296,this.addChild(this.glow),this.sprite=new PIXI.Sprite,this.addChild(this.sprite))},s.prototype.reset=function(){this.level=null,this.config=null},s.prototype.configure=function(t,e){this.level=t,this.config=e,this.index=t.collectibleIndex,t.collectibleIndex++,this.x=this.config.position.x,this.y=this.config.position.y,this.sprite.texture=n.assets.getTexture("ui_progress_icon"),this.sprite.anchor.set(.5),this.sprite.scale.set(1),this.sprite.visible=!0,this.glow.rotation=0,this.glow.scale.set(1),this.glow.visible=!0,this.glow.alpha=1,this.collidable=!n.storage_data.isCollectibleCollected(this.level.levelIndex,this.index),this.sprite.visible=!0,this.sprite.alpha=this.collidable?1:.5,this.glow.visible=this.collidable,this.attracted=!1,this.attractionTarget=0,this.attractionTime=0,this.rotation=Math.random(0,360)*PIXI.DEG_TO_RAD,this.collisionCircle=new PIXI.Circle(0,0,55),this.collidable&&(this.sprite.position.set(0,-10),this.timeline&&this.timeline.kill(),this.timeline=this.level.scene.createTimeline(),this.timeline.to(this.sprite,1,{y:20,ease:Sine.easeInOut,repeat:-1,yoyo:!0,onUpdateScope:this,onUpdate:function(){this.glow.y=this.sprite.y}},0),this.timeline.to(this.glow,8,{rotation:2*Math.PI,ease:Linear.easeNone,repeat:-1},0),this.timeline.to(this.glow.scale,.5,{x:1.5,y:1.5,ease:Quad.easeInOut,repeat:-1,yoyo:!0},0)),this.level.debug&&this.drawCollision()},s.prototype.dispose=function(){this.timeline&&this.timeline.kill()},s.prototype.update=function(){if(this.attracted){if(this.attractionTime+=p3.Timestep.deltaTime,this.attractionTime>this.attractionTimeMax)return this.sprite.visible=!1,void(this.attracted=!1);this.x=this.attractionPosition.x+(this.attractionTarget.x-20-this.attractionPosition.x)*this.attractionTime/this.attractionTimeMax,this.y=this.attractionPosition.y+(this.attractionTarget.y-20-this.attractionPosition.y)*this.attractionTime/this.attractionTimeMax,this.sprite.scale.x=1-this.attractionTime/this.attractionTimeMax,this.sprite.scale.y=1-this.attractionTime/this.attractionTimeMax}},s.prototype.pickup=function(t){if(this.collidable)return this.collidable=!1,this.attracted=!0,this.attractionTarget=t,this.attractionPosition.set(this.x,this.y),this.playSound("sfx_usb_pickup_00"),this.timeline&&(this.timeline.kill(),this.timeline=this.level.scene.createTimeline(),this.timeline.to(this.glow.scale,this.attractionTimeMax,{x:0,y:0,ease:Quad.easeOut},0)),n.storage_data.collectibleCollected(this.level.levelIndex,this.index),this.level.scene.gameUI.updateCollectibles(),!0}},{"../../../common":42,"../../GameObject":50}],83:[function(t,e,i){function s(){o.call(this,"powerup",!0),this.level=null,this.config=null,this.sprite=null,this.attracted=!1,this.attractionTimeMax=.3,this.attractionPosition=new PIXI.Point,this.timeline=null}var n=t("../../../common"),o=t("../../GameObject"),a=t("../../effects/EffectCoinCollect");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.init=function(t){null==this.sprite&&(this.sprite=new PIXI.Sprite,this.addChild(this.sprite))},s.prototype.reset=function(){this.level=null,this.config=null},s.prototype.configure=function(t,e){this.level=t,this.config=e,this.x=this.config.position.x,this.y=this.config.position.y,this.sprite.texture=n.assets.getTexture("powerup_mystery_object_00"),this.sprite.anchor.set(.5),this.sprite.scale.set(1),this.sprite.visible=!0,this.collidable=!0,this.sprite.visible=!0,this.attracted=!1,this.attractionTarget=0,this.attractionTime=0,this.rotation=Math.random(0,360)*PIXI.DEG_TO_RAD,this.collisionCircle=new PIXI.Circle(0,0,50),this.collisionRectangle=new PIXI.Rectangle((-30),(-50),60,(-4e3)),""!==this.config.data&&("string"==typeof this.config.data?this.cfgData=JSON.parse(this.config.data):this.cfgData=this.config.data,this.cfgData.forceTexture&&"undefined"!==this.cfgData.forceTexture&&(this.sprite.texture=n.assets.getTexture("powerup_"+this.cfgData.forceTexture))),this.timeline?this.timeline.resume():(this.sprite.position.set(0,-10),this.timeline=this.level.scene.createTimeline(),this.timeline.to(this.sprite,.75,{y:10,ease:Sine.easeInOut,repeat:-1,yoyo:!0},Math.random()),this.timeline.to(this.sprite.scale,.5,{x:1.3,y:1.3,ease:Sine.easeInOut,repeat:-1,yoyo:!0},0)),this.level.debug&&this.drawCollision()},s.prototype.dispose=function(){this.timeline&&this.timeline.pause()},s.prototype.update=function(){if(this.attracted){if(this.attractionTime+=p3.Timestep.deltaTime,this.attractionTime>this.attractionTimeMax)return this.sprite.visible=!1,void(this.attracted=!1);this.x=this.attractionPosition.x+(this.attractionTarget.x-20-this.attractionPosition.x)*this.attractionTime/this.attractionTimeMax,this.y=this.attractionPosition.y+(this.attractionTarget.y-20-this.attractionPosition.y)*this.attractionTime/this.attractionTimeMax,this.sprite.scale.x=1-this.attractionTime/this.attractionTimeMax,this.sprite.scale.y=1-this.attractionTime/this.attractionTimeMax}},s.prototype.pickup=function(t){if(this.collidable)return this.collidable=!1,this.attracted=!0,this.attractionTarget=t,this.attractionPosition.set(this.x,this.y),this.level.addEffect(new a(this.level,this.x,this.y)),this.sprite.texture=n.assets.getTexture("powerup_mystery_object_01"),!0}},{"../../../common":42,"../../GameObject":50,"../../effects/EffectCoinCollect":58}],84:[function(t,e,i){function s(t){this.level=null,this.config=null,this.sprite=null,this.effectData=t,this.effects=[],o.call(this,"decoration",!0)}var n=t("../../../common"),o=t("../../GameObject");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.init=function(t){null==this.sprite&&(this.sprite=new PIXI.Sprite,this.addChild(this.sprite))},s.prototype.reset=function(){for(this.level=null,this.config=null,this.visible=!0;this.effects.length>0;)this.effects[0].dispose(),this.removeChild(this.effects[0]),this.effects.splice(0,1)},s.prototype.configure=function(t,e){if(this.level=t,this.config=e,this.x=this.config.position.x,this.y=this.config.position.y,this.sprite.texture=n.assets.getTexture(this.config.texture),this.sprite.anchor.set(this.config.anchor.x,this.config.anchor.y),this.sprite.scale.set(this.config.scale.x,this.config.scale.y),this.sprite.rotation=this.config.rotation*PIXI.DEG_TO_RAD,""!=this.config.data)try{
JSON.parse(this.config.data)}catch(i){console.error("Decoration data error %s",this.config.data)}for(var s in this.effectData){var o;o&&(o.x=this.effectData[s].x,o.y=this.effectData[s].y,o.depth=this.effectData[s].depth,this.effects.push(o))}for(this.effects.sort(function(t,e){return t.depth-e.depth}),s=0;s<this.effects.length;s++)this.effects[s].depth>0&&(0==s||this.effects[s-1].depth<0)&&this.addChild(this.sprite),this.addChild(this.effects[s]),s==this.effects.length-1&&this.effects[s].depth<=0&&this.addChild(this.sprite)},s.prototype.dispose=function(){},s.prototype.update=function(){}},{"../../../common":42,"../../GameObject":50}],85:[function(t,e,i){function s(t){this.level=null,this.config=null,this.sprite=null,this.effectData=t,this.effects=[],o.call(this,"hint",!0)}var n=t("../../../common"),o=t("../../GameObject");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.init=function(t){null==this.sprite&&(this.sprite=new PIXI.Sprite,this.sprite.anchor.set(.5),this.addChild(this.sprite),this.portrait=new PIXI.Sprite,this.portrait.anchor.set(.5),this.sprite.addChild(this.portrait))},s.prototype.reset=function(){this.level=null,this.config=null,this.visible=!0},s.prototype.configure=function(t,e){this.level=t,this.config=e;var i;if(""!=this.config.data)try{i=JSON.parse(this.config.data)}catch(s){console.error("Decoration data error %s",this.config.data)}this.x=this.config.position.x,this.y=this.config.position.y,this.sprite.texture=n.assets.getTexture(e.id),this.portrait.texture=n.assets.getTexture("hint_"+(i.character||"captain_america")),this.timeline?this.timeline.resume():(this.timeline=this.level.scene.createTimeline(),this.timeline.fromTo(this.sprite,.25,{y:-5},{y:5,ease:Sine.easeInOut,repeat:-1,yoyo:!0},0))},s.prototype.dispose=function(){this.timeline&&this.timeline.pause()},s.prototype.update=function(){}},{"../../../common":42,"../../GameObject":50}],86:[function(t,e,i){function s(){o.call(this,"camera_zoom",!0),this.level=null,this.config=null,this.cameraZoom={zoom:0,time:.4,delay:0}}var n=t("../../../common"),o=t("../../GameObject");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.init=function(t){null==this.sprite&&(this.sprite=new PIXI.Sprite,this.addChild(this.sprite))},s.prototype.reset=function(){this.level=null,this.config=null},s.prototype.configure=function(t,e){if(this.level=t,this.config=e,this.x=this.config.position.x,this.y=this.config.position.y,this.sprite.texture=n.assets.getTexture(this.config.texture),this.sprite.anchor.set(this.config.anchor.x,this.config.anchor.y),this.sprite.scale.set(this.config.scale.x,this.config.scale.y),this.rotation=this.config.rotation*PIXI.DEG_TO_RAD,""!=this.config.data)try{var i=JSON.parse(this.config.data);this.cameraZoom.zoom=i.zoom?i.zoom:this.cameraZoom.zoom,this.cameraZoom.time=i.time?i.time:this.cameraZoom.time,this.cameraZoom.delay=i.delay?i.delay:this.cameraZoom.delay}catch(s){console.error("Camera zoom object data error %s",this.config.data)}this.collidable=!0,this.sprite.visible=this.level.debug;var o=this.sprite.width,a=this.sprite.height;this.collisionRect=new PIXI.Rectangle(-o*this.sprite.anchor.x,-this.sprite.anchor.y*a,o,a)},s.prototype.dispose=function(){},s.prototype.update=function(){},s.prototype.hit=function(){this.collidable&&(this.collidable=!1,this.level.changeZoom(this.level.defaultZoom+this.cameraZoom.zoom,this.cameraZoom.time,this.cameraZoom.delay))}},{"../../../common":42,"../../GameObject":50}],87:[function(t,e,i){function s(t){o.call(this,"obstacle",!0),this.level=null,this.config=null,this.fallenOffLevel=!0}var n=t("../../../common"),o=t("../../GameObject");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.init=function(t){null==this.sprite&&(this.sprite=new PIXI.Sprite,this.addChild(this.sprite))},s.prototype.reset=function(){this.level=null,this.config=null},s.prototype.configure=function(t,e){this.level=t,this.config=e,this.x=this.config.position.x,this.y=this.config.position.y,this.sprite.texture=n.assets.getTexture(this.config.texture),this.sprite.anchor.set(this.config.anchor.x,this.config.anchor.y),this.sprite.scale.set(this.config.scale.x,this.config.scale.y),this.rotation=this.config.rotation*PIXI.DEG_TO_RAD,this.collidable=!0,this.sprite.visible=this.level.debug;var i=this.sprite.width,s=this.sprite.height;this.collisionRect=new PIXI.Rectangle(-i*this.sprite.anchor.x,-this.sprite.anchor.y*s,i,s)},s.prototype.dispose=function(){},s.prototype.update=function(){},s.prototype.hit=function(){}},{"../../../common":42,"../../GameObject":50}],88:[function(t,e,i){function s(t){o.call(this,"level_end",!0),this.level=null,this.config=null,this.gameOver=!t}var n=t("../../../common"),o=t("../../GameObject");t("../../Force");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.init=function(t){null==this.sprite&&(this.sprite=new PIXI.Sprite,this.addChild(this.sprite))},s.prototype.reset=function(){this.level=null,this.config=null},s.prototype.configure=function(t,e){this.level=t,this.config=e,this.x=this.config.position.x,n.finishLine=this.config.position.x,this.y=this.config.position.y,this.sprite.texture=n.assets.getTexture(this.config.texture),this.sprite.anchor.set(this.config.anchor.x,this.config.anchor.y),this.sprite.scale.set(this.config.scale.x,this.config.scale.y),this.sprite.scale.y=100,this.rotation=this.config.rotation*PIXI.DEG_TO_RAD,this.collidable=!0,this.sprite.visible=this.level.debug;var i=this.sprite.width,s=this.sprite.height;this.collisionRect=new PIXI.Rectangle(-i*this.sprite.anchor.x,-this.sprite.anchor.y*s,i,s)},s.prototype.dispose=function(){},s.prototype.update=function(){},s.prototype.hit=function(){this.collidable&&(this.collidable=!1)}},{"../../../common":42,"../../Force":49,"../../GameObject":50}],89:[function(t,e,i){function s(){o.call(this,"tutorial",!1),this.level=null,this.config=null,this.text="",this.time=5}var n=t("../../../common"),o=t("../../GameObject");e.exports=s,s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.init=function(t){null==this.sprite&&(this.sprite=new PIXI.Sprite,this.addChild(this.sprite))},s.prototype.reset=function(){this.level=null,this.config=null},s.prototype.configure=function(t,e){if(this.level=t,this.config=e,this.x=this.config.position.x,this.y=this.config.position.y,this.sprite.texture=n.assets.getTexture(this.config.texture),this.sprite.anchor.set(this.config.anchor.x,this.config.anchor.y),this.sprite.scale.set(this.config.scale.x,this.config.scale.y),this.rotation=this.config.rotation*PIXI.DEG_TO_RAD,""!=this.config.data)try{var i=JSON.parse(this.config.data);this.text=i.text,void 0!=i.time&&(this.time=i.time)}catch(s){console.error("Tutorial object data error %s",this.config.data)}this.collidable=!0,this.sprite.visible=this.level.debug;var o=this.sprite.width,a=this.sprite.height;this.collisionRect=new PIXI.Rectangle(-o*this.sprite.anchor.x,-this.sprite.anchor.y*a,o,a)},s.prototype.dispose=function(){},s.prototype.update=function(){},s.prototype.hit=function(){if(this.collidable&&(this.collidable=!1,this.text)){var t=n.copy[this.text]?n.copy[this.text][n.language]:this.text;this.level.scene.gameUI.tutorial(t,this.time)}}},{"../../../common":42,"../../GameObject":50}],90:[function(t,e,i){function s(t,e,i,s,o,a,r,h,l,u){this.texture=t,this.imageScale=e||1,this.xBuffer=i||0,this.yBuffer=s||0,this.boundWidth=o||n.STAGE_WIDTH,this.boundHeight=a||n.STAGE_HEIGHT,this.repeatX=void 0==r||r,this.repeatY=void 0==h||h,this.offsetX=l||0,this.offsetY=u||0,this.id=null,this.textureWidth=null,this.textureHeight=null,this.totalTextureWidth=null,this.totalTextureHeight=null,this.pool=null,this.tilePosition=new PIXI.Point(0,0),PIXI.Container.call(this),this.init()}var n=t("../common");e.exports=s,s.prototype=Object.create(PIXI.Container.prototype),s.prototype.constructor=s,s.prototype.init=function(){this.pool=[],this.textureWidth=this.texture.orig.width*this.imageScale,this.textureHeight=this.texture.orig.height*this.imageScale,this.totalTextureWidth=this.textureWidth+this.xBuffer,this.totalTextureHeight=this.textureHeight+this.yBuffer;for(var t=this.repeatX?Math.ceil(this.boundWidth/this.totalTextureWidth):1,e=this.repeatY?Math.ceil(this.boundHeight/this.totalTextureHeight):1,i=0;i<t*e;i++){var s=n.displayObjects.createSprite({texture:this.texture,parent:this,scale:this.imageScale});this.addChild(s),this.pool.push(s)}},s.prototype.fill=function(){var t,e,i=this.tilePosition.x+this.offsetX,s=this.tilePosition.y+this.offsetY;this.repeatX?(t=-i%this.totalTextureWidth,t>0&&(t=-(this.totalTextureWidth*Math.ceil(t/this.totalTextureWidth))+t%this.totalTextureWidth)):t=-i+this.xBuffer,this.repeatY?(e=-s%this.totalTextureHeight,e>0&&(e=-(this.totalTextureHeight*Math.ceil(e/this.totalTextureHeight))+e%this.totalTextureHeight)):e=-s+this.yBuffer;var o=t,a=t+this.totalTextureWidth,r=e+this.totalTextureHeight;"bg_statue_0"==this.id&&console.log(t,a),this.repeatX&&(a=this.boundWidth-t),this.repeatY&&(r=this.boundHeight-e);for(var h=-1;e<r;){for(;t<a;){if(h++,h==this.pool.length){var l=n.displayObjects.createSprite({texture:this.texture,parent:this,scale:this.imageScale});this.addChild(l),this.pool.push(l)}this.pool[h].x=t,this.pool[h].y=e,this.pool[h].visible=!0,t+=this.totalTextureWidth}e+=this.totalTextureHeight,t=o}for(var u=h+1;u<this.pool.length;u++)this.pool[u].visible=!1},Object.defineProperty(s.prototype,"tileX",{set:function(t){return this.tilePosition.x=t,this.tilePosition.x},get:function(t){return this.tilePosition.x}}),Object.defineProperty(s.prototype,"tileY",{set:function(t){return this.tilePosition.y=t,this.tilePosition.y},get:function(t){return this.tilePosition.y}})},{"../common":42}],91:[function(t,e,i){function s(t){return PIXI.Container.call(this),this.visible=!1,this.params=t,this.autoResize=!0,this.textBorders={x:10,y:0,lineSpacing:10},this.bg=null,this.choices=[],this.dispacthTL=null,this.boxOff=76,this}var n=t("../common");e.exports=s,s.prototype=Object.create(PIXI.Container.prototype),s.prototype.constructor=s,s.prototype.init=function(){this.createBg(),this.createChoices(),this.alignBg()},s.prototype.createBg=function(){this.bg=new PIXI.mesh.NineSlicePlane(this.params.bg.texture,this.params.bg.nineSlice[0],this.params.bg.nineSlice[1],this.params.bg.nineSlice[2],this.params.bg.nineSlice[3]),this.addChild(this.bg),this.params.bg.width&&(this.bgWidth=this.params.bg.width),this.params.bg.height&&(this.bgHeight=this.params.bg.height)},s.prototype.createChoices=function(){this.responsive=!0,this.choicesContainer=(new PIXI.Container).addTo(this);for(var t=0;t<this.params.choices.length;t++){var e={fontFamily:"Vectipede",fontSize:30,fill:["#693d67","#693d67","#693d67","#693d67"],align:"center"},i=new PIXI.Text(n.language.get(this.params.choices[t]),e),s=Math.floor(p3.View.width-(this.params.bg.nineSlice[0]+this.params.bg.nineSlice[2]))-490;i.width>s&&(i.style.wordWrap=!0,i.style.wordWrapWidth=s),i.x=Math.floor(-i.width/2),i.y=Math.floor(e.fontSize*t+t*this.textBorders.lineSpacing),i.id=this.params.choices[t].convid,this.choices.push(i),this.choicesContainer.addChild(i)}this.autoResize&&this.resizeBg(),this.alignChoices()},s.prototype.resizeBg=function(){var t=this.choicesContainer.getBounds();this.bgWidth-this.params.bg.nineSlice[0]-this.params.bg.nineSlice[2]<t.width&&(this.bgWidth=2*this.textBorders.x+t.width+this.params.bg.nineSlice[0]+this.params.bg.nineSlice[2]),this.bgHeight-this.params.bg.nineSlice[1]-this.params.bg.nineSlice[3]<t.height&&(this.bgHeight=2*this.textBorders.y+t.height+this.params.bg.nineSlice[1]+this.params.bg.nineSlice[3])},s.prototype.alignChoices=function(){var t=this.choicesContainer.getBounds();this.choicesContainer.y=Math.floor(-t.height/2)},s.prototype.alignBg=function(){var t=this.bg.getBounds();this.bg.x=Math.floor(-t.width/2),this.bg.y=Math.floor(-t.height/2)},s.prototype.show=function(){this.animTL&&this.animTL.kill(),this.alpha=.2,this.scaleXY=.5,this.animTL=new TimelineMax({onStart:function(){this.visible=!0},onStartScope:this}),this.animTL.to(this,.2,{alpha:1,ease:Linear.easeNone},"start"),this.animTL.to(this.scale,.2,{x:1,y:1,ease:Cubic.easeOut},"start")},s.prototype.hide=function(){this.animTL&&this.animTL.kill(),this.animTL=new TimelineMax({onComplete:function(){},onCompleteScope:this}),this.animTL.to(this,.2,{alpha:.2,ease:Linear.easeNone},"start"),this.animTL.to(this.scale,.2,{x:.5,y:.5,ease:Cubic.easeIn},"start")},s.prototype.doSeppuku=function(){this.dispacthTL&&this.dispacthTL.kill();for(var t=0;t<this.choices.length;t++)this.choices[t].destroy(n.destroyAllOptions);this.choicesContainer&&this.choicesContainer.destroy(n.destroyAllOptions),this.bg.destroy(n.destroyOptions),this.destroy(n.destroyOptions)},Object.defineProperty(s.prototype,"bgWidth",{get:function(){return this.bg.width},set:function(t){this.bg.width=t,this.alignBg()}}),Object.defineProperty(s.prototype,"bgHeight",{get:function(){return this.bg.height},set:function(t){this.bg.height=t,this.alignBg()}}),Object.defineProperty(s.prototype,"offset",{get:function(){return Math.floor(this.bg.height/2+80)}})},{"../common":42}],92:[function(t,e,i){e.exports=t("./help-text")},{"./help-text":91}],93:[function(t,e,i){e.exports={Main:t("./main")}},{"./main":101}],94:[function(t,e,i){e.exports=t("./language")},{"./language":95}],95:[function(t,e,i){function s(t){this.langs={},this.current=t?t.toLowerCase():"en"}s.prototype.constructor=s,e.exports=s,s.prototype.add=function(t){this.langs=t},s.prototype.set=function(t){this.current=t.toLowerCase()},s.prototype.get=function(t){if(this.langs[t]&&this.langs[t][this.current]){var e=this.langs[t][this.current];return"string"==typeof e||e instanceof String?e:"[object Array]"===Object.prototype.toString.call(e)?e:null!==e&&"object"==typeof e?p3.Device.isMobile?e.mobile:e.desktop:(console.log("ENEA.Language : can't find text "+e),null)}return console.log("ENEA.Language : can't find text ("+t+") in language ("+this.current+")"),null}},{}],96:[function(t,e,i){function s(t,e,i){o.call(this),this.debug=i||!1,this.excludeData=e,this.asssetsData=t,this._count=0,this.assetsToLoad=[],this.init()}var n=t("../common"),o=t("eventemitter3");s.prototype=Object.create(o.prototype),s.prototype.constructor=s,e.exports=s,s.prototype.init=function(){for(var t in this.asssetsData)if(this.excludeData.indexOf(t)===-1)for(var e in this.asssetsData[t])switch(this.asssetsData[t][e].type.toLowerCase()){case"json":this.assetsToLoad.push({name:e,url:n.PATHS.DATA+this.asssetsData[t][e].url}),this._count++;break;case"fnt":this.assetsToLoad.push({name:e,url:n.PATHS.IMAGES+this.asssetsData[t][e].url}),this._count++;break;case"image":var i=n.PATHS.IMAGES+this.asssetsData[t][e].url;i=i.replaceAll("#LANGUAGE#",n.gameParams.language),this.assetsToLoad.push({name:e,url:i}),this._count++;break;case"atlas":this.assetsToLoad.push({name:e,url:n.PATHS.IMAGES+this.asssetsData[t][e].url}),this._count+=2;break;case"spine":this.assetsToLoad.push({name:e,url:n.PATHS.IMAGES+this.asssetsData[t][e].url}),this._count+=3}},s.prototype.start=function(){n.assetManager.addFiles(this.assetsToLoad),n.assetManager.signals.progress.add(this.onProgress,this),n.assetManager.signals.complete.add(this.onComplete,this),n.assetManager.load()},s.prototype.onProgress=function(t,e,i){this.debug&&console.log("Asset ("+e.name+") loaded"),this.emit("assetsloader-progress",this)},s.prototype.onComplete=function(){this.emit("assetsloader-complete",this)},Object.defineProperty(s.prototype,"count",{get:function(){return this._count}})},{"../common":42,eventemitter3:2}],97:[function(t,e,s){function n(t,e){a.call(this),this.debug=e||!1,this.loaded=0,this.audioData=t,o.isIE?this.extensions=["mp3","ogg"]:this.extensions=["ogg","mp3"],this.soundsToLoad=[],this.init()}var o=t("../common"),a=t("eventemitter3");n.prototype=Object.create(a.prototype),n.prototype.constructor=n,e.exports=n,n.prototype.init=function(){for(var t in this.audioData)if("sound"===this.audioData[t].type.toLowerCase()){this.soundsToLoad.push({name:t}),this.lastSound.url=[];for(var e=0;e<this.extensions.length;e++)this.lastSound.url.push(o.PATHS.SOUNDS+this.audioData[t].url+"."+this.extensions[e])}},n.prototype.start=function(){for(o.audio.onLoadError=this.onError.bind(this),o.audio.onLoadProgress=this.onProgress.bind(this),i=0;i<this.soundsToLoad.length;i++)o.audio.load(this.soundsToLoad[i].name,this.soundsToLoad[i].url)},n.prototype.onError=function(t){console.log("Problem loading sound ("+t+")"),this.emit("audioloader-progress",this)},n.prototype.onProgress=function(t){this.debug&&console.log("Sound ("+("string"==typeof t||t instanceof String?t:"sprite")+") loaded"),this.loaded++,this.emit("audioloader-progress",this),this.loaded>=Object.keys(this.audioData).length&&this.emit("audioloader-complete",this)},Object.defineProperty(n.prototype,"lastSound",{get:function(){return this.soundsToLoad[this.soundsToLoad.length-1]}}),Object.defineProperty(n.prototype,"count",{get:function(){return this.soundsToLoad.length}})},{"../common":42,eventemitter3:2}],98:[function(t,e,i){function s(t){p3.Scene.call(this),n.viewManager.add(n.assetManager.getJSON("preloaderView")),this.layout=n.viewManager.get(n.viewManager.activeLayout),this.debug=t||!1,this.tmpTexts=[],this.wfLoader=new o(n.gameContent.fonts,this.debug),this.wfLoader.on("wfloader-font-active",this.onFontLoadingComplete.bind(this)),this.audioLoader=new a(n.gameContent.sounds,this.debug),this.audioLoader.on("audioloader-progress",this.updateProgress.bind(this)),this.assetsLoader=new r(n.gameContent,["preloader","loader","fonts","sounds"],this.debug),this.assetsLoader.on("assetsloader-progress",this.updateProgress.bind(this)),this.assetsLoader.on("assetsloader-complete",this.onComplete.bind(this)),this._subTotal=this.wfLoader.count+this.audioLoader.count,this._total=this._subTotal+this.assetsLoader.count,this._loaded=0,this.fillBarFrameWidth=null}var n=t("../common"),o=t("./wf-loader"),a=t("./audio-loader"),r=t("./assets-loader"),h=t("../utils");e.exports=s,s.prototype=Object.create(p3.Scene.prototype),s.prototype.constructor=s,s.prototype.init=function(){this.boom=n.viewManager.addAnimatedSprite(this.layout.boom).addTo(this),this.progressBar=n.viewManager.addProgressBar(this.layout.progressBar).addTo(this),this.progressBar.bar.value=0},s.prototype.startLoading=function(){this.wfLoader.count>0&&this.wfLoader.start(),this.audioLoader.count>0&&this.audioLoader.start(),0===this._subTotal&&this.assetsLoader.start()},s.prototype.onFontLoadingComplete=function(t,e){var i={fontFamily:e,fontSize:50,fill:"#ffffff",align:"center",padding:30},s=new PIXI.Text("Test string 0132",i);s.anchorXY=.5,s.x=50,s.y=50,s.visible=!1,this.addChild(s),this.tmpTexts.push(s),this.updateProgress()},s.prototype.appear=function(){this.boom.play("boom"),this.startLoading()},s.prototype.update=function(){},s.prototype.updateProgress=function(t){this._loaded++,this._loaded===this._subTotal&&this.assetsLoader.start(),this.progressBar.bar.value=this._loaded/this._total},s.prototype.onComplete=function(){this.debug&&console.log("Loader finished loading assets"),n.assetManager.signals.progress.removeAll(),n.assetManager.signals.complete.removeAll(),n.config=n.assetManager.getJSON("config"),n.chunks.setup.ground=h.mergeParams(n.chunks.setup.ground,n.config.chunks.ground),n.chunks.setup.platform=h.mergeParams(n.chunks.setup.platform,n.config.chunks.platform),n.language.add(n.assetManager.getJSON("languages")),n.animator.setTimeout(function(){this.signals.next.dispatch()},1,this)},s.prototype.destroy=function(){for(var t=0;t<this.tmpTexts.length;t++)this.removeChild(this.tmpTexts[t]),this.tmpTexts[t].destroy(n.destroyAllOptions);this.progressBar.bar.doSeppuku(),this.progressBar.bar.texture.destroy(!0),p3.Scene.prototype.destroy.call(this)},s.prototype.resize=function(){this.x=Math.round((p3.View.width-n.STAGE_WIDTH)/2)}},{"../common":42,"../utils":116,"./assets-loader":96,"./audio-loader":97,"./wf-loader":99}],99:[function(t,e,i){function s(t,e){o.call(this),this.debug=e||!1,this.fontData=t,this.families=[],this.urls=[],this.init()}var n=t("../common"),o=t("eventemitter3"),a=t("webfontloader");s.prototype=Object.create(o.prototype),s.prototype.constructor=s,e.exports=s,s.prototype.init=function(){for(var t in this.fontData)"webfont"===this.fontData[t].type.toLowerCase()&&(this.families.push(t),this.urls.push(n.PATHS.FONTS+this.fontData[t].url+".css"))},s.prototype.start=function(){a.load({loading:this.onLoading.bind(this),fontloading:this.onFontLoading.bind(this),fontactive:this.onFontActive.bind(this),active:this.onActive.bind(this),inactive:this.onFontInactive.bind(this),custom:{families:this.families,urls:this.urls}})},s.prototype.onLoading=function(){this.emit("wfloader-loading",this)},s.prototype.onFontLoading=function(t,e){this.emit("wfloader-font-loading",this,t,e)},s.prototype.onActive=function(){this.emit("wfloader-active",this)},s.prototype.onFontActive=function(t,e){this.debug&&console.log("Font ("+t+") loaded");var i=document.createElement("p");i.style="font-family: "+t+"; font-size: 0px; visibility: hidden !important;",document.getElementById(n.gameParams.gameContainerId).insertBefore(i,document.getElementById(n.gameParams.gameContainerId).firstChild),this.emit("wfloader-font-active",this,t,e)},s.prototype.onFontInactive=function(t,e){console.log("Problem loading font ("+t+")"),this.emit("wfloader-font-inactive",this,t,e)},Object.defineProperty(s.prototype,"count",{get:function(){return this.families.length}})},{"../common":42,eventemitter3:2,webfontloader:5}],100:[function(t,e,i){function s(){try{this.isAvailable=!!localStorage.getItem}catch(t){return this.isAvailable=!1,void console.log("Local storage is not supported")}this.id=n.gameParams.gid,this.defaultSettings={version:n.version,levelDebug:null,character:"brown",tutorial:[0,0,0,0,0,0,0],muted:!1},this.getStorageData()}var n=t("../common");s.prototype.constructor=s,e.exports=s,s.prototype.get=function(t,e){var i;try{i=localStorage.getItem(this.id+"."+t)}catch(s){console.log("ENEA.Storage : "+s)}return null===i?e:i},s.prototype.set=function(t,e){try{localStorage.setItem(this.id+"."+t,e)}catch(i){console.log("ENEA.Storage : "+i)}},s.prototype.remove=function(t){localStorage.removeItem(this.id+"."+t)},s.prototype.has=function(t){return null!==localStorage.getItem(this.id+"."+t)},s.prototype.removeAllById=function(){for(var t=localStorage.length-1;t>=0;t--){var e=localStorage.key(t);e.indexOf(this.id+".")!==-1&&localStorage.removeItem(e)}},s.prototype.getStorageData=function(){this.has("data")||this.set("data",JSON.stringify(this.defaultSettings)),n.storage_data=JSON.parse(this.get("data")),n.storage_data.version!==n.version&&(this.removeAllById(),n.storage_data=WRE.cloneObj(this.defaultSettings),this.set("data",JSON.stringify(n.storage_data)))},s.prototype.load=function(){n.storage_data=JSON.parse(this.get("data"))},s.prototype.save=function(){this.set("data",JSON.stringify(n.storage_data))},s.prototype.reset=function(){this.removeAllById(),n.storage_data=WRE.cloneObj(this.defaultSettings),this.set("data",JSON.stringify(n.storage_data))}},{"../common":42}],101:[function(t,e,i){function s(t){n.isIE=this.detectIE()!==!1,n.gameParams=t,n.chunks=c,n.STAGE_WIDTH=n.gameParams.width,n.STAGE_HEIGHT=n.gameParams.height,n.storage=new r,n.assetManager=p3.AssetManager.instance,n.assetManager._loader.pre(this.preResource),n.assets=n.assetManager,n.audio=new l,n.language=new h(n.gameParams.language),n.viewManager=new u,n.memoryManager=new p,this.setupPaths(),n.audio.mute=n.storage_data.muted,window.delay=function(t,e,i){return TweenMax.delayedCall(e,t,[],i)},this.init()}var n=t("./common"),o=t("./application"),a=t("./Keyboard"),r=t("./localstorage/localstorage"),h=t("./language"),l=t("./audiomanager"),u=t("./viewmanager"),p=t("./memorymanager"),c=t("./chunks");s.prototype.detectIE=function(){var t=window.navigator.userAgent,e=t.indexOf("MSIE ");if(e>0)return parseInt(t.substring(e+5,t.indexOf(".",e)),10);var i=t.indexOf("Trident/");if(i>0){var s=t.indexOf("rv:");return parseInt(t.substring(s+3,t.indexOf(".",s)),10)}var n=t.indexOf("Edge/");return n>0&&parseInt(t.substring(n+5,t.indexOf(".",n)),10)},s.prototype.preResource=function(t,e){t.loadType===PIXI.loaders.Resource.TYPE.JSON&&t.onComplete.once(function(t){t.data&&t.data.meta&&(t.data.meta.scale="1")}),e()},s.prototype.setupPaths=function(){for(var t in n.PATHS)switch(t){case"IMAGES":case"FONTS":n.PATHS[t]+=n.gameParams.resolutionSuffix?n.gameParams.resolutionSuffix+"/":""}},s.prototype.init=function(){var t=new p3.ViewParams;t.width=n.gameParams.width,t.height=n.gameParams.height,t.holderId=n.gameParams.gameContainerId,t.rotateImageUrl=n.PATHS.IMAGES+"localisation/rotate_sc/wr_rotate_sc.jpg",t.rotateImageColor="#000000",PIXI.settings.RETINA_PREFIX=/\_(?=[^_]*$)(.+)x/,PIXI.settings.WRAP_MODE=PIXI.WRAP_MODES.REPEAT,PIXI.settings.MIPMAP_TEXTURES=!1,p3.Device.init(window.bowser),TweenMax.defaultOverwrite="none",TweenMax.ticker.fps(60),n.canvas=new p3.View(t);var e=null!==navigator.userAgent.match(/Kindle|Silk|KFA/);n.canvas.signals.ready.addOnce(function(t){var i={view:t,transparent:!1,antialias:!1,preserveDrawingBuffer:e,resolution:1,legacy:!0};n.stage=new PIXI.Container,p3.Device.isCocoonJS?(n.isCocoonJS=!0,n.stage.scale.x=window.innerHeight/n.gameParams.height,n.stage.scale.y=window.innerHeight/n.gameParams.height,n.renderer=new PIXI.WebGLRenderer(window.innerWidth,window.innerHeight,i)):(n.closeButOffset=0,n.renderer=PIXI.autoDetectRenderer(n.gameParams.width,n.gameParams.height,i)),n.renderer.backgroundColor=8859527,n.isWebGL=n.renderer instanceof PIXI.WebGLRenderer,n.sceneManager=new p3.SceneManager(n.renderer),n.stage.addChild(n.sceneManager.view),n.timestep=new p3.Timestep(p3.Timestep.FIXED),n.timestep.init(this.update,this.render,this),n.animator=new p3.Animator,n.animator.init(),n.keyboard=new a,n.keyboard.init(window),this.handleVisibility(),this.loadConfig()},this),n.canvas.signals.resize.add(this.onCanvasResize,this)},s.prototype.handleVisibility=function(){this._hiddenVar=null,void 0!==document.webkitHidden?this._hiddenVar="webkitvisibilitychange":void 0!==document.mozHidden?this._hiddenVar="mozvisibilitychange":void 0!==document.msHidden?this._hiddenVar="msvisibilitychange":void 0!==document.hidden&&(this._hiddenVar="visibilitychange"),this._hiddenVar&&document.addEventListener(this._hiddenVar,this.visibilityChange.bind(this),!1),window.onpagehide=this.visibilityChange.bind(this),window.onpageshow=this.visibilityChange.bind(this),window.onblur=this.visibilityChange.bind(this),window.onfocus=this.visibilityChange.bind(this)},s.prototype.visibilityChange=function(t){switch(t.type){case"pagehide":case"blur":n.audio.pauseAll(),n.audio.mute=!0;break;case"pageshow":case"focus":n.audio.mute=n.storage_data.muted,n.audio.resumeAll()}},s.prototype.loadConfig=function(){var t=[{name:"gameContent",url:n.PATHS.DATA+"content.json"},{name:"editorConfig",url:n.PATHS.DATA+"editor-config.json"},{name:"preloaderView",url:n.PATHS.DATA+"view/view-preloader.json"},{name:"level0",url:n.PATHS.DATA+"level/level0.json"},{name:"raceDust0",url:n.PATHS.DATA+"particles/race_group_dust_cloud_road.json"},{name:"raceDust1",url:n.PATHS.DATA+"particles/race_group_dust_cloud_road.json"},{name:"raceDust2",url:n.PATHS.DATA+"particles/race_group_dust_cloud_snow.json"},{name:"raceDust3",url:n.PATHS.DATA+"particles/race_group_dust_cloud_spooky.json"},{name:"raceDust4",url:n.PATHS.DATA+"particles/race_group_dust_cloud_desert.json"},{name:"titleEmitter",url:n.PATHS.DATA+"particles/splash_emitter.json"},{name:"titleParticle0",url:n.PATHS.IMAGES+"title/particles/title_particle_0.png"},{name:"titleParticle1",url:n.PATHS.IMAGES+"title/particles/title_particle_1.png"},{name:"wr_race_lights_bg2",url:n.PATHS.IMAGES+"ui/wr_race_lights_bg2.png"},{name:"wr_race_lights_green2",url:n.PATHS.IMAGES+"ui/wr_race_lights_green2.png"},{name:"wr_race_lights_red2",url:n.PATHS.IMAGES+"ui/wr_race_lights_red2.png"},{name:"raceBats",url:n.PATHS.DATA+"particles/powerup_launch_bats_00.json"},{name:"raceBalloons",url:n.PATHS.DATA+"particles/powerup_launch_balloons_00.json"},{name:"raceBanana",url:n.PATHS.DATA+"particles/powerup_launch_bananas_00.json"},{name:"raceButterfly",url:n.PATHS.DATA+"particles/powerup_launch_butterflies_00.json"},{name:"raceBubbles",url:n.PATHS.DATA+"particles/powerup_launch_bubbles_00.json"},{name:"raceCannonball",url:n.PATHS.DATA+"particles/powerup_launch_bowling_balls_00.json"},{name:"raceNails",url:n.PATHS.DATA+"particles/powerup_launch_tacks_00.json"},{name:"raceOil",url:n.PATHS.DATA+"particles/race_oil_particles.json"},{name:"raceSmoke",url:n.PATHS.DATA+"particles/powerup_launch_smoke_00.json"},{name:"raceSpring",url:n.PATHS.DATA+"particles/powerup_launch_spring_00.json"}];if("editor"===n.gameParams.mode){var e=[{name:"level0Atlas",url:n.PATHS.IMAGES+"level/0/world_0_1x.json"},{name:"raceAtlas",url:n.PATHS.IMAGES+"cars/race_atlas_1x.json"},{name:"editor_cameraZoom",url:n.PATHS.IMAGES+"editor/editor/editor_cameraZoom.png"},{name:"editor_challengeDummy",url:n.PATHS.IMAGES+"editor/editor/editor_challengeDummy.png"},{name:"editor_challengeParticle",url:n.PATHS.IMAGES+"editor/editor/editor_challengeParticle.png"},{name:"editor_hint",url:n.PATHS.IMAGES+"editor/editor/editor_hint.png"},{name:"editor_end",url:n.PATHS.IMAGES+"editor/editor/editor_end.png"},{name:"editor_gameOver",url:n.PATHS.IMAGES+"editor/editor/editor_gameOver.png"},{name:"editor_tutorial",url:n.PATHS.IMAGES+"editor/editor/editor_tutorial.png"},{name:"level_challenge",url:n.PATHS.IMAGES+"editor/level/level_challenge.png"},{name:"level_pickable",url:n.PATHS.IMAGES+"editor/level/level_pickable.png"},{name:"level_powerup",url:n.PATHS.IMAGES+"editor/level/level_powerup.png"},{name:"level_fill",url:n.PATHS.IMAGES+"editor/tiles/level_fill.png"},{name:"level_ground",url:n.PATHS.IMAGES+"editor/tiles/level_ground.png"},{name:"level_ground_edge",url:n.PATHS.IMAGES+"editor/tiles/level_ground_edge.png"},{name:"level_wall",url:n.PATHS.IMAGES+"editor/tiles/level_wall.png"}];t=t.concat(e)}n.assetManager.addFiles(t),n.assetManager.signals.progress.add(this.onConfigProgress,this),n.assetManager.signals.complete.addOnce(this.onConfigComplete,this),n.assetManager.load()},s.prototype.onConfigProgress=function(t,e,i){n.gameParams.debug&&console.log(e.name+" loaded")},s.prototype.onConfigComplete=function(){n.gameContent=n.assetManager.getJSON("gameContent"),n.assetManager.signals.progress.removeAll(),n.assetManager.signals.complete.removeAll(),this.startGame()},s.prototype.startGame=function(){new o},s.prototype.update=function(){n.canvas.isCorrectOrientation()&&!n.paused&&(n.sceneManager.update(),n.animator.update(),n.keyboard.update())},s.prototype.render=function(){n.renderer.render(n.stage),n.spineStep=PIXI.ticker.shared.elapsedMS*n.spineSpeed,n.timeStep=PIXI.ticker.shared.elapsedMS/16.9},s.prototype.onCanvasResize=function(t){t?(n.renderer.resize(p3.View.width,p3.View.height),n.currentScreen&&(n.currentScreen.resize(),n.paused=!1,n.audio.mute=n.storage_data.muted,n.audio.resumeAll())):n.currentScreen&&(n.paused=!0,n.audio.pauseAll(),n.audio.mute=!0)},e.exports=s},{"./Keyboard":6,"./application":7,"./audiomanager":10,"./chunks":41,"./common":42,"./language":94,"./localstorage/localstorage":100,"./memorymanager":102,"./viewmanager":122}],102:[function(t,e,i){function s(){this._debug=n.gameParams.debug,this.textures={},this.sounds={}}var n=t("./common");e.exports=s,s.prototype.resetLoader=function(){PIXI.loader.reset(),n.assetManager._loader.reset()},s.prototype.store=function(t,e){this.textures[t]||(this.textures[t]=[]),this.textures[t].indexOf(e)===-1&&(this.echo("adding : "+t+" | "+e),this.textures[t].push(e))},s.prototype.storeSound=function(t,e){this.sounds[t]||(this.sounds[t]=[]),this.sounds[t].indexOf(e)===-1&&(this.echo("adding sound : "+t+" | "+e),this.sounds[t].push(e))},s.prototype.debug=function(){},s.prototype.echo=function(t){
this._debug&&console.log("MemoryManager -> "+t)},s.prototype.free=function(t){if(this.textures[t]){this.echo('removing assets from "'+t+'"'),this.echo("------------------------------------");for(var e=0;e<this.textures[t].length;e++){this.echo("removing asset "+this.textures[t][e]);try{n.assetManager.getTexture(this.textures[t][e]).baseTexture.destroy(!0)}catch(i){console.log(i)}}n.isWebGL&&n.renderer.textureGC.run(),this.textures[t]=[],delete this.textures[t],this.freeSounds(t)}},s.prototype.freeSounds=function(t){if(this.sounds[t]){this.echo('removing sounds from "'+t+'"'),this.echo("------------------------------------");for(var e=0;e<this.sounds[t].length;e++){this.echo("removing sound "+this.sounds[t][e]);try{n.audio.removeSound(this.sounds[t][e])}catch(i){console.log(i)}}this.sounds[t]=[],delete this.sounds[t]}},s.prototype.freeAll=function(){this.echo("removing all textures and sounds"),this.echo("------------------------------------");for(var t in this.textures)this.free(t);for(t in this.sounds)this.freeSounds(t)}},{"./common":42}],103:[function(t,e,i){var s=function(t){this.items=[],this._name=t},n=s.prototype;n.emit=function(t,e,i,s,n,o,a,r){if(arguments.length>8)throw"max arguments reached";for(var h=this.items,l=this._name,u=0,p=h.length;u<p;u++)h[u][l](t,e,i,s,n,o,a,r);return this},n.dispatch=n.emit,n.run=n.emit,n.add=function(t){return t[this._name]&&(this.remove(t),this.items.push(t)),this},n.remove=function(t){var e=this.items.indexOf(t);return e!==-1&&this.items.splice(e,1),this},n.contains=function(t){return this.items.indexOf(t)!==-1},n.removeAll=function(){return this.items.length=0,this},n.destroy=function(){this.removeAll(),this.items=null,this._name=null},n.detachAll=n.destroy,Object.defineProperties(n,{empty:{get:function(){return 0===this.items.length}},name:{get:function(){return this._name}}}),e.exports=s},{}],104:[function(t,e,i){function s(t){p3.Scene.call(this),this.debug=t||!1}var n=t("../common");e.exports=s,s.prototype=Object.create(p3.Scene.prototype),s.prototype.constructor=s,s.prototype.init=function(){},s.prototype.loadLoader=function(){var t=[];for(var e in n.gameContent.loader)t.push({name:e,url:n.PATHS.IMAGES+n.gameContent.loader[e].url});n.assetManager.addFiles(t),n.assetManager.signals.progress.add(this.onLoaderProgress,this),n.assetManager.signals.complete.addOnce(this.onLoaderComplete,this),n.assetManager.load()},s.prototype.onLoaderProgress=function(t,e,i){this.debug&&console.log("Asset ("+e.name+") loaded")},s.prototype.onLoaderComplete=function(){this.signals.next.dispatch()},s.prototype.appear=function(){this.loadLoader()},s.prototype.destroy=function(){n.assetManager.signals.progress.removeAll(),n.assetManager.signals.complete.removeAll(),n.assetManager._loader.reset(),p3.Scene.prototype.destroy.call(this)},s.prototype.update=function(){},s.prototype.resize=function(){this.x=Math.round((p3.View.width-n.STAGE_WIDTH)/2)}},{"../common":42}],105:[function(t,e,i){function s(t,e,i,s){return this.dimColor=t?parseInt(t.replace(/^#/,""),16):0,this.dimDuration=null===e?.3:e,this.dimAlphaIn=null===i?1:i,this.dimAlphaOut=null===s?0:s,this.dimTexture=this.generateFillTexture(),this.tl=null,PIXI.Sprite.call(this,this.dimTexture),this.applyParams({alpha:0,x:0,y:0,anchorXY:0,width:p3.View.width,height:p3.View.height}),this}var n=t("../common");e.exports=s,s.prototype=Object.create(PIXI.Sprite.prototype),s.prototype.constructor=s,s.prototype["in"]=function(){null!==this.tl&&this.tl.kill(),this.tl=new TimelineMax({onComplete:function(){this.emit("dim-in",this)},onCompleteScope:this}),this.tl.to(this,this.dimDuration,{alpha:this.dimAlphaIn,ease:Linear.easeNone})},s.prototype.out=function(){null!==this.tl&&this.tl.kill(),this.tl=new TimelineMax({onComplete:function(){this.emit("dim-out",this)},onCompleteScope:this}),this.tl.to(this,this.dimDuration,{alpha:this.dimAlphaOut,ease:Linear.easeNone})},s.prototype.generateFillTexture=function(){var t=new PIXI.Graphics;t.beginFill(this.dimColor,1),t.drawRect(0,0,2,2);var e=n.renderer.generateTexture(t,1,PIXI.SCALE_MODES.LINEAR);return t.destroy(),t=null,e},s.prototype.resize=function(){this.applyParams({x:Math.round((p3.View.width-n.STAGE_WIDTH)/2),y:0,width:p3.View.width,height:p3.View.height})}},{"../common":42}],106:[function(t,e,i){function s(){p3.Scene.call(this),this.carTL=null,this.charTL=null,this.charTL2=null,this.textTL=null,this.defaultPos=new PIXI.Point(820,710),this.charTable=["penelope","peter","dastardly","iq","captain","gruesome"],this.offsets=[{x:10,y:-20},{x:0,y:0},{x:30,y:-40},{x:0,y:0},{x:10,y:-70},{x:20,y:-60}],this.defaultCharPos=new PIXI.Point(1250,800),this.charOffsets=[[{x:0,y:30}],[{x:0,y:20}],[{x:60,y:10},{x:380,y:0}],[{x:0,y:40}],[{x:0,y:-40}],[{x:-70,y:-8},{x:500,y:70}]],o.viewManager.add(o.assetManager.getJSON("characterView")),this.layout=o.viewManager.get(o.viewManager.activeLayout),this.initSignals(),this.preloadStuff()}var n=t("mini-signals"),o=t("../common"),a=t("../loader/audio-loader"),r=t("../challenges/challenge-preloader"),h={garageMusic:{type:"sound",url:"music/music_garage_loop_01",soundId:"garageMusic"}},l=[{name:"selectAtlas",url:o.PATHS.IMAGES+"character/ui_vehicle_select_0.8x.json",destroyId:"ui_char_brown"}];e.exports=s,s.prototype=Object.create(p3.Scene.prototype),s.prototype.constructor=s,s.prototype.preloadStuff=function(){o.memoryManager.resetLoader();for(var t in l)l[t].hasOwnProperty("destroyId")&&o.memoryManager.store("character",l[t].destroyId);for(t in h)h[t].hasOwnProperty("soundId")&&o.memoryManager.storeSound("character",h[t].soundId);this.audioLoader=new a(h,(!1)),this.audioLoader.start()},s.prototype.preloader=function(){return new r},s.prototype.load=function(){return l},s.prototype.init=function(){this.bg=o.viewManager.addSprite(this.layout.bg).addTo(this),this.shadow=o.viewManager.addSprite(this.layout.shadow).addTo(this),this.car=o.viewManager.addSprite(this.layout.car).addTo(this),this.character2=o.viewManager.addSprite(this.layout.character2).addTo(this),this.character1=o.viewManager.addSprite(this.layout.character1).addTo(this),this.characterNameBg=o.viewManager.addSprite(this.layout.characterNameBg).addTo(this),this.characterNameText=o.viewManager.addText(this.layout.characterNameText).addTo(this.characterNameBg),this.initUiElements()},s.prototype.initSignals=function(){"undefined"==typeof this.signals&&(this.signals={}),this.signals.challenge=new n},s.prototype.destroySignals=function(){for(var t in this.signals)this.signals[t]instanceof n&&this.signals[t].detachAll()},s.prototype.initUiElements=function(){this.uiContainer=(new WRE.Container).addTo(this);for(var t in this.layout.ui)switch(t){case"soundButton":this.soundButton=o.viewManager.addSwitchButton(this.layout.ui.soundButton).addTo(this.uiContainer),this.soundButton.on("button-on-click",this.onSoundButtonClick.bind(this)),this.soundButton.state=o.storage_data.muted?1:0;break;case"homeButton":this.homeButton=o.viewManager.addButton(this.layout.ui.homeButton).addTo(this.uiContainer),this.homeButton.on("button-on-click",this.onHomeButtonClick.bind(this));break;case"playButton":this.playButton=o.viewManager.addButton(this.layout.ui.playButton).addTo(this.uiContainer),this.playButton.on("button-on-click",this.onPlayButtonClick.bind(this));break;case"previousButton":this.previousButton=o.viewManager.addButton(this.layout.ui.previousButton).addTo(this.uiContainer),this.previousButton.on("button-on-click",this.onPreviousButtonClick.bind(this));break;case"nextButton":this.nextButton=o.viewManager.addButton(this.layout.ui.nextButton).addTo(this.uiContainer),this.nextButton.on("button-on-click",this.onNextButtonClick.bind(this))}},s.prototype.destroyUiElements=function(){for(var t=0;t<this.uiContainer.children.length;t++)this.uiContainer.children[t].doSeppuku&&this.uiContainer.children[t].doSeppuku();this.uiContainer.destroy(o.destroyOptions)},s.prototype.update=function(){},s.prototype.onSoundButtonClick=function(t){o.toggleMute("garageMusic"),t.state=o.storage_data.muted?1:0},s.prototype.onHomeButtonClick=function(){o.raceStarted=!1,this.signals.previous.dispatch()},s.prototype.onPlayButtonClick=function(){o.raceStarted=!1,this.signals.next.dispatch()},s.prototype.onPreviousButtonClick=function(){o.currentCar--,o.currentCar<0&&(o.currentCar=o.carColors.length-1),this.updateCar(),this.updateCharacter(),this.updateText()},s.prototype.onNextButtonClick=function(){o.currentCar++,o.currentCar>o.carColors.length-1&&(o.currentCar=0),this.updateCar(),this.updateCharacter(),this.updateText()},s.prototype.updateCar=function(){this.shadow.texture=o.assetManager.getTexture("ui_car_shadow_"+o.carColors[o.currentCar]),this.shadow.x=this.defaultPos.x+this.offsets[o.currentCar].x+(1===o.currentCar?-10:0),this.shadow.y=this.defaultPos.y+this.offsets[o.currentCar].y+(1===o.currentCar,0),this.car.texture=o.assetManager.getTexture("ui_car_"+o.carColors[o.currentCar]),this.car.x=this.defaultPos.x+this.offsets[o.currentCar].x,this.car.y=this.defaultPos.y+this.offsets[o.currentCar].y,this.carTL&&this.carTL.kill(),this.carTL=new TimelineMax,this.carTL.from(this.car,.2,{y:200,ease:Sine.easeOut},"start"),this.carTL.to(this.car,.1,{delay:.2,y:this.defaultPos.y+this.offsets[o.currentCar].y-5,repeat:1,yoyo:!0,ease:Sine.easeInOut},"start"),this.carTL.from(this.car,.15,{alpha:0,ease:Sine.easeIn},"start"),this.carTL.from(this.car.scale,.35,{y:1.25,ease:Back.easeOut},"start"),this.carTL.from(this.shadow.scale,.12,{delay:.1,x:1.05,y:1.05,ease:Linear.easeNone},"start"),this.carTL.from(this.shadow,.22,{alpha:0,ease:Linear.easeNone},"start")},s.prototype.updateCharacter=function(){this.character1.texture=o.assetManager.getTexture("ui_char_"+o.carColors[o.currentCar]),this.character1.x=this.defaultCharPos.x+this.charOffsets[o.currentCar][0].x,this.character1.y=this.defaultCharPos.y+this.charOffsets[o.currentCar][0].y,this.charOffsets[o.currentCar].length>1?(this.character2.texture=o.assetManager.getTexture("ui_char_"+o.carColors[o.currentCar]+"_2"),this.character2.x=this.defaultCharPos.y+this.charOffsets[o.currentCar][1].x,this.character2.y=this.defaultCharPos.y+this.charOffsets[o.currentCar][1].y):this.character2.texture=PIXI.Texture.EMPTY,this.charTL&&this.charTL.kill(),this.charTL=new TimelineMax,this.character1.scaleXY=3===o.currentCar?1.6:1,this.character1.rotation=.5,this.charTL.from(this.character1,.3,{x:2100,ease:Back.easeOut,easeParams:[.6]},"start"),this.charTL.to(this.character1,.2,{rotation:-.1,ease:Sine.easeInOut},"start"),this.charTL.to(this.character1,.6,{delay:.2,rotation:0,ease:Elastic.easeOut,easeParams:[.5]},"start"),this.charTL.to(this.character1.scale,1.3,{y:3===o.currentCar?1.62:1.01,repeat:-1,yoyo:!0,ease:Sine.easeInOut},"start"),this.charTL2&&this.charTL2.kill(),this.charTL2=new TimelineMax,this.character2.scaleX=5===o.currentCar?-1:1,this.character2.scaleY=1,this.character2.rotation=.5;var t=.2;this.charTL2.from(this.character2,.3,{delay:t,x:2e3,ease:Back.easeOut,easeParams:[.6]},"start"),this.charTL2.to(this.character2,.2,{delay:t,rotation:-.15,ease:Sine.easeInOut},"start"),this.charTL2.to(this.character2,.6,{delay:.2+t,rotation:0,ease:Elastic.easeOut,easeParams:[.5]},"start"),this.charTL2.to(this.character2.scale,1.3,{delay:t+.65,y:1.01,repeat:-1,yoyo:!0,ease:Sine.easeInOut},"start")},s.prototype.updateText=function(){this.textTL&&this.textTL.kill();var t=.4;this.textTL=new TimelineMax,this.characterNameText.alpha=1,this.textTL.to(this.characterNameText,t/4,{alpha:0,ease:Sine.easeOut,onComplete:function(){var t=o.language.get("character_name_"+this.charTable[o.currentCar]+"_first"),e=null;3!==o.currentCar&&(e=o.language.get("character_name_"+this.charTable[o.currentCar]+"_second")),this.characterNameText.text=(null===t?"":t)+(null===e?"":" "+e),"de"===o.gameParams.language&&2===o.currentCar?this.characterNameText.style.fontSize=32:this.characterNameText.style.fontSize=50,this.characterNameText.text=(null===t?"":t)+(null===e?"":" "+e)},onCompleteScope:this}),this.textTL.to(this.characterNameText,t,{alpha:1,ease:Sine.easeOut},"start"),this.textTL.to(this.characterNameBg.scale,t/4,{delay:t/4,x:1.01,y:1.01,repeat:1,yoyo:!0,ease:Sine.easeOut},"start")},s.prototype.shuffle=function(t){var e,i,s;for(s=t.length-1;s>0;s--)e=Math.floor(Math.random()*(s+1)),i=t[s],t[s]=t[e],t[e]=i;return t},s.prototype.appear=function(){o.playMusic("garageMusic"),o.currentCar=0,o.reset(),o.randomizeLevel();var t=0;for(o.gameChallengeNames=[],t=0;t<o.challengeNames.length;t++)"map"!==o.challengeNames[t]&&"way"!==o.challengeNames[t]&&o.gameChallengeNames.push(o.challengeNames[t]);for(this.shuffle(o.gameChallengeNames),o.gamePowerups=[],t=0;t<o.powerups.length;t++)o.gamePowerups.push(o.powerups[t]);this.shuffle(o.gamePowerups),this.updateCar(),this.updateCharacter(),this.updateText(),this.setUiVisible(!1),o.previousChallenge="none",o.viewManager.done=!1,o.viewManager.showTweensComplete.add(this.onShowTweensComplete.bind(this)),o.viewManager.setShowTweensTime(.005),o.animator.setTimeout(function(){this.setUiVisible(!0),o.viewManager.runShowTweens()},o.TRANSITION_DURATION/2,this)},s.prototype.setUiVisible=function(t){if(this.uiContainer)for(var e=0;e<this.uiContainer.children.length;e++)this.uiContainer.children[e].visible=t},s.prototype.setUiInteractive=function(t){if(this.uiContainer)for(var e=0;e<this.uiContainer.children.length;e++)this.uiContainer.children[e].interactive=t},s.prototype.onShowTweensComplete=function(){o.viewManager.done=!0},s.prototype.destroy=function(){TweenMax.killAll(),this.destroySignals(),this.characterNameText.destroy(!0),this.destroyUiElements(),o.memoryManager.free("character"),p3.Scene.prototype.destroy.call(this)},s.prototype.resize=function(){this.x=Math.round((p3.View.width-o.STAGE_WIDTH)/2),o.viewManager.repositionDynElements()}},{"../challenges/challenge-preloader":11,"../common":42,"../loader/audio-loader":97,"mini-signals":3}],107:[function(t,e,i){function s(){p3.Scene.call(this),this.id="EditorScene"}var n=t("../common"),o=t("../editor/Editor");e.exports=s,s.prototype=Object.create(p3.Scene.prototype),s.prototype.constructor=s,s.prototype.init=function(){console.log("EDITOR INITIALIZED"),this.interactiveArea=new PIXI.Sprite(PIXI.Texture.WHITE),this.interactiveArea.alpha=0,this.interactiveArea.tint=16711680,this.interactiveArea.interactive=!0,this.addChild(this.interactiveArea),this.mouse={position:new PIXI.Point(0,0),lastPosition:new PIXI.Point(0,0),movement:new PIXI.Point(0,0),leftPressed:!1,leftJustPressed:!1,centerPressed:!1,rightPressed:!1,rightJustPressed:!1,update:function(){this.leftJustPressed=!1,this.rightJustPressed=!1,this.movement.x=this.position.x-this.lastPosition.x,this.movement.y=this.position.y-this.lastPosition.y,this.lastPosition.x=this.position.x,this.lastPosition.y=this.position.y}},this.interactiveArea.mousedown=function(t){switch(t.data.originalEvent.which){case 1:this.mouse.leftPressed=!0,this.mouse.leftJustPressed=!0;break;case 2:this.mouse.centerPressed=!0}}.bind(this),this.interactiveArea.mouseup=this.interactiveArea.mouseupoutside=function(t){switch(t.data.originalEvent.which){case 1:this.mouse.leftPressed=!1;break;case 2:this.mouse.centerPressed=!1}}.bind(this),this.interactiveArea.rightdown=function(t){this.mouse.rightPressed=!0,this.mouse.rightJustPressed=!0}.bind(this),this.interactiveArea.rightup=this.interactiveArea.rightupoutside=function(t){this.mouse.rightPressed=!1}.bind(this),this.interactiveArea.mousemove=function(t){this.mouse.position.x=t.data.getLocalPosition(this).x,this.mouse.position.y=t.data.getLocalPosition(this).y}.bind(this),this.editor=new o,this.editor.mouse=this.mouse,this.editor.init(),this.addChild(this.editor),p3.Scene.prototype.init.call(this),n.canvas.signals.resize.add(this.onCanvasResize,this),this.onCanvasResize()},s.prototype.update=function(){this.editor.update(),this.mouse.update()},s.prototype.onCanvasResize=function(){this.interactiveArea.width=window.innerWidth,this.interactiveArea.height=window.innerHeight},s.prototype.dispose=function(){},s.prototype.animateIn=function(t,e){},s.prototype.animateOut=function(t,e){}},{"../common":42,"../editor/Editor":44}],108:[function(t,e,s){function n(t){p3.Scene.call(this),a.speedMultiplier=1,this.signals.howToPlay=new signals.Signal,this.isResume=t,this.isBusy=!1,this.character=a.carColors[a.currentCar],this.character=a.carColors[a.currentCar],a.viewManager.add(a.assetManager.getJSON("gameView")),this.layout=a.viewManager.get(a.viewManager.activeLayout),this.initSignals(),this.level=null,this.decayTime=a.config.player.speedup.decayAfter,this.pickupsBar=null,this.maxGameLiveInvulnerabilityTime=1,this.gameLiveInvulnerabilityTime=this.maxGameLiveInvulnerabilityTime,this.maxTicks=10,this.currentTick=0,this.maxDistAhead=250,this.maxDistBehind=330,this.noLosers=!1,this.winningDistance=3600,this.ticks=[],this.pupTL=null,a.randomizeMusic(),this.raceStartIdleID=null,this.raceLoopID=null,this.funContainer=null,this.canHaveFun=!1,this.ballonsFloatingID=null,this.preloadStuff()}var o=t("mini-signals"),a=t("../common"),r=t("../challenges/challenge-preloader"),h=t("../loader/audio-loader"),l=t("../game/Level"),u=t("../game/effects/EffectRaceBats"),p=t("../game/effects/EffectRaceButterfly"),c=t("../traffic-lights"),d={gameMusic:{type:"sound",url:"music/music_raceloop_0#TRACK#",soundId:"gameMusic"},raceCompleteMusic:{type:"sound",url:"music/music_race_complete_00",soundId:"raceCompleteMusic"},raceStartIdle:{type:"sound",url:"sfx/sfx_race_start_idle_revs_02",soundId:"raceStartIdle"},raceStart:{type:"sound",url:"sfx/sfx_race_starts_00",soundId:"raceStart"},raceLoop:{type:"sound",url:"sfx/sfx_racing_loop_00",soundId:"raceLoop"},raceStop:{type:"sound",url:"sfx/sfx_stop_for_challenge_00",soundId:"raceStop"},rejoinRace:{type:"sound",url:"sfx/sfx_rejoin_race_00",soundId:"rejoinRace"},carJump0:{type:"sound",url:"sfx/sfx_carjump_01",soundId:"carJump0"},carJump1:{type:"sound",url:"sfx/sfx_carjump_02",soundId:"carJump1"},powerupPickup:{type:"sound",url:"sfx/powerups/sfx_pickup_powerup_00",soundId:"powerupPickup"},powerupLaunch0:{type:"sound",url:"sfx/powerups/sfx_launch_powerup_00",soundId:"powerupLaunch0"},powerupLaunch1:{type:"sound",url:"sfx/powerups/sfx_launch_powerup_01",soundId:"powerupLaunch1"},powerupLaunch2:{type:"sound",url:"sfx/powerups/sfx_launch_powerup_02",soundId:"powerupLaunch2"},powerupBalloons0:{type:"sound",url:"sfx/powerups/sfx_powerup_balloons_00",soundId:"powerupBalloons0"},powerupBalloons1:{type:"sound",url:"sfx/powerups/sfx_powerup_balloons_01",soundId:"powerupBalloons1"},powerupBalloons2:{type:"sound",url:"sfx/powerups/sfx_powerup_balloons_02",soundId:"powerupBalloons2"},powerupBalloonsFloating:{type:"sound",url:"sfx/powerups/sfx_powerup_balloons_float",soundId:"powerupBalloonsFloating"},powerupBats0:{type:"sound",url:"sfx/powerups/sfx_powerup_bats_00",soundId:"powerupBats0"},powerupBats1:{type:"sound",url:"sfx/powerups/sfx_powerup_bats_01",soundId:"powerupBats1"},powerupBats2:{type:"sound",url:"sfx/powerups/sfx_powerup_bats_02",soundId:"powerupBats2"},powerupBowlingBall0:{type:"sound",url:"sfx/powerups/sfx_powerup_bowlingball_00",soundId:"powerupBowlingBall0"},powerupBowlingBall1:{type:"sound",url:"sfx/powerups/sfx_powerup_bowlingball_01",soundId:"powerupBowlingBall1"},powerupBowlingBall2:{type:"sound",url:"sfx/powerups/sfx_powerup_bowlingball_02",soundId:"powerupBowlingBall2"},powerupButterfly0:{type:"sound",url:"sfx/powerups/sfx_powerup_butterflies_00",soundId:"powerupButterfly0"},powerupButterfly1:{type:"sound",url:"sfx/powerups/sfx_powerup_butterflies_01",soundId:"powerupButterfly1"},powerupButterfly2:{type:"sound",url:"sfx/powerups/sfx_powerup_butterflies_02",soundId:"powerupButterfly2"},powerupNails0:{type:"sound",url:"sfx/powerups/sfx_powerup_tackskid_00",soundId:"powerupNails0"},powerupNails1:{type:"sound",url:"sfx/powerups/sfx_powerup_tackskid_01",soundId:"powerupNails1"},powerupNails2:{type:"sound",url:"sfx/powerups/sfx_powerup_tackskid_02",soundId:"powerupNails2"},powerupSmoke0:{type:"sound",url:"sfx/powerups/sfx_powerup_smokeburst_00",soundId:"powerupSmoke0"},powerupSmoke1:{type:"sound",url:"sfx/powerups/sfx_powerup_smokeburst_01",soundId:"powerupSmoke1"},powerupSmoke2:{type:"sound",url:"sfx/powerups/sfx_powerup_smokeburst_03",soundId:"powerupSmoke2"},powerupSpring0:{type:"sound",url:"sfx/powerups/sfx_powerup_spring_00",soundId:"powerupSpring0"},powerupSpring1:{type:"sound",url:"sfx/powerups/sfx_powerup_spring_01",soundId:"powerupSpring1"},powerupSpring2:{type:"sound",url:"sfx/powerups/sfx_powerup_spring_02",soundId:"powerupSpring2"}},g=[{name:"carsAtlas",url:a.PATHS.IMAGES+"cars/race_atlas_1x.json",destroyId:"car_brown"},{name:"editor_cameraZoom",url:a.PATHS.IMAGES+"editor/editor/editor_cameraZoom.png",destroyId:"editor_cameraZoom"},{name:"editor_challengeDummy",url:a.PATHS.IMAGES+"editor/editor/editor_challengeDummy.png",destroyId:"editor_challengeDummy"},{name:"editor_challengeParticle",url:a.PATHS.IMAGES+"editor/editor/editor_challengeParticle.png",destroyId:"editor_challengeParticle"},{name:"editor_hint",url:a.PATHS.IMAGES+"editor/editor/editor_hint.png",destroyId:"editor_hint"},{name:"editor_end",url:a.PATHS.IMAGES+"editor/editor/editor_end.png",destroyId:"editor_end"},{name:"editor_gameOver",url:a.PATHS.IMAGES+"editor/editor/editor_gameOver.png",destroyId:"editor_gameOver"},{name:"editor_tutorial",url:a.PATHS.IMAGES+"editor/editor/editor_tutorial.png",destroyId:"editor_tutorial"},{name:"levelAtlas",url:a.PATHS.IMAGES+"level/#LEVEL#/world_#LEVEL#_1x.json",destroyId:"level_building_0"},{name:"level_background",url:a.PATHS.IMAGES+"level/#LEVEL#/level_background.png",destroyId:"level_background"},{name:"level_layers1",url:a.PATHS.IMAGES+"level/#LEVEL#/level_layers1.json",destroyId:"level_midground1"},{name:"level_fill",url:a.PATHS.IMAGES+"level/#LEVEL#/tiles/level_fill.png",destroyId:"level_fill"},{name:"level_ground",url:a.PATHS.IMAGES+"level/#LEVEL#/tiles/level_ground.png",destroyId:"level_ground"},{name:"level_ground_edge",url:a.PATHS.IMAGES+"level/#LEVEL#/tiles/level_ground_edge.png",destroyId:"level_ground_edge"},{name:"level_wall",url:a.PATHS.IMAGES+"level/#LEVEL#/tiles/level_wall.png",destroyId:"level_wall"},{name:"resultsBg",url:a.PATHS.IMAGES+"results_bg.jpg",destroyId:"resultsBg"},{name:"selectAtlas",url:a.PATHS.IMAGES+"character/ui_vehicle_select_0.8x.json",destroyId:"ui_char_brown"}],y=[],m=[];e.exports=n,n.prototype=Object.create(p3.Scene.prototype),n.prototype.constructor=n,n.prototype.preloadStuff=function(){a.memoryManager.resetLoader(),y=WRE.cloneObj(d);for(var t in y)y[t].url=y[t].url.replaceAll("#TRACK#",a.raceMusicTrack);m=WRE.cloneObj(g);for(t in m)m[t].url=m[t].url.replaceAll("#LEVEL#",a.currentLevel);for(t in m)m[t].hasOwnProperty("destroyId")&&a.memoryManager.store("game",m[t].destroyId);for(t in y)y[t].hasOwnProperty("soundId")&&a.memoryManager.storeSound("game",y[t].soundId);this.audioLoader=new h(y,(!1))},n.prototype.preloader=function(){return new r},n.prototype.load=function(){return this.audioLoader.start(),m},n.prototype.init=function(){if(null!==a.storage_data.levelDebug){JSON.parse(a.storage_data.levelDebug);console.log("Using cached level"),this.level=new l(this,null),this.level.config=JSON.parse(a.storage_data.levelDebug)}else{var t="level0";this.level=new l(this,t)}this.level.init(),this.addChild(this.level),this.ticks.push({min:this.level.avatar.runSpeedMin,max:this.level.avatar.runSpeedMax});for(var e=0;e<this.level.opponents.length;e++)this.ticks.push({min:this.level.opponents[e].runSpeedMin,max:this.level.opponents[e].runSpeedMax});this.funContainer=new WRE.Container({responsive:!0,hitArea:new PIXI.Rectangle(0,0,10,10)}).addTo(this),this.funContainer.on("pointerdown",this.onFunContainerDown,this),this.initUiElements(),this.lights=(new c).addTo(this),this.lights.x=950,this.lights.y=-40,this.lights.signals.done.add(this.onLightsDone,this),this.resetBars()},n.prototype.initSignals=function(){"undefined"==typeof this.signals&&(this.signals={}),this.signals.cameraDone=new o,this.signals.challenge=new o},n.prototype.destroySignals=function(){for(var t in this.signals)this.signals[t]instanceof o&&this.signals[t].detachAll()},n.prototype.initUiElements=function(){this.uiContainer=(new WRE.Container).addTo(this);for(var t in this.layout.ui)switch(t){case"pauseButton":this.pauseButton=a.viewManager.addButton(this.layout.ui.pauseButton).addTo(this.uiContainer),this.pauseButton.on("button-on-click",this.onPauseButtonClick.bind(this));break;case"powerupButton":this.powerupButton=a.viewManager.addButton(this.layout.ui.powerupButton).addTo(this.uiContainer),this.powerupButton.on("button-on-click",this.onPowerupButtonClick.bind(this)),this.powerupButton.visible=!1}},n.prototype.destroyUiElements=function(){for(var t=0;t<this.uiContainer.children.length;t++)this.uiContainer.children[t].doSeppuku&&this.uiContainer.children[t].doSeppuku();this.uiContainer.destroy(a.destroyOptions)},n.prototype.pause=function(){this.interactive=!1,this.interactiveChildren=!1,TweenMax.to(this.pauseButton,.25,{y:-100,ease:Cubic.easeOut}),this.isBusy=!0},n.prototype.resume=function(){a.viewManager.activeLayout="gameView",this.interactive=!0,this.interactiveChildren=!0,TweenMax.to(this.pauseButton,.5,{y:80,ease:Back.easeOut}),this.isBusy=!1},n.prototype.onPickableHit=function(){a.lastPickedIdx++,a.audio.play(a.config.pickable.setup.sound),a.results.pickables++,this.pickupsBar&&(this.pickupsBar.text.value=a.results.pickables.toString()),a.speedMultiplier<a.config.player.speedup.max&&(a.speedMultiplier+=a.config.player.speedup.step,a.speedMultiplier>a.config.player.speedup.max&&(a.speedMultiplier=a.config.player.speedup.max),this.decayTime=a.config.player.speedup.decayAfter)},n.prototype.onPowerupButtonClick=function(t){a.audio.play(["powerupLaunch0","powerupLaunch1","powerupLaunch2"]),this.pupTL&&this.pupTL.kill(),this.powerupButton.scaleXY=1,this.level.avatar.executePowerup()},n.prototype.getTempPositions=function(){var t=[];t.push([0,this.level.avatar.x]);for(var e=0;e<this.level.opponents.length;e++)t.push([e,this.level.opponents[e].x]);return t},n.prototype.getPositionsAhead=function(t){var e=[];for(i=1;i<t.length;i++)t[i][1]>t[0][1]&&e.push([t[i][0],t[i][1]]);return e.sort(function(t,e){return e[1]-t[1]}),e},n.prototype.getPositionsBehind=function(t){var e=[];for(i=1;i<t.length;i++)t[i][1]<t[0][1]&&e.push([t[i][0],t[i][1]]);return e.sort(function(t,e){return e[1]-t[1]}),e},n.prototype.onPowerupBalloons=function(){a.audio.play(["powerupBalloons0","powerupBalloons1","powerupBalloons2"])},n.prototype.onPowerupBanana=function(){for(var t=this.getTempPositions(),e=this.getPositionsBehind(t),i=0;i<e.length;i++)this.level.opponents[e[i][0]].runSpeedMin*=.97},n.prototype.onPowerupBats=function(){a.audio.play(["powerupBats0","powerupBats1","powerupBats2"]);var t=this.getTempPositions(),e=this.getPositionsAhead(t),i=this.getPositionsBehind(t);0!==e.length?(this.level.addEffect(new u(this.level.getLayer("challenges"),this.level.opponents[e[0][0]].x,this.level.opponents[e[0][0]].y)),this.level.opponents[e[0][0]].runSpeedMin*=.85):(this.level.addEffect(new u(this.level.getLayer("challenges"),this.level.opponents[i[0][0]].x,this.level.opponents[i[0][0]].y)),this.level.opponents[i[0][0]].runSpeedMin*=.97)},n.prototype.onPowerupBubbles=function(){for(var t=this.getTempPositions(),e=this.getPositionsBehind(t),i=0;i<e.length;i++)this.level.opponents[e[i][0]].runSpeedMin*=.97},n.prototype.onPowerupButterfly=function(){a.audio.play(["powerupButterfly0","powerupButterfly1","powerupButterfly2"]),this.level.addEffect(new p(this.level.avatar.emitterHolder,0,0)),this.level.avatar.runSpeedMin*=1.02},n.prototype.onPowerupCannonball=function(){window.delay(function(){a.audio.play(["powerupBowlingBall0","powerupBowlingBall1","powerupBowlingBall2"])},.95,this);for(var t=this.getTempPositions(),e=this.getPositionsBehind(t),i=0;i<e.length;i++)this.level.opponents[e[i][0]].runSpeedMin*=.97},n.prototype.onPowerupNails=function(){window.delay(function(){a.audio.play(["powerupNails0","powerupNails1","powerupNails2"])},.87,this);for(var t=this.getTempPositions(),e=this.getPositionsBehind(t),i=0;i<e.length;i++)this.level.opponents[e[i][0]].runSpeedMin*=.97},n.prototype.onPowerupNitro=function(){this.level.avatar.runSpeedMin*=1.025},n.prototype.onPowerupOil=function(){for(var t=this.getTempPositions(),e=this.getPositionsBehind(t),i=0;i<e.length;i++)this.level.opponents[e[i][0]].runSpeedMin*=.97},n.prototype.onPowerupSmoke=function(){a.audio.play(["powerupSmoke0","powerupSmoke1","powerupSmoke2"]);for(var t=this.getTempPositions(),e=this.getPositionsBehind(t),i=0;i<e.length;i++)this.level.opponents[e[i][0]].runSpeedMin*=.97},n.prototype.onPowerupSpring=function(){a.audio.play(["powerupSpring0","powerupSpring1","powerupSpring2"])},n.prototype.shuffle=function(t){var e,i,s;for(s=t.length-1;s>0;s--)e=Math.floor(Math.random()*(s+1)),i=t[s],t[s]=t[e],t[e]=i;return t},n.prototype.refillPowerups=function(){for(a.gamePowerups=[],i=0;i<a.powerups.length;i++)a.gamePowerups.push(a.powerups[i]);this.shuffle(a.gamePowerups)},n.prototype.onPowerupNotHit=function(t){a.lastPickedIdx++},n.prototype.onPowerupHit=function(t){if(a.lastPickedIdx++,0===a.gamePowerups.length&&this.refillPowerups(),this.level.avatar.hasPowerup)return void console.log("Can not use multiple powerups, ignoring...");var e="";"random"===t.type?(e=a.gamePowerups[Math.floor(Math.random()*a.gamePowerups.length)],a.gamePowerups.splice(a.gamePowerups.indexOf(e),1)):(e=t.type,a.gamePowerups.indexOf(e)!==-1&&a.gamePowerups.splice(a.gamePowerups.indexOf(e),1)),null!==e&&(a.audio.play("powerupPickup"),this.onPowerupStart(e))},n.prototype.setPupButtonTexture=function(t){this.powerupButton.iconSprite.texture=a.assetManager.getTexture("game_powerup_"+t),this.powerupButton.icons=[],this.powerupButton.icons.push(this.powerupButton.iconSprite.texture),this.powerupButton.visible=!0,this.pupTL&&this.pupTL.kill(),this.pupTL=TweenMax.to(this.powerupButton.scale,1,{x:.9,y:.9,repeat:-1,yoyo:!0,ease:Sine.easeInOut})},n.prototype.onPowerupStart=function(t){this.canHaveFun=!1,this.saveSpeeds(),this.setPupButtonTexture(t),this.level.avatar.startPowerup(t),"balloons"===t?this.ballonsFloatingID=a.audio.play("powerupBalloonsFloating",{loop:!0}):(a.audio.stopByName(a.PATHS.SOUNDS+d.powerupBalloonsFloating.url),this.ballonsFloatingID=null)},n.prototype.onPowerupEnd=function(){this.restoreSpeeds(),a.audio.stopByName(a.PATHS.SOUNDS+d.powerupBalloonsFloating.url),this.ballonsFloatingID=null,this.powerupButton.visible=!1,TweenMax.delayedCall(1,function(){this.canHaveFun=!0},[],this)},n.prototype.onChallengeParticleHit=function(t){a.lastPickedIdx++},n.prototype.onChallengeHit=function(t){if(0===a.gameChallengeNames.length&&"random"===JSON.parse(t).challenge)return void console.log("No available challenges, ignoring...");this.canHaveFun=!1,a.audio.fade(this.raceLoopID,1,0,400),a.audio.play("raceStop");var e=.8;a.stopMusic(1e3*e),a.lastPickedIdx++,this.getPositions(),this.stopAll(),this.setUiInteractive(!1);var i;"string"==typeof t&&"random"===JSON.parse(t).challenge?(i=a.gameChallengeNames[Math.floor(Math.random()*a.gameChallengeNames.length)],a.gameChallengeNames.splice(a.gameChallengeNames.indexOf(i),1)):i="string"==typeof t?JSON.parse(t).challenge:t.challenge;var s=this.level.getLayer("layer_3"),n=this.level.getLayer("layer_4");TweenMax.to(s,e/2,{alpha:0,ease:Linear.easeNone}),TweenMax.to(n,e/2,{alpha:0,ease:Linear.easeNone}),a.animator.setTimeout(function(){this.isBusy=!0,TweenMax.killAll(),this.signals.challenge.dispatch(i)},e,this)},n.prototype.hidePicked=function(){var t=this.level.objectManager.getObjectsOfType("pickable");for(i=0;i<t.length;i++)t[i].picked&&(t[i].sprite.visible=!1)},n.prototype.shuffle=function(t){for(var e=t.length,i=null,s=-1;0!==e;)s=Math.floor(Math.random()*e),i=t[--e],t[e]=t[s],t[s]=i;return t},n.prototype.getRacePositions=function(){var t=[];t.push(this.level.avatar.x);for(var e=0;e<this.level.opponents.length;e++)t.push(this.level.opponents[e].x);return t},n.prototype.setSpeed=function(){
return 12+(6*Math.random()-3)},n.prototype.distanceToFinishLine=function(){return a.finishLine-this.level.avatar.x},n.prototype.update=function(){if(!a.paused&&!this.isBusy){if(this.level.update(),a.raceStarted){this.currentTick++;var t=0;if(this.currentTick>this.maxTicks){this.currentTick=0;this.getRacePositions();for(t=0;t<this.level.opponents.length;t++)this.level.opponents[t].x<this.level.avatar.x-this.maxDistBehind&&(this.level.opponents[t].speedDelta=this.setSpeed()),this.level.opponents[t].x>this.level.avatar.x+this.maxDistAhead&&(this.level.opponents[t].speedDelta=-this.setSpeed())}if(!this.level.avatar.hasPowerup)for(t=0;t<this.level.opponents.length;t++)this.level.opponents[t].runSpeedMin+=this.level.opponents[t].speedDelta,this.level.opponents[t].runSpeedMin<this.level.opponents[t].runSpeedMinDefault&&(this.level.opponents[t].runSpeedMin=this.level.opponents[t].runSpeedMinDefault),this.level.opponents[t].runSpeedMin>this.level.opponents[t].runSpeedMax&&(this.level.opponents[t].runSpeedMin=this.level.opponents[t].runSpeedMax)}if(this.distanceToFinishLine()<this.winningDistance){for(var e=this.getTempPositions(),i=this.getPositionsAhead(e),s=0;s<i.length;s++)this.level.opponents[i[s][0]].runSpeedMin*=.9;this.noLosers||(this.noLosers=!0,this.level.avatar.runSpeedMin*=1.065)}}},n.prototype.onPauseButtonClick=function(t){this.signals.pause.dispatch()},n.prototype.resetBars=function(){this.pickupsBar&&(this.pickupsBar.text.value=a.results.pickables)},n.prototype.onGameStart=function(){TweenMax.killAll(),a.speedMultiplier=1,a.repeat=0,this.level.avatar.alpha=1,this.resetBars(),this.decayTime=a.config.player.speedup.decayAfter,this.isGameOver=!1,this.setUiInteractive(!0)},n.prototype.saveSpeeds=function(){a.playersSpeeds=[],a.playersSpeeds.push(this.level.avatar.runSpeedMin);for(var t=0;t<this.level.opponents.length;t++)a.playersSpeeds.push(this.level.opponents[t].runSpeedMin)},n.prototype.restoreSpeeds=function(){this.level.avatar.runSpeedMin=a.playersSpeeds[0];for(var t=0;t<this.level.opponents.length;t++)this.level.opponents[t].runSpeedMin=a.playersSpeeds[t+1]},n.prototype.getPositions=function(){a.playersPositions=[],a.playersPositions.push([a.carColors[a.currentCar],this.level.avatar.x,this.level.avatar.y]);for(var t=0;t<this.level.opponents.length;t++)a.playersPositions.push([this.level.opponents[t].character,this.level.opponents[t].x,this.level.opponents[t].y])},n.prototype.getResults=function(){console.log("you are : ",a.carColors[a.currentCar]),console.log("------");for(var t=[],e=0;e<a.playersPositions.length;e++)t.push(a.playersPositions[e]);for(t.sort(function(t,e){return e[1]-t[1]}),a.opponentsResults=[],e=0;e<t.length;e++)console.log(t[e][0]+" : ",t[e][1]),t[e][0]!==a.carColors[a.currentCar]&&a.opponentsResults.push(t[e][0])},n.prototype.startAll=function(t){var e=0,i=.8,s=[];for(s.push({runSpeed:this.level.avatar.runSpeed,runSpeedMin:this.level.avatar.runSpeedMin,runSpeedMax:this.level.avatar.runSpeedMax}),this.level.avatar.runSpeed=0,TweenMax.to(this.level.avatar,i,{runSpeed:s[0].runSpeed,runSpeedMin:s[0].runSpeedMin,runSpeedMax:s[0].runSpeedMax,ease:Cubic.easeOut}),e=0;e<this.level.opponents.length;e++)s.push({runSpeed:this.level.opponents[e].runSpeed,runSpeedMin:this.level.opponents[e].runSpeedMin,runSpeedMax:this.level.opponents[e].runSpeedMax}),this.level.opponents[e].runSpeed=0;for(e=0;e<this.level.opponents.length;e++)TweenMax.to(this.level.opponents[e],i,{runSpeed:s[e+1].runSpeed,runSpeedMin:s[e+1].runSpeedMin,runSpeedMax:s[e+1].runSpeedMax,ease:Cubic.easeOut});this.playStartRaceSounds(t),TweenMax.delayedCall(i,function(){this.canHaveFun=!0},[],this),a.raceStarted=!0},n.prototype.stopAll=function(){TweenMax.to(this.level.avatar,.8,{runSpeed:0,runSpeedMin:0,runSpeedMax:0,ease:Cubic.easeOut});for(var t=0;t<this.level.opponents.length;t++)TweenMax.to(this.level.opponents[t],.8,{runSpeed:0,runSpeedMin:0,runSpeedMax:0,ease:Cubic.easeOut})},n.prototype.gameOver=function(t){this.getPositions(),this.getResults(),a.audio.fade(this.raceLoopID,1,0,400),a.audio.play("raceStop");var e=.8;a.stopMusic(1e3*e),this.stopAll(),a.animator.setTimeout(function(){this.isBusy=!0},e,this),this.setUiInteractive(!1),this.isGameOver=!0,this.noLosers=!1,a.reset(),a.animator.setTimeout(function(){a.raceStarted=!1,this.signals.next.dispatch()},1,this)},n.prototype.onLightsDone=function(){null!==this.raceStartIdleID&&(a.audio.stop(this.raceStartIdleID),this.raceStartIdleID=null,a.animator.setTimeout(function(){this.setUiVisible(!0),a.viewManager.runShowTweens()},a.TRANSITION_DURATION/2,this)),this.raceStart()},n.prototype.animateLights=function(){this.lights.visible=!0,this.lights.start()},n.prototype.playStartRaceSounds=function(t){var e=a.audio.play(t);a.animator.setTimeout(function(){a.audio.fade(e,1,0,300),this.raceLoopID=a.audio.play("raceLoop",{loop:!0})},.5,this)},n.prototype.raceStart=function(){this.startAll("raceStart")},n.prototype.appear=function(){a.playMusic("gameMusic"),this.setUiVisible(!1),a.viewManager.done=!1,a.viewManager.showTweensComplete.add(this.onShowTweensComplete.bind(this)),a.viewManager.setShowTweensTime(.005),a.raceStarted?(a.raceStarted=!1,a.animator.setTimeout(function(){this.startAll("rejoinRace"),this.setUiVisible(!0),a.viewManager.runShowTweens()},a.TRANSITION_DURATION/2+.2,this)):(this.raceStartIdleID=a.audio.play("raceStartIdle"),this.animateLights())},n.prototype.setUiVisible=function(t){if(this.uiContainer){for(var e=0;e<this.uiContainer.children.length;e++)this.uiContainer.children[e].visible=t;t&&(this.powerupButton.visible=this.level.avatar.hasPowerup)}},n.prototype.setUiInteractive=function(t){if(this.uiContainer)for(var e=0;e<this.uiContainer.children.length;e++)this.uiContainer.children[e].interactive=t},n.prototype.onShowTweensComplete=function(){a.viewManager.done=!0},n.prototype.onFunContainerDown=function(){this.canHaveFun&&this.level.avatar.funJump()},n.prototype.destroy=function(){if(a.audio.stopByName(a.PATHS.SOUNDS+d.powerupBalloonsFloating.url),a.memoryManager.free("game"),this._timelines)for(var t=0;t<this._timelines.length;t++)this._timelines[t].kill();null!==this.raceLoopID&&(a.audio.stop(this.raceLoopID),this.raceLoopID=null),TweenMax.killAll(),this.signals.howToPlay.dispose(),this.destroySignals(),this.destroyUiElements(),this.lights.doSeppuku(),this.level.destroy({children:!0}),p3.Scene.prototype.destroy.call(this),a.isWebGL&&a.renderer.textureGC.run()},n.prototype.resize=function(){this.x=Math.round((p3.View.width-a.STAGE_WIDTH)/2),a.viewManager.repositionDynElements(),this.funContainer.hitArea.x=this.x,this.funContainer.hitArea.width=a.STAGE_WIDTH,this.funContainer.hitArea.height=a.STAGE_HEIGHT}},{"../challenges/challenge-preloader":11,"../common":42,"../game/Level":51,"../game/effects/EffectRaceBats":61,"../game/effects/EffectRaceButterfly":63,"../loader/audio-loader":97,"../traffic-lights":113,"mini-signals":3}],109:[function(t,e,i){function s(){p3.Scene.call(this),this.interactive=!0,this.interactiveChildren=!0,n.viewManager.add(n.assetManager.getJSON("howToPlayView")),this.layout=n.viewManager.get(n.viewManager.activeLayout),this.screenDim=null,this.helpImages=[],this.helpDescriptions=[],this.current=0}var n=t("../common"),o=t("../screendim/screendim");e.exports=s,s.prototype=Object.create(p3.Scene.prototype),s.prototype.constructor=s,s.prototype.init=function(){if(this.layout.dim){var t=this.layout.dim.color?this.layout.dim.color:null,e=this.layout.dim.duration?this.layout.dim.duration:null,i=this.layout.dim.alphaIn?this.layout.dim.alphaIn:null,s=this.layout.dim.alphaOut?this.layout.dim.alphaOut:null;this.layout.dim.alphaIn||this.layout.dim.alphaOut||!this.layout.dim.alpha||(i=this.layout.dim.alpha,s=0),this.screenDim=new o(t,e,i,s).addTo(this)}this.layout.dialog&&(this.dialogContainer=(new WRE.Container).addTo(this),this.initDialogElements())},s.prototype.initDialogElements=function(){this.dialogSprite=n.viewManager.addSprite(this.layout.dialog.main).addTo(this.dialogContainer);for(var t in this.layout.dialog.children)switch(t){case"howToPlayText":this.howToPlayText=n.viewManager.addText(this.layout.dialog.children.howToPlayText).addTo(this.dialogSprite);break;case"howToPlayDescription":var e=null;"string"==typeof this.layout.dialog.children.howToPlayDescription.textID||this.layout.dialog.children.howToPlayDescription.textID instanceof String?(e=this.layout.dialog.children.howToPlayDescription.textID,this.helpDescriptions.push(e)):this.layout.dialog.children.howToPlayDescription.textID instanceof Array&&(e=this.layout.dialog.children.howToPlayDescription.textID[0],this.helpDescriptions=WRE.cloneObj(this.layout.dialog.children.howToPlayDescription.textID));var i=WRE.cloneObj(this.layout.dialog.children.howToPlayDescription);i.textID=null,i.textID=e,this.howToPlayDescriptionText=n.viewManager.addText(i).addTo(this.dialogSprite);break;case"howToPlayImages":var s=null;"string"==typeof this.layout.dialog.children.howToPlayImages.textures||this.layout.dialog.children.howToPlayImages.textures instanceof String?(s=this.layout.dialog.children.howToPlayImages.textures,this.helpImages.push(s)):this.layout.dialog.children.howToPlayImages.textures instanceof Array&&(s=this.layout.dialog.children.howToPlayImages.textures[0],this.helpImages=WRE.cloneObj(this.layout.dialog.children.howToPlayImages.textures));var o=WRE.cloneObj(this.layout.dialog.children.howToPlayImages);o.textures=null,o.texture=s,this.howToPlayImageFrameSprite=n.viewManager.addSprite(o).addTo(this.dialogSprite);break;case"leftButton":this.leftButton=n.viewManager.addButton(this.layout.dialog.children.leftButton).addTo(this.dialogSprite),this.leftButton.on("button-on-click",this.onLeftButtonClick.bind(this));break;case"rightButton":this.rightButton=n.viewManager.addButton(this.layout.dialog.children.rightButton).addTo(this.dialogSprite),this.rightButton.on("button-on-click",this.onRightButtonClick.bind(this));break;case"closeButton":this.closeButton=n.viewManager.addButton(this.layout.dialog.children.closeButton).addTo(this.dialogSprite),this.closeButton.on("button-on-click",this.onCloseButtonClick.bind(this))}},s.prototype.onLeftButtonClick=function(){this.helpImages.length<=1||(this.current--,this.current<0&&(this.current=this.helpImages.length-1),this.howToPlayImageFrameSprite.texture=n.assetManager.getTexture(this.helpImages[this.current]),this.howToPlayDescriptionText.text=n.language.get(this.helpDescriptions[this.current]))},s.prototype.onRightButtonClick=function(){this.numHelpImages<=1||(this.current++,this.current>this.helpImages.length-1&&(this.current=0),this.howToPlayImageFrameSprite.texture=n.assetManager.getTexture(this.helpImages[this.current]),this.howToPlayDescriptionText.text=n.language.get(this.helpDescriptions[this.current]))},s.prototype.onCloseButtonClick=function(){this.requestPreviousScene()},s.prototype.runPreviousScene=function(){this.signals.previous.dispatch()},s.prototype.requestPreviousScene=function(){n.viewManager.hasHideTweens?(this.screenDim&&this.screenDim.out(),n.viewManager.hideTweensComplete.detachAll(),n.viewManager.hideTweensComplete.add(function(){this.runPreviousScene()},this),n.viewManager.runHideTweens()):this.runPreviousScene()},s.prototype.appear=function(){this.screenDim&&this.screenDim["in"](),n.viewManager.runShowTweens()},s.prototype.destroy=function(){this.howToPlayText&&this.howToPlayText.destroy(n.destroyOptions),this.howToPlayDescriptionText&&this.howToPlayDescriptionText.destroy(n.destroyOptions),this.leftButton&&this.leftButton.doSeppuku(),this.rightButton&&this.rightButton.doSeppuku(),this.closeButton&&this.closeButton.doSeppuku(),p3.Scene.prototype.destroy.call(this)},s.prototype.update=function(){},s.prototype.resize=function(){this.x=Math.round((p3.View.width-n.STAGE_WIDTH)/2),this.screenDim&&(this.screenDim.resize(),this.screenDim.x=-this.x),n.viewManager.repositionDynElements()}},{"../common":42,"../screendim/screendim":105}],110:[function(t,e,i){function s(){p3.Scene.call(this),n.viewManager.add(n.assetManager.getJSON("pauseView")),this.layout=n.viewManager.get(n.viewManager.activeLayout),this.pages=[n.assetManager.getTexture("ui_help_01"),n.assetManager.getTexture("ui_help_02"),n.assetManager.getTexture("ui_help_03"),n.assetManager.getTexture("ui_help_04")],this.tints=[16777215,16777215,16777215,16777215],this.topPos=-631,this.maskTopPos=101,this.currentPage=0,this.screenDim=null,this.popup=null,this.maskTL=null}var n=t("../common"),o=t("../screendim/screendim"),a=t("../help-text");e.exports=s,s.prototype=Object.create(p3.Scene.prototype),s.prototype.constructor=s,s.prototype.init=function(){if(this.layout.dim){var t=this.layout.dim.color?this.layout.dim.color:null,e=this.layout.dim.duration?this.layout.dim.duration:null,i=this.layout.dim.alphaIn?this.layout.dim.alphaIn:null,s=this.layout.dim.alphaOut?this.layout.dim.alphaOut:null;this.layout.dim.alphaIn||this.layout.dim.alphaOut||!this.layout.dim.alpha||(i=this.layout.dim.alpha,s=0),this.screenDim=new o(t,e,i,s).addTo(this)}this.board=n.viewManager.addSprite(this.layout.board).addTo(this);for(var r=40,h=0;h<this.pages.length;h++)this["pagination"+h]=n.viewManager.addSprite(this.layout.pagination).addTo(this.board),this["pagination"+h].x=-1.5*r+r*h,this["pagination"+h].y=-30-h%2*10,this["pagination"+h].alpha=0,this["pagination"+h].scaleXY=0;this["pagination"+this.currentPage].texture=n.assetManager.getTexture("ui_pagination_on"),this.pausedText=n.viewManager.addText(this.layout.pausedText).addTo(this.board),this.page=n.viewManager.addSprite(this.layout.page).addTo(this.board),this.maskSprite=new WRE.Sprite({texture:PIXI.Texture.WHITE,x:950-this.board.width/2,y:this.maskTopPos-this.board.height,width:this.board.width,height:400}).addTo(this),this.page.mask=this.maskSprite,this.roll=n.viewManager.addSprite(this.layout.roll).addTo(this.board),this.roll.y=this.topPos;var l={bg:{texture:n.assetManager.getTexture("ui_help_copy_bg"),nineSlice:[40,40,40,40]},choices:["ui_help_01"]};this.popup=new a(l).addTo(this),this.popup.init(),this.popup.x=950,this.popup.y=620,this.popup.show(),this.initUiElements()},s.prototype.initUiElements=function(){this.uiContainer=(new WRE.Container).addTo(this);for(var t in this.layout.ui)switch(t){case"pausedText":this.pausedText=n.viewManager.addText(this.layout.ui.pausedText).addTo(this.uiContainer);break;case"homeButton":this.homeButton=n.viewManager.addButton(this.layout.ui.homeButton).addTo(this.uiContainer),this.homeButton.on("button-on-click",this.onHomeButtonClick.bind(this));break;case"soundButton":this.soundButton=n.viewManager.addSwitchButton(this.layout.ui.soundButton).addTo(this.uiContainer),this.soundButton.on("button-on-click",this.onSoundButtonClick.bind(this)),this.soundButton.state=n.storage_data.muted?1:0;break;case"continueButton":this.continueButton=n.viewManager.addButton(this.layout.ui.continueButton).addTo(this.uiContainer),this.continueButton.on("button-on-click",this.onContinueButtonClick.bind(this));break;case"previousButton":this.previousButton=n.viewManager.addButton(this.layout.ui.previousButton).addTo(this.uiContainer),this.previousButton.on("button-on-click",this.onPreviousButtonClick.bind(this));break;case"nextButton":this.nextButton=n.viewManager.addButton(this.layout.ui.nextButton).addTo(this.uiContainer),this.nextButton.on("button-on-click",this.onNextButtonClick.bind(this))}},s.prototype.animateBoardIn=function(){var t=new TimelineMax({onComplete:function(){this.animatePageIn()},onCompleteScope:this});t.from(this.board,.3,{delay:.1,y:1800,ease:Cubic.easeOut},"start"),t.to(this.board.scale,.1,{delay:.2,y:1.1,repeat:1,yoyo:!0,ease:Sine.easeInOut},"start")},s.prototype.animateBoardOut=function(){var t=new TimelineMax;t.to(this.board.scale,.1,{y:1.1,repeat:1,yoyo:!0,ease:Sine.easeInOut},"start"),t.to(this.board,.4,{delay:.1,y:1800,ease:Cubic.easeOut},"start")},s.prototype.destroyUiElements=function(){for(var t=0;t<this.uiContainer.children.length;t++)this.uiContainer.children[t].doSeppuku&&this.uiContainer.children[t].doSeppuku();this.uiContainer.destroy(n.destroyOptions)},s.prototype.requestNextScene=function(){n.viewManager.hasHideTweens?(this.animateBoardOut(),this.screenDim&&this.screenDim.out(),this.popup&&this.popup.hide(),n.viewManager.hideTweensComplete.detachAll(),n.viewManager.hideTweensComplete.add(function(){this.runNextScene()},this),n.viewManager.runHideTweens()):this.runNextScene()},s.prototype.runNextScene=function(){this.signals.next.dispatch()},s.prototype.onContinueButtonClick=function(){this.requestNextScene()},s.prototype.onHomeButtonClick=function(){this.signals.previous.dispatch()},s.prototype.onSoundButtonClick=function(t){n.toggleMute(),t.state=n.storage_data.muted?1:0},s.prototype.onPreviousButtonClick=function(){this.currentPage--,this.currentPage<0&&(this.currentPage=this.pages.length-1),this.updatePage()},s.prototype.onNextButtonClick=function(){this.currentPage++,this.currentPage>this.pages.length-1&&(this.currentPage=0),this.updatePage()},s.prototype.showPagination=function(t){for(var e=0;e<this.pages.length;e++)this["pagination"+e].alpha=t?0:1;for(e=0;e<this.pages.length;e++)TweenMax.to(this["pagination"+e],.1+(t?.1:0),{delay:t?.07*e:0,alpha:t?1:0}),TweenMax.to(this["pagination"+e].scale,.15+(t?.1:0),{delay:t?.07*e:0,x:t?1:0,y:t?1:0,ease:Back.easeOut})},s.prototype.updateHelpText=function(){this.popup.choices[0].text=n.language.get("ui_help_0"+(this.currentPage+1)),this.popup.choices[0].x=Math.floor(-this.popup.choices[0].width/2),this.popup.resizeBg(),this.popup.alignChoices()},s.prototype.updatePage=function(){this.page.texture=this.pages[this.currentPage],this.page.tint=this.tints[this.currentPage],this.maskTL&&(this.maskTL.kill(),this.maskTL=null);var t=.5;this.maskTL=new TimelineMax({onStart:function(){this.roll.alpha=1,this.roll.visible=!0},onStartScope:this,onComplete:function(){this.roll.visible=!1},onCompleteScope:this}),this.maskTL.fromTo(this.maskSprite,t,{y:this.maskTopPos-this.maskSprite.height},{y:this.maskTopPos,ease:Cubic.easeInOut},"start"),this.maskTL.fromTo(this.roll,t,{y:this.topPos},{y:this.topPos+340,ease:Cubic.easeInOut},"start"),this.maskTL.fromTo(this.roll.scale,t,{x:1,y:1},{x:.9,y:0},"start"),this.maskTL.fromTo(this.roll,.1,{alpha:1},{delay:.4,alpha:0},"start");for(var e=0;e<this.pages.length;e++)this["pagination"+e].texture=n.assetManager.getTexture("ui_pagination_off");this["pagination"+this.currentPage].texture=n.assetManager.getTexture("ui_pagination_on"),this.updateHelpText()},s.prototype.animatePageIn=function(){this.showPagination(!0),this.page.visible=!0,this.updatePage()},s.prototype.appear=function(){Howler.volume(0),this.screenDim&&this.screenDim["in"](),this.setUiVisible(!1),n.viewManager.done=!1,n.viewManager.showTweensComplete.add(this.onShowTweensComplete.bind(this)),n.viewManager.setShowTweensTime(.005),this.setUiVisible(!0),n.viewManager.runShowTweens(),this.animateBoardIn()},s.prototype.setUiVisible=function(t){if(this.uiContainer)for(var e=0;e<this.uiContainer.children.length;e++)this.uiContainer.children[e].visible=t},s.prototype.pause=function(){this.interactive=!1,this.interactiveChildren=!1},s.prototype.resume=function(){n.viewManager.activeLayout="pauseView",this.interactive=!0,this.interactiveChildren=!0},s.prototype.onShowTweensComplete=function(){n.viewManager.done=!0},s.prototype.destroy=function(){Howler.volume(1),this.screenDim&&this.screenDim.out(),this.maskTL&&(this.maskTL.kill(),this.maskTL=null),this.popup&&this.popup.hide(),this.destroyUiElements(),this.pausedText.destroy(n.destroyAllOptions),p3.Scene.prototype.destroy.call(this)},s.prototype.update=function(){},s.prototype.resize=function(){this.x=Math.round((p3.View.width-n.STAGE_WIDTH)/2),this.screenDim&&(this.screenDim.resize(),this.screenDim.x=-this.x),n.viewManager.repositionDynElements()}},{"../common":42,"../help-text":92,"../screendim/screendim":105}],111:[function(t,e,i){function s(){p3.Scene.call(this),this.stars=3,this.podiumPos=new PIXI.Point(640,720),this.podiumFinalPos=new PIXI.Point(950,700),this.podiumOff=[new PIXI.Point((-290),20),new PIXI.Point(290,40)],this.chars=[[{texture:"ui_char_pink",anchorX:.5,anchorY:1,scaleX:-.8,scaleY:.8,x:20,y:20}],[{texture:"ui_char_red",anchorX:.5,anchorY:1,scaleX:-.8,scaleY:.8,x:10,y:20}],[{texture:"ui_char_purple",anchorX:.5,anchorY:1,scaleX:-.8,scaleY:.8,x:10,y:26},{texture:"ui_char_purple_2",anchorX:.5,anchorY:1,scaleX:-.8,scaleY:.8,x:-16,y:20}],[{texture:"ui_char_yellow",anchorX:.5,anchorY:1,scaleX:-1.1,scaleY:1.1,x:0,y:20}],[{texture:"ui_char_brown",anchorX:.5,anchorY:1,scaleX:-.9,scaleY:.9,x:-20,y:10}],[{texture:"ui_char_blue_2",anchorX:.5,anchorY:1,scaleX:.8,scaleY:.8,x:20,y:56},{texture:"ui_char_blue",anchorX:.5,anchorY:1,scaleX:-.8,scaleY:.8,x:0,y:10}]];var t=WRE.cloneObj(n.assetManager.getJSON("resultsView"));t.resultsView.character.texture=t.resultsView.character.texture.replaceAll("#CARCOLOR#",n.carColors[n.currentCar]),t.resultsView.character2.texture=t.resultsView.character2.texture.replaceAll("#CARCOLOR#",n.carColors[n.currentCar]),n.viewManager.add(t),this.layout=n.viewManager.get(n.viewManager.activeLayout),this.trophyTL=null,this.charList=[],this.screenDim=null}var n=t("../common"),o=t("../screendim/screendim");e.exports=s,s.prototype=Object.create(p3.Scene.prototype),s.prototype.constructor=s,s.prototype.init=function(){if(this.layout.dim){var t=this.layout.dim.color?this.layout.dim.color:null,e=this.layout.dim.duration?this.layout.dim.duration:null,i=this.layout.dim.alphaIn?this.layout.dim.alphaIn:null,s=this.layout.dim.alphaOut?this.layout.dim.alphaOut:null;this.layout.dim.alphaIn||this.layout.dim.alphaOut||!this.layout.dim.alpha||(i=this.layout.dim.alpha,s=0),this.screenDim=new o(t,e,i,s).addTo(this)}this.bg=n.viewManager.addSprite(this.layout.bg).addTo(this),this.shine1=n.viewManager.addSprite(this.layout.shine1).addTo(this),this.shine2=n.viewManager.addSprite(this.layout.shine2).addTo(this),this.amazing=n.viewManager.addSprite(this.layout.amazing).addTo(this),this.amazingText=n.viewManager.addText(this.layout.amazingText).addTo(this),this.amazingText.text=n.language.get("challenge_stars"),this.trophy=n.viewManager.addSprite(this.layout.trophy).addTo(this),this.particleContainer=(new WRE.Container).addTo(this);var a=0;for(this.podium2Container=new WRE.Container({x:this.podiumFinalPos.x+this.podiumOff[1].x,y:this.podiumFinalPos.y+this.podiumOff[1].y,visible:!1}).addTo(this),a=0;a<this.chars[n.carColors.indexOf(n.opponentsResults[1])].length;a++)this["character2"+a]=new WRE.Sprite(this.chars[n.carColors.indexOf(n.opponentsResults[1])][a]).addTo(this.podium2Container),this["character2"+a].scaleX*=-1,this["character2"+a].x*=-1,this.charList.push(this["character2"+a]);for(n.viewManager.addSprite(this.layout.podium).addTo(this.podium2Container),this.podium1Container=new WRE.Container({x:this.podiumFinalPos.x+this.podiumOff[0].x,y:this.podiumFinalPos.y+this.podiumOff[0].y,visible:!1}).addTo(this),a=0;a<this.chars[n.carColors.indexOf(n.opponentsResults[0])].length;a++)this["character1"+a]=new WRE.Sprite(this.chars[n.carColors.indexOf(n.opponentsResults[0])][a]).addTo(this.podium1Container),this.charList.push(this["character1"+a]);for(n.viewManager.addSprite(this.layout.podium).addTo(this.podium1Container),this.podium0Container=new WRE.Container({x:this.podiumPos.x,y:this.podiumPos.y}).addTo(this),a=0;a<this.chars[n.currentCar].length;a++)this["character0"+a]=new WRE.Sprite(this.chars[n.currentCar][a]).addTo(this.podium0Container),this.charList.push(this["character0"+a]);n.viewManager.addSprite(this.layout.podium).addTo(this.podium0Container),this.initUiElements()},s.prototype.initUiElements=function(){this.uiContainer=(new WRE.Container).addTo(this);for(var t in this.layout.ui)switch(t){case"homeButton":this.homeButton=n.viewManager.addButton(this.layout.ui.homeButton).addTo(this.uiContainer),this.homeButton.on("button-on-click",this.onHomeButtonClick.bind(this));break;case"soundButton":this.soundButton=n.viewManager.addSwitchButton(this.layout.ui.soundButton).addTo(this.uiContainer),this.soundButton.on("button-on-click",this.onSoundButtonClick.bind(this)),this.soundButton.state=n.storage_data.muted?1:0;break;case"restartButton":this.restartButton=n.viewManager.addButton(this.layout.ui.restartButton).addTo(this.uiContainer),this.restartButton.on("button-on-click",this.onRestartButtonClick.bind(this))}},s.prototype.onHomeButtonClick=function(){this.signals.previous.dispatch()},s.prototype.onSoundButtonClick=function(t){n.toggleMute(),t.state=n.storage_data.muted?1:0},s.prototype.onRestartButtonClick=function(){this.dismiss()},s.prototype.runNextScene=function(){this.signals.next.dispatch()},s.prototype.requestNextScene=function(){n.viewManager.hasHideTweens?(this.screenDim&&this.screenDim.out(),n.viewManager.hideTweensComplete.detachAll(),n.viewManager.hideTweensComplete.add(function(){this.runNextScene()},this),n.viewManager.runHideTweens()):this.runNextScene()},s.prototype.requestPreviousScene=function(){n.viewManager.hasHideTweens?(this.screenDim&&this.screenDim.out(),n.viewManager.hideTweensComplete.detachAll(),n.viewManager.hideTweensComplete.add(function(){this.runPreviousScene()},this),n.viewManager.runHideTweens()):this.runPreviousScene()},s.prototype.animateShine=function(){TweenMax.from(this.shine1,.2,{delay:.2,alpha:0}),TweenMax.from(this.shine2,.2,{delay:.3,alpha:0}),TweenMax.to(this.shine1,8,{rotation:2*Math.PI,repeat:-1,ease:Linear.easeNone}),TweenMax.to(this.shine2,8,{rotation:-2*Math.PI,repeat:-1,ease:Linear.easeNone}),TweenMax.from(this.shine1.scale,.4,{delay:.2,x:0,y:0,ease:Back.easeOut}),TweenMax.from(this.shine2.scale,.4,{delay:.3,x:0,y:0,ease:Back.easeOut})},s.prototype.animateAmazing=function(){TweenMax.from(this.amazing,.45,{delay:.1,y:800,ease:Cubic.easeOut}),TweenMax.from(this.amazingText,.45,{delay:.1,y:800,ease:Cubic.easeOut})},s.prototype.animateTrophy=function(){this.trophyTL=new TimelineMax,this.trophyTL.to(this.trophy,.4,{delay:.2,y:450,ease:Cubic.easeOut}),this.trophyTL.to(this.trophy,.3,{delay:2,alpha:0,y:1800,ease:Back.easeIn}),this.trophyTL.to(this.podium0Container,.3,{delay:0,x:this.podiumFinalPos.x,y:this.podiumFinalPos.y,ease:Cubic.easeOut},"s"),this.trophyTL.from(this.podium1Container,.3,{delay:.1,x:-2e3,ease:Cubic.easeOut,onStart:function(){this.podium1Container.visible=!0},onStartScope:this},"s"),this.trophyTL.from(this.podium2Container,.3,{delay:.2,x:2e3,ease:Cubic.easeOut,onStart:function(){this.podium2Container.visible=!0},onStartScope:this},"s")},s.prototype.animateCharacter=function(){var t=new TimelineMax;t.from(this.podium0Container,.3,{delay:.1,y:1800,ease:Cubic.easeOut},"start")},s.prototype.animateShineOut=function(){TweenMax.to(this.shine1.scale,.2,{x:0,y:0,ease:Back.easeIn}),TweenMax.to(this.shine2.scale,.2,{x:0,y:0,ease:Back.easeIn}),TweenMax.to(this.shine1,.2,{alpha:0,ease:Linear.easeNone}),TweenMax.to(this.shine2,.2,{alpha:0,ease:Linear.easeNone})},s.prototype.animateCharacterOut=function(){var t=new TimelineMax;t.to(this.podium2Container,.4,{delay:.1,y:1800,ease:Cubic.easeOut},"start"),t.to(this.podium1Container,.4,{delay:.2,y:1800,ease:Cubic.easeOut},"start"),t.to(this.podium0Container,.4,{delay:.3,y:1800,ease:Cubic.easeOut},"start")},s.prototype.dismiss=function(){this.animateShineOut(),this.animateCharacterOut(),this.requestNextScene()},s.prototype.appear=function(){this.screenDim&&this.screenDim["in"](),n.viewManager.showTweensComplete.add(this.onShowTweensComplete.bind(this)),n.viewManager.runShowTweens(),this.animateShine(),this.animateAmazing(),this.animateTrophy(),this.animateCharacter(),n.stopMusic(),n.playMusic("raceCompleteMusic")},s.prototype.onShowTweensComplete=function(){},s.prototype.destroy=function(){n.viewManager.showTweensComplete.detachAll(),n.viewManager.hideTweensComplete.detachAll(),this.amazingText&&this.amazingText.destroy(n.destroyAllOptions),this.trophyTL&&this.trophyTL.kill(),TweenMax.killAll(),p3.Scene.prototype.destroy.call(this)},s.prototype.update=function(){},s.prototype.resize=function(){this.x=Math.round((p3.View.width-n.STAGE_WIDTH)/2),this.screenDim&&(this.screenDim.resize(),this.screenDim.x=-this.x),n.viewManager.repositionDynElements()}},{"../common":42,"../screendim/screendim":105}],112:[function(t,e,i){function s(){p3.Scene.call(this),o.viewManager.add(o.assetManager.getJSON("titleView")),this.layout=o.viewManager.get(o.viewManager.activeLayout),this.initSignals(),this.debug=!1,this.sparklePS=null,this.lTL=null}var n=t("mini-signals"),o=t("../common");e.exports=s,s.prototype=Object.create(p3.Scene.prototype),s.prototype.constructor=s,s.prototype.init=function(){this.bg=o.viewManager.addSprite(this.layout.bg).addTo(this),this.logoContainer=new WRE.Container({x:670,y:140}).addTo(this),this.sparklePSContainer=new WRE.Container({interactive:!1,interactiveChildren:!1}).addTo(this.logoContainer),this.logo=o.viewManager.addSprite(this.layout.logo).addTo(this.logoContainer),this.logo2=o.viewManager.addSprite(this.layout.logo2).addTo(this.logoContainer),this.boomLogo=o.viewManager.addSprite(this.layout.boomLogo).addTo(this),this.initUiElements()},s.prototype.initSignals=function(){"undefined"==typeof this.signals&&(this.signals={}),this.signals.challenge=new n},s.prototype.destroySignals=function(){for(var t in this.signals)this.signals[t]instanceof n&&this.signals[t].detachAll()},s.prototype.initUiElements=function(){this.uiContainer=(new WRE.Container).addTo(this);for(var t in this.layout.ui)switch(t){case"soundButton":this.soundButton=o.viewManager.addSwitchButton(this.layout.ui.soundButton).addTo(this.uiContainer),this.soundButton.on("button-on-click",this.onSoundButtonClick.bind(this)),this.soundButton.state=o.storage_data.muted?1:0;break;case"playButton":this.playButton=o.viewManager.addButton(this.layout.ui.playButton).addTo(this.uiContainer),this.playButton.on("button-on-click",this.onPlayButtonClick.bind(this));break;case"button1":this.debug&&(this.button1=o.viewManager.addButton(this.layout.ui.button1).addTo(this.uiContainer),this.button1.on("button-on-click",this.onButton1Click.bind(this)));break;case"button2":this.debug&&(this.button2=o.viewManager.addButton(this.layout.ui.button2).addTo(this.uiContainer),this.button2.on("button-on-click",this.onButton2Click.bind(this)));break;case"button3":this.debug&&(this.button3=o.viewManager.addButton(this.layout.ui.button3).addTo(this.uiContainer),this.button3.on("button-on-click",this.onButton3Click.bind(this)));break;case"button4":this.debug&&(this.button4=o.viewManager.addButton(this.layout.ui.button4).addTo(this.uiContainer),this.button4.on("button-on-click",this.onButton4Click.bind(this)));break;case"button5":this.debug&&(this.button5=o.viewManager.addButton(this.layout.ui.button5).addTo(this.uiContainer),this.button5.on("button-on-click",this.onButton5Click.bind(this)));break;case"button6":this.debug&&(this.button6=o.viewManager.addButton(this.layout.ui.button6).addTo(this.uiContainer),this.button6.on("button-on-click",this.onButton6Click.bind(this)));break;case"button7":this.debug&&(this.button7=o.viewManager.addButton(this.layout.ui.button7).addTo(this.uiContainer),this.button7.on("button-on-click",this.onButton7Click.bind(this)))}},s.prototype.initParticles=function(t,e){this.sparklePS=new PIXI.particles.Emitter(this.sparklePSContainer,[o.assetManager.getTexture("titleParticle0"),o.assetManager.getTexture("titleParticle1")],o.assetManager.getJSON("titleEmitter")),this.sparklePS.updateSpawnPos(t,e),this.sparklePS.emit=!0},s.prototype.destroyUiElements=function(){for(var t=0;t<this.uiContainer.children.length;t++)this.uiContainer.children[t].doSeppuku&&this.uiContainer.children[t].doSeppuku();this.uiContainer.destroy(o.destroyOptions)},s.prototype.update=function(){this.sparklePS&&this.sparklePS.update(p3.Timestep.deltaTime)},s.prototype.onSoundButtonClick=function(t){o.toggleMute("titleMusic"),t.state=o.storage_data.muted?1:0},s.prototype.onPlayButtonClick=function(){this.playButton.interactive=!1,o.storage_data.muted||o.stopMusic(900),o.audio.play("titleSoundEnd"),
this.requestNextScene()},s.prototype.requestNextScene=function(){o.animator.setTimeout(function(){o.viewManager.hasHideTweens?(o.viewManager.hideTweensComplete.detachAll(),o.viewManager.hideTweensComplete.add(function(){this.signals.next.dispatch()},this),o.viewManager.runHideTweens()):this.signals.next.dispatch()},o.storage_data.muted?0:1,this)},s.prototype.onButton1Click=function(){o.raceStarted=!1,this.setUiInteractive(!1),o.randomizeLevel(),o.currentCar=Math.floor(Math.random()*o.carColors.length),this.signals.challenge.dispatch(o.challengeNames[0])},s.prototype.onButton2Click=function(){o.raceStarted=!1,this.setUiInteractive(!1),o.currentCar=Math.floor(Math.random()*o.carColors.length),this.signals.challenge.dispatch(o.challengeNames[1])},s.prototype.onButton3Click=function(){o.raceStarted=!1,this.setUiInteractive(!1),o.currentCar=Math.floor(Math.random()*o.carColors.length),this.signals.challenge.dispatch(o.challengeNames[2])},s.prototype.onButton4Click=function(){o.raceStarted=!1,this.setUiInteractive(!1),o.currentCar=Math.floor(Math.random()*o.carColors.length),this.signals.challenge.dispatch(o.challengeNames[3])},s.prototype.onButton5Click=function(){o.raceStarted=!1,this.setUiInteractive(!1),o.currentCar=Math.floor(Math.random()*o.carColors.length),this.signals.challenge.dispatch(o.challengeNames[4])},s.prototype.onButton6Click=function(){o.raceStarted=!1,this.setUiInteractive(!1),o.currentCar=Math.floor(Math.random()*o.carColors.length),o.randomizeLevel(),this.signals.challenge.dispatch(o.challengeNames[5])},s.prototype.onButton7Click=function(){o.raceStarted=!1,this.setUiInteractive(!1),o.currentCar=Math.floor(Math.random()*o.carColors.length),this.signals.challenge.dispatch(o.challengeNames[6])},s.prototype.animScreen=function(){var t=new TimelineMax({onComplete:function(){this.initParticles(0,0),this.animLogo()},onCompleteScope:this});t.from(this.bg.scale,o.TRANSITION_DURATION/2-.1,{x:0,y:0,ease:Back.easeOut},"start"),t.from(this.bg,o.TRANSITION_DURATION/2,{alpha:0},"start"),t.from(this.logo,o.TRANSITION_DURATION/2,{alpha:0},"start")},s.prototype.animLogo=function(){var t=.75,e=.375;null!==this.lTL&&this.lTL.kill(),this.lTL=new TimelineMax({onComplete:function(){this.animLogo()},onCompleteScope:this}),this.lTL.to(this.logo,t,{rotation:4*Math.PI,ease:Back.easeOut},"start"),this.lTL.to(this.logo.scale,e,{x:1,y:1,ease:Back.easeOut},"start"),this.lTL.to(this.logo.scale,e,{delay:e,x:1.2,y:1.2,ease:Sine.easeOut},"start"),this.lTL.to(this.logo.scale,1.2,{x:1.1,y:1.1,repeat:4,yoyo:!0,ease:Sine.easeInOut},"nieco1"),this.lTL.to(this.logo,t,{rotation:0,ease:Back.easeOut},"end"),this.lTL.to(this.logo.scale,e,{x:1,y:1,ease:Back.easeOut},"end"),this.lTL.to(this.logo.scale,e,{delay:e,x:1.2,y:1.2,ease:Sine.easeOut},"end"),this.lTL.to(this.logo.scale,1.2,{x:1.1,y:1.1,repeat:4,yoyo:!0,ease:Sine.easeInOut},"nieco2")},s.prototype.appear=function(){o.memoryManager.free("game"),o.renderer.backgroundColor=0,o.playersPositions=[],this.animScreen(),this.setUiVisible(!1),o.viewManager.done=!1,o.viewManager.showTweensComplete.add(this.onShowTweensComplete.bind(this)),o.viewManager.setShowTweensTime(.005),o.audio.play("titleSoundStart"),o.animator.setTimeout(function(){o.playMusic("titleMusic"),this.setUiVisible(!0),o.viewManager.runShowTweens()},o.TRANSITION_DURATION/2,this)},s.prototype.setUiVisible=function(t){if(this.uiContainer)for(var e=0;e<this.uiContainer.children.length;e++)this.uiContainer.children[e].visible=t},s.prototype.setUiInteractive=function(t){if(this.uiContainer)for(var e=0;e<this.uiContainer.children.length;e++)this.uiContainer.children[e].interactive=t},s.prototype.onShowTweensComplete=function(){o.viewManager.done=!0},s.prototype.destroy=function(){TweenMax.killAll(),this.destroySignals(),this.sparklePS&&this.sparklePS.destroy(),this.destroyUiElements(),p3.Scene.prototype.destroy.call(this)},s.prototype.resize=function(){this.x=Math.round((p3.View.width-o.STAGE_WIDTH)/2),o.viewManager.repositionDynElements()}},{"../common":42,"mini-signals":3}],113:[function(t,e,i){e.exports=t("./traffic-lights")},{"./traffic-lights":115}],114:[function(t,e,i){var s={bg:{texture:"wr_race_lights_bg2",anchorX:.5,anchorY:0},light0:{texture:"wr_race_lights_red2",x:-76,y:90,alpha:0},light1:{texture:"wr_race_lights_red2",x:-39,y:90,alpha:0},light2:{texture:"wr_race_lights_red2",x:39,y:90,scaleX:-1,alpha:0},light3:{texture:"wr_race_lights_red2",x:73,y:90,scaleX:-1,alpha:0}};e.exports=s},{}],115:[function(t,e,i){function s(){return PIXI.Container.call(this),this.visible=!1,this.signals={},this.signals.done=new n,o.viewManager.add(a),this.layout=o.viewManager.get(o.viewManager.activeLayout),this.tl=null,this.tl2=null,this.init(),this}var n=t("mini-signals"),o=t("../common"),a=t("./traffic-light-layout");e.exports=s,s.prototype=Object.create(PIXI.Container.prototype),s.prototype.constructor=s,s.prototype.init=function(){this.bg=o.viewManager.addSprite(a.bg).addTo(this);for(var t=0;t<4;t++)this["light"+t]=o.viewManager.addSprite(a["light"+t]).addTo(this)},s.prototype.start=function(){this.tl=new TimelineMax({onComplete:function(){this.light0.texture=o.assetManager.getTexture("wr_race_lights_green2"),this.light1.texture=o.assetManager.getTexture("wr_race_lights_green2"),this.light2.texture=o.assetManager.getTexture("wr_race_lights_green2"),this.light3.texture=o.assetManager.getTexture("wr_race_lights_green2"),this.hide()},onCompleteScope:this});var t=.2;this.tl.from(this,.5,{y:-300,ease:Cubic.easeOut}),this.tl.to(this.light0,t,{alpha:1}),this.tl.to(this.light0,1-t,{alpha:1}),this.tl.to(this.light1,t,{alpha:1}),this.tl.to(this.light1,1-t,{alpha:1}),this.tl.to(this.light2,t,{alpha:1}),this.tl.to(this.light2,1-t,{alpha:1}),this.tl.to(this.light3,t,{alpha:1}),this.tl.to(this.light3,1-t,{alpha:1})},s.prototype.hide=function(){this.tl2=new TimelineMax({onComplete:function(){this.visible=!1},onCompleteScope:this}),this.tl2.to(this.light0,.1,{alpha:1,onComplete:function(){this.signals.done.dispatch()},onCompleteScope:this}),this.tl2.to(this,.3,{y:-200,ease:Back.easeIn})},s.prototype.doSeppuku=function(){this.tl&&this.tl.kill(),this.tl2&&this.tl2.kill(),this.signals.done.detachAll(),this.destroy()}},{"../common":42,"./traffic-light-layout":114,"mini-signals":3}],116:[function(t,e,i){e.exports={mergeParams:function(t,e){var i=this.clone(t);for(var s in i)for(var n in e)s===n&&null!==e[n]&&(i[s]=e[n]);return i},clone:function(t){if(null===t||"object"!=typeof t)return t;var e=t.constructor();for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},normalize:function(t){return t>1?1:t<0?0:t}}},{}],117:[function(t,e,i){function s(t){this.obj=t,this._isHome=!0,this.isPaused=!1,this._delta=null,this._now=null,this._then=Date.now(),this.startFrame=0,this.currentFrame=0,this.totalFrames=0,this._timePassed=0,this.defaultSpeed=60,this.animationSpeed=0,this.fps=this.defaultSpeed,this._isPlaying=!1,this._textures=[];for(var e=0;e<t.textures.length;e++)this._textures.push(n.assetManager.getTexture(t.textures[e]));for(this.currentAnimation=null,this.animations={},e=0;e<t.animations.length;e++)if(t.animations[e].frames)this.animations[t.animations[e].name]=t.animations[e].frames;else if(t.animations[e].framesRange)for(this.animations[t.animations[e].name]=[],j=t.animations[e].framesRange[0];j<=(t.animations[e].framesRange[1]?t.animations[e].framesRange[1]:t.animations[e].framesRange[0]);j++)this.animations[t.animations[e].name].push(j);return PIXI.Sprite.call(this,this._textures[0]),this.x=t.x?t.x:0,this.y=t.y?t.y:0,this.scale.x=t.scaleX?t.scaleX:1,this.scale.y=t.scaleY?t.scaleY:1,t.scaleXY&&(this.scaleXY=t.scaleXY),this.anchor.x=t.anchorX?t.anchorX:0,this.anchor.y=t.anchorY?t.anchorY:0,t.anchorXY&&(this.anchorXY=t.anchorXY),t.collisions&&(this.collisions=t.collisions),t.showTweens&&(this.showTweens=t.showTweens),t.tweens&&(this.tweens=t.tweens),t.hideTweens&&(this.hideTweens=t.hideTweens),this}var n=t("../common");e.exports=s,s.prototype=Object.create(PIXI.Sprite.prototype),s.prototype.constructor=s,s.prototype.startAnimation=function(t){this.startFrame=this.animations[t][0],this.currentFrame=0,this.totalFrames=this.animations[t].length,this._now=Date.now(),this._delta=this._now-this._then,this._then=Date.now(),this._timePassed=0,this.currentAnimation=t,this._isPlaying=!0,PIXI.ticker.shared.add(this.update,this)},s.prototype.update=function(){this.isPaused||(this._now=Date.now(),this._delta=this._now-this._then,this._timePassed+=this._delta,this._timePassed>=this.animationSpeed&&(this.currentFrame+=Math.floor(this._timePassed/this.animationSpeed),this.currentFrame>=this.totalFrames&&(this._loop?this.currentFrame=0:(this._numLoops--,this._numLoops<=0&&this._isPlaying?(this.stop(),this.emit("animation-complete",this)):this.currentFrame=0)),this._timePassed=0),this._isPlaying&&(this.texture=this._textures[this.animations[this.currentAnimation][this.currentFrame]]),this._then=this._now)},s.prototype.play=function(t){this._isPlaying&&this.stop(),this.fps=this.getAnimationFramerate(t),this.getAnimationParameters(t).loop?this.getAnimationParameters(t).loopCount?this.loop(t,this.getAnimationParameters(t).loopCount):this.loop(t):this.loop(t,1)},s.prototype.gotoAndStop=function(t,e){this._isPlaying&&this.stop(),this.currentAnimation=t,e&&e>=this.animations[t].length?this.currentFrame=this.animations[t].length-1:e?this.currentFrame=e:this.currentFrame=0,this.texture=this._textures[this.animations[this.currentAnimation][this.currentFrame]]},s.prototype.stop=function(){this._isPlaying=!1,PIXI.ticker.shared.remove(this.update,this),this.texture=this._textures[this.animations[this.currentAnimation][this.totalFrames-1]],this._timePassed=0},s.prototype.loop=function(t,e){this.fps=this.getAnimationFramerate(t),this._isPlaying&&this.stop(),e?(this._loop=!1,this._numLoops=e):this._loop=!0,this.startAnimation(t)},s.prototype.doSeppuku=function(){this.stop(),this.destroy(n.destroyOptions)},s.prototype.getAnimationParameters=function(t){var e=null;for(var i in this.obj.animations)if(this.obj.animations[i].name===t){e=this.obj.animations[i];break}return e},s.prototype.getAnimationFramerate=function(t){for(var e=this.defaultSpeed,i=0;i<this.obj.animations.length;i++)if(this.obj.animations[i].name===t&&this.obj.animations[i].framerate){e=this.obj.animations[i].framerate;break}return e},Object.defineProperty(s.prototype,"fps",{get:function(){return this.animationSpeed},set:function(t){this.animationSpeed=1e3/t}}),Object.defineProperty(s.prototype,"paused",{get:function(){return this.isPaused},set:function(t){this.isPaused=t}})},{"../common":42}],118:[function(t,e,i){var s={CLICK:"button-on-click",DOWN:"button-on-down",UP:"button-on-up",UPOUTSIDE:"button-on-upOutside",OVER:"button-on-over",OUT:"button-on-out"};e.exports=s},{}],119:[function(t,e,i){var s=t("../common"),n=t("./button-events");Button=function(t){this.textures=[];for(var e=0;e<t.textures.length;e++)this.textures.push(s.assetManager.getTexture(t.textures[e]));if(PIXI.Sprite.call(this,this.textures[0]),this.anchorXY=.5,this.iconSprite=null,t.icons){for(this.icons=[],this.iconsOffset=void 0!==t.iconsOffset?t.iconsOffset:[0,0],e=0;e<t.icons.length;e++)this.icons.push(s.assetManager.getTexture(t.icons[e]));this.createIcon()}this.clicked=!1;for(e in t)"textures"!==e&&"icons"!==e&&(this[e]=t[e]);this.responsive=!0,this.disabled=!1,this.on("mouseover",this._onMouseOver),this.on("mouseout",this._onMouseOut),this.on("mouseupoutside",this._onMouseEndOutside),this.on("touchendoutside",this._onMouseEndOutside),this.on("mousedown",this._onMouseDown),this.on("touchstart",this._onMouseDown),this.on("mouseup",this._onMouseUp),this.on("touchend",this._onMouseUp),this.normal()},Button.prototype=Object.create(PIXI.Sprite.prototype),Button.prototype.constructor=Button,e.exports=Button,Button.prototype.createIcon=function(){this.iconSprite=new WRE.Sprite({texture:this.icons[0],anchorXY:.5,x:this.iconsOffset[0],y:this.iconsOffset[1]}).addTo(this)},Button.prototype.deleteIcon=function(){null!==this.iconSprite&&void 0!==this.iconSprite&&(this.removeChild(this.iconSprite),this.iconSprite=null)},Button.prototype.normal=function(){this.texture=this.textures[0],this.iconSprite&&this.icons.length>0&&(this.iconSprite.texture=this.icons[0])},Button.prototype.hover=function(){this.textures.length>1&&(this.texture=this.textures[1]),this.iconSprite&&this.icons.length>1&&(this.iconSprite.texture=this.icons[1]),this.sounds&&this.sounds.length>1&&s.audio.play(this.sounds[1])},Button.prototype.pressed=function(){this.textures.length>2&&(this.texture=this.textures[2]),this.iconSprite&&this.icons.length>2&&(this.iconSprite.texture=this.icons[2]),this.sounds&&this.sounds.length>0&&s.audio.play(this.sounds[0])},Button.prototype.enable=function(){this.disabled=!1,this.normal()},Button.prototype.disable=function(){this.textures.length>3&&(this.disabled=!0,this.texture=this.textures[3],this.iconSprite&&this.icons.length>3&&(this.iconSprite.texture=this.icons[3]))},Button.prototype._onMouseOver=function(t){this.disabled||(this.hover(),this.clicked=!1,t.stopPropagation(),this.emit(n.OVER,this,t))},Button.prototype._onMouseOut=function(t){this.disabled||(this.normal(),this.clicked=!1,t.stopPropagation(),this.emit(n.OUT,this,t))},Button.prototype._onMouseDown=function(t){this.disabled||(this.pressed(),this.clicked=!1,t.stopPropagation(),this.emit(n.DOWN,this,t))},Button.prototype._onMouseUp=function(t){this.disabled||(this.normal(),this.clicked=!0,t.stopPropagation(),this.emit(n.UP,this,t),this.emit(n.CLICK,this,t))},Button.prototype._onMouseEndOutside=function(){this.disabled||(this.clicked=!1,this.normal())},Button.prototype.doSeppuku=function(){this.off("mouseover",this._onMouseOver,this),this.off("mouseout",this._onMouseOut,this),this.off("mouseupoutside",this._onMouseEndOutside,this),this.off("touchendoutside",this._onMouseEndOutside,this),this.off("mousedown",this._onMouseDown,this),this.off("touchstart",this._onMouseDown,this),this.off("mouseup",this._onMouseUp,this),this.off("touchend",this._onMouseUp,this),this.textures&&(this.textures=[]),this.icon&&(this.icon=[]),this.destroy(s.destroyOptions)}},{"../common":42,"./button-events":118}],120:[function(t,e,i){function s(t,e,i){return PIXI.Text.call(this,i.toString(),t.style),this.applyParams(t),this._value=void 0===i?0:i,this._maxValue=e||10,this.init(),this}t("../common");e.exports=s,s.prototype=Object.create(PIXI.Text.prototype),s.prototype.constructor=s,s.prototype.init=function(){},s.prototype.update=function(){this.text=this._value.toString(),this._value===this._maxValue&&this.emit("counter-end",this)},Object.defineProperty(s.prototype,"value",{get:function(){return this._value},set:function(t){this._value=t,this._value<0&&(this._value=0),this._value>this._maxValue&&(this._value=this._maxValue),this.update()}})},{"../common":42}],121:[function(t,e,i){function s(t,e,i){return PIXI.Sprite.call(this,t.texture),this.x=t.x,this.y=t.y,this.anchorX=t.anchorX,this.anchorY=t.anchorY,this.multiplier=t.hasOwnProperty("multiplier")?t.multiplier:1,this.tl=null,this._value=void 0===i?0:i,this._maxValue=e||10,this.init(),this}t("../common");e.exports=s,s.prototype=Object.create(PIXI.Sprite.prototype),s.prototype.constructor=s,s.prototype.init=function(){this.scale.x=this._value/this._maxValue*this.multiplier},s.prototype.update=function(){null!==this.tl&&this.tl.kill(),this.tl=new TimelineMax({onComplete:function(){},onCompleteScope:this}),this.tl.to(this.scale,.3,{x:this._value/this._maxValue*this.multiplier,ease:Cubic.easeOut})},Object.defineProperty(s.prototype,"value",{get:function(){return this._value},set:function(t){this._value=t,this._value<0&&(this._value=0),this._value>this._maxValue&&(this._value=this._maxValue),this.update()}})},{"../common":42}],122:[function(t,e,i){e.exports=t("./viewmanager")},{"./viewmanager":126}],123:[function(t,e,i){function s(t){return PIXI.Sprite.call(this,t.texture),this.x=t.x,this.y=t.y,this.anchorX=t.anchorX,this.anchorY=t.anchorY,this._value=1,this.isVertical=void 0!==typeof t.flip&&!t.flip,this.init(),this}e.exports=s,s.prototype=Object.create(PIXI.Sprite.prototype),s.prototype.constructor=s,s.prototype.init=function(){this.isVertical?(this.barFrameWidth=this.texture.frame.width,2===this.texture.rotate&&(this.barFrameWidth=this.texture.frame.height)):this.barFrameWidth=this.texture.frame.height,this.update()},s.prototype.update=function(){this.isVertical?2===this.texture.rotate?this.texture.frame.height=Math.floor(this.barFrameWidth*this._value):this.texture.frame.width=Math.floor(this.barFrameWidth*this._value):this.texture.frame.height=Math.floor(this.barFrameWidth*this._value),this.isVertical?2===this.texture.rotate?this.width=this.texture.frame.height:this.width=this.texture.frame.width:this.height=this.texture.frame.height,this.texture._updateUvs()},s.prototype.doSeppuku=function(){this.value=1,this.isVertical?this.texture.frame.width=this.barFrameWidth:this.texture.frame.height=this.barFrameWidth},Object.defineProperty(s.prototype,"value",{get:function(){return this._value},set:function(t){this._value=t,this._value<0&&(this._value=0),this._value>1&&(this._value=1),this.update()}})},{}],124:[function(t,e,i){var s=t("../common"),n=t("./button");SwitchButton=function(t){n.call(this,t),this.normalTextures=[];for(var e=0;e<t.textures.length;e++)this.normalTextures.push(s.assetManager.getTexture(t.textures[e]));if(t.icons)for(this.normalIconTextures=[],e=0;e<t.icons.length;e++)this.normalIconTextures.push(s.assetManager.getTexture(t.icons[e]));for(this.switchTextures=[],e=0;e<t.switchTextures.length;e++)this.switchTextures.push(s.assetManager.getTexture(t.switchTextures[e]));if(t.switchIcons)for(this.switchIconTextures=[],e=0;e<t.switchIcons.length;e++)this.switchIconTextures.push(s.assetManager.getTexture(t.switchIcons[e]));this._state=0},SwitchButton.prototype=Object.create(n.prototype),SwitchButton.prototype.constructor=SwitchButton,e.exports=SwitchButton,SwitchButton.prototype.updateTextures=function(){var t;if(0===this.state){for(this.textures=[],t=0;t<this.normalTextures.length;t++)this.textures.push(this.normalTextures[t]);if(this.deleteIcon(),this.normalIconTextures){for(this.icons=[],t=0;t<this.normalIconTextures.length;t++)this.icons.push(this.normalIconTextures[t]);this.createIcon()}}else{for(this.textures=[],t=0;t<this.switchTextures.length;t++)this.textures.push(this.switchTextures[t]);if(this.deleteIcon(),this.switchIconTextures){for(this.icons=[],t=0;t<this.switchIconTextures.length;t++)this.icons.push(this.switchIconTextures[t]);this.createIcon()}}},SwitchButton.prototype.switchState=function(){this.state=0===this.state?1:0},Object.defineProperty(SwitchButton.prototype,"state",{get:function(){return this._state},set:function(t){this._state=t,this.updateTextures()}})},{"../common":42,"./button":119}],125:[function(t,e,i){function s(){this.tweens=[],this.allCompleteSignal=new n,this.numCompleted=0}var n=(t("../common"),t("mini-signals"));s.prototype.constructor=s,e.exports=s,s.prototype.add=function(t,e,i,s){for(var n,o=void 0!==i&&i,a=new TimelineMax({paused:o,repeat:void 0===s?0:s,onStart:function(){},onStartScope:this,onUpdate:function(){},onUpdateScope:this,onRepeat:function(){},onRepeatScope:this,onComplete:function(){this.onTweenComplete(a)},onCompleteScope:this}),r=0;r<t[e].length;r++)if(n=WRE.cloneObj(t[e][r]),n.property)switch(n.property.toLowerCase()){case"fromposition":a.from(t.position,n.duration,n.data,n.label?n.label:void 0);break;case"toposition":a.to(t.position,n.duration,n.data,n.label?n.label:void 0);break;case"fromtoposition":a.fromTo(t.position,n.duration,n.fromData,n.toData,n.label?n.label:void 0);break;case"fromscale":a.from(t.scale,n.duration,n.data,n.label?n.label:void 0);break;case"toscale":a.to(t.scale,n.duration,n.data,n.label?n.label:void 0);break;case"fromtoscale":a.fromTo(t.scale,n.duration,n.fromData,n.toData,n.label?n.label:void 0);break;case"toalpha":case"torotation":a.to(t,n.duration,n.data,n.label?n.label:void 0);break;case"fromalpha":case"fromrotation":a.from(t,n.duration,n.data,n.label?n.label:void 0);break;case"fromtoalpha":case"fromtorotation":a.fromTo(t,n.duration,n.fromData,n.toData,n.label?n.label:void 0)}else a.to(t,n.duration,n.data,n.label?n.label:void 0);this.tweens.push(a)},s.prototype.onTweenComplete=function(t){this.numCompleted++,this.numCompleted>=this.tweens.length&&this.onAllTweensComplete()},s.prototype.killAllTweens=function(){for(var t=0;t<this.tweens.length;t++)null!==this.tweens[t]&&this.tweens[t].kill();this.tweens=[],this.numCompleted=0},s.prototype.onAllTweensComplete=function(){this.killAllTweens(),this.allCompleteSignal.dispatch(this)}},{"../common":42,"mini-signals":3}],126:[function(t,e,i){function s(){this.showTweensComplete=new n,this.normalTweensComplete=new n,this.hideTweensComplete=new n,this.layouts=[],this.layoutTweens=[],this.activeLayout=null,this.uiPositions=["topleft","top","topright","left","middle","right","bottomleft","bottom","bottomright"]}var n=t("mini-signals"),o=t("../common"),a=t("./button"),r=t("./filling-bar"),h=t("./progress-bar"),l=t("./counterText"),u=(t("./switch-button"),t("./animated-sprite")),p=t("./tween");s.prototype.constructor=s,e.exports=s,s.prototype.add=function(t){this.activeLayout=Object.keys(t)[0];for(var e=0;e<Object.keys(t).length;e++){var i=Object.keys(t)[e];this.layouts.name||(this.layouts[i]=t[i],this.layouts[i].uiElements=[[],[],[],[],[],[],[],[],[]])}this.createLayoutTweens()},s.prototype.get=function(t){return this.layouts[t]},s.prototype.createLayoutTweens=function(){this.layoutTweens[this.activeLayout]&&(this.layoutTweens[this.activeLayout].show.allCompleteSignal.detachAll(),this.layoutTweens[this.activeLayout].normal.allCompleteSignal.detachAll(),this.layoutTweens[this.activeLayout].hide.allCompleteSignal.detachAll()),this.layoutTweens[this.activeLayout]={show:new p,normal:new p,hide:new p},this.layoutTweens[this.activeLayout].show.allCompleteSignal.add(function(){this.onShowTweensComplete(this.layoutTweens[this.activeLayout].show)},this),this.layoutTweens[this.activeLayout].normal.allCompleteSignal.add(function(){this.onNormalTweensComplete(this.layoutTweens[this.activeLayout].normal)},this),this.layoutTweens[this.activeLayout].hide.allCompleteSignal.add(function(){this.onHideTweensComplete(this.layoutTweens[this.activeLayout].hide)},this)},s.prototype.addShowTween=function(t){this.layoutTweens[this.activeLayout].show.add(t,"showTweens",!0)},s.prototype.runShowTweens=function(){for(var t=0;t<this.layoutTweens[this.activeLayout].show.tweens.length;t++)this.layoutTweens[this.activeLayout].show.tweens[t].play()},s.prototype.setShowTweensTime=function(t){for(var e=0;e<this.layoutTweens[this.activeLayout].show.tweens.length;e++)this.layoutTweens[this.activeLayout].show.tweens[e].time(t)},s.prototype.onShowTweensComplete=function(t){this.showTweensComplete.dispatch(this,t),this.showTweensComplete.detachAll()},s.prototype.addNormalTween=function(t){this.layoutTweens[this.activeLayout].normal.add(t,"tweens",!1,t.repeatTimeline)},s.prototype.onNormalTweensComplete=function(t){this.normalTweensComplete.dispatch(this,t),this.normalTweensComplete.detachAll()},s.prototype.addHideTween=function(t){this.layoutTweens[this.activeLayout].hide.add(t,"hideTweens",!0)},s.prototype.runHideTweens=function(){for(var t=0;t<this.layoutTweens[this.activeLayout].hide.tweens.length;t++)this.layoutTweens[this.activeLayout].hide.tweens[t].play()},s.prototype.onHideTweensComplete=function(t){this.showTweens.killAllTweens(),this.normalTweens.killAllTweens(),this.hideTweens.killAllTweens(),this.hideTweensComplete.dispatch(this,t),this.hideTweensComplete.detachAll()},s.prototype.addSprite=function(t){"string"==typeof t.texture&&(t.texture=o.assetManager.getTexture(t.texture)),t.texture||(t.texture=PIXI.Texture.EMPTY);var e=new WRE.Sprite(t);return this.checkForDynamicPosition(t,e),t.showTweens&&this.addShowTween(e),t.tweens&&this.addNormalTween(e),t.hideTweens&&this.addHideTween(e),e},s.prototype.addAnimatedSprite=function(t){var e=new u(t);return t.showTweens&&this.addShowTween(e),t.tweens&&this.addNormalTween(e),t.hideTweens&&this.addHideTween(e),e},s.prototype.addFillingBar=function(t,e,i){"string"==typeof t.texture&&(t.texture=o.assetManager.getTexture(t.texture));var s=new r(t,e,i);return t.showTweens&&this.addShowTween(s),t.tweens&&this.addNormalTween(s),t.hideTweens&&this.addHideTween(s),s},s.prototype.addBackgroundFillingBar=function(t,e,i){"string"==typeof t.texture&&(t.texture=o.assetManager.getTexture(t.texture));var s=new WRE.Sprite(t);"string"==typeof t.bar.texture&&(t.bar.texture=o.assetManager.getTexture(t.bar.texture));var n=new r(t.bar,e,i);if(s.anchorXY=.5,s.bar=n,s.addChild(n),"undefined"!=typeof t.top&&"string"==typeof t.top.texture&&(t.top.texture=o.assetManager.getTexture(t.top.texture)),"undefined"!=typeof t.top){var a=new WRE.Sprite(t.top).addTo(s);s.top=a}return this.checkForDynamicPosition(t,s),t.showTweens&&this.addShowTween(s),t.tweens&&this.addNormalTween(s),t.hideTweens&&this.addHideTween(s),s},s.prototype.addProgressBar=function(t,e){"string"==typeof t.texture&&(t.texture=o.assetManager.getTexture(t.texture));var i=1,s=new WRE.Sprite(t);"string"==typeof t.bar.texture&&(t.bar.texture=o.assetManager.getTexture(t.bar.texture));var n=new h(t.bar,i,e);if(s.anchorXY=.5,s.bar=n,s.addChild(n),"undefined"!=typeof t.icon&&"string"==typeof t.icon.texture&&(t.icon.texture=o.assetManager.getTexture(t.icon.texture)),"undefined"!=typeof t.icon){var a=new WRE.Sprite(t.icon).addTo(s);s.icon=a}if("undefined"!=typeof t.top&&"string"==typeof t.top.texture&&(t.top.texture=o.assetManager.getTexture(t.top.texture)),"undefined"!=typeof t.top){var r=new WRE.Sprite(t.top).addTo(s);s.top=r}return this.checkForDynamicPosition(t,s),t.showTweens&&this.addShowTween(s),t.tweens&&this.addNormalTween(s),t.hideTweens&&this.addHideTween(s),s},s.prototype.addCounterBar=function(t,e,i){"string"==typeof t.texture&&(t.texture=o.assetManager.getTexture(t.texture));var s=new WRE.Sprite(t),n=new l(t.text,e,i);return s.anchorXY=.5,s.text=n,s.addChild(n),this.checkForDynamicPosition(t,s),t.showTweens&&this.addShowTween(s),t.tweens&&this.addNormalTween(s),t.hideTweens&&this.addHideTween(s),s},s.prototype.addText=function(t,e){var i=new PIXI.Text(t.textID?o.language.get(t.textID):t.text?t.text:e?e:"defaultText",t.style);return i.applyParams(t),t.showTweens&&this.addShowTween(i),t.tweens&&this.addNormalTween(i),t.hideTweens&&this.addHideTween(i),i},s.prototype.addBitmapText=function(t,e){var i=new PIXI.extras.BitmapText(t.textID?o.language.get(t.textID):t.text?t.text:e?e:"defaultText",t.style);return i.applyParams(t),t.showTweens&&this.addShowTween(i),t.tweens&&this.addNormalTween(i),t.hideTweens&&this.addHideTween(i),i},s.prototype.checkForDynamicPosition=function(t,e){if(t.dynamicPosition){var i=this.uiPositions.indexOf(t.dynamicPosition.toLowerCase());i!==-1?(this.layouts[this.activeLayout].uiElements[i].push(e),this.repositionDynElements()):console.log("ViewManager: invalid dynamicPosition -> "+t.dynamicPosition)}},s.prototype.addButton=function(t){var e=new a(t);return this.checkForDynamicPosition(t,e),t.showTweens&&this.addShowTween(e),t.tweens&&this.addNormalTween(e),t.hideTweens&&this.addHideTween(e),e},s.prototype.addSwitchButton=function(t){var e=new SwitchButton(t);return this.checkForDynamicPosition(t,e),t.showTweens&&this.addShowTween(e),t.tweens&&this.addNormalTween(e),t.hideTweens&&this.addHideTween(e),e},s.prototype.getDynPosition=function(t){var e={x:0,y:0};switch(t){case 0:e.x=Math.floor((o.STAGE_WIDTH-p3.View.width)/2),e.y=0;break;case 1:e.x=Math.floor(o.STAGE_WIDTH/2),e.y=0;break;case 2:e.x=Math.floor((o.STAGE_WIDTH+p3.View.width)/2),e.y=0;break;case 3:e.x=Math.floor((o.STAGE_WIDTH-p3.View.width)/2),e.y=Math.floor(o.STAGE_HEIGHT/2);break;case 4:e.x=Math.floor(o.STAGE_WIDTH/2),e.y=Math.floor(o.STAGE_HEIGHT/2);break;case 5:e.x=Math.floor((o.STAGE_WIDTH+p3.View.width)/2),e.y=Math.floor(o.STAGE_HEIGHT/2);break;case 6:e.x=Math.floor((o.STAGE_WIDTH-p3.View.width)/2),e.y=o.STAGE_HEIGHT;break;case 7:e.x=Math.floor(o.STAGE_WIDTH/2),e.y=o.STAGE_HEIGHT;break;case 8:e.x=Math.floor((o.STAGE_WIDTH+p3.View.width)/2),e.y=o.STAGE_HEIGHT}return e},s.prototype.isntDynMiddle=function(t){return[1,4,7].indexOf(t)===-1},s.prototype.getAllDynLengths=function(t){for(var e=0,i=this.layouts[this.activeLayout].uiElements[t].length,s=0;s<i;s++)e+=this.layouts[this.activeLayout].uiElements[t][s].width;return e+(i-1)*this.spacing},s.prototype.getDynOffset=function(t,e){var i=this.getDynPosition(t),s=[{x:1,y:1},{x:0,y:1},{x:-1,y:1},{x:1,y:0},{x:0,y:0},{x:-1,y:0},{x:1,y:-1},{x:0,y:-1},{x:-1,y:-1}],n={x:0,y:i.y+s[t].y*this.padding+s[t].y*this.layouts[this.activeLayout].uiElements[t][e].height/2};if(0===e)this.isntDynMiddle(t)?n.x=i.x+s[t].x*this.padding+s[t].x*this.layouts[this.activeLayout].uiElements[t][e].width/2:n.x=i.x-this.getAllDynLengths(t)/2+this.layouts[this.activeLayout].uiElements[t][0].width/2;else{var o=this.layouts[this.activeLayout].uiElements[t][e-1];this.isntDynMiddle(t)?n.x=o.x+s[t].x*o.width/2+s[t].x*this.spacing+s[t].x*this.layouts[this.activeLayout].uiElements[t][e].width/2:n.x=o.x+o.width/2+this.spacing+this.layouts[this.activeLayout].uiElements[t][e].width/2}return this.layouts[this.activeLayout].uiElements[t][e].dynamicOffset&&(n.x+=this.layouts[this.activeLayout].uiElements[t][e].dynamicOffset[0],n.y+=this.layouts[this.activeLayout].uiElements[t][e].dynamicOffset[1]),n},s.prototype.repositionDynElements=function(){for(var t=0;t<this.layouts[this.activeLayout].uiElements.length;t++)for(var e=0;e<this.layouts[this.activeLayout].uiElements[t].length;e++){var i=this.getDynOffset(t,e);this.layouts[this.activeLayout].uiElements[t][e].x=Math.floor(i.x),this.layouts[this.activeLayout].uiElements[t][e].y=Math.floor(i.y)}},Object.defineProperty(s.prototype,"padding",{get:function(){return Math.floor(o.UICONFIG.PADDING/100*o.STAGE_HEIGHT)}}),Object.defineProperty(s.prototype,"spacing",{get:function(){return Math.floor(o.UICONFIG.SPACING/100*o.STAGE_HEIGHT)}}),Object.defineProperty(s.prototype,"showTweens",{get:function(){return this.layoutTweens[this.activeLayout].show}}),Object.defineProperty(s.prototype,"hasShowTweens",{get:function(){return this.layoutTweens[this.activeLayout].show.tweens.length>0}}),Object.defineProperty(s.prototype,"normalTweens",{get:function(){return this.layoutTweens[this.activeLayout].normal}}),Object.defineProperty(s.prototype,"hasNormalTweens",{get:function(){return this.layoutTweens[this.activeLayout].normal.tweens.length>0}}),Object.defineProperty(s.prototype,"hideTweens",{get:function(){return this.layoutTweens[this.activeLayout].hide}}),Object.defineProperty(s.prototype,"hasHideTweens",{get:function(){return this.layoutTweens[this.activeLayout].hide.tweens.length>0}})},{"../common":42,"./animated-sprite":117,"./button":119,"./counterText":120,"./filling-bar":121,"./progress-bar":123,"./switch-button":124,"./tween":125,"mini-signals":3}],127:[function(t,e,i){var s=t("./core"),n=t("./core/common");PIXI.Container.prototype.applyParams=function(t){for(var e in t)this[e]=t[e];return this},PIXI.Container.prototype.addTo=function(t,e){return"undefined"==typeof e?t.addChild(this):t.addChildAt(this,e),this},Object.defineProperty(PIXI.DisplayObject.prototype,"responsive",{get:function(){return this.interactive},set:function(t){this.interactive=t,this.buttonMode=t}}),Object.defineProperty(PIXI.Sprite.prototype,"anchorX",{get:function(){return this.anchor.x},set:function(t){this.anchor.x=t}}),Object.defineProperty(PIXI.Sprite.prototype,"anchorY",{get:function(){return this.anchor.y},set:function(t){this.anchor.y=t}}),Object.defineProperty(PIXI.Sprite.prototype,"anchorXY",{set:function(t){this.anchor.x=t,this.anchor.y=t}}),Object.defineProperty(PIXI.DisplayObject.prototype,"scaleX",{get:function(){return this.scale.x},set:function(t){this.scale.x=t}}),Object.defineProperty(PIXI.DisplayObject.prototype,"scaleY",{get:function(){return this.scale.y},set:function(t){
this.scale.y=t}}),Object.defineProperty(PIXI.DisplayObject.prototype,"scaleXY",{set:function(t){this.scale.x=t,this.scale.y=t}}),s.Sprite=function(t){return"string"==typeof t.texture&&(t.texture=n.assetManager.getTexture(t.texture)),PIXI.Sprite.call(this,t.texture),this.applyParams(t),this},s.Sprite.prototype=Object.create(PIXI.Sprite.prototype),s.Sprite.prototype.constructor=s.Sprite,s.Container=function(t){return PIXI.Container.call(this),this.applyParams(t),this},s.Container.prototype=Object.create(PIXI.Container.prototype),s.Container.prototype.constructor=s.Container,s.formattedNumber=function(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},s.randomInterval=function(t,e){return Math.random()*(e-t)+t},s.randomIntInterval=function(t,e){return Math.floor(Math.random()*(e-t+1))+t},s.cloneObj=function(t){if(null===t||"object"!=typeof t)return t;var e;if(t instanceof Date)return e=new Date,e.setTime(t.getTime()),e;if(t instanceof Array){e=[];for(var i=0,s=t.length;i<s;i++)e[i]=this.cloneObj(t[i]);return e}if(t instanceof Object){e={};for(var n in t)t.hasOwnProperty(n)&&(e[n]=this.cloneObj(t[n]));return e}throw new Error("ENEA.utils.clone : unable to copy obj")},p3.Scene.prototype.createTimeline=function(t){"undefined"==typeof this._timelines&&(this._timelines=[]);var e=new TimelineMax(t);return this._timelines.push(e),e}},{"./core":93,"./core/common":42}],128:[function(t,e,i){Math.sign||(Math.sign=function(t){return t=+t,0===t||isNaN(t)?t:t>0?1:-1})},{}],129:[function(t,e,i){Object.assign||(Object.assign=t("object-assign"))},{"object-assign":4}],130:[function(t,e,i){String.prototype.replaceAll=function(t,e){var i=this;return i.replace(new RegExp(t,"g"),e)}},{}],131:[function(t,e,i){String.prototype.endsWith||(String.prototype.endsWith=function(t,e){return e<this.length?e|=0:e=this.length,this.substr(e-t.length,t.length)===t})},{}],132:[function(t,e,i){t("./Math.sign"),t("./Object.assign"),t("./startsWith"),t("./endsWith"),t("./performance"),t("./String.replaceAll")},{"./Math.sign":128,"./Object.assign":129,"./String.replaceAll":130,"./endsWith":131,"./performance":133,"./startsWith":134}],133:[function(t,e,i){!function(){if("performance"in window==!1&&(window.performance={}),Date.now=Date.now||function(){return(new Date).getTime()},"now"in window.performance==!1){var t=Date.now();performance.timing&&performance.timing.navigationStart&&(t=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-t}}}()},{}],134:[function(t,e,i){String.prototype.startsWith||(String.prototype.startsWith=function(t,e){return this.substr(e||0,t.length)===t})},{}]},{},[1]);