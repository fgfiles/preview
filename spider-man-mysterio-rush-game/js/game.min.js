window.switOnLoad=function(){if(SwitJS.isSupported)if(navigator.cookieEnabled){document.onkeydown=function(a){if(!window.USE_SANBOX)return a.preventDefault(),!1};var a="",b="";"undefined"!==typeof document.hidden?(a="hidden",b="visibilitychange"):"undefined"!==typeof document.mozHidden?(a="mozHidden",b="mozvisibilitychange"):"undefined"!==typeof document.msHidden?(a="msHidden",b="msvisibilitychange"):"undefined"!==typeof document.webkitHidden&&(a="webkitHidden",b="webkitvisibilitychange");document.addEventListener(b,
function(){Application.instance&&(document[a]?(Application.instance.isHidden=!0,Application.instance.onLostFocus()):(Application.instance.isHidden=!1,Application.instance.onGotFocus()))},!1);Application.strings={};Application.strings=window.switStrings;Application.strings.STR_EMPTY={value:""};Application.strings.STR_LOADER_FONT={value:"."};window.switStrings=null;window.globalAnimations={};SwitJS.isLowDevice&&Application.warn("Detecting low device");SwitJS.useAssetsSD&&Application.warn("Using SD assets");
Application.info("SwitJS.isMobileDevice: "+SwitJS.isMobileDevice);Application.info("SwitJS.deviceModel: "+SwitJS.deviceModel);Application.info("SwitJS.iDevice: "+SwitJS.iDevice);Application.info("SwitJS.platformVersion: "+SwitJS.platformVersion);Application.info("SwitJS.isSupported: "+SwitJS.isSupported);Application.info("SwitJS.browserName: "+SwitJS.browserName);Application.info("SwitJS.browserVersion: "+SwitJS.browserVersion);Application.info("SwitJS.userAgent: "+SwitJS.userAgent);new Application}else{var c=
document.createElement("div");c.setAttribute("align","center");document.body.appendChild(c);var d=new Image;d.onload=function(){d.setAttribute("width","100%");d.setAttribute("height","100%");c.appendChild(d)};d.src="media/images/ui_images/cookiesrequired.jpg"}};window.onpagehide=function(){if(Application.instance)Application.instance.onLostFocus()};window.onpageshow=function(){if(Application.instance)Application.instance.onGotFocus()};window.onblur=function(){if(Application.instance)Application.instance.onLostFocus()};
window.onfocus=function(){if(Application.instance)Application.instance.onGotFocus()};window.onresize=function(a){Application.instance&&(Application.instance.onResize(a.target.innerWidth,a.target.innerHeight),Application.instance.hideAddressBar())};window.onorientationchange=function(a){if(Application.instance)Application.instance.onOrientationchange(a)};window.onkeydown=function(a){if(Application.instance)Application.instance.onKeyDown(a)};window.onkeyup=function(a){if(Application.instance)Application.instance.onKeyUp(a)};
window.onerror=function(a,b,c,d){SwitJS.isMobileDevice&&Application.error(a+" File: "+b+" Line: "+c+"  Col: "+d)};
function Application(){Application.instance=this;Application.config=window.config;Application.configDebug=window.config_debug;Application.MAX_DELTA_TIME=Application.config.settings.MAX_DELTA_TIME;Application.SAFE_AREA_WIDTH=Application.config.settings.SAFE_AREA_WIDTH;Application.APP_WIDTH=Application.config.settings.APP_WIDTH;Application.APP_HEIGHT=Application.config.settings.APP_HEIGHT;Application.SOUND_PERCENT=Application.config.settings.SOUND_PERCENT;Application.LOG=Application.config.settings.LOG;
Application.ASSETS_PATH=Application.config.settings.ASSETS_PATH;Application.USE_TILT=Application.config.settings.USE_TILT;Application.USE_CHEATS=!1;Application.ALL_UNLOCKED_LEVELS=Application.config.settings.ALL_UNLOCKED_LEVELS;Application.RENDER_MODE=Application.config.settings.RENDER_MODE;Application.CONSOLE_MODE=Application.config.settings.CONSOLE_MODE;Application.WIDE_SCREEN=Application.config.settings.WIDE_SCREEN;Application.RIGHT_TO_LEFT=Application.config.settings.RIGHT_TO_LEFT;Application.USE_ONLY_SOUNDJS=
Application.config.settings.USE_ONLY_SOUNDJS;if(Application.configDebug&&(Application.USE_CHEATS=Application.configDebug.settings_debug.USE_CHEATS,Application.CHECK_STRINGS=Application.configDebug.settings_debug.CHECK_STRINGS,Application.CHECK_STRINGS)){var a=[];for(e in Application.configDebug.settings_debug)if(-1!==e.indexOf("SIZE_STRINGS_TYPE_")){var b=Application.configDebug.settings_debug[e].split(","),c=parseInt(b[0],10);b=parseInt(b[1],10)/100;a.push([c,b])}a.sort(Application.orderArray);for(var d in Application.strings){var e=
Application.strings[d];var f=e.length;c=0;b="";if(!(0>=f)){for(var g=0;g<a.length;g++)if(f<=a[g][0]){c=Math.floor(f*a[g][1]);break}0===c&&(c=Math.floor(f*a[a.length-1][1]));for(f=1;f<=Math.ceil(c/2);f++)b+="#";Application.strings[d]=b+" "+e+" "+b}}}Cheats.enabled=Application.USE_CHEATS;this.updateable=!0;this.lastHeight=this.lastWidth=0;this.isHidden=!1;this.soundManager=null;this.effectManager=new SEffectManager;this.guiManager=new GuiManager;this.tweenManager=new TweenManager;for(var h in window.SWT_BUNDLES){if(Array.isArray(window.SWT_BUNDLES[h])){if(0<
h.indexOf("_rtl"))if(Application.RIGHT_TO_LEFT)window.SWT_BUNDLES[h.replace("_rtl","")]=window.SWT_BUNDLES[h];else continue;if(0<h.indexOf("_ltr"))if(Application.RIGHT_TO_LEFT)continue;else window.SWT_BUNDLES[h.replace("_ltr","")]=window.SWT_BUNDLES[h]}"string"===typeof h&&Application.filesQuality(h)}this.isMobileDevice=SwitJS.isMobileDevice;this.m_fpsOldTime=this.m_fpsFrameCounter=this.fps=0;window.USE_SANBOX&&(Cheats.enabled=!0);a={transparent:!1,antialias:!1,preserveDrawingBuffer:!1,resolution:1,
backgroundColor:0,forceCanvas:Application.RENDER_MODE===Application.RENDER_CANVAS};"Silk"===SwitJS.browserName&&(a.transparent=!0);this.pixiApp=new PIXI.Application(Application.APP_WIDTH,Application.APP_HEIGHT,a);Application.RENDER_MODE=this.pixiApp.renderer.type;Application.RENDER_MODE===Application.RENDER_WEBGL?Application.log("USING WEBGL RENDERER"):Application.log("USING CANVAS RENDERER");window.USE_SANBOX?document.getElementById("contentGame").appendChild(this.pixiApp.renderer.view):document.body.appendChild(this.pixiApp.renderer.view);
window.USE_SANBOX_NANO?(Layout.align=Layout.ALIGN_TOP_LEFT,new window.SandboxNano,Application.WIDE_SCREEN=!1):window.USE_SANBOX&&(new window.SandboxGui,Application.sandbox=new window.SandboxGame);this.pixiApp.renderer.view.setAttribute("id","MainCanvasDraw");this.pixiApp.renderer.view.style.position="absolute";Application.RIGHT_TO_LEFT&&this.pixiApp.renderer.view.setAttribute("dir","rtl");this.pixiApp.renderer.plugins.interaction.autoPreventDefault=this.isMobileDevice;this.canvas=this.addDisplayContainer();
this.pixiApp.stage.addChild(this.canvas);(a=document.getElementById("SWT_FONTS_DIV"))&&a.parentElement&&a.parentElement.removeChild(a);this.rotateScreen=null;this.canvasRotateScreen=this.addDisplayContainer();this.pixiApp.stage.addChild(this.canvasRotateScreen);this.rotateScreen=new RotateScreen(this.canvasRotateScreen);this.onOrientationchange(null);this.canvasEvents=null;SwitJS.isLowDevice&&(Application.isLowDevice=!0);Application.RENDER_MODE===Application.RENDER_CANVAS&&(Application.isLowDevice=
!0);this.guiManager.gotoScreen(GuiManager.SC_PRELOAD);this.registerEmptySprite();this.registerErrorSprite();this.debugStats=null;window.THREE&&Application.RENDER_MODE===Application.RENDER_WEBGL&&!Application.isLowDevice&&(Application.USE_3D=!0);this.renderer3D=null;Application.USE_3D&&(this.renderer3D=new window.THREE.WebGLRenderer({canvas:this.pixiApp.renderer.view}),this.pixiApp.renderer.reset());this.pixiApp.ticker.add(Application.instance.update,null,PIXI.UPDATE_PRIORITY.UTILITY)}
Application.MAX_DELTA_TIME=0;Application.SAFE_AREA_WIDTH=0;Application.APP_WIDTH=0;Application.APP_HEIGHT=0;Application.SOUND_PERCENT=0;Application.LOG=!1;Application.ASSETS_PATH="";Application.USE_TILT=!1;Application.USE_CHEATS=!1;Application.CHECK_STRINGS=!1;Application.RIGHT_TO_LEFT=!1;Application.RENDER_WEBGL=1;Application.RENDER_CANVAS=2;Application.RENDER_MODE=Application.RENDER_CANVAS;Application.USE_3D=!1;Application.DPI=1;Application.KEY_EMPTY_SPRITE="__emptySprite";
Application.KEY_ERROR_SPRITE="__errorSprite";Application.jsonFiles={};Application.soundGroups={};Application.instance=null;Application.strings=null;Application.config=null;Application.sandbox=null;Application.isLowDevice=!1;Application.globalThreeModels={};Application.globalThreeTextures={};Application.subclass=function(a,b){function c(){}c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a};Application.orderArray=function(a,b){return a[0]>b[0]?1:a[0]<b[0]?-1:0};
Application.validateOrientation=function(){return window.innerWidth>=window.innerHeight};Application.onOffline=function(){};Application.onWrapperSuspended=function(){Application.log("onWrapperSuspended");Application.instance.onLostFocus()};Application.onWrapperSuspending=function(){Application.log("onWrapperSuspending");Application.instance.onLostFocus()};Application.onWrapperActivated=function(){Application.log("onWrapperActivated");Application.instance.onGotFocus()};
Application.prototype.fullScreen=function(){};Application.prototype.onTilt=function(a){if(Application.instance.guiManager)Application.instance.guiManager.onTilt(a)};Application.prototype.onKeyDown=function(a){if(this.guiManager)this.guiManager.onKeyDown(a.keyCode)};Application.prototype.onKeyUp=function(a){if(this.guiManager)this.guiManager.onKeyUp(a.keyCode)};Application.prototype.onLoadingError=function(a){Application.error("onLoadingError: "+a)};
Application.prototype.onSoundsLoaded=function(){Application.info("onSoundsLoaded");SndManager.instance.callbackBug&&Application.instance.guiManager.gotoScreen(GuiManager.SC_MAIN_MENU)};Application.prototype.onErrorSndManagerIE=function(){Application.info("onErrorSndManagerIE");var a=Application.instance.soundManager.soundsToLoad;Application.instance.soundManager=new SndManagerWeb(Application.instance.onSoundsLoaded);a&&Application.instance.soundManager.loadSounds(a)};
Application.prototype.onLoaderReady=function(){Application.info("onLoaderReady");window.USE_SANBOX_NANO?Application.instance.guiManager.gotoScreen(GuiManager.SC_SANBOX_NANO_VIEW):(Application.instance.onResize(window.innerWidth,window.innerHeight),Application.instance.soundManager=SwitJS.isIE&&!Application.USE_ONLY_SOUNDJS||"Silk"===SwitJS.browserName&&1===SwitJS.browserVersion?new SndManagerIE(Application.instance.onSoundsLoaded):new SndManagerWeb(Application.instance.onSoundsLoaded),Application.instance.guiManager.gotoScreen(GuiManager.SC_MAIN_MENU))};
Application.prototype.onResize=function(a,b){this.lastWidth=a;this.lastHeight=b;Layout.onResize(a,b);if(this.rotateScreen)this.rotateScreen.onResize();this.onOrientationchange(null)};Application.prototype.onOrientationchange=function(a){SwitJS.isMobileDevice&&(window.innerHeight>window.innerWidth?(this.rotateScreen&&this.rotateScreen.show(),this.onLostFocus()):(this.rotateScreen&&this.rotateScreen.hide(),this.onGotFocus()))};
Application.prototype.onLostFocus=function(){Application.info("-- ON LOST FOCUS --");this.updateable=!1;try{this.soundManager&&!this.soundManager.isMuted()&&this.soundManager.pauseAll()}catch(a){Application.error("onLostFocus: "+a)}if(this.guiManager)this.guiManager.onAppLostFocus()};
Application.prototype.onGotFocus=function(){if(Application.validateOrientation())if(this.isHidden)Application.info("ON GOT FOCUS - The window is hidden.. Do not get focus.");else{Application.info("-- ON GOT FOCUS --");this.updateable=!0;try{this.soundManager&&!this.soundManager.isMuted()&&this.soundManager.resumeAll()}catch(a){Application.error("onGotFocus: "+a)}if(this.guiManager)this.guiManager.onAppGotFocus()}else Application.info("ON GOT FOCUS - Invalid orientation.. Do not get focus.")};
Application.prototype.update=function(){var a=Application.instance;a.updateable?(Application.USE_3D&&a.pixiApp.renderer.reset(),a.guiManager.update(a.pixiApp.ticker.elapsedMS),a.effectManager.update(a.pixiApp.ticker.elapsedMS),Tween2.tick(a.pixiApp.ticker.elapsedMS,!1),a.tweenManager.update()):a.rotateScreen&&a.rotateScreen.animate&&a.tweenManager.update();Application.WIDE_SCREEN?Application.RENDER_MODE===Application.RENDER_CANVAS&&a.getContext().setTransform(Layout.scale*Global.baseScale,0,0,Layout.scale*
Global.baseScale,Global.offsetZoomX*Layout.scale,Global.offsetZoomY*Layout.scale):Application.RENDER_MODE===Application.RENDER_CANVAS&&a.getContext().setTransform(Global.baseScale,0,0,Global.baseScale,Global.offsetZoomX,Global.offsetZoomY);a.guiManager.onDebugDraw(a.getContext());if(window.innerWidth!==a.lastWidth||window.innerHeight!==a.lastHeight)a.onResize(window.innerWidth,window.innerHeight),a.hideAddressBar()};
Application.prototype.hideAddressBar=function(){Application.instance.isMobileDevice&&(setTimeout(function(){window.scrollTo(0,1)},20),setTimeout(function(){window.scrollTo(0,0)},50))};Application.prototype.getCanvas=function(){return this.pixiApp.renderer.view};Application.prototype.getContext=function(){return Application.RENDER_MODE===Application.RENDER_CANVAS?this.pixiApp.renderer.context:this.pixiApp.renderer.gl};Application.prototype.captureScreen=function(){return Application.instance.getCanvas().toDataURL()};
Application.prototype.addDisplayContainer=function(){return new SDisplayObjectContainer};Application.prototype.getSprite=function(a){if(null!=window.PIXI.utils.TextureCache[a])return new SSprite(a);Application.warn("getSprite: ["+a+"] no found");return this.getErrorSprite()};Application.prototype.getAnimation=function(a){if(this.existsAnimation(a))return new Animation(a);Application.error("getAnimation: ["+a+"] no found");return Animation.createFromSprite(this.getErrorSprite(),"ErrorClip")};
Application.prototype.getEmtpyAnimation=function(){return Animation.createFromSprite(this.getEmptySprite(),"EmptyClip")};Application.prototype.existsAnimation=function(a){return null!=window.globalAnimations[a]&&null!=window.globalAnimations[a].atlas};Application.prototype.getSpriteFromUrl=function(a){return new SSprite(a,!1,PIXI.settings.SCALE_MODE)};
Application.prototype.getClip=function(a){window.PIXI.utils.TextureCache[a]&&window.globalAnimations[a]&&Application.warn("::: NAME CONFLICT ::: ["+a+"] is used in Animations and Sprites");if(window.PIXI.utils.TextureCache[a])return new SSprite(a);if(window.globalAnimations[a])return new Animation(a);Application.warn("getClip :: clip or sprite with name ["+a+"] no found");return this.getErrorSprite()};
Application.prototype.getLocalizedImage=function(a){if(SwitJS.debug){var b=window.SWT_BUNDLES.localized;if(b){for(var c=window.SWT_BUNDLES.LOCALIZED_PATH,d=0;d<b.length;d++)if(b[d]===c+a)return new SSprite(b[d],!1,PIXI.settings.SCALE_MODE);return null}Application.fatal("Unregistered localized image: "+a)}return new SSprite(window.SWT_BUNDLES.LOCALIZED_PATH+a,!1,PIXI.settings.SCALE_MODE)};
Application.filesQuality=function(a){if(SwitJS.useAssetsSD)for(var b=0;b<window.SWT_BUNDLES[a].length;b++)window.Assets.FILES_SD[window.SWT_BUNDLES[a][b]]&&(Application.DPI=2,window.SWT_BUNDLES[a][b]=window.Assets.FILES_SD[window.SWT_BUNDLES[a][b]],Application.log("FILES SD :: "+window.SWT_BUNDLES[a][b]))};Application.prototype.getSoundGroup=function(a){var b=Application.config.sounds.filter(function(b){return Common.sparseInt(b.group,0)===a});return 0<b.length?{group:a,sounds:b}:null};
Application.prototype.unloadSoundGroup=function(a){if(Application.soundGroups[a]){var b=Application.config.sounds.filter(function(b){return Common.sparseInt(b.group,0)===a});this.soundManager.removeSounds(b);delete Application.soundGroups[a]}};Application.prototype.unloadSoundsFromList=function(a){if(null!=a&&0<a.length)for(var b=a.length-1;0<=b;--b)this.unloadSoundGroup(a[b])};Application.prototype.playSound=function(a){return this.soundManager.play(a)};Application.prototype.stopSound=function(a){this.soundManager.stop(a)};
Application.prototype.stopAllSounds=function(){this.isSoundOn()&&this.soundManager.stopAllSounds()};Application.prototype.stopAllMusics=function(){this.soundManager.stopAllMusics()};Application.prototype.toggleMute=function(){this.soundManager.toggleMute()};Application.prototype.isPlayingSound=function(a){return this.soundManager.isPlayingSound(a)};Application.prototype.setVolumeById=function(a,b){this.soundManager.setVolumeById(a,b)};Application.prototype.isSoundOn=function(){return!this.soundManager.isMuted()};
Application.prototype.resumeSound=function(a){this.soundManager.resumeSound(a)};Application.prototype.pauseAllSounds=function(){this.soundManager.pauseAll()};Application.prototype.resumeAllSounds=function(){this.soundManager.resumeAll()};Application.console=window.console;Application.log=function(a){Application.LOG&&Application.console&&Application.console.log&&Application.console.log("[LOG] "+a)};
Application.info=function(a){Application.console&&Application.console.info&&Application.console.info("[INFO] "+a)};Application.warn=function(a){Application.console&&Application.console.warn&&Application.console.warn("[WARN] "+a)};Application.error=function(a){Application.console&&Application.console.error&&Application.console.error("[ERROR] "+a)};Application.errorIf=function(a,b){a||Application.error(b)};Application.fatal=function(a){Application.error("[FATAL] "+a)};
Application.assert=function(a,b){};Application.prototype.addEmptySprite=function(){return this.getClip(Application.KEY_EMPTY_SPRITE)};Application.prototype.getEmptySprite=function(){return this.getSpriteFromUrl("media/images/ui_images/common/empty_img.png")};Application.prototype.getErrorSprite=function(){return this.getSpriteFromUrl("media/images/ui_images/common/error_img.png")};
Application.prototype.registerEmptySprite=function(){var a=new Image;a.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAAA1BMVEX///+nxBvIAAAAAXRSTlMAQObYZgAAABVJREFUeF7NwIEAAAAAgKD9qdeocAMAoAABm3DkcAAAAABJRU5ErkJggg==";window.PIXI.utils.TextureCache[Application.KEY_EMPTY_SPRITE]=new window.PIXI.Texture(new window.PIXI.BaseTexture(a))};
Application.prototype.registerErrorSprite=function(){var a=new Image;a.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAmBJREFUeNq8l01rE1EUhp9pahOrC6NN27gR9NephdaiIiLoQhA/QEEXbqQbcaGIWLWtBXGhuNPf4MbfYJuv10XPpGdubqaTZOKFkFnM3Pc57znnfiQCUf4oMmcCMMt0RlL0xUEAKWHaI0l6fUiBBD1B2z1/EjRkXpb0mxfcdjoS6BBAQvDXQbwXnClJvCq4L+g48V4M4GIAsSlYnFC8ZuLdvviBVisGMCtYEew5iA+ChQlsfxBE/sW02jGAFOJy4MQ4EDXB40zk8E3QPAoAwTGD2BuzME8KHgWR7wjOCshLQQixMkZN1ATPgsh3M/AFHPDpCGviY053nBA8deJx50YAQDA3xIlGxPbngfgbwamBOQ+0OkUBUohLAYSPbF6wkfa2/b8T1KPzjeiAr4lVwX6QjvOCF4H4y2jkWYBMEXYLAPh0+Jr4E4i/yhUf4kBRgBRizTnhl9YNqwWmCYC14s8A4LfgQqHvJ0gBZu9bZ7t3YEewVBCgMw5AXfDaiXdteQ3XicY0UlC3yb34E3NkLYDYFjTLBFiIiD8UHHctej1o0eF7x4gAp22yNNcdwT1bdsNDx2pkA1uapAgbgq+B+F2LeFiLXgmc2BUsjwOwKPjsxNuCO872vOPXeqQwm6OkoCn4HkR+Kyfy2JZ8NeJEswjAsrWWj/ymRTbKYjVn37UcxJagkQdwTvDDibcskuoEB9JrAy2aA/AriHxdUCnhSJ51IqcIU/F9E6+WeC+4ETjREyjR4XvJf7ya9S+vyRG34y4wY3AC0jvdjD337H7ZASruvSQTVHa+SoZlStfzwuPfALFp6xuFf+IJAAAAAElFTkSuQmCC";window.PIXI.utils.TextureCache[Application.KEY_ERROR_SPRITE]=
new window.PIXI.Texture(new window.PIXI.BaseTexture(a))};Application.externalTrack=function(a,b){var c=window.Uatu,d={game_name:window.config.settings.GAME_NAME};"undefined"!==typeof b&&(d.game_level=b);c?c.warn(a,d):Application.warn("undefined Uatu");Application.warn("TRACK >> game["+d.game_name+"] action["+a+"] "+(b?"level["+b+"]":""))};function DebugGame(){DebugGame.instance=this}DebugGame.instance=null;DebugGame.prototype.free=function(){DebugGame.instance=null};
DebugGame.prototype.onDebugInit=function(){};DebugGame.prototype.onDebugCreateObject=function(a,b,c){};DebugGame.prototype.onDebugRemoveObject=function(a){};DebugGame.prototype.onDebugKeyDown=function(a){};DebugGame.prototype.onDebugKeyUp=function(a){};
DebugGame.prototype.onDebugPointerPress=function(a){if(Application.sandbox.addObjectEnable&&Application.sandbox.objectToCreate){var b="[SANDBOX] [ADD OBJECT] ",c;for(c in Application.sandbox.objectToCreate)b+=c+":"+Application.sandbox.objectToCreate[c]+", ";Application.log(b.substring(0,b.length-2));this.onDebugCreateObject(a.data.global.x,a.data.global.y,Application.sandbox.objectToCreate)}};DebugGame.prototype.onDebugUpdate=function(a){};DebugGame.prototype.onDebugPointerRelease=function(a){};
DebugGame.prototype.onDebugPointerPressAndRelease=function(a){};DebugGame.prototype.onDebugPointerOver=function(a){};DebugGame.prototype.onDebugPointerMove=function(a){};DebugGame.prototype.onDebugGetSandboxConfig=function(){return[]};DebugGame.prototype.onDebugSandboxLoadConfig=function(){};function DebugObject(){this.onDebugInit()}DebugObject.prototype.free=function(){};DebugObject.prototype.onDebugInit=function(){};DebugObject.prototype.onDebugDelete=function(){};
DebugObject.prototype.onDebugUpdate=function(a){(a=Application.sandbox)&&a.objectSelected&&a.objectViewPropertiesRealTime&&a.objectSelected===this&&a.setObjectViewProperties(this)};DebugObject.prototype.onDebugPointerPress=function(a){};DebugObject.prototype.onDebugChangeProperties=function(a){Application.info("SANDBOX OBJECT PROPERTY :: Change ["+a.property+"] by ["+a.value+"]")};DebugObject.prototype.onDebugSelectObject=function(){Application.sandbox&&Application.sandbox.setObjectViewProperties(this)};
DebugObject.prototype.onDebugGetProperties=function(){return[]};function Path(a){this.m_sections=[];this.m_length=0;for(var b=a.point.length(),c=0;c<b;++c){for(var d=a.point[c].n,e=[],f=0;f<d;++f)e.push(new Vector2D(parseFloat(a.point[c]["x"+f]),parseFloat(a.point[c]["y"+f])));e.push(new Vector2D(parseFloat(a.point[(c+1)%b].x0),parseFloat(a.point[(c+1)%b].y0)));d=new PathSection(e,this.m_length);this.m_length+=d.length();this.m_sections.push(d)}}Path.prototype.free=function(){this.m_sections=null};
Path.prototype.update=function(a,b){this.m_sections[b.pathPosition.section].update(a,b);b.pathPosition.point?b.setPosition(b.pathPosition.point.x,b.pathPosition.point.y):(b.pathPosition.section<this.m_sections.length-1?b.pathPosition.section+=1:(b.pathPosition.section=0,b.pathPosition.distance=0),this.m_sections[b.pathPosition.section].update(a,b),b.pathPosition.point?b.setPosition(b.pathPosition.point.x,b.pathPosition.point.y):Application.info("ERROR"))};
Path.prototype.toString=function(){for(var a="Path:",b=this.m_sections.length,c=0;c<b;++c)a+="\n"+this.m_sections[c];return a};
function PathSection(a,b){this.m_order=a.length-1;this.m_points=a;this.m_initLength=b;this.m_length=0;this.m_oldPos=null;switch(this.m_order){case PathSection.CONIC:case PathSection.CUBIC:case PathSection.LINE:this.m_dir=new Vector2D(this.m_points[this.m_order].x-this.m_points[0].x,this.m_points[this.m_order].y-this.m_points[0].y);this.m_length=this.m_dir.length();this.m_angle=this.m_dir.angle();this.m_dir.normalize();break;default:Application.error("Invalid path section order: "+this.m_order)}}
PathSection.LINE=1;PathSection.CONIC=2;PathSection.CUBIC=3;PathSection.SECTIONS=3;PathSection.prototype.free=function(){this.m_points=null};PathSection.prototype.length=function(){return this.m_length};
PathSection.prototype.update=function(a,b){a=b.pathPosition.distance+a;if(a<=this.m_initLength+this.m_length){switch(this.m_order){case PathSection.LINE:b.pathPosition.point=this.m_dir.clone();b.pathPosition.point.scale(a-this.m_initLength);b.pathPosition.point.add(this.m_points[0]);b.pathPosition.tangent=this.m_angle;break;case PathSection.CONIC:b.pathPosition.point=new Vector2D;var c=(a-this.m_initLength)/this.m_length;b.pathPosition.point.x=(1-c)*(1-c)*this.m_points[0].x+2*(1-c)*c*this.m_points[1].x+
c*c*this.m_points[2].x;b.pathPosition.point.y=(1-c)*(1-c)*this.m_points[0].y+2*(1-c)*c*this.m_points[1].y+c*c*this.m_points[2].y;this.m_oldPos&&(this.m_oldPos.subtract(b.pathPosition.point),this.m_oldPos.scale(-1),b.pathPosition.tangent=this.m_oldPos.angle());this.m_oldPos=b.pathPosition.point;break;case PathSection.CUBIC:b.pathPosition.point=new Vector2D;c=(a-this.m_initLength)/this.m_length;b.pathPosition.point.x=(1-c)*(1-c)*(1-c)*this.m_points[0].x+3*(1-c)*(1-c)*c*this.m_points[1].x+3*(1-c)*c*
c*this.m_points[2].x+c*c*c*this.m_points[3].x;b.pathPosition.point.y=(1-c)*(1-c)*(1-c)*this.m_points[0].y+3*(1-c)*(1-c)*c*this.m_points[1].y+3*(1-c)*c*c*this.m_points[2].y+c*c*c*this.m_points[3].y;this.m_oldPos&&(this.m_oldPos.subtract(b.pathPosition.point),this.m_oldPos.scale(-1),b.pathPosition.tangent=this.m_oldPos.angle());this.m_oldPos=b.pathPosition.point;break;default:Application.error("Invalid path section order: "+this.m_order)}b.pathPosition.distance=a}else this.m_oldPos=b.pathPosition.point=
null};PathSection.prototype.toString=function(){for(var a="section:",b=0;b<this.m_points.length;++b)a+=this.m_points[b]+" ";return a};function SMath(){}SMath.radsFromAtoB=function(a,b,c,d){a=c-a;b=d-b;if(0===a)return 0>b?.5*-Math.PI:.5*Math.PI;for(b=Math.atan2(b,a);b>Math.PI;)b-=2*Math.PI;for(;b<-Math.PI;)b+=2*Math.PI;return b};SMath.degrees=function(a,b){return Math.atan2(a,b)*SMath.RAD_TO_DEG};SMath.toRadians=function(a){return a*SMath.DEG_TO_RAD};SMath.toDegrees=function(a){return a*SMath.RAD_TO_DEG};
SMath.setRange=function(a,b,c){return a>b?b:a<c?c:a};SMath.abs=function(a){return 0>a?-a:a};SMath.sign=function(a){return 0<a?1:0===a?0:-1};SMath.fastSin=function(a){a%=6.28318531;-3.14159265>a?a+=6.28318531:3.14159265<a&&(a-=6.28318531);return 0>a?1.27323954*a+.405284735*a*a:1.27323954*a-.405284735*a*a};SMath.fastCos=function(a){a=a%6.28318531+1.57079632;-3.14159265>a?a+=6.28318531:3.14159265<a&&(a-=6.28318531);return 0>a?1.27323954*a+.405284735*a*a:1.27323954*a-.405284735*a*a};
SMath.polygonArea=function(a){var b=0,c=0;if(3>a.length)return 0;for(var d=0;d<a.length;d++){if(d!==a.length-1)var e=a[d],f=a[d+1];else e=a[d],f=a[0];b+=e.x*f.y;c+=e.y*f.x}return SMath.abs(.5*(b-c))};
SMath.polyContainsPoint=function(a,b,c){if(!b||3>b.length)return!1;for(var d=SMath.polygonArea(b),e=0,f=0;f<b.length;f++)e+=SMath.polygonArea([b[f],f!==b.length-1?b[f+1]:b[0],a]);if(d===e||1>=SMath.abs(d-e)){if(!c)for(f=0;f<b.length;f++)if(SMath.lineContainsPoint(a,f!==b.length-1?[b[f],b[f+1]]:[b[f],b[0]]))return!1;return!0}return!1};SMath.lineContainsPoint=function(a,b){if(!b||2>b.length)return!1;var c=(a.x-b[0].x)/(b[1].x-b[0].x);a=(a.y-b[0].y)/(b[1].y-b[0].y);return 0<=c&&1>=c&&0<=a&&1>=a};
SMath.rectContainsRect=function(a,b){return b[2].x<=a[2].x&&b[0].x>=a[0].x&&b[2].y<=a[2].y&&b[0].y>=a[0].y};SMath.lineIntersectLine=function(a,b){var c=(b[1].y-b[0].y)*(a[1].x-a[0].x)-(b[1].x-b[0].x)*(a[1].y-a[0].y);if(0==c)return!1;var d=a[0].y-b[0].y;var e=a[0].x-b[0].x;b=(b[1].x-b[0].x)*d-(b[1].y-b[0].y)*e;a=(a[1].x-a[0].x)*d-(a[1].y-a[0].y)*e;d=b/c;e=a/c;return 0<d&&1>d&&0<e&&1>e};
SMath.polyContainsLine=function(a,b){for(var c=0;c<b.length;c++)if(SMath.lineIntersectLine(c!==b.length-1?[b[c],b[c+1]]:[b[c],b[0]],a))return!0;return!1};SMath.lerp=function(a,b,c){return a+(b-a)*c};SMath.RAD_TO_DEG=57.2957795;SMath.DEG_TO_RAD=.0174533;SMath._180_over_PI=57.2957795;
function ScrollHandler(){this.tweenScroll=null;this.maxIndex=this.index=0;this.duration=2E3;this.displaceY=this.displaceX=this.y=this.x=0;this.m_onStartCaller=this.m_onStart=this.m_onCompleteCaller=this.m_onComplete=this.m_onUpdateCaller=this.m_onUpdate=null}ScrollHandler.prototype.free=function(){this.tweenScroll&&(this.tweenScroll.free(),this.tweenScroll=null);this.m_onStartCaller=this.m_onStart=this.m_onCompleteCaller=this.m_onComplete=this.m_onUpdateCaller=this.m_onUpdate=null};
ScrollHandler.prototype.goto=function(a){this.tweenScroll=(new Tween(this)).to({x:this.displaceX*a,y:this.displaceY*a},this.duration).easing(TweenEasing.BackOut).onUpdate(this.tweenUpdate).onComplete(this.tweenComplete);this.tweenScroll.start();this.index=a;this.m_onStart&&this.m_onStart.call(this.m_onStartCaller,this)};ScrollHandler.prototype.setIndex=function(a){this.index=a;this.x=this.index*this.displaceX;this.y=this.index*this.displaceY};
ScrollHandler.prototype.addStartListener=function(a,b){this.m_onStart=b;this.m_onStartCaller=a};ScrollHandler.prototype.addUpdateListener=function(a,b){this.m_onUpdate=b;this.m_onUpdateCaller=a};ScrollHandler.prototype.addCompleteListener=function(a,b){this.m_onComplete=b;this.m_onCompleteCaller=a};ScrollHandler.prototype.cancel=function(){this.tweenScroll&&(TweenManager.instance.remove(this.tweenScroll),this.tweenScroll=null)};
ScrollHandler.prototype.next=function(){this.tweenScroll||this.index>=this.maxIndex||this.goto(this.index+1)};ScrollHandler.prototype.lastNext=function(){this.tweenScroll||this.goto(this.maxIndex)};ScrollHandler.prototype.lastBack=function(){this.tweenScroll||this.goto(0)};ScrollHandler.prototype.back=function(){this.tweenScroll||0>=this.index||this.goto(this.index-1)};ScrollHandler.prototype.tweenUpdate=function(a){this.m_onUpdate&&this.m_onUpdate.call(this.m_onUpdateCaller,this)};
ScrollHandler.prototype.tweenComplete=function(a){this.m_onComplete&&this.m_onComplete.call(this.m_onCompleteCaller,this);this.tweenScroll=null};function SRandom(a){"undefined"!==typeof a&&(this.m_seed=a);0>=this.m_seed&&this.srand();this.m_initSeed=this.m_seed;Application.info("SEED: "+this.m_seed);this.random()}SRandom.prototype.reset=function(){this.m_seed=this.m_initSeed;this.random()};SRandom.prototype.random=function(){this.m_seed=16807*this.m_seed%2147483647;return this.m_seed/2147483647};
SRandom.prototype.srand=function(){this.m_seed=1+Math.floor(2147483646*Math.random())};SRandom.prototype.randomInt=function(a,b){return a+Math.floor(this.random()*(b-a+1))};SRandom.prototype.getArrayIndex=function(a,b){"undefined"===typeof b&&(b=-1);if(1<a){var c=this.randomInt(0,a-1);c==b&&(c=(c+1)%a);return c}return 1>a?-1:0};SRandom.prototype.shuffleArray=function(a){for(var b=a.length-1;0<b;){var c=Math.floor(this.random()*(b+1)),d=a[b];a[b]=a[c];a[c]=d;--b}};
function TweenManager(){this._tweens=[];TweenManager.instance=this}TweenManager.prototype.getAll=function(){return this._tweens};TweenManager.prototype.removeAll=function(){this._tweens=[]};TweenManager.prototype.add=function(a){this._tweens.push(a)};TweenManager.prototype.remove=function(a){a=this._tweens.indexOf(a);-1!==a&&this._tweens.splice(a,1)};
TweenManager.prototype.update=function(a){if(0===this._tweens.length)return!1;var b=0,c=this._tweens.length;for(a=void 0!==a?a:"undefined"!==typeof window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now();b<c;)this._tweens[b]&&this._tweens[b].update(a)?b++:(this._tweens[b].free(),this._tweens.splice(b,1),c--);return!0};function TweenEasing(){}TweenEasing.LinearNone=function(a){return a};TweenEasing.QuadraticIn=function(a){return a*a};
TweenEasing.QuadraticOut=function(a){return a*(2-a)};TweenEasing.QuadraticInOut=function(a){return 1>(a*=2)?.5*a*a:-.5*(--a*(a-2)-1)};TweenEasing.CubicIn=function(a){return a*a*a};TweenEasing.CubicOut=function(a){return--a*a*a+1};TweenEasing.CubicInOut=function(a){return 1>(a*=2)?.5*a*a*a:.5*((a-=2)*a*a+2)};TweenEasing.QuarticIn=function(a){return a*a*a*a};TweenEasing.QuarticOut=function(a){return 1- --a*a*a*a};TweenEasing.QuarticInOut=function(a){return 1>(a*=2)?.5*a*a*a*a:-.5*((a-=2)*a*a*a-2)};
TweenEasing.QuinticIn=function(a){return a*a*a*a*a};TweenEasing.QuinticOut=function(a){return--a*a*a*a*a+1};TweenEasing.QuinticInOut=function(a){return 1>(a*=2)?.5*a*a*a*a*a:.5*((a-=2)*a*a*a*a+2)};TweenEasing.SinusoidalIn=function(a){return 1-Math.cos(a*Math.PI/2)};TweenEasing.SinusoidalOut=function(a){return Math.sin(a*Math.PI/2)};TweenEasing.SinusoidalInOut=function(a){return.5*(1-Math.cos(Math.PI*a))};TweenEasing.ExponentialIn=function(a){return 0===a?0:Math.pow(1024,a-1)};
TweenEasing.ExponentialOut=function(a){return 1===a?1:1-Math.pow(2,-10*a)};TweenEasing.ExponentialInOut=function(a){return 0===a?0:1===a?1:1>(a*=2)?.5*Math.pow(1024,a-1):.5*(-Math.pow(2,-10*(a-1))+2)};TweenEasing.CircularIn=function(a){return 1-Math.sqrt(1-a*a)};TweenEasing.CircularOut=function(a){return Math.sqrt(1- --a*a)};TweenEasing.CircularInOut=function(a){return 1>(a*=2)?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)};
TweenEasing.ElasticIn=function(a){var b=.1;if(0===a)return 0;if(1===a)return 1;if(!b||1>b){b=1;var c=.1}else c=.4*Math.asin(1/b)/(2*Math.PI);return-(b*Math.pow(2,10*--a)*Math.sin(2*(a-c)*Math.PI/.4))};TweenEasing.ElasticOut=function(a){var b=.1;if(0===a)return 0;if(1===a)return 1;if(!b||1>b){b=1;var c=.1}else c=.4*Math.asin(1/b)/(2*Math.PI);return b*Math.pow(2,-10*a)*Math.sin(2*(a-c)*Math.PI/.4)+1};
TweenEasing.ElasticInOut=function(a){var b=.1;if(0===a)return 0;if(1===a)return 1;if(!b||1>b){b=1;var c=.1}else c=.4*Math.asin(1/b)/(2*Math.PI);return 1>(a*=2)?-.5*b*Math.pow(2,10*--a)*Math.sin(2*(a-c)*Math.PI/.4):b*Math.pow(2,-10*--a)*Math.sin(2*(a-c)*Math.PI/.4)*.5+1};TweenEasing.BackIn=function(a){return a*a*(2.70158*a-1.70158)};TweenEasing.BackOut=function(a){return--a*a*(2.70158*a+1.70158)+1};
TweenEasing.BackInOut=function(a){return 1>(a*=2)?.5*a*a*(3.5949095*a-2.5949095):.5*((a-=2)*a*(3.5949095*a+2.5949095)+2)};TweenEasing.BounceIn=function(a){return 1-TweenEasing.BounceOut(1-a)};TweenEasing.BounceOut=function(a){return a<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375};TweenEasing.BounceInOut=function(a){return.5>a?.5*TweenEasing.BounceIn(2*a):.5*TweenEasing.BounceOut(2*a-1)+.5};
function TweenInterpolation(){}TweenInterpolation.Linear=function(a,b){var c=a.length-1,d=c*b,e=Math.floor(d),f=TweenInterpolation.UtilsLinear;return 0>b?f(a[0],a[1],d):1<b?f(a[c],a[c-1],c-d):f(a[e],a[e+1>c?c:e+1],d-e)};TweenInterpolation.Bezier=function(a,b){var c=0,d=a.length-1,e=Math.pow,f=TweenInterpolation.UtilsBernstein,g;for(g=0;g<=d;g++)c+=e(1-b,d-g)*e(b,g)*a[g]*f(d,g);return c};
TweenInterpolation.CatmullRom=function(a,b){var c=a.length-1,d=c*b,e=Math.floor(d),f=TweenInterpolation.UtilsCatmullRom;return a[0]===a[c]?(0>b&&(e=Math.floor(d=c*(1+b))),f(a[(e-1+c)%c],a[e],a[(e+1)%c],a[(e+2)%c],d-e)):0>b?a[0]-(f(a[0],a[0],a[1],a[1],-d)-a[0]):1<b?a[c]-(f(a[c],a[c],a[c-1],a[c-1],d-c)-a[c]):f(a[e?e-1:0],a[e],a[c<e+1?c:e+1],a[c<e+2?c:e+2],d-e)};TweenInterpolation.UtilsLinear=function(a,b,c){return(b-a)*c+a};
TweenInterpolation.UtilsBernstein=function(a,b){var c=TweenInterpolation.UtilsFactorial;return c(a)/c(b)/c(a-b)};TweenInterpolation.UtilsFactorial=function(a){for(var b=1,c=1;c<=a;c++)b*=c;return b};TweenInterpolation.UtilsCatmullRom=function(a,b,c,d,e){a=.5*(c-a);d=.5*(d-b);var f=e*e;return(2*b-2*c+a+d)*e*f+(-3*b+3*c-2*a-d)*f+a*e+b};
function Tween(a){this._object=this.target=a;this._valuesStart={};this._valuesEnd={};this._valuesStartRepeat={};this._duration=1E3;this._repeat=0;this._reversed=this._yoyo=!1;this._delayTime=0;this._startTime=null;this._easingFunction=TweenEasing.LinearNone;this._interpolationFunction=TweenInterpolation.Linear;this._chainedTweens=[];this._onStartCallback=null;this._onStartCallbackFired=!1;this._onCompleteCallback=this._onUpdateCallback=null;for(var b in a)this._valuesStart[b]=parseFloat(a[b])}
Tween.prototype.free=function(){this._onCompleteCallback=this._onUpdateCallback=this._onStartCallback=this._chainedTweens=this._interpolationFunction=this._easingFunction=this._valuesStartRepeat=this._valuesEnd=this._valuesStart=this._object=this.target=null};Tween.prototype.to=function(a,b){void 0!==b&&(this._duration=b);this._valuesEnd=a;return this};
Tween.prototype.start=function(a){TweenManager.instance.add(this);this._onStartCallbackFired=!1;this._startTime=void 0!==a?a:"undefined"!==typeof window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now();this._startTime+=this._delayTime;for(var b in this._valuesEnd){if(this._valuesEnd[b]instanceof Array){if(0===this._valuesEnd[b].length)continue;this._valuesEnd[b]=[this._object[b]].concat(this._valuesEnd[b])}this._valuesStart[b]=this._object[b];!1===
this._valuesStart[b]instanceof Array&&(this._valuesStart[b]*=1);this._valuesStartRepeat[b]=this._valuesStart[b]||0}return this};Tween.prototype.stop=function(){TweenManager.instance.remove(this);return this};Tween.prototype.delay=function(a){this._delayTime=a;return this};Tween.prototype.repeat=function(a){this._repeat=a;return this};Tween.prototype.yoyo=function(a){this._yoyo=a;return this};Tween.prototype.easing=function(a){this._easingFunction=a;return this};
Tween.prototype.interpolation=function(a){this._interpolationFunction=a;return this};Tween.prototype.chain=function(){this._chainedTweens=arguments;return this};Tween.prototype.onStart=function(a){this._onStartCallback=a;return this};Tween.prototype.onUpdate=function(a){this._onUpdateCallback=a;return this};Tween.prototype.onComplete=function(a){this._onCompleteCallback=a;return this};
Tween.prototype.update=function(a){if(a<this._startTime)return!0;!1===this._onStartCallbackFired&&(null!==this._onStartCallback&&this._onStartCallback.call(this._object,this),this._onStartCallbackFired=!0);var b=(a-this._startTime)/this._duration;b=1<b?1:b;var c=this._easingFunction(b);for(f in this._valuesEnd){var d=this._valuesStart[f]||0,e=this._valuesEnd[f];e instanceof Array?this._object[f]=this._interpolationFunction(e,c):("string"===typeof e&&(e=d+parseFloat(e)),"number"===typeof e&&(this._object[f]=
d+(e-d)*c))}if(1==b){if(0<this._repeat){isFinite(this._repeat)&&this._repeat--;for(f in this._valuesStartRepeat)"string"===typeof this._valuesEnd[f]&&(this._valuesStartRepeat[f]+=parseFloat(this._valuesEnd[f])),this._yoyo&&(b=this._valuesStartRepeat[f],this._valuesStartRepeat[f]=this._valuesEnd[f],this._valuesEnd[f]=b,this._reversed=!this._reversed),this._valuesStart[f]=this._valuesStartRepeat[f];this._startTime=a+this._delayTime;return!0}null!==this._onCompleteCallback&&this._onCompleteCallback.call(this._object,
this);var f=0;for(b=this._chainedTweens.length;f<b;f++)this._chainedTweens[f].start(a);return!1}null!==this._onUpdateCallback&&null!==this._object&&this._onUpdateCallback.call(this._object,this);return!0};function Common(){}
Common.saveData=function(a,b){if(window.localStorage)window.localStorage.setItem(a,b);else{0<b.indexOf(";")&&Application.fatal("Saving invalid string with ';' character"+a);b.length>Common.COOKIE_MAX_LENGTH&&Application.error("Can't save string of size "+b.length);var c=new Date;c.setDate(c.getDate()+Common.COOKIE_EXPIRATION_DAYS);c="; expires="+c.toUTCString();document.cookie=a+"="+b+c+"; path=/"}};Common.COOKIE_EXPIRATION_DAYS=540;Common.COOKIE_MAX_LENGTH=4090;
Common.loadData=function(a,b){if(window.localStorage)b=window.localStorage.getItem(a)||b;else{a+="=";for(var c=document.cookie.split(";"),d=0;d<c.length;++d){for(var e=c[d];" "===e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(a)){b=e.substring(a.length,e.length);break}}}return b};
Common.shake=function(a,b,c,d,e,f,g){function h(){l+=d;a&&a.parent&&(a.position.x=m+Common.randomInt(-k,k),a.position.y=n+Common.randomInt(-k,k));l>=b&&(a&&(a.isShaking=!1),a&&a.parent&&(a.position.x=m,a.position.y=n),f&&(e?f.call(e,g):f(g)),clearInterval(p))}if(!a.isShaking){a.isShaking=!0;var k=c||5;d=d||50;var l=0,m=a.position.x,n=a.position.y,p=setInterval(h,d)}};Common.storageString=function(a,b){b="undefined"!==typeof b?b:"|";for(var c="",d=0;d<a.length;d++)c+=0!==d?b:"",c+=a[d];return c};
Common.copyNumericArray=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c]);return b};Common.initArray=function(a,b){for(var c=[],d=0;d<b;d++)c.push(a);return c};Common.inArray=function(a,b){return-1!==b.indexOf(a)};Common.random=function(a,b){return Math.floor(Math.random()*(b-a+1))+a};Common.randomInt=function(a,b){return a+Math.floor(Math.random()*(b-a+1))};
Common.mixer=function(a){a=a.slice(0);for(var b,c=0;c<a.length;c++)b=Math.round(Math.random()*(a.length-1-c))+c,a.splice(c,0,a[b]),a.splice(b+1,1);return a};Common.getRandomArrayIndex=function(a,b){if(1<a){for(var c=Common.randomInt(0,a-1);c==b;)c=(c+1)%a;return c}return 0};Common.fillValuesArray=function(a,b){for(var c=[],d=0,e=0;e<b;e++)c.push(a[d]),d++,d>a.length-1&&(d=0);return c};
Common.getRandomFromArray=function(a,b){var c=a.length;if(1<c){if("undefined"!==typeof b){for(var d=[],e=0;e<c;++e)a[e]!==b&&d.push(e);if(0<d.length)return a[d[Math.floor(d.length*Math.random())]]}return a[Math.floor(c*Math.random())]}return 1===c?a[0]:null};Common.randomAndSpliceFromArray=function(a){return a.splice(Common.random(0,a.length-1),1)};Common.shuffleArray=function(a){for(var b,c,d=a.length-1;1<=d;--d)b=Math.floor(Math.random()*(d+1)),c=a[b],a[b]=a[d],a[d]=c};
Common.getParams=function(a){var b={};a=a.split(";");for(var c=0;c<a.length;c++)for(var d=a[c].split(":"),e=0;e<d.length;e++)b[String(d[0]).concat()]=d[1];return b};Common.getParamsMultiple=function(a,b){a=a.split(b);if(1<a.length){b=[];for(var c=0;c<a.length;c++)b.push(Common.getParams(a[c]));return b}return Common.getParams(a[0])};Common.lengthObject=function(a){var b=0,c;for(c in a)a.hasOwnProperty(c)&&++b;return b};
Common.parseRect=function(a){a=a.split(";");return 4!==a.length?null:new Rectangle(parseInt(a[0],10),parseInt(a[1],10),parseInt(a[2],10),parseInt(a[3],10))};Common.trim=function(a){return String(a).replace(/^\s*(.*?)\s*$/g,"$1")};Common.sumArray=function(a){for(var b=0,c=0;c<a.length;c++)b+=a[c];return b};Common.parseNum=function(a){return 10>a?"0"+a:""+a};Common.circumferenceAngle=function(a,b){a=Math.atan2(b,a);a*=180/Math.PI;return 0>a?360+a:a};
Common.tween=function(a,b,c,d,e,f){a=(new Tween(a)).to(b,c).easing("undefined"===typeof f?TweenEasing.BackOut:f).onUpdate(Common.tweenUpdate).onComplete(Common.tweenComplete).delay("undefined"===typeof e?0:e);Common.tweenUpdate(a,!0);d&&a.start();return a};
Common.tweenUpdate=function(a,b){try{var c=a.target.parent,d=a.target.clip;c&&a.target.onUpdate&&!b&&a.target.onUpdate.call(c,a.target);if(d)for(var e in a.target)switch(e){case "alpha":var f=1<a.target.alpha?1:a.target.alpha;f=0>a.target.alpha?0:f;d.alpha=f;break;case "sx":d.scale.x=a.target.sx;break;case "sy":d.scale.y=a.target.sy;break;case "scale":d.scale.x=a.target.scale;d.scale.y=a.target.scale;break;case "x":d.position.x=a.target.x;break;case "y":d.position.y=a.target.y;break;case "rotation":d.rotation=
a.target.rotation}}catch(g){Application.warn(" Tween onUpdate ::"+g)}};
Common.tweenComplete=function(a){try{var b=a.target.parent,c=a.target.clip;b&&a.target.onComplete&&(a.target.onComplete.call(b,a.target),a.target.parent=null,a.target.onComplete=null);if(c)for(var d in a._valuesEnd)switch(d){case "alpha":var e=1<a._valuesEnd.alpha?1:a._valuesEnd.alpha;e=0>a._valuesEnd.alpha?0:e;c.alpha=e;break;case "sx":c.scale.x=a._valuesEnd.sx;break;case "sy":c.scale.y=a._valuesEnd.sy;break;case "scale":c.scale.x=a._valuesEnd.scale;c.scale.y=a._valuesEnd.scale;break;case "x":c.position.x=
a._valuesEnd.x;break;case "y":c.position.y=a._valuesEnd.y;break;case "rotation":c.rotation=a._valuesEnd.rotation}}catch(f){Application.warn(" Tween onComplete ::"+f)}};Common.distance=function(a,b,c,d){return Math.sqrt((c-a)*(c-a)+(d-b)*(d-b))};Common.distanceSquared=function(a,b,c,d){return(c-a)*(c-a)+(d-b)*(d-b)};Common.makeClockTime=function(a){var b={};a=Math.ceil(a/1E3);var c=Math.floor(a/60),d=Math.floor(a%60);b.total=a;b.minutes=c;b.seconds=d;return b};
Common.getDigitsByValue=function(a,b){a=String(a);b-=a.length;for(var c=0;c<b;c++)a="0"+a;return a.split("")};Common.getData=function(a,b,c){if(null==a)Application.error("Common:: data is null");else if("undefined"===typeof b)Application.error("Common:: dataName is undefined: "+b);else{if("undefined"!==typeof a[b])return a[b];Application.error("Property not found: "+b)}return"undefined"!==typeof c?c:null};Common.isValidNumber=function(a){return"number"!==typeof a||isNaN(a)||!isFinite(a)?!1:!0};
Common.sparseInt=function(a,b){a=parseInt(a,10);return isNaN(a)?b:a};Common.sparseFloat=function(a,b){a=parseFloat(a);return isNaN(a)?b:a};Common.ajaxRequest=function(){var a=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Microsoft.XMLHTTP"];if(window.ActiveXObject)for(var b=0;b<a.length;b++)try{return new window.ActiveXObject(a[b])}catch(c){}else if(window.XMLHttpRequest)return new window.XMLHttpRequest;return null};
Common.splitSegmentToPoints=function(a,b,c){2>c&&(Application.error("Error to split, segment mus be mora than 2"),c=2);var d=[],e=b.x-a.x,f=b.y-a.y;b=Math.atan2(f,e);e=Math.sqrt(e*e+f*f)/(c-1);for(f=0;f<c;f++)d.push(new SPoint(~~(a.x+e*f*Math.cos(b)),~~(a.y+e*f*Math.sin(b))));return d};
Common.splitSegmentToSeparation=function(a,b,c){var d=[],e=b.x-a.x,f=b.y-a.y;b=Math.atan2(f,e);e=Math.sqrt(e*e+f*f);for(var g=f=0;1E3>g;g++){if(f<=e)d.push(new SPoint(~~(a.x+c*g*Math.cos(b)),~~(a.y+c*g*Math.sin(b))));else break;f+=c}return d};Common.randomRangeInt=function(a,b){return a-b+Math.floor(Math.random()*(2*b+1))};Common.randomRangeFloat=function(a,b){return a-b+2*Math.random()*b};Common.trunc=function(a){return 0>a?Math.ceil(a):Math.floor(a)};
Common.weightedRandom=function(a){for(var b=0,c=0;c<a.length;c++)b+=a[c];b*=Math.random();var d=0;for(c=0;c<a.length;c++){if(b<a[c]){d=c;break}b-=a[c]}return d};Common.colorDecimalToHex=function(a){return a%1E3+(Common.trunc(a/1E3)%1E3<<8)+(Common.trunc(a/1E6)%1E3<<16)};Common.getR=function(a){return a>>16&255};Common.getG=function(a){return a>>8&255};Common.getB=function(a){return a&255};Common.getR_float=function(a){return Common.getR(a)/255};
Common.getG_float=function(a){return Common.getG(a)/255};Common.getB_float=function(a){return Common.getB(a)/255};Common.validateRandom=function(a,b){return a<b?Common.trunc(Common.randomInt(a,b)):a==b?a:Common.trunc(Common.randomInt(b,a))};Common.gradToRadian=function(a){return.017453292519943295*a};
Common.getArcPoints=function(a,b,c,d){var e=Common.gradToRadian(b);c=Common.gradToRadian(c);b=(c-e)/d;var f=[];f.push(0,0);for(var g=0;g<=d;g++)f.push(a*Math.cos(e)),f.push(a*Math.sin(e)),e+=b,e=g===d?c:e;return f};Common.clamp=function(a,b,c){return Math.max(b,Math.min(c,a))};Common.createArraySize=function(a,b){if(Array.prototype.fill){var c=Array(a);c.fill(b);return c}c=[];for(var d=0;d<a;d++)c.push(b);return c};
Common.createArraySize=function(a,b){if(Array.prototype.fill){var c=Array(a);c.fill(b);return c}c=[];for(var d=0;d<a;d++)c.push(b);return c};Common.maxInt=function(a,b){return a>b?a:b};Common.minInt=function(a,b){return a<b?a:b};Common.arrayToSPoints=function(a){if(!a||0===a.length)return null;for(var b=[],c=0;c<a.length;c+=2)b.push(new SPoint(a[c],a[c+1]));return b};Common.SPointsToArray=function(a){if(!a||0===a.length)return null;for(var b=[],c=0;c<a.length;c++)b.push(a[c].x),b.push(a[c].y);return b};
Common.getIdentifier=function(a){return"undefined"!==typeof a.data.identifier?a.data.identifier:a.data.originalEvent.which};Common.KEY_1=49;Common.KEY_2=50;Common.KEY_3=51;Common.KEY_4=52;Common.KEY_5=53;Common.KEY_6=54;Common.KEY_7=55;Common.KEY_8=56;Common.KEY_9=57;Common.KEY_0=48;Common.KEY_A=65;Common.KEY_B=66;Common.KEY_C=67;Common.KEY_D=68;Common.KEY_E=69;Common.KEY_F=70;Common.KEY_G=71;Common.KEY_H=72;Common.KEY_I=73;Common.KEY_J=74;Common.KEY_K=75;Common.KEY_L=76;Common.KEY_M=77;
Common.KEY_N=78;Common.KEY_O=79;Common.KEY_P=80;Common.KEY_Q=81;Common.KEY_R=82;Common.KEY_S=83;Common.KEY_T=84;Common.KEY_U=85;Common.KEY_V=86;Common.KEY_W=87;Common.KEY_X=88;Common.KEY_Z=90;Common.KEY_ESC=27;Common.KEY_SPACE=32;Common.KEY_ENTER=13;Common.KEY_LEFT=37;Common.KEY_RIGHT=39;Common.KEY_DOWN=40;Common.KEY_UP=38;Common.KEY_SHIFT=16;Common.IDENTIFIER_NONE=-1;Common.COLOR_NONE="rgba(0, 0, 0, 0)";Common.COLOR_RED="#FF0000";Common.COLOR_GREEN="#00FF00";Common.COLOR_BLUE="#0000FF";
Common.COLOR_BLACK="#000000";Common.COLOR_WHITE="#FFFFFF";Common.COLOR_ORANGE="#FF9900";Common.COLOR_MAGENTA="#FF00FF";Common.COLOR_PURPLE="#990066";Common.COLOR_PINK="#FF66FF";Common.COLOR_BROWN="#663300";Common.COLOR_YELLOW="#FFFF00";Common.COLOR_GREY="#666666";Common.COLOR_DARK_BLUE="#000066";function ContextGraphics(){}
ContextGraphics.drawLine=function(a,b,c,d,e,f,g){Application.RENDER_MODE===Application.RENDER_CANVAS&&(a.beginPath(),a.strokeStyle="undefined"===typeof f?Common.COLOR_BLACK:f,a.lineWidth="undefined"===typeof g?1:g,a.moveTo(b,c),a.lineTo(d,e),a.stroke(),a.closePath())};
ContextGraphics.drawRectangle=function(a,b,c,d,e,f,g,h){Application.RENDER_MODE===Application.RENDER_CANVAS&&(a.strokeStyle="undefined"===typeof g?Common.COLOR_BLUE:g,a.lineWidth="undefined"===typeof f?1:f,a.fillStyle="undefined"===typeof h?"rgba(0, 0, 0, 0)":h,a.fillRect(b,c,d,e),a.strokeRect(b,c,d,e))};
ContextGraphics.drawRect=function(a,b,c,d){Application.RENDER_MODE===Application.RENDER_CANVAS&&(a.strokeStyle="undefined"===typeof c?Common.COLOR_BLUE:c,a.fillStyle="undefined"===typeof d?"rgba(0, 0, 0, 0)":d,a.lineWidth=1,a.fillRect(b.x,b.y,b.w,b.h),a.strokeRect(b.x,b.y,b.w,b.h))};
ContextGraphics.drawCircle=function(a,b,c,d,e,f){Application.RENDER_MODE===Application.RENDER_CANVAS&&(a.beginPath(),a.lineWidth=1,a.strokeStyle="undefined"===typeof e?Common.COLOR_BLUE:e,a.arc(b,c,d,0,2*Math.PI,!0),a.stroke(),a.fillStyle="undefined"===typeof f?"rgba(0, 0, 0, 0)":f,a.fill(),a.closePath())};
ContextGraphics.drawArc=function(a,b,c,d,e,f,g,h){Application.RENDER_MODE===Application.RENDER_CANVAS&&(a.beginPath(),a.strokeStyle="undefined"===typeof g?Common.COLOR_BLUE:g,a.fillStyle="undefined"===typeof h?"rgba(0, 0, 0, 0)":h,a.lineWidth=1,a.arc(b,c,d,e,f,!0),a.closePath(),a.stroke(),a.fill())};
ContextGraphics.drawCross=function(a,b,c,d,e,f){Application.RENDER_MODE===Application.RENDER_CANVAS&&(a.beginPath(),a.strokeStyle="undefined"===typeof e?Common.COLOR_GREEN:e,a.lineWidth="undefined"===typeof f?1:f,a.moveTo(b-d,c-d),a.lineTo(b+d,c+d),a.moveTo(b-d,c+d),a.lineTo(b+d,c-d),a.stroke(),a.closePath())};
ContextGraphics.drawArrow=function(a,b,c,d,e,f,g,h){Application.RENDER_MODE===Application.RENDER_CANVAS&&(a.beginPath(),a.strokeStyle="undefined"===typeof f?Common.COLOR_YELLOW:f,a.lineWidth="undefined"===typeof h?1:h,"undefined"===typeof g&&(g=5),a.moveTo(b,c),a.lineTo(d,e),b=new Vector2D(d-b,e-c),b.normalize(),a.lineTo(d-g*(b.x+b.y),e-g*(b.y-b.x)),a.moveTo(d,e),a.lineTo(d-g*(b.x-b.y),e-g*(b.y+b.x)),a.stroke(),a.closePath())};
ContextGraphics.drawPath=function(a,b,c,d){if(Application.RENDER_MODE===Application.RENDER_CANVAS){var e=b.length;if(!(3>e)){a.beginPath();a.moveTo(b[0][0],b[0][1]);for(var f=1;f<e-2;++f)a.quadraticCurveTo(b[f][0],b[f][1],(b[f][0]+b[f+1][0])/2,(b[f][1]+b[f+1][1])/2);a.quadraticCurveTo(b[f][0],b[f][1],b[f+1][0],b[f+1][1]);a.strokeStyle="undefined"===typeof c?Common.COLOR_RED:c;a.lineWidth="undefined"===typeof d?1:d;a.stroke();a.closePath()}}};
ContextGraphics.drawBezier=function(a,b,c,d){Application.RENDER_MODE===Application.RENDER_CANVAS&&(a.beginPath(),a.moveTo(b[0].x,b[0].y),a.quadraticCurveTo(b[1].x,b[1].y,b[2].x,b[2].y),a.strokeStyle="undefined"===typeof c?Common.COLOR_RED:c,a.lineWidth="undefined"===typeof d?1:d,a.stroke(),a.closePath())};
ContextGraphics.drawQuad=function(a,b,c,d,e,f,g){Application.RENDER_MODE===Application.RENDER_CANVAS&&(a.strokeStyle="undefined"===typeof f?Common.COLOR_BLUE:f,a.lineWidth="undefined"===typeof g?1:g,a.strokeRect(b,c,d,e))};
function VirtualStick(a,b,c,d){this.maxForce="undefined"===typeof b?0:b;this.x="undefined"===typeof c?0:c;this.y="undefined"===typeof d?0:d;this.anchor=0===this.x&&0===this.y?!1:!0;this.identifier=Common.IDENTIFIER_NONE;this.forceY=this.forceX=this.preOldAngle=this.deltaAngle=this.angle=this.oldAngle=this.force=0;this.canvas=a;this.clipBase=Application.instance.getAnimation("mcUIStickBase");this.clipPointer=Application.instance.getAnimation("mcUIStickPointer");this.canvas.addChild(this.clipBase);
this.canvas.addChild(this.clipPointer);this.clipBase.setPosition(this.x,this.y);this.clipPointer.setPosition(this.x,this.y);this.anchor||(this.clipBase.visible=!1,this.clipPointer.visible=!1);this.m_callbackChangeFunction=this.m_callbackChangeObject=this.m_callbackReleaseFunction=this.m_callbackReleaseObject=this.m_callbackPressFunction=this.m_callbackPressObject=null}
VirtualStick.prototype.free=function(){this.m_callbackChangeFunction=this.m_callbackChangeObject=this.m_callbackReleaseFunction=this.m_callbackReleaseObject=this.m_callbackPressFunction=this.m_callbackPressObject=null;this.canvas.removeChild(this.clipBase);this.canvas.removeChild(this.clipPointer);this.clipBase.free();this.clipBase=null;this.clipPointer.free();this.canvas=this.clipPointer=null};
VirtualStick.prototype.addPressListener=function(a,b){this.m_callbackPressObject=a;this.m_callbackPressFunction=b};
VirtualStick.prototype.setClips=function(a,b){this.clipBase&&this.canvas.removeChild(this.clipBase);this.clipPointer&&this.canvas.removeChild(this.clipPointer);this.clipBase=Application.instance.getAnimation(a);this.clipPointer=Application.instance.getAnimation(b);this.canvas.addChild(this.clipBase);this.canvas.addChild(this.clipPointer);this.clipBase.setPosition(this.x,this.y);this.clipPointer.setPosition(this.x,this.y);this.anchor||(this.clipBase.visible=!1,this.clipPointer.visible=!1)};
VirtualStick.prototype.addReleaseListener=function(a,b){this.m_callbackReleaseObject=a;this.m_callbackReleaseFunction=b};VirtualStick.prototype.addChangeListener=function(a,b){this.m_callbackChangeObject=a;this.m_callbackChangeFunction=b};
VirtualStick.prototype.onPointerPress=function(a){this.identifier===Common.IDENTIFIER_NONE&&(this.anchor||(this.x=a.data.global.x,this.y=a.data.global.y,this.clipBase.setPosition(this.x,this.y),this.clipPointer.setPosition(this.x,this.y)),this.clipBase.visible=!0,this.clipPointer.visible=!0,this.identifier=this.getIdentifier(a),null!==this.m_callbackPressObject&&null!==this.m_callbackPressFunction&&this.m_callbackPressFunction.call(this.m_callbackPressObject,this))};
VirtualStick.prototype.onPointerRelease=function(a){this.identifier===this.getIdentifier(a)&&(this.anchor||(this.clipBase.visible=!1,this.clipPointer.visible=!1),this.angle=this.force=0,this.clipPointer.setPosition(this.x,this.y),this.identifier=Common.IDENTIFIER_NONE,null!==this.m_callbackReleaseObject&&null!==this.m_callbackReleaseFunction&&this.m_callbackReleaseFunction.call(this.m_callbackReleaseObject,this))};
VirtualStick.prototype.onPointerMove=function(a){this.identifier===this.getIdentifier(a)&&(this.force=Math.sqrt((a.data.global.x-this.x)*(a.data.global.x-this.x)+(a.data.global.y-this.y)*(a.data.global.y-this.y)),this.angle=Math.atan2(a.data.global.y-this.y,a.data.global.x-this.x),0<this.maxForce&&this.force>this.maxForce&&(this.force=this.maxForce),this.forceX=this.force*Math.cos(this.angle),this.forceY=this.force*Math.sin(this.angle),this.clipPointer.setPosition(this.x+this.forceX,this.y+this.forceY),
null!==this.m_callbackChangeObject&&null!==this.m_callbackChangeFunction&&this.m_callbackChangeFunction.call(this.m_callbackChangeObject,this))};VirtualStick.prototype.getIdentifier=function(a){return"undefined"!==typeof a.data.identifier?a.data.identifier:a.data.originalEvent.which};VirtualStick.prototype.setVisible=function(a){this.canvas.visible=a};VirtualStick.prototype.pressTest=function(a,b){return 71>=SMath.abs(a-this.x)&&71>=SMath.abs(b-this.y)};
function TouchControl(){this.y=this.x=0;this.identifier=Common.IDENTIFIER_NONE;this.direction=this.angle=0;this.onReleaseHoldListener=this.onHoldListener=this.onSwipeListener=this.onReleaseListener=this.onPressListener=this.callerObject=null;this.m_minDistance=70;this.m_minTime=400;this.swipeY=this.swipeX=this.m_timeReset=0;this.hold=!1}TouchControl.DIR_RIGHT=1;TouchControl.DIR_DOWN=2;TouchControl.DIR_LEFT=3;TouchControl.DIR_UP=4;
TouchControl.prototype.free=function(){this.onPressListener=this.onHoldListener=this.onSwipeListener=this.onReleaseListener=this.callerObject=null};TouchControl.prototype.onPointerPress=function(a){return this.identifier===Common.IDENTIFIER_NONE?(this.identifier=this.getIdentifier(a),this.x=a.data.global.x,this.y=a.data.global.y,this.m_timeReset=this.m_minTime,this.callerObject&&this.onPressListener&&this.onPressListener.call(this.callerObject,this),!0):!1};
TouchControl.prototype.onPointerRelease=function(a){return this.identifier===this.getIdentifier(a)?(this.angle=0,this.identifier=Common.IDENTIFIER_NONE,this.hold?this.callerObject&&this.onReleaseHoldListener&&this.onReleaseHoldListener.call(this.callerObject,this):this.callerObject&&this.onReleaseListener&&this.onReleaseListener.call(this.callerObject,this),this.hold=!1,!0):!1};
TouchControl.prototype.onPointerMove=function(a){if(this.identifier===this.getIdentifier(a)){var b=Math.sqrt((a.data.global.x-this.x)*(a.data.global.x-this.x)+(a.data.global.y-this.y)*(a.data.global.y-this.y));this.angle=Math.atan2(a.data.global.y-this.y,a.data.global.x-this.x);this.angle=180*this.angle/Math.PI;0<this.m_timeReset&&b>this.m_minDistance&&(this.swipeX=a.data.global.x,this.swipeY=a.data.global.y,0<this.angle&&45>=this.angle?this.direction=TouchControl.DIR_RIGHT:45<this.angle&&135>=this.angle?
this.direction=TouchControl.DIR_DOWN:135<this.angle&&180>=this.angle?this.direction=TouchControl.DIR_LEFT:-180<this.angle&&-135>=this.angle?this.direction=TouchControl.DIR_LEFT:-135<this.angle&&-45>=this.angle?this.direction=TouchControl.DIR_UP:-45<this.angle&&0>=this.angle&&(this.direction=TouchControl.DIR_RIGHT),this.identifier=Common.IDENTIFIER_NONE,this.callerObject&&this.onSwipeListener&&this.onSwipeListener.call(this.callerObject,this))}};
TouchControl.prototype.update=function(a){this.identifier!==Common.IDENTIFIER_NONE&&(this.m_timeReset-=a,0>=this.m_timeReset&&(!this.hold&&this.callerObject&&this.onHoldListener&&this.onHoldListener.call(this.callerObject,this),this.hold=!0))};TouchControl.prototype.reset=function(){this.identifier=Common.IDENTIFIER_NONE};TouchControl.prototype.getIdentifier=function(a){return"undefined"!==typeof a.data.identifier?a.data.identifier:a.data.originalEvent.which};
function TintInterval(a,b,c,d){this.m_timeFrecuency=0;this.m_timeFrecuencyElapse=c;this.m_timeDuration=b;this.m_indexColor=this.m_timeElapse=0;this.m_clip=a;this.m_colors="undefined"===typeof d?null:d;this.m_start=!1;this.target=null}TintInterval.prototype.start=function(a,b){a="undefined"===typeof a?0:a;b="undefined"===typeof b?0:b;0!=a&&(this.m_timeDuration=a);0!=b&&(this.m_timeFrecuency=b);this.m_start=!0;this.m_timeFrecuencyElapse=this.m_timeElapse=0;this.change()};
TintInterval.prototype.stop=function(){if(this.m_start){if(this.onFinish&&this.target)this.target[this.onFinish]();this.m_start=!1;this.m_indexColor=0;this.change()}};TintInterval.prototype.setColors=function(a){this.m_colors=a};TintInterval.prototype.setClip=function(a){this.m_clip=a};
TintInterval.prototype.update=function(a){if(this.m_start&&(this.m_timeElapse+=a,this.m_timeFrecuencyElapse+=a,this.m_timeFrecuencyElapse>=this.m_timeFrecuency&&(this.change(),this.m_timeFrecuencyElapse=0),this.m_timeElapse>=this.m_timeDuration&&(this.m_start=!1,this.m_indexColor=0,this.change(),this.onFinish&&this.target)))this.target[this.onFinish]()};TintInterval.prototype.change=function(){this.m_indexColor++;this.m_indexColor>=this.m_colors.length&&(this.m_indexColor=0)};
TintInterval.prototype.free=function(){this.target=this.m_colors=this.m_clip=this.onFinish=null};function SInterval(a,b,c,d,e,f,g){"undefined"===typeof d&&(d=1);"undefined"===typeof f&&(f=!1);this.m_timeElapsed=0;this.m_timeToTrigger=c;this.m_initLoops=this.m_loop=d;this.m_stopped=f;this.m_isOver=!1;this.m_caller=a;this.m_params=e;this.m_onEndCallback=b;this.m_onLoopCallback=g}
SInterval.prototype.reset=function(a){a="undefined"===typeof a?-1:a;0<a&&(this.m_timeToTrigger=a);this.m_timeElapsed=0;this.m_loop=this.m_initLoops;this.m_stopped=this.m_isOver=!1};SInterval.prototype.stop=function(){this.m_stopped=!0};SInterval.prototype.resume=function(){this.m_stopped=!1};
SInterval.prototype.update=function(a){if(!this.m_stopped&&!this.m_isOver&&(this.m_timeElapsed+=a,this.m_timeElapsed>=this.m_timeToTrigger))if(this.m_timeElapsed=0,--this.m_loop,0>=this.m_loop){if(this.m_isOver=!0,this.m_onEndCallback)if(this.m_params)this.m_caller[this.m_onEndCallback](this.m_params);else this.m_caller[this.m_onEndCallback]()}else if(this.m_onLoopCallback)if(this.m_params)this.m_caller[this.m_onLoopCallback](this.m_params);else this.m_caller[this.m_onLoopCallback]()};
SInterval.prototype.free=function(){this.m_caller=null};function SPoint(a,b){this.x="undefined"===typeof a?0:a;this.y="undefined"===typeof b?0:b}SPoint.prototype.distanceTo=function(a,b){return Math.sqrt((a-this.x)*(a-this.x)+(b-this.y)*(b-this.y))};
function Movement(a,b,c,d,e){this.m_x=a;this.m_y=b;this.m_initX=this.m_x;this.m_initY=this.m_y;this.m_speed=this.m_targetY=this.m_targetX=0;this.m_isPaused=!1;this.m_isLoop="undefined"===typeof d?!1:d;this.m_isReversible="undefined"===typeof e?!1:e;this.m_isAwaitingDelete=!1;this.m_state=Movement.ST_INIT;this.m_typeMovement=Movement.TYPE_DEFAULT;this.setSpeed(c);this.m_cycleCallback=this.m_endCallback=this.m_callerObject=null}
Movement.prototype.free=function(){this.m_callerObject=this.m_cycleCallback=this.m_endCallback=null};Movement.TYPE_DEFAULT=0;Movement.TYPE_CIRCLE=1;Movement.TYPE_LINEAR=2;Movement.TYPE_PARAMETRIC_PARABOLIC=3;Movement.MIN_SPEED=1E-5;Movement.DEFAULT_SPEED=1;Movement.ST_INDEF=-1;Movement.ST_INIT=0;Movement.ST_MOVEMENT=1;Movement.ST_PAUSED=2;Movement.ST_END=3;Movement.prototype.getX=function(){return this.m_x};Movement.prototype.getY=function(){return this.m_y};Movement.prototype.getSpeed=function(){return this.m_speed};
Movement.prototype.setSpeed=function(a){a>Movement.MIN_SPEED?this.m_speed=a:(Application.error("setSpeed: "+a),this.m_speed=Movement.DEFAULT_SPEED)};Movement.prototype.type=function(){return this.m_typeMovement};Movement.prototype.targetX=function(){return this.m_targetX};Movement.prototype.targetY=function(){return this.m_targetY};Movement.prototype.isAwaitingDelete=function(){return this.m_isAwaitingDelete};
Movement.prototype.setAwaitingToDelete=function(a){if(this.m_isAwaitingDelete=a)this.m_state=Movement.ST_INDEF};Movement.prototype.isPaused=function(){return this.m_isPaused};Movement.prototype.setPause=function(a){this.m_isPaused=a};Movement.prototype.setCallbacks=function(a,b,c){this.m_callerObject=a;this.m_endCallback=b;this.m_cycleCallback=c};
Movement.prototype.resetPosition=function(a,b){this.m_state===Movement.ST_MOVEMENT&&Application.warn("Movement::resetPosition() - The movement is in progres...");this.m_isPaused&&Application.warn("Movement::resetPosition() - The movement is paused...");this.m_x=a;this.m_y=b};Movement.prototype.cancelMotion=function(){this.m_state=Movement.ST_END};Movement.prototype.gotoPosition=function(a,b,c){this.m_targetX=a;this.m_targetY=b;"undefined"!==typeof c&&0<c&&(this.m_speed=c)};
Movement.prototype.onEndMovement=function(){this.m_state=Movement.ST_END;this.m_callerObject&&this.m_endCallback&&this.m_endCallback.call(this.m_callerObject,this)};Movement.prototype.onCycleEnd=function(){this.m_callerObject&&this.m_cycleCallback&&this.m_cycleCallback.call(this.m_callerObject,this)};Movement.prototype.update=function(a){};
function LinearMovement(a,b,c,d,e){Movement.call(this,a,b,c,d,e);this.m_vy=this.m_vx=this.m_angle=0;this.m_toFront=!0;this.m_currentTargetY=this.m_currentTargetX=0;this.m_motionLimit=new Rectangle;this.m_typeMovement=Movement.TYPE_LINEAR}Application.subclass(LinearMovement,Movement);LinearMovement.prototype.free=function(){this.m_motionLimit=null;Movement.prototype.free.call(this)};LinearMovement.prototype.getAngle=function(){return this.m_angle};LinearMovement.prototype.getLinearVelocityX=function(){return this.m_vx};
LinearMovement.prototype.getLinearVelocityY=function(){return this.m_vy};LinearMovement.prototype.resetPosition=function(a,b){Movement.prototype.resetPosition.call(this,a,b);this.m_initX=a;this.m_initY=b};LinearMovement.prototype.settingMotionLimit=function(a,b,c,d){this.m_motionLimit.x=0<=c?a:a+c;this.m_motionLimit.y=0<=d?b:b+d;this.m_motionLimit.w=0<=c?c:-c;this.m_motionLimit.h=0<=d?d:-d};
LinearMovement.prototype.gotoPosition=function(a,b,c){Movement.prototype.gotoPosition.call(this,a,b,c);this.m_currentTargetX=this.m_targetX;this.m_currentTargetY=this.m_targetY;a=this.m_targetX-this.m_x;b=this.m_targetY-this.m_y;if(0===a&&0===b)this.onEndMovement();else this.settingMotionLimit(this.m_x,this.m_y,a,b),c=Math.sqrt(a*a+b*b),this.m_vx=a/c*this.m_speed,this.m_vy=b/c*this.m_speed,this.m_angle=Math.atan2(b,a),this.m_state=Movement.ST_MOVEMENT};
LinearMovement.prototype.gotoRadialPoint=function(a,b,c){c="undefined"!==typeof c?c:0;0>a&&(Application.error("LinearMovement::gotoRadialPoint() - distance: "+a),a*=-1);if(0===a)this.onEndMovement();else{this.m_angle=b;b=a*Math.cos(this.m_angle);var d=a*Math.sin(this.m_angle);this.settingMotionLimit(this.m_x,this.m_y,b,d);0<c&&(this.m_speed=c);this.m_vx=b/a*this.m_speed;this.m_vy=d/a*this.m_speed;this.m_currentTargetX=this.m_targetX=this.m_x+b;this.m_currentTargetY=this.m_targetY=this.m_y+d;this.m_state=
Movement.ST_MOVEMENT}};LinearMovement.prototype.simulateUpdate=function(a){var b=null;this.m_state===Movement.ST_MOVEMENT&&(b=new Vector2D(this.m_vx*a,this.m_vy*a));return b};
LinearMovement.prototype.update=function(a){if(this.m_state===Movement.ST_MOVEMENT&&!this.m_isPaused&&(this.m_x+=this.m_vx*a,this.m_y+=this.m_vy*a,this.m_x<this.m_motionLimit.left()||this.m_x>this.m_motionLimit.right()||this.m_y<this.m_motionLimit.top()||this.m_y>this.m_motionLimit.bottom()))if(this.m_x=this.m_currentTargetX,this.m_y=this.m_currentTargetY,this.m_isLoop)this.m_isReversible?(this.m_toFront?(this.m_currentTargetX=this.m_initX,this.m_currentTargetY=this.m_initY):(this.m_currentTargetX=
this.m_targetX,this.m_currentTargetY=this.m_targetY),this.m_toFront=!this.m_toFront,this.m_vx*=-1,this.m_vy*=-1):(this.m_x=this.m_initX,this.m_y=this.m_initY),this.onCycleEnd();else this.onEndMovement()};function CircularMovement(a,b,c,d,e){Movement.call(this,a,b,c,d,e);this.m_currentRadiansDisplaced=this.m_radiansToDisplace=this.m_initRandians=0;this.m_factorDirection=1;this.m_angularSpeed=this.m_radio=this.m_centroidY=this.m_centroidX=0;this.m_typeMovement=Movement.TYPE_CIRCLE}
Application.subclass(CircularMovement,Movement);CircularMovement.prototype.gotoPosition=function(a,b,c){Movement.prototype.gotoPosition.call(this,a,b,c);this.startMovement(.5*(this.m_x+this.m_targetX),.5*(this.m_y+this.m_targetY),270)};
CircularMovement.prototype.startMovement=function(a,b,c){this.m_centroidX=a;this.m_centroidY=b;a=this.m_x-this.m_centroidX;b=-this.m_y+this.m_centroidY;this.m_radio=Math.sqrt(a*a+b*b);if(1>=this.m_radio)Application.error("CircularMovement::startMovement() - Radio very small: "+this.m_radio),this.onEndMovement();else if(this.m_factorDirection=0>c?-1:1,0==c)this.onEndMovement();else 0>c&&(c*=-1),this.m_initRandians=Math.atan2(b,a),this.m_radiansToDisplace=c/180*Math.PI,this.m_currentRadiansDisplaced=
0,this.m_angularSpeed=this.m_radiansToDisplace/(c/360*Math.PI*this.m_radio*2/this.m_speed),c=this.m_initRandians+this.m_radiansToDisplace*this.m_factorDirection,this.m_targetX=this.m_centroidX+this.m_radio*Math.cos(c),this.m_targetY=this.m_centroidY-this.m_radio*Math.sin(c),this.m_state=Movement.ST_MOVEMENT};
CircularMovement.prototype.startMovement2=function(a,b,c){this.m_radio=a;if(1>=this.m_radio)Application.error("CircularMovement::startMovement2() - Radio very small: "+this.m_radio),this.onEndMovement();else if(this.m_factorDirection=0>c?-1:1,0==c)this.onEndMovement();else 0>c&&(c*=-1),this.m_radiansToDisplace=c/180*Math.PI,this.m_angularSpeed=this.m_radiansToDisplace/(c/360*Math.PI*this.m_radio*2/this.m_speed),this.m_initRandians=b/180*Math.PI,this.m_currentRadiansDisplaced=0,this.m_centroidX=this.m_x-
this.m_radio*Math.cos(this.m_initRandians),this.m_centroidY=this.m_y+this.m_radio*Math.sin(this.m_initRandians),a=this.m_initRandians+this.m_radiansToDisplace*this.m_factorDirection,this.m_targetX=this.m_centroidX+this.m_radio*Math.cos(a),this.m_targetY=this.m_centroidY-this.m_radio*Math.sin(a),this.m_state=Movement.ST_MOVEMENT};
CircularMovement.prototype.update=function(a){if(this.m_state===Movement.ST_MOVEMENT&&!this.m_isPaused&&(this.m_currentRadiansDisplaced+=this.m_angularSpeed*a,this.m_currentRadiansDisplaced>this.m_radiansToDisplace&&(this.m_currentRadiansDisplaced=this.m_radiansToDisplace),a=this.m_initRandians+this.m_currentRadiansDisplaced*this.m_factorDirection,this.m_x=this.m_centroidX+this.m_radio*Math.cos(a),this.m_y=this.m_centroidY-this.m_radio*Math.sin(a),this.m_currentRadiansDisplaced==this.m_radiansToDisplace))if(this.m_isLoop)this.m_currentRadiansDisplaced=
0,this.m_isReversible&&(this.m_factorDirection*=-1,this.m_initRandians=a),this.onCycleEnd();else this.onEndMovement()};function MotionController(a,b,c){this.m_currentMovement=null;this.m_currentIndexMovement=0;this.m_advanceFactor=1;this.m_x=a;this.m_y=b;this.m_speed=c.speed;this.m_motionData=c;this.m_isLoop=this.m_motionData.isLoop;this.m_isReversible=this.m_motionData.isReverse;this.m_isStarted=!1;this.m_movements=[]}
MotionController.prototype.free=function(){this.m_motionData.free();this.m_currentMovement=this.m_motionData=null;for(var a=this.m_movements.length-1;0<=a;)this.m_movements[a].free(),this.m_movements[a]=null,--a;this.m_movements=null};MotionController.prototype.isStarted=function(){return this.m_isStarted};MotionController.prototype.startMotion=function(){this.m_isStarted||(this.m_isStarted=!0,this.createMovements(),this.m_currentIndexMovement=-1,this.gotoNextMovement())};
MotionController.CIRCLE_POLAR="cp";MotionController.CIRCLE_CARTESIAN="cc";MotionController.LINEAR_POLAR="lp";MotionController.LINEAR_CARTESIAN="lc";MotionController.RELATIVE_LINEAR_CARTESIAN="rlc";MotionController.prototype.getX=function(){return this.m_x};MotionController.prototype.getY=function(){return this.m_y};
MotionController.prototype.createMovements=function(){var a=null;for(var b=this.m_x,c=this.m_y,d,e=0;e<this.m_motionData.motionParams.length;)d=this.m_motionData.motionParams[e],d[0]==MotionController.CIRCLE_POLAR?(a=new CircularMovement(b,c,this.m_speed,this.m_isLoop,this.m_isReversible),a.startMovement2(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3]))):d[0]==MotionController.CIRCLE_CARTESIAN?(a=new CircularMovement(b,c,this.m_speed,this.m_isLoop,this.m_isReversible),a.startMovement(parseFloat(d[1]),
parseFloat(d[2]),parseFloat(d[3]))):d[0]==MotionController.LINEAR_POLAR?(a=new LinearMovement(b,c,this.m_speed,this.m_isLoop,this.m_isReversible),a.gotoRadialPoint(parseFloat(d[1]),parseFloat(d[2]))):d[0]==MotionController.LINEAR_CARTESIAN?(a=new LinearMovement(b,c,this.m_speed,this.m_isLoop,this.m_isReversible),a.gotoPosition(parseFloat(d[1]),parseFloat(d[2]))):d[0]==MotionController.RELATIVE_LINEAR_CARTESIAN&&(a=new LinearMovement(b,c,this.m_speed,this.m_isLoop,this.m_isReversible),a.gotoPosition(parseFloat(d[1])+
b,parseFloat(d[2])+c)),a&&(this.m_movements.push(a),a.setPause(!0),a.setCallbacks(this,this.onEndMovement,this.onCycleMovement),b=a.targetX(),c=a.targetY()),++e};
MotionController.prototype.gotoNextMovement=function(){this.m_currentIndexMovement+=this.m_advanceFactor;0<=this.m_currentIndexMovement&&this.m_currentIndexMovement<this.m_movements.length?(this.m_currentMovement=this.m_movements[this.m_currentIndexMovement],this.m_currentMovement.setPause(!1)):this.m_isLoop&&(this.m_isReversible?this.m_advanceFactor*=-1:this.m_currentIndexMovement=-1,this.gotoNextMovement())};
MotionController.prototype.update=function(a){this.m_currentMovement&&(this.m_currentMovement.update(a),this.m_x=this.m_currentMovement.getX(),this.m_y=this.m_currentMovement.getY())};MotionController.prototype.onEndMovement=function(a){};MotionController.prototype.onCycleMovement=function(a){this.m_currentMovement!=a?Application.error("MotionController::onCycleMovement()"):(a.setPause(!0),this.gotoNextMovement())};
function PendularMovement(a,b,c,d,e,f,g){this.m_alpha=this.m_angle=0;this.m_x=c;this.m_y=d;this.m_dy=this.m_dx=this.m_len=0;this.m_gravity=f;this.m_time=this.m_w=0;this.m_pivotX=a;this.m_pivotY=b;this.m_longitudeMax=g;this.m_beta=e;this.m_velocity=0;this.init()}PendularMovement.prototype.getX=function(){return this.m_x};PendularMovement.prototype.getY=function(){return this.m_y};PendularMovement.prototype.getAngle=function(){return this.m_angle};PendularMovement.prototype.getVelocity=function(){return this.m_velocity};
PendularMovement.prototype.getMaxLongitude=function(){return this.m_longitudeMax};
PendularMovement.prototype.init=function(){this.m_dx=this.m_x-this.m_pivotX;this.m_dy=this.m_y-this.m_pivotY;this.m_len=Math.sqrt(this.m_dx*this.m_dx+this.m_dy*this.m_dy);this.m_len<PendularMovement.LONGITUDE_MIN&&(this.m_len=PendularMovement.LONGITUDE_MIN);this.m_angle=Math.atan2(this.m_dx,this.m_dy);this.m_alpha=this.m_beta;this.m_w=2*Math.PI/this.period();this.m_time=Math.acos(this.m_angle/this.m_alpha)/this.m_w*180/Math.PI};
PendularMovement.prototype.update=function(a){this.m_len+=PendularMovement.INCREMENT_LONGITUDE;this.m_len>this.m_longitudeMax&&(this.m_len=this.m_longitudeMax);this.m_w=2*Math.PI/this.period();this.m_angle=this.m_alpha*Math.cos(this.m_w*this.m_time*Math.PI/180);this.m_velocity=-this.m_w*this.m_alpha*Math.sin(this.m_w*this.m_time*Math.PI/180);this.m_x=this.m_len*Math.sin(this.m_angle)+this.m_pivotX;this.m_y=this.m_len*Math.cos(this.m_angle)+this.m_pivotY;this.m_time+=PendularMovement.DT};
PendularMovement.prototype.fastPow=function(a,b){return 0==b?1:0==b%2?(a=this.fastPow(a,.5*b),a*a):a*this.fastPow(a,b-1)};PendularMovement.prototype.factorial=function(a){for(var b=1,c=1;c<=a;)b*=c,c++;return b};PendularMovement.prototype.period=function(){for(var a=0,b=0;b<=PendularMovement.N;)a+=this.fastPow(this.factorial(2*b)/this.fastPow(this.fastPow(2,b)*this.factorial(b),2),2)*this.fastPow(Math.sin(this.m_alpha/2),2*b),b++;return 2*Math.PI*Math.sqrt(this.m_len/this.m_gravity)*a};
PendularMovement.DT=4;PendularMovement.N=30;PendularMovement.LONGITUDE_MIN=50;PendularMovement.INCREMENT_LONGITUDE=.9;function ParametricParabolicMovement(a,b,c,d){Movement.call(this,a,b,d,!1,!1);this.m_gravity=c;this.m_currentTime=0;this.m_finalTime=ParametricParabolicMovement.STD_FINAL_TIME;this.m_vy=this.m_vx=0;this.m_typeMovement=Movement.TYPE_PARAMETRIC_PARABOLIC}Application.subclass(ParametricParabolicMovement,Movement);ParametricParabolicMovement.STD_FINAL_TIME=100;
ParametricParabolicMovement.prototype.gotoPosition=function(a,b,c){Movement.prototype.gotoPosition.call(this,a,b,c);a=this.m_targetY-this.m_y;this.m_vx=(this.m_targetX-this.m_x)/this.m_finalTime;this.m_vy=(a-this.m_gravity*this.m_finalTime*this.m_finalTime/2)/this.m_finalTime;this.m_state=Movement.ST_MOVEMENT};ParametricParabolicMovement.prototype.vX=function(){return this.m_vx};
ParametricParabolicMovement.prototype.update=function(a){this.m_state!==Movement.ST_MOVEMENT||this.m_isPaused||(this.m_x=Math.floor(this.m_initX+this.m_currentTime*this.m_vx),this.m_y=Math.floor(this.m_initY+this.m_currentTime*this.m_vy+this.m_gravity*this.m_currentTime*this.m_currentTime/2),this.m_currentTime<this.m_finalTime?this.m_currentTime+=this.m_speed*a*2:(this.m_currentTime=this.m_finalTime,this.m_x=this.m_targetX,this.m_y=this.m_targetY,this.onEndMovement()))};
function GeometricUtils(){}GeometricUtils.intersectLines=function(a,b,c,d){var e=b.minus(a),f=b.minus(c),g=b.minus(d);f=e.product(f);e=e.product(g);if(0==f||0==e||0<f*e)return null;g=Math.abs(GeometricUtils.triarea(a,b,c));f=Math.abs(GeometricUtils.triarea(a,b,d));e=(c.x*f+d.x*g)/(g+f);c=(c.y*f+d.y*g)/(g+f);return 0>(a.x-e)*(e-b.x)||0>(a.y-c)*(c-b.y)?null:new Vector2D(e,c)};
GeometricUtils.intersectLinePolygon=function(a,b,c){for(var d=[],e=0;e<c.length;e++){var f=GeometricUtils.intersectLines(a,b,c[e],c[(e+1)%c.length]);f&&d.push(f)}return d};GeometricUtils.intersectLinePolygon2=function(a,b,c){for(var d=[],e=[],f=0;f<c.length;f++){var g=GeometricUtils.intersectLines(a,b,c[f],c[(f+1)%c.length]);g&&(d.push(g),e.push(f))}return{points:d,index:e}};GeometricUtils.trap=function(a,b){return.5*(b.x-a.x)*(b.y+a.y)};
GeometricUtils.triarea=function(a,b,c){return GeometricUtils.trap(a,b)+GeometricUtils.trap(b,c)+GeometricUtils.trap(c,a)};function PathFinding(){this.m_listOpen=[];this.m_listClose=[];this.m_mapOpen=[]}PathFinding.ALLOW_DIAGONAL=!0;PathFinding.ALLOW_DIAGONAL_CORNERING=!1;PathFinding.getPath=function(a,b,c,d,e,f){return(new PathFinding).getPathPrivate(a,b,c,d,e,f)};
PathFinding.prototype.getPathPrivate=function(a,b,c,d,e,f){b=Math.floor(b);c=Math.floor(c);var g=this.getSelectOpen(b,c);this.addOpenList(g);for(var h=a[0].length,k=a.length,l,m,n,p,q,r,t,u;0<this.m_listOpen.length&&!this.isInCloseListById(d,e);){n=g.i-1;q=g.i+2;r=g.j-1;for(t=g.j+2;n<q;n++)for(p=r;p<t;p++)n<k&&-1<n&&p<h&&-1<p&&!this.isInCloseListById(n,p)&&(PathFinding.ALLOW_DIAGONAL||n===g.i||p===g.j)&&(PathFinding.ALLOW_DIAGONAL_CORNERING||n===g.i||p===g.j||a[n][g.j]==f&&a[g.i][p]===f)&&a[n][p]===
f&&(m=this.isInOpenList(n,p),l=n==g.i||p==g.j?10:14,l=g.g+l,null===m?(u=new clsNode(g,n,p),m=10*(Math.abs(n-d)+Math.abs(p-e)),u.g=l,u.h=m,u.f=l+m,this.addOpenList(u)):l<m.g&&(m.g=l,m.f=m.h+m.g,m.parent=g));this.removeOpenList(g);this.addCloseList(g);g=this.getSelectOpen(b,c)}a=null;if(this.isInCloseListById(d,e)){a=[];for(d=this.m_listClose[this.m_listClose.length-1];null!==d;)a.push(d),d=d.parent;a=a.reverse()}return a};
PathFinding.prototype.getSelectOpen=function(a,b){var c=this.m_listOpen.length;if(0<c){a=this.m_listOpen[c-1];for(var d=0;d<c;d++)b=this.m_listOpen[d],b.f<a.f&&(a=b)}else a=new clsNode(null,a,b);return a};PathFinding.prototype.isInCloseListById=function(a,b){return"undefined"!==typeof this.m_mapOpen[a]&&null!==this.m_mapOpen[a]&&"undefined"!==typeof this.m_mapOpen[a][b]&&null!==this.m_mapOpen[a][b]?this.m_mapOpen[a][b].isClose:!1};PathFinding.prototype.isInCloseList=function(a){return a.isClose};
PathFinding.prototype.addCloseList=function(a){a.isClose=!0;this.m_listClose.push(a)};PathFinding.prototype.isInOpenList=function(a,b){return"undefined"!==typeof this.m_mapOpen[a]&&null!==this.m_mapOpen[a]&&"undefined"!==typeof this.m_mapOpen[a][b]&&null!==this.m_mapOpen[a][b]?this.m_mapOpen[a][b]:null};PathFinding.prototype.removeOpenList=function(a){var b=this.m_listOpen.indexOf(a);-1<b&&this.m_listOpen.splice(b,1);a.isOpen=!1};
PathFinding.prototype.addOpenList=function(a){a.isOpen=!0;this.m_listOpen.push(a);this.m_mapOpen[a.i]||(this.m_mapOpen[a.i]=[]);this.m_mapOpen[a.i][a.j]=a};function clsNode(a,b,c){this.f=this.h=this.g=0;this.i=b;this.j=c;this.isClose=this.isOpen=!1;this.parent=a}
function JumpControl(a,b){a="undefined"!==typeof a?a:JumpControl.IMPULSE;this.m_gravity=b="undefined"!==typeof b?b:JumpControl.GRAVITY;this.m_factorGravity=1;this.m_vo=a;this.m_time=this.m_nextZ=this.m_z=0;this.m_initVelocity=this.m_vo;this.m_initPosition=0;this.m_isPaused=this.m_isJump=!1;this.m_checkMaxHeight=!0;this.onMaxHeightReachedCallback=this.onCompleteJumpCallback=this.targetCallback=null}
JumpControl.prototype.free=function(){this.onMaxHeightReachedCallback=this.onCompleteJumpCallback=this.targetCallback=null};JumpControl.GRAVITY=9.8;JumpControl.IMPULSE=-45;JumpControl.prototype.setHeightInit=function(a){this.m_initPosition=a;this.m_time=this.m_vo=0;this.m_isJump=!0};JumpControl.prototype.cancel=function(){this.m_isJump=!1;this.m_z=this.m_vo=this.m_time=this.m_initPosition=0};JumpControl.prototype.getCurrentHeight=function(){return this.m_z};JumpControl.prototype.getElapseTime=function(){return this.m_time};
JumpControl.prototype.getGravity=function(){return this.m_gravity};JumpControl.prototype.setGravity=function(a){this.m_gravity=a};JumpControl.prototype.getIsJump=function(){return this.m_isJump};JumpControl.prototype.getFactorGravity=function(){return this.m_factorGravity};JumpControl.prototype.setFactorGravity=function(a){this.m_factorGravity=a};JumpControl.prototype.getPaused=function(){return this.m_isPaused};JumpControl.prototype.setPaused=function(a){this.m_isPaused=a};
JumpControl.prototype.init=function(a){this.m_nextZ=this.m_z="undefined"!==typeof a?a:0;this.m_time=0;this.m_checkMaxHeight=this.m_isJump=!0};JumpControl.prototype.getInitVelocity=function(){return this.m_vo};JumpControl.prototype.setInitVelocity=function(a){this.m_initVelocity=this.m_vo=a};JumpControl.prototype.applyForceY=function(a){if(!this.m_isJump)return!1;this.m_initPosition=this.m_nextZ;this.m_vo=a;this.m_time=0;return!0};
JumpControl.prototype.applyImpulse=function(a){this.m_initPosition=this.m_z;this.m_vo=a;this.m_time=0;this.m_isJump=!0};JumpControl.prototype.completeJump=function(){this.m_vo=this.m_initVelocity;this.m_z=this.m_initPosition=0;this.m_isJump=!1;if(this.targetCallback&&this.onCompleteJumpCallback)this.targetCallback[this.onCompleteJumpCallback](this)};
JumpControl.prototype.update=function(a){if(!this.m_isPaused&&this.m_isJump)if(this.m_time+=.011*a,this.m_nextZ=this.m_vo*this.m_time+this.m_gravity*this.m_factorGravity*this.m_time*this.m_time*.5+this.m_initPosition,0>=this.m_nextZ){if(this.m_checkMaxHeight&&this.m_nextZ>this.m_z&&(this.m_checkMaxHeight=!1,this.targetCallback&&this.onMaxHeightReachedCallback))this.targetCallback[this.onMaxHeightReachedCallback](this);this.m_z=this.m_nextZ}else this.completeJump()};
function Displace(a,b){this.position=new Vector2D(a,b);this.positionTarget=new Vector2D(0,0);this.angle=this.speedFactor=this.speedMagnitude=this.accelerationMagnitude=0;this.targetCallback=this.onEndDisplaceCallback=null;this.m_timeElapse=0;this.m_positionStart=this.position.clone();this.m_acceleration=new Vector2D(0,0);this.m_speedInitial=new Vector2D(0,0);this.m_totalDisplacement=0;this.m_onMove=!1}
Displace.prototype.currentSpeed=function(){var a=new Vector2D(0,0);a.x=this.m_speedInitial.x*this.speedFactor+this.m_acceleration.x*this.m_timeElapse;a.y=this.m_speedInitial.y*this.speedFactor+this.m_acceleration.y*this.m_timeElapse;return a.length()};Displace.prototype.toLeft=function(){var a=this.angle;for(a*=180/Math.PI;0>a;)a+=360;a%=360;return 90<a&&270>a};Displace.prototype.getX=function(){return this.position.x};Displace.prototype.getY=function(){return this.position.y};
Displace.prototype.resetPosition=function(a,b){this.position.x=a;this.position.y=b};Displace.prototype.updateSpeed=function(a){this.speedMagnitude=a;this.m_speedInitial.setVector(this.speedMagnitude,this.angle)};
Displace.prototype.updateAcceleration=function(a){this.m_timeElapse=0;this.m_speedInitial.x=this.m_speedInitial.x*this.speedFactor+this.m_acceleration.x*this.m_timeElapse;this.m_speedInitial.y=this.m_speedInitial.y*this.speedFactor+this.m_acceleration.y*this.m_timeElapse;this.m_positionStart=this.position.clone();this.accelerationMagnitude=a;this.m_acceleration.setVector(this.accelerationMagnitude,this.angle)};
Displace.prototype.cancel=function(){this.m_positionStart=this.position.clone();this.m_speedInitial.x=0;this.m_speedInitial.y=0;this.m_acceleration.x=0;this.m_timeElapse=this.m_acceleration.y=0;this.speedFactor=1;this.m_onMove=!1;if(this.onEndDisplaceCallback&&this.targetCallback)this.targetCallback[this.onEndDisplaceCallback]()};
Displace.prototype.gotoPosition=function(a,b,c,d,e){this.accelerationMagnitude="undefined"===typeof d?0:d;this.speedMagnitude="undefined"===typeof c?0:c;this.speedFactor="undefined"===typeof e?1:e;this.m_timeElapse=0;this.m_positionStart=this.position.clone();this.positionTarget.x=a;this.positionTarget.y=b;this.angle=this.positionTarget.minus(this.m_positionStart).angle();this.m_speedInitial.setVector(this.speedMagnitude,this.angle);this.m_acceleration.setVector(this.accelerationMagnitude,this.angle);
this.m_totalDisplacement=this.positionTarget.minus(this.m_positionStart).length();this.m_onMove=!0};
Displace.prototype.gotoDirection=function(a,b,c,d,e){this.accelerationMagnitude="undefined"===typeof d?0:d;this.speedMagnitude="undefined"===typeof c?0:c;this.speedFactor="undefined"===typeof e?1:e;this.angle=b;this.m_timeElapse=0;this.m_positionStart=this.position.clone();this.m_speedInitial.setVector(this.speedMagnitude,this.angle);this.m_acceleration.setVector(this.accelerationMagnitude,this.angle);this.m_totalDisplacement=a;this.m_onMove=!0;this.positionTarget.x=this.m_positionStart.x+a*Math.cos(b);
this.positionTarget.y=this.m_positionStart.y+a*Math.sin(b)};Displace.prototype.estimatePositionAfterTime=function(a){a*=.001;var b=new Point(0,0);b.x=this.position.x+this.m_speedInitial.x*a*this.speedFactor+.5*this.m_acceleration.x*a*a;b.y=this.position.y+this.m_speedInitial.y*a*this.speedFactor+.5*this.m_acceleration.y*a*a;return b};
Displace.prototype.onBounce=function(a){var b=0;a==Displace.DIRECTION_LEFT&&(b=180);this.m_timeElapse=0;this.m_positionStart=this.position.clone();this.angle=(b+Common.random(-Displace.BOUNCE_ANGLE_VAR,Displace.BOUNCE_ANGLE_VAR))*(Math.PI/180);this.m_speedInitial.setVector(this.speedMagnitude*Displace.ENERGY_AFTER_BOUNCE,this.angle);this.m_acceleration.setVector(this.accelerationMagnitude,this.angle)};
Displace.prototype.update=function(a){if(0!=this.m_onMove&&(this.m_timeElapse+=.001*a,this.position.x=this.m_positionStart.x+this.m_speedInitial.x*this.m_timeElapse*this.speedFactor+.5*this.m_acceleration.x*this.m_timeElapse*this.m_timeElapse,this.position.y=this.m_positionStart.y+this.m_speedInitial.y*this.m_timeElapse*this.speedFactor+.5*this.m_acceleration.y*this.m_timeElapse*this.m_timeElapse,a=new Vector2D(0,0),a.x=this.m_speedInitial.x*this.speedFactor+this.m_acceleration.x*this.m_timeElapse,
a.y=this.m_speedInitial.y*this.speedFactor+this.m_acceleration.y*this.m_timeElapse,this.m_positionStart.minus(this.position).length()>=this.m_totalDisplacement||Math.abs(a.x)<Displace.NO_SPEED_VALUE&&Math.abs(a.y)<Displace.NO_SPEED_VALUE)){if(this.onEndDisplaceCallback&&this.targetCallback)this.targetCallback[this.onEndDisplaceCallback]();this.m_onMove=!1}};Displace.prototype.free=function(){this.m_speedInitial=this.m_acceleration=this.m_positionOrigin=this.position=null};
Displace.DIRECTION_RIGHT=1;Displace.DIRECTION_LEFT=-1;Displace.BOUNCE_ANGLE_VAR=15;Displace.ENERGY_AFTER_BOUNCE=.6;Displace.NO_SPEED_VALUE=5;function SlidingBackgrounds(a,b){this.m_canvas=a;this.m_file=window.slidingbackground.slidingbackground;this.m_level=b;this.m_objects=[];this.m_objectsX=[];this.m_objectsY=[];this.m_objectsSpeed=[];this.m_objectsResetDistance=[];this.m_objectsVertical=[];this.m_objectsBackground=[];this.init()}
SlidingBackgrounds.prototype.init=function(){for(var a=0;a<this.m_file.length;a++)this.m_file[a].Level===this.m_level&&(this.m_objects.push(Application.instance.getClip(this.m_file[a].ClipName)),this.m_objectsX.push(this.m_file[a].StartX),this.m_objectsY.push(this.m_file[a].StartY),this.m_objectsBackground.push(1===this.m_file[a].Background),this.m_objectsVertical.push(1===this.m_file[a].Vertical),this.m_objectsSpeed.push(this.m_objectsVertical[this.m_objects.length-1]?this.m_file[a].SpeedY:this.m_file[a].SpeedX),
this.m_objectsResetDistance.push(this.m_objectsVertical[this.m_objects.length-1]?this.m_file[a].ResetDistanceY:this.m_file[a].ResetDistanceX),this.m_objects[this.m_objects.length-1].setPosition(this.m_objectsX[this.m_objects.length-1],this.m_objectsY[this.m_objects.length-1]),this.m_canvas.addChild(this.m_objects[this.m_objects.length-1]))};
SlidingBackgrounds.prototype.update=function(a){for(var b=0;b<this.m_objects.length;b++)this.m_objectsVertical[b]?(this.m_objectsY[b]+=a*this.m_objectsSpeed[b],this.m_objectsY[b]+=0>=this.m_objectsY[b]+(this.m_objectsBackground[b]?1:.5)*Application.APP_HEIGHT?(Application.APP_HEIGHT-2)*this.m_objectsResetDistance[b]:0):(this.m_objectsX[b]+=a*this.m_objectsSpeed[b],this.m_objectsX[b]+=0>=this.m_objectsX[b]+(this.m_objectsBackground[b]?1:.5)*Application.APP_WIDTH?(Application.APP_WIDTH-2)*this.m_objectsResetDistance[b]:
0),this.m_objects[b].update(a),this.m_objects[b].setPosition(this.m_objectsX[b],this.m_objectsY[b])};SlidingBackgrounds.prototype.free=function(){for(var a=0;a<this.m_objects.length;a++)this.m_objects[a].free(),this.m_objects[a]=null;this.m_file=this.m_canvas=this.m_objectsBackground=this.m_objectsVertical=this.m_objectsResetDistance=this.m_objectsSpeed=this.m_objectsY=this.m_objectsX=this.m_objects=null};
function ValueInterpolation(a,b,c,d){this.isAwaitingDelete=this.stop=!1;this.dataInterpolation=null;this.isDisposed=this.isCreatedByPool=!1;this.m_timeEnd=this.m_timeInit=this.m_currentTime=0;this.m_startCalculation=!1;this.m_finalValue=this.m_initValue=this.m_currentValue=this.m_duration=0;this.m_callback=this.m_caller=null}
ValueInterpolation.prototype.reset=function(a,b,c,d,e,f,g){d="undefined"!==typeof d?d:0;c="undefined"!==typeof c?c:this.m_duration;this.m_initValue=a;this.m_finalValue=b;this.m_duration=c;this.m_timeInit=d;this.m_timeEnd=d+c;this.dataInterpolation=null;this.isAwaitingDelete=this.stop=!1;this.m_currentTime=0;this.m_startCalculation=0>d?!1:!0;this.m_callback=this.m_caller=null;return this};ValueInterpolation.prototype.onEndInterpolation=function(a,b){this.m_caller=a;this.m_callback=b};
ValueInterpolation.prototype.timeInit=function(){return this.m_timeInit};ValueInterpolation.prototype.timeEnd=function(){return this.m_timeEnd};ValueInterpolation.prototype.value=function(){return this.m_currentValue};ValueInterpolation.prototype.calculateValue=function(a){return 0};
ValueInterpolation.prototype.update=function(a){this.stop||(this.m_startCalculation?(this.m_currentTime+=a,this.m_currentValue=this.calculateValue(this.m_currentTime),this.m_currentTime>=this.m_duration&&(this.m_currentValue=this.m_finalValue,this.stop=!0,null!==this.m_caller&&null!==this.m_callback&&this.m_callback.call(this.m_caller,this))):(this.m_currentTime+=a,this.m_currentTime>=this.m_timeInit&&(this.m_startCalculation=!0,this.m_currentTime=0)))};
ValueInterpolation.prototype.free=function(){this.dataInterpolation=this.m_caller=this.m_callback=null};function LinearInterpolation(a,b,c,d){ValueInterpolation.call(this,a,b,c,d);this.m_rateOfChange=0;this.reset(a,b,c,d)}Application.subclass(LinearInterpolation,ValueInterpolation);LinearInterpolation.freeObject=[];LinearInterpolation.lastCreated=null;
LinearInterpolation.create=function(a,b,c,d){0<LinearInterpolation.freeObject.length?(LinearInterpolation.lastCreated=LinearInterpolation.freeObject.pop(),LinearInterpolation.lastCreated.reset(a,b,c,d,0,0,0)):LinearInterpolation.lastCreated=new LinearInterpolation(a,b,c,d);LinearInterpolation.lastCreated.isCreatedByPool=!0;LinearInterpolation.lastCreated.isDisposed=!1;return LinearInterpolation.lastCreated};
LinearInterpolation.disposeObject=function(a){a.isCreatedByPool&&!a.isDisposed&&(LinearInterpolation.freeObject.push(a),a.isDisposed=!0)};LinearInterpolation.clear=function(){LinearInterpolation.freeObject=[]};LinearInterpolation.prototype.reset=function(a,b,c,d,e,f,g){ValueInterpolation.prototype.reset.call(this,a,b,c,d,e,f,g);this.m_rateOfChange=(b-a)/c;return this};LinearInterpolation.prototype.calculateValue=function(a){return this.m_initValue+a*this.m_rateOfChange};
LinearInterpolation.prototype.free=function(){ValueInterpolation.prototype.free.call(this);LinearInterpolation.disposeObject(this)};function ExponentialInterpolation(a,b,c,d,e){ValueInterpolation.call(this,a,b,c,e);this.m_c2=this.m_c1=this.m_alpha=0;this.reset(a,b,c,e,d)}Application.subclass(ExponentialInterpolation,ValueInterpolation);ExponentialInterpolation.freeObject=[];ExponentialInterpolation.lastCreated=null;
ExponentialInterpolation.create=function(a,b,c,d,e){0<ExponentialInterpolation.freeObject.length?(ExponentialInterpolation.lastCreated=ExponentialInterpolation.freeObject.pop(),ExponentialInterpolation.lastCreated.reset(a,b,c,e,d,0,0)):ExponentialInterpolation.lastCreated=new ExponentialInterpolation(a,b,c,d,e);ExponentialInterpolation.lastCreated.isCreatedByPool=!0;ExponentialInterpolation.lastCreated.isDisposed=!1;return ExponentialInterpolation.lastCreated};
ExponentialInterpolation.disposeObject=function(a){a.isCreatedByPool&&!a.isDisposed&&(a.isDisposed=!0,ExponentialInterpolation.freeObject.push(a))};ExponentialInterpolation.clear=function(){ExponentialInterpolation.freeObject=[]};ExponentialInterpolation.prototype.reset=function(a,b,c,d,e,f,g){ValueInterpolation.prototype.reset.call(this,a,b,c,d,e,f,g);this.m_alpha=1E3*e/c;this.m_c1=(b-a)/(Math.exp(this.m_alpha*this.m_duration*.001)-1);this.m_c2=this.m_initValue-this.m_c1;return this};
ExponentialInterpolation.prototype.calculateValue=function(a){return this.m_c1*Math.exp(this.m_alpha*a*.001)+this.m_c2};ExponentialInterpolation.prototype.free=function(){ValueInterpolation.prototype.free.call(this);ExponentialInterpolation.disposeObject(this)};function ElasticInterpolation(a,b,c,d,e,f){ValueInterpolation.call(this,a,b,c,f);this.m_waves=this.m_overshoot=this.m_zetaConst=this.m_c4=this.m_c3=this.m_c2=this.m_c1=0;this.reset(a,b,c,f,0,d,e)}Application.subclass(ElasticInterpolation,ValueInterpolation);
ElasticInterpolation.MAX_OVERSHOOT=.8;ElasticInterpolation.INVERSE_PI=.3183098862;ElasticInterpolation.freeObject=[];ElasticInterpolation.lastCreated=null;
ElasticInterpolation.create=function(a,b,c,d,e,f){0<ElasticInterpolation.freeObject.length?(ElasticInterpolation.lastCreated=ElasticInterpolation.freeObject.pop(),ElasticInterpolation.lastCreated.reset(a,b,c,f,0,d,e)):ElasticInterpolation.lastCreated=new ElasticInterpolation(a,b,c,d,e,f);ElasticInterpolation.lastCreated.isCreatedByPool=!0;ElasticInterpolation.lastCreated.isDisposed=!1;return ElasticInterpolation.lastCreated};
ElasticInterpolation.disposeObject=function(a){a.isCreatedByPool&&!a.isDisposed&&(a.isDisposed=!0,ElasticInterpolation.freeObject.push(a))};ElasticInterpolation.clear=function(){ElasticInterpolation.freeObject=[]};
ElasticInterpolation.prototype.reset=function(a,b,c,d,e,f,g){ValueInterpolation.prototype.reset.call(this,a,b,c,d,e,f,g);f="undefined"!==typeof f?f:0;g="undefined"!==typeof g?g:0;f>ElasticInterpolation.MAX_OVERSHOOT&&(f=ElasticInterpolation.MAX_OVERSHOOT);this.m_overshoot=f;d=Math.log(f)*ElasticInterpolation.INVERSE_PI;this.m_zetaConst=Math.sqrt(1-1/(d*d+1));this.m_waves=g;d=-Math.atan(Math.sqrt(1-this.m_zetaConst*this.m_zetaConst)/this.m_zetaConst);c=2*Math.PI/(c/(g+d*ElasticInterpolation.INVERSE_PI*
.5+(0>d?1:0)));g=c/Math.sqrt(1-this.m_zetaConst*this.m_zetaConst);this.m_c1=b-a;this.m_c2=-this.m_zetaConst*g;this.m_c3=c;this.m_c4=-this.m_c2/c;return this};ElasticInterpolation.prototype.calculateValue=function(a){return this.m_c1*(1-Math.exp(this.m_c2*a)*(SMath.fastCos(this.m_c3*a)+this.m_c4*SMath.fastSin(this.m_c3*a)))+this.m_initValue};ElasticInterpolation.prototype.free=function(){ValueInterpolation.prototype.free.call(this);ElasticInterpolation.disposeObject(this)};
function SATCollisionDetector(){}
SATCollisionDetector.calculatePolyPolyIntersection=function(a,b){for(var c=[],d,e,f=0;f<a.length;f++)if(e=0===f?-(a[0][0]-a[a.length-1][0])/(a[0][1]-a[a.length-1][1]):-(a[f][0]-a[f-1][0])/(a[f][1]-a[f-1][1]),-1===c.indexOf(e)&&(c.push(e),d=SATCollisionDetector.projectPolygonOntoLine(a,e),e=SATCollisionDetector.projectPolygonOntoLine(b,e),d[0]>e[1]||d[1]<e[0]))return!1;for(f=0;f<b.length;f++)if(e=0===f?-(b[0][0]-b[b.length-1][0])/(b[0][1]-b[b.length-1][1]):-(b[f][0]-b[f-1][0])/(b[f][1]-b[f-1][1]),
-1===c.indexOf(e)&&(c.push(e),d=SATCollisionDetector.projectPolygonOntoLine(a,e),e=SATCollisionDetector.projectPolygonOntoLine(b,e),d[0]>e[1]||d[1]<e[0]))return!1;return!0};SATCollisionDetector.calculatePolyCircleIntersection=function(a,b){};
SATCollisionDetector.projectPolygonOntoLine=function(a,b){for(var c=[],d,e,f=0;f<a.length;f++)Infinity===b||Infinity===b?d=a[f][1]:0===b?d=a[f][0]:(d=-1/b,e=a[f][1]-d*a[f][0],d=e/(b-d)),0===c.length?c.push(d):1===c.length?d>=c[0]?c.push(d):c.unshift(d):d>c[1]?c[1]=d:d<c[0]&&(c[0]=d);return c};
function PhysicsContacListener(a){this.listener=a;this.listener.BeginContact=function(a){var b=a.GetFixtureA().GetBody().GetUserData(),d=a.GetFixtureB().GetBody().GetUserData();null!==b&&b.BeginContact(a.GetFixtureB().GetBody(),a);null!==d&&d.BeginContact(a.GetFixtureA().GetBody(),a)};this.listener.EndContact=function(a){var b=a.GetFixtureA().GetBody().GetUserData(),d=a.GetFixtureB().GetBody().GetUserData();null!==b&&b.EndContact(a.GetFixtureB().GetBody(),a);null!==d&&d.EndContact(a.GetFixtureA().GetBody(),
a)};this.listener.PostSolve=function(a,c){var b=a.GetFixtureA().GetBody().GetUserData(),e=a.GetFixtureB().GetBody().GetUserData();null!==b&&b.PostSolve(a.GetFixtureB().GetBody(),a,c);null!==e&&e.PostSolve(a.GetFixtureA().GetBody(),a,c)};this.listener.PreSolve=function(a,c){var b=a.GetFixtureA().GetBody().GetUserData(),e=a.GetFixtureB().GetBody().GetUserData();null!==b&&b.PreSolve(a.GetFixtureB().GetBody(),a,c);null!==e&&e.PreSolve(a.GetFixtureA().GetBody(),a,c)}}
function Shaker(a){this.m_canvas=a;this.m_yEnabled=this.m_xEnabled=!0;this.m_shaked=!1;this.m_amp=0;this.m_duration=this.m_frequency=1;this.m_updateable=!1;this.m_timer=0;this.m_timerFrequency=1;this.oy=this.ox=0}Shaker.prototype.free=function(){this.m_canvas=null};Shaker.prototype.enableDirection=function(a,b){this.m_xEnabled=a;this.m_yEnabled=b};
Shaker.prototype.shake=function(a,b,c){this.m_updateable||(this.ox=this.m_canvas.position.x,this.oy=this.m_canvas.position.y);this.stop();this.m_duration=c;this.m_frequency=b;this.m_amp=a;0==this.m_duration&&(this.m_duration=-1)};Shaker.prototype.setAmplitude=function(a){this.m_amp=a};Shaker.prototype.start=function(){this.m_updateable=!0};
Shaker.prototype.stop=function(){this.m_canvas.position.x=this.ox;this.m_canvas.position.y=this.oy;this.m_updateable=!1;this.m_duration=-1;this.m_timer=this.m_timerFrequency=this.m_frequency=0};Shaker.prototype.isShaking=function(){return this.m_updateable};Shaker.prototype.updateClipPosition=function(){this.m_xEnabled&&(this.m_canvas.position.x=this.ox+this.m_amp*Math.random());this.m_yEnabled&&(this.m_canvas.position.y=this.oy+this.m_amp*Math.random())};
Shaker.prototype.update=function(a){this.m_updateable&&-1!=this.m_duration&&(this.m_timer<this.m_duration?(this.m_timer+=a,this.m_timerFrequency+=a,this.m_frequency<this.m_timerFrequency&&(this.m_timerFrequency=0,this.updateClipPosition())):this.stop())};
function Homing2DPath(a,b,c,d,e){this.targetY=this.targetX=0;this.x=a;this.y=b;this.speed=d;this.turnFactor=c;this.accuracy=35;this.plusFactor=3;this.m_plusTurnFactor=0;this.accuracyForPlusTurnFactor=80;this.m_rotationCorrection=Math.PI/2;this.m_oldRotations=[];for(c=0;c<e;c++)this.m_oldRotations.push(0);this.m_directionVector=new Vector2D(this.targetX-a,this.targetY-b);this.m_velocityVector=new Vector2D(0,0);this.m_directionVector.normalize2(1);this.m_onArriveFunction=this.m_callerActor=null}
Homing2DPath.prototype.free=function(){this.m_onArriveFunction=this.m_callerActor=this.m_directionVector=this.m_velocityVector=this.m_oldRotations=null};Homing2DPath.prototype.getRotation=function(){return this.m_oldRotations[0]};Homing2DPath.prototype.getVelocityVec=function(){return this.m_velocityVector};Homing2DPath.prototype.onArrivePointFunction=function(a,b){this.m_callerActor=a;this.m_onArriveFunction=b};
Homing2DPath.prototype.addNewRotation=function(a){for(var b=this.m_oldRotations.length,c=0;c<b;c++)this.m_oldRotations[c]=this.m_oldRotations[c+1==b?c:c+1];this.m_oldRotations[b-1]=a};
Homing2DPath.prototype.update=function(a){var b=this.m_directionVector.x=this.targetX-this.x,c=this.m_directionVector.y=this.targetY-this.y;this.m_directionVector.normalize2(this.turnFactor+this.m_plusTurnFactor);this.m_velocityVector.add(this.m_directionVector);this.m_velocityVector.normalize2(this.speed*a);this.x+=this.m_velocityVector.x;this.y+=this.m_velocityVector.y;this.addNewRotation(Math.atan2(this.m_velocityVector.y,this.m_velocityVector.x));a=Math.sqrt(b*b+c*c);a<this.accuracy?null!==this.m_callerActor&&
null!==this.m_onArriveFunction&&(this.m_plusTurnFactor=0,this.m_onArriveFunction.call(this.m_callerActor,this)):a<this.accuracyForPlusTurnFactor&&(this.m_plusTurnFactor=this.plusFactor)};function Dir(){}Dir.RIGHT=1;Dir.DOWN=2;Dir.LEFT=3;Dir.UP=4;Dir.E=1;Dir.SE=2;Dir.S=3;Dir.SW=4;Dir.W=5;Dir.NW=6;Dir.N=7;Dir.NE=8;Dir.PI=3.141592653589793;Dir._PI_180=.017453292519943295;Dir._180_PI=57.29577951308232;Dir.SIDES_4=4;Dir.SIDES_8=8;Dir.fixAngle=function(a){return 0<a?a:2*Dir.PI+a};
Dir.getAngleByDirection=function(a,b){var c=null;switch(a){case Dir.E:c=0;break;case Dir.SE:c=45;break;case Dir.S:c=90;break;case Dir.SW:c=135;break;case Dir.W:c=180;break;case Dir.NW:c=225;break;case Dir.N:c=270;break;case Dir.NE:c=315}null!==c&&b&&(c*=Dir._PI_180);return c};Dir.getDirection=function(a,b){a=Dir.fixAngle(a);b=b||Dir.SIDES_4;a+=Dir.PI/b;a=~~(a/(Dir.PI/(.5*b)))+1;return a>b?1:a};Dir.toRadian=function(a){return a*Dir._PI_180};Dir.toGrades=function(a){return a*Dir._180_PI};
function MapKeyMove(a,b,c,d){this.map={};this.map[a]=Dir.RIGHT;this.map[b]=Dir.DOWN;this.map[c]=Dir.LEFT;this.map[d]=Dir.UP;this.press=[0,0,0,0,0]}MapKeyMove.prototype.reset=function(){this.press=[0,0,0,0,0]};MapKeyMove.prototype.onPress=function(a){switch(this.map[a]){case Dir.RIGHT:this.press[Dir.RIGHT]=1;break;case Dir.DOWN:this.press[Dir.DOWN]=10;break;case Dir.LEFT:this.press[Dir.LEFT]=100;break;case Dir.UP:this.press[Dir.UP]=1E3}};
MapKeyMove.prototype.onRelease=function(a){this.map[a]&&(this.press[this.map[a]]=0)};MapKeyMove.prototype.getDirection=function(){switch(this.press[1]+this.press[2]+this.press[3]+this.press[4]){case 1:return Dir.E;case 10:return Dir.S;case 100:return Dir.W;case 1E3:return Dir.N;case 11:return Dir.SE;case 110:return Dir.SW;case 1100:return Dir.NW;case 1001:return Dir.NE;case 101:return Dir.E;case 1010:return Dir.N}return 0};function EDIUtils(){}EDIUtils.SHAPE_PATH="path";EDIUtils.SHAPE_CIRCLE="circle";
EDIUtils.SHAPE_RECTANGLE="rectangle";EDIUtils.SHAPE_POLYGON="polygon";
EDIUtils.getPointsFromShape=function(a){if(!a)return null;var b,c={};c.type=a.type;switch(a.type){case EDIUtils.SHAPE_PATH:c.points=[];for(b=0;b<a.points.length;b++)c.points.push(a.points[b].x0),c.points.push(a.points[b].y0);break;case EDIUtils.SHAPE_RECTANGLE:c.points=[];c.points.push(a.x);c.points.push(a.y);c.points.push(a.x+a.w);c.points.push(a.y);c.points.push(a.x+a.w);c.points.push(a.y+a.h);c.points.push(a.x);c.points.push(a.y+a.h);break;case EDIUtils.SHAPE_POLYGON:c.points=[];for(b=0;b<a.vertex.length;b++)c.vertex.push(a.vertex[b].x),
c.vertex.push(a.vertex[b].y);break;case EDIUtils.SHAPE_CIRCLE:c.x=a.x,c.y=a.y,c.r=a.r}return c};EDIUtils.getMatrix=function(a){if(!a.matrix)return null;var b=a.matrix;a=a.rows;var c=[],d,e;for(d=0;d<b.length;d++){var f=[];if(null===b[d])f=Common.createArraySize(a,0);else for(e=0;e<b[d].length;e++)if("string"===typeof b[d][e]){var g=b[d][e].split("x");f=f.concat(Common.createArraySize(parseInt(g[1],10),parseInt(g[0],10)))}else f.push(b[d][e]);c.push(f)}return c};
EDIUtils.getParseObjectList=function(a,b){var c,d,e=[];for(c=0;c<a.length;c++){var f={};for(d=0;d<a[c].length;d+=2)0<=a[c][d]?f[b[a[c][d]]]=a[c][d+1]:f[b[-a[c][d]]]=b[a[c][d+1]];e.push(f)}return e};EDIUtils.cloneObject=function(a){var b={},c;for(c in a)b[c]=a[c];return b};
EDIUtils.checkNpcToClone=function(a,b){var c=a.paramsClonePath,d=[];if(c){c="string"===typeof c?Common.getParamsMultiple(c,"|"):c;c=1<=c.length?c:[c];for(var e=0;e<c.length;e++){var f=b.getPath(c[e].path),g=parseInt(c[e].q,10),h=parseInt(c[e].sep,10);if(f){var k=Common.arrayToSPoints(f.points);if("path"===f.type&&2===k.length)for(f=0===h?Common.splitSegmentToPoints(k[0],k[1],g):Common.splitSegmentToSeparation(k[0],k[1],h),g=0;g<f.length;g++)h=EDIUtils.cloneObject(a),h.x=f[g].x,h.y=f[g].y,d.push(h)}else 0!==
parseInt(c[e].path,10)&&Application.warn("Path to clone ["+c[e].path+"] no found")}}return 0<d.length?d:null};function PointsMovement(a,b){this.angle=this.y=this.x=0;this.speed=b||PointsMovement.DEFAUL_SPEED;this.pathPoints=a||[];this.m_d=this.m_yOld=this.m_xOld=this.m_yTarget=this.m_xTarget=this.m_dy=this.m_dx=this.m_vy=this.m_vx=0;this.isStopped=!0;this.isReverse=!1;this.m_callbackChangePoint=this.m_callbackComplete=this.m_caller=this.m_tempLastPath=null}PointsMovement.DEFAUL_SPEED=.05;
PointsMovement.prototype.free=function(){this.m_callbackChangePoint=this.m_callbackComplete=this.m_caller=this.m_tempLastPath=this.pathPoints=null};PointsMovement.prototype.addListeners=function(a,b,c){this.m_caller=a;this.m_callbackComplete=b;this.m_callbackChangePoint=c};
PointsMovement.prototype.onStartPath=function(a,b,c){this.isStopped=!1;this.pathPoints=b||this.pathPoints;this.m_tempLastPath=this.pathPoints.slice(0,this.pathPoints.length);this.speed=c||this.speed;a&&(this.x=this.m_xOld=this.pathPoints[0].x,this.y=this.m_yOld=this.pathPoints[0].y);this.nextPoint()};
PointsMovement.prototype.nextPoint=function(){if(0<this.pathPoints.length){var a=this.pathPoints.splice(0,1)[0];this.goto(a.x,a.y);this.m_caller&&this.m_callbackChangePoint&&this.m_callbackChangePoint.call(this.m_caller,this)}else{if(this.isReverse)this.onStartPath(!1,this.m_tempLastPath.reverse());else this.onStartPath(!1,this.m_tempLastPath);this.m_caller&&this.m_callbackComplete&&this.m_callbackComplete.call(this.m_caller,this)}};PointsMovement.prototype.getVX=function(){return this.m_vx};
PointsMovement.prototype.set=function(a,b){this.x=this.m_xOld=a;this.y=this.m_yOld=b};PointsMovement.prototype.stop=function(){this.isStopped=!0};PointsMovement.prototype.continue=function(){this.isStopped=!1};
PointsMovement.prototype.goto=function(a,b,c){this.speed=c||this.speed;this.m_xTarget=a;this.m_yTarget=b;this.m_xOld=this.x;this.m_yOld=this.y;this.m_dx=this.m_xTarget-this.x;this.m_dy=this.m_yTarget-this.y;this.angle=Math.atan2(this.m_dy,this.m_dx);this.m_d=Math.sqrt(this.m_dx*this.m_dx+this.m_dy*this.m_dy);0===this.m_d?(this.m_vx=this.m_vy=0,this.nextPoint()):(this.m_vx=this.m_dx/this.m_d*this.speed,this.m_vy=this.m_dy/this.m_d*this.speed)};
PointsMovement.prototype.update=function(a){this.isStopped||(this.x+=this.m_vx*a,this.y+=this.m_vy*a,this.m_dx=this.m_xOld-this.x,this.m_dy=this.m_yOld-this.y,Math.sqrt(this.m_dx*this.m_dx+this.m_dy*this.m_dy)>=this.m_d&&this.nextPoint())};
function Tween2(a,b,c){this.loop=this.ignoreGlobalPause=!1;this.duration=0;this.pluginData=c||{};this.target=a;this.position=0;this._paused=this.passive=!1;this._curQueueProps={};this._initQueueProps={};this._steps=[];this._actions=[];this._stepPosition=this._prevPosition=0;this._prevPos=-1;this._target=a;this._registered=!1;this._onCompleteCallback=this._onChangeCallback=null;b&&(this.ignoreGlobalPause=b.ignoreGlobalPause,this.loop=b.loop,this._onChangeCallback=b.onChange,this._onCompleteCallback=
b.onComplete,b.override&&Tween2.removeTweens(a));b&&b.paused?this._paused=!0:Tween2._register(this,!0);b&&null!=b.position&&this.setPosition(b.position,Tween2.NONE)}Tween2.NONE=0;Tween2.LOOP=1;Tween2.REVERSE=2;Tween2.IGNORE={};Tween2._tweens=[];Tween2._plugins={};Tween2.get=function(a,b,c,d){d&&Tween2.removeTweens(a);return new Tween2(a,b,c)};Tween2.tick=function(a,b){for(var c=Tween2._tweens.slice(),d=0;d<c.length;d++){var e=c[d];b&&!e.ignoreGlobalPause||e._paused||e.tick(a)}};
Tween2.removeTweens=function(a){if(a.tweenjs_count){for(var b=Tween2._tweens,c=b.length-1;0<=c;c--){var d=b[c];d._target==a&&(d._paused=!0,b.splice(c,1))}a.tweenjs_count=0}};Tween2.removeAllTweens=function(){for(var a=Tween2._tweens,b=0,c=a.length;b<c;b++){var d=a[b];d._paused=!0;d.target&&(d.target.tweenjs_count=0)}a.length=0};Tween2.hasActiveTweens=function(a){return a?null!=a.tweenjs_count&&!!a.tweenjs_count:Tween2._tweens?Tween2._tweens&&!!Tween2._tweens.length:!1};
Tween2.installPlugin=function(a,b){var c=a.priority;null==c&&(a.priority=c=0);for(var d=0,e=b.length,f=Tween2._plugins;d<e;d++){var g=b[d];if(f[g]){for(var h=f[g],k=0,l=h.length;k<l&&!(c<h[k].priority);k++);f[g].splice(k,0,a)}else f[g]=[a]}};
Tween2._register=function(a,b){var c=a._target,d=Tween2._tweens;if(b&&!a._registered)c&&(c.tweenjs_count=c.tweenjs_count?c.tweenjs_count+1:1),d.push(a);else if(!b&&a._registered)for(c&&c.tweenjs_count--,c=d.length;c--;)if(d[c]==a){d.splice(c,1);break}a._registered=b};Tween2.prototype.wait=function(a,b){if(null==a||0>=a)return this;var c=this._cloneProps(this._curQueueProps);return this._addStep({d:a,p0:c,e:TweenEasing.LinearNone,p1:c,v:b})};
Tween2.prototype.to=function(a,b,c){if(isNaN(b)||0>b)b=0;return this._addStep({d:b||0,p0:this._cloneProps(this._curQueueProps),e:c,p1:this._cloneProps(this._appendQueueProps(a))})};Tween2.prototype.call=function(a,b,c){return this._addAction({f:a,p:b?b:[this],o:c?c:this._target})};Tween2.prototype.set=function(a,b){return this._addAction({f:this._set,o:this,p:[a,b?b:this._target]})};Tween2.prototype.play=function(a){a||(a=this);return this.call(a.setPaused,[!1],a)};
Tween2.prototype.pause=function(a){a||(a=this);return this.call(a.setPaused,[!0],a)};
Tween2.prototype.setPosition=function(a,b){0>a&&(a=0);null==b&&(b=1);var c=a,d=!1;c>=this.duration&&(this.loop?c%=this.duration:(c=this.duration,d=!0));if(c==this._prevPos)return d;var e=this._prevPos;this.position=this._prevPos=c;this._prevPosition=a;if(this._target)if(d)this._updateTargetProps(null,1);else if(0<this._steps.length){a=0;for(var f=this._steps.length;a<f&&!(this._steps[a].t>c);a++);a=this._steps[a-1];this._updateTargetProps(a,(this._stepPosition=c-a.t)/a.d)}0!=b&&0<this._actions.length&&
(1==b&&c<e?(e!=this.duration&&this._runActions(e,this.duration),this._runActions(0,c,!0)):this._runActions(e,c));this._onChangeCallback&&this._onChangeCallback(this);d&&(this.setPaused(!0),this._onCompleteCallback&&this._onCompleteCallback(this));return d};Tween2.prototype.tick=function(a){this._paused||this.setPosition(this._prevPosition+a)};Tween2.prototype.setPaused=function(a){if(this._paused===!!a)return this;this._paused=!!a;Tween2._register(this,!a);return this};Tween2.prototype.w=Tween2.prototype.wait;
Tween2.prototype.t=Tween2.prototype.to;Tween2.prototype.c=Tween2.prototype.call;Tween2.prototype.s=Tween2.prototype.set;Tween2.prototype.tostring=function(){return"[Tween2]"};Tween2.prototype.clone=function(){throw"Tween2 can not be cloned.";};
Tween2.prototype._updateTargetProps=function(a,b){var c,d;if(a||1!=b){if(this.passive=!!a.v)return;a.e&&(b=a.e(b,0,1,1));var e=a.p0;var f=a.p1}else this.passive=!1,e=f=this._curQueueProps;for(var g in this._initQueueProps){null==(c=e[g])&&(e[g]=c=this._initQueueProps[g]);null==(d=f[g])&&(f[g]=d=c);c=c==d||0==b||1==b||"number"!=typeof c?1==b?d:c:c+(d-c)*b;var h=!1;if(d=Tween2._plugins[g])for(var k=0,l=d.length;k<l;k++){var m=d[k].tween(this,g,c,e,f,b,!!a&&e==f,!a);m==Tween2.IGNORE?h=!0:c=m}h||(this._target[g]=
c)}};Tween2.prototype._runActions=function(a,b,c){var d=a,e=b,f=-1,g=this._actions.length,h=1;a>b&&(d=b,e=a,f=g,g=h=-1);for(;(f+=h)!=g;){b=this._actions[f];var k=b.t;(k==e||k>d&&k<e||c&&k==a)&&b.f.apply(b.o,b.p)}};
Tween2.prototype._appendQueueProps=function(a){var b,c,d;for(d in a)if(void 0===this._initQueueProps[d]){var e=this._target[d];if(b=Tween2._plugins[d]){var f=0;for(c=b.length;f<c;f++)e=b[f].init(this,d,e)}this._initQueueProps[d]=this._curQueueProps[d]=void 0===e?null:e}for(d in a){e=this._curQueueProps[d];if(b=Tween2._plugins[d]){var g=g||{};f=0;for(c=b.length;f<c;f++)b[f].step&&b[f].step(this,d,e,a[d],g)}this._curQueueProps[d]=a[d]}g&&this._appendQueueProps(g);return this._curQueueProps};
Tween2.prototype._cloneProps=function(a){var b={},c;for(c in a)b[c]=a[c];return b};Tween2.prototype._addStep=function(a){0<a.d&&(this._steps.push(a),a.t=this.duration,this.duration+=a.d);return this};Tween2.prototype._addAction=function(a){a.t=this.duration;this._actions.push(a);return this};Tween2.prototype._set=function(a,b){for(var c in a)b[c]=a[c]};
function Timeline(a,b,c){this.ignoreGlobalPause=!1;this.duration=0;this.loop=!1;this.position=0;this._paused=!1;this._tweens=[];this._labelList=this._labels=null;this._prevPosition=0;this._prevPos=-1;this._registered=!1;this._onCompleteCallback=this._onChangeCallback=null;c&&(this.loop=c.loop,this.ignoreGlobalPause=c.ignoreGlobalPause,this._onChangeCallback="undefined"!==typeof c.onChange?c.onChange:null,this._onCompleteCallback="undefined"!==typeof c.onEnd?c.onEnd:null);a&&this.addTween.apply(this,
a);this.setLabels(b);c&&c.paused?this._paused=!0:Tween2._register(this,!0);c&&null!=c.position&&this.setPosition(c.position,Tween2.NONE)}Timeline.prototype.addTween=function(a){var b=arguments.length;if(1<b){for(var c=0;c<b;c++)this.addTween(arguments[c]);return arguments[0]}if(0==b)return null;this.removeTween(a);this._tweens.push(a);a.setPaused(!0);a._paused=!1;a.duration>this.duration&&(this.duration=a.duration);0<=this._prevPos&&a.setPosition(this._prevPos,Tween2.NONE);return a};
Timeline.prototype.removeTween=function(a){var b=arguments.length;if(1<b){for(var c=!0,d=0;d<b;d++)c=c&&this.removeTween(arguments[d]);return c}if(0==b)return!1;b=this._tweens;for(d=b.length;d--;)if(b[d]==a)return b.splice(d,1),a.duration>=this.duration&&this.updateDuration(),!0;return!1};Timeline.prototype.addLabel=function(a,b){this._labels[a]=b;var c=this._labelList;if(c){for(var d=0,e=c.length;d<e&&!(b<c[d].position);d++);c.splice(d,0,{label:a,position:b})}};
Timeline.prototype.setLabels=function(a){this._labels=a?a:{}};Timeline.prototype.getLabels=function(){var a=this._labelList;if(!a){a=this._labelList=[];var b=this._labels,c;for(c in b)a.push({label:c,position:b[c]});a.sort(function(a,b){return a.position-b.position})}return a};Timeline.prototype.getCurrentLabel=function(){var a=this.getLabels(),b=this.position,c=a.length;if(c){for(var d=0;d<c&&!(b<a[d].position);d++);return 0==d?null:a[d-1].label}return null};
Timeline.prototype.gotoAndPlay=function(a){this.setPaused(!1);this._goto(a)};Timeline.prototype.gotoAndStop=function(a){this.setPaused(!0);this._goto(a)};
Timeline.prototype.setPosition=function(a,b){0>a&&(a=0);null==b&&(b=1);var c=a,d=!1;c>=this.duration&&(this.loop?c%=this.duration:(c=this.duration,d=!0));if(c==this._prevPos)return d;this._prevPosition=a;this.position=this._prevPos=c;a=0;for(var e=this._tweens.length;a<e;a++)if(this._tweens[a].setPosition(c,b),c!=this._prevPos)return!1;this._onChangeCallback&&this._onChangeCallback(this);d&&(this._onCompleteCallback&&this._onCompleteCallback(this),this.setPaused(!0));return d};
Timeline.prototype.setPaused=function(a){this._paused=!!a;Tween2._register(this,!a)};Timeline.prototype.updateDuration=function(){for(var a=this.duration=0,b=this._tweens.length;a<b;a++){var c=this._tweens[a];c.duration>this.duration&&(this.duration=c.duration)}};Timeline.prototype.tick=function(a){this.setPosition(this._prevPosition+a)};Timeline.prototype.resolve=function(a){var b=Number(a);isNaN(b)&&(b=this._labels[a]);return b};Timeline.prototype.tostring=function(){return"[Timeline]"};
Timeline.prototype.clone=function(){throw"Timeline can not be cloned.";};Timeline.prototype._goto=function(a){a=this.resolve(a);null!=a&&this.setPosition(a)};
function ShaderRing(){this.canvas=this.spriteDisplace=null;this.spriteDisplaceMaxScale=1;Application.RENDER_MODE!==Application.RENDER_WEBGL||Application.isLowDevice||(this.spriteDisplace=Application.instance.getSpriteFromUrl("media/images/animo/shader_ring.jpg"),this.spriteDisplace.pivot.x=75,this.spriteDisplace.pivot.y=75,this.displacementFilter=new window.PIXI.filters.DisplacementFilter(this.spriteDisplace))}
ShaderRing.prototype.create=function(a,b,c,d,e){this.remove();this.canvas=a;this.spriteDisplace&&this.canvas&&(this.spriteDisplaceMaxScale=d,this.spriteDisplace.scale.x=e||1,this.spriteDisplace.scale.y=e||1,this.spriteDisplace.position.x=b,this.spriteDisplace.position.y=c,this.canvas.addChild(this.spriteDisplace),this.canvas.filters=[this.displacementFilter])};
ShaderRing.prototype.remove=function(){this.spriteDisplace&&this.spriteDisplace.parent&&this.canvas&&(this.canvas.removeChild(this.spriteDisplace),this.canvas=this.canvas.filters=null)};ShaderRing.prototype.update=function(a){this.spriteDisplace&&this.spriteDisplace.parent&&(this.spriteDisplace.rotation+=.1,this.spriteDisplace.scale.x+=.025*a,this.spriteDisplace.scale.y+=.025*a,this.spriteDisplace.scale.x>this.spriteDisplaceMaxScale&&this.remove())};
ShaderRing.prototype.free=function(){this.remove();this.canvas=this.spriteDisplace=null};function Interpolate(){this.delay=this.duration=this.time=0;this.startValues={};this.endValues={};this.values={};this.easingFunction=TweenEasing.QuadraticOut;this.hasComplete=!0;this.m_completeCallback=this.m_completeCaller=null}Interpolate.prototype.addCompleteListener=function(a,b){this.m_completeCaller=a;this.m_completeCallback=b};
Interpolate.prototype.setValues=function(a,b,c,d){this.duration=a||this.duration;this.startValues=b||this.startValues;this.endValues=c||this.endValues;this.easingFunction=d||this.easingFunction};Interpolate.prototype.start=function(){this.time=0;this.values={};this.hasComplete=!1;for(var a in this.startValues)this.values[a]=this.startValues[a]||0};Interpolate.prototype.reset=function(){this.time=0;this.values=null;this.hasComplete=!0};
Interpolate.prototype.update=function(a){if(!(this.hasComplete||(this.delay-=a,0<this.delay))){var b=this.time/this.duration;b=1<b?1:b;this.time+=a;a=this.easingFunction(b);for(var c in this.values)this.values[c]=this.startValues[c]+(this.endValues[c]-this.startValues[c])*a;1<=b&&(this.hasComplete=!0,this.time=this.duration,this.m_completeCaller&&this.m_completeCallback&&this.m_completeCallback.call(this.m_completeCaller,this))}};
Interpolate.prototype.free=function(){this.easingFunction=this.values=this.endValues=this.startValues=null};
function SLoader(a){this.onLoadCallback=this.onLoadCaller=null;this.jsonLoader=a;if(a=this.jsonLoader.json.animations)for(var b=0;b<a.length;b++)a[b].atlas=this.jsonLoader.json.meta.atlas,"undefined"!==typeof window.globalAnimations[a[b].n]&&Application.warn("Clip ["+a[b].n+"] is duplicated in multiple JSON files : "+this.jsonLoader.url+" || "+window.globalAnimations[a[b].n+"_url"]),window.globalAnimations[a[b].n]=a[b],window.globalAnimations[a[b].n+"_url"]=this.jsonLoader.url}
SLoader.prototype.addLoadListener=function(a,b){this.onLoadCaller=a;this.onLoadCallback=b};SLoader.prototype.load=function(){var a=0,b=this.jsonLoader.json.meta,c=[];SLoader.JsonTextures[this.jsonLoader.url]=[];for(a=0;a<b.atlas.length;a++){var d=this.jsonLoader.baseUrl+b.atlas[a];c[a]=new PIXI.loaders.Loader;c[a].add(b.atlas[a],d);c[a].parent=this;c[a].metaImage=b.atlas[a];c[a].metaIndex=a;c[a].once("complete",function(){if(this.parent)this.parent.onLoaded(this)});c[a].load()}};
SLoader.prototype.onLoaded=function(a){this.onLoadCaller&&this.onLoadCallback&&this.onLoadCallback.call(this.onLoadCaller);if("undefined"!==typeof this.jsonLoader.json.atlas){Application.info("SLoader::onLoaded: "+a.metaImage);for(var b=a.metaIndex,c=a.resources[a.metaImage].texture.baseTexture,d=this.jsonLoader.json.atlas[b],e,f=0;f<d.length;f++){var g=d[f];e=this.jsonLoader.json.meta.atlas[b]+"_"+f;var h=new window.PIXI.Rectangle(g.x,g.y,g.w,g.h);h.p=g.p;h.q=g.q;h.ax=g.p/g.w;h.ay=g.q/g.h;window.PIXI.utils.TextureCache[e]=
new window.PIXI.Texture(c,h);""!==d[f].n&&(window.PIXI.utils.TextureCache[d[f].n]=new window.PIXI.Texture(c,h))}SLoader.JsonTextures[a.parent.jsonLoader.url].push(c)}};SLoader.JsonTextures={};SLoader.checkTexturesLoaded=function(a){if(!a)return!1;for(var b=0;b<a.length;b++)if("undefined"===typeof SLoader.JsonTextures[a[b]])return!1;return!0};SLoader.showAllTextures=function(){for(var a in SLoader.JsonTextures)Application.info("SLoader >> Textures :: id ["+a+"]")};
SLoader.unloadFromList=function(a){for(var b=0;b<a.length;b++)SLoader.unloadTextureFromJson(a[b])};
SLoader.unloadTextureFromJson=function(a){if(SLoader.JsonTextures[a]){Application.warn("SLoader >> unloadTexture from Json["+a+"]");for(var b=0;b<SLoader.JsonTextures[a].length;b++){Application.warn("SLoader > unload "+SLoader.JsonTextures[a][b].imageUrl);for(var c in window.PIXI.utils.TextureCache)window.PIXI.utils.TextureCache[c]&&window.PIXI.utils.TextureCache[c].baseTexture===SLoader.JsonTextures[a][b]&&(window.PIXI.utils.TextureCache[c]=null);for(var d in window.globalAnimations)window.globalAnimations[d+
"_url"]===a&&(window.globalAnimations[d]=null,delete window.globalAnimations[d],delete window.globalAnimations[d+"_url"]);SLoader.JsonTextures[a][b].destroy()}SLoader.JsonTextures[a]=null;delete SLoader.JsonTextures[a]}else Application.info("SLoader >> unloadTexture, texture ["+a+"] no found")};
function SDisplayObjectContainer(){PIXI.Container.call(this);this.m_pointerMoveCallback=this.m_pointerMoveCaller=this.m_pointerOverCallback=this.m_pointerOverCaller=this.m_pressAndReleaseCallback=this.m_pressAndReleaseCaller=this.m_releaseCallback=this.m_releaseCaller=this.m_pressCallback=this.m_pressCaller=null;this.collisionsClips=[];this.collisions={};this.showCollision=this.showCollision;this.toggleCollision=this.toggleCollision;this._onPointerPress=this._onPointerPress;this._onPointerRelease=
this._onPointerRelease;this._onPointerPressAndRelease=this._onPointerPressAndRelease;this._onPointerOver=this._onPointerOver;this.onPointerMove=this.onPointerMove}Application.subclass(SDisplayObjectContainer,PIXI.Container);
SDisplayObjectContainer.prototype.free=function(){if(this.collisionsClips){for(;0<this.collisionsClips.length;)this.removeChild(this.collisionsClips[0]),this.collisionsClips[0].free(),this.collisionsClips[0]=null,this.collisionsClips.splice(0,1);this.collisionsClips=null}for(0<this.children.length&&Application.warn("An animation with children is being deleted!");this.children&&0<this.children.length;)this.children[0].free&&this.children[0].free(),this.removeChild(this.children[0]);for(var a in this.collisions)this.collisions[a]=
null;this.collisions=null;PIXI.Container.prototype.free.call(this);this._pressAndReleaseCallback=this._pressAndReleaseCaller=this._releaseCallback=this._releaseCaller=this._pressCallback=this._pressCaller=null};SDisplayObjectContainer.prototype.setPosition=function(a,b){this.position.x=a;this.position.y=b};SDisplayObjectContainer.prototype.setScale=function(a,b){this.scale.x=a;this.scale.y=b||a};SDisplayObjectContainer.prototype.setRotation=function(a){this.rotation=a};
SDisplayObjectContainer.prototype.addChild=function(a){a.collisionView=this.collisionView;a.collisionView&&a.showCollision&&a.showCollision();return PIXI.Container.prototype.addChild.call(this,a)};SDisplayObjectContainer.prototype.removeChild=function(a){return PIXI.Container.prototype.removeChild.call(this,a)};SDisplayObjectContainer.prototype.toggleCollision=function(){PIXI.Container.prototype.toggleCollision.call(this);this.showCollision()};
SDisplayObjectContainer.prototype.showCollision=function(){for(;0<this.collisionsClips.length;)this.removeChild(this.collisionsClips[0]),this.collisionsClips[0].free(),this.collisionsClips[0]=null,this.collisionsClips.splice(0,1);if(this.collisionView)for(var a in this.collisions)if(this.collisions[a]){var b=this.collisions[a],c=new SGraphics;c.drawRectangle(b.x,b.y,b.w,b.h,1,this.collisionColor,"mcCollision"===a?this.collisionColor:255,1,.1);this.collisionsClips.push(c);this.addChild(c)}};
SDisplayObjectContainer.prototype.getCollision=function(a){return this.collisions[a]||null};SDisplayObjectContainer.prototype.addCollision=function(a,b){this.collisions[a]=b};SDisplayObjectContainer.prototype.addPressListener=function(a,b){this.interactive=!0;this.self=this;this.mousedown=this.touchstart=function(a){this.self._onPointerPress(a)};this.m_pressCaller=a;this.m_pressCallback=b};
SDisplayObjectContainer.prototype.addReleaseListener=function(a,b){this.interactive=!0;this.self=this;this.mouseup=this.mouseupoutside=function(a){this.self._onPointerRelease(a)};this.touchend=this.touchendoutside=function(a){this.self._onPointerRelease(a)};this.m_releaseCaller=a;this.m_releaseCallback=b};
SDisplayObjectContainer.prototype.addPressAndReleaseListener=function(a,b){this.interactive=!0;this.self=this;this.click=this.tap=function(a){this.self._onPointerPressAndRelease(a)};this.m_pressAndReleaseCaller=a;this.m_pressAndReleaseCallback=b};SDisplayObjectContainer.prototype.addPointerOverListener=function(a,b){this.interactive=!0;this.self=this;this.mouseover=function(a){this.self._onPointerOver(a)};this.m_pointerOverCaller=a;this.m_pointerOverCallback=b};
SDisplayObjectContainer.prototype.addPointerMoveListener=function(a,b){this.interactive=!0;this.self=this;this.mousemove=this.touchmove=function(a){this.self.onPointerMove(a)};this.m_pointerMoveCaller=a;this.m_pointerMoveCallback=b};
SDisplayObjectContainer.prototype._onPointerPress=function(a){null!==this.m_pressCaller&&null!==this.m_pressCallback&&(a.data.global.x=Math.floor((a.data.global.x-Application.instance.canvas.position.x)/Layout.scale),a.data.global.y=Math.floor((a.data.global.y-Application.instance.canvas.position.y)/Layout.scale),this.m_pressCallback.call(this.m_pressCaller,a))};
SDisplayObjectContainer.prototype._onPointerRelease=function(a){null!==this.m_releaseCaller&&null!==this.m_releaseCallback&&(a.data.global.x=Math.floor((a.data.global.x-Application.instance.canvas.position.x)/Layout.scale),a.data.global.y=Math.floor((a.data.global.y-Application.instance.canvas.position.y)/Layout.scale),this.m_releaseCallback.call(this.m_releaseCaller,a))};
SDisplayObjectContainer.prototype._onPointerPressAndRelease=function(a){null!==this.m_pressAndReleaseCaller&&null!==this.m_pressAndReleaseCallback&&(a.data.global.x=Math.floor((a.data.global.x-Application.instance.canvas.position.x)/Layout.scale),a.data.global.y=Math.floor((a.data.global.y-Application.instance.canvas.position.y)/Layout.scale),this.m_pressAndReleaseCallback.call(this.m_pressAndReleaseCaller,a))};
SDisplayObjectContainer.prototype._onPointerOver=function(a){null!==this.m_pointerOverCaller&&null!==this.m_pointerOverCallback&&(a.data.global.x=Math.floor((a.data.global.x-Application.instance.canvas.position.x)/Layout.scale),a.data.global.y=Math.floor((a.data.global.y-Application.instance.canvas.position.y)/Layout.scale),this.m_pointerOverCallback.call(this.m_pointerOverCaller,a))};
SDisplayObjectContainer.prototype.onPointerMove=function(a){null!==this.m_pointerMoveCaller&&null!==this.m_pointerMoveCallback&&(a.data.global.x=Math.floor((a.data.global.x-Application.instance.canvas.position.x)/Layout.scale),a.data.global.y=Math.floor((a.data.global.y-Application.instance.canvas.position.y)/Layout.scale),this.m_pointerMoveCallback.call(this.m_pointerMoveCaller,a))};
SDisplayObjectContainer.prototype.hitTestPoint=function(a,b){var c=this.getCollision("mcCollision");return null!=c?(a=new PIXI.Point(a,b),this.worldTransform.applyInverse(a,a),c.contains(a.x,a.y)):!1};
SDisplayObjectContainer.prototype.hitTest=function(a){var b=this.getCollision("mcCollision"),c=a.getCollision("mcCollision");return b&&c?(1===this.worldTransform.a&&0===this.worldTransform.b&&this.displayObjectUpdateTransform(),1===a.worldTransform.a&&0===a.worldTransform.b&&a.displayObjectUpdateTransform(),SATCollisionDetector.calculatePolyPolyIntersection(SDisplayObjectContainer.getCoordinatesMatrix(this.worldTransform,b.x,b.y,b.w,b.h),SDisplayObjectContainer.getCoordinatesMatrix(a.worldTransform,
c.x,c.y,c.w,c.h))):!1};SDisplayObjectContainer.hitTestByBounds=function(a,b,c,d){return a&&b&&c&&d?(1===a.worldTransform.a&&0===a.worldTransform.b&&a.displayObjectUpdateTransform(),1===c.worldTransform.a&&0===c.worldTransform.b&&c.displayObjectUpdateTransform(),SATCollisionDetector.calculatePolyPolyIntersection(SDisplayObjectContainer.getCoordinatesMatrix(a.worldTransform,b.x,b.y,b.w,b.h),SDisplayObjectContainer.getCoordinatesMatrix(c.worldTransform,d.x,d.y,d.w,d.h))):!1};
SDisplayObjectContainer.getCoordinatesMatrix=function(a,b,c,d,e){var f=[];f.push([b,c]);f.push([b+d,c]);f.push([b+d,c+e]);f.push([b,c+e]);for(d=0;d<f.length;d++)b=f[d][0],c=f[d][1],f[d][0]=a.a*b+a.c*c+a.tx,f[d][1]=a.b*b+a.d*c+a.ty;return f};function SSprite(a,b,c){this.name=a||"";a=a?window.PIXI.Texture.fromImage(a,b,c):window.PIXI.Texture.EMPTY;this.isSprite=!0;PIXI.Sprite.call(this,a)}Application.subclass(SSprite,PIXI.Sprite);
SSprite.prototype.setPosition=function(a,b){this.position.x=a;this.position.y=b};SSprite.prototype.setScale=function(a,b){this.scale.x=a;this.scale.y=b||a};function SPixiText(a,b){this.collisionsClips=[];this.debugRect=null;PIXI.Text.call(this,a,b);Application.RIGHT_TO_LEFT&&(this.rtl=!0,this.canvas.setAttribute("dir","rtl"),this.canvas.style.top="-1000px",this.canvas.style.left="-1000px",this.canvas.style.position="absolute",this.canvas.style.opacity=0,document.body.appendChild(this.canvas))}
Application.subclass(SPixiText,PIXI.Text);SPixiText.prototype.toggleCollision=function(){PIXI.Container.prototype.toggleCollision.call(this);this.showCollision()};
SPixiText.prototype.showCollision=function(){for(;0<this.collisionsClips.length;)this.removeChild(this.collisionsClips[0]),this.collisionsClips[0].free(),this.collisionsClips[0]=null,this.collisionsClips.splice(0,1);if(this.collisionView){var a=new SGraphics;a.drawRectangle(this.debugRect.x-this.position.x,this.debugRect.y-this.position.y,this.debugRect.w,this.debugRect.h,1,16776960,268431616,1,.1);this.collisionsClips.push(a);this.addChild(a)}};
SPixiText.prototype.free=function(){Application.RIGHT_TO_LEFT&&document.body.removeChild(this.canvas);this.context.dispose&&this.context.dispose();this.canvas.dispose&&this.canvas.dispose();this.destroy(!0);this.debugRect=this.collisionsClips=null};function SGraphics(){PIXI.Graphics.call(this)}Application.subclass(SGraphics,PIXI.Graphics);SGraphics.prototype.free=function(){PIXI.Graphics.prototype.destroy.call(this)};
SGraphics.prototype.drawLine=function(a,b,c,d,e,f,g){this.lineStyle("undefined"===typeof f?1:f,"undefined"===typeof e?Common.COLOR_BLACK:e,"undefined"===typeof g?1:g);this.moveTo(a,b);this.lineTo(c,d)};SGraphics.prototype.drawRectangle=function(a,b,c,d,e,f,g,h,k){"undefined"===typeof g?this.fillColor=void 0:this.beginFill(g,"undefined"===typeof k?1:k);this.lineStyle("undefined"===typeof e?1:e,"undefined"===typeof f?Common.COLOR_BLACK:f,"undefined"===typeof h?1:h);this.drawRect(a,b,c,d);this.endFill()};
SGraphics.prototype.drawPoly=function(a,b,c,d,e,f){"undefined"===typeof d?this.fillColor=void 0:this.beginFill(d,"undefined"===typeof f?1:f);this.lineStyle("undefined"===typeof b?1:b,"undefined"===typeof c?Common.COLOR_BLACK:c,"undefined"===typeof e?1:e);this.drawPolygon(a);this.endFill()};
SGraphics.prototype.drawCircle=function(a,b,c,d,e,f,g,h){"undefined"===typeof f?this.fillColor=void 0:this.beginFill(f,"undefined"===typeof h?1:h);this.lineStyle("undefined"===typeof d?1:d,"undefined"===typeof e?Common.COLOR_BLACK:e,"undefined"===typeof g?1:g);PIXI.Graphics.prototype.drawCircle.call(this,a,b,c);this.endFill()};SGraphics.prototype.drawCircleOverride=function(a,b,c){PIXI.Graphics.prototype.drawCircle.call(this,a,b,c)};
SGraphics.prototype.drawEllipse=function(a,b,c,d,e,f,g,h,k){"undefined"===typeof g?this.fillColor=void 0:this.beginFill(g,"undefined"===typeof k?1:k);this.lineStyle("undefined"===typeof e?1:e,"undefined"===typeof f?Common.COLOR_BLACK:f,"undefined"===typeof h?1:h);PIXI.Graphics.prototype.drawEllipse.call(this,a,b,c,d);this.endFill()};
SGraphics.prototype.drawCross=function(a,b,c,d,e,f){this.lineStyle("undefined"===typeof e?1:e,"undefined"===typeof d?Common.COLOR_BLACK:d,"undefined"===typeof f?1:f);this.moveTo(a-c,b-c);this.lineTo(a+c,b+c);this.moveTo(a-c,b+c);this.lineTo(a+c,b-c)};
SGraphics.prototype.drawArrow=function(a,b,c,d,e,f,g,h,k,l){"undefined"===typeof e&&(e=5);"undefined"===typeof h?this.fillColor=void 0:this.beginFill(h,"undefined"===typeof l?1:l);this.lineStyle("undefined"===typeof f?1:f,"undefined"===typeof g?Common.COLOR_BLACK:g,"undefined"===typeof k?1:k);this.moveTo(a,b);this.lineTo(c,d);a=new Vector2D(c-a,d-b);a.normalize();this.lineTo(c-e*(a.x+a.y),d-e*(a.y-a.x));this.moveTo(c,d);this.lineTo(c-e*(a.x-a.y),d-e*(a.y+a.x))};
function Animation(a){SDisplayObjectContainer.call(this);this.blend=0;this.name=a;this.loop=!0;this.m_atlas=this.m_data=this.screenLinked=null;this.m_dataLayers=[];"string"==typeof this.name?0==this.name.length?Application.info("Animation: Creating an empty animation."):((this.m_data=window.globalAnimations[this.name])?(this.m_atlas=this.m_data.atlas,this.m_dataLayers=this.m_data.l):Application.error("Animation: invalid data for "+this.name),this.m_atlas||(Application.error("Animation: invalid atlas for "+
this.name),this.m_data=null)):Application.error("Animation: invalid name: "+this.name);this.indexActions={};this.m_drawLayerInfo=[];this.m_instances={};this.createLayers();this.m_changeTimeCounter=0;this.m_frameTime=33;this.totalFrames=this.m_maxdt=0;this.m_data&&(this.m_frameTime=1E3/Common.sparseInt(this.m_data[Animation.FPS],30),this.m_maxdt=Math.floor(this.m_frameTime),this.totalFrames=Common.sparseInt(this.m_data[Animation.FRAMES],0));this.m_c=new Vector2D;this.m_c1=new Vector2D;this.m_c2=new Vector2D;
this.m_toCenter=new Vector2D;this.m_endAniFunction=this.m_endAniCaller=null;this.m_stopped=!1;this.m_updateChildren=!0;this.currentFrame=this.m_delay=-1;this.setFrame(0)}Application.subclass(Animation,SDisplayObjectContainer);Animation.POS_X="x";Animation.POS_Y="y";Animation.ASSET="a";Animation.ASSET_LIST="i";Animation.ASSET_ID="k";Animation.CENTER_X="u";Animation.CENTER_Y="v";Animation.SCALE_X="w";Animation.SCALE_Y="h";Animation.ANGLE="g";Animation.ALPHA="t";Animation.COLLISION="c";
Animation.INSTANCE_NAME="o";Animation.BLEND_MODE="b";Animation.NAME="n";Animation.FPS="r";Animation.LAYER="l";Animation.FRAMES="f";Animation.FRAMES_ACTIONS="fa";Animation.ACTIONS="a";Animation.FRAME="n";Animation.INTERPOLATE="p";Animation.createFromSprite=function(a,b){var c=new Animation("");if(null!=a){var d=new DrawLayerInfo("layer1",a);c.addChild(a);c.m_drawLayerInfo.push(d);c.name=b;c.totalFrames=1}else Application.error("Animation::createFromSprite() - Invalid sprite name: "+b);return c};
Animation.prototype.free=function(){if(this.m_drawLayerInfo)for(var a=0;a<this.m_drawLayerInfo.length;a++)this.m_drawLayerInfo[a].free(),this.m_drawLayerInfo[a]=null;this.hitArea=this.m_data=this.m_dataLayers=this.m_instances=this.m_atlas=this.m_toCenter=this.m_c2=this.m_c1=this.m_c=this.screenLinked=this.m_endAniFunction=this.m_endAniCaller=this.indexActions=this.m_drawLayerInfo=null;SDisplayObjectContainer.prototype.free.call(this)};
Animation.prototype.setTint=function(a){this.tint=a;for(var b=0;b<this.m_drawLayerInfo.length;b++)this.m_drawLayerInfo[b].displayLayer&&(this.m_drawLayerInfo[b].displayLayer.tint=a)};Animation.prototype.setBlend=function(a){this.blend=a;for(var b=0;b<this.m_drawLayerInfo.length;b++)this.m_drawLayerInfo[b].displayLayer&&(this.m_drawLayerInfo[b].displayLayer.blendMode=a)};
Animation.prototype.getLayer=function(a){for(var b=this.m_drawLayerInfo.length-1;0<=b;--b)if(this.m_drawLayerInfo[b].name==a)return this.m_drawLayerInfo[b].displayLayer;return null};Animation.prototype.stop=function(){this.m_stopped=!0};Animation.prototype.resume=function(){this.m_stopped=!1};Animation.prototype.gotoAndStop=function(a){this.setFrame(a-1);this.stop()};Animation.prototype.gotoAndPlay=function(a){this.setFrame(a-1);this.resume()};
Animation.prototype.startDelay=function(a){0<a&&(this.m_delay=a)};Animation.prototype.onEndAnimation=function(a,b){this.m_endAniCaller=a;this.m_endAniFunction=b};
Animation.prototype.update=function(a){if(this.m_drawLayerInfo&&this.m_updateChildren)for(var b=0;b<this.m_drawLayerInfo.length;b++)if(this.m_drawLayerInfo[b].displayLayer&&this.m_drawLayerInfo[b].displayLayer.children)for(var c=0;c<this.m_drawLayerInfo[b].displayLayer.children.length;c++)this.m_drawLayerInfo[b].displayLayer.children[c].update&&this.m_drawLayerInfo[b].displayLayer.children[c].update(a);if(!(this.m_stopped||1>=this.totalFrames)){if(0<this.m_delay){this.m_delay-=a;if(0<=this.m_delay)return;
a=-this.m_delay;this.m_delay=-1}a=Math.min(a,this.m_maxdt);this.m_changeTimeCounter+=a;this.m_changeTimeCounter>=this.m_frameTime&&(this.m_changeTimeCounter-=this.m_frameTime,a=this.currentFrame+1,a>=this.totalFrames&&(a=0),this.setFrame(a),null!=this.m_data&&this.currentFrame>=this.totalFrames-1&&(this.loop||(this.m_stopped=!0),null!=this.m_endAniCaller&&null!=this.m_endAniFunction&&this.m_endAniFunction.call(this.m_endAniCaller,this)))}};
Animation.prototype.setFrame=function(a){if(!(0>=this.totalFrames)&&(a=Common.clamp(a,0,this.totalFrames-1),a!=this.currentFrame)){this.currentFrame=a;for(var b=0;b<this.m_drawLayerInfo.length;++b)0<this.m_drawLayerInfo[b].frameDataList.length&&this.setSprite(b,Animation.binarySearch(this.m_drawLayerInfo[b].frameDataList,a));if(this.indexActions["act_"+a]){a=this.indexActions["act_"+a];var c=a.length;for(b=0;b<c;b++)if(AnimationActions.applyAction(this,a[b]),null==this.indexActions){b+1<c&&Application.error("Animation:: There are still actions to be performed, but the current animation is just deleted.");
break}}}};
Animation.prototype.createLayers=function(){if(null!=this.m_data)for(var a,b=0;b<this.m_dataLayers.length;b++){var c=this.m_dataLayers[b][Animation.FRAMES];if(null!=c){a=new SSprite;Application.RENDER_MODE==Application.RENDER_WEBGL&&(a.blendMode=this.m_dataLayers[b][Animation.BLEND_MODE]||0);this.addChild(a);a=new DrawLayerInfo(this.m_dataLayers[b][Animation.NAME],a);for(var d=0;d<c.length;d++)c[d][Animation.CENTER_X]=c[d][Animation.CENTER_X]||0,c[d][Animation.CENTER_Y]=c[d][Animation.CENTER_Y]||0,
c[d][Animation.ANGLE]=c[d][Animation.ANGLE]||0,"undefined"===typeof c[d][Animation.SCALE_X]&&(c[d][Animation.SCALE_X]=1),"undefined"===typeof c[d][Animation.SCALE_Y]&&(c[d][Animation.SCALE_Y]=1),"undefined"===typeof c[d][Animation.ALPHA]&&(c[d][Animation.ALPHA]=1),"undefined"===typeof c[d][Animation.ASSET_LIST]&&(c[d][Animation.ASSET_LIST]=0),a.frameDataList.push(c[d]);this.m_drawLayerInfo.push(a)}else if(this.m_dataLayers[b][Animation.FRAMES_ACTIONS])for(c=this.m_dataLayers[b][Animation.FRAMES_ACTIONS],
d=0;d<c.length;d++)this.parseActions(c[d][Animation.FRAME],c[d])}};Animation.prototype.parseActions=function(a,b){a="act_"+a;this.indexActions[a]||(this.indexActions[a]=[]);b=Common.trim(b[Animation.ACTIONS]).split(";");for(var c=0;c<b.length;c++){var d=b[c].split(":"),e=new AnimationActions;e.name=Common.trim(d[0].toLowerCase());1<d.length&&(e.params=Common.trim(d[1]));this.indexActions[a].push(e)}};
Animation.prototype.getInstance=function(a){return"undefined"===typeof this.m_instances[a]?(Application.warn("Instance ["+a+"] no found in clip"),null):this.m_instances[a]};
Animation.prototype.setSprite=function(a,b){var c=this.m_drawLayerInfo[a].displayLayer,d=null,e=this.m_drawLayerInfo[a].frameDataIndex!=b[Animation.FRAME];this.m_drawLayerInfo[a].frameDataIndex=b[Animation.FRAME];var f=0;if(b[Animation.INTERPOLATE]&&0<b[Animation.INTERPOLATE]&&(f=(this.currentFrame-b[Animation.FRAME])/(b[Animation.INTERPOLATE]-b[Animation.FRAME]),d=Animation.binarySearch(this.m_drawLayerInfo[a].frameDataList,b[Animation.INTERPOLATE]),null==d)){Application.error("Invalid frame for interpolation, animation '"+
this.name+"'. layer: "+a);return}a=b[Animation.ANGLE]*SMath.DEG_TO_RAD;if(0<f){var g=SMath.lerp(b[Animation.ALPHA],d[Animation.ALPHA],f),h=SMath.lerp(b[Animation.SCALE_X],d[Animation.SCALE_X],f),k=SMath.lerp(b[Animation.SCALE_Y],d[Animation.SCALE_Y],f);b[Animation.ANGLE]!=d[Animation.ANGLE]?(this.m_c1.set(b[Animation.CENTER_X]*b[Animation.SCALE_X],b[Animation.CENTER_Y]*b[Animation.SCALE_Y]),this.m_c1.rotate(b[Animation.ANGLE]*SMath.DEG_TO_RAD),this.m_c1.addOffset(b[Animation.POS_X],b[Animation.POS_Y]),
this.m_c2.set(b[Animation.CENTER_X]*d[Animation.SCALE_X],b[Animation.CENTER_Y]*d[Animation.SCALE_Y]),this.m_c2.rotate(d[Animation.ANGLE]*SMath.DEG_TO_RAD),this.m_c2.addOffset(d[Animation.POS_X],d[Animation.POS_Y]),this.m_c.set(SMath.lerp(this.m_c1.x,this.m_c2.x,f),SMath.lerp(this.m_c1.y,this.m_c2.y,f)),a=SMath.DEG_TO_RAD*SMath.lerp(b[Animation.ANGLE],d[Animation.ANGLE],f),this.m_toCenter.set(b[Animation.CENTER_X]*h,b[Animation.CENTER_Y]*k),this.m_toCenter.rotate(a),e=this.m_c.x-this.m_toCenter.x,
b=this.m_c.y-this.m_toCenter.y):(e=SMath.lerp(b[Animation.POS_X],d[Animation.POS_X],f),b=SMath.lerp(b[Animation.POS_Y],d[Animation.POS_Y],f));c.setPosition(e,b);c.setScale(h,k);c.rotation!=a&&(c.rotation=a);c.alpha=g}else e&&(1===b[Animation.COLLISION]&&b[Animation.INSTANCE_NAME]&&1<b[Animation.SCALE_X]&&1<b[Animation.SCALE_Y]&&(d=null,0!==b[Animation.ALPHA]&&(d=new Rectangle(b[Animation.POS_X],b[Animation.POS_Y],b[Animation.SCALE_X]/Application.DPI,b[Animation.SCALE_Y]/Application.DPI)),this.addCollision(b[Animation.INSTANCE_NAME],
d),null!==d&&"mcCollision"===b[Animation.INSTANCE_NAME]&&(null==this.hitArea?this.hitArea=new PIXI.Rectangle(d.x,d.y,d.w,d.h):(this.hitArea.x=d.x,this.hitArea.y=d.y,this.hitArea.width=d.w,this.hitArea.height=d.h))),c.texture=-1===b[Animation.ASSET_ID]||-1===b[Animation.ASSET_LIST]?PIXI.Texture.EMPTY:PIXI.Texture.fromImage(this.m_atlas[b[Animation.ASSET_LIST]]+"_"+b[Animation.ASSET_ID],!1,0),c.setPosition(b[Animation.POS_X],b[Animation.POS_Y]),c.rotation!=a&&(c.rotation=a),c.setScale(b[Animation.SCALE_X],
b[Animation.SCALE_Y]),c.alpha=b[Animation.ALPHA],b[Animation.INSTANCE_NAME]&&""!==b[Animation.INSTANCE_NAME]&&(c.name=b[Animation.INSTANCE_NAME],this.m_instances[b[Animation.INSTANCE_NAME]]=c))};Animation.binarySearch=function(a,b){var c=0,d=a.length-1;if(!d)return a[0];for(var e=d>>>1;;){a[e+1][Animation.FRAME]<=b?c=e+1:d=e;if(c==d)return a[c];e=c+d>>>1}};function DrawLayerInfo(a,b){this.name=a;this.displayLayer=b;this.frameDataList=[];this.frameDataIndex=-1}
DrawLayerInfo.prototype.free=function(){null!=this.displayLayer&&(null!=this.displayLayer.parent&&this.displayLayer.parent.removeChild(this.displayLayer),this.displayLayer.free(),this.displayLayer=null);this.frameDataList=null};function AnimationActions(){this.params=this.name=""}AnimationActions.ACT_STOP="s";AnimationActions.ACT_STOP_GUI="sg";AnimationActions.ACT_FINISH_GUI="fg";AnimationActions.ACT_PLAY="p";AnimationActions.ACT_PLAY_SOUND="ps";AnimationActions.ACT_GO_TO_AND_PLAY="gp";
AnimationActions.ACT_GO_TO_AND_STOP="gs";AnimationActions.ACT_GO_TO_RANDOM_AND_STOP="rs";AnimationActions.ACT_GO_TO_RANDOM_AND_PLAY="rp";AnimationActions.ACT_CREATE_FX="fx";AnimationActions.ACT_CALL_FUNCTION="f";AnimationActions.ACT_DELAY="d";
AnimationActions.applyAction=function(a,b){switch(b.name){case AnimationActions.ACT_STOP:a.stop();break;case AnimationActions.ACT_PLAY:a.resume();break;case AnimationActions.ACT_GO_TO_AND_PLAY:a.gotoAndPlay(parseInt(b.params,10));break;case AnimationActions.ACT_GO_TO_AND_STOP:a.gotoAndStop(parseInt(b.params,10));break;case AnimationActions.ACT_GO_TO_RANDOM_AND_STOP:var c=Common.randomInt(1,a.totalFrames);a.gotoAndStop(c);break;case AnimationActions.ACT_GO_TO_RANDOM_AND_PLAY:c=Common.randomInt(1,a.totalFrames);
a.gotoAndPlay(c);break;case AnimationActions.ACT_PLAY_SOUND:Application.instance.playSound(Common.trim(b.params));break;case AnimationActions.ACT_CREATE_FX:b.params=b.params.replace(/\s/g,"");c=b.params.split(",");b=c[0];var d=1<c.length?parseInt(c[1],10):0,e=2<c.length?parseInt(c[2],10):0,f=3<c.length?a.getLayer(c[3]):a.screenLinked.canvas;null==f&&(f=a.getLayer(c[3]));c=Application.instance.effectManager.createEffect(b,d,e,f);a.screenLinked&&a.screenLinked.ownedFxs.push(c);break;case AnimationActions.ACT_CALL_FUNCTION:break;
case AnimationActions.ACT_STOP_GUI:if(a.screenLinked)a.screenLinked.onStopScreen();else a.stop();break;case AnimationActions.ACT_FINISH_GUI:if(a.screenLinked)a.screenLinked.onFinishScreen();else a.stop();break;case AnimationActions.ACT_DELAY:c=b.params.split(",");2==c.length?(b=Common.sparseInt(c[0],0),c=Common.sparseInt(c[1],0),a.startDelay(Common.randomInt(b,c))):Application.error("AnimationActions::applyAction() - ACT_DELAY: invalid format: "+b.params);break;default:Application.warn("Please define Action[ "+
b.name+" ] in animation")}};
function Interpolation(a,b,c,d,e,f){this.m_sprite=a;this.m_smooth=b;this.m_alpha=c[Animation.ALPHA];this.m_angle=c[Animation.ANGLE];this.m_scaleX=c[Animation.SCALE_X];this.m_scaleY=c[Animation.SCALE_Y];this.m_start=c;this.m_end=d;this.m_time=e;this.m_totalTime=f;this.m_x=c[Animation.POS_X];this.m_y=c[Animation.POS_Y];this.m_startCornerY=this.m_startCornerX=0;this.m_c2=this.m_c1=this.m_c=null;this.m_interpolateX=c[Animation.POS_X]!==d[Animation.POS_X];this.m_interpolateY=c[Animation.POS_Y]!==d[Animation.POS_Y];
this.m_interpolateScaleX=c[Animation.SCALE_X]!==d[Animation.SCALE_X];this.m_interpolateScaleY=c[Animation.SCALE_Y]!==d[Animation.SCALE_Y];this.m_interpolateAlpha=c[Animation.ALPHA]!==d[Animation.ALPHA];if(this.m_interpolateAngle=c[Animation.ANGLE]!==d[Animation.ANGLE])this.m_c1=new Vector2D(c[Animation.SCALE_X]*c[Animation.CENTER_X],c[Animation.SCALE_Y]*c[Animation.CENTER_Y]),this.m_c1.rotate(Math.PI*c[Animation.ANGLE]/180),a=new Vector2D(c[Animation.POS_X],c[Animation.POS_Y]),this.m_c1.add(a),this.m_c2=
new Vector2D(d[Animation.SCALE_X]*c[Animation.CENTER_X],d[Animation.SCALE_Y]*c[Animation.CENTER_Y]),this.m_c2.rotate(Math.PI*d[Animation.ANGLE]/180),a=new Vector2D(d[Animation.POS_X],d[Animation.POS_Y]),this.m_c2.add(a),this.m_c=new Vector2D}
Interpolation.prototype.update=function(a){var b=!1;this.m_time+=a;this.m_time>=this.m_totalTime&&(b=!0,this.m_time=this.m_totalTime);this.m_interpolateAlpha&&(this.m_alpha=this.interpolate(this.m_start[Animation.ALPHA],this.m_end[Animation.ALPHA],this.m_time));this.m_interpolateAngle&&(this.m_angle=this.interpolate(this.m_start[Animation.ANGLE],this.m_end[Animation.ANGLE],this.m_time));this.m_interpolateScaleX&&(this.m_scaleX=this.interpolate(this.m_start[Animation.SCALE_X],this.m_end[Animation.SCALE_X],
this.m_time));this.m_interpolateScaleY&&(this.m_scaleY=this.interpolate(this.m_start[Animation.SCALE_Y],this.m_end[Animation.SCALE_Y],this.m_time));if(this.m_interpolateAngle){var c=.017453292519943295*this.m_angle;this.m_c.x=this.interpolate(this.m_c1.x,this.m_c2.x,this.m_time);this.m_c.y=this.interpolate(this.m_c1.y,this.m_c2.y,this.m_time);var d=new Vector2D(this.m_scaleX*this.m_start[Animation.CENTER_X],this.m_scaleY*this.m_start[Animation.CENTER_Y]);d.rotate(c);var e=new Vector2D(this.m_scaleX*
this.m_startCornerX,this.m_scaleY*this.m_startCornerY);e.rotate(c);a=this.m_c.x-d.x-e.x;d=this.m_c.y-d.y-e.y}else{this.m_x=this.m_start[Animation.POS_X];this.m_interpolateX&&(this.m_x=this.interpolate(this.m_start[Animation.POS_X],this.m_end[Animation.POS_X],this.m_time));this.m_y=this.m_start[Animation.POS_Y];this.m_interpolateY&&(this.m_y=this.interpolate(this.m_start[Animation.POS_Y],this.m_end[Animation.POS_Y],this.m_time));var f=this.m_startCornerX,g=this.m_startCornerY;a=this.m_x;d=this.m_y;
0!==this.m_angle?(c=.017453292519943295*this.m_angle,e=Math.cos(c),c=Math.sin(c),1!==this.m_scaleX&&(f*=this.m_scaleX),1!==this.m_scaleY&&(g*=this.m_scaleY),a+=g*c-f*e,d+=-f*c-g*e):(1!==this.m_scaleX&&(f*=this.m_scaleX),1!==this.m_scaleY&&(g*=this.m_scaleY),a-=f,d-=g)}this.m_sprite.position.x=a;this.m_sprite.position.y=d;this.m_sprite.scale.x=this.m_scaleX;this.m_sprite.scale.y=this.m_scaleY;this.m_sprite.rotation=.017453292519943295*this.m_angle;this.m_sprite.alpha=this.m_alpha;return b};
Interpolation.prototype.interpolate=function(a,b,c){return c*(b-a)/this.m_totalTime+a};Interpolation.prototype.toString=function(){return"INTERPOLATION:   "+this.m_start+" to "+this.m_end};Interpolation.prototype.free=function(){this.m_sprite=this.m_c2=this.m_c1=this.m_c=this.m_end=this.m_start=null};
function NanoEffect(a,b,c,d,e){this.x=b;this.y=c;this.canvas=d;this.name=a;this.isAwaitingDelete=!1;this.data=window.nano.effects[a];this.params=e||{};this.emitters=[];this.emittersIndex={};this.emitterCanvas=[];if(this.canvas)for(a=0;a<this.data.length;a++)b=this.data[a].emitter,window.nano.emitters[b]?(c=Application.instance.addDisplayContainer(),this.canvas.addChild(c),this.emitterCanvas.push(c),b=new NanoEmitter(this,window.nano.emitters[b],c),b.ox=this.data[a].pos_x,b.oy=this.data[a].pos_y,b.name=
this.data[a].emitter,this.emittersIndex[this.data[a].emitter]=b,this.emitters.push(b)):Application.warn("Emiiter ["+b+"] no found");else this.isAwaitingDelete=!0}NanoEffect.prototype.setPause=function(a){for(var b=0;b<this.emitters.length;b++)this.emitters[b].pause=a};NanoEffect.prototype.swapOverDepth=function(){for(var a=0;a<this.emitters.length;a++)this.canvas.addChild(this.emitters[a].canvas)};
NanoEffect.prototype.update=function(a){for(var b=0;b<this.emitters.length;b++)this.emitters[b]&&(this.emitters[b].update(a),this.emitters[b].isAwaitingDelete&&(delete this.emittersIndex[this.emitters[b].name],this.emitters[b].free(),this.emitters[b]=null,this.emitters.splice(b,1),this.canvas.removeChild(this.emitterCanvas[b]),this.emitterCanvas[b].free(),this.emitterCanvas[b]=null,this.emitterCanvas.splice(b,1),b--));0===this.emitters.length&&(this.isAwaitingDelete=!0)};
NanoEffect.prototype.free=function(){for(var a in this.emittersIndex)delete this.emittersIndex[a];this.emittersIndex=null;for(a=0;a<this.emitters.length;a++)this.emitters[a].free(),this.emitters[a]=null,this.canvas.removeChild(this.emitterCanvas[a]),this.emitterCanvas[a].free(),this.emitterCanvas[a]=null;this.emitters=[];this.emitterCanvas=[];this.canvas=null};NanoEffect.random=function(a,b){return Math.random()*(b-a)+a};NanoEffect.randomInt=function(a,b){return a+Math.floor(Math.random()*(b-a+1))};
function NanoEmitter(a,b,c){this.effect=a;this.data=b;this.data[NanoParticle.CLIP_ARRAY]=this.data[NanoParticle.CLIP].split(",");this.data[NanoParticle.TINT_ARRAY]=this.data[NanoParticle.TINT].split(",");this.canvas=c;this.frequency=b[NanoEmitter.FRECUENCY];this.delay=b[NanoEmitter.DELAY];this.particles=[];this.isAwaitingDelete=!1;this.oy=this.ox=this.counter=0;this.name="";this.state=NanoEmitter.ST_INTRO;this.pause=!1}NanoEmitter.ST_INTRO=1;NanoEmitter.ST_EMISSION=2;NanoEmitter.FRECUENCY="em_frequency";
NanoEmitter.QUANTITY_MIN="em_quantity_min";NanoEmitter.QUANTITY_MAX="em_quantity_max";NanoEmitter.MAX_PARTICLES="em_max_particles";NanoEmitter.ANGLE_MIN="em_angle_min";NanoEmitter.ANGLE_MAX="em_angle_max";NanoEmitter.ROTATION_SPEED="em_rotation_speed";NanoEmitter.DISTRIBUTE="em_distribute";NanoEmitter.DELAY="em_delay";NanoEmitter.POS_X="pos_x";NanoEmitter.POS_Y="pos_y";
NanoEmitter.prototype.createParticles=function(){if(!(this.pause||0!==this.data[NanoEmitter.MAX_PARTICLES]&&this.counter>=this.data[NanoEmitter.MAX_PARTICLES])){var a=NanoEffect.randomInt(this.data[NanoEmitter.QUANTITY_MIN],this.data[NanoEmitter.QUANTITY_MAX]),b;this.data[NanoEmitter.DISTRIBUTE]&&(b=1<a?(this.data[NanoEmitter.ANGLE_MAX]-this.data[NanoEmitter.ANGLE_MIN])/(a-1):this.data[NanoEmitter.ANGLE_MIN]);for(var c=0;c<a;c++){var d=this.data[NanoEmitter.DISTRIBUTE]?new NanoParticle(this,this.data[NanoEmitter.ANGLE_MIN]+
c*b):new NanoParticle(this,NanoEffect.random(this.data[NanoEmitter.ANGLE_MIN],this.data[NanoEmitter.ANGLE_MAX]));this.counter++;this.particles.push(d)}}};
NanoEmitter.prototype.update=function(a){switch(this.state){case NanoEmitter.ST_INTRO:0>=this.delay&&(this.createParticles(),this.state=NanoEmitter.ST_EMISSION);this.delay-=a;break;case NanoEmitter.ST_EMISSION:this.frequency-=a;0>=this.frequency&&(this.createParticles(),this.frequency=this.data[NanoEmitter.FRECUENCY]);for(var b=0;b<this.particles.length;b++)this.particles[b].update(a),this.particles[b].isAwaitingDelete&&(this.particles[b].free(),this.particles[b]=null,this.particles.splice(b,1),b--);
0<this.data[NanoEmitter.MAX_PARTICLES]&&this.counter>=this.data[NanoEmitter.MAX_PARTICLES]&&0===this.particles.length&&(this.isAwaitingDelete=!0)}};NanoEmitter.prototype.free=function(){for(var a=0;a<this.particles.length;a++)this.particles[a].free();this.data=this.effect=null};
function NanoParticle(a,b){this.canvas=a.canvas;this.data=a.data;this.isAwaitingDelete=!1;this.time=0;var c=Common.getRandomFromArray(this.data[NanoParticle.CLIP_ARRAY]);this.clip=window.PIXI.utils.TextureCache[c]?new window.PIXI.Sprite(window.PIXI.Texture.fromImage(c)):Application.instance.getClip(Common.getRandomFromArray(this.data[NanoParticle.CLIP_ARRAY]));this.canvas&&this.canvas.children&&this.canvas.transform?this.canvas.addChild(this.clip):this.isAwaitingDelete=!0;c=NanoEffect.random(this.data[NanoParticle.SCALE_MIN],
this.data[NanoParticle.SCALE_MAX]);c=this.clip.isSprite?c*Application.DPI:c;this.clip.scale.x=this.clip.scale.y=c;this.clip.position.x=a.effect.x+a.ox+NanoEffect.random(this.data[NanoParticle.X_MIN],this.data[NanoParticle.X_MAX]);this.clip.position.y=a.effect.y+a.oy+NanoEffect.random(this.data[NanoParticle.Y_MIN],this.data[NanoParticle.Y_MAX]);this.clip.rotation=NanoEffect.random(this.data[NanoParticle.ROTATION_MIN],this.data[NanoParticle.ROTATION_MAX]);this.clip.alpha=NanoEffect.random(this.data[NanoParticle.ALPHA_MIN],
this.data[NanoParticle.ALPHA_MAX]);this.timelife=NanoEffect.randomInt(this.data[NanoParticle.TIMELIFE_MIN],this.data[NanoParticle.TIMELIFE_MAX]);this.rotationSpeed=NanoEffect.random(this.data[NanoParticle.ROTATION_SPEED_MIN],this.data[NanoParticle.ROTATION_SPEED_MAX]);a=Common.getRandomFromArray(this.data[NanoParticle.TINT_ARRAY]);0<a&&(this.clip.tint=a);this.clip.blendMode=window.PIXI.BLEND_MODES[this.data[NanoParticle.BLEND]];a=NanoEffect.random(this.data[NanoParticle.SPEED_MIN],this.data[NanoParticle.SPEED_MAX]);
this.ox=this.clip.position.x;this.oy=this.clip.position.y;this.vx=a*Math.cos(b);this.vy=a*Math.sin(b);0===this.data[NanoParticle.ROTATION_MIN]&&0===this.data[NanoParticle.ROTATION_MAX]&&(this.clip.rotation=b)}NanoParticle.CLIP="pt_clip";NanoParticle.TINT="pt_tint";NanoParticle.CLIP_ARRAY="pt_clip_array";NanoParticle.TINT_ARRAY="pt_tint_array";NanoParticle.BLEND="pt_blend";NanoParticle.X_MIN="pt_x_min";NanoParticle.X_MAX="pt_x_max";NanoParticle.Y_MIN="pt_y_min";NanoParticle.Y_MAX="pt_y_max";
NanoParticle.SCALE_MIN="pt_scale_min";NanoParticle.SCALE_MAX="pt_scale_max";NanoParticle.SCALE_SPEED="pt_scale_speed";NanoParticle.SPEED_MIN="pt_speed_min";NanoParticle.SPEED_MAX="pt_speed_max";NanoParticle.ACCELERATION_X="pt_acceleration_x";NanoParticle.ACCELERATION_Y="pt_acceleration_y";NanoParticle.TIMELIFE_MIN="pt_timelife_min";NanoParticle.TIMELIFE_MAX="pt_timelife_max";NanoParticle.ROTATION_MIN="pt_rotation_min";NanoParticle.ROTATION_MAX="pt_rotation_max";NanoParticle.ROTATION_SPEED_MIN="pt_rotation_speed_min";
NanoParticle.ROTATION_SPEED_MAX="pt_rotation_speed_max";NanoParticle.ALPHA_MIN="pt_alpha_min";NanoParticle.ALPHA_MAX="pt_alpha_max";NanoParticle.ALPHA_SPEED="pt_alpha_speed";
NanoParticle.prototype.update=function(a){this.time+=a;this.clip.parent?(this.clip.update&&this.clip.update(a),this.clip.position.x=this.ox+this.vx*this.time+5E-4*this.data[NanoParticle.ACCELERATION_X]*this.time*this.time,this.clip.position.y=this.oy+this.vy*this.time+5E-4*this.data[NanoParticle.ACCELERATION_Y]*this.time*this.time,0!==this.rotationSpeed&&(this.clip.rotation+=.01*this.rotationSpeed*a),this.clip.scale.x+=.001*this.data[NanoParticle.SCALE_SPEED]*a,this.clip.scale.y+=.001*this.data[NanoParticle.SCALE_SPEED]*
a,this.clip.alpha+=.001*this.data[NanoParticle.ALPHA_SPEED]*a,1<this.clip.alpha&&(this.clip.alpha=1),0>=this.clip.alpha&&(this.isAwaitingDelete=!0),this.time>=this.timelife&&(this.isAwaitingDelete=!0)):this.isAwaitingDelete=!0};NanoParticle.prototype.free=function(){this.clip&&this.clip.parent&&this.clip.parent.removeChild(this.clip);this.clip.free?this.clip.free():this.clip.destroy();this.data=this.canvas=this.clip=null};
function BulletActor(){this.canvas=null;this.screenY=this.screenX=this.time=this.ay=this.ax=this.type=this.idFromActor=this.damage=this.vy=this.vx=this.oy=this.ox=this.y=this.x=0;this.isAwaitingDelete=!1;this.clip=null;this.clipName="";this.distanceAlive=this.scaleSpeedY=this.scaleSpeedX=this.alphaSpeed=this.rotationSpeed=0;this.timeFactor=1}BulletActor.prototype.free=function(){this.clearClip();this.canvas=null};
BulletActor.prototype.set=function(a,b,c,d,e,f,g,h,k){this.canvas=a;this.x=c;this.y=d;this.ox=this.x;this.oy=this.y;this.vx=e*Math.cos(f);this.vy=e*Math.sin(f);this.damage=g||0;this.idFromActor=h||0;this.type=k||0;this.time=this.ay=this.ax=0;this.screenY=this.screenX=-9999;this.isAwaitingDelete=!1;this.clip=null;this.clipName=Array.isArray(b)?Common.getRandomFromArray(b):b;this.distanceAlive=this.scaleSpeedY=this.scaleSpeedX=this.alphaSpeed=this.rotationSpeed=0;this.timeFactor=1;this.setClip(this.clipName);
this.render(0)};BulletActor.prototype.update=function(a){this.x=this.ox+this.vx*this.time+5E-4*this.ax*this.time*this.time;this.y=this.oy+this.vy*this.time+5E-4*this.ay*this.time*this.time;if(0!==this.distanceAlive){var b=this.x-this.ox,c=this.y-this.oy;Math.sqrt(b*b+c*c)>this.distanceAlive&&(this.isAwaitingDelete=!0)}this.time+=a*this.timeFactor;this.screenX=this.x;this.screenY=this.y};
BulletActor.prototype.render=function(a){a*=this.timeFactor;this.clip&&(this.clip.position.x=this.screenX,this.clip.position.y=this.screenY,0!==this.rotationSpeed&&(this.clip.rotation+=this.rotationSpeed*a),0!==this.scaleSpeedX&&(this.clip.scale.x+=this.scaleSpeedX*a),0!==this.scaleSpeedY&&(this.clip.scale.y+=this.scaleSpeedY*a),0!==this.alphaSpeed&&(this.clip.alpha+=this.alphaSpeed*a,0>=this.clip.alpha&&(this.isAwaitingDelete=!0)),this.clip.update&&this.clip.update(a))};
BulletActor.prototype.setClip=function(a){this.clearClip();this.clip=Application.instance.getClip(a);this.canvas.addChild(this.clip)};BulletActor.prototype.clearClip=function(){this.clip&&(this.clip.parent&&this.clip.parent.removeChild(this.clip),this.clip.free(),this.clip=null)};function BulletActorHoming(){BulletActor.call(this);this.isHoming=!0;this.homingPath=null}Application.subclass(BulletActorHoming,BulletActor);
BulletActorHoming.prototype.free=function(){BulletActor.prototype.free.call(this);this.homingPath.free();this.homingPath=null};BulletActorHoming.prototype.set=function(a,b,c,d,e,f,g,h,k){BulletActor.prototype.set.call(this,a,b,c,d,e,f,g,h,k);this.homingPath=new Homing2DPath(c,d,1,.2,10)};BulletActorHoming.prototype.update=function(a){this.time+=a*this.timeFactor;this.homingPath.update(a);this.x=this.homingPath.x;this.y=this.homingPath.y;this.screenX=this.x;this.screenY=this.y};
BulletActorHoming.prototype.render=function(a){a*=this.timeFactor;this.clip&&(this.clip.position.x=this.screenX,this.clip.position.y=this.screenY,this.clip.update&&this.clip.update(a))};function BulletManager(a){this.game=a;this.bullets=[]}BulletManager.CAMARA_OFFSET_VIEW=500;BulletManager.prototype.free=function(){for(var a=0;a<this.bullets.length;a++)this.bullets[a].free(),this.bullets[a]=null;this.bullets=null};BulletManager.prototype.addBullet=function(a){this.bullets.push(a)};
BulletManager.prototype.createBullet=function(a,b,c,d,e,f,g,h,k,l){l="undefined"===typeof l?BulletActor:l;l=new l;l.set(a,b,c,d,e||0,f||0,g,h,k);this.bullets.push(l);return l};BulletManager.prototype.update=function(a){for(var b,c=0;c<this.bullets.length;c++)b=this.bullets[c],b.isAwaitingDelete?(b.free(),this.bullets[c]=null,this.bullets.splice(c,1),c--):(b.update(a),b.render(a))};
function BulletEmitter(a,b,c,d,e){this.bulletManager=a;this.canvas=b;this.time=this.angle=this.y=this.x=0;this.pause=!1;this.enable=!0;this.bulletDamage=c||0;this.bulletType=d||0;this.idFromActor=e||0;this.distanceOffset=0;this.frecuency=100;this.settings=new BulletEmitterSettings;this.bulletClassReference=BulletActor;this.callback=this.caller=null}BulletEmitter.prototype.free=function(){this.callback=this.caller=this.bulletManager=this.settings=null};
BulletEmitter.prototype.addShootListener=function(a,b){this.caller=a;this.callback=b};BulletEmitter.prototype.update=function(a){this.enable&&!this.pause&&(this.time+=a,this.time>=this.frecuency&&(this.time=0,this.shoot(this.settings)))};
BulletEmitter.prototype.shoot=function(a){if(!this.enable)return null;a=a||this.settings;for(var b=[],c,d=0;d<a.angles.length;d++){c=this.angle+a.angles[d];for(var e=0;e<a.quantity;e++){var f=this.bulletManager.createBullet(this.canvas,a.clipNames,this.x+BulletEmitter.parseProperty(a.rangeX)+this.distanceOffset*Math.cos(c),this.y+BulletEmitter.parseProperty(a.rangeY)+this.distanceOffset*Math.sin(c),BulletEmitter.parseProperty(a.rangeSpeed),c,this.bulletDamage,this.idFromActor,this.bulletType,this.bulletClassReference);
f.ax=BulletEmitter.parseProperty(a.rangeAccX)*(a.bulletFixAcceletarionAngle?Math.cos(c):1);f.ay=BulletEmitter.parseProperty(a.rangeAccY)*(a.bulletFixAcceletarionAngle?Math.sin(c):1);f.rotationSpeed=BulletEmitter.parseProperty(a.rangeRotSpeed);f.alphaSpeed=BulletEmitter.parseProperty(a.rangeAlphaSpeed);f.distanceAlive=BulletEmitter.parseProperty(a.rangeDistanceAlive);f.timeFactor=a.bulletTimeFactor;null===a.rangeScaleX&&null===a.rangeScaleY?f.clip.scale.x=f.clip.scale.y=BulletEmitter.parseProperty(a.rangeScale):
(f.clip.scale.x=null===a.rangeScaleX?1:BulletEmitter.parseProperty(a.rangeScaleX),f.clip.scale.y=null===a.rangeScaleY?1:BulletEmitter.parseProperty(a.rangeScaleY));null===a.rangeScaleSpeedX&&null===a.rangeScaleSpeedY?f.scaleSpeedX=f.scaleSpeedY=BulletEmitter.parseProperty(a.rangeScaleSpeed):(f.scaleSpeedX=null===a.rangeScaleSpeedX?0:BulletEmitter.parseProperty(a.rangeScaleSpeedX),f.scaleSpeedY=null===a.rangeScaleSpeedY?0:BulletEmitter.parseProperty(a.rangeScaleSpeedY));a.bulletFixAngle&&(f.clip.rotation=
c);b.push(f)}}this.caller&&this.callback&&this.callback.call(this.caller,this,b);return b};BulletEmitter.parseProperty=function(a){return Array.isArray(a)?1===a.length?(Application.warn("BulletEmitter :: any property need 2 parameters min and max"),a[0]):Math.random()*(a[1]-a[0])+a[0]:a};
function BulletEmitterSettings(){this.quantity=1;this.angles=[0];this.rangeX=[0,0];this.rangeY=[0,0];this.rangeScale=[1,1];this.rangeScaleY=this.rangeScaleX=null;this.rangeSpeed=[0,0];this.rangeAlpha=[1,1];this.rangeAccX=[0,0];this.rangeAccY=[0,0];this.clipNames=["mcempty"];this.rangeRotSpeed=[0,0];this.rangeAlphaSpeed=[0,0];this.rangeScaleSpeed=[0,0];this.rangeScaleSpeedY=this.rangeScaleSpeedX=null;this.rangeDistanceAlive=[0,0];this.bulletFixAngle=!0;this.bulletFixAcceletarionAngle=!1;this.bulletTimeFactor=
1}BulletEmitterSettings.prototype.reset=function(){this.quantity=1;this.angles=[0];this.rangeY=this.rangeX=0;this.rangeScale=1;this.rangeScaleY=this.rangeScaleX=null;this.rangeSpeed=0;this.rangeAlpha=1;this.rangeAccY=this.rangeAccX=0;this.clipNames=["mcempty"];this.rangeScaleSpeed=this.rangeAlphaSpeed=this.rangeRotSpeed=0;this.rangeScaleSpeedY=this.rangeScaleSpeedX=null;this.rangeDistanceAlive=0;this.bulletFixAngle=!0;this.bulletFixAcceletarionAngle=!1;this.bulletTimeFactor=1};
function SJsonLoader(a){this.json=this.ajaxRequest=null;this.url=a;this.baseUrl=a.replace(/[^\/]*$/,"");this.m_errorFunction=this.m_errorCaller=this.m_loadFunction=this.m_loadCaller=null}SJsonLoader.prototype.addLoadedListener=function(a,b){this.m_loadCaller=a;this.m_loadFunction=b};SJsonLoader.prototype.addErrorListener=function(a,b){this.m_errorCaller=a;this.m_errorFunction=b};
SJsonLoader.prototype.load=function(){if(this.ajaxRequest=Common.ajaxRequest()){var a=this;this.ajaxRequest.onreadystatechange=function(){a.onJSONLoaded()};this.ajaxRequest.open("GET",this.url,!0);this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/json");this.ajaxRequest.send(null)}else Application.error("Not found [ AJAX object ] in Browser")};
SJsonLoader.prototype.onJSONLoaded=function(){4===this.ajaxRequest.readyState&&(200===this.ajaxRequest.status||-1===window.location.protocol.indexOf("http")?(this.json=JSON.parse(this.ajaxRequest.responseText),this.m_loadCaller&&this.m_loadFunction?this.m_loadFunction.call(this.m_loadCaller,this):this.m_loadFunction&&this.m_loadFunction(this)):this.m_erroCaller&&this.m_errorFunction?this.m_errorFunction.call(this.m_erroCaller,this):this.m_errorFunction&&this.m_errorFunction(this))};
function SndManager(){this.callbackBug=this.m_muted=!1}SndManager.instance=null;SndManager.prototype.loadSounds=function(a){};SndManager.prototype.removeSounds=function(a){};SndManager.prototype.isMuted=function(){return this.m_muted};SndManager.prototype.play=function(a){};SndManager.prototype.stop=function(a){};SndManager.prototype.pauseSound=function(a){};SndManager.prototype.pauseAll=function(){};SndManager.prototype.resumeAll=function(){};SndManager.prototype.stopAllSounds=function(){};
SndManager.prototype.toggleMute=function(){this.m_muted=!this.m_muted;Application.info("toggleMute: "+this.m_muted)};SndManager.prototype.stopAllMusics=function(){};SndManager.prototype.isPlayingSound=function(a){};SndManager.prototype.resumeSound=function(a){};SndManager.prototype.setVolumeById=function(a,b){};SndManager.prototype.setVolumeFactor=function(a,b){};
function SndManagerIE(a){SndManager.call(this);SndManager.instance=this;SwitJS.isIE||Application.error("Using SndManagerIE for no IE browsers");this.soundList={};this.callback=a;this.soundsTotal=this.soundsLoaded=0;this.soundsToLoad=null;window.soundManager.setup({url:"media/swf/",flashVersion:9,useHTML5Audio:!0,preferFlash:!0,useHighPerformance:!0,flashLoadTimeout:2E3,noSWFCache:!1,consoleOnly:!0,wmode:null,debugMode:!1,onready:this.onReady,ontimeout:function(){Application.instance.onErrorSndManagerIE()}})}
Application.subclass(SndManagerIE,SndManager);SndManagerIE.prototype.loadSounds=function(a){Application.info("[SndManagerIE - LOADING SOUNDS...] - "+a.length);var b=window.soundManager;if(b.ok()){this.soundsLoaded=0;this.soundsTotal=a.length;for(var c=Application.ASSETS_PATH+"media/sounds/",d=0;d<a.length;d++)this.soundList[a[d].id]=a[d],b.createSound({id:a[d].id,url:c+a[d].file+".mp3",autoLoad:!0,onload:SndManager.instance.onLoad})}else this.soundsToLoad=a};
SndManagerIE.prototype.removeSounds=function(a){for(var b=window.soundManager,c=0;c<a.length;c++)Application.warn("SndManagerIE > removing sound: "+a[c].id),this.soundList[a[c].id]=null,b.destroySound(a[c].id)};SndManagerIE.prototype.onReady=function(){var a=SndManager.instance;a.soundsToLoad&&(SndManager.instance.loadSounds(a.soundsToLoad),a.soundsToLoad=null)};
SndManagerIE.prototype.onLoad=function(a){var b=SndManager.instance;b.soundsLoaded++;Application.log("SndManagerIE.onLoad: ("+a+") - "+b.soundsLoaded+"/"+b.soundsTotal);if(null!=SLoaderScreen.instance)SLoaderScreen.instance.onFileLoaded()};
SndManagerIE.prototype.play=function(a){if(this.m_muted||!this.soundList[a])return null;var b=window.soundManager,c=this.soundList[a].loops;1!==c?(0===c&&(c=999999),0===b.sounds[a].instanceCount&&b.play(a,{volume:100*this.soundList[a].vol,loops:c})):b.play(a,{volume:100*this.soundList[a].vol});return null};SndManagerIE.prototype.stop=function(a){window.soundManager.stop(a)};SndManagerIE.prototype.pauseAll=function(){window.soundManager.pauseAll()};
SndManagerIE.prototype.resumeAll=function(){this.m_muted||window.soundManager.resumeAll()};SndManagerIE.prototype.stopAllSounds=function(){window.soundManager.stopAll()};SndManagerIE.prototype.toggleMute=function(){SndManager.prototype.toggleMute.call(this);this.m_muted?window.soundManager.pauseAll():window.soundManager.resumeAll()};
SndManagerIE.prototype.stopAllMusics=function(){var a=window.soundManager,b;for(b=a.soundIDs.length-1;0<=b;b--){var c=a.sounds[a.soundIDs[b]];1===c.playState&&(c=c.id,0===this.soundList[c].loops&&window.soundManager.stop(c))}};SndManagerIE.prototype.isPlayingSound=function(a){return(a=window.soundManager.getSoundById(a))?1===a.playState:!1};SndManagerIE.prototype.resumeSound=function(a){(a=window.soundManager.getSoundById(a))&&a.resume()};
SndManagerIE.prototype.setVolumeById=function(a,b){(a=window.soundManager.getSoundById(a))&&1===a.playState&&a.setVolume(100*b)};SndManagerIE.prototype.setVolumeFactor=function(a,b){var c=window.soundManager.getSoundById(a);c&&1===c.playState&&c.setVolume(100*this.soundList[a].vol*b)};
function SndManagerWeb(a){SndManager.call(this);SndManager.instance=this;this.soundjs=window.createjs;this.soundList={};this.callback=a;a=SwitJS.browserVersion;SwitJS.isIE&&10>a&&Application.warn("Using SndManagerWeb for IE"+a);SwitJS.iDevice&&6>SwitJS.platformVersion&&(Application.warn("IOS < 6"),this.callbackBug=this.soundjs.HTMLAudioPlugin.enableIOS=!0);this.soundsTotal=this.soundsLoaded=0;this.soundjs.Sound.alternateExtensions=["mp3"];this.soundjs.Sound.addEventListener("fileload",this.soundjs.proxy(this.onFileload,
this));this.soundjs.Sound.addEventListener("fileerror",this.soundjs.proxy(this.onFileloadError,this));this.callbackBug&&this.callback()}Application.subclass(SndManagerWeb,SndManager);
SndManagerWeb.prototype.loadSounds=function(a){Application.info("SndManagerWeb::loadSounds() - "+a);Application.info("[SndManagerWeb - LOADING SOUNDS...] - "+a.length);this.soundsLoaded=0;this.soundsTotal=a.length;for(var b=Application.ASSETS_PATH+"media/sounds/",c=0;c<a.length;c++)this.soundList[a[c].id]=a[c],this.soundjs.Sound.registerSound({id:a[c].id,src:b+a[c].file+".ogg",data:a[c].instances})};
SndManagerWeb.prototype.removeSounds=function(a){for(var b=0;b<a.length;b++)Application.warn("SndManagerWeb > removing sound: "+a[b].id),this.soundList[a[b].id]=null,this.soundjs.Sound.removeSound(a[b].id)};SndManagerWeb.prototype.onFileload=function(a){this.soundsLoaded++;Application.info("SndManagerWeb preloading: "+a.id+" "+this.soundsLoaded+"/"+this.soundsTotal);if(!this.callbackBug&&SLoaderScreen.instance)SLoaderScreen.instance.onFileLoaded()};
SndManagerWeb.prototype.onFileloadError=function(a){Application.error("SndManagerWeb preloading error: "+a.id+" "+this.soundsLoaded+"/"+this.soundsTotal);Application.warn("SndManagerWeb::onFileloadError() - Forcing to continue the loader...");this.onFileload(a)};SndManagerWeb.prototype.onPlayComplete=function(a){this.play(a.target.switId)};
SndManagerWeb.prototype.play=function(a){if(this.m_muted)return null;if(!this.soundList[a])return Application.warn("SndManagerWeb: sound with id ["+a+"] not found"),null;if(this.soundjs.HTMLAudioPlugin.enableIOS&&0==this.soundList[a].ios)return null;if(this.soundjs.HTMLAudioPlugin.enableIOS){var b=this.soundjs.Sound.play(a);b.addEventListener("complete",this.soundjs.proxy(this.onPlayComplete,this))}else b=this.soundjs.Sound.play(a,null,0,0,0===this.soundList[a].loops?999999:this.soundList[a].loops-
1,this.soundList[a].vol);b.switId=a;return b};SndManagerWeb.prototype.stop=function(a){for(var b=this.soundjs.Sound._instances,c=0;c<b.length;++c)b[c].switId===a&&b[c].stop()};SndManagerWeb.prototype.pauseSound=function(a){for(var b=this.soundjs.Sound._instances,c=0;c<b.length;++c)b[c].switId===a&&(b[c].paused=!0)};SndManagerWeb.prototype.resumeSound=function(a){for(var b=this.soundjs.Sound._instances,c=0;c<b.length;++c)b[c].switId===a&&(b[c].paused=!1)};
SndManagerWeb.prototype.setMasterVolume=function(a){try{this.soundjs.Sound.setVolume(a)}catch(b){Application.error("SndManagerWeb: "+b)}};SndManagerWeb.prototype.pauseAll=function(){for(var a=this.soundjs.Sound._instances,b=0;b<a.length;++b)a[b].paused=!0};SndManagerWeb.prototype.resumeAll=function(){if(!this.m_muted)for(var a=this.soundjs.Sound._instances,b=0;b<a.length;++b)a[b].paused=!1};SndManagerWeb.prototype.stopAllSounds=function(){this.soundjs.Sound.stop()};
SndManagerWeb.prototype.removeAllSounds=function(){this.soundjs.Sound.removeAllSounds();this.soundjs.Sound=null};SndManagerWeb.prototype.toggleMute=function(){SndManager.prototype.toggleMute.call(this);this.m_muted?this.soundjs.Sound.setMute(!0):this.soundjs.Sound.setMute(!1)};SndManagerWeb.prototype.stopAllMusics=function(){for(var a,b=this.soundjs.Sound._instances,c=0;c<b.length;++c)a=b[c].switId,0===this.soundList[a].loops&&b[c].stop(a)};
SndManagerWeb.prototype.isPlayingSound=function(a){for(var b=this.soundjs.Sound._instances,c=0;c<b.length;++c)if(b[c].switId===a)return b[c].playState===this.soundjs.Sound.PLAY_SUCCEEDED;return!1};SndManagerWeb.prototype.setVolumeById=function(a,b){for(var c=this.soundjs.Sound._instances,d=0;d<c.length;++d)c[d].switId===a&&c[d].playState===this.soundjs.Sound.PLAY_SUCCEEDED&&c[d].setVolume(b)};
SndManagerWeb.prototype.setVolumeFactor=function(a,b){for(var c=this.soundjs.Sound._instances,d=0;d<c.length;++d)c[d].switId===a&&c[d].playState===this.soundjs.Sound.PLAY_SUCCEEDED&&c[d].setVolume(this.soundList[a].vol*b)};function Actor(a,b,c){this.m_x="undefined"!==typeof b?b:0;this.m_y="undefined"!==typeof c?c:0;this.clip=Application.instance.getAnimation(a);this.clip.setPosition(this.m_x,this.m_y);DebugObject.call(this)}Application.subclass(Actor,DebugObject);
Actor.prototype.free=function(){this.clip.free();this.clip=null};Actor.prototype.setX=function(a){this.m_x=this.clip.x=a};Actor.prototype.setY=function(a){this.m_y=this.clip.y=a};Actor.prototype.setPosition=function(a,b){this.clip.x=a;this.clip.y=b;this.m_x=a;this.m_y=b};Actor.prototype.getX=function(){return this.m_x};Actor.prototype.getY=function(){return this.m_y};Actor.prototype.setScale=function(a){this.clip.scale.x=a;this.clip.scale.y=a};
Actor.prototype.setScaleX=function(a){this.clip.scale.x=a};Actor.prototype.setScaleY=function(a){this.clip.scale.y=a};Actor.prototype.setRotation=function(a){this.clip.rotation=a};Actor.prototype.onEndAnimation=function(a,b){if(null!=this.clip)this.clip.onEndAnimation(a,b)};Actor.prototype.onDebugDraw=function(a){};Actor.prototype.setClip=function(a){null!=this.clip&&this.clip.free();this.clip=Application.instance.getAnimation(a);this.clip.x=this.m_x;this.clip.y=this.m_y};
Actor.prototype.update=function(a){null!=this.clip&&(this.clip.x=this.m_x,this.clip.y=this.m_y,this.clip.update(a))};function Character(a,b,c){this.canvas=c;this.m_x=a||0;this.m_y=b||0;this.clip=null;this.states={};this.state=this.animation="";this.m_endAniFunction=this.m_endAniCaller=null;this.lastFrame=-1;this.functions={};this.toDelete=!1}
Character.prototype.free=function(){this.clip&&(this.clip.parent&&this.clip.parent.removeChild(this.clip),this.clip.free(),this.clip=null);this.functions=this.m_endAniFunction=this.m_endAniCaller=this.states=this.canvas=null};Character.prototype.setX=function(a){this.m_x=a;this.clip&&(this.clip.position.x=this.m_x)};Character.prototype.setY=function(a){this.m_y=a;this.clip&&(this.clip.position.y=this.m_y)};Character.prototype.getX=function(){return this.m_x};Character.prototype.getY=function(){return this.m_y};
Character.prototype.onEndAnimation=function(a,b){this.m_endAniCaller=a;this.m_endAniFunction=b};Character.prototype._endAnimation=function(a){null!=this.m_endAniCaller&&null!=this.m_endAniFunction&&this.m_endAniFunction.call(this.m_endAniCaller,this.state)};Character.prototype.setPosition=function(a,b){this.m_x=a;this.m_y=b;this.clip&&(this.clip.position.x=this.m_x,this.clip.position.y=this.m_y)};
Character.prototype.addState=function(a,b,c){this.states[a]=b;c="undefined"!==typeof c?c:[];for(var d in this.functions)-1!=d.indexOf(a+"_")&&delete this.functions[d];for(b=0;b<c.length;b++)this.functions[a+"_"+c[b].frame]=c[b]};
Character.prototype.gotoState=function(a,b){b="undefined"!==typeof b?b:!0;this.states[a]?(this.state=a,null!=this.clip&&(null!=this.clip.parent&&this.clip.parent.removeChild(this.clip),this.clip.free()),this.clip=Application.instance.getAnimation(this.states[a]),this.clip.position.x=this.m_x,this.clip.position.y=this.m_y,this.clip.onEndAnimation(this,this._endAnimation),this.clip.loop=b,this.animation=this.states[a],this.canvas.addChild(this.clip),this.lastFrame=-1):Application.error("Character::gotoState() - State: ["+
a+"] is not registered")};Character.prototype.update=function(a){null!=this.clip&&(this.clip.update(a),this.lastFrame!==this.clip.currentFrame&&(this.lastFrame=this.clip.currentFrame,this.functions[this.state+"_"+this.clip.currentFrame]&&(a=this.functions[this.state+"_"+this.clip.currentFrame],a.callback.call(a.caller))))};Character.prototype.setDepth=function(a){};function Layout(){}Layout.ALIGN_TOP_LEFT=0;Layout.ALIGN_TOP_CENTER=1;Layout.ALIGN_CENTER=2;Layout.scale=1;Layout.dpi=1;Layout.align=Layout.ALIGN_CENTER;
Layout.resizeEnable=!0;Layout.offsetX=0;Layout.offsetY=0;Layout.top=0;Layout.left=0;Layout.width=0;Layout.height=0;Layout.minAspectRatio=Application.APP_WIDTH/Application.APP_HEIGHT;Layout.maxAspectRatio=16/9;Layout.aspectRatio=Layout.minAspectRatio;Layout.supports3dTransform=window.WebKitCSSMatrix||window.MSCSSMatrix;
Layout.onResize=function(a,b){Layout.width=Math.floor(a);Layout.height=Math.floor(b);Layout.dpi=window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI||1;Layout.scale=1;Layout.top=0;Layout.left=0;Layout.offsetX=0;Layout.offsetY=0;var c=a/Application.APP_WIDTH,d=b/Application.APP_HEIGHT;d<c?(Layout.scale=d,Layout.left=Math.floor((a-Application.APP_WIDTH*Layout.scale)/2)):d>c&&(Layout.scale=c,Layout.top=Math.floor((b-Application.APP_HEIGHT*Layout.scale)/2));Layout.aspectRatio=Math.min(Layout.maxAspectRatio,
Math.max(Layout.minAspectRatio,Layout.width/Layout.height));Application.WIDE_SCREEN?(d<c?(Layout.offsetX=Layout.left,Application.instance.pixiApp.renderer.resize(Math.ceil(a/Layout.scale),Application.APP_HEIGHT),Application.instance.canvas.position.x=Layout.offsetX/Layout.scale,Application.instance.canvas.position.y=0):(Layout.offsetY=Layout.top,Application.instance.pixiApp.renderer.resize(Application.APP_WIDTH,Math.ceil(b/Layout.scale)),Application.instance.canvas.position.x=0,Application.instance.canvas.position.y=
Layout.offsetY/Layout.scale),Application.log("posX: "+Application.instance.canvas.position.x),Application.log("posY: "+Application.instance.canvas.position.y),Application.instance.pixiApp.renderer.view.style.top="0px",Application.instance.pixiApp.renderer.view.style.left="0px",Application.instance.pixiApp.renderer.view.style["transform-origin"]="0px 0px",Application.instance.pixiApp.renderer.view.style.transform="scale("+Layout.scale+", "+Layout.scale+")",Layout.transform(Application.instance.pixiApp.renderer.view)):
(Application.instance.canvas.scale.x=Layout.scale,Application.instance.canvas.scale.y=Layout.scale,Application.instance.canvas.position.x=Layout.left,Application.instance.canvas.position.y=Layout.top,Application.log("Layout.left: "+Layout.left),Application.log("Layout.top: "+Layout.top),0!==Layout.left?Application.instance.pixiApp.renderer.resize(a-Layout.left,Layout.scale*Application.APP_HEIGHT):Application.instance.pixiApp.renderer.resize(Layout.scale*Application.APP_WIDTH,b-Layout.top));GuiGame.instance&&
GuiGame.instance.fixGameScale()};
Layout.fixInteractionEvent=function(a){if(Application.WIDE_SCREEN){var b={data:{}};b.data.identifier="undefined"!==typeof a.data.identifier?a.data.identifier:0;b.data.originalEvent=a.data.originalEvent;b.data.target=a.data.target;b.data.global={};b.data.global.x=Math.floor((a.data.global.x-Application.instance.canvas.position.x)*Layout.scale+Layout.left);b.data.global.y=Math.floor((a.data.global.y-Application.instance.canvas.position.y)*Layout.scale+Layout.top);b.target=a.target;return b}return a};
Layout.position=function(a,b,c){if(a=document.getElementById(a))a.style.top=b+"px",a.style.left=c+"px"};
Layout.transform=function(a){a&&(a.style.transformOrigin="0 0",a.style.transform="scale("+Layout.scale+", "+Layout.scale+")",a.style.webkitTransformOrigin="0 0",a.style.webkitTransform="scale("+Layout.scale+", "+Layout.scale+")",a.style.OTransformOrigin="0 0",a.style.OTransform="scale("+Layout.scale+", "+Layout.scale+")",SwitJS.isIE&&(a.style.msTransformOrigin=window.config.settings.RIGHT_TO_LEFT?"100% 0%":"0 0",a.style.msTransform="scale("+Layout.scale+", "+Layout.scale+")"))};
function Point(a,b){this.x="undefined"===typeof a?0:a;this.y="undefined"===typeof b?0:b}Point.prototype.distanceTo=function(a,b){return Math.sqrt((a-this.x)*(a-this.x)+(b-this.y)*(b-this.y))};function Rectangle(a,b,c,d){this.x="undefined"!==typeof a?a:0;this.y="undefined"!==typeof b?b:0;this.w="undefined"!==typeof c?c:0;this.h="undefined"!==typeof d?d:0}Rectangle.prototype.left=function(){return this.x};Rectangle.prototype.setLeft=function(a){this.x=a};
Rectangle.prototype.right=function(){return this.x+this.w};Rectangle.prototype.setRight=function(a){a<this.x||(this.w=a-this.x)};Rectangle.prototype.top=function(){return this.y};Rectangle.prototype.setTop=function(a){this.y=a};Rectangle.prototype.bottom=function(){return this.y+this.h};Rectangle.prototype.setBottom=function(a){a<this.y||(this.h=a-this.y)};Rectangle.prototype.isEqual=function(a){return this.x===a.x&&this.y===a.y&&this.w===a.w&&this.h===a.h};
Rectangle.prototype.intersectPoint=function(a,b){return a>=this.x&&a<=this.x+this.w&&b>=this.y&&b<=this.y+this.h};Rectangle.prototype.contains=function(a,b){return a>=this.x&&a<=this.x+this.w&&b>=this.y&&b<=this.y+this.h};Rectangle.prototype.intersectRect=function(a){return this.right()>=a.x&&this.x<=a.right()&&this.bottom()>=a.y&&this.y<=a.bottom()};
Rectangle.prototype.intersection=function(a){if(!this.intersectRect(a))return null;var b=new Rectangle;b.x=this.x>a.x?this.x:a.x;b.y=this.y>a.y?this.y:a.y;b.setRight(this.right()<a.right()?this.right():a.right());b.setBottom(this.bottom()<a.bottom()?this.bottom():a.bottom());return b};Rectangle.prototype.containsRect=function(a){return a.x>=this.x&&a.y>=this.y&&a.right()<=this.right()&&a.bottom()<=this.bottom()};Rectangle.prototype.clone=function(){return new Rectangle(this.x,this.y,this.w,this.h)};
Rectangle.prototype.copyRectangle=function(a){this.x=a.x;this.y=a.y;this.w=a.w;this.h=a.h};Rectangle.prototype.isEmpty=function(){return 0===this.w&&0===this.h};Rectangle.prototype.setEmpty=function(){this.h=this.w=0};Rectangle.prototype.toString=function(){return"x:"+this.x+" y:"+this.y+" w:"+this.w+" h:"+this.h};function NamedRectangle(a,b,c,d,e){this.m_object=a;Rectangle.call(this,b,c,d,e)}Application.subclass(NamedRectangle,Rectangle);NamedRectangle.prototype.getObject=function(){return this.m_object};
NamedRectangle.prototype.toString=function(){return this.m_object+" ("+this.x+", "+this.y+", "+this.w+", "+this.h+")"};function QuadTree(a,b,c,d,e,f){this.bounds=a;this.level=b;this.parallaxXFactor=c;this.parallaxYFactor=d;this.xOffset=e;this.yOffset=f;this.children=null;this.objects=[];this.m_count=0;this.lastCamera=null}QuadTree.minWidth=100;QuadTree.minHeight=100;QuadTree.MAX_OBJECTS_PER_NODE=4;QuadTree.MAX_WIDTH=1E3;QuadTree.MAX_HEIGHT=768;QuadTree.prototype.count=function(){return this.m_count};
QuadTree.prototype.split=function(a,b){var c=this.bounds.left(),d=this.bounds.top(),e=this.bounds.w/2,f=this.bounds.h/2;if(a&&b){a=new QuadTree(new Rectangle(c,d,e,f),this.level+1,this.parallaxXFactor,this.parallaxYFactor,this.xOffset,this.yOffset);b=new QuadTree(new Rectangle(c+e,d,e,f),this.level+1,this.parallaxXFactor,this.parallaxYFactor,this.xOffset,this.yOffset);var g=new QuadTree(new Rectangle(c,d+f,e,f),this.level+1,this.parallaxXFactor,this.parallaxYFactor,this.xOffset,this.yOffset);c=new QuadTree(new Rectangle(c+
e,d+f,e,f),this.level+1,this.parallaxXFactor,this.parallaxYFactor,this.xOffset,this.yOffset);this.children=[a,b,g,c]}else if(a)a=new QuadTree(new Rectangle(c,d,e,2*f),this.level+1,this.parallaxXFactor,this.parallaxYFactor,this.xOffset,this.yOffset),c=new QuadTree(new Rectangle(c+e,d,e,2*f),this.level+1,this.parallaxXFactor,this.parallaxYFactor,this.xOffset,this.yOffset),this.children=[a,c];else if(b)a=new QuadTree(new Rectangle(c,d,2*e,f),this.level+1,this.parallaxXFactor,this.parallaxYFactor,this.xOffset,
this.yOffset),c=new QuadTree(new Rectangle(c,d+f,2*e,f),this.level+1,this.parallaxXFactor,this.parallaxYFactor,this.xOffset,this.yOffset),this.children=[a,c];else return;c=[];d=this.objects.length;e=this.children.length;for(f=0;f<d;f++){a=this.objects[f];b=!1;for(g=0;g<e;g++)if(this.children[g].insert(a)){b=!0;break}b||c.push(a)}this.objects=c};QuadTree.prototype.tryToInsertIntoChildren=function(a){for(var b=this.children.length,c=0;c<b;c++)if(this.children[c].insert(a))return!0;return!1};
QuadTree.prototype.insert=function(a){return this.bounds.containsRect(a)?(null===this.children?(this.objects.push(a),this.objects.length>QuadTree.MAX_OBJECTS_PER_NODE&&this.split(this.bounds.w>2*QuadTree.minWidth,this.bounds.h>2*QuadTree.minHeight)):this.tryToInsertIntoChildren(a)||this.objects.push(a),this.m_count++,!0):!1};QuadTree.prototype.queryObjectsAdjusted=function(a){for(var b=[],c=this.objects.length,d=0;d<c;d++){var e=this.objects[d];e.intersectRect(a)&&b.push(e)}return b};
QuadTree.prototype.queryAdjusted=function(a){this.lastCamera=a;var b=[];if(this.bounds.intersectRect(a)){if(null!==this.children)for(var c=this.children.length,d=0;d<c;d++)b=b.concat(this.children[d].queryAdjusted(a));b=b.concat(this.queryObjectsAdjusted(a))}return b};
QuadTree.prototype.query=function(a){return 1===this.parallaxXFactor&&1===this.parallaxYFactor&&0===this.xOffset&&0===this.yOffset?this.queryAdjusted(a):this.queryAdjusted(new Rectangle(a.left()*this.parallaxXFactor-this.xOffset,a.top()*this.parallaxYFactor-this.yOffset,a.w,a.h))};
QuadTree.prototype.remove=function(a){if(a&&this.bounds.containsRect(a)){if(null!==this.children)for(var b=this.children.length,c=0;c<b;c++){var d=this.children[c];if(d.remove(a))return null===d.children&&0===d.objects.length&&(this.children.splice(c,1),0===this.children.length&&(this.children=null)),!0}b=this.objects.length;for(c=0;c<b;c++)if(this.objects[c]===a)return this.objects.splice(c,1),!0}return!1};
QuadTree.prototype.free=function(){if(null!==this.children){for(var a=this.children.length,b=0;b<a;b++)this.children[b].free();this.children=null}this.lastCamera=this.bounds=this.objects=null};
QuadTree.prototype.onDebugDraw=function(a){if(null!==this.lastCamera&&this.bounds.intersectRect(this.lastCamera)){ContextGraphics.drawRectangle(a,this.bounds.left()-this.lastCamera.left(),this.bounds.top()-this.lastCamera.top(),this.bounds.w,this.bounds.h,2,Common.COLOR_RED,Common.COLOR_NONE);for(var b=this.objects.length,c=0;c<b;c++){var d=this.objects[c];ContextGraphics.drawRectangle(a,d.left()-this.lastCamera.left(),d.top()-this.lastCamera.top(),d.w,d.h,2,Common.COLOR_GREEN,Common.COLOR_NONE)}if(null!==
this.children)for(b=this.children.length,c=0;c<b;c++)this.children[c].onDebugDraw(a)}};
function SScreen(a,b,c,d){a="undefined"===typeof a?"":a;this.screenParent="undefined"===typeof d?null:d;this.blurBG=null;this.canvas=Application.instance.addDisplayContainer();Application.instance.canvas.addChild(this.canvas);this.canvas.hitArea=new PIXI.Rectangle(.5*-Application.APP_WIDTH,-100,2*Application.APP_WIDTH,Application.APP_HEIGHT+200);this.canvas.addPressListener(this,this.onPointerPress);this.canvas.addReleaseListener(this,this.onPointerRelease);this.canvas.addPointerMoveListener(this,
this.onPointerMove);this.setInteractive(!1);this.blurContent=Application.instance.addDisplayContainer();this.canvas.addChild(this.blurContent);this.clip=null;a&&(this.clip=Application.instance.getAnimation(a),this.clip.screenLinked=this,this.canvas.addChild(this.clip));this.skipCode=32;this.canvas.position.x=b||0;this.canvas.position.y=c||0;this.popup=null;this.controls={};this.spaceBarEnabled=!1;this.activePress=!0;this.name=this.lastInteractionControl="";this.m_debugText=null;SScreen.parseControls(this,
a);this.m_transitionFx=null;this.state=0;this.init()}SScreen.prototype.createTransitionIn=function(){};SScreen.prototype.createTransitionOut=function(){};SScreen.prototype.onEndTransitionIn=function(){};SScreen.prototype.onEndTransitionOut=function(){};SScreen.prototype.onActionScreen=function(){};SScreen.prototype.onAppLostFocus=function(){};SScreen.prototype.onAppGotFocus=function(){};
SScreen.prototype.applyBlur=function(a){a=a||2;var b=new Image;b.src=Application.instance.captureScreen();this.blurBG=new SSprite(b.src);this.blurBG.position.x=-Layout.left/Layout.scale;this.blurContent.addChild(this.blurBG);b=new window.PIXI.filters.BlurFilter;b.blur=a;this.blurBG.filters=[b]};
SScreen.prototype.createTransition=function(a,b,c,d,e){b="undefined"===typeof b?0:b;c="undefined"===typeof c?0:c;d="undefined"===typeof d?null:d;e="undefined"===typeof e?null:e;null!==this.m_transitionFx&&this.m_transitionFx.free();this.m_transitionFx=new SEffectAnimo(a,b,c,e||this.clip,1);this.m_transitionFx.onComplete(this,this.onEndTransition);this.m_transitionFx.params=d};
SScreen.prototype.createCustomTransition=function(a,b,c){b=b||null;null!==this.m_transitionFx&&this.m_transitionFx.free();this.m_transitionFx=new a(b,c||this.clip);this.m_transitionFx.onEndAnimation(this,this.onEndTransition)};SScreen.prototype.setInteractive=function(a){this.canvas.interactive=a};SScreen.prototype.getControl=function(a){if(this.controls&&this.controls[a])return this.controls[a];Application.warn("Control ["+a+"] no found");return null};SScreen.prototype.init=function(){};
SScreen.prototype.onDebugDraw=function(a){};SScreen.prototype.onEndTransition=function(a){a.isAwaitingDelete=!0};SScreen.prototype.onUIPress=function(a){Application.instance.fullScreen();if(null!==this.popup)this.popup.onUIPress(a);else this.lastInteractionControl=a.name};SScreen.prototype.onUIRelease=function(a){if(null!==this.popup)this.popup.onUIRelease(a)};SScreen.prototype.onUIPressAndRelease=function(a){if(null!==this.popup)this.popup.onUIPressAndRelease(a)};
SScreen.prototype.onUIMove=function(a){if(null!==this.popup)this.popup.onUIMove(a)};SScreen.prototype.onUIOver=function(a){if(null!==this.popup)this.popup.onUIOver(a)};SScreen.prototype.onUIOut=function(a){if(null!==this.popup)this.popup.onUIOut(a)};SScreen.prototype.onStopScreen=function(){this.clip&&this.clip.stop()};SScreen.prototype.onResumeScreen=function(){this.clip&&this.clip.resume()};SScreen.prototype.onFinishScreen=function(){};SScreen.prototype.onPointerPress=function(a){};
SScreen.prototype.onPointerRelease=function(a){};SScreen.prototype.onPointerPressAndRelease=function(a){};SScreen.prototype.onPointerOver=function(a){};SScreen.prototype.onPointerMove=function(a){};SScreen.prototype.activePressBar=function(){this.spaceBarEnabled=!0};SScreen.prototype.onPressSpaceBar=function(){this.spaceBarEnabled=!1};
SScreen.prototype.update=function(a){null!==this.popup&&this.popup.update(a);this.clip&&this.clip.update(a);this.m_transitionFx&&(this.m_transitionFx.isAwaitingDelete?(this.m_transitionFx.free(),this.m_transitionFx=null):this.m_transitionFx.update(a))};SScreen.prototype.onResize=function(a){if(null!==this.popup)this.popup.onResize(a)};SScreen.prototype.onKeyDown=function(a){if(null!==this.popup)this.popup.onKeyDown(a);if(this.spaceBarEnabled&&a===this.skipCode)this.onPressSpaceBar()};
SScreen.prototype.onKeyUp=function(a){if(null!==this.popup)this.popup.onKeyUp(a)};SScreen.prototype.onActivate=function(a){if(null!==this.popup)this.popup.onActivate(a)};SScreen.prototype.addPopup=function(a,b,c,d){c=c||0;d=d||0;this.dropPopup();return this.popup=new a(b,c,d,this)};SScreen.prototype.dropPopup=function(){null!==this.popup&&(this.popup.free(),this.popup=null)};SScreen.prototype.destroyToolTips=function(){};SScreen.prototype.createTooltips=function(a,b,c,d,e){};
SScreen.prototype.free=function(){this.m_debugText&&(this.canvas.removeChild(this.m_debugText),this.m_debugText=null);this.blurBG&&(this.blurContent.removeChild(this.blurBG),this.blurBG.free(),this.blurBG=null);null!=this.blurContent&&(this.blurContent.free(),this.blurContent=null);var a=document.getElementById("MainCanvasDraw");a&&(a.focus(),a.parentElement.focus());this.dropPopup();this.destroyToolTips();this.screenParent=null;for(var b in this.controls)this.controls[b].free(),this.controls[b]=
null;this.controls=null;null!=this.m_transitionFx&&(this.m_transitionFx.free(),this.m_transitionFx=null);this.clip&&(this.clip.parent&&this.clip.parent.removeChild(this.clip),this.clip.free(),this.clip=null);this.canvas&&(this.canvas.hitArea=null,null!=this.canvas.parent&&this.canvas.parent.removeChild(this.canvas),this.canvas.free(),this.canvas=null);Application.instance.canvasEvents&&(document.getElementById("MainCanvasEvents").style.cursor="default")};
SScreen.parseControls=function(a,b){var c=window.swt_ui,d=Application.RIGHT_TO_LEFT?"_rtl":"_ltr",e=null,f,g;for(g in c)if(c[g].gui===b&&(f=a.clip.getLayer(c[g].control))){switch(Common.trim(c[g].type).toUpperCase()){case GuiControl.TYPE_TEXT:e=new GuiText(f,parseInt(c[g].width,10),parseInt(c[g].height,10));e.align=Common.trim(c[g]["hAlign"+d]);e.valign=Common.trim(c[g].vAlign);f=new window.PIXI.TextStyle;f.fontFamily=c[g]["font"+d];f.fontSize=parseInt(c[g]["size"+d],10);f.fill=c[g].color;f.align=
e.align;var h=c[g].border?c[g].border.split(","):[];2===h.length&&(f.strokeThickness=parseInt(h[0],10),f.stroke=h[1]);h=c[g].shadow?c[g].shadow.split(","):[];4===h.length&&(f.dropShadow=!0,f.dropShadowDistance=parseInt(h[0],10),f.dropShadowColor=h[1],f.dropShadowAngle=Common.gradToRadian(parseInt(c[g].shadow[2],10)),f.dropShadowBlur=parseInt(h[3],10));h=c[g].spacing?c[g].spacing.split(","):[];2===h.length&&(f.letterSpacing=parseInt(h[0],10),0!==parseInt(h[1],10)&&(f.lineHeight=f.fontSize+parseInt(h[1],
10)));1===(c[g].wordWrap?parseInt(c[g].wordWrap,10):0)&&(f.wordWrap=!0,f.wordWrapWidth=e.baseWidth);f.padding=20;e.textfield?e.textfield.style=f:Application.warn("SScreen: control text id ["+c[g].control+"] was not created");"undefined"!==typeof Application.strings[c[g].string]?e.setTextLocalized(c[g].string):Application.warn("SScreen: string/style id ["+c[g].string+"] no found");break;case GuiControl.TYPE_CLIP:e=new GuiClip(f);e.setClip(c[g].link);break;case GuiControl.TYPE_ON_OFF:e=new GuiOnOff(f);
e.setOnClip(c[g].aniData[0]);e.setOffClip(c[g].aniData[1]);e.gotoState(GuiOnOff.ST_ON);e.addPressListener(a,a.onUIPress);break;case GuiControl.TYPE_BUTTON:h=c[g].link;h=h.replace(/_.*$/,"");Application.instance.existsAnimation(h+"_press")?e=new GuiButtonState(f,h):(e=new GuiButton(f),e.setClip(h));e.screenContainer=a;e.addPressListener(a,a.onUIPress);e.addReleaseListener(a,a.onUIRelease);break;case GuiControl.TYPE_4STATES:e=new GuiThumbs4State(f,c[g].link,c[g].disableLink,c[g].selectedLink,c[g].soonLink);
e.addPressListener(a,a.onUIPress);e.addReleaseListener(a,a.onUIRelease);break;case GuiControl.TYPE_CLIP_MOUSE:e=new GuiControlInteractive(f);e.setClip(c[g].link);e.setInteractive(!0);e.addPressListener(a,a.onUIPress);e.addReleaseListener(a,a.onUIRelease);e.addMoveListener(a,a.onUIMove);break;case GuiControl.TYPE_CONTENT:e=new GuiContent(f)}e&&(e.name=Common.trim(c[g].control),a.controls[c[g].control]=e)}};
SScreen.prototype.addDebugText=function(a,b,c,d){this.m_debugText=new window.PIXI.Text("",{fontSize:c||18,fontFamily:"Arial",fill:d||"#FF0000"});this.canvas.addChild(this.m_debugText);this.m_debugText.position.x=a;this.m_debugText.position.y=b};SScreen.prototype.setDebugText=function(a){this.m_debugText&&(this.m_debugText.text=a)};
function SLoaderScreen(a,b,c,d,e,f,g,h){d="undefined"===typeof d?null:d;SScreen.call(this,a);this.m_start="undefined"===typeof e?0:e;this.m_end="undefined"===typeof f?100:f;this.m_jsonFiles=b;SLoaderScreen.instance=this;this.m_soundGroup=null;if(null!=d)for(this.m_soundGroup=[],b=d.length-1;0<=b;--b)a=Application.instance.getSoundGroup(d[b]),null!=a&&this.m_soundGroup.push(a);this.m_loadedfiles=this.m_totalFiles=0;this.m_nextScreen=c;this.m_isReady=!1;this.m_waitTime=600;this.m_isPreload="undefined"===
typeof g?!1:g;this.m_extraAssets="undefined"===typeof h?[]:h;this.m_btnNext=null;this.controls&&this.controls.mcGuiBtnNext&&(this.m_btnNext=this.controls.mcGuiBtnNext,this.m_btnNext.setVisible(!1));this.m_isPreload&&(this.m_waitTime=0);this.loadedJsonFiles=0;if(null!=this.m_jsonFiles)for(c=0;c<this.m_jsonFiles.length;c++)if(Application.jsonFiles[this.m_jsonFiles[c]])this.onJsonLoaded(Application.jsonFiles[this.m_jsonFiles[c]]);else d=new SJsonLoader(this.m_jsonFiles[c]),d.addLoadedListener(this,this.onJsonLoaded),
d.addErrorListener(this,this.onJsonError),d.load();else Application.error("SLoaderScreen: invalid JSON file"),this.m_isReady=!0}Application.subclass(SLoaderScreen,SScreen);SLoaderScreen.showButtonNext=!0;SLoaderScreen.instance=null;SLoaderScreen.prototype.free=function(){this.m_soundGroup=this.m_jsonFiles=this.m_btnNext=null;SLoaderScreen.instance=null;SScreen.prototype.free.call(this)};SLoaderScreen.prototype.createTransitionIn=function(){this.m_isPreload||0==this.m_start&&SScreen.prototype.createTransitionIn.call(this)};
SLoaderScreen.prototype.createTransitionOut=function(){this.m_isPreload||SScreen.prototype.createTransitionOut.call(this)};SLoaderScreen.prototype.onJsonLoaded=function(a){Application.log("[JSON loaded] "+a.url);this.loadedJsonFiles++;Application.jsonFiles[a.url]=a;if(this.loadedJsonFiles>=this.m_jsonFiles.length)this.onAllJsonLoaded()};SLoaderScreen.prototype.onJsonError=function(a){Application.error("JSON no found "+a.url)};
SLoaderScreen.prototype.onAllJsonLoaded=function(){Application.info("[ALL JSON COMPLETE]");var a=[],b;for(b=0;b<this.m_jsonFiles.length;b++){this.m_totalFiles+=Application.jsonFiles[this.m_jsonFiles[b]].json.meta.atlas.length;var c=new SLoader(Application.jsonFiles[this.m_jsonFiles[b]]);c.addLoadListener(this,this.onFileLoaded);a.push(c)}this.m_extraAssets&&0<this.m_extraAssets.length&&(this.m_totalFiles+=this.m_extraAssets.length,b=new SJsonLoader(""),b.json={meta:{atlas:this.m_extraAssets}},b.baseUrl=
"",c=new SLoader(b),c.addLoadListener(this,this.onFileLoaded),a.push(c));for(b=0;b<a.length;b++)a[b].load();if(null!=this.m_soundGroup&&0<this.m_soundGroup.length){for(b=this.m_soundGroup.length-1;0<=b;--b)Application.soundGroups[this.m_soundGroup[b].group]||(this.m_totalFiles+=this.m_soundGroup[b].sounds.length,Application.instance.soundManager.loadSounds(this.m_soundGroup[b].sounds),Application.soundGroups[this.m_soundGroup[b].group]=!0);this.m_soundGroup=null}};
SLoaderScreen.prototype.onUIPress=function(a){switch(a.name){case "mcGuiBtnNext":Application.instance.hideAddressBar(),Application.instance.playSound("MUSIC_MAINMENU"),GuiManager.instance.gotoScreen(this.m_nextScreen)}};SLoaderScreen.prototype.onFileLoaded=function(){this.m_loadedfiles++;this.m_loadedfiles===this.m_totalFiles&&(this.m_isReady=!0)};
SLoaderScreen.prototype.update=function(a){SScreen.prototype.update.call(this,a);this.m_isReady&&(this.m_waitTime-=a,0>this.m_waitTime&&(this.onLoadComplete(),this.m_isReady=!1))};
SLoaderScreen.prototype.onLoadComplete=function(){if(this.m_isPreload)Application.instance.onLoaderReady();else Application.instance.isMobileDevice&&null!==this.m_jsonFiles&&100===this.m_end?SLoaderScreen.showButtonNext?(SLoaderScreen.showButtonNext=!1,this.m_btnNext&&this.m_btnNext.setVisible(!0)):GuiManager.instance.gotoScreen(this.m_nextScreen):GuiManager.instance.gotoScreen(this.m_nextScreen)};function DebugScreen(a,b,c,d){SScreen.call(this,a,b,c,d)}Application.subclass(DebugScreen,SScreen);
DebugScreen.prototype.onUIPress=function(a){Application.instance.playSound("SND_UI_CLICK");this.onResumeScreen()};
function DebugScreenNano(){SScreen.call(this,"",0,0);DebugScreenNano.instance=this;this.setInteractive(!0);this.fx=null;this.effectName="";this.followCursor=!1;this.bgImage=null;this.canvasBg=Application.instance.addDisplayContainer();this.bgClip=null;this.canvasClip=Application.instance.addDisplayContainer();this.canvasEffect=Application.instance.addDisplayContainer();this.canvasGuides=Application.instance.addDisplayContainer();this.canvas.addChild(this.canvasBg);this.canvas.addChild(this.canvasClip);
this.canvas.addChild(this.canvasEffect);this.canvas.addChild(this.canvasGuides);this.max=0;this.centerX=.5*Application.APP_WIDTH;this.centerY=.5*Application.APP_HEIGHT;var a=new SGraphics;a.drawLine(this.centerX-100,this.centerY,this.centerX+100,this.centerY,65280);a.drawLine(this.centerX,this.centerY-100,this.centerX,this.centerY+100,65280);a.drawRectangle(10,10,Application.APP_WIDTH-20,Application.APP_HEIGHT-20,1,65280);this.canvasGuides.addChild(a);this.m_debugText=new SPixiText("",{size:15,font:"15px Arial",
fill:"#00FF00"});this.m_debugText.position.x=14;this.m_debugText.position.y=12;this.canvas.addChild(this.m_debugText)}Application.subclass(DebugScreenNano,SScreen);DebugScreenNano.prototype.onKeyDown=function(a){switch(a){case Common.KEY_F:this.followCursor=!this.followCursor,this.followCursor||(this.fx.x=this.centerX,this.fx.y=this.centerY)}};DebugScreenNano.prototype.onPointerPress=function(a){""!==this.effectName&&this.createEffect(this.effectName,a.data.global.x,a.data.global.y)};
DebugScreenNano.prototype.onPointerMove=function(a){this.fx&&this.followCursor&&(this.fx.x=a.data.global.x,this.fx.y=a.data.global.y)};DebugScreenNano.prototype.setBackground=function(a){this.bgImage&&(this.canvasBg.removeChild(this.bgImage),this.bgImage=null);this.bgImage=window.PIXI.Sprite.fromImage(a,!1,PIXI.SCALE_MODES.DEFAULT);this.canvasBg.addChild(this.bgImage)};
DebugScreenNano.prototype.setClip=function(a){this.bgClip&&(this.canvasClip.removeChild(this.bgClip),this.bgClip=null);a&&(this.bgClip=Application.instance.getClip(a),"__errorSprite"!==this.bgClip.name?(this.bgClip.setPosition(this.centerX,this.centerY),this.canvasClip.addChild(this.bgClip)):(this.bgClip.free(),this.bgClip=null))};DebugScreenNano.prototype.setClipInFront=function(a){this.canvas.removeChild(this.canvasClip);this.canvas.addChildAt(this.canvasClip,a?3:1)};
DebugScreenNano.prototype.createEffect=function(a,b,c){this.fx&&(this.fx.free(),this.fx=null);this.max=0;this.effectName=a;this.fx=new NanoEffect(a,b||this.centerX,c||this.centerY,this.canvasEffect)};
DebugScreenNano.prototype.update=function(a){SScreen.prototype.update.call(this,a);this.bgClip&&this.bgClip.update(a);if(this.fx){this.fx.update(a);a=window.nano.effects[this.effectName];for(var b=0;b<a.length;b++)this.fx.emittersIndex[a[b].emitter]&&(this.fx.emittersIndex[a[b].emitter].ox=a[b].pos_x,this.fx.emittersIndex[a[b].emitter].oy=a[b].pos_y)}this.max<this.canvasEffect.countChildren()&&(this.max=this.canvasEffect.countChildren());this.m_debugText.text="Particles : "+this.canvasEffect.countChildren()+
" fps : "+Application.instance.fps+(Application.RENDER_MODE===Application.RENDER_CANVAS?" (canvas)":" (webgl)")+" Max : "+this.max};DebugScreenNano.prototype.addDebugText=function(a,b,c,d){"undefined"===typeof d&&(d="#FF0000");"undefined"===typeof c&&(c=18);this.m_debugText=new SPixiText("",{fontSize:c,fontFamily:"Arial",fill:d});this.canvas.addChild(this.m_debugText);this.m_debugText.position.x=a;this.m_debugText.position.y=b};
DebugScreenNano.prototype.setDebugText=function(a){this.m_debugText&&(this.m_debugText.text=a)};function ScreenManager(){this.currentScreen=null;this.currentScreenName="";this.debugDrawModeOn=!0}ScreenManager.prototype.free=function(){this.currentScreen&&this.currentScreen.free();this.currentScreen=null};ScreenManager.prototype.gotoScreen=function(a){this.currentScreen&&this.currentScreen.free();this.currentScreen=null;this.currentScreenName=a;Application.log("GO TO SCREEN :: "+a)};
ScreenManager.prototype.update=function(a){a>Application.MAX_DELTA_TIME&&(a=Application.MAX_DELTA_TIME);this.currentScreen&&this.currentScreen.update(a)};ScreenManager.prototype.onAppLostFocus=function(){if(this.currentScreen)this.currentScreen.onAppLostFocus()};ScreenManager.prototype.onAppGotFocus=function(){if(this.currentScreen)this.currentScreen.onAppGotFocus()};ScreenManager.prototype.onResize=function(a){if(this.currentScreen)this.currentScreen.onResize(a)};
ScreenManager.prototype.onKeyDown=function(a){if(this.currentScreen)this.currentScreen.onKeyDown(a)};ScreenManager.prototype.onKeyUp=function(a){if(this.currentScreen)this.currentScreen.onKeyUp(a)};ScreenManager.prototype.onActivate=function(a){if(this.currentScreen)this.currentScreen.onActivate(a)};ScreenManager.prototype.onTilt=function(a){};ScreenManager.prototype.onDebugDraw=function(a){if(this.debugDrawModeOn&&null!==this.currentScreen)this.currentScreen.onDebugDraw(a)};
ScreenManager.prototype.toggleDebugDraw=function(){this.debugDrawModeOn=!this.debugDrawModeOn};
function RotateScreen(a){this.canvas=a;this.file=SwitJS.isPhone?"media/images/ui_images/gui_rotatescreen_phone.jpg":"media/images/ui_images/gui_rotatescreen.jpg";this.bg=new PIXI.Graphics;this.bg.beginFill(0,1);this.bg.drawRect(0,0,100,100);this.image=PIXI.Sprite.fromImage(this.file,!1,window.PIXI.settings.SCALE_MODE);this.image.pivot.x=150;this.image.pivot.y=150;this.canvas.interactive=!0;this.animate=this.visible=!1}
RotateScreen.prototype.show=function(){this.canvas.addChild(this.bg);this.canvas.addChild(this.image);var a=1/Layout.scale;Common.tween({parent:this,clip:this.image,scale:.2,onComplete:this.onCompleteAnimation},{scale:1.2>a?1.2:a},1500,!0,150,TweenEasing.ElasticOut);this.animate=this.visible=!0};RotateScreen.prototype.onCompleteAnimation=function(a){this.animate=!0};RotateScreen.prototype.hide=function(){this.canvas.removeChild(this.bg);this.canvas.removeChild(this.image);this.visible=!1};
RotateScreen.prototype.onResize=function(){Application.WIDE_SCREEN?(this.image.position.x=.5*window.innerWidth/Layout.scale,this.image.position.y=.5*window.innerHeight/Layout.scale,this.bg.width=window.innerWidth,this.bg.height=window.innerHeight,this.bg.scale.x/=Layout.scale,this.bg.scale.y/=Layout.scale):(this.image.position.x=.5*Application.APP_WIDTH,this.image.position.y=.5*Application.APP_HEIGHT,this.bg.width=Application.APP_WIDTH,this.bg.height=Application.APP_HEIGHT)};
function Vector2D(a,b){this.x="undefined"===typeof a?0:a;this.y="undefined"===typeof b?0:b}Vector2D.prototype.set=function(a,b){this.x=a;this.y=b};Vector2D.prototype.addOffset=function(a,b){this.x+=a;this.y+=b};Vector2D.prototype.setVector=function(a,b){this.x=a*Math.cos(b);this.y=a*Math.sin(b)};Vector2D.prototype.distanceTo=function(a,b){return Math.sqrt((a-this.x)*(a-this.x)+(b-this.y)*(b-this.y))};
Vector2D.prototype.distance=function(a){return Math.sqrt((a.x-this.x)*(a.x-this.x)+(a.y-this.y)*(a.y-this.y))};Vector2D.prototype.clone=function(){return new Vector2D(this.x,this.y)};Vector2D.prototype.plus=function(a){return new Vector2D(this.x+a.x,this.y+a.y)};Vector2D.prototype.minus=function(a){return new Vector2D(this.x-a.x,this.y-a.y)};Vector2D.prototype.middle=function(a){return new Vector2D(.5*(this.x+a.x),.5*(this.y+a.y))};
Vector2D.prototype.orthogonal=function(){return new Vector2D(-this.y,this.x)};Vector2D.prototype.rotate=function(a){var b=Math.cos(a);a=Math.sin(a);var c=this.x*b-this.y*a;this.y=this.y*b+this.x*a;this.x=c};Vector2D.prototype.udir=function(){var a=this.clone();a.normalize();return a};Vector2D.prototype.projectionOn=function(a){var b=a.dot(a);if(0===b)return this.clone();var c=a.clone();c.scale(this.dot(a)/b);return c};Vector2D.prototype.dot=function(a){return this.x*a.x+this.y*a.y};
Vector2D.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};Vector2D.prototype.squaredLength=function(){return this.x*this.x+this.y*this.y};Vector2D.prototype.copy=function(a){this.x=a.x;this.y=a.y};Vector2D.prototype.scale=function(a){this.x*=a;this.y*=a};Vector2D.prototype.normalize=function(){var a=this.length();0<a?(this.x/=a,this.y/=a):Application.warn("[WARN]: Vector2D.normalize: called on a zero-length vector.")};
Vector2D.prototype.normalize2=function(a){var b=this.length();0<b?(this.x/=b,this.y/=b,1!=a&&this.scale(a)):Application.warn("[WARN]: Vector2D.normalize: called on a zero-length vector.")};Vector2D.prototype.stretch=function(a){var b=this.length();0<b?(this.x*=a/b,this.y*=a/b):Application.warn("[WARN]: Vector2D.stretch: called on a zero-length vector.")};Vector2D.prototype.silentNormalize=function(){var a=this.length();0<a&&(this.x/=a,this.y/=a)};
Vector2D.prototype.add=function(a){this.x+=a.x;this.y+=a.y};Vector2D.prototype.subtract=function(a){this.x-=a.x;this.y-=a.y};Vector2D.prototype.product=function(a){return this.y*a.x-this.x*a.y};Vector2D.prototype.angle=function(){return Math.atan2(this.y,this.x)};Vector2D.prototype.isZero=function(){return 0===this.y&&0===this.x};Vector2D.prototype.toString=function(){return"V2D x:"+this.x+" y:"+this.y};
function SGame(a){this.canvas=a;this.world=this.m_hud=null;this.score=this.lives=0;this.playerWin=this.showDebugCollision=this.isAwaitingDelete=this.isAwaitReset=!1;SGame.instance=this;this.init()}SGame.instance=null;SGame.prototype.free=function(){null!==this.world&&(this.world.free(),this.world=null);null!==this.m_hud&&(this.m_hud.free(),this.m_hud=null);this.canvas=null;SGame.instance=null};SGame.prototype.init=function(){};SGame.prototype.onAppLostFocus=function(){};
SGame.prototype.onAppGotFocus=function(){};SGame.prototype.fixGameScale=function(){this.world&&this.world.scaleWorld()};SGame.prototype.hud=function(){return this.m_hud};SGame.prototype.update=function(a){null!==this.m_hud&&this.m_hud.update(a)};SGame.prototype.onDebugDraw=function(a){};SGame.prototype.toggleDebugCollision=function(){this.showDebugCollision=!this.showDebugCollision};SGame.prototype.onActivate=function(a){};SGame.prototype.onKeyDown=function(a){};SGame.prototype.onKeyUp=function(a){};
SGame.prototype.onPointerPress=function(a,b){};SGame.prototype.onPointerRelease=function(a,b){};SGame.prototype.onPointerPressAndRelease=function(a){};SGame.prototype.onPointerOver=function(a){};SGame.prototype.onPointerMove=function(a,b){};
function SEffect(a,b,c,d,e,f){this.name=a;this.canvas=d;this.clip=null;this.params=f||{};this.isAwaitingDelete=!1;this.type=0;this.loops="undefined"!==typeof e?e:1;this.m_repeat=0;this.deleteAtTheEnd=!0;this.m_endCompleteCaller=this.m_endCompleteCallback=null}SEffect.prototype.create=function(){};SEffect.TYPE_ANIMO=1;SEffect.TYPE_NANO=2;SEffect.TYPE_GUI=3;SEffect.prototype.fix=function(a){this.clip.position.x=a.x;this.clip.position.y=a.y};
SEffect.prototype.free=function(){this.clip&&(this.clip.parent&&this.clip.parent.removeChild(this.clip),this.clip.free(),this.clip=null);this.params=this.m_endCompleteCaller=this.m_endCompleteCallback=this.canvas=null};SEffect.prototype.onComplete=function(a,b){this.m_endCompleteCaller=a||null;this.m_endCompleteCallback=b||null};SEffect.prototype.setPause=function(a){};
SEffect.prototype.onEndLoop=function(){this.m_repeat++;0!==this.loops&&this.m_repeat>=this.loops&&(null!==this.m_endCompleteCallback&&null!==this.m_endCompleteCaller&&this.m_endCompleteCallback.call(this.m_endCompleteCaller,this),this.deleteAtTheEnd?this.isAwaitingDelete=!0:this.clip.gotoAndStop(this.clip.totalFrames-1))};SEffect.prototype.update=function(a){};
function SEffectAnimo(a,b,c,d,e,f){SEffect.call(this,a,b,c,d,e,f);this.clip=Application.instance.getAnimation(a);this.clip.position.x=b;this.clip.position.y=c;this.canvas.addChild(this.clip);this.clip.onEndAnimation(this,this.onEndLoop);this.type=SEffect.TYPE_ANIMO}Application.subclass(SEffectAnimo,SEffect);SEffectAnimo.prototype.update=function(a){this.clip.update(a)};
function SEffectNano(a,b,c,d,e){NanoEffect.call(this,a,b,c,d,e);this.type=SEffect.TYPE_NANO;this.m_endCompleteCaller=this.m_endCompleteCallback=null}Application.subclass(SEffectNano,NanoEffect);SEffectNano.prototype.fix=function(a){this.x=a.x;this.y=a.y;for(var b=0;b<this.emitters.length;b++)for(var c=0;c<this.emitters[b].particles.length;c++)this.emitters[b].particles[c].ox=a.x+this.emitters[b].ox,this.emitters[b].particles[c].oy=a.y+this.emitters[b].oy};
SEffectNano.prototype.onComplete=function(a,b){this.m_endCompleteCaller=a||null;this.m_endCompleteCallback=b||null};SEffectNano.prototype.update=function(a){NanoEffect.prototype.update.call(this,a);this.isAwaitingDelete&&null!==this.m_endCompleteCallback&&null!==this.m_endCompleteCaller&&this.m_endCompleteCallback.call(this.m_endCompleteCaller,this)};SEffectNano.prototype.free=function(){NanoEffect.prototype.free.call(this);this.m_endCompleteCaller=this.m_endCompleteCallback=null};
function SEffectGui(a,b,c,d,e,f){SEffect.call(this,a,b,c,d,e,f);this.clip=Application.instance.getClip(a);this.canvas.addChild(this.clip);this.clip.position.x=b;this.clip.position.y=c;this.clip.onEndAnimation(this,this.onEndLoop);this.type=SEffect.TYPE_GUI;this.controls={};this.lastInteractionControl="";SScreen.parseControls(this,a)}Application.subclass(SEffectGui,SEffect);SEffectGui.prototype.update=function(a){this.clip&&this.clip.update(a)};
SEffectGui.prototype.getControl=function(a){"undefined"===typeof this.controls[a]&&Application.error("Control ["+a+"] no found");return this.controls[a]};SEffectGui.prototype.onUIPress=function(a){this.onResumeScreen();this.lastInteractionControl=a.name};SEffectGui.prototype.onStopScreen=function(){this.clip&&this.clip.stop()};SEffectGui.prototype.onResumeScreen=function(){this.clip&&this.clip.resume()};SEffectGui.prototype.onFinishScreen=function(){};SEffectGui.prototype.onKeyDown=function(a){this.onResumeScreen()};
SEffectGui.prototype.free=function(){for(var a in this.controls)this.controls[a].free(),this.controls[a]=null;this.controls=null;this.clip&&this.clip.hitArea&&(this.clip.hitArea=null);SEffect.prototype.free.call(this)};function SEffectManager(){this.effects=[];this.m_k=this.m_len=0}SEffectManager.prototype.clear=function(){for(var a=0;a<this.effects.length;a++)this.effects[a].isAwaitingDelete=!0};
SEffectManager.prototype.removeEffect=function(a){for(var b=0;b<this.effects.length;b++)this.effects[b].name===a&&(this.effects[b].isAwaitingDelete=!0)};SEffectManager.prototype.add=function(a){this.effects.push(a)};SEffectManager.prototype.createEffect=function(a,b,c,d,e,f){if(window.nano.effects[a])return this.createEffectNano(a,b,c,d,f);for(var g=window.swt_ui,h=g.length-1;0<=h;--h)if(g[h].gui===a)return this.createEffectGui(a,b,c,d,e,f);return this.createEffectAnimo(a,b,c,d,e,f)};
SEffectManager.prototype.createEffectAnimo=function(a,b,c,d,e,f){a=new SEffectAnimo(a,b,c,d,e,f);this.add(a);return a};SEffectManager.prototype.createEffectNano=function(a,b,c,d,e){a=new SEffectNano(a,b,c,d,e);this.add(a);return a};SEffectManager.prototype.createEffectGui=function(a,b,c,d,e,f){a=new SEffectGui(a,b,c,d,e,f);this.add(a);return a};
SEffectManager.prototype.update=function(a){this.m_len=this.effects.length;for(this.m_k=0;this.m_k<this.m_len;this.m_k++)this.effects[this.m_k].isAwaitingDelete?(this.effects[this.m_k].free(),this.effects[this.m_k]=null,this.effects.splice(this.m_k,1),this.m_k--,this.m_len--):this.effects[this.m_k].update(a)};
function SFilter(a,b,c){this.timeElapsed=0;this.timeFactor=1;PIXI.Filter.call(this,a||SFilter.defaultVertexSrc(),b||SFilter.defaultFragmentSrc(),c);Application.RENDER_MODE!==Application.RENDER_WEBGL&&Application.warn("[SFilter] >> Shaders no active by no use WEBGL Render")}Application.subclass(SFilter,PIXI.Filter);SFilter.prototype.update=function(a){this.timeElapsed+=a*this.timeFactor;this.uniforms&&(this.uniforms.time=this.timeElapsed)};
SFilter.prototype.setResolution=function(a,b){this.uniforms&&this.uniforms.resolution&&(this.uniforms.resolution.x=a,this.uniforms.resolution.y=b)};SFilter.prototype.free=function(){PIXI.Filter.prototype.free.call(this)};SFilter.defaultVertexSrc=function(){return"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nuniform mat3 projectionMatrix;\nuniform mat3 filterMatrix;\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vFilterCoord = ( filterMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n   vTextureCoord = aTextureCoord ;\n}"};
SFilter.defaultFragmentSrc=function(){return"varying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\nuniform sampler2D uSampler;\nuniform sampler2D filterSampler;\nvoid main(void){\n   vec4 masky = texture2D(filterSampler, vFilterCoord);\n   vec4 sample = texture2D(uSampler, vTextureCoord);\n   vec4 color;\n   if(mod(vFilterCoord.x, 1.0) > 0.5)\n   {\n     color = vec4(1.0, 0.0, 0.0, 1.0);\n   }\n   else\n   {\n     color = vec4(0.0, 1.0, 0.0, 1.0);\n   }\n   gl_FragColor = mix(sample, masky, 0.5);\n   gl_FragColor *= sample.a;\n}"};
function ControlGroup(){this.controls=[];this.controlSelected=null}ControlGroup.prototype.addControl=function(a){this.controls.push(a)};ControlGroup.prototype.onSelectControl=function(a){for(var b=0;b<this.controls.length;b++)this.controls[b].name===a?(this.controls[b].gotoState(GuiControl.ST_SELECTED),this.controlSelected=this.controls[b]):this.controls[b].gotoState(GuiControl.ST_ENABLE)};ControlGroup.prototype.free=function(){this.controlSelected=this.controls=null};
function GuiControl(a){a&&0===a.children.length&&(a.texture._frame.width=0,a.texture._frame.height=0);this.canvas=a;this.clip=null;this.clipName=this.name="";this.state=1;this.enabled=!0;this.screenContainer=null;this.isVisible=!0;this.type=""}GuiControl.prototype.free=function(){for(;0<this.canvas.children.length;)this.canvas.removeChild(this.canvas.getChildAt(0));this.screenContainer=null;null!=this.clip&&(this.clip.free(),this.clip=null);this.canvas=null};GuiControl.prototype.getX=function(){return this.canvas.x};
GuiControl.prototype.getY=function(){return this.canvas.y};GuiControl.prototype.setVisible=function(a){this.isVisible=a;this.canvas.visible=this.isVisible;this.clip&&(this.clip.visible=this.isVisible)};GuiControl.prototype.setEnabled=function(a){this.enabled=a};
GuiControl.prototype.setClip=function(a){null!=this.clip&&(null!=this.clip.parent&&this.clip.parent.removeChild(this.clip),this.clip.free());for(this.clipName=a;0<this.canvas.children.length;)Application.warn("This should not happen !!"),this.canvas.removeChild(this.canvas.getChildAt(0));this.clip=Application.instance.getAnimation(this.clipName);this.clip.visible=this.isVisible;this.canvas.addChild(this.clip)};GuiControl.prototype.onResetState=function(){};
GuiControl.prototype.gotoState=function(a){this.state=a};GuiControl.prototype.update=function(a){};GuiControl.TYPE_TEXT="TEXT";GuiControl.TYPE_CLIP="CLIP";GuiControl.TYPE_ON_OFF="ON_OFF";GuiControl.TYPE_BUTTON="BUTTON";GuiControl.TYPE_4STATES="4STATES";GuiControl.TYPE_CLIP_MOUSE="CLIPMOUSE";GuiControl.TYPE_CONTENT="CONTENT";GuiControl.TYPE_ANI_BUTTON="ANI_BUTTON";GuiControl.ST_ENABLE=1;GuiControl.ST_DISABLE=2;GuiControl.ST_SELECTED=3;GuiControl.ST_COMMING_SOON=4;GuiControl.ST_RELEASE=5;
GuiControl.ST_OVER=6;GuiControl.ST_OUT=7;GuiControl.I_OX=1;GuiControl.I_OY=2;GuiControl.I_SCALE_X=3;GuiControl.I_SCALE_Y=4;GuiControl.I_SCALE=5;GuiControl.I_ROTATION=6;GuiControl.I_ALPHA=7;
function GuiControlInteractive(a){GuiControl.call(this,a);this.m_interactive=!1;this.containerText=this._moveCallback=this._moveCaller=this._pressAndReleaseCallback=this._pressAndReleaseCaller=this._releaseCallback=this._releaseCaller=this._pressCallback=this._pressCaller=null;this.onPressActive=!1;this.commingSoonLink=this.outLink=this.overLink=this.releaseLink=this.selectedLink=this.disableLink=this.enableLink="";this.onPressButton=!1;this._outCallback=this._outCaller=this._overCallback=this._overCaller=
null;this.buttonMode=!1}Application.subclass(GuiControlInteractive,GuiControl);GuiControlInteractive.prototype.free=function(){this.setInteractive(!1);this.screenContainer=this.containerText=this._moveCallback=this._moveCaller=this._pressAndReleaseCallback=this._pressAndReleaseCaller=this._releaseCallback=this._releaseCaller=this._pressCallback=this._pressCaller=this._outCaller=this._outCallback=this._overCallback=this._overCaller=null;GuiControl.prototype.free.call(this)};
GuiControlInteractive.prototype.setInteractive=function(a){this.m_interactive=a;this.clip&&(this.clip.interactive=this.m_interactive,a?(this.clip.self=this,this.clip.mousedown=function(a){this.self.onPress(a)},this.clip.touchstart=function(a){this.self.onPress(a)},this.clip.mouseup=function(a){this.self.onRelease(a)},this.clip.mouseupoutside=function(a){this.self.onRelease(a)},this.clip.touchend=function(a){this.self.onRelease(a)},this.clip.touchendoutside=function(a){this.self.onRelease(a)},this.clip.mousemove=
function(a){this.self.onMove(a)},this.clip.touchmove=function(a){this.self.onMove(a)},this.clip.mouseover=function(a){this.self.onOver(a)},this.clip.mouseout=function(a){this.self.onOut(a)}):(this.clip.self=null,this.clip.mousedown=null,this.clip.touchstart=null,this.clip.mouseup=null,this.clip.mouseupoutside=null,this.clip.touchend=null,this.clip.touchendoutside=null,this.clip.mousemove=null,this.clip.touchmove=null,this.clip.mouseover=null,this.clip.mouseout=null),this.clip.buttonMode=!0)};
GuiControlInteractive.prototype.setClip=function(a){GuiControl.prototype.setClip.call(this,a);this.setInteractive(this.m_interactive)};GuiControlInteractive.prototype.addPressListener=function(a,b){this._pressCaller=a;this._pressCallback=b};GuiControlInteractive.prototype.addReleaseListener=function(a,b){this._releaseCaller=a;this._releaseCallback=b};GuiControlInteractive.prototype.addPressAndReleaseListener=function(a,b){this._pressAndReleaseCaller=a;this._pressAndReleaseCallback=b};
GuiControlInteractive.prototype.addMoveListener=function(a,b){this._moveCallback=b;this._moveCaller=a};GuiControlInteractive.prototype.addOverListener=function(a,b,c,d){this._overCallback=b;this._overCaller=a;this._outCallback=d;this._outCaller=c};GuiControlInteractive.prototype.onPress=function(a){null!==this._pressCaller&&null!==this._pressCallback&&this._pressCallback.call(this._pressCaller,this);this.onPressActive=!0};
GuiControlInteractive.prototype.onRelease=function(a){null!==this._releaseCaller&&null!==this._releaseCallback&&this._releaseCallback.call(this._releaseCaller,this)};GuiControlInteractive.prototype.onPressAndRelease=function(a){null!==this._pressAndReleaseCaller&&null!==this._pressAndReleaseCallback&&this._pressAndReleaseCallback.call(this._pressAndReleaseCaller,this)};
GuiControlInteractive.prototype.onMove=function(a){null!==this._moveCaller&&null!==this._moveCallback&&this._moveCallback.call(this._moveCaller,this,a)};
GuiControlInteractive.prototype.onOver=function(a){null!==this._overCaller&&null!==this._overCallback&&this._overCallback.call(this._overCaller,this,a);this.buttonMode&&(null!==this.containerText&&(this.containerText.canvas.scale.x=1.15,this.containerText.canvas.scale.y=1.15),Application.instance.canvasEvents&&(document.getElementById("MainCanvasEvents").style.cursor="pointer"))};
GuiControlInteractive.prototype.onOut=function(a){null!==this._outCaller&&null!==this._outCallback&&this._outCallback.call(this._outCaller,this,a);null!==this.containerText&&(this.containerText.canvas.scale.x=1,this.containerText.canvas.scale.y=1);Application.instance.canvasEvents&&(document.getElementById("MainCanvasEvents").style.cursor="default")};
function GuiThumbs4State(a,b,c,d,e){GuiControlInteractive.call(this,a);this.enableLink=b||"";this.disableLink=c||"";this.selectedLink=d||"";this.commingSoonLink=e||"";this.gotoState(GuiControl.ST_ENABLE)}Application.subclass(GuiThumbs4State,GuiControlInteractive);GuiThumbs4State.prototype.setEnabled=function(a){(this.enabled=a)||this.gotoState(GuiControl.ST_DISABLE)};
GuiThumbs4State.prototype.gotoState=function(a){if(this.enabled)switch(a){case GuiControl.ST_ENABLE:""!==this.enableLink&&(this.setClip(this.enableLink),this.setInteractive(!0),this.state=a);break;case GuiControl.ST_DISABLE:""!==this.disableLink&&(this.setClip(this.disableLink),this.setInteractive(!1),this.enabled=!1,this.state=a);break;case GuiControl.ST_SELECTED:""!==this.selectedLink&&(this.setClip(this.selectedLink),this.setInteractive(!1),this.state=a);break;case GuiControl.ST_COMMING_SOON:""!==
this.commingSoonLink&&(this.setClip(this.commingSoonLink),this.setInteractive(!1),this.state=a,this.enabled=!1)}};function GuiClip(a){GuiControl.call(this,a);this.m_type=GuiControl.TYPE_CLIP}Application.subclass(GuiClip,GuiControl);GuiClip.prototype.gotoAndStop=function(a){null!=this.clip&&this.clip.gotoAndStop(a)};GuiClip.prototype.gotoAndPlay=function(a){null!=this.clip&&this.clip.gotoAndPlay(a)};GuiClip.prototype.update=function(a){null!=this.clip&&this.clip.visible&&this.clip.update(a)};
function GuiOnOff(a){GuiControlInteractive.call(this,a);this.setInteractive(!0);this.m_callbackOff=this.m_callbackOn=this.m_callerSwitch=this.m_offLink=this.m_onLink=null;this.buttonMode=!0}Application.subclass(GuiOnOff,GuiControlInteractive);GuiOnOff.prototype.free=function(){this.m_callbackOff=this.m_callbackOn=this.m_callerSwitch=this.m_offLink=this.m_onLink=null;GuiControlInteractive.prototype.free.call(this)};GuiOnOff.prototype.onTurnOn=function(a,b){this.m_callerSwitch=a;this.m_callbackOn=b};
GuiOnOff.prototype.onTurnOff=function(a,b){this.m_callerSwitch=a;this.m_callbackOff=b};GuiOnOff.prototype.setClip=function(a){GuiControlInteractive.prototype.setClip.call(this,a);null!==this.clip&&this.clip.stop()};GuiOnOff.prototype.setOnClip=function(a){this.m_onLink=a};GuiOnOff.prototype.setOffClip=function(a){this.m_offLink=a};GuiOnOff.prototype.setEnabled=function(a){GuiControlInteractive.prototype.setEnabled.call(this,a);null!==this.clip&&this.clip.gotoAndStop(this.enabled?1:4)};
GuiOnOff.prototype.gotoState=function(a){this.state=a;this.setClip(a===GuiOnOff.ST_ON?this.m_onLink:this.m_offLink)};GuiOnOff.prototype.onPress=function(a){this.enabled&&(GuiControlInteractive.prototype.onPress.call(this,a),this.state===GuiOnOff.ST_OFF?(this.gotoState(GuiOnOff.ST_ON),null!=this.m_callerSwitch&&null!=this.m_callbackOn&&this.m_callbackOn.call(this.m_callerSwitch)):this.state===GuiOnOff.ST_ON&&(this.gotoState(GuiOnOff.ST_OFF),null!=this.m_callerSwitch&&null!=this.m_callbackOff&&this.m_callbackOff.call(this.m_callerSwitch)))};
GuiOnOff.prototype.onRelease=function(a){this.enabled&&GuiControlInteractive.prototype.onRelease.call(this,a)};GuiOnOff.ST_ON=1;GuiOnOff.ST_OFF=2;function GuiButton(a){GuiControlInteractive.call(this,a);this.addOverListener(this,this.onOverCallback,this,this.onOutCallback);this.setInteractive(!0);this.buttonMode=!0}Application.subclass(GuiButton,GuiControlInteractive);GuiButton.prototype.setClip=function(a){GuiControlInteractive.prototype.setClip.call(this,a);null!==this.clip&&this.clip.gotoAndStop(1)};
GuiButton.prototype.setEnabled=function(a){GuiControlInteractive.prototype.setEnabled.call(this,a);null!==this.clip&&this.clip.gotoAndStop(this.enabled?1:4)};GuiButton.prototype.onPress=function(a){this.enabled&&(GuiControlInteractive.prototype.onPress.call(this,a),null!==this.clip&&this.clip.gotoAndStop(2))};GuiButton.prototype.onRelease=function(a){GuiControlInteractive.prototype.onRelease.call(this,a);null!==this.clip&&this.clip.gotoAndStop(this.enabled?1:4)};
GuiButton.prototype.onOverCallback=function(a){null!==this.clip&&this.clip.gotoAndStop(this.enabled?3:4);if(this.screenContainer&&!Application.instance.isMobileDevice)this.screenContainer.onUIOver(this)};GuiButton.prototype.onOutCallback=function(a){null!==this.clip&&this.clip.gotoAndStop(this.enabled?1:4);if(this.screenContainer&&!Application.instance.isMobileDevice)this.screenContainer.onUIOut(this)};
function GuiButtonState(a,b){GuiControlInteractive.call(this,a);this.nameClip=b;this.outLink=b+"_out";this.overLink=b+"_over";this.enableLink=b+"_on";this.disableLink=b+"_off";this.releaseLink=b+"_out";this.selectedLink=b+"_press";this.m_interactive=!0;this.setClip(this.enableLink);this.clip.alpha=0;this.m_instanceName="";this.m_clipState=null;this.addOverListener(this,this.onOverCallback,this,this.onOutCallback);this.gotoState(GuiControl.ST_ENABLE);this.buttonMode=!0;this.m_type=GuiControl.TYPE_ANI_BUTTON}
Application.subclass(GuiButtonState,GuiControlInteractive);GuiButtonState.prototype.free=function(){null!=this.m_clipState&&(this.m_clipState.free(),this.m_clipState=null);GuiControlInteractive.prototype.free.call(this)};GuiButtonState.prototype.setNameClipBase=function(a){this.nameClip=a;this.outLink=a+"_out";this.overLink=a+"_over";this.enableLink=a+"_on";this.disableLink=a+"_off";this.releaseLink=a+"_out";this.selectedLink=a+"_press";this.gotoState(this.state)};
GuiButtonState.prototype.setEnabled=function(a){GuiControlInteractive.prototype.setEnabled.call(this,a);this.gotoState(this.enabled?GuiControl.ST_ENABLE:GuiControl.ST_DISABLE)};GuiButtonState.prototype.setVisible=function(a){GuiControlInteractive.prototype.setVisible.call(this,a);null!=this.m_clipState&&(this.m_clipState.visible=this.isVisible)};GuiButtonState.prototype.onPress=function(a){this.enabled&&this.m_interactive&&(GuiControlInteractive.prototype.onPress.call(this,a),this.gotoState(GuiControl.ST_SELECTED))};
GuiButtonState.prototype.onRelease=function(a){this.enabled&&this.m_interactive&&(GuiControlInteractive.prototype.onRelease.call(this,a),this.state===GuiControl.ST_SELECTED&&this.gotoState(GuiControl.ST_RELEASE))};GuiButtonState.prototype.onOverCallback=function(a){if(this.state!==GuiControl.ST_OVER&&!this.onPressButton&&this.m_interactive&&(this.gotoState(GuiControl.ST_OVER),this.screenContainer&&!Application.instance.isMobileDevice))this.screenContainer.onUIOver(this)};
GuiButtonState.prototype.onOutCallback=function(a){if(this.state===GuiControl.ST_OUT||this.state===GuiControl.ST_RELEASE||this.onPressButton||!this.m_interactive){if(this.onPressButton&&(this.onPressButton=!1,this.state==GuiControl.ST_SELECTED&&(this.gotoState(GuiControl.ST_OUT),this.screenContainer&&!Application.instance.isMobileDevice)))this.screenContainer.onUIOut(this)}else if(this.state!=GuiControl.ST_RELEASE&&this.gotoState(GuiControl.ST_OUT),this.screenContainer&&!Application.instance.isMobileDevice)this.screenContainer.onUIOut(this)};
GuiButtonState.prototype.onResetState=function(){this.enabled&&(this.onPressButton=!1,this.gotoState(GuiControl.ST_ENABLE))};
GuiButtonState.prototype.setClipState=function(a,b){if(this.isVisible&&null!==this.canvas){for(null!=this.m_clipState&&this.m_clipState.free();1<this.canvas.children.length;)Application.warn("The canvas still has children! - This should not happen."),this.canvas.removeChild(this.canvas.getChildAt(1));this.m_clipState=Application.instance.getAnimation(a);if(null===this.m_clipState){this.gotoState(GuiControl.ST_ENABLE);return}this.m_clipState.visible=this.isVisible;this.m_clipState.interactive=!1;this.canvas.addChild(this.m_clipState)}this.m_interactive!=
b&&this.setInteractive(b)};GuiButtonState.prototype.onFade=function(a,b){b=b||500;this.m_clipState.visible=!0;if(this.isVisible=a){if(1===this.m_clipState.alpha)return;this.gotoState(GuiControl.ST_ENABLE);a=0;var c=1}else{if(0===this.m_clipState.alpha)return;a=1;c=0}Common.tween({parent:this,clip:this.m_clipState,alpha:a},{alpha:c},b,!0,0,TweenEasing.LinearNone);this.setInteractive(this.isVisible)};
GuiButtonState.prototype.update=function(a){null!==this.m_clipState&&this.m_clipState.visible&&(this.m_clipState.update(a),this.state!==GuiControl.ST_OUT&&this.state!==GuiControl.ST_RELEASE||this.m_clipState.currentFrame!==this.m_clipState.totalFrames-1||this.gotoState(this.enabled?GuiControl.ST_ENABLE:GuiControl.ST_DISABLE))};
GuiButtonState.prototype.gotoState=function(a){switch(a){case GuiControl.ST_ENABLE:this.setClipState(this.enableLink,!0);this.state=a;break;case GuiControl.ST_DISABLE:this.setClipState(this.disableLink,!1);this.enabled=!1;this.state=a;break;case GuiControl.ST_SELECTED:this.onPressButton=!0;this.setClipState(this.selectedLink,!0);this.state=a;break;case GuiControl.ST_RELEASE:this.setClipState(this.outLink,!0);this.state=a;break;case GuiControl.ST_OVER:this.setClipState(this.overLink,!0);this.state=
a;break;case GuiControl.ST_OUT:this.setClipState(this.outLink,!0),this.state=a}};function GuiText(a,b,c){GuiControl.call(this,a);this.align=GuiText.ALIGN_CENTER;this.valign=GuiText.ALIGN_V_MIDDLE;this.textfield=new SPixiText("",{});this.canvas.addChild(this.textfield);this.baseWidth=b||50;this.baseHeight=c||50;this.offsetX=.5*-this.baseWidth;this.offsetY=.5*-this.baseHeight;this.textfield.debugRect=new Rectangle(this.offsetX,this.offsetY,this.baseWidth,this.baseHeight)}
Application.subclass(GuiText,GuiControl);GuiText.prototype.free=function(){this.textfield&&(this.textfield.free(),this.canvas.removeChild(this.textfield),this.textfield=null);GuiControl.prototype.free.call(this)};GuiText.prototype.setText=function(a){this.textfield&&(this.textfield.text=a,GuiText.updateAlign(this))};GuiText.prototype.setTextEmpty=function(){this.setTextLocalized("STR_EMPTY")};
GuiText.prototype.setTextJoined=function(a,b,c,d){d||-1!==b.indexOf(c)?this.setTextLocalized(a+((10<=c?"":"0")+c)):Application.warn("GuiText::setTextJoined: value "+c+" not in range "+b+".")};GuiText.prototype.setTextLocalized=function(a){this.setText(Application.strings[a].value)};GuiText.prototype.setTextNumeric=function(a){"number"===typeof a?this.setText(a.toString()):Application.warn("GuiText::setTextNumeric: text not numeric.")};
GuiText.prototype.setTextRaw=function(a){Application.warn("setTextRaw: "+a);this.setText(a)};GuiText.prototype.setTextReplace=function(a,b,c){if(b.length!==c.length)Application.warn("GuiText::setTextReplace: array inputs do not have the same length.");else if(Application.strings[a]){a=Application.strings[a].value;for(var d=0;d<b.length;d++)a=a.replace(b[d],c[d]);this.setText(a)}else Application.warn("GuiText::setTextReplace: id "+a+" not found.")};
GuiText.prototype.setVisible=function(a){this.canvas.visible=a};
GuiText.updateAlign=function(a){var b=0;Application.RENDER_MODE===Application.RENDER_CANVAS&&(b=a.textfield.style.padding);if(a.textfield){switch(a.align){case GuiText.ALIGN_LEFT:a.textfield.position.x=a.offsetX-b;break;case GuiText.ALIGN_CENTER:a.textfield.position.x=.5*-a.textfield.width-b;break;case GuiText.ALIGN_RIGHT:a.textfield.position.x=.5*a.baseWidth-a.textfield.width-b}switch(a.valign){case GuiText.ALIGN_V_TOP:a.textfield.position.y=a.offsetY-b;break;case GuiText.ALIGN_V_MIDDLE:a.textfield.position.y=
.5*-a.textfield.height-b;break;case GuiText.ALIGN_V_BOTTOM:a.textfield.position.y=.5*a.baseHeight-a.textfield.height-b}}};GuiText.ALIGN_LEFT="left";GuiText.ALIGN_CENTER="center";GuiText.ALIGN_RIGHT="right";GuiText.ALIGN_V_TOP="top";GuiText.ALIGN_V_MIDDLE="center";GuiText.ALIGN_V_BOTTOM="bottom";
function GuiSlider(a,b,c,d){this.x=c;this.y=d;this.m_pressed=!1;this.canvas=a;this.m_collision=this.m_pointer=this.m_animation=null;this.m_nameClip=b;this.m_caller=this.m_callback=null;this.m_collisionPositionX=0;this.createGuiSlider();this.m_currentIdTouch=-1;this.m_lastX=this.m_virtualPointerPositionX=0}GuiSlider.HALF_TOTAL_DISTANCE=50;GuiSlider.POINTER_RADIO=15;GuiSlider.POINTER_RADIO_POW2=225;GuiSlider.POINTER_NAME_INSTANCE="pointer";GuiSlider.COLLISION_NAME_INSTANCE="mcCollision";
GuiSlider.prototype.linkFunction=function(a,b){this.m_callback=b;this.m_caller=a};
GuiSlider.prototype.createGuiSlider=function(){this.m_animation=Application.instance.getClip(this.m_nameClip);this.canvas.addChild(this.m_animation);this.m_animation.position.x=this.x;this.m_animation.position.y=this.y;this.m_pointer=this.m_animation.getInstance(GuiSlider.POINTER_NAME_INSTANCE);this.m_collision=this.m_animation.collisions[GuiSlider.COLLISION_NAME_INSTANCE];this.m_collisionPositionX=this.m_collision.x-this.m_pointer.position.x;this.m_animation.interactive=!0;this.m_animation.self=
this;this.m_animation.mousedown=function(a){this.self.onPointerPress(a)};this.m_animation.touchstart=function(a){this.self.onPointerPress(a)};this.m_animation.mouseup=function(a){this.self.onPointerRelease(a)};this.m_animation.mouseupoutside=function(a){this.self.onPointerRelease(a)};this.m_animation.touchend=function(a){this.self.onPointerRelease(a)};this.m_animation.touchendoutside=function(a){this.self.onPointerRelease(a)};this.m_animation.mousemove=function(a){this.self.onPointerMove(a)};this.m_animation.touchmove=
function(a){this.self.onPointerMove(a)}};GuiSlider.prototype.onPointerPress=function(a){if(!Application.instance.isMobileDevice||-1===this.m_currentIdTouch){var b=this.x+this.m_virtualPointerPositionX-a.data.global.x-GuiSlider.HALF_TOTAL_DISTANCE,c=this.y-a.data.global.y;b*b+c*c<GuiSlider.POINTER_RADIO_POW2&&(Application.instance.isMobileDevice&&(this.m_currentIdTouch=a.currentTouchEvent.identifier),this.m_lastX=a.data.global.x,this.m_pressed=!0)}};
GuiSlider.prototype.onPointerRelease=function(a){Application.instance.isMobileDevice&&this.m_currentIdTouch!==a.currentTouchEvent.identifier||(this.m_pressed=!1,this.m_currentIdTouch=-1,this.m_virtualPointerPositionX>2*GuiSlider.HALF_TOTAL_DISTANCE?this.m_virtualPointerPositionX=2*GuiSlider.HALF_TOTAL_DISTANCE:0>this.m_virtualPointerPositionX&&(this.m_virtualPointerPositionX=0))};
GuiSlider.prototype.onPointerMove=function(a){if((!Application.instance.isMobileDevice||this.m_currentIdTouch===a.currentTouchEvent.identifier)&&this.m_pressed){var b=a.data.global.x-this.m_lastX;this.m_lastX=a.data.global.x;this.setPointerPosition((this.m_virtualPointerPositionX+b)/(2*GuiSlider.HALF_TOTAL_DISTANCE))}};GuiSlider.prototype.setPointerPosition=function(a){this.m_virtualPointerPositionX=a*=2*GuiSlider.HALF_TOTAL_DISTANCE;this.updatePointerPosition(a)};
GuiSlider.prototype.updatePointerPosition=function(a){var b=this.m_pointerPositionX;this.m_pointerPositionX=a>2*GuiSlider.HALF_TOTAL_DISTANCE?2*GuiSlider.HALF_TOTAL_DISTANCE:0>a?0:a;this.m_pointerPositionX!==b&&(this.m_pointer.position.x=this.m_pointerPositionX-GuiSlider.HALF_TOTAL_DISTANCE,this.m_collision.x=this.m_pointer.position.x+this.m_collisionPositionX,null!==this.m_callback&&this.m_callback.call(this.m_caller,this,this.m_pointerPositionX/(2*GuiSlider.HALF_TOTAL_DISTANCE)))};
GuiSlider.prototype.free=function(){null!=this.m_animation&&(this.canvas.removeChild(this.m_animation),this.m_animation.free(),this.m_animation=null);this.canvas=this.m_caller=this.m_callback=this.m_collision=this.m_pointer=null};function GuiContent(a){GuiControl.call(this,a);this.clip=Application.instance.getEmtpyAnimation();this.canvas.addChild(this.clip)}Application.subclass(GuiContent,GuiControl);
function DataMovement(a,b){this.motionParams=null;a=Common.getParams(a);this.isLoop=1==parseInt(a.loop,10);this.isReverse=1==parseInt(a.reverse,10);this.speed=parseFloat(a.speed);this.setMotionParams(b)}DataMovement.prototype.setMotionParams=function(a){this.motionParams=[];a=a.split(";");for(var b=0;b<a.length;){var c=[],d=a[b].split(":");if(2>d.length)Application.error("DataMovement::setMotionParams(): "+a[b]);else{c.push(d[0]);d=d[1].split(",");for(var e=0;e<d.length;)c.push(d[e]),++e;this.motionParams.push(c)}++b}};
DataMovement.prototype.free=function(){this.motionParams=null};
function SActorControl(a){this.m_forceY=this.m_forceX=this.maxVerletHorizontalDisplace=this.maxVerletDownDisplace=this.maxVerletUpDisplace=this.slopeFriction=this.friction=this.elasticity=this.gravity=0;this.m_isInDashAttack=this.m_isInAction=this.m_isJumpingDown=this.m_isJumpingUp=this.m_isJumping=this.m_isRunning=!1;this.runFactor=this.walkSpeed=this.airSpeed=0;this.canClimb=this.canRun=!1;this.maxSpeedAir=this.maxSpeedFloor=0;this.m_actor=a;this.reset()}
SActorControl.prototype.free=function(){this.m_actor=null};SActorControl.prototype.forceX=function(){return this.m_forceX};SActorControl.prototype.forceY=function(){return this.m_forceY};SActorControl.prototype.isRunning=function(){return this.m_isRunning};SActorControl.prototype.isJumping=function(){return this.m_isJumping};SActorControl.prototype.isJumpingUp=function(){return this.m_isJumpingUp};SActorControl.prototype.isJumpingDown=function(){return this.m_isJumpingDown};
SActorControl.prototype.isInAction=function(){return this.m_isInAction};SActorControl.prototype.onAction=function(a){this.m_isInAction=a};SActorControl.prototype.isInDashAttack=function(){return this.m_isInDashAttack};SActorControl.prototype.reset=function(){this.m_forceY=this.m_forceX=0;this.m_isInAction=this.m_isRunning=this.m_isJumpingDown=this.m_isJumpingUp=this.m_isJumping=!1};SActorControl.prototype.loadData=function(a){this.setDefaultData(a)};SActorControl.prototype.setDefaultData=function(a){this.setData(a)};
SActorControl.prototype.setData=function(a){this.gravity=Common.getData(a,"gravity",this.gravity);this.elasticity=Common.getData(a,"elasticity",this.elasticity);this.friction=Common.getData(a,"friction",this.friction);this.slopeFriction=Common.getData(a,"slopeFriction",this.slopeFriction);this.maxVerletUpDisplace=Common.getData(a,"maxVerletUpDisplace",this.maxVerletUpDisplace);this.maxVerletDownDisplace=Common.getData(a,"maxVerletDownDisplace",this.maxVerletDownDisplace);this.maxVerletHorizontalDisplace=
Common.getData(a,"maxVerletHorizontalDisplace",this.maxVerletHorizontalDisplace)};SActorControl.prototype.update=function(a){};SActorControl.prototype.onCollision=function(a,b){};
function SActor(a,b,c,d){this.actorId=0;this.m_uniqueId=-1;this.m_skin=this.m_state="";this.m_health=this.m_depth=this.m_oldY=this.m_oldX=this.m_y=this.m_x=0;this.m_scaleY=this.m_scaleX=this.m_scale=1;this.m_flipX=this.m_isIdle=!1;this.m_clipLookingRight=!0;this.m_isAwaitingDelete=!1;this.m_isRangeControlled=!0;this.m_speed=new Vector2D;this.m_character=this.m_clip=null;this.m_canvas=Application.instance.addDisplayContainer();a.addChild(this.m_canvas);this.m_manager=this.m_config=null;this.m_type=
0;this.collisionWorldModule=this.bodyPhysics=null;this.screenY=this.screenX=0;this.setActorClip(d);this.setPosition(b,c);DebugObject.call(this)}Application.subclass(SActor,DebugObject);
SActor.prototype.free=function(){DebugObject.prototype.free.call(this);this.bodyPhysics&&(this.bodyPhysics.free(),this.bodyPhysics=null);this.collisionWorldModule&&(this.collisionWorldModule.free(),this.collisionWorldModule=null);null!==this.m_character&&(this.m_character.free(),this.m_clip=this.m_character=null);null!==this.m_clip&&(this.m_clip.free(),this.m_canvas.removeChild(this.m_clip),this.m_clip=null);this.m_canvas.parent&&this.m_canvas.parent.removeChild(this.m_canvas);this.m_manager=this.m_canvas=
this.m_speed=this.m_config=null};SActor.prototype.initPhysics=function(){};SActor.prototype.initCharacter=function(){};SActor.prototype.uniqueId=function(){return this.m_uniqueId};SActor.prototype.addFXHint=function(){};SActor.prototype.getHealth=function(){return this.m_health};SActor.prototype.setHealth=function(a){this.m_health=a};SActor.prototype.setType=function(a){this.m_type=a};SActor.prototype.getType=function(){return this.m_type};SActor.prototype.isAwaitingDelete=function(){return this.m_isAwaitingDelete};
SActor.prototype.isRangeControlled=function(){return this.m_isRangeControlled};SActor.prototype.setAwaitingDelete=function(a){this.m_isAwaitingDelete=a};SActor.prototype.setRangeControlled=function(a){this.m_isRangeControlled=a};SActor.prototype.setManager=function(a){this.m_manager=a};SActor.prototype.clip=function(){return this.m_clip};SActor.prototype.speed=function(){return this.m_speed};SActor.prototype.setSpeed=function(a,b){this.m_speed.x=a;this.m_speed.y="undefined"===typeof b?a:b};
SActor.prototype.isIdle=function(){return this.m_isIdle};SActor.prototype.depth=function(){return this.m_depth};SActor.prototype.scale=function(){return this.m_scale};SActor.prototype.setX=function(a){this.m_x=a};SActor.prototype.setY=function(a){this.m_y=a};SActor.prototype.getX=function(){return this.m_x};SActor.prototype.getY=function(){return this.m_y};SActor.prototype.flipX=function(){return this.m_flipX};SActor.prototype.canvas=function(){return this.m_canvas};
SActor.prototype.onHit=function(a,b,c,d){return!1};SActor.prototype.state=function(){return this.m_state};SActor.prototype.character=function(){return this.m_character};SActor.prototype.setActorClip=function(a){a&&(this.m_clip=Application.instance.getClip(a),this.m_canvas.addChild(this.m_clip))};SActor.prototype.setPositionPoint=function(a){this.m_x=a.x;this.m_y=a.y};SActor.prototype.setPosition=function(a,b){this.m_x=a;this.m_y=b};
SActor.prototype.setFlipX=function(a){this.m_flipX=a;null!==this.m_clip&&(a=this.m_clipLookingRight?1:-1,this.m_clip.scale.x=this.m_flipX?-this.m_scaleX*a:this.m_scaleX*a)};SActor.prototype.setScale=function(a){this.m_scale!==a&&(null!==this.m_clip&&this.m_clip.setScale(this.m_flipX?-a:a,a),this.m_scaleY=this.m_scaleX=this.m_scale=a)};
SActor.prototype.setScaleX=function(a){if(this.m_scaleX!==a){if(null!==this.m_clip){var b=this.m_clipLookingRight?1:-1;this.m_clip.scale.x=this.m_flipX?-a*b:a*b}this.m_scaleX=a}};SActor.prototype.setScaleY=function(a){this.m_scaleY!==a&&(null!==this.m_clip&&(this.m_clip.scale.y=a),this.m_scaleY=a)};SActor.prototype.setScaleXY=function(a,b){this.setScaleX(a);this.setScaleY(b)};SActor.prototype.resize=function(a,b){null!==this.m_clip&&this.setScaleXY(a/this.m_clip.width,b/this.m_clip.height)};
SActor.prototype.onEndAnimation=function(a){};SActor.prototype.gotoState=function(a,b){a!==this.m_state&&(this.characterGotoState(a,b),this.m_state=a)};SActor.prototype.getAngleWithActor=function(a){return Math.atan2(a.getY()-this.m_y,a.getX()-this.m_x)};
SActor.prototype.characterGotoState=function(a,b){a!==this.m_state&&null!==this.m_character&&(this.m_character.gotoState(a,b),this.m_clip=this.m_character.clip,a=this.m_clipLookingRight?1:-1,this.m_clip.scale.x=this.m_flipX?-this.m_scaleX*a:this.m_scaleX*a,this.m_clip.scale.y=this.m_scaleY)};SActor.prototype.saveData=function(){};SActor.prototype.update=function(a){this.onDebugUpdate(a);this.render(a)};
SActor.prototype.render=function(a){null!==this.m_character?(this.m_character.setPosition(this.m_x,this.m_y),this.m_character.update(a)):null!==this.m_clip&&(this.m_clip.setPosition(this.m_x,this.m_y),this.m_clip.update(a))};SActor.prototype.onCollisionActor=function(a,b){return!1};SActor.prototype.onCollisionBullet=function(a){return!1};
SActor.prototype.hitTest=function(a,b,c){b="undefined"!==typeof b?b:"mcCollision";c="undefined"!==typeof c?c:"mcCollision";return null===a||"undefined"===typeof a.clip||null===a.clip()||null===a.clip().getCollision(c)||null===this.m_clip||null===this.m_clip.getCollision(b)?!1:SDisplayObjectContainer.hitTestByBounds(this.m_clip,this.m_clip.getCollision(b),a.clip(),a.clip().getCollision(c))};SActor.prototype.isInCamera=function(a){return!0};
SActor.prototype.onIdle=function(a){this.m_isIdle=a;null!==this.m_clip&&(this.m_clip.visible=!a);this.bodyPhysics&&this.bodyPhysics.setAwake(!a)};SActor.prototype.onDebugDraw=function(a){};
function SCamera(a,b,c,d,e,f,g){this.m_x="undefined"!==typeof f?f:0;this.m_y="undefined"!==typeof g?g:0;this.m_world=a;this.m_fixedX=this.m_world.cameraXMin===this.m_world.cameraXMax;this.m_fixedY=this.m_world.cameraYMax===this.m_world.cameraYMin;this.m_scale=1;this.m_width=b;this.m_height=c;this.screenX="undefined"!==typeof d?d:0;this.screenY="undefined"!==typeof e?e:0;this.leftLimit=Math.round(this.m_world.cameraXMin*this.m_width);this.rightLimit=Math.round(this.m_world.cameraXMax*this.m_width);
this.upLimit=Math.round(this.m_world.cameraYMin*this.m_height);this.downLimit=Math.round(this.m_world.cameraYMax*this.m_height);this.parallaxX=this.m_world.width()>this.m_width;this.parallaxY=this.m_world.height()>this.m_height;this.m_freeDebugMove=!1}SCamera.DEBUG_DISPLACE=20;SCamera.prototype.free=function(){this.m_world=null};SCamera.prototype.toggleDebugFreeMove=function(){this.m_freeDebugMove=!this.m_freeDebugMove};
SCamera.prototype.updateLimits=function(){this.leftLimit=Math.round(this.m_world.cameraXMin*this.m_width);this.rightLimit=Math.round(this.m_world.cameraXMax*this.m_width);this.upLimit=Math.round(this.m_world.cameraYMin*this.m_height);this.downLimit=Math.round(this.m_world.cameraYMax*this.m_height)};SCamera.prototype.getX=function(){return this.m_x};SCamera.prototype.getY=function(){return this.m_y};SCamera.prototype.setX=function(a){this.m_x=a};SCamera.prototype.setY=function(a){this.m_y=a};
SCamera.prototype.setPosition=function(a,b){this.m_x=a;this.m_y=b};SCamera.prototype.setFixedX=function(a){this.m_fixedX=a};SCamera.prototype.setFixedY=function(a){this.m_fixedY=a};SCamera.prototype.setFixed=function(a){this.m_fixedY=this.m_fixedX=a};SCamera.prototype.scale=function(){return this.m_scale};SCamera.prototype.width=function(){return this.m_width};SCamera.prototype.height=function(){return this.m_height};SCamera.prototype.setWidth=function(a){this.m_width=a};
SCamera.prototype.setHeight=function(a){this.m_height=a};SCamera.prototype.setScale=function(a){this.m_scale=a;this.m_world.setScale(a)};SCamera.prototype.onKeyDown=function(a){this.m_freeDebugMove&&(a===Common.KEY_RIGHT?this.m_x+=SCamera.DEBUG_DISPLACE:a===Common.KEY_LEFT&&(this.m_x-=SCamera.DEBUG_DISPLACE),a===Common.KEY_UP?this.m_y-=SCamera.DEBUG_DISPLACE:a===Common.KEY_DOWN&&(this.m_y+=SCamera.DEBUG_DISPLACE))};SCamera.prototype.onKeyUp=function(a){};
SCamera.prototype.update=function(a){!this.m_freeDebugMove&&(a=this.m_world.actorManager().getUpdateableObject()||this.m_world.player())&&(this.m_fixedX||(this.m_x+this.leftLimit>a.getX()&&(this.m_x=a.getX()-this.leftLimit),this.m_x+this.rightLimit<a.getX()&&(this.m_x=a.getX()-this.rightLimit)),this.m_fixedY||(this.m_y+this.upLimit>a.getY()&&(this.m_y=a.getY()-this.upLimit),this.m_y+this.downLimit<a.getY()&&(this.m_y=a.getY()-this.downLimit)));this.m_world.isLoop||(this.m_x>this.m_world.width()-this.width()&&
(this.m_x=this.m_world.width()-this.width()),0>this.m_x&&(this.m_x=0),this.m_y>this.m_world.height()-this.height()&&(this.m_y=this.m_world.height()-this.height()),0>this.m_y&&(this.m_y=0))};SCamera.prototype.onDebugDraw=function(a){ContextGraphics.drawRectangle(a,0,0,this.width,this.height,4,Common.COLOR_RED,Common.COLOR_NONE)};function SCollisionPoint(a,b,c,d){this.position=new Vector2D(a,b);this.normal=new Vector2D(c,d)}SCollisionPoint.prototype.free=function(){this.normal=this.position=null};
SCollisionPoint.prototype.toString=function(){return"\n[COLL] "+this.position+" "+this.normal};function SConditionalType(){}SConditionalType.AND=0;SConditionalType.OR=1;function SConditional(a,b,c){this.m_id=a;this.m_callbackEval=b;this.m_idCaller=c}SConditional.prototype.id=function(){return this.m_id};SConditional.prototype.evalue=function(){return this.m_callbackEval.call(this.m_idCaller,this)};
function SConditionalChecker(a,b){"undefined"===typeof b&&(b=-1);SConditional.call(this,b,null,null);this.m_isAnd=a===SConditionalType.AND;this.m_conditions=[]}Application.subclass(SConditionalChecker,SConditional);SConditionalChecker.prototype.addCondition=function(a){this.m_conditions.push(a)};
SConditionalChecker.prototype.evalue=function(){for(var a=this.m_isAnd,b=0;b<this.m_conditions.length;b++)if(this.m_isAnd){if(a=a&&this.m_conditions[b].evalue(),!a)return!1}else if(a=a||this.m_conditions[b].evalue())return!0;return a};function SNpc(){this.y=this.x=this.id=0;this.kipuIndex=-1;this.params=this.kipuName="";this.rawData=null;this.layerIndex=0}SNpc.prototype.free=function(){this.rawData=null};
function SNpcManager(a){this.m_world=a;this.m_showCollisions=!1;this.m_buffer=[];this.m_actors=[];this.m_updateableObject=this.m_player=null}SNpcManager.prototype.free=function(){var a;for(a=0;a<this.m_buffer.length;a++)this.m_buffer[a].free();this.m_buffer=null;for(a=0;a<this.m_actors.length;a++)this.m_actors[a].free(),this.m_actors[a]=null;this.m_world=this.m_actors=null};SNpcManager.prototype.collisionsOn=function(){return this.m_showCollisions};SNpcManager.prototype.getActors=function(){return this.m_actors};
SNpcManager.prototype.init=function(a){};SNpcManager.prototype.showCollision=function(a){this.m_showCollisions=a};SNpcManager.prototype.addNpc=function(a){this.m_buffer.push(a)};SNpcManager.prototype.add=function(a){a.setManager(this);this.m_actors.push(a);return a};SNpcManager.prototype.setUpdateableObject=function(a){this.m_updateableObject=a};SNpcManager.prototype.getUpdateableObject=function(){return this.m_updateableObject};
SNpcManager.prototype.saveData=function(){null!==this.m_player&&this.m_player.saveData();for(var a=this.m_actors.length-1;0<=a;a--)this.m_actors[a]&&this.m_actors[a].saveData()};
SNpcManager.prototype.update=function(a){for(var b=0;b<this.m_actors.length;b++)if(this.m_actors[b].isAwaitingDelete())this.m_actors[b].free(),this.m_actors[b]=null,this.m_actors.splice(b--,1);else if(this.m_actors[b].isRangeControlled())if(this.m_actors[b].isInCamera()){if(this.m_actors[b].isIdle())this.m_actors[b].onIdle(!1);this.m_actors[b].update(a)}else{if(!this.m_actors[b].isIdle())this.m_actors[b].onIdle(!0);this.m_actors[b].movementUpdate&&this.m_actors[b].movementUpdate(a)}else this.m_actors[b].update(a)};
SNpcManager.prototype.fixGameScale=function(){};SNpcManager.prototype.getActorByUniqueID=function(a){for(var b=0;b<this.m_actors.length;++b)if(this.m_actors[b].uniqueId()===a)return this.m_actors[b];return null};SNpcManager.prototype.refreshCollideModuleActors=function(){for(var a=0;a<this.m_actors.length;a++)this.m_actors[a].collisionWorldModule&&(this.m_actors[a].collisionWorldModule.dirty=!0)};SNpcManager.prototype.onDebugDraw=function(a){for(var b=0;b<this.m_actors.length;b++)this.m_actors[b].onDebugDraw(a)};
function SWorld(a,b){this.playerInitY=this.playerInitX=0;this.showCollisions=!1;this.cameraInitHeight=this.cameraInitWidth=this.cameraInitY=this.cameraInitX=this.cameraXMin=this.cameraXMax=this.cameraYMin=this.cameraYMax=this.cameraScreenY=this.cameraScreenX=this.cameraHeight=this.cameraWidth=0;this.useEmbeddedAssets=!1;this.m_pointY=this.m_pointX=this.m_height=this.m_width=this.m_rangeTilesBelow=0;this.m_game=b;this.m_layers=[];this.m_playerCanvas=null;this.m_objectsCanvas=[];this.m_player=null;
this.m_layerNames={};this.physicsLayer=this.m_markers=this.m_mapWords=this.m_worldData=this.m_actorManager=this.m_camera=this.m_collisions=null;this.canvas=a;this.m_mapPaths={};this.usePhysicCollision=this.isLoop=this.dirtyCollisionMatrix=!1}SWorld.LAYER_EFFECTS_NAME="effects";
SWorld.prototype.free=function(){null!==this.m_player&&this.m_player.free();null!==this.m_actorManager&&this.m_actorManager.free();this.m_playerCanvas!==this.m_objectsCanvas[0]&&this.canvas.removeChild(this.m_playerCanvas);for(var a=this.m_objectsCanvas.length-1;0<=a;a--)this.canvas.removeChild(this.m_objectsCanvas[a]);null!==this.m_camera&&this.m_camera.free();for(a=0;a<this.m_layers.length;a++)this.m_layers[a].free(),this.m_layers[a]=null;this.canvas=this.m_mapWords=this.m_worldData=this.m_actorManager=
this.m_camera=this.m_collisions=this.m_layerNames=this.m_player=this.m_objectsCanvas=this.m_playerCanvas=this.m_markers=this.m_layers=this.m_game=null};SWorld.prototype.showPhysicZone=function(a,b,c,d,e){};SWorld.MAX_SCAN_FLOOR=750;
SWorld.prototype.scaleWorld=function(){Application.WIDE_SCREEN?0!==Layout.left?(this.m_camera.setWidth(Math.floor((this.cameraWidth+2*Layout.left/Layout.scale)/Global.baseScale)),this.m_camera.setHeight(Math.floor(this.cameraHeight/Global.baseScale))):0!==Layout.top?(this.m_camera.setWidth(Math.floor(this.cameraWidth/Global.baseScale)),this.m_camera.setHeight(Math.floor((this.cameraHeight+2*Layout.top/Layout.scale)/Global.baseScale))):(this.m_camera.setWidth(Math.floor(this.cameraWidth/Global.baseScale)),
this.m_camera.setHeight(Math.floor(this.cameraHeight/Global.baseScale))):(this.m_camera.setWidth(Math.floor(this.cameraWidth/Global.baseScale)),this.m_camera.setHeight(Math.floor(this.cameraHeight/Global.baseScale)));this.m_camera.updateLimits();null!==this.m_actorManager&&this.m_actorManager.fixGameScale()};SWorld.prototype.game=function(){return this.m_game};SWorld.prototype.setScale=function(a){};SWorld.prototype.setX=function(a){for(var b=0;b<this.m_layers.length;b++)this.m_layers[b].setX(a)};
SWorld.prototype.setY=function(a){for(var b=0;b<this.m_layers.length;b++)this.m_layers[b].setY(a)};SWorld.prototype.objectCanvas=function(){return this.m_objectsCanvas[0]};SWorld.prototype.player=function(){return this.m_player};SWorld.prototype.camera=function(){return this.m_camera};SWorld.prototype.width=function(){return this.m_width};SWorld.prototype.height=function(){return this.m_height};SWorld.prototype.tileWidth=function(){return this.m_collisions.tileWidth()};
SWorld.prototype.tileHeight=function(){return this.m_collisions.tileHeight()};SWorld.prototype.actorManager=function(){return this.m_actorManager};SWorld.prototype.getLayer=function(a){return this.m_layerNames[a]};
SWorld.prototype.onCreate=function(a,b){this.m_worldData=window[a];this.m_mapWords=this.m_worldData.mapWords;a=this.m_worldData.properties;this.m_width=this.getData(a,"width");this.m_height=this.getData(a,"height");this.showCollisions=1===this.getData(a,"showCollisions");Application.instance.isMobileDevice&&(this.showCollisions=!1);this.playerInitX=this.getData(a,"playerX");this.playerInitY=this.getData(a,"playerY");this.cameraInitWidth=this.cameraWidth=this.getData(a,"cameraWidth");this.cameraInitHeight=
this.cameraHeight=this.getData(a,"cameraHeight");0>=this.cameraWidth&&(this.cameraWidth=Application.APP_WIDTH);0>=this.cameraHeight&&(this.cameraHeight=Application.APP_HEIGHT);this.cameraScreenX=this.getData(a,"cameraScreenX");this.cameraScreenY=this.getData(a,"cameraScreenY");this.cameraYMax=this.getData(a,"cameraYMax");this.cameraYMin=this.getData(a,"cameraYMin");this.cameraXMax=this.getData(a,"cameraXMax");this.cameraXMin=this.getData(a,"cameraXMin");this.useEmbeddedAssets=this.getData(a,"useEmbeddedAssets");
this.usePhysicCollision=1===this.getData(a,"usePhysicCollision");this.isLoop=1===this.getData(a,"isLoop");this.createCamera();this.createNpcManagers();this.createLayers()};SWorld.prototype.createCamera=function(){this.m_camera=new SCamera(this,this.cameraWidth,this.cameraHeight,this.cameraScreenX,this.cameraScreenY);this.m_width<=this.cameraWidth+100&&(this.m_camera.setFixedX(!0),this.m_camera.setX(0));this.m_height<=this.cameraHeight+100&&(this.m_camera.setFixedY(!0),this.m_camera.setY(0));this.scaleWorld()};
SWorld.prototype.createNpcManagers=function(){};SWorld.prototype.addNpc=function(a){var b=new SNpc;b.id=a.id;b.x=a.x;b.y=a.y;b.params=a.params;b.rawData=a;this.m_actorManager.addNpc(b)};
SWorld.prototype.createLayers=function(){this.m_layerNames={};var a,b=this.m_worldData.layerTypes;for(a=0;a<b.length;a++)this.addLayer(b[a].type,b[a]);null===this.m_playerCanvas&&(this.m_playerCanvas=this.m_objectsCanvas[0]);this.m_layerNames[SWorld.LAYER_EFFECTS_NAME]||(a=new SWorldContainerLayer(this,{}),this.m_layerNames[SWorld.LAYER_EFFECTS_NAME]=a,this.m_layers.push(a));this.m_worldData=null;b=this.m_actorManager.m_buffer;var c=[];for(a=0;a<b.length;a++){var d=EDIUtils.checkNpcToClone(b[a],this);
d&&(c=c.concat(d),b.splice(a,1),a--)}this.m_actorManager.m_buffer=b.concat(c)};SWorld.prototype.registerLayer=function(a){this.m_layerNames[a.name()]&&Application.error("Layer with name ["+a.name()+"] is duplicate please rename layer in EDI");this.m_layerNames[a.name()]=a;this.m_layers.push(a)};
SWorld.prototype.addLayer=function(a,b){if(a===SWorldBaseLayer.ID_OBJECTS){a=new SWorldContainerLayer(this,b);this.registerLayer(a);this.m_objectsCanvas.push(a.canvas());var c=b.object;c.layerIndex=this.m_objectsCanvas.length-1;for(b=0;b<c.length;b++){var d={};for(a=0;a<c[b].length;a+=2)0<=c[b][a]?d[this.m_mapWords[c[b][a]]]=c[b][a+1]:d[this.m_mapWords[-c[b][a]]]=this.m_mapWords[c[b][a+1]];this.addNpc(d)}}else if(a===SWorldBaseLayer.ID_SPRITES)a=new SWorldSpriteLayer(this,b),this.registerLayer(a);
else if(a!==SWorldBaseLayer.ID_BOX2D)if(a===SWorldBaseLayer.ID_PLAYER)a=new SWorldContainerLayer(this,b),this.m_playerCanvas=a.canvas(),this.registerLayer(a);else if(a===SWorldBaseLayer.ID_MARKERS)null===this.m_markers?(this.m_markers=new SWorldMarkerLayer(this,b),this.m_layers.push(this.m_markers)):this.m_markers.loadData(b);else if(a===SWorldBaseLayer.ID_PATHS)for(a=0;a<=b.object.length;a++)b.object[a]&&(c=b.object[a].id,this.m_mapPaths[c]&&Application.error("Path id ["+c+"] is duplicated"),this.m_mapPaths[c]=
b.object[a]);else a===SWorldBaseLayer.ID_COLLISIONS?(this.m_collisions=new SWorldCollisionLayer(this,b),this.registerLayer(this.m_collisions),this.m_rangeTilesBelow=2*this.m_collisions.tileHeight()):(a=a===SWorldBaseLayer.ID_CONTAINER?new SWorldContainerLayer(this,b):new SWorldTileLayer(this,b,!0),this.registerLayer(a))};SWorld.prototype.getPath=function(a){a="string"===typeof a?parseInt(a,10):a;return EDIUtils.getPointsFromShape(this.m_mapPaths[a])||null};
SWorld.prototype.checkZones=function(a){if(null!==this.m_markers)for(var b=this.m_markers.actionZones.length,c=0;c<b;c++){var d=this.m_markers.actionZones[c];null!==a.getBounds()&&d.intersectRect(a.getBounds())?d.active||(d.active=!0,a.onEnterZone(d)):d.active&&(d.active=!1,a.onLeaveZone(d))}};SWorld.prototype.createEffect=function(a,b,c,d,e){return Application.instance.effectManager.createEffect(a,b,c,e||this.getLayer(SWorld.LAYER_EFFECTS_NAME).canvas(),d)};
SWorld.prototype.init=function(){this.setX(this.m_camera.screenX);this.setY(this.m_camera.screenY);for(var a=0;a<this.m_layers.length;a++)this.m_layers[a].init()};SWorld.prototype.getTileBelow=function(a,b){if(null!==this.m_collisions)return this.m_collisions.getTileBelow(a,b,this.m_rangeTilesBelow);Application.error("getTileBelow: no collisions");return SWorldCollisionLayer.CELL_EMPTY};
SWorld.prototype.getFloorCollision=function(a,b){if(null!==this.m_collisions)return this.m_collisions.getFloorCollision(a,b);Application.error("getFloorCollision: no collisions");return new Vector2D(a,b)};SWorld.prototype.getMaxFloorRange=function(a,b,c){if(null!==this.m_collisions)return"undefined"===typeof c&&(c=SWorld.MAX_SCAN_FLOOR),this.m_collisions.getMaxFloorRange(a,b,c);Application.error("getMaxFloorRange: no collisions");return new Rectangle(a,b)};
SWorld.prototype.getMaxFloorRangeElevations=function(a,b,c){if(null!==this.m_collisions)return"undefined"===typeof c&&(c=SWorld.MAX_SCAN_FLOOR),this.m_collisions.getMaxFloorRangeElevations(a,b,c);Application.error("getMaxFloorRangeElevations: no collisions");return new Rectangle(a,b)};SWorld.prototype.getRayCollision=function(a,b,c,d){if(null!==this.m_collisions)return this.m_collisions.getRayCollision(a,b,c,d);Application.error("getRayCollision: no collisions");return null};
SWorld.prototype.objectsCanvas=function(a){return this.m_objectsCanvas["undefined"!==typeof a?a:0]};SWorld.prototype.showCollision=function(a){this.m_collisions&&this.m_collisions.setVisible(a)};SWorld.prototype.refreshCollision=function(){};SWorld.prototype.setCollisionCell=function(a,b,c){this.m_collisions.setCell(a,b,c)};SWorld.prototype.getTilePosition=function(a,b){return this.m_collisions.getTilePosition(a,b)};
SWorld.prototype.setRangeCollisionCell=function(a,b,c,d,e,f){for(;a<=c;a++)for(var g=b;g<=d;g++)this.setCollisionCell(a,g,e);f&&this.refreshCollision()};SWorld.prototype.getCellInPosition=function(a,b){return this.m_collisions.getCellInPosition(a,b)};SWorld.prototype.getCell=function(a,b){return this.m_collisions.getCell(a,b)};
SWorld.prototype.checkWorldBoundaries=function(a){var b=a.bounds();null!==b&&(a.limitLeft()&&a.getX()+b.left()<this.m_collisions.tileWidth()&&a.setX(this.m_collisions.tileWidth()-b.left()),a.limitRight()&&a.getX()+b.right()>this.m_width-this.m_collisions.tileWidth()&&a.setX(this.m_width-this.m_collisions.tileWidth()-b.right()),a.limitUp()&&0>=a.getY()+b.top()&&a.setY(-b.top()),a.limitBottom()&&a.getY()+b.bottom()>=this.m_height&&a.setY(this.m_height-b.bottom()))};
SWorld.prototype.checkCollision=function(a){var b=new Vector2D(0,0),c=a.corners();if(null!==c){for(var d=!1,e=0;e<c.length;e++)if(c[e]){var f=c[e];this.m_pointX=~~(a.getX()+f.position.x);this.m_pointY=~~(a.getY()+f.position.y);var g=this.m_collisions.checkCollision(this.m_pointX,this.m_pointY,f.normal,a);g&&(0==b.x&&0!=g.x&&(b.x+=g.x),0==b.y&&0!=g.y&&(b.y+=g.y));!d&&(g=this.m_collisions.checkPlatforms(this.m_pointX,this.m_pointY,f.normal,a))&&(d=!0,0==b.x&&0!=g.x&&(b.x+=g.x),0==b.y&&0!=g.y&&(b.y+=
g.y));if(0!==b.x&&0!==b.y)break}return 0!==b.y||0!==b.x?b:null}};SWorld.prototype.update=function(a){var b;this.m_camera.update(a);this.m_actorManager.update(a);for(b=0;b<this.m_layers.length;b++)this.m_layers[b].visible()&&this.m_layers[b].render(a);this.m_player&&this.m_player.update(a);this.dirtyCollisionMatrix&&(this.m_player.collisionWorldModule&&(this.m_player.collisionWorldModule.dirty=!0),this.m_actorManager&&this.m_actorManager.refreshCollideModuleActors(),this.dirtyCollisionMatrix=!1)};
SWorld.prototype.addMobilePlatform=function(a){this.m_collisions.addMobilePlatform(a)};SWorld.prototype.getData=function(a,b){if(null===a)Application.error("World:: data is null");else if(null===b)Application.error("World:: data is null: "+b);else{if("undefined"!==typeof a[b])return a[b];Application.error("Property ["+b+"] in EDI Map not found")}};
SWorld.prototype.getOptionalData=function(a,b,c){if("undefined"===typeof a)Application.error("World:: data is undefined");else if("undefined"===typeof b)Application.error("World:: data is undefined: "+b);else{if("undefined"!==typeof a[b])return a[b];Application.error("Optional property not found: "+b+" using: "+c);return c}};SWorld.prototype.onDebugDraw=function(a){if(this.m_player)this.m_player.onDebugDraw(a);this.m_actorManager.onDebugDraw(a);this.m_camera.onDebugDraw(a)};
function SWorldActor(a,b,c,d,e){this.m_skin=this.m_state="";this.m_className="SWorldActor";this.m_depth=this.m_y=this.m_oldY=this.m_oldX=this.m_x=0;this.m_uniqueId=-1;this.m_magic=this.m_health=0;this.m_scaleY=this.m_scaleX=this.m_scale=1;this.m_indexCornersArray=0;this.m_flipX=this.m_limitRight=this.m_limitLeft=this.m_limitUp=this.m_limitBottom=this.m_isVehicle=this.m_isIdle=!1;this.m_clipLookingRight=!0;this.m_isAwaitingDelete=!1;this.m_isRangeControlled=!0;this.m_climbEnabled=this.m_isFallingOverWall=
!1;this.m_speed=new Vector2D;this.m_clip=this.m_boundsAttack=this.m_bounds=null;this.m_cornersArray=[];this.m_control=this.m_manager=this.m_vehicle=this.m_character=this.pathPosition=this.m_corners=null;this.m_canvas=a;this.m_world=b;this.m_config=this.m_movement=null;this.setActorClip(e);this.setPosition(c,d);DebugObject.call(this)}Application.subclass(SWorldActor,DebugObject);
SWorldActor.prototype.free=function(){DebugObject.prototype.free.call(this);if(null!==this.m_cornersArray)for(var a=0;a<this.m_cornersArray.length;a++)this.m_cornersArray[a]=null;if(null!==this.m_corners)for(a=this.m_corners.length-1;0<=a;a--)null!==this.m_corners[a]&&this.m_corners.splice(a,1)[0].free();null!==this.m_character&&(this.m_character.free(),this.m_clip=this.m_character=null);null!==this.m_clip&&(this.m_clip.free(),this.m_canvas.removeChild(this.m_clip),this.m_clip=null);null!==this.m_control&&
(this.m_control.free(),this.m_control=null);null!==this.m_movement&&(this.m_movement.free(),this.m_movement=null);this.m_world=this.m_canvas=this.m_manager=this.m_vehicle=this.m_corners=this.pathPosition=this.m_cornersArray=this.m_boundsAttack=this.m_bounds=this.m_speed=this.m_config=null};SWorldActor.ID_UNUSED=-1;SWorldActor.prototype.getClassName=function(){return this.m_className};SWorldActor.prototype.getHealth=function(){return this.m_health};
SWorldActor.prototype.setHealth=function(a){this.m_health=a};SWorldActor.prototype.isAwaitingDelete=function(){return this.m_isAwaitingDelete};SWorldActor.prototype.isRangeControlled=function(){return this.m_isRangeControlled};SWorldActor.prototype.isFallingOverWall=function(){return this.m_isFallingOverWall};SWorldActor.prototype.vehicle=function(){return this.m_vehicle};SWorldActor.prototype.isVehicle=function(){return this.m_isVehicle};
SWorldActor.prototype.setAwaitingDelete=function(a){this.m_isAwaitingDelete=a};SWorldActor.prototype.setRangeControlled=function(a){this.m_isRangeControlled=a};SWorldActor.prototype.setFallingOverWall=function(a){this.m_isFallingOverWall=a};SWorldActor.prototype.setVehicle=function(a){this.m_vehicle=a};SWorldActor.prototype.setManager=function(a){this.m_manager=a};SWorldActor.prototype.clip=function(){return this.m_clip};SWorldActor.prototype.bounds=function(){return this.m_bounds};
SWorldActor.prototype.speed=function(){return this.m_speed};SWorldActor.prototype.world=function(){return this.m_world};SWorldActor.prototype.control=function(){return this.m_control};SWorldActor.prototype.limitBottom=function(){return this.m_limitBottom};SWorldActor.prototype.limitUp=function(){return this.m_limitUp};SWorldActor.prototype.limitLeft=function(){return this.m_limitLeft};SWorldActor.prototype.limitRight=function(){return this.m_limitRight};SWorldActor.prototype.isIdle=function(){return this.m_isIdle};
SWorldActor.prototype.depth=function(){return this.m_depth};SWorldActor.prototype.scale=function(){return this.m_scale};SWorldActor.prototype.magic=function(){return this.m_magic};SWorldActor.prototype.getOldX=function(){return this.m_oldX};SWorldActor.prototype.setX=function(a){this.m_x=a};SWorldActor.prototype.setY=function(a){this.m_y=a};SWorldActor.prototype.setOldX=function(a){this.m_oldX=a};SWorldActor.prototype.setOldY=function(a){this.m_oldY=a};SWorldActor.prototype.getOldY=function(){return this.m_oldY};
SWorldActor.prototype.getX=function(){return this.m_x};SWorldActor.prototype.getY=function(){return this.m_y};SWorldActor.prototype.uniqueId=function(){return this.m_uniqueId};SWorldActor.prototype.flipX=function(){return this.m_flipX};SWorldActor.prototype.canvas=function(){return this.m_canvas};SWorldActor.prototype.onHit=function(a,b,c,d){return!1};SWorldActor.prototype.state=function(){return this.m_state};SWorldActor.prototype.character=function(){return this.m_character};
SWorldActor.prototype.onEnterZone=function(a){a.type===SEdiZone.CLIMB&&(this.m_climbEnabled=!0)};SWorldActor.prototype.onLeaveZone=function(a){a.type===SEdiZone.CLIMB&&(this.m_climbEnabled=!1)};SWorldActor.prototype.setActorClip=function(a){"undefined"!==typeof a&&(this.m_clip=Application.instance.getClip(a),this.m_clip.position.x=this.m_x,this.m_clip.position.y=this.m_y,this.m_canvas.addChild(this.m_clip),this.createCorners())};
SWorldActor.prototype.setPositionPoint=function(a){this.m_oldX=this.m_x=a.x;this.m_oldY=this.m_y=a.y};SWorldActor.prototype.setPosition=function(a,b){this.m_oldX=this.m_x=a;this.m_oldY=this.m_y=b};SWorldActor.prototype.setFlipX=function(a){this.m_flipX=a;null!==this.m_clip&&(a=this.m_clipLookingRight?1:-1,this.m_clip.scale.x=this.m_flipX?-this.m_scaleX*a:this.m_scaleX*a,this.createCorners())};
SWorldActor.prototype.setScale=function(a){this.m_scale!==a&&(null!==this.m_clip&&this.m_clip.setScale(this.m_flipX?-a:a,a),this.m_scaleY=this.m_scaleX=this.m_scale=a,this.createCorners())};SWorldActor.prototype.setScaleX=function(a){if(this.m_scaleX!==a){if(null!==this.m_clip){var b=this.m_clipLookingRight?1:-1;this.m_clip.scale.x=this.m_flipX?-a*b:a*b}this.m_scaleX=a;this.createCorners()}};
SWorldActor.prototype.setScaleY=function(a){this.m_scaleY!==a&&(null!==this.m_clip&&(this.m_clip.scale.y=a),this.m_scaleY=a,this.createCorners())};SWorldActor.prototype.setScaleXY=function(a,b){this.setScaleX(a);this.setScaleY(b)};SWorldActor.prototype.resize=function(a,b){null!==this.m_clip&&this.setScaleXY(a/this.m_clip.width,b/this.m_clip.height)};SWorldActor.prototype.getBounds=function(){return null!==this.m_bounds?this.m_bounds.clone():null};
SWorldActor.prototype.boundsAttack=function(){return null!==this.m_boundsAttack?this.m_boundsAttack.clone():null};SWorldActor.prototype.getBoundsAttack=function(){return null!==this.m_boundsAttack?new Rectangle(this.m_x+this.m_boundsAttack.x,parseFloat(this.m_y+this.m_boundsAttack.y),this.m_boundsAttack.w,this.m_boundsAttack.h):null};
SWorldActor.prototype.createCorners=function(){var a=null;null!==this.m_bounds&&(a=new Rectangle,a.x=this.m_bounds.x,a.y=this.m_bounds.y,a.w=this.m_bounds.w,a.h=this.m_bounds.h);if(null!==a){this.m_corners=[];var b=this.m_scaleX,c=this.m_scaleY;this.m_scaleX===this.m_scaleY&&(this.m_scale=this.m_scaleX);this.m_corners.push(new SCollisionPoint(b*(a.x+a.w),c*(a.y+a.h),1,1));Math.abs(b*a.w)>this.m_world.tileWidth()?this.m_corners.push(new SCollisionPoint(b*(a.x+.5*a.w),c*(a.y+a.h),0,1)):this.m_corners.push(null);
this.m_corners.push(new SCollisionPoint(b*a.x,c*(a.y+a.h),-1,1));c*a.h>3*this.m_world.tileHeight()?(this.m_corners.push(new SCollisionPoint(b*(a.x+a.w),c*(a.y+.75*a.h),1,0)),this.m_corners.push(new SCollisionPoint(b*a.x,c*(a.y+.75*a.h),-1,0)),this.m_corners.push(new SCollisionPoint(b*(a.x+a.w),c*(a.y+.5*a.h),1,0)),this.m_corners.push(new SCollisionPoint(b*a.x,c*(a.y+.5*a.h),-1,0)),this.m_corners.push(new SCollisionPoint(b*(a.x+a.w),c*(a.y+.25*a.h),1,0)),this.m_corners.push(new SCollisionPoint(b*a.x,
c*(a.y+.25*a.h),-1,0))):c*a.h>2*this.m_world.tileHeight()?(this.m_corners.push(new SCollisionPoint(b*(a.x+a.w),c*(a.y+.67*a.h),this.m_flipX?-1:1,0)),this.m_corners.push(new SCollisionPoint(b*a.x,c*(a.y+.67*a.h),-1,0)),this.m_corners.push(null),this.m_corners.push(null),this.m_corners.push(new SCollisionPoint(b*(a.x+a.w),c*(a.y+.33*a.h),this.m_flipX?-1:1,0)),this.m_corners.push(new SCollisionPoint(b*a.x,c*(a.y+.33*a.h),-1,0))):(c*a.h>this.m_world.tileHeight()?(this.m_corners.push(null),this.m_corners.push(null),
this.m_corners.push(new SCollisionPoint(b*(a.x+a.w),c*(a.y+.5*a.h),1,0)),this.m_corners.push(new SCollisionPoint(b*a.x,c*(a.y+.5*a.h),-1,0))):(this.m_corners.push(null),this.m_corners.push(null),this.m_corners.push(null),this.m_corners.push(null)),this.m_corners.push(null),this.m_corners.push(null));this.m_corners.push(new SCollisionPoint(b*(a.x+a.w),c*a.y,1,-1));Math.abs(b*a.w)>this.m_world.tileWidth()?this.m_corners.push(new SCollisionPoint(b*(a.x+.5*a.w),c*a.y,0,-1)):this.m_corners.push(null);
this.m_corners.push(new SCollisionPoint(b*a.x,c*a.y,-1,-1));this.m_cornersArray=[];this.m_cornersArray.push([]);this.m_cornersArray.push([]);this.m_cornersArray.push([]);this.m_cornersArray.push([]);a=[];a.push([0,1,3,2,5,7,9]);a.push([2,1,4,0,6,8,11]);a.push([9,10,7,11,5,3,0]);a.push([11,10,8,9,6,4,2]);for(b=0;b<this.m_cornersArray.length;b++)for(c=0;c<a[b].length;c++)null!==this.m_corners[a[b][c]]&&this.m_cornersArray[b].push(this.m_corners[a[b][c]])}else this.m_cornersArray=null;this.updateBounds()};
SWorldActor.prototype.updateBounds=function(){this.m_bounds=null;null!==this.m_clip&&"undefined"!==typeof this.m_clip.getCollision&&(this.m_bounds=this.m_clip.getCollision("mcCollision"))&&(this.m_bounds.x*=this.m_scaleX,this.m_bounds.y*=this.m_scaleY,this.m_bounds.w*=this.m_scaleX,this.m_bounds.h*=this.m_scaleY)};
SWorldActor.prototype.updateBoundsAttack=function(){this.m_boundsAttack=null;null!==this.m_clip&&"undefined"!==typeof this.m_clip.getCollision&&(this.m_boundsAttack=this.m_clip.getCollision("mcCollisionAttack"))&&(this.m_boundsAttack.x*=this.m_scaleX,this.m_boundsAttack.y*=this.m_scaleY,this.m_boundsAttack.w*=this.m_scaleX,this.m_boundsAttack.h*=this.m_scaleY)};
SWorldActor.prototype.isOverPlatform=function(){var a=this.m_bounds;if(this.m_vehicle)return!0;if(null!==a){var b=this.m_x+a.x,c=this.m_y+3;if(this.m_world.getCellInPosition(b+a.w,c)===SWorldCollisionLayer.CELL_PLATFORM||this.m_world.getCellInPosition(this.m_x,c)===SWorldCollisionLayer.CELL_PLATFORM||this.m_world.getCellInPosition(b,c)===SWorldCollisionLayer.CELL_PLATFORM)return!0}return!1};SWorldActor.prototype.gotoState=function(a){a!==this.m_state&&(this.characterGotoState(a),this.m_state=a)};
SWorldActor.prototype.characterGotoState=function(a){a!==this.m_state&&null!==this.m_character&&(this.m_character.gotoState(a),this.m_clip=this.m_character.clip,a=this.m_clipLookingRight?1:-1,this.m_clip.scale.x=this.m_flipX?-this.m_scaleX*a:this.m_scaleX*a,this.m_clip.scale.y=this.m_scaleY)};SWorldActor.prototype.corners=function(){if(null===this.m_cornersArray)return null;this.m_indexCornersArray=0>this.m_speed.y?0<=this.m_speed.x?2:3:0>this.m_speed.x?1:0;return this.m_cornersArray[this.m_indexCornersArray]};
SWorldActor.prototype.saveData=function(){};SWorldActor.prototype.movementUpdate=function(a){null!==this.m_movement&&this.m_movement.update(a)};SWorldActor.prototype.update=function(a){this.onDebugUpdate(a);null!==this.m_character?(this.m_character.setPosition(this.m_x,this.m_y),this.m_character.update(a)):null!==this.m_clip&&(this.m_clip.setPosition(this.m_x,this.m_y),this.m_clip.update(a))};
SWorldActor.prototype.isInCamera=function(a){a="undefined"!==typeof a?a:100;var b=this.m_x,c=this.m_x,d=this.m_y,e=this.m_y;this.m_bounds&&(b+=this.m_bounds.x,c=b+this.m_bounds.w,d+=this.m_bounds.y,e=d+this.m_bounds.h);var f=Application.WIDE_SCREEN?Layout.left:0,g=Application.WIDE_SCREEN?Layout.top:0;c=c>=this.m_world.camera().getX()-f/Layout.scale-a;b=b<=this.m_world.camera().getX()+this.m_world.camera().width()+a;e=e>=this.m_world.camera().getY()-g/Layout.scale-a;a=d<=this.m_world.camera().getY()+
this.m_world.camera().height()+a;return c&&b&&e&&a};SWorldActor.prototype.checkCollision=function(){return this.m_world.checkCollision(this)};SWorldActor.prototype.applyImpulse=function(a,b){this.m_oldX=this.m_x-a;this.m_oldY=this.m_y-b};
SWorldActor.prototype.hitTest=function(a,b,c){b="undefined"!==typeof b?b:"mcCollision";c="undefined"!==typeof c?c:"mcCollision";return null===a?(Application.log("hitTest: no actor found, returning false."),!1):"undefined"===typeof a.clip||null===a.clip()?(Application.log("hitTest: invalid clip found or clip function not defined, returning false."),!1):null===a.clip().getCollision(c)?(Application.log("hitTest: actorBounds is null, returning false."),!1):null===this.m_clip||null===this.m_clip.getCollision(b)?
(Application.log("hitTest: this.m_clip is null or collision is null. returning false."),!1):SDisplayObjectContainer.hitTestByBounds(this.m_clip,this.m_clip.getCollision(b),a.clip(),a.clip().getCollision(c))};SWorldActor.prototype.hitIntersection=function(a){if(null!==this.m_bounds){var b=new Rectangle(this.m_bounds.x,this.m_bounds.y,this.m_bounds.w,this.m_bounds.h);b.x+=this.m_x;b.y+=this.m_y;a=a.getBounds();if(null!==a)return b.intersectRect(a)}return!1};
SWorldActor.prototype.integrateVerlet=function(a){var b=this.m_oldX,c=this.m_oldY;this.m_oldX=this.m_x;this.m_oldY=this.m_y;b=this.m_x-b;b<-this.m_control.maxVerletHorizontalDisplace?b=-this.m_control.maxVerletHorizontalDisplace:b>this.m_control.maxVerletHorizontalDisplace&&(b=this.m_control.maxVerletHorizontalDisplace);this.m_x+=b;a=this.m_y-c+this.m_control.gravity*a;a<-this.m_control.maxVerletUpDisplace?a=-this.m_control.maxVerletUpDisplace:a>this.m_control.maxVerletDownDisplace&&(a=this.m_control.maxVerletDownDisplace);
this.m_y+=a};SWorldActor.prototype.onIdle=function(a){this.m_isIdle=a;null!==this.m_clip&&(this.m_clip.visible=!a)};SWorldActor.prototype.showCollision=function(a){null!==this.m_clip&&"undefined"!==typeof this.m_clip.toggleCollision&&this.m_clip.toggleCollision()};SWorldActor.prototype.cornersArray=function(){return this.m_cornersArray};SWorldActor.prototype.shoot=function(){return null};SWorldActor.prototype.onPointerPress=function(a){};SWorldActor.prototype.onPointerRelease=function(a){};
SWorldActor.prototype.onPointerMove=function(a){};SWorldActor.prototype.onKeyDown=function(a){};SWorldActor.prototype.onKeyUp=function(a){};
SWorldActor.prototype.onDebugDraw=function(a){null!==this.m_bounds&&ContextGraphics.drawRectangle(a,this.m_x-this.m_world.camera().getX()+this.m_bounds.x,this.m_y-this.m_world.camera().getY()+this.m_bounds.y,this.m_bounds.w,this.m_bounds.h,1,Common.COLOR_RED,Common.COLOR_NONE);null!==this.m_boundsAttack&&ContextGraphics.drawRectangle(a,this.m_x-this.m_world.camera().getX()+this.m_boundsAttack.x,this.m_y-this.m_world.camera().getY()+this.m_boundsAttack.y,this.m_boundsAttack.w,this.m_boundsAttack.h,
1,Common.COLOR_BLUE,Common.COLOR_NONE);if(this.m_corners)for(var b=0;b<this.m_cornersArray[this.m_indexCornersArray].length;b++)this.m_cornersArray[this.m_indexCornersArray][b]&&ContextGraphics.drawCircle(a,this.m_x-this.m_world.camera().getX()+this.m_cornersArray[this.m_indexCornersArray][b].position.x,this.m_y-this.m_world.camera().getY()+this.m_cornersArray[this.m_indexCornersArray][b].position.y,3,Common.COLOR_MAGENTA,Common.COLOR_MAGENTA)};
SWorldActor.prototype.onDebugPointerPress=function(a){DebugObject.prototype.onDebugPointerPress.call(this,a);var b=this.getBounds();if(b&&b.intersectPoint(a.data.global.x+this.m_world.camera().getX(),a.data.global.y+this.m_world.camera().getY()))this.onDebugSelectObject()};SWorldActor.prototype.onDebugGetProperties=function(){var a=[];a.push({property:"name",value:this.m_className});a.push({property:"position",value:parseInt(this.m_x,10)+" , "+parseInt(this.m_y,10)});return a};
SWorldActor.prototype.onDebugChangeProperties=function(a){DebugObject.prototype.onDebugChangeProperties.call(this,a);switch(a.property){case "position":a=a.value.split(",");this.m_x=parseFloat(a[0]);this.m_y=parseFloat(a[1]);break;default:Application.warn("SANDBOX property ["+a.property+"] no set in Object")}};SWorldActor.prototype.onDebugDelete=function(){DebugObject.prototype.onDebugDelete.call(this);this.m_isAwaitingDelete=!0};
function SWorldBaseLayer(a,b,c){this.m_type=this.m_parallaxXFactor=this.m_y=this.m_x=0;this.m_useEmbeddedAssets=!1;this.m_world=a;this.m_canvas=null;this.m_name=b.name;this.m_width=b.width;this.m_height=b.height;this.m_offsetX=b.offsetX||0;this.m_offsetY=b.offsetY||0;Application.log(" Layer: "+this.m_name+" w:"+this.m_width+" h:"+this.m_height+" ox:"+this.m_offsetX+" oy:"+this.m_offsetY);this.m_useEmbeddedAssets=this.m_world.useEmbeddedAssets;this.m_canvas=Application.instance.addDisplayContainer();
a.canvas.addChild(this.m_canvas)}SWorldBaseLayer.TYPE_COLLISIONS=1;SWorldBaseLayer.TYPE_TILES=2;SWorldBaseLayer.TYPE_SPRITES=3;SWorldBaseLayer.TYPE_OBJECTS=4;SWorldBaseLayer.TYPE_MARKERS=5;SWorldBaseLayer.TYPE_BOX2D=6;SWorldBaseLayer.TYPE_KIPU=7;SWorldBaseLayer.TYPE_CONTINUOUS=8;SWorldBaseLayer.TYPE_GENERATOR_TILE=9;SWorldBaseLayer.TYPE_PATHS=10;SWorldBaseLayer.TYPE_CONTAINER=11;SWorldBaseLayer.ID_PLAYER="player";SWorldBaseLayer.ID_COLLISIONS="collision";SWorldBaseLayer.ID_TILES="cell";
SWorldBaseLayer.ID_SPRITES="sprites";SWorldBaseLayer.ID_OBJECTS="objects";SWorldBaseLayer.ID_MARKERS="markers";SWorldBaseLayer.ID_BOX2D="b2d";SWorldBaseLayer.ID_KIPU="kipu";SWorldBaseLayer.ID_CONTINUOUS="continuous";SWorldBaseLayer.ID_GENERATOR_TILE="BeziZone";SWorldBaseLayer.ID_PATHS="paths";SWorldBaseLayer.ID_CONTAINER="container";
SWorldBaseLayer.prototype.free=function(){this.m_world=null;null!==this.m_canvas&&(null!==this.m_canvas.parent&&this.m_canvas.parent.removeChild(this.m_canvas),this.m_canvas.free(),this.m_canvas=null)};SWorldBaseLayer.prototype.type=function(){return this.m_type};SWorldBaseLayer.prototype.getX=function(){return this.m_x};SWorldBaseLayer.prototype.getY=function(){return this.m_y};SWorldBaseLayer.prototype.canvas=function(){return this.m_canvas};SWorldBaseLayer.prototype.width=function(){return this.m_width};
SWorldBaseLayer.prototype.height=function(){return this.m_height};SWorldBaseLayer.prototype.visible=function(){return!0};SWorldBaseLayer.prototype.setVisible=function(a){this.m_canvas.visible=a};SWorldBaseLayer.prototype.name=function(){return this.m_name};SWorldBaseLayer.prototype.setX=function(a){this.m_x=a};SWorldBaseLayer.prototype.setY=function(a){this.m_y=a};SWorldBaseLayer.prototype.refresh=function(){};
SWorldBaseLayer.prototype.init=function(){this.m_world.camera().parallaxX&&(this.m_parallaxXFactor=(this.m_width-this.m_world.cameraWidth)/(this.m_world.width()-this.m_world.cameraWidth));this.m_world.camera().parallaxY&&(this.m_parallaxYFactor=(this.m_height-this.m_world.cameraHeight)/(this.m_world.height()-this.m_world.cameraHeight))};
SWorldBaseLayer.prototype.render=function(a){this.m_world.camera().parallaxX&&(this.m_canvas.x=-this.parallaxX());this.m_world.camera().parallaxY&&(this.m_canvas.y=-this.parallaxY())};SWorldBaseLayer.prototype.parallaxX=function(){return~~(this.m_world.camera().getX()*this.m_parallaxXFactor)-this.m_offsetX};SWorldBaseLayer.prototype.parallaxY=function(){return~~(this.m_world.camera().getY()*this.m_parallaxYFactor)-this.m_offsetY};
function SWorldContainerLayer(a,b){this.m_world=a;this.m_name=b.name;this.m_offsetX=b.offsetX||0;this.m_offsetY=b.offsetY||0;this.m_canvas=Application.instance.addDisplayContainer();this.m_world.canvas.addChild(this.m_canvas);this.updateWithCamera=!0;this.m_type=SWorldBaseLayer.TYPE_CONTAINER}Application.subclass(SWorldContainerLayer,SWorldBaseLayer);SWorldContainerLayer.prototype.free=function(){this.m_world.canvas.removeChild(this.m_canvas);this.m_canvas.free();this.m_world=this.m_canvas=null};
SWorldContainerLayer.prototype.render=function(a){this.updateWithCamera&&(this.m_canvas.position.x=-this.m_world.camera().getX()-this.m_offsetX,this.m_canvas.position.y=-this.m_world.camera().getY()-this.m_offsetY)};SWorldContainerLayer.prototype.init=function(){};
function SWorldTileLayer(a,b,c){SWorldBaseLayer.call(this,a,b,c);this.m_maxY=this.m_maxX=this.m_minY=this.m_minX=0;this.m_buffer=[];this.m_bufferY=this.m_bufferX=this.m_bufferHeight=this.m_bufferWidth=0;this.m_type=SWorldBaseLayer.TYPE_TILES;this.m_columns=b.cols;this.m_rows=b.rows;this.m_tileWidth=b.tileW;this.m_tileHeight=b.tileH;this.m_tiles=b.image;this.m_matrix=EDIUtils.getMatrix(b);this.m_tilePrefix=b.prefix;this.m_tempRow=this.m_tempCol=0}Application.subclass(SWorldTileLayer,SWorldBaseLayer);
SWorldTileLayer.prototype.tileWidth=function(){return this.m_tileWidth};SWorldTileLayer.prototype.tileHeight=function(){return this.m_tileHeight};SWorldTileLayer.prototype.getTileName=function(a){return 0<=a&&a<this.m_tiles.length?(a=this.m_tiles[a],0==a.indexOf("?")?this.m_tilePrefix+a.substr(1):a):null};SWorldTileLayer.prototype.getBufferCell=function(a,b){return this.m_buffer[(a+this.m_bufferX)%this.m_bufferWidth+(b+this.m_bufferY)%this.m_bufferHeight*this.m_bufferWidth]};
SWorldTileLayer.prototype.setBufferCell=function(a,b,c){this.m_buffer[(a+this.m_bufferX)%this.m_bufferWidth+(b+this.m_bufferY)%this.m_bufferHeight*this.m_bufferWidth]=c};
SWorldTileLayer.prototype.initCell=function(a,b){var c=this.getCell(a+this.m_minX,b+this.m_minY);0<c&&(c=Application.instance.getClip(this.getTileName(c-1)),this.m_canvas.addChild(c),c.parent=this.m_canvas,c.position.x=(a+this.m_minX)*this.m_tileWidth,c.position.y=(b+this.m_minY)*this.m_tileHeight,c.scale.x=c.scale.y=1.01,this.setBufferCell(a,b,c))};
SWorldTileLayer.prototype.refresh=function(){SWorldBaseLayer.prototype.refresh.call(this);for(var a=this.m_bufferY=this.m_bufferX=0;a<this.m_bufferWidth;){for(var b=0;b<this.m_bufferHeight;){var c=this.m_buffer[a+b*this.m_bufferWidth];c&&(this.m_canvas.removeChild(c),this.m_buffer[a+b*this.m_bufferWidth]=null);this.initCell(a,b);++b}++a}};
SWorldTileLayer.prototype.init=function(){SWorldBaseLayer.prototype.init.call(this);this.m_bufferWidth=Math.ceil(this.m_world.camera().width()/this.m_tileWidth+1);this.m_bufferHeight=Math.ceil(this.m_world.camera().height()/this.m_tileHeight+1);this.m_bufferY=this.m_bufferX=0;this.m_buffer=[];this.m_minX=~~(this.m_world.camera().getX()/this.m_tileWidth);0>this.m_minX&&(this.m_minX=0);this.m_world.isLoop&&this.m_bufferWidth++;this.m_maxX=this.m_minX+this.m_bufferWidth;this.m_minY=~~(this.m_world.camera().getY()/
this.m_tileHeight);0>this.m_minY&&(this.m_minY=0);this.m_maxY=this.m_minY+this.m_bufferHeight;for(var a=0;a<this.m_bufferWidth;){for(var b=0;b<this.m_bufferHeight;)this.initCell(a,b),++b;++a}};
SWorldTileLayer.prototype.getCellInPosition=function(a,b){this.m_tempCol=this.fixedColTile(~~(a/this.m_tileWidth));this.m_tempRow=this.fixedRowTile(~~(b/this.m_tileHeight));return 0<=this.m_tempCol&&0<=this.m_tempRow&&this.m_tempCol<this.m_columns&&this.m_tempRow<this.m_rows&&this.m_matrix[this.m_tempCol]?this.m_matrix[this.m_tempCol][this.m_tempRow]:0};SWorldTileLayer.prototype.fixedColTile=function(a){this.m_world.isLoop&&(a=0>a?a+this.m_columns*~~(-a/this.m_columns+1):a,a%=this.m_columns);return a};
SWorldTileLayer.prototype.fixedRowTile=function(a){return a};SWorldTileLayer.prototype.getCell=function(a,b){a=this.fixedColTile(a);b=this.fixedRowTile(b);return 0<=a&&0<=b&&a<this.m_columns&&b<this.m_rows&&this.m_matrix[a]&&this.m_matrix[a][b]&&this.m_matrix[a]?this.m_matrix[a][b]:0};SWorldTileLayer.prototype.setCell=function(a,b,c){0<=a&&0<=b&&a<this.m_columns&&b<this.m_rows&&(this.m_matrix[a]||(this.m_matrix[a]=Common.createArraySize(this.m_rows,0)),this.m_matrix[a][b]=c);return 0};
SWorldTileLayer.prototype.addTileCell=function(a,b,c,d){var e=this.getCell(a,b);0<e&&(e=Application.instance.getClip(this.getTileName(e-1)),this.m_canvas.addChild(e),e.parent=this.m_canvas,e.position.x=a*this.m_tileWidth,e.position.y=b*this.m_tileHeight,e.scale.x=e.scale.y=1.01,this.setBufferCell(c,d,e))};
SWorldTileLayer.prototype.render=function(a){a=!1;if(this.m_world.camera().parallaxX){var b=this.parallaxX();var c=~~(b/this.m_tileWidth);this.m_world.isLoop&&--c;var d=c-this.m_minX;if(d<=-this.m_bufferWidth||d>=this.m_bufferWidth)a=!0;else if(c>this.m_minX){for(var e=0;e<d;){for(var f=0;f<this.m_bufferHeight;){var g=this.getBufferCell(e,f);g&&(this.m_canvas.removeChild(g),this.setBufferCell(e,f,null));this.addTileCell(e+this.m_maxX,f+this.m_minY,e,f);++f}++e}this.m_bufferX=(this.m_bufferX+d)%this.m_bufferWidth}else if(c<
this.m_minX){for(e=1;e<=-d;){for(f=0;f<this.m_bufferHeight;){if(g=this.getBufferCell(this.m_bufferWidth-e,f))this.m_canvas.removeChild(g),this.setBufferCell(this.m_bufferWidth-e,f,null);this.addTileCell(this.m_minX-e,f+this.m_minY,this.m_bufferWidth-e,f);++f}++e}this.m_bufferX=(this.m_bufferWidth+this.m_bufferX+d)%this.m_bufferWidth}0!=d&&(this.m_minX=c,this.m_maxX=this.m_minX+this.m_bufferWidth);this.m_canvas.position.x=-Math.floor(b)}if(this.m_world.camera().parallaxY){b=this.parallaxY();c=~~(b/
this.m_tileHeight);d=c-this.m_minY;if(d<=-this.m_bufferHeight||d>=this.m_bufferHeight)a=!0;else if(c>this.m_minY){for(f=0;f<d;){for(e=0;e<this.m_bufferWidth;){if(g=this.getBufferCell(e,f))this.m_canvas.removeChild(g),this.setBufferCell(e,f,null);this.addTileCell(e+this.m_minX,f+this.m_maxY,e,f);++e}++f}this.m_bufferY=(this.m_bufferY+d)%this.m_bufferHeight}else if(c<this.m_minY){for(f=1;f<=-d;){for(e=0;e<this.m_bufferWidth;){if(g=this.getBufferCell(e,this.m_bufferHeight-f))this.m_canvas.removeChild(g),
this.setBufferCell(e,this.m_bufferHeight-f,null);this.addTileCell(e+this.m_minX,this.m_minY-f,e,this.m_bufferHeight-f);++e}++f}this.m_bufferY=(this.m_bufferHeight+this.m_bufferY+d)%this.m_bufferHeight}0!=d&&(this.m_minY=c,this.m_maxY=this.m_minY+this.m_bufferHeight);this.m_canvas.position.y=-Math.floor(b)}a&&this.refresh()};SWorldTileLayer.prototype.matrix=function(){return this.m_matrix};SWorldTileLayer.prototype.resetMatrix=function(){this.m_matrix=[]};
SWorldTileLayer.prototype.resetTiles=function(){this.m_tiles=[]};SWorldTileLayer.prototype.setTiles=function(a){this.m_tiles=a};SWorldTileLayer.prototype.setTileW=function(a){this.m_tileWidth=a};SWorldTileLayer.prototype.setTileH=function(a){this.m_tileHeight=a};SWorldTileLayer.prototype.setMatrix=function(a){this.m_matrix=a};SWorldTileLayer.prototype.tiles=function(){return this.m_tiles};
SWorldTileLayer.prototype.free=function(){for(var a=0;a<this.m_bufferWidth;){for(var b=0;b<this.m_bufferHeight;){var c=this.m_buffer[a+b*this.m_bufferWidth];c&&("undefined"!==typeof c?(c.parent.removeChild(c),c.free()):c.parent.removeChild(c));++b}++a}this.m_matrix=null;SWorldBaseLayer.prototype.free.call(this)};
function SWorldCollisionLayer(a,b){this.m_tileY=this.m_tileX=0;this.m_frames=[];this.m_platforms=[];this.m_sw0=this.m_dy=this.m_dx=0;SWorldTileLayer.call(this,a,b);this.m_type=SWorldBaseLayer.TYPE_COLLISIONS;for(a=SWorldCollisionLayer.CELL_EMPTY;a<=SWorldCollisionLayer.CELL_QUART_CIRCLE_4;)this.m_frames.push(SWorldCollisionLayer.COLLISION_SET+a),++a;this.setVisible(!1)}Application.subclass(SWorldCollisionLayer,SWorldTileLayer);
SWorldCollisionLayer.prototype.free=function(){this.m_frames=this.m_platforms=null;SWorldTileLayer.prototype.free.call(this)};SWorldCollisionLayer.CELL_EMPTY=0;SWorldCollisionLayer.CELL_FULL=1;SWorldCollisionLayer.CELL_DIAG_UP_LEFT=2;SWorldCollisionLayer.CELL_DIAG_UP_RIGHT=3;SWorldCollisionLayer.CELL_DIAG_DOWN_RIGHT=4;SWorldCollisionLayer.CELL_DIAG_DOWN_LEFT=5;SWorldCollisionLayer.CELL_PLATFORM=6;SWorldCollisionLayer.CELL_FULL_ICE=7;SWorldCollisionLayer.CELL_FULL_WATER=8;
SWorldCollisionLayer.CELL_FULL_SAND=9;SWorldCollisionLayer.CELL_MD_UP_RIGHT=10;SWorldCollisionLayer.CELL_MD_UP_LEFT=11;SWorldCollisionLayer.CELL_HMD_UP_RIGHT=12;SWorldCollisionLayer.CELL_HMD_UP_LEFT=13;SWorldCollisionLayer.CELL_HALF_DOWN=14;SWorldCollisionLayer.CELL_HALF_LEFT=15;SWorldCollisionLayer.CELL_HALF_RIGHT=16;SWorldCollisionLayer.CELL_HALF_UP=17;SWorldCollisionLayer.CELL_FULL_CIRCLE=26;SWorldCollisionLayer.CELL_QUART_CIRCLE_1=28;SWorldCollisionLayer.CELL_QUART_CIRCLE_2=29;
SWorldCollisionLayer.CELL_QUART_CIRCLE_3=30;SWorldCollisionLayer.CELL_QUART_CIRCLE_4=31;SWorldCollisionLayer.MIN_VY_FRICTION=-2;SWorldCollisionLayer.MAX_VY_SPEED_PLATFORM=-2;SWorldCollisionLayer.COLLISION_SET="coll_";SWorldCollisionLayer.prototype.setX=function(a){this.m_x=a};SWorldCollisionLayer.prototype.setY=function(a){this.m_y=a};SWorldCollisionLayer.prototype.name=function(){return this.m_name};SWorldCollisionLayer.prototype.tileHeight=function(){return this.m_tileHeight};
SWorldCollisionLayer.prototype.addMobilePlatform=function(a){this.m_platforms.push(a)};
SWorldCollisionLayer.prototype.checkPlatforms=function(a,b,c,d){d.setVehicle(null);if(0<c.y&&0<d.speed().y&&!d.control().isJumpingDown())for(c=0;c<this.m_platforms.length;){if(this.m_platforms[c].isVehicle()){var e=this.m_platforms[c].getX(),f=this.m_platforms[c].bounds().x,g=this.m_platforms[c].getY(),h=this.m_platforms[c].bounds().y;if(a<=e+f+this.m_platforms[c].bounds().w&&a>=e+f&&b>=g+h&&b<=g+h+this.m_platforms[c].bounds().h)return d.setVehicle(this.m_platforms[c]),new Vector2D(0,g+h-b)}++c}return null};
SWorldCollisionLayer.prototype.checkCollisionPoint=function(a,b){this.m_tileX=~~(a/this.m_tileWidth);this.m_tileY=~~(b/this.m_tileHeight);return this.getCell(this.m_tileX,this.m_tileY)};SWorldCollisionLayer.prototype.setVisible=function(a){a?this.m_world.canvas.addChild(this.m_canvas):this.m_world.canvas.removeChild(this.m_canvas)};
SWorldCollisionLayer.prototype.checkCollision=function(a,b,c,d){this.m_tileX=~~(a/this.m_tileWidth);this.m_tileY=~~(b/this.m_tileHeight);this.m_dy=this.m_dx=0;this.m_sw0=this.getCell(this.m_tileX,this.m_tileY);switch(this.m_sw0){case SWorldCollisionLayer.CELL_PLATFORM:if(0<c.y&&!d.control().isJumpingUp()&&!d.control().isJumpingDown()){if(0<c.x&&this.getCell(this.m_tileX,this.m_tileY-1)===SWorldCollisionLayer.CELL_DIAG_UP_LEFT)return this.m_dy=a-this.m_tileX*this.m_tileWidth,new Vector2D(0,this.m_tileY*
this.m_tileHeight-b-this.m_dy);if(0>c.x&&this.getCell(this.m_tileX,this.m_tileY-1)===SWorldCollisionLayer.CELL_DIAG_UP_RIGHT)return this.m_dy=(this.m_tileX+1)*this.m_tileWidth-a,new Vector2D(0,this.m_tileY*this.m_tileHeight-b-this.m_dy);if(0<d.speed().y&&this.getCell(this.m_tileX,this.m_tileY-1)===SWorldCollisionLayer.CELL_EMPTY&&(d.speed().y>=SWorldCollisionLayer.MAX_VY_SPEED_PLATFORM||b-this.m_tileY*this.m_tileHeight<=.5*this.m_tileHeight))return new Vector2D(0,this.m_tileY*this.m_tileHeight-b)}break;
case SWorldCollisionLayer.CELL_HALF_DOWN:if(0<c.y&&!d.control().isJumpingUp()&&(this.m_dy=b-(this.m_tileY+.5)*this.m_tileWidth,0<this.m_dy))return new Vector2D(0,-this.m_dy);break;case SWorldCollisionLayer.CELL_DIAG_UP_RIGHT:if(0<c.y&&!d.control().isJumpingUp()&&(this.m_dx=a-this.m_tileX*this.m_tileWidth,this.m_dy=b-this.m_tileY*this.m_tileWidth,this.m_dx<this.m_dy&&0>=c.x)){if(0===d.control().forceX())return new Vector2D(0,this.m_dx-this.m_dy);this.m_dx=.5*(this.m_dy-this.m_dx);c=d.control().slopeFriction*
this.m_dx;return new Vector2D(this.m_dx+c,-this.m_dx+c)}break;case SWorldCollisionLayer.CELL_HMD_UP_LEFT:if(0<c.y&&!d.control().isJumpingUp()&&(this.m_dx=a-this.m_tileX*this.m_tileWidth,this.m_dy=b-this.m_tileY*this.m_tileWidth,this.m_dx<2*this.m_dy))return new Vector2D(0,-b+(.5*this.m_dx+this.m_tileY*this.m_tileWidth));break;case SWorldCollisionLayer.CELL_MD_UP_LEFT:if(0<c.y&&!d.control().isJumpingUp()&&(this.m_dx=a-this.m_tileX*this.m_tileWidth,this.m_dy=b-(this.m_tileY+.5)*this.m_tileWidth,this.m_dx<
2*this.m_dy))return new Vector2D(0,-b+(.5*this.m_dx+(this.m_tileY+.5)*this.m_tileWidth));break;case SWorldCollisionLayer.CELL_DIAG_UP_LEFT:if(0<c.y&&!d.control().isJumpingUp()&&(this.m_dx=(this.m_tileX+1)*this.m_tileWidth-a,this.m_dy=b-this.m_tileY*this.m_tileWidth,this.m_dx<this.m_dy&&0<=c.x)){if(0===d.control().forceX())return new Vector2D(0,this.m_dx-this.m_dy);this.m_dx=.5*(this.m_dy-this.m_dx);c=d.control().slopeFriction*this.m_dx;return new Vector2D(-this.m_dx-c,-this.m_dx+c)}break;case SWorldCollisionLayer.CELL_HMD_UP_RIGHT:if(0<
c.y&&!d.control().isJumpingUp()&&(this.m_dx=-a+this.m_tileWidth*(this.m_tileX+1),this.m_dy=b-this.m_tileY*this.m_tileWidth,this.m_dx<2*this.m_dy))return new Vector2D(0,-b+(.5*this.m_dx+this.m_tileY*this.m_tileWidth));break;case SWorldCollisionLayer.CELL_MD_UP_RIGHT:if(0<c.y&&!d.control().isJumpingUp()&&(this.m_dx=-a+this.m_tileWidth*(this.m_tileX+1),this.m_dy=b-(this.m_tileY+.5)*this.m_tileWidth,this.m_dx<2*this.m_dy))return new Vector2D(0,-b+(.5*this.m_dx+(this.m_tileY+.5)*this.m_tileWidth));break;
case SWorldCollisionLayer.CELL_FULL:if(0===c.x)return 0<c.y?new Vector2D(0,this.m_tileY*this.m_tileHeight-b):new Vector2D(0,(this.m_tileY+1)*this.m_tileHeight-b);if(0===c.y)if(d.speed().y>=SWorldCollisionLayer.MIN_VY_FRICTION&&d.setFallingOverWall(!0),0<c.x){if(this.getCell(this.m_tileX-1,this.m_tileY)===SWorldCollisionLayer.CELL_EMPTY)return new Vector2D(this.m_tileX*this.m_tileWidth-a,0)}else{if(this.getCell(this.m_tileX+1,this.m_tileY)===SWorldCollisionLayer.CELL_EMPTY)return new Vector2D((this.m_tileX+
1)*this.m_tileWidth-a,0)}else if(0<c.y){if(this.getCell(this.m_tileX,this.m_tileY-1)===SWorldCollisionLayer.CELL_MD_UP_RIGHT)return this.m_dx=0,this.m_dy=this.m_tileY*this.m_tileHeight-.5*(a-this.m_tileX*this.m_tileWidth)-b,new Vector2D(this.m_dx,this.m_dy);if(this.getCell(this.m_tileX,this.m_tileY-1)===SWorldCollisionLayer.CELL_MD_UP_LEFT)return this.m_dx=0,this.m_dy=this.m_tileY*this.m_tileHeight-.5*this.m_tileHeight- -.5*(a-this.m_tileX*this.m_tileWidth)-b,new Vector2D(this.m_dx,this.m_dy);if(this.getCell(this.m_tileX,
this.m_tileY-1)===SWorldCollisionLayer.CELL_HMD_UP_RIGHT)return this.m_dx=0,this.m_dy=this.m_tileY*this.m_tileHeight-.5*(a-this.m_tileX*this.m_tileWidth)-b,new Vector2D(this.m_dx,this.m_dy);if(this.getCell(this.m_tileX,this.m_tileY-1)===SWorldCollisionLayer.CELL_HMD_UP_LEFT)return this.m_dx=0,this.m_dy=this.m_tileY*this.m_tileHeight-.5*this.m_tileHeight- -.5*(a-this.m_tileX*this.m_tileWidth)-b,new Vector2D(this.m_dx,this.m_dy);if(this.getCell(this.m_tileX,this.m_tileY-1)===SWorldCollisionLayer.CELL_HALF_DOWN&&
(this.m_dx=0,this.m_dy=b-(this.m_tileY+.5)*this.m_tileWidth,0<this.m_dy))return new Vector2D(0,-this.m_dy);if(0<c.x){if(this.getCell(this.m_tileX,this.m_tileY-1)===SWorldCollisionLayer.CELL_DIAG_UP_LEFT){if(this.getCell(this.m_tileX-1,this.m_tileY)===SWorldCollisionLayer.CELL_DIAG_UP_LEFT){this.m_dx=a-this.m_tileX*this.m_tileWidth;this.m_dx+=b-this.m_tileY*this.m_tileHeight;if(0===d.control().forceX())return new Vector2D(0,-this.m_dx);this.m_dx/=2;c=d.control().slopeFriction*this.m_dx;return new Vector2D(-this.m_dx-
c,-this.m_dx+c)}this.m_dy=a-this.m_tileX*this.m_tileWidth;return new Vector2D(0,this.m_tileY*this.m_tileHeight-b-this.m_dy)}if(this.getCell(this.m_tileX-1,this.m_tileY)===SWorldCollisionLayer.CELL_DIAG_UP_LEFT){if(this.getCell(this.m_tileX,this.m_tileY-1)===SWorldCollisionLayer.CELL_FULL)return this.m_dx=a-this.m_tileX*this.m_tileWidth,this.m_dx=.5*(this.m_dx+b-this.m_tileY*this.m_tileHeight),c=-this.m_dx-d.control().slopeFriction*this.m_dx,a+c>this.m_tileX*this.m_tileWidth?new Vector2D(-a+this.m_tileX*
this.m_tileWidth,-b+this.m_tileY*this.m_tileHeight):new Vector2D(c,-this.m_dx+d.control().slopeFriction*this.m_dx);if(this.getCell(this.m_tileX,this.m_tileY-1)===SWorldCollisionLayer.CELL_EMPTY)return this.m_dx=a-this.m_tileX*this.m_tileWidth,this.m_dx=.5*(this.m_dx+b-this.m_tileY*this.m_tileHeight),c=-this.m_dx-d.control().slopeFriction*this.m_dx,a+c>this.m_tileX*this.m_tileWidth||0===d.control().forceX()?new Vector2D(0,-b+this.m_tileY*this.m_tileHeight):new Vector2D(c,-this.m_dx+d.control().slopeFriction*
this.m_dx)}else{if(this.getCell(this.m_tileX,this.m_tileY-1)===SWorldCollisionLayer.CELL_FULL){if(this.getCell(this.m_tileX-1,this.m_tileY)===SWorldCollisionLayer.CELL_FULL)return new Vector2D(this.m_tileX*this.m_tileWidth-a,this.m_tileY*this.m_tileHeight-b);d.speed().y>=SWorldCollisionLayer.MIN_VY_FRICTION&&d.setFallingOverWall(!0);return new Vector2D(this.m_tileX*this.m_tileWidth-a,0)}return this.getCell(this.m_tileX-1,this.m_tileY)===SWorldCollisionLayer.CELL_FULL?new Vector2D(0,this.m_tileY*this.m_tileHeight-
b):b-this.m_tileY*this.m_tileHeight>a-this.m_tileX*this.m_tileWidth?(d.speed().y>=SWorldCollisionLayer.MIN_VY_FRICTION&&d.setFallingOverWall(!0),new Vector2D(this.m_tileX*this.m_tileWidth-a,0)):new Vector2D(0,this.m_tileY*this.m_tileHeight-b)}}else{if(this.getCell(this.m_tileX,this.m_tileY-1)===SWorldCollisionLayer.CELL_DIAG_UP_RIGHT){if(this.getCell(this.m_tileX+1,this.m_tileY)===SWorldCollisionLayer.CELL_DIAG_UP_RIGHT){this.m_dx=(this.m_tileX+1)*this.m_tileWidth-a;this.m_dx+=b-this.m_tileY*this.m_tileHeight;
if(0===d.control().forceX())return new Vector2D(0,-this.m_dx);this.m_dx/=2;c=d.control().slopeFriction*this.m_dx;return new Vector2D(this.m_dx+c,-this.m_dx+c)}this.m_dy=(this.m_tileX+1)*this.m_tileWidth-a;return new Vector2D(0,this.m_tileY*this.m_tileHeight-b-this.m_dy)}if(this.getCell(this.m_tileX+1,this.m_tileY)===SWorldCollisionLayer.CELL_DIAG_UP_RIGHT){if(this.getCell(this.m_tileX,this.m_tileY-1)===SWorldCollisionLayer.CELL_FULL)return this.m_dx=(this.m_tileX+1)*this.m_tileWidth-a,this.m_dx=.5*
(this.m_dx+b-this.m_tileY*this.m_tileHeight),c=this.m_dx+d.control().slopeFriction*this.m_dx,a+c<(this.m_tileX+1)*this.m_tileWidth?new Vector2D((this.m_tileX+1)*this.m_tileWidth-a,-b+this.m_tileY*this.m_tileHeight):new Vector2D(c,-this.m_dx+d.control().slopeFriction*this.m_dx);if(this.getCell(this.m_tileX,this.m_tileY-1)===SWorldCollisionLayer.CELL_EMPTY)return this.m_dx=(this.m_tileX+1)*this.m_tileWidth-a,this.m_dx=.5*(this.m_dx+b-this.m_tileY*this.m_tileHeight),c=this.m_dx+d.control().slopeFriction*
this.m_dx,a+c<(this.m_tileX+1)*this.m_tileWidth||0===d.control().forceX()?new Vector2D(0,-b+this.m_tileY*this.m_tileHeight):new Vector2D(c,-this.m_dx+d.control().slopeFriction*this.m_dx)}else{if(this.getCell(this.m_tileX,this.m_tileY-1)===SWorldCollisionLayer.CELL_FULL){if(this.getCell(this.m_tileX+1,this.m_tileY)===SWorldCollisionLayer.CELL_FULL)return new Vector2D((this.m_tileX+1)*this.m_tileWidth-a,this.m_tileY*this.m_tileHeight-b);d.speed().y>=SWorldCollisionLayer.MIN_VY_FRICTION&&d.setFallingOverWall(!0);
return new Vector2D((this.m_tileX+1)*this.m_tileWidth-a,0)}return this.getCell(this.m_tileX+1,this.m_tileY)===SWorldCollisionLayer.CELL_FULL?new Vector2D(0,this.m_tileY*this.m_tileHeight-b):b-this.m_tileY*this.m_tileHeight>(this.m_tileX+1)*this.m_tileWidth-a?(d.speed().y>=SWorldCollisionLayer.MIN_VY_FRICTION&&d.setFallingOverWall(!0),new Vector2D((this.m_tileX+1)*this.m_tileWidth-a,0)):new Vector2D(0,this.m_tileY*this.m_tileHeight-b)}}}else{if(0<c.x){if(this.getCell(this.m_tileX,this.m_tileY+1)===
SWorldCollisionLayer.CELL_FULL){if(this.getCell(this.m_tileX-1,this.m_tileY)===SWorldCollisionLayer.CELL_FULL)return new Vector2D(this.m_tileX*this.m_tileWidth-a,(this.m_tileY+1)*this.m_tileHeight-b);d.speed().y>=SWorldCollisionLayer.MIN_VY_FRICTION&&d.setFallingOverWall(!0);return new Vector2D(this.m_tileX*this.m_tileWidth-a,0)}return this.getCell(this.m_tileX-1,this.m_tileY)===SWorldCollisionLayer.CELL_FULL?new Vector2D(0,(this.m_tileY+1)*this.m_tileHeight-b):(this.m_tileY+1)*this.m_tileHeight-
b>a-this.m_tileX*this.m_tileWidth?(d.setFallingOverWall(!0),new Vector2D(this.m_tileX*this.m_tileWidth-a,0)):new Vector2D(0,(this.m_tileY+1)*this.m_tileHeight-b)}if(this.getCell(this.m_tileX,this.m_tileY+1)===SWorldCollisionLayer.CELL_FULL){if(this.getCell(this.m_tileX+1,this.m_tileY)===SWorldCollisionLayer.CELL_FULL)return new Vector2D((this.m_tileX+1)*this.m_tileWidth-a,(this.m_tileY+1)*this.m_tileHeight-b);d.speed().y>=SWorldCollisionLayer.MIN_VY_FRICTION&&d.setFallingOverWall(!0);return new Vector2D((this.m_tileX+
1)*this.m_tileWidth-a,0)}return this.getCell(this.m_tileX+1,this.m_tileY)===SWorldCollisionLayer.CELL_FULL?new Vector2D(0,(this.m_tileY+1)*this.m_tileHeight-b):(this.m_tileY+1)*this.m_tileHeight-b>(this.m_tileX+1)*this.m_tileWidth-a?(d.speed().y>=SWorldCollisionLayer.MIN_VY_FRICTION&&d.setFallingOverWall(!0),new Vector2D((this.m_tileX+1)*this.m_tileWidth-a,0)):new Vector2D(0,(this.m_tileY+1)*this.m_tileHeight-b)}}return null};
SWorldCollisionLayer.prototype.getMaxFloorRange=function(a,b,c){for(var d=~~(b/this.m_tileHeight),e=~~(a/this.m_tileWidth);d<this.m_height;){if(this.getCell(e,d)!==SWorldCollisionLayer.CELL_EMPTY){for(b=e-1;this.getCell(b,d)!==SWorldCollisionLayer.CELL_EMPTY&&this.getCell(b,d-1)===SWorldCollisionLayer.CELL_EMPTY&&!(a- --b*this.m_tileWidth>=c););var f=(b+1)*this.m_tileWidth;for(b=e+1;this.getCell(b,d)!==SWorldCollisionLayer.CELL_EMPTY&&this.getCell(b,d-1)===SWorldCollisionLayer.CELL_EMPTY&&!(++b*this.m_tileWidth-
a>=c););return new Rectangle(f,d*this.m_tileHeight,b*this.m_tileWidth-f)}++d}Application.warn("getMaxFloorRange: no floor found at x:"+a+" y:"+b);return new Rectangle(a,b,0)};
SWorldCollisionLayer.prototype.getMaxFloorRangeElevations=function(a,b,c){for(var d=~~(b/this.m_tileHeight),e=~~(a/this.m_tileWidth);d<this.m_height;){var f=this.getCell(e,d);if(f!==SWorldCollisionLayer.CELL_EMPTY){b=~~((a-c)/this.m_tileWidth);var g=!0,h=e,k=d;do{switch(f){case SWorldCollisionLayer.CELL_FULL:case SWorldCollisionLayer.CELL_PLATFORM:switch(this.getCell(h-1,k)){case SWorldCollisionLayer.CELL_EMPTY:g=!1;break;default:switch(this.getCell(h-1,k-1)){case SWorldCollisionLayer.CELL_FULL:g=
!1;break;case SWorldCollisionLayer.CELL_DIAG_UP_RIGHT:--k}}break;case SWorldCollisionLayer.CELL_DIAG_UP_LEFT:switch(this.getCell(h-1,k+1)){case SWorldCollisionLayer.CELL_EMPTY:g=!1;break;default:++k}break;case SWorldCollisionLayer.CELL_DIAG_UP_RIGHT:switch(this.getCell(h-1,k-1)){case SWorldCollisionLayer.CELL_EMPTY:this.getCell(h-1,k)===SWorldCollisionLayer.CELL_EMPTY&&(g=!1);break;case SWorldCollisionLayer.CELL_FULL:g=!1;break;case SWorldCollisionLayer.CELL_DIAG_UP_RIGHT:--k}break;case SWorldCollisionLayer.CELL_EMPTY:g=
!1}f=this.getCell(--h,k)}while(g&&h>=b);var l=(h+1)*this.m_tileWidth,m=k*this.m_tileHeight;g=!0;b=~~((a+c)/this.m_tileWidth);++b;h=e;k=d;f=this.getCell(e,d);do{switch(f){case SWorldCollisionLayer.CELL_FULL:case SWorldCollisionLayer.CELL_PLATFORM:switch(this.getCell(h+1,k)){case SWorldCollisionLayer.CELL_EMPTY:g=!1;break;default:switch(this.getCell(h+1,k-1)){case SWorldCollisionLayer.CELL_FULL:g=!1;break;case SWorldCollisionLayer.CELL_DIAG_UP_LEFT:--k}}break;case SWorldCollisionLayer.CELL_DIAG_UP_LEFT:switch(this.getCell(h+
1,k-1)){case SWorldCollisionLayer.CELL_EMPTY:this.getCell(h+1,k)===SWorldCollisionLayer.CELL_EMPTY&&(g=!1);break;case SWorldCollisionLayer.CELL_FULL:g=!1;break;case SWorldCollisionLayer.CELL_DIAG_UP_LEFT:--k}break;case SWorldCollisionLayer.CELL_DIAG_UP_RIGHT:switch(this.getCell(h+1,k+1)){case SWorldCollisionLayer.CELL_EMPTY:g=!1;break;default:++k}break;case SWorldCollisionLayer.CELL_EMPTY:g=!1}f=this.getCell(++h,k)}while(g&&h<=b);return new Rectangle(l,m,h*this.m_tileWidth-l,k*this.m_tileHeight-m)}++d}Application.warn("getMaxFloorRange: no floor found at x:"+
a+" y:"+b);return new Rectangle(a,b,0)};
SWorldCollisionLayer.prototype.getFloorCollision=function(a,b){for(var c=~~(b/this.m_tileHeight),d=~~(a/this.m_tileWidth);c<this.m_height;){var e=this.getCell(d,c);if(e!==SWorldCollisionLayer.CELL_EMPTY){switch(e){case SWorldCollisionLayer.CELL_DIAG_UP_LEFT:case SWorldCollisionLayer.CELL_DIAG_UP_RIGHT:switch(e){case SWorldCollisionLayer.CELL_DIAG_UP_LEFT:return new Vector2D(a,c*this.m_tileHeight+(d+1)*this.m_tileWidth-a)}return new Vector2D(a,c*this.m_tileHeight+a-d*this.m_tileWidth)}return new Vector2D(a,
c*this.m_tileHeight)}++c}Application.warn("getFloorCollision: no floor found");return new Vector2D(a,b)};SWorldCollisionLayer.prototype.getTilePosition=function(a,b){return new Point(~~(a/this.m_tileWidth),~~(b/this.m_tileHeight))};SWorldCollisionLayer.prototype.getTileBelow=function(a,b,c){var d=0;for(a=~~(a/this.m_tileWidth);d<=c;){var e=this.getCell(a,~~(b/this.m_tileHeight));if(e!=SWorldCollisionLayer.CELL_EMPTY)return e;b+=this.m_tileHeight;d+=this.m_tileHeight}return SWorldCollisionLayer.CELL_EMPTY};
SWorldCollisionLayer.prototype.getRayCollision=function(a,b,c,d){b=~~(b/this.m_tileHeight);for(c=~~(a/this.m_tileWidth);b<this.m_height;){if(this.getCell(c,b)!=SWorldCollisionLayer.CELL_EMPTY)return new Vector2D(a,b*this.m_tileHeight);++b}return null};
SWorldCollisionLayer.prototype.addTileCell=function(a,b,c,d){if(this.m_world.showCollisions){var e=this.getCell(a,b);e>SWorldCollisionLayer.CELL_EMPTY&&(e=Application.instance.getClip(this.m_frames[e]),this.setBufferCell(c,d,e),this.m_canvas.addChild(e),e.position.x=a*this.m_tileWidth,e.position.y=b*this.m_tileHeight,e.scale.x=this.m_tileWidth/32,e.scale.y=this.m_tileHeight/32)}};
SWorldCollisionLayer.prototype.initCell=function(a,b){if(this.m_world.showCollisions){var c=this.getCell(a+this.m_minX,b+this.m_minY);c>SWorldCollisionLayer.CELL_EMPTY&&(c=Application.instance.getClip(this.m_frames[c]),this.m_canvas.addChild(c),c.position.x=(a+this.m_minX)*this.m_tileWidth,c.position.y=(b+this.m_minY)*this.m_tileHeight,c.scale.x=this.m_tileWidth/32,c.scale.y=this.m_tileHeight/32,this.setBufferCell(a,b,c))}};SWorldCollisionLayer.prototype.parallaxX=function(){return this.m_world.camera().getX()};
SWorldCollisionLayer.prototype.parallaxY=function(){return this.m_world.camera().getY()};SWorldCollisionLayer.prototype.render=function(a){this.m_world.showCollisions&&SWorldTileLayer.prototype.render.call(this,a)};function SWorldMarkerLayer(a,b){SWorldBaseLayer.call(this,a,b);this.m_width=a.width();this.m_height=a.height();this.m_type=SWorldBaseLayer.TYPE_MARKERS;this.actionZones=[];this.loadData(b)}Application.subclass(SWorldMarkerLayer,SWorldBaseLayer);SWorldMarkerLayer.ID_PHYSICS="physics";
SWorldMarkerLayer.prototype.loadData=function(a){if(this.m_name==SWorldMarkerLayer.ID_PHYSICS)for(var b=0;b<a.elements.length;b++)if("rectangle"===a.elements[b].type){var c=new SEdiZone(a.elements[b].filter,a.elements[b].id,a.elements[b].x,a.elements[b].y,a.elements[b].w,a.elements[b].h,null==a.elements[b].params?"":a.elements[b].params);this.actionZones.push(c)}};
SWorldMarkerLayer.prototype.onDebugDraw=function(a){for(var b=0;b<this.actionZones.length;b++)ContextGraphics.drawRectangle(a,this.actionZones[b].x,this.actionZones[b].y,this.actionZones[b].w,this.actionZones[b].h,2,Common.COLOR_YELLOW,Common.COLOR_NONE)};SWorldMarkerLayer.prototype.render=function(a){this.m_world.showCollisions&&SWorldBaseLayer.prototype.render.call(this,a)};
SWorldMarkerLayer.prototype.free=function(){var a=0;if(this.actionZones){for(;a<this.actionZones.length;)this.actionZones[a]=null,++a;this.actionZones=null}SWorldBaseLayer.prototype.free.call(this)};
function SWorldSpriteLayer(a,b){SWorldBaseLayer.call(this,a,b);this.m_type=SWorldBaseLayer.TYPE_SPRITES;this.m_actors=[];this.m_cameraRect=new Rectangle(0,0,a.camera().width(),a.camera().height());var c=b.width;c=this.m_world.width()<=this.m_world.camera().width()?1:(c-this.m_world.camera().width())/(this.m_world.width()-this.m_world.camera().width());var d=b.height;d=this.m_world.height()<=this.m_world.camera().height()?1:(d-this.m_world.camera().height())/(this.m_world.height()-this.m_world.camera().height());
var e=b.offsetX,f=b.offsetY,g=new Rectangle(b.left-2,b.top-2,b.right-b.left+4,b.bottom-b.top+4);this.m_quadtree=new QuadTree(g,0,c,d,e,f);g=b.image;for(var h=b.palette,k=g.length,l=0;l<k;)this.readSprite(a,g[l],c,d,e,f,h,b.name),++l}Application.subclass(SWorldSpriteLayer,SWorldBaseLayer);SWorldSpriteLayer.INDEX_X=0;SWorldSpriteLayer.INDEX_Y=1;SWorldSpriteLayer.INDEX_W=2;SWorldSpriteLayer.INDEX_H=3;SWorldSpriteLayer.INDEX_CLIPNAME=4;
SWorldSpriteLayer.prototype.readSprite=function(a,b,c,d,e,f,g,h){var k=b.d,l=k[SWorldSpriteLayer.INDEX_X],m=k[SWorldSpriteLayer.INDEX_Y];a=new SSpriteActor(this.m_canvas,a,l,m,c,d,e,f);a.m_clip=Application.instance.getClip(g[k[SWorldSpriteLayer.INDEX_CLIPNAME]]);a.m_clip.setPosition(this.m_x-this.m_world.camera().getX(),this.m_y-this.m_world.camera().getY());g="undefined"===typeof b.blend?0:b.blend;a.m_clip.setBlend?a.m_clip.setBlend(g):a.m_clip.blendMode=g;a.setAlwaysVisible(1===parseInt(b.av,10));
g="undefined"!==typeof b.sx?b.sx:1;d="undefined"!==typeof b.sy?b.sy:1;a.m_clip.setScale(g,d);c="undefined"!==typeof b.rot?b.rot:0;a.m_clip.rotation=c;this.m_actors.push(a);this.m_canvas.addChild(a.m_clip);g=Math.abs(k[SWorldSpriteLayer.INDEX_W]*g);var n=Math.abs(k[SWorldSpriteLayer.INDEX_H]*d);if(0===c)m=new NamedRectangle(a,l-g/2,m-n/2,g,n);else{k=Math.cos(c);c=Math.sin(c);e=g/2;f=-n/2;var p=g/2,q=n/2,r=-g/2,t=n/2;d=-g/2;n=-n/2;g=l+e*k-f*c;e=m+e*c+f*k;f=l+p*k-q*c;p=m+p*c+q*k;q=l+r*k-t*c;r=m+r*c+
t*k;l=l+d*k-n*c;m=m+d*c+n*k;k=Math.min(g,f,q,l);c=Math.min(e,p,r,m);m=new NamedRectangle(a,k,c,Math.max(g,f,q,l)-k,Math.max(e,p,r,m)-c)}this.m_quadtree.insert(m)?a.setQuadtreeRect(m):Application.log("Sprite "+b.image+" not inserted in layer "+h+"("+m.x+", "+m.y+", "+m.w+", "+m.h+")")};
SWorldSpriteLayer.prototype.render=function(a){var b=this.m_world.camera().getX(),c=this.m_world.camera().getY();this.m_cameraRect.setLeft(b);this.m_cameraRect.setTop(c);this.m_cameraRect.setRight(b+this.m_world.camera().width());this.m_cameraRect.setBottom(c+this.m_world.camera().height());b=this.m_quadtree.query(this.m_cameraRect);c=this.m_actors.length;for(var d=0;d<c;d++){var e=this.m_actors[d];e.updatePosition(a);if(e.isAwaitingDelete())this.m_quadtree.remove(e.getQuadtreeRect()),e.free(),this.m_actors[d]=
null,this.m_actors.splice(d--,1);else if(this.isVisible(b,e)){if(e.isIdle())e.onIdle(!1);e.update(a)}else if(!e.isIdle())e.onIdle(!0)}};SWorldSpriteLayer.prototype.isVisible=function(a,b){if(b.isAlwaysVisible())return!0;for(var c=a.length,d=0;d<c;d++)if(a[d].getObject()===b)return a.splice(d,1),!0;return!1};
SWorldSpriteLayer.prototype.free=function(){this.m_quadtree.free();this.m_cameraRect=this.m_quadtree=null;for(var a=this.m_actors.length,b=0;b<a;b++)this.m_actors[b].free(),this.m_actors[b]=null;this.m_actors=null;SWorldBaseLayer.prototype.free.call(this)};SWorldSpriteLayer.prototype.onDebugDraw=function(a){this.m_quadtree.onDebugDraw(a)};
function SSpriteActor(a,b,c,d,e,f,g,h){this.m_canvas=a;this.m_world=b;this.m_clip=null;this.m_x=c;this.m_y=d;this.screenX=c;this.screenY=d;this.m_parallaxXFactor=e;this.m_parallaxYFactor=f;this.m_xOffset=g;this.m_yOffset=h;this.m_alwaysVisible=this.m_isIdle=!1;this.m_quadtreeRect=null;this.m_isAwaitingDelete=!1}SSpriteActor.prototype.isIdle=function(){return this.m_isIdle};SSpriteActor.prototype.onIdle=function(a){this.m_isIdle=a;null!==this.m_clip&&(this.m_clip.visible=!a)};
SSpriteActor.prototype.isAlwaysVisible=function(){return this.m_alwaysVisible};SSpriteActor.prototype.setAlwaysVisible=function(a){this.m_alwaysVisible=a};SSpriteActor.prototype.getQuadtreeRect=function(){return this.m_quadtreeRect};SSpriteActor.prototype.setQuadtreeRect=function(a){this.m_quadtreeRect=a};SSpriteActor.prototype.isAwaitingDelete=function(){return this.m_isAwaitingDelete};SSpriteActor.prototype.setAwaitingDelete=function(a){this.m_isAwaitingDelete=a};
SSpriteActor.prototype.free=function(){null!==this.m_clip&&(this.m_clip.free(),this.m_canvas.removeChild(this.m_clip),this.m_clip=null);this.m_quadtreeRect=this.m_world=this.m_canvas=null};SSpriteActor.prototype.updatePosition=function(a){this.screenX=this.m_x-(~~(this.m_world.camera().getX()*this.m_parallaxXFactor)-this.m_xOffset);this.screenY=this.m_y-(~~(this.m_world.camera().getY()*this.m_parallaxYFactor)-this.m_yOffset)};
SSpriteActor.prototype.update=function(a){this.m_clip&&(this.m_clip.position.x=this.screenX,this.m_clip.position.y=this.screenY,this.m_clip.update&&this.m_clip.update(a))};
function SEdiZone(a,b,c,d,e,f,g){Rectangle.call(this,c-e/2,d-f/2,e,f);this.id=b;this.type=0;this.active=!1;this.params=Common.getParams(g);switch(a){case SEdiZone.ID_CLIMB:this.type=SEdiZone.CLIMB;break;case SEdiZone.ID_CAMERA:this.type=SEdiZone.CAMERA;break;case SEdiZone.ID_FLUID:this.type=SEdiZone.FLUID;break;case SEdiZone.ID_FORCE:this.type=SEdiZone.FORCE;break;case SEdiZone.ID_FRICTION:this.type=SEdiZone.FRICTION;break;default:Application.warn("Invalid physic zone ["+a+"]")}}
Application.subclass(SEdiZone,Rectangle);SEdiZone.CLIMB=1;SEdiZone.FLUID=2;SEdiZone.FORCE=3;SEdiZone.FRICTION=4;SEdiZone.CAMERA=5;SEdiZone.ID_CLIMB="climb";SEdiZone.ID_FLUID="fluid";SEdiZone.ID_FORCE="force";SEdiZone.ID_CAMERA="camera";SEdiZone.ID_FRICTION="friction";
function SActorPhysicsCollideModule(a,b,c,d){this.actor=a;this.world=b;this.range=c||{x1:2,x2:2,y1:2,y2:2};this.fixtureDef=d||null;this.collisionsMap={};this.offsetY=this.offsetX=this.oldTileY=this.oldTileX=0;this.dirty=!1;this.checkByBlock=!0}SActorPhysicsCollideModule.prototype.free=function(){for(var a in this.collisionsMap)this.collisionsMap[a]&&(this.collisionsMap[a].free(),this.collisionsMap[a]=null,delete this.collisionsMap[a]);this.range=this.world=this.actor=this.collisionsMap=null};
SActorPhysicsCollideModule.prototype.update=function(a){if(!this.world.physicsLayer)Application.error("No physics layer create, YOU must be export EDI MAP with [usePhysicCollision = 1] in properties ");else if(this.actor&&this.actor.bodyPhysics){var b=this.world.physicsLayer.getTilePosition(this.actor.getX()+this.offsetX,this.actor.getY()+this.offsetY);a=b.x;b=b.y;if(a!==this.oldTileX||b!==this.oldTileY||this.dirty){var c,d,e="";for(e in this.collisionsMap)this.collisionsMap[e]&&(this.collisionsMap[e].toDelete=
!0);if(this.checkByBlock)for(c=a-this.range.x1;c<=a+this.range.x2;c++)for(d=b-this.range.y1;d<=b+this.range.y2;d++)this.chekNameMapCollision(c,d);else{for(c=a-this.range.x1;c<=a+this.range.x2;c++)this.chekNameMapCollision(c,b);for(d=b-this.range.y1;d<=b+this.range.y2;d++)this.chekNameMapCollision(a,d)}for(e in this.collisionsMap)this.collisionsMap[e].toDelete&&(this.collisionsMap[e].free(),this.collisionsMap[e]=null,delete this.collisionsMap[e]);this.oldTileX=a;this.oldTileY=b;this.dirty=!1}}};
SActorPhysicsCollideModule.prototype.chekNameMapCollision=function(a,b){var c="t_"+a+"_"+b;this.collisionsMap[c]?0!==this.world.getCell(a,b)&&(this.collisionsMap[c].toDelete=!1):(a=this.world.physicsLayer.createBodyCollideTile(a,b,this.fixtureDef))&&(this.collisionsMap[c]=new BodyBlock(a))};function BodyBlock(a){this.body=a;this.toDelete=!1}BodyBlock.prototype.free=function(){this.body.free();this.body=null};function SKeyboard(a){this.caller=a;this.keyMap={}}
SKeyboard.prototype.bind=function(a,b,c,d){this.keyMap[a]=new KeyboardFunctionsBind(a,this.caller,b,c,d)};SKeyboard.prototype.resetKey=function(a){this.keyMap[a]&&(this.keyMap[a].isPressed=!1)};SKeyboard.prototype.reset=function(){for(var a in this.keyMap)this.keyMap[a].isPressed=!1};SKeyboard.prototype.isPressed=function(a){return this.keyMap[a].isPressed};SKeyboard.prototype.onKeyPress=function(a){if(this.keyMap[a])this.keyMap[a].onPress()};SKeyboard.prototype.onKeyRelease=function(a){if(this.keyMap[a])this.keyMap[a].onRelease()};
SKeyboard.prototype.update=function(a){for(var b in this.keyMap)if(this.keyMap[b].checkHold)this.keyMap[b].onHold(a)};SKeyboard.prototype.free=function(){this.caller=null;for(var a in this.keyMap)this.keyMap[a].free(),this.keyMap[a]=null,delete this.keyMap[a];this.keyMap=null};
function KeyboardFunctionsBind(a,b,c,d,e){this.keycode=a;this.caller=b;this.callbackPress=c||null;this.callbackRelease=d||null;this.callbackHold=e||null;this.isPressed=!1;this.checkHold=this.callbackHold?!0:!1;this.timePressed=0}KeyboardFunctionsBind.prototype.free=function(){this.callbackRelease=this.callbackPress=this.caller=null};KeyboardFunctionsBind.prototype.onPress=function(){this.isPressed||(this.isPressed=!0,this.timePressed=0,this.callbackPress&&this.callbackPress.call(this.caller,this.keycode))};
KeyboardFunctionsBind.prototype.onRelease=function(){this.isPressed&&(this.isPressed=!1,this.callbackRelease&&this.callbackRelease.call(this.caller,this.keycode))};KeyboardFunctionsBind.prototype.onHold=function(a){this.isPressed&&(this.timePressed+=a,this.callbackHold&&this.callbackHold.call(this.caller,this.timePressed,this.keycode))};
function MobileObject(a,b,c,d,e,f){SWorldActor.call(this,a,b,d,e,c);this.m_speed=new Vector2D;this.m_prevX=this.m_x;this.m_prevY=this.m_y;this.m_motionController=new MotionController(this.m_x,this.m_y,f);this.m_motionController.startMotion()}Application.subclass(MobileObject,SWorldActor);
MobileObject.prototype.update=function(a){this.m_motionController.update(a);this.m_x=this.m_motionController.getX();this.m_y=this.m_motionController.getY();this.m_speed.x=(this.m_x-this.m_prevX)/a;this.m_speed.y=(this.m_y-this.m_prevY)/a;this.m_prevX=this.m_x;this.m_prevY=this.m_y;SWorldActor.prototype.update.call(this,a)};MobileObject.prototype.free=function(){this.m_motionController.free();this.m_speed=this.m_motionController=null;SWorldActor.prototype.free.call(this)};
function MobilePlatform(a,b,c,d,e,f){MobileObject.call(this,a,b,c,d,e,f);this.m_isVehicle=!0;this.m_world.addMobilePlatform(this);this.updateBounds();this.setRangeControlled(!0)}Application.subclass(MobilePlatform,MobileObject);
function ScrollGame(a){SGame.call(this,a);this.zoom=new ScrollZoom(a);ScrollGame.instance=this;this.player=this.world=null;this.bgsListIds=Common.mixer(["w1_","w2_","w3_","w4_"]);this.boss=this.mysterioBack=this.collisionManager=this.actorManager=null;this.coins=0;this.section=null;this.tracks=TrackGenerator.generate();this.tracksLevel=1;this.distanceUpgradeLevel=Common.copyNumericArray(window.config.player.distanceUpgradeLevel);this.tracksLevelEnviroment=1;this.isPress=!1;this.upgradeSpeedLevel=
DataManager.instance.getGlobalRegister(DataManager.REG_STORE_UPGRAGE_1);this.upgradeVehicle=DataManager.instance.getGlobalRegister(DataManager.REG_STORE_UPGRAGE_4);this.upgradeStylish=DataManager.instance.getGlobalRegister(DataManager.REG_STORE_UPGRAGE_2);this.upgradeCoinMultiplier=window.config.player.coinMultiplier[DataManager.instance.getGlobalRegister(DataManager.REG_STORE_UPGRAGE_3)];ScrollBossMid.APPEAR_LEVEL=0;this.enviroment=new GameEnviroment(this);this.achievements=new Achievements(this);
this.missions=new MissionManager(this);this.stores=new StoreManager(this);this.touchControl=new TouchControl;this.touchControl.callerObject=this;this.touchControl.onPressListener=this.onPressControl;this.touchControl.onReleaseListener=this.onReleaseControl;this.touchControl.onHoldListener=this.onHoldControl;this.touchControl.onReleaseHoldListener=this.onHoldReleaseControl;this.intro=new GameIntro(this);this.outro=new GameOutro(this);this.distance=0;this.distanceRecord=DataManager.instance.getGlobalRegister(DataManager.REG_DISTANCE_RECORD);
this.xRecord=100*this.distanceRecord/window.config.player.metersMultiplier[this.upgradeSpeedLevel];this.clipRecord=null;this.reset();this.m_hud.setCoins(this.coins);this.gameShaders=null;Application.RENDER_MODE!==Application.RENDER_WEBGL||Application.isLowDevice||(this.gameShaders=new GameShaders(this))}Application.subclass(ScrollGame,SGame);ScrollGame.instance=null;ScrollGame.timeCreationVehicle=0;ScrollGame.timeCreationMagnet=0;ScrollGame.sectionsDrone=Common.mixer(["_sg1","_sg2","_sg3","_sg4"]);
ScrollGame.prototype.free=function(){ScrollGame.instance=null;this.world.free();this.actorManager.free();this.collisionManager.free();this.intro.free();this.outro.free();this.missions.free();this.achievements.free();this.stores.free();this.enviroment&&this.enviroment.free();this.gameShaders&&this.gameShaders.free();this.boss&&this.boss.free();this.boss=this.achievements=this.missions=this.stores=this.outro=this.intro=this.enviroment=this.collisionManager=this.actorManager=this.world=this.gameShaders=
null;SGame.prototype.free.call(this)};ScrollGame.prototype.init=function(){this.m_hud=new HudGame("mcGuiHUD");this.m_hud.canvas.visible=!1};ScrollGame.prototype.enabledGame=function(){this.m_hud.canvas.visible=!0};ScrollGame.prototype.onShake=function(a,b){Common.shake(this.canvas,a||400,b||6,25)};
ScrollGame.prototype.reset=function(){Application.sandbox&&(this.upgradeSpeedLevel=parseInt(Application.sandbox.startSettings.upgSpeed,10));this.world=new ScrollWorld(this,this.canvas);this.world.init(window.scroll_worlds.world_1,this.getNextBgId(),Infinity,1E3,window.innerWidth/Layout.scale,Application.APP_HEIGHT);this.actorManager=new ScrollActorManager(this,this.world);this.collisionManager=new ScrollCollisionManager(this);var a=this.world.getLayer("player").canvas||this.world.getLayer("objects").canvas;
this.player=new Spiderman(a,this.world,200,400,{skin:"player"});this.world.camera.updateableObject=this.player;this.world.camera.y=116;ScrollCamera.R_LIMIT_BASE=1200>window.innerWidth?.25:.2;this.world.camera.updateLimits(.18,ScrollCamera.R_LIMIT_BASE,.1,.9);this.world.camera.update(0);this.world.update(0);this.mysterioBack=new MysterioBack(this);0===DataManager.instance.getGlobalRegister(DataManager.REG_ACHIEVEMENT_6)&&0<DataManager.instance.getGlobalRegister(DataManager.REG_ALL_MISSIONS)&&(this.createBoss(),
this.world.changePrefix("w4_",!0),Application.instance.stopAllSounds(),Application.instance.playSound("MUSIC_GAME_BOSS"),this.m_hud.hideAll());Global.createBossLevelCheat&&(this.createBoss(),this.world.changePrefix("w4_",!0),Application.instance.stopAllSounds(),Application.instance.playSound("MUSIC_GAME_BOSS"),this.m_hud.hideAll());Application.sandbox||this.addSection()};
ScrollGame.prototype.createBoss=function(){this.boss=new ScrollBoss(this.world.getLayer("static_front").canvas,this.world,500,450,{})};ScrollGame.prototype.createMidBoss=function(){this.actorManager.forceRemoveAllsEnemies();this.boss=new ScrollBossMid(this.world.getLayer("static_front").canvas,this.world,500,450,{})};ScrollGame.prototype.fixGameScale=function(){this.m_hud&&this.m_hud.fixGameScale();this.zoom&&this.zoom.fixGameScale();this.world&&(this.world.camera.width=window.innerWidth/Layout.scale)};
ScrollGame.prototype.showNegativeShader=function(a){this.gameShaders&&this.gameShaders.showNegativeShader(a)};ScrollGame.prototype.onKeyDown=function(a){switch(a){case Common.KEY_P:GuiGame.instance.addPopup(GuiPopupPause,"mcGuiPopupsPause")}if(this.gameplayEnable()&&(SGame.prototype.onKeyDown.call(this,a),this.player))this.player.onKeyDown(a)};ScrollGame.prototype.onKeyUp=function(a){if(this.gameplayEnable()&&(SGame.prototype.onKeyUp.call(this,a),this.player))this.player.onKeyUp(a)};
ScrollGame.prototype.onAppLostFocus=function(){if(this.player)this.player.onAppLostFocus()};ScrollGame.prototype.onPointerPress=function(a,b){this.gameplayEnable()&&(this.touchControl&&(this.isPress=this.touchControl.onPointerPress(a)),this.player&&this.player.state()===ScrollPlayer.ST_STYLISH&&(this.m_hud.fillStylishBar(),Application.instance.effectManager.createEffect("fxGetStylish",a.data.global.x,a.data.global.y,GuiGame.instance.canvas)))};
ScrollGame.prototype.onPointerRelease=function(a,b){this.gameplayEnable()&&this.touchControl&&(this.isPress=!this.touchControl.onPointerRelease(a))};ScrollGame.prototype.onPressControl=function(a){if(this.player&&0>=this.player.timeNoInputs)this.player.onPointerPress()};ScrollGame.prototype.onReleaseControl=function(a){if(this.player&&0>=this.player.timeNoInputs)this.player.onPointerRelease()};ScrollGame.prototype.onHoldReleaseControl=function(a){if(this.player&&0>=this.player.timeNoInputs)this.player.onPointerRelease()};
ScrollGame.prototype.onHoldControl=function(a){};ScrollGame.prototype.getNextBgId=function(){var a=this.bgsListIds.splice(0,1)[0];this.bgsListIds.push(a);Application.instance.stopAllSounds();switch(a){case "w1_":Application.instance.playSound("MUSIC_GAME_CENTRALPARK");break;case "w2_":Application.instance.playSound("MUSIC_GAME_MANHATTAN");break;case "w3_":Application.instance.playSound("MUSIC_GAME_QUEENS");break;case "w4_":Application.instance.playSound("MUSIC_GAME_TIMESQUARE")}return a};
ScrollGame.prototype.getNextSectionDrone=function(){var a=ScrollGame.sectionsDrone.splice(0,1)[0];ScrollGame.sectionsDrone.push(a);return a};ScrollGame.prototype.addCoins=function(a){this.coins+=a;this.hud().setCoins(this.coins)};
ScrollGame.prototype.checkDistance=function(){if(this.world){var a=-this.world.getLayer("player").canvas.position.x;var b=~~(.01*a*window.config.player.metersMultiplier[this.upgradeSpeedLevel]);this.distance!==b&&(this.distance=b,this.m_hud.setDistance(this.distance),this.missions.onCountTravel(this.distance),this.achievements.onCount(Achievements.TYPE_TRAVEL,this.distance));0!==this.distanceRecord&&a>this.xRecord-2E3&&!this.clipRecord&&(null===this.boss||this.boss&&!this.boss.isReal)&&(this.clipRecord=
Application.instance.getAnimation("record"),this.clipRecord.position.x=this.xRecord+200,this.world.getLayer("player").canvas.addChild(this.clipRecord))}};
ScrollGame.prototype.addSection=function(){if(Application.sandbox)this.section=new Section(this,Application.sandbox.startSettings.map,parseInt(Application.sandbox.startSettings.difficulty,10));else{if(this.boss)return;0===this.tracks[0].length&&(this.tracks.shift(),Application.info("ScrollGame :: addSection [ CHANGE TRACK ]"),this.tracksLevelEnviroment++,this.mysterioBack.introScene());0===this.tracks.length&&(this.tracks=TrackGenerator.generate(),Application.info("ScrollGame :: addSection [ REGENERATE ALL TRACKS ]"));
var a=this.player.state()===ScrollPlayer.ST_ON_VEHICLE?this.getNextSectionDrone():this.tracks[0].shift();this.section=new Section(this,a,this.tracksLevel)}this.section&&(Application.info("ScrollGame :: addSection ["+this.section.mapName+"] level ["+this.section.mapLevel+"]"),100===this.m_hud.getPower()&&this.actorManager.createStylishObject(this.section.endX+100))};
ScrollGame.prototype.gameplayEnable=function(){return this.intro.state!==GameIntro.ST_NONE||this.outro.state!==GameOutro.ST_NONE||this.boss&&this.boss.behavior&&this.boss.behavior.type===BossBehavior.TYPE_INTRO&&4>this.boss.behavior.state?!1:!0};
ScrollGame.prototype.update=function(a){SGame.prototype.update.call(this,a);this.world&&this.world.update(a);this.actorManager&&this.actorManager.update(a);this.player&&this.player.update(a);this.boss&&(this.boss.update(a),this.boss.isAwaitingDelete()&&(this.boss.free(),this.boss=null));this.checkDistance();this.mysterioBack&&this.mysterioBack.update(a);this.collisionManager&&this.collisionManager.update(a);this.intro&&this.intro.update(a);this.outro&&this.outro.update(a);this.touchControl&&this.touchControl.update(a);
this.zoom&&this.zoom.update(a);0<this.distanceUpgradeLevel.length&&this.distance>=this.distanceUpgradeLevel[0]&&(this.tracksLevel++,this.distanceUpgradeLevel.splice(0,1));this.section&&this.world.xOutCamera()>this.section.endX&&this.addSection();this.boss&&this.boss.waitInsertSection&&(this.boss.waitInsertSection=!1,this.boss.summonSection=new Section(this,"_sm"+Common.randomInt(1,4),this.tracksLevel));!this.boss&&this.gameplayEnable()&&(ScrollGame.timeCreationMagnet+=a,ScrollGame.timeCreationMagnet>=
window.config.player.magnetTimeAppear&&(this.actorManager.createMagnet(),ScrollGame.timeCreationMagnet=-Common.randomInt(2E3,5E3)));!this.boss&&0<this.upgradeVehicle&&this.player&&this.player.canCountTimeToVehicle()&&!ScrollVehicleFly.instance&&(ScrollGame.timeCreationVehicle+=a,ScrollGame.timeCreationVehicle>=window.config.player.timeVehicleAppear[this.upgradeVehicle]&&(this.actorManager.createVehicle(),ScrollGame.timeCreationVehicle=0));this.gameShaders&&this.gameShaders.update(a);this.enviroment&&
this.enviroment.update(a)};function Section(a,b,c){this.mapName=b;this.mapLevel=c;this.mapWidth=a.actorManager.createSection(this.mapName,this.mapLevel,a.world.xOutCamera());this.initX=a.world.xOutCamera();this.endX=this.initX+this.mapWidth}function GameIntro(a){this.game=a;this.state=GameIntro.ST_NONE;this.m_idTutorial=0}GameIntro.ST_NONE=0;GameIntro.ST_INIT=1;GameIntro.ST_TUTORIAL=2;GameIntro.prototype.init=function(){this.state=GameIntro.ST_INIT;this.onInitGame()};
GameIntro.prototype.onInitGame=function(){if(0===DataManager.instance.getGlobalRegister(DataManager.REG_ALL_MISSIONS))GuiGame.instance.addPopup(GuiPopupMissions,"mcGuiPopupsMissions").onLoadPopup(this);else this.onCreateMessage()};GameIntro.prototype.addDialog=function(a){this.state=GameIntro.ST_INIT;DialogueNode.exists(a)&&GuiGame.instance.addPopup(GuiDialogue,"mcGuiDialog").initDialogue(a)};
GameIntro.prototype.onCreateMessage=function(){Application.instance.isMobileDevice?(this.state=GameIntro.ST_NONE,this.game.hud().showHand(!0)):this.createTutorial(GuiPopupTutorial.ID_TUTORIAL_PAUSE)||(this.state=GameIntro.ST_NONE,this.game.hud().showHand(!0))};
GameIntro.prototype.createTutorial=function(a){var b=0,c=!1;this.m_idTutorial=a;switch(this.m_idTutorial){case GuiPopupTutorial.ID_TUTORIAL_DRONE:a=DataManager.instance.getGlobalRegister(DataManager.REG_TUTORIAL_DRONE);c=0===a?!0:!1;b=DataManager.REG_TUTORIAL_DRONE;break;case GuiPopupTutorial.ID_TUTORIAL_LAUNCH:a=DataManager.instance.getGlobalRegister(DataManager.REG_TUTORIAL_LAUNCH);c=0===a?!0:!1;b=DataManager.REG_TUTORIAL_LAUNCH;break;case GuiPopupTutorial.ID_TUTORIAL_PAUSE:a=DataManager.instance.getGlobalRegister(DataManager.REG_TUTORIAL_PAUSE);
c=0===a?!0:!1;b=DataManager.REG_TUTORIAL_PAUSE;break;case GuiPopupTutorial.ID_TUTORIAL_GRAB:a=DataManager.instance.getGlobalRegister(DataManager.REG_TUTORIAL_GRAB),c=0===a?!0:!1,b=DataManager.REG_TUTORIAL_GRAB}if(!c)return!1;DataManager.instance.setGlobalRegister(b,1);DataManager.instance.saveData();this.state=GameIntro.ST_TUTORIAL;GuiGame.instance.addPopup(GuiPopupTutorial,"mcGuiPopupsTutorial").onLoadPage(this.m_idTutorial,this);return!0};
GameIntro.prototype.resetValue=function(){this.state=GameIntro.ST_NONE;if(this.m_idTutorial===GuiPopupTutorial.ID_TUTORIAL_DRONE)this.game.player.onCreateFXVehicle();else this.m_idTutorial===GuiPopupTutorial.ID_TUTORIAL_PAUSE&&this.game.hud().showHand(!0)};GameIntro.prototype.free=function(){this.game=null};GameIntro.prototype.update=function(a){};function GameOutro(a){this.game=a;this.state=GameOutro.ST_NONE}GameOutro.ST_NONE=0;GameOutro.ST_INIT=1;
GameOutro.prototype.init=function(){this.state!==GameOutro.ST_INIT&&(this.state=GameOutro.ST_INIT,this.game.player.gotoState(ScrollPlayer.ST_DEFEAT,!1))};GameOutro.prototype.onCreateTransition=function(){this.onEndRun()};GameOutro.prototype.onEndRun=function(){0===DataManager.instance.getGlobalRegister(DataManager.REG_ALL_MISSIONS)?GuiGame.instance.addPopup(GuiPopupEndRun,"mcGuiPopupsEndRun1"):GuiGame.instance.addPopup(GuiPopupEndGame,"mcGuiPopupsEndRun2")};
GameOutro.prototype.onEndBoss=function(){Application.instance.effectManager.createEffectAnimo("gui_transition02_in",0,0,this.game.hud().canvas).onComplete(this,this.onEndTransitionBoss);this.state=GameOutro.ST_INIT};GameOutro.prototype.onEndTransitionBoss=function(){GuiGame.instance.waitNextScreen=GuiManager.SC_CUTSCENE_END};
GameOutro.prototype.onDefeatByBoss=function(){Application.instance.effectManager.createEffectAnimo("gui_transition02_in",0,0,this.game.hud().canvas).onComplete(this,this.onEndTransitionDefeatByBoss);this.state=GameOutro.ST_INIT};GameOutro.prototype.onEndTransitionDefeatByBoss=function(){Global.loaded_gameplay_assets=[];GuiGame.instance.waitNextScreen=GuiManager.SC_GAME};GameOutro.prototype.free=function(){this.game=null};GameOutro.prototype.update=function(a){};
function ScrollZoom(a){this.canvas=a;this.canvas.pivot.x=Application.APP_WIDTH/2;this.canvas.pivot.y=Application.APP_HEIGHT/2;this.x=Application.APP_WIDTH/2;this.y=Application.APP_HEIGHT/2;this.state=0;this.scale=1;this.scaleLimit=this.scaleSpeed=0;this.canvas.position.y=this.y;this.fixGameScale()}ScrollZoom.ZOOM_DETAIL=1.2;ScrollZoom.ZOOM_MAX=1;ScrollZoom.ZOOM_MID=.88;ScrollZoom.ZOOM_MIN=.77;ScrollZoom.SPEED=2.5E-4;ScrollZoom.ST_NONE=0;ScrollZoom.ST_ZOOM_IN=1;ScrollZoom.ST_ZOOM_OUT=2;
ScrollZoom.prototype.free=function(){this.canvas=null};ScrollZoom.prototype.fixGameScale=function(){this.canvas.position.x=this.x+-(Layout.left/Layout.scale)};ScrollZoom.prototype.zoomIn=function(a,b){this.state=ScrollZoom.ST_ZOOM_IN;this.scaleSpeed=a||ScrollZoom.SPEED;this.scaleLimit=b||ScrollZoom.ZOOM_MAX};ScrollZoom.prototype.zoomOut=function(a,b){this.state=ScrollZoom.ST_ZOOM_OUT;this.scaleSpeed=a||ScrollZoom.SPEED;this.scaleLimit=b||ScrollZoom.ZOOM_MIN};
ScrollZoom.prototype.update=function(a){switch(this.state){case ScrollZoom.ST_ZOOM_OUT:this.scale-=this.scaleSpeed*a;this.scale<=this.scaleLimit&&(this.scale=this.scaleLimit,this.state=ScrollZoom.ST_NONE);break;case ScrollZoom.ST_ZOOM_IN:this.scale+=this.scaleSpeed*a,this.scale>=this.scaleLimit&&(this.scale=this.scaleLimit,this.state=ScrollZoom.ST_NONE)}this.canvas.scale.x=this.scale;this.canvas.scale.y=this.scale};
function MysterioBack(a){this.game=a;this.state="";this.limitX=this.x=0;this.y=700;this.applyChange=!1;this.character=new Character(0,0,this.game.world.getLayer("model").canvas);this.character.addState(MysterioBack.ST_STAND_IN,"big_boss_stand");this.character.addState(MysterioBack.ST_STAND,"big_boss_stand");this.character.addState(MysterioBack.ST_LAUGH,"big_boss_laught");this.character.addState(MysterioBack.ST_DISSAPEAR,"big_boss_dissapear");this.character.addState(MysterioBack.ST_SUMMON,"big_boss_summon");
this.character.addState(MysterioBack.ST_HIDE,"hide");this.character.onEndAnimation(this,this.onEndAnimation);this.gotoState(MysterioBack.ST_STAND);this.character.clip.visible=!1;this.fxSmoke=Application.instance.effectManager.createEffect("fxBossBg",0,500,this.game.world.getLayer("model").canvas);this.fxSmoke.setPause(!0);this.countAppears=0}MysterioBack.ST_STAND="stand";MysterioBack.ST_STAND_IN="stand_in";MysterioBack.ST_LAUGH="laugh";MysterioBack.ST_DISSAPEAR="dissapear";
MysterioBack.ST_SUMMON="summon";MysterioBack.ST_HIDE="hide";MysterioBack.prototype.introScene=function(){this.x=window.innerWidth/Layout.scale+500;this.limitX=this.x-800;this.gotoState(MysterioBack.ST_STAND_IN);this.applyChange=!1;this.fxSmoke&&(this.fxSmoke.x=this.limitX,this.fxSmoke.setPause(!1))};
MysterioBack.prototype.gotoState=function(a){this.state=a;this.character.gotoState(this.state);this.character.clip.position.x=this.x;this.character.clip.position.y=this.y;this.character.clip.scale.x=.7;this.character.clip.scale.y=.7;this.fxSmoke&&this.fxSmoke.swapOverDepth()};MysterioBack.prototype.onEndAnimation=function(a){switch(a){case MysterioBack.ST_SUMMON:this.fxSmoke&&this.fxSmoke.setPause(!0),this.gotoState(MysterioBack.ST_HIDE),this.countAppears++,0===this.countAppears%2&&this.game.createMidBoss()}};
MysterioBack.prototype.update=function(a){this.character&&(this.character.update(a),this.character.clip.position.x=this.x,this.character.clip.position.y=this.y);switch(this.state){case MysterioBack.ST_STAND_IN:this.x-=.5*a;this.x<=this.limitX&&this.gotoState(MysterioBack.ST_SUMMON);break;case MysterioBack.ST_SUMMON:a=this.character.clip.currentFrame,32!==a||this.applyChange||(this.game.showNegativeShader(!0),this.game.onShake(),this.applyChange=!0,this.game.world.changePrefix(this.game.getNextBgId(),
!0),Application.instance.effectManager.createEffect("fxTransition",window.innerWidth/Layout.scale*.5,500,this.game.world.getLayer("static_front").canvas),Application.instance.playSound("SND_SCN_CHANGE")),44===a&&this.game.showNegativeShader(!1)}};function TrackGenerator(){}TrackGenerator.FILL=300;TrackGenerator.getListMix=function(a){for(var b=[],c=0;c<a.length;c++)a[c]=Common.mixer(a[c]),b=b.concat(a[c]);b=Common.mixer(b);return b=Common.fillValuesArray(b,TrackGenerator.FILL)};
TrackGenerator.getListIntercale=function(a){var b=a[0].length,c=!0,d,e=[];for(d=0;d<a.length;d++)b!==a[d].length&&(c=!1),a[d]=Common.mixer(a[d]);if(c)for(c=0;c<b;c++)for(d=0;d<a.length;d++)e.push(a[d][c]);else Application.error("The Arrays does not have the same size");return e=Common.fillValuesArray(e,TrackGenerator.FILL)};TrackGenerator.getValue=function(a,b){return a.splice(0,b)};
TrackGenerator.generate=function(){var a=[],b=["_sc1","_sc2","_sc3","_sc4"],c=TrackGenerator.getListMix([b]),d=TrackGenerator.getListIntercale(["_se1 _se2 _se3 _se4 _se5 _se6 _se7 _se8".split(" "),"_sk1 _sk2 _sk3 _sk4 _sk5 _sk6 _sk7 _sk8".split(" ")]);b=TrackGenerator.getListMix([b]);for(var e=TrackGenerator.getListIntercale([["_lk1","_lk2","_lk3","_lk4"],["_le1","_le2","_le3","_le4"]]),f=TrackGenerator.getListMix([["_lc1","_lc2","_lc3","_lc4"]]),g=0;10>g;g++){var h=[];h=h.concat(TrackGenerator.getValue(c,
1));h=h.concat(TrackGenerator.getValue(d,Common.randomInt(3,5)));h=h.concat(TrackGenerator.getValue(b,1));h=h.concat(TrackGenerator.getValue(e,1));h=h.concat(TrackGenerator.getValue(f,1));a.push(h);Application.info("track >> "+g+" :: "+h)}return a};function GameEnviroment(a){this.game=a;this.timeDragon=this.timeFxRays=this.timeFxMeteor=this.timeFxSpin=this.timeFxEnemies=0}GameEnviroment.ST_NONE=0;GameEnviroment.prototype.free=function(){this.game=null};
GameEnviroment.prototype.bossEndIntro=function(){this.game.tracksLevelEnviroment=3;var a=this.game.world.camera.width,b=this.game.world.getLayer("sky");a=-b.x+200+(Math.random()*a-300);for(var c=0;3>c;c++)Application.instance.effectManager.createEffect("fxLightning",a,0,b.canvas),Application.instance.effectManager.createEffect("fxMeteor",a,0,b.canvas);Application.instance.playSound("SND_UI_SCENARIO_THUNDER")};
GameEnviroment.prototype.update=function(a){var b=this.game.world.camera.width;if(1<=this.game.tracksLevelEnviroment){var c=this.game.world.getLayer("bg_builds");var d=-c.x+200+(Math.random()*b-300);var e=200+Common.randomInt(0,200);this.timeFxSpin-=a;0>this.timeFxSpin&&(Application.instance.effectManager.createEffect("fxPortal",d,e,c.canvas),this.timeFxSpin=1===this.game.tracksLevelEnviroment?7E3:2===this.game.tracksLevelEnviroment?5E3:3500)}1<=this.game.tracksLevelEnviroment&&(c=this.game.world.getLayer("sky"),
d=-c.x+200+(Math.random()*b-300),e=200,this.timeFxRays-=a,0>this.timeFxRays&&(Application.instance.effectManager.createEffect("fxLightning",d,e,c.canvas),Application.instance.playSound("SND_UI_SCENARIO_THUNDER"),this.timeFxRays=1===this.game.tracksLevelEnviroment?6E3:2===this.game.tracksLevelEnviroment?4E3:3===this.game.tracksLevelEnviroment?2500:1500));3<=this.game.tracksLevelEnviroment&&(c=this.game.world.getLayer("sky"),this.timeFxEnemies-=a,0>this.timeFxEnemies&&(d=-c.x+200+(Math.random()*b-300),
e=200+Common.randomInt(0,200),Application.instance.effectManager.createEffect("fxEnemy01Bg",d,e,c.canvas),d=-c.x+200+(Math.random()*b-300),e=200+Common.randomInt(0,200),Application.instance.effectManager.createEffect("fxEnemy03Bg",d,e,c.canvas),this.timeFxEnemies=1E3));2<=this.game.tracksLevelEnviroment&&(c=this.game.world.getLayer("sky"),d=-c.x+200+(Math.random()*b-300),e=200,this.timeFxMeteor-=a,0>this.timeFxMeteor&&(Application.instance.effectManager.createEffect("fxMeteor",d,e,c.canvas),this.timeFxMeteor=
2===this.game.tracksLevelEnviroment?4500:3===this.game.tracksLevelEnviroment?3E3:1500),c=this.game.world.getLayer("sky"),d=-c.x+300+(Math.random()*b-300),e=200+Common.randomInt(0,200),this.timeDragon-=a,0>this.timeDragon&&(Application.instance.effectManager.createEffect("fxDragon",d,e,c.canvas),this.timeDragon=5E3))};function StoreManager(a){this.game=a;this.data=[];this.counters={};this.initialize()}StoreManager.TYPE_STORE_LUCK="luck";StoreManager.TYPE_STORE_SPEED="speed";
StoreManager.TYPE_STORE_SHIELD="shield";StoreManager.TYPE_STORE_ATTACK="attack";StoreManager.TYPE_STORE_ACROBATICS="acrobatics";
StoreManager.prototype.initialize=function(){this.counters={};this.counters[StoreManager.TYPE_STORE_LUCK]=0;this.counters[StoreManager.TYPE_STORE_SPEED]=0;this.counters[StoreManager.TYPE_STORE_SHIELD]=0;this.counters[StoreManager.TYPE_STORE_ATTACK]=0;this.counters[StoreManager.TYPE_STORE_ACROBATICS]=0;for(var a=Application.config.upgrades,b=0;b<a.length;b++){var c=new StoreData(a[b]),d=DataManager.instance.getGlobalRegister(DataManager["REG_STORE_UPGRAGE_"+c.idSaveData]);this.counters[c.type]=d;c.progress=
d;c.price=c.dataPrice[d>=c.dataPrice.length-1?c.dataPrice.length-1:d];c.completed=d===c.maxUpgrade;this.data.push(c)}};StoreManager.prototype.onBuy=function(a){for(var b=null,c=0;c<this.data.length&&(b=this.data[c],b.type!==a);c++);if(b.completed)return null;this.counters[a]++;b.progress=this.counters[a];b.price=b.dataPrice[b.progress>=b.dataPrice.length-1?b.dataPrice.length-1:b.progress];b.progress>=b.maxUpgrade&&(b.completed=!0,b.progress=b.maxUpgrade);return b};
StoreManager.prototype.free=function(){this.counters=this.data=this.game=null};StoreManager.prototype.applyBuy=function(a){DataManager.instance.setGlobalRegister(DataManager["REG_STORE_UPGRAGE_"+a.idSaveData],a.progress);DataManager.instance.saveData()};function StoreData(a){this.type=a.type;this.price=0;this.completed=!1;this.dataPrice=a.price;this.idSaveData=parseInt(a.idSaveData,10);this.maxUpgrade=parseInt(a.maxUpgrade,10);this.progress=0}
function Achievements(a){this.game=a;this.data=[];this.counters={};this.m_CountTravel=0;this.initialize()}Achievements.TYPE_COMBO="combo";Achievements.TYPE_ENEMY="enemy";Achievements.TYPE_TRAVEL="travel";Achievements.TYPE_STYLISH="stylish";Achievements.TYPE_MYSTERIO="mysterio";Achievements.TYPE_REAL_MYSTERIO="mysterio_real";
Achievements.prototype.initialize=function(){this.counters={};this.counters[Achievements.TYPE_COMBO]=0;this.counters[Achievements.TYPE_ENEMY]=0;this.counters[Achievements.TYPE_TRAVEL]=0;this.counters[Achievements.TYPE_STYLISH]=0;this.counters[Achievements.TYPE_MYSTERIO]=0;this.counters[Achievements.TYPE_REAL_MYSTERIO]=0;for(var a=Application.config.achievements,b=0;b<a.length;b++){var c=new AchievementData(a[b]),d=DataManager.instance.getGlobalRegister(DataManager["REG_ACHIEVEMENT_"+c.idSaveData]);
this.counters[c.type]=d;c.progress=d;c.completed=d===c.objective;this.data.push(c)}this.m_CountTravel=this.counters[Achievements.TYPE_TRAVEL]};
Achievements.prototype.onCount=function(a,b){b="undefined"===typeof b?0:b;for(var c,d=0;d<this.data.length;d++)if(this.data[d].type===a&&(c=this.data[d],!c.completed)){switch(c.type){case Achievements.TYPE_COMBO:case Achievements.TYPE_ENEMY:case Achievements.TYPE_STYLISH:case Achievements.TYPE_MYSTERIO:case Achievements.TYPE_REAL_MYSTERIO:this.counters[c.type]++;break;case Achievements.TYPE_TRAVEL:this.counters[c.type]=b+this.m_CountTravel}c.progress=this.counters[c.type];c.progress>=c.objective&&
(c.completed=!0,c.progress=c.objective,DataManager.instance.setGlobalRegister(DataManager["REG_ACHIEVEMENT_"+c.idSaveData],c.progress),DataManager.instance.saveData(),this.createPanelTrophie(c.idSaveData))}};Achievements.prototype.createPanelTrophie=function(a){var b=Application.instance.effectManager.createEffectGui("mcGuiPanelTrophy",0,0,this.game.hud().canvas);b.getControl("mcGuiTextInfo").setTextLocalized("STR_REP_INFO_TROPHIE_"+a);b.getControl("mcGuiTrophieIcon").clip.gotoAndStop(a)};
Achievements.prototype.onEndRun=function(){for(var a=0;a<this.data.length;a++)(this.data[a].type===Achievements.TYPE_TRAVEL||this.data[a].type===Achievements.TYPE_COMBO)&&this.data[a].progress<this.data[a].objective&&(this.data[a].progress=0),DataManager.instance.setGlobalRegister(DataManager["REG_ACHIEVEMENT_"+this.data[a].idSaveData],this.data[a].progress);DataManager.instance.saveData()};Achievements.prototype.free=function(){this.counters=this.data=this.game=null};
Achievements.prototype.update=function(a){};function AchievementData(a){this.type=a.type;this.completed=!1;this.idSaveData=parseInt(a.idSaveData,10);this.objective=parseInt(a.objective,10);this.progress=0}function MissionManager(a){this.game=a;this.missions=[];this.currentMissions=[];this.counters=[];this.condition="";this.initialize()}MissionManager.MAX_PROGRESS=100;MissionManager.TYPE_MISSION_RING="ring";MissionManager.TYPE_MISSION_ENEMY="enemy";MissionManager.TYPE_MISSION_COMBO="combo";
MissionManager.TYPE_MISSION_DRONE="drone";MissionManager.TYPE_MISSION_COINS="coins";MissionManager.TYPE_MISSION_TRAVEL="travel";MissionManager.TYPE_MISSION_BOUNCE="bounce";MissionManager.TYPE_MISSION_MYSTERIO="mysterio";MissionManager.TYPE_MISSION_ACROBATICS="acrobatics";MissionManager.TYPE_MISSION_COINS_TOTAL="coins_total";MissionManager.TYPE_CONDITION_NONE="none";MissionManager.TYPE_CONDITION_SWINGS="swings";MissionManager.TYPE_CONDITION_STYLISH_MOVE="stylish_move";
MissionManager.TYPE_CONDITION_WHILE_GLIDING="while_gliding ";
MissionManager.prototype.initialize=function(){for(var a=Application.config.missions,b=0;b<a.length;b++){var c=new MissionData(a[b]),d=DataManager.instance.getGlobalRegister(DataManager["REG_MISSION_GAME_"+c.idSaveData]),e=Math.floor(d*MissionManager.MAX_PROGRESS/c.objective);e=e>=MissionManager.MAX_PROGRESS?MissionManager.MAX_PROGRESS:e;c.completed=d>=c.objective;c.type!==MissionManager.TYPE_MISSION_COINS_TOTAL||c.completed||(d=DataManager.instance.getGlobalRegister(DataManager.REG_ALL_COINS),e=
Math.floor(d*MissionManager.MAX_PROGRESS/c.objective),e=e>=MissionManager.MAX_PROGRESS?MissionManager.MAX_PROGRESS:e);c.progress=d;c.percentage=e;c.viewHudFX=c.completed;c.viewEndFX=c.completed;this.missions.push(c)}b=[];for(a=0;a<this.missions.length;a++)this.missions[a].completed&&(b.push(this.missions.splice(a,1)[0]),a--);this.missions=this.missions.concat(b);for(a=0;3>a;a++)this.counters.push({idSaveData:this.missions[a].idSaveData,progress:this.missions[a].progress}),this.currentMissions.push(this.missions[a])};
MissionManager.prototype.onCheatsMission=function(a){a=this.currentMissions[a];if(!a.completed){for(var b={},c=0;c<this.counters.length;c++)if(this.counters[c].idSaveData===a.idSaveData){b=this.counters[c];break}b.progress=a.objective;a.completed=!0;a.percentage=MissionManager.MAX_PROGRESS;a.progress=a.objective;this.game.hud().addProgress(a,a.completed);DataManager.instance.setGlobalRegister(DataManager["REG_MISSION_GAME_"+a.idSaveData],a.progress);DataManager.instance.saveData()}};
MissionManager.prototype.onCheckingMissionIsComplete=function(a){return this.currentMissions[a].completed};
MissionManager.prototype.onCount=function(a,b){this.condition="undefined"===typeof b?MissionManager.TYPE_CONDITION_NONE:b;for(var c=0;c<this.currentMissions.length;c++)if(this.currentMissions[c].type===a){b=this.currentMissions[c];for(var d={},e=0;e<this.counters.length;e++)if(this.counters[e].idSaveData===b.idSaveData){d=this.counters[e];break}if(!b.completed&&!b.isLocked)if(!b.supportsHit&&this.game.player.receivedHit)b.isLocked=!0,b.progress=0,b.percentage=0,d.progress=0;else if(this.condition===
b.condition){d.progress++;switch(b.type){case MissionManager.TYPE_MISSION_COINS_TOTAL:d=DataManager.instance.getGlobalRegister(DataManager.REG_ALL_COINS);d=this.game.coins+d;break;case MissionManager.TYPE_MISSION_COMBO:e=d.progress;var f=this.game.hud().countCombo();d.progress=f>=b.objective?b.objective:e;d=d.progress;break;default:d=d.progress}b.percentage=Math.floor(100*d/b.objective);b.progress=d;d>=b.objective&&(b.completed=!0,b.percentage=MissionManager.MAX_PROGRESS,b.progress=b.objective);this.game.hud().addProgress(b,
b.completed)}}};MissionManager.prototype.resetCount=function(a){for(var b,c=0;c<this.currentMissions.length;c++)if(this.currentMissions[c].type===a){b=this.currentMissions[c];for(var d={},e=0;e<this.counters.length;e++)if(this.counters[e].idSaveData===b.idSaveData){d=this.counters[e];break}b.completed||b.isLocked||(b.progress=0,b.percentage=0,d.progress=0)}};
MissionManager.prototype.onCountTravel=function(a){this.condition="undefined"===typeof acrobatics?MissionManager.TYPE_CONDITION_NONE:acrobatics;for(var b,c=MissionManager.TYPE_MISSION_TRAVEL,d=0;d<this.currentMissions.length;d++)if(this.currentMissions[d].type===c){b=this.currentMissions[d];for(var e={},f=0;f<this.counters.length;f++)if(this.counters[f].idSaveData===b.idSaveData){e=this.counters[f];break}b.completed||b.isLocked||(!b.supportsHit&&this.game.player.receivedHit?(b.isLocked=!0,b.progress=
0,b.percentage=0,e.progress=0):this.condition===b.condition&&(e.progress=a,e=e.progress,b.percentage=Math.floor(100*e/b.objective),b.progress=e,e>=b.objective&&(b.completed=!0,b.percentage=MissionManager.MAX_PROGRESS,b.progress=b.objective),this.game.hud().addProgress(b,b.completed)))}};MissionManager.prototype.free=function(){this.counters=this.currentMissions=this.missions=this.game=null};
MissionManager.prototype.onEndRun=function(){for(var a=0;a<this.currentMissions.length;a++)this.currentMissions[a].progress<this.currentMissions[a].objective&&(this.currentMissions[a].progress=this.currentMissions[a].local?0:this.currentMissions[a].progress),DataManager.instance.setGlobalRegister(DataManager["REG_MISSION_GAME_"+this.currentMissions[a].idSaveData],this.currentMissions[a].progress);DataManager.instance.saveData()};
function MissionData(a){this.local=a.local;this.type=a.type;this.completed=this.isLocked=!1;this.condition=a.condition;this.supportsHit=a.supportsHit;this.percentage=this.progress=0;this.viewEndFX=this.viewHudFX=!1;this.idSaveData=parseInt(a.idSaveData,10);this.objective=parseInt(a.objective,10)}
function GameShaders(a){this.game=a;this.spMagnetDisplace=Application.instance.getSpriteFromUrl("media/images/animo/shader_ring.jpg");this.spMagnetDisplace.pivot.x=64;this.spMagnetDisplace.pivot.y=64;this.spMagnetDisplace.scale.x=3;this.spMagnetDisplace.scale.y=3;this.game.canvas.addChild(this.spMagnetDisplace);this.filterDisplacement=new window.PIXI.filters.DisplacementFilter(this.spMagnetDisplace);this.matrixFilter=new window.PIXI.filters.ColorMatrixFilter;this.matrixFilter.negative(!0);this.invulnerableFilter=
new window.PIXI.filters.ColorMatrixFilter;this.invulnerableFilter.brightness(10,!0)}GameShaders.prototype.free=function(){this.game.canvas.removeChild(this.spMagnetDisplace);this.spMagnetDisplace=null;this.game=this.filterDisplacement=this.matrixFilter=this.game.canvas.filters=null};GameShaders.prototype.showNegativeShader=function(a){a?this.addFilter(this.matrixFilter):this.removeFilter(this.matrixFilter)};
GameShaders.prototype.showMagnetShader=function(a){a?this.addFilter(this.filterDisplacement):this.removeFilter(this.filterDisplacement)};GameShaders.prototype.addFilter=function(a){null===this.game.canvas.filters?this.game.canvas.filters=[a]:-1===this.game.canvas.filters.indexOf(a)&&(this.game.canvas.filters=this.game.canvas.filters.concat(a))};
GameShaders.prototype.removeFilter=function(a){if(this.game.canvas.filters&&(a=this.game.canvas.filters.indexOf(a),-1!==a)){var b=this.game.canvas.filters;b.splice(a,1);this.game.canvas.filters=b}};GameShaders.prototype.update=function(a){this.spMagnetDisplace&&this.game.player&&(this.spMagnetDisplace.position.x=-this.game.world.camera.x+this.game.player.m_x,this.spMagnetDisplace.position.y=-this.game.world.camera.y+this.game.player.m_y)};
function HudGame(a,b,c){this.m_clipsWarning=[];this.enabledHand=!1;this.m_fixControls=[];this.m_currentTimeCombo=this.m_countCombo=this.m_power=0;this.m_activeCombo=!1;this.m_totalTimeCombo=1E3*Application.config.settings.timeCombo;this.m_combo=null;this.m_animitionRecord=!1;this.m_timeTutorial=this.m_oldWidthBoss=this.m_widthBoss=0;this.m_validateTutorialPower=this.m_animitionBarBoss=!1;this.m_progress=[];SScreen.call(this,a,b,c);this.canvas.hitArea=null;this.fxFullBar=Application.instance.effectManager.createEffect("fxBarFull",
0,0,this.getControl("mcContentFX").canvas);this.fxFullBar.setPause(!0);this.amountFillStylishBar=HudGame.WIDTH_STYLISH_BAR/window.config.player.stylishBarClicksToFill;this.stylishBarPercent=this.timeLifeStylishBar=0;this.loadData()}Application.subclass(HudGame,SScreen);HudGame.POWER_MAX=100;HudGame.WIDTH_STYLISH_BAR=262;HudGame.WIDTH_BOSS_BAR=260;HudGame.PROGRESS_ANIBAR_SPEED=1.2;HudGame.prototype.onDebugDraw=function(a){};
HudGame.prototype.loadData=function(){this.m_oldWidthBoss=this.m_widthBoss=HudGame.WIDTH_BOSS_BAR;this.showHand(!1);this.defaultPower();this.setDistance(0);this.chargeFixControls();this.showBarBoss(!1);this.getControl("mcGuiHudStylishBar").setVisible(!1);this.getControl("mcGuiBtnCheats").setVisible(Application.ALL_UNLOCKED_LEVELS)};
HudGame.prototype.showBarBoss=function(a){this.getControl("mcGuiHudBossBar").setVisible(a);a&&(this.getControl("mcGuiHudBossBar").clip.getInstance("bar").width=this.m_widthBoss,this.getControl("mcGuiHudBossBar").clip.getInstance("bar2").width=this.m_oldWidthBoss)};
HudGame.prototype.onUpdateBossbar=function(a){a=HudGame.WIDTH_BOSS_BAR*a/100;this.m_animitionBarBoss=!0;var b=this.getControl("mcGuiHudBossBar").clip.getInstance("bar").width;this.m_oldWidthBoss=b;a=b-a;this.m_widthBoss=0>=a?1:a;this.getControl("mcGuiHudBossBar").clip.getInstance("bar").width=this.m_widthBoss};
HudGame.prototype.showStylishBar=function(a){this.getControl("mcGuiHudStylishBar").setVisible(a);this.timeLifeStylishBar=a?window.config.player.stylishBarTimeLife:0;this.getControl("mcGuiHudBar").setVisible(!a);this.getControl("mcContentCombo").setVisible(!a);this.getControl("mcGuiBtnPause").setVisible(!a);this.getControl("mcContentFX").setVisible(!a);this.getControl("mcGuiHudCoins").setVisible(!a);this.getControl("mcGuiHudDistance").setVisible(!a);this.getControl("mcGuiTxtCoins").setVisible(!a);
this.getControl("mcGuiTxtDistance").setVisible(!a);this.m_power=0;this.addPower(0);Global.valueStylish=0;this.fxFullBar.setPause(!0);this.getControl("mcGuiHudStylishBar").clip.getInstance("bar").width=1};
HudGame.prototype.hideAll=function(){this.getControl("mcGuiHudBar").setVisible(!1);this.getControl("mcContentCombo").setVisible(!1);this.getControl("mcContentFX").setVisible(!1);this.getControl("mcGuiHudCoins").setVisible(!1);this.getControl("mcGuiHudDistance").setVisible(!1);this.getControl("mcGuiTxtCoins").setVisible(!1);this.getControl("mcGuiTxtDistance").setVisible(!1)};
HudGame.prototype.fillStylishBar=function(){var a=this.getControl("mcGuiHudStylishBar");a&&a.clip.getInstance("bar").width<HudGame.WIDTH_STYLISH_BAR&&(a.clip.getInstance("bar").width+=this.amountFillStylishBar,Application.instance.effectManager.createEffect("fxStylishBar",0,0,a.clip),a.clip.getInstance("bar").width>=HudGame.WIDTH_STYLISH_BAR&&(a.clip.getInstance("bar").width=HudGame.WIDTH_STYLISH_BAR,this.timeLifeStylishBar=200))};
HudGame.prototype.applyStylish=function(){this.stylishBarPercent=this.getControl("mcGuiHudStylishBar").clip.getInstance("bar").width/HudGame.WIDTH_STYLISH_BAR;this.showStylishBar(!1);ScrollGame.instance&&ScrollGame.instance.player&&ScrollGame.instance.player.applyStylish()};
HudGame.prototype.showHand=function(a){this.enabledHand=a;if(1===DataManager.instance.getGlobalRegister(DataManager.REG_TUTORIAL_DRONE))this.getControl("mcGuiHand").setVisible(!1);else{var b=Application.instance.isMobileDevice?"mcGuiTutorialsPressandhold":"mcGuiTutorialsPressandhold_pc";this.getControl("mcGuiHand").setClip(b);this.getControl("mcGuiHand").setVisible(a)}};HudGame.prototype.setCoins=function(a){this.getControl("mcGuiTxtCoins").setTextReplace("STR_REP_HUD_COINS_DATA",["#"],[a])};
HudGame.prototype.setDistance=function(a){this.getControl("mcGuiTxtDistance").setTextReplace("STR_REP_HUD_DISTANCE_DATA",["#"],[a]);if(ScrollGame.instance&&(null===ScrollGame.instance.boss||ScrollGame.instance.boss&&!ScrollGame.instance.boss.isReal)){var b=ScrollGame.instance.distanceRecord;0!==b&&a>=b&&!this.m_animitionRecord&&(this.m_animitionRecord=!0,Application.instance.effectManager.createEffectGui("mcGuiNewRecord",Application.APP_WIDTH/2,180,this.canvas))}};HudGame.prototype.countCombo=function(){return this.m_countCombo};
HudGame.prototype.addProgress=function(a,b){b&&(a=new GuiProgress("mcGuiMissionProgress",a,this),this.getControl("mcContentProgress").canvas.addChild(a.canvas),this.m_progress.push(a),this.m_progress[0].viewProgress||(this.m_progress[0].viewProgress=!0,this.m_progress[0].onResumeScreen()))};
HudGame.prototype.destroyProgress=function(){for(var a=0;a<this.m_progress.length;a++)this.m_progress[a].isAwaitingDelete&&(this.m_progress[a].free(),this.m_progress[a]=null,this.m_progress.splice(a--,1));0>=this.m_progress.length||this.m_progress[0].viewProgress||(this.m_progress[0].viewProgress=!0,this.m_progress[0].onResumeScreen())};
HudGame.prototype.addCombo=function(){this.m_countCombo++;2>this.m_countCombo||(ScrollGame.instance.missions.onCount(MissionManager.TYPE_MISSION_COMBO),ScrollGame.instance.achievements.onCount(Achievements.TYPE_COMBO),null===this.m_combo?(this.m_combo=new GuiCombo("mcGuiCombo",this.m_countCombo),this.getControl("mcContentCombo").canvas.addChild(this.m_combo.canvas)):this.m_combo.refreshData(this.m_countCombo),this.m_activeCombo=!0,this.m_currentTimeCombo=0)};
HudGame.prototype.destroyCombo=function(){this.m_activeCombo=!1;this.m_currentTimeCombo=this.m_countCombo=0;if(null!==this.m_combo)this.m_combo.onResumeScreen();ScrollGame.instance.missions.resetCount(MissionManager.TYPE_MISSION_COMBO)};HudGame.prototype.getPower=function(){return this.m_power};
HudGame.prototype.defaultPower=function(){this.m_power=Global.valueStylish;var a=this.m_power/HudGame.POWER_MAX,b=1===a?"fxBarFull":"fxGetOrb";this.getControl("mcGuiHudBar").clip.getInstance("bar").scale.y=a;0!==a&&(1===a?this.fxFullBar.setPause(!1):(this.fxFullBar.setPause(!0),Application.instance.effectManager.createEffect(b,0,0,this.getControl("mcContentFX").canvas)))};
HudGame.prototype.addPower=function(a){this.m_power=SMath.setRange(this.m_power+a,HudGame.POWER_MAX,0);a=this.m_power/HudGame.POWER_MAX;var b=1===a?"fxBarFull":"fxGetOrb";this.getControl("mcGuiHudBar").clip.getInstance("bar").scale.y=a;0!==a&&(1===a?(this.fxFullBar.setPause(!1),this.m_validateTutorialPower=0===DataManager.instance.getGlobalRegister(DataManager.REG_TUTORIAL_GRAB)):(this.fxFullBar.setPause(!0),Application.instance.effectManager.createEffect(b,0,0,this.getControl("mcContentFX").canvas)),
Global.valueStylish=this.m_power)};HudGame.prototype.createWarning=function(a){var b=Application.instance.getClip("mcWarning");b.position.x=-116;b.position.y=a;this.getControl("mcContentWarnig").canvas.addChild(b);this.m_clipsWarning.push(b)};HudGame.prototype.destroyWarning=function(){0!==this.m_clipsWarning.length&&(this.getControl("mcContentWarnig").canvas.removeChild(this.m_clipsWarning[0]),this.m_clipsWarning[0]=null,this.m_clipsWarning.splice(0,1),Application.instance.playSound("SND_HAZARDS_GASROCKETS_LAUNCH"))};
HudGame.prototype.chargeFixControls=function(){this.m_fixControls=[{fix:"lf",x:0,clip:this.getControl("mcGuiBtnPause")},{fix:"lf",x:0,clip:this.getControl("mcContentCombo")},{fix:"lf",x:0,clip:this.getControl("mcContentProgress")},{fix:"rg",x:0,clip:this.getControl("mcGuiHudDistance")},{fix:"rg",x:0,clip:this.getControl("mcGuiHudCoins")},{fix:"rg",x:0,clip:this.getControl("mcContentWarnig")},{fix:"rg",x:0,clip:this.getControl("mcGuiTxtDistance")},{fix:"rg",x:0,clip:this.getControl("mcGuiBtnCheats")},
{fix:"rg",x:0,clip:this.getControl("mcGuiTxtCoins")}];for(var a=0;a<this.m_fixControls.length;a++)this.m_fixControls[a].x=this.m_fixControls[a].clip.canvas.position.x};HudGame.prototype.fixGameScale=function(){for(var a=0;a<this.m_fixControls.length;a++){var b=this.m_fixControls[a].x;Application.WIDE_SCREEN&&(b="lf"===this.m_fixControls[a].fix?b-Layout.left/Layout.scale:b+Layout.left/Layout.scale);this.m_fixControls[a].clip.canvas.position.x=b}};
HudGame.prototype.onUIPress=function(a){switch(a.name){case "mcGuiBtnCheats":GuiGame.instance.addPopup(GuiPopupCheats,"mcGuiPopupsCheats");break;case "mcGuiBtnPause":GuiGame.instance.addPopup(GuiPopupPause,"mcGuiPopupsPause")}};
HudGame.prototype.update=function(a){SScreen.prototype.update.call(this,a);this.m_validateTutorialPower&&(this.m_timeTutorial+=a,1500<=this.m_timeTutorial&&(this.m_validateTutorialPower=!1,ScrollGame.instance&&ScrollGame.instance.intro.createTutorial(GuiPopupTutorial.ID_TUTORIAL_GRAB)));this.m_animitionBarBoss&&(this.m_oldWidthBoss-=HudGame.PROGRESS_ANIBAR_SPEED*a/10,this.m_oldWidthBoss<=this.m_widthBoss&&(this.m_oldWidthBoss=this.m_widthBoss,this.m_animitionBarBoss=!1),this.getControl("mcGuiHudBossBar").clip.getInstance("bar2").width=
this.m_oldWidthBoss);for(var b=0;b<this.m_progress.length;b++)null!==this.m_progress[b]&&this.m_progress[b].update(a);null!==this.m_combo&&(this.m_combo.isAwaitingDelete?(this.getControl("mcContentCombo").canvas.removeChild(this.m_combo.canvas),this.m_combo.free(),this.m_combo=null):(this.m_combo.update(a),this.m_activeCombo&&(this.m_currentTimeCombo+=a,this.m_currentTimeCombo>this.m_totalTimeCombo&&this.destroyCombo())));0<this.timeLifeStylishBar&&(this.timeLifeStylishBar-=a,0>=this.timeLifeStylishBar&&
this.applyStylish());if(0!==this.m_clipsWarning.length)for(b=0;b<this.m_clipsWarning.length;b++)null!==this.m_clipsWarning[b]&&this.m_clipsWarning[b].update(a)};HudGame.prototype.free=function(){this.m_clipsWarning=[];this.fxFullBar&&(this.fxFullBar.isAwaitingDelete=!0,this.fxFullBar=null);SScreen.prototype.free.call(this)};function GuiCombo(a,b){this.value=b;this.isAwaitingDelete=!1;SScreen.call(this,a,0,0,null);this.name="combo";this.loadData()}Application.subclass(GuiCombo,SScreen);
GuiCombo.prototype.loadData=function(){this.getControl("mcGuiTextCombo").setTextReplace("STR_REP_HUD_COINS_DATA",["#"],[this.value]);this.getControl("mcGuiTextCombo_s").setTextReplace("STR_REP_HUD_COINS_DATA",["#"],[this.value])};
GuiCombo.prototype.refreshData=function(a){this.value=a;this.getControl("mcGuiTextCombo").setTextReplace("STR_REP_HUD_COINS_DATA",["#"],[this.value]);this.getControl("mcGuiTextCombo_s").setTextReplace("STR_REP_HUD_COINS_DATA",["#"],[this.value]);Application.instance.effectManager.createEffect("fxCounter",0,0,this.getControl("mcContentFX").canvas)};GuiCombo.prototype.onStopScreen=function(){SScreen.prototype.onStopScreen.call(this);Application.instance.effectManager.createEffect("fxCounter",0,0,this.getControl("mcContentFX").canvas)};
GuiCombo.prototype.onFinishScreen=function(){this.isAwaitingDelete=!0};function GuiProgress(a,b,c){this.hud=c;this.data=b;this.activeProgress=this.viewProgress=this.isAwaitingDelete=!1;this.m_time=0;SScreen.call(this,a,0,0,null);this.name="progress";this.loadData()}Application.subclass(GuiProgress,SScreen);
GuiProgress.prototype.loadData=function(){var a="coins_total"===this.data.type?"coins":this.data.type;this.getControl("mcGuiIcon").setClip("gui_missions_icons_"+a);this.getControl("mcGuiIcon").clip.gotoAndStop(2);this.getControl("mcGuiTextMission").setTextReplace("STR_REP_NAME_MISSION_"+this.data.idSaveData,["#"],[this.data.objective])};GuiProgress.prototype.onStopScreen=function(){SScreen.prototype.onStopScreen.call(this);this.activeProgress=!0};
GuiProgress.prototype.onFinishScreen=function(){SScreen.prototype.onFinishScreen.call(this);this.isAwaitingDelete=!0;this.hud.destroyProgress()};GuiProgress.prototype.update=function(a){this.activeProgress&&(this.m_time+=a,2E3<=this.m_time&&(this.m_time=0,this.activeProgress=!1,this.onResumeScreen()));SScreen.prototype.update.call(this,a)};
function ScrollLayer(a,b){this.canvas=a;this.world=b;this.scrollSpeed=this.offsetY=this.offsetX=this.yOld=this.xOld=this.y=this.x=0;this.parallaxFactorY=this.parallaxFactorX=1;this.width=this.index=0;this.name=this.type=this.prefix=""}ScrollLayer.TYPE_CLIP="clip";ScrollLayer.TYPE_CONTENT="content";ScrollLayer.prototype.init=function(){};
ScrollLayer.prototype.update=function(a){this.xOld=this.x;this.yOld=this.y;this.x=this.parallaxFactorX*-this.world.camera.x;this.y=this.parallaxFactorY*-this.world.camera.y;this.canvas.position.x+=this.scrollSpeed*a;this.canvas.position.x=this.x;this.canvas.position.y=this.y};ScrollLayer.prototype.free=function(){this.world=this.canvas=null};
function ScrollClipLayer(a,b){ScrollLayer.call(this,a,b);this.clips=[];this.clipsNames=[];this.separation=0;this.randomizeClips=!1;this.limitX2=this.limitX1=0;this.updateClips=!1}Application.subclass(ScrollClipLayer,ScrollLayer);ScrollClipLayer.FIX_ADD_SCALE=.08;ScrollClipLayer.prototype.init=function(){var a=Math.ceil(this.width/this.separation);a+=2;for(var b=0;b<a;b++)this.clips.push(this.createClip(b));this.limitX1=1.5*this.separation;this.limitX2=this.width-this.separation};
ScrollClipLayer.prototype.createClip=function(a,b){"undefined"===typeof b&&(b=this.clips.length%this.clipsNames.length);b>=this.clipsNames.length?b=0:0>b&&(b=this.clipsNames.length-1);this.randomizeClips&&(b=Common.randomInt(0,this.clipsNames.length-1));var c=Common.trim(this.clipsNames[b]);c=0===c.length?Application.KEY_EMPTY_SPRITE:this.prefix+c;c=Application.instance.getClip(c);c._index_=a;c._index_name_=b;c.scale.x+=ScrollClipLayer.FIX_ADD_SCALE;c.position.x=this.offsetX+a*this.separation;c.position.y=
this.offsetY;this.canvas.addChild(c);return c};ScrollClipLayer.prototype.setClipNames=function(a){a.length!==this.clipsNames.length&&Application.warn("ScrollClipLayer > setClipNames :: new clips names length is different old clip names, reset index creation");this.clipsNames=a};
ScrollClipLayer.prototype.forceChangePrefix=function(a){for(var b,c,d,e,f,g=0;g<this.clips.length;g++)b=this.clips[g].position.x,c=this.clips[g].position.y,e=this.clips[g].name.split(this.prefix),d=1<e.length?e[1]:e[0],e=this.clips[g]._index_,f=this.clips[g]._index_name_,this.clips[g].free(),d=d===Application.KEY_EMPTY_SPRITE?d:a+d,d=Application.instance.getClip(d),d.scale.x+=ScrollClipLayer.FIX_ADD_SCALE,d.position.x=b,d.position.y=c,d._index_=e,d._index_name_=f,this.canvas.addChild(d),this.clips[g]=
d;this.prefix=a};ScrollClipLayer.prototype.update=function(a){ScrollLayer.prototype.update.call(this,a);~~(this.x/this.separation)!==~~(this.xOld/this.separation)&&-this.canvas.position.x-this.clips[0].position.x>=this.limitX1&&(this.clips.push(this.createClip(this.clips[this.clips.length-1]._index_+1,this.clips[this.clips.length-1]._index_name_+1)),this.clips[0].free(),this.clips.shift());if(this.updateClips&&!Application.isLowDevice)for(var b=0;b<this.clips.length;b++)this.clips[b].update&&this.clips[b].update(a)};
ScrollClipLayer.prototype.free=function(){for(var a=0;a<this.clips.length;a++)this.canvas.removeChild(this.clips[a]),this.clips[a].free(),this.clips[a]=null;this.clips=null;ScrollLayer.prototype.free.call(this)};function ScrollCamera(a,b,c){this.world=a;this.y=this.x=0;this.width=b;this.height=c;this.updateableObject=null;this.leftLimit=0;this.rightLimit=this.width;this.upLimit=0;this.downLimit=this.height;this.rLmit=0}ScrollCamera.R_LIMIT_BASE=.2;
ScrollCamera.prototype.updateLimits=function(a,b,c,d){this.leftLimit=Math.floor(a*this.width);this.setRightLimit(b);this.upLimit=Math.floor(c*this.height);this.downLimit=Math.floor(d*this.height)};ScrollCamera.prototype.setRightLimit=function(a){this.rLmit=a;this.rightLimit=Math.floor(a*this.width)};
ScrollCamera.prototype.update=function(a){this.rLmit>=ScrollCamera.R_LIMIT_BASE&&(this.rLmit-=2E-4*a,this.setRightLimit(this.rLmit));this.updateableObject&&(this.x+this.leftLimit>this.updateableObject.getX()&&(this.x=this.updateableObject.getX()-this.leftLimit),this.x+this.rightLimit<this.updateableObject.getX()&&(this.x=this.updateableObject.getX()-this.rightLimit));this.x>this.world.width-this.width&&(this.x=this.world.width-this.width);0>this.x&&(this.x=0);this.y>this.world.height-this.height&&
(this.y=this.world.height-this.height);0>this.y&&(this.y=0)};ScrollCamera.prototype.free=function(){this.updateableObject=this.world=null};function ScrollWorld(a,b){this.game=a;this.canvas=b;this.layers=[];this.layersIndexesNames={};this.prefix="";this.height=this.width=0;this.camera=null}ScrollWorld.prototype.scaleWorld=function(){};ScrollWorld.prototype.init=function(a,b,c,d,e,f){this.prefix=b;this.width=c;this.height=d;this.camera=new ScrollCamera(this,e,f);for(b=0;b<a.length;b++)this.addLayer(a[b])};
ScrollWorld.LAYER_EFFECTS_NAME="effects";
ScrollWorld.prototype.addLayer=function(a){var b=Application.instance.addDisplayContainer();this.canvas.addChild(b);var c=null;switch(a.type){case ScrollLayer.TYPE_CLIP:c=new ScrollClipLayer(b,this);c.clipsNames=a.clipNames;c.separation=a.separation;c.randomizeClips=a.randomizeClips;break;case ScrollLayer.TYPE_CONTENT:c=new ScrollLayer(b,this);break;default:Application.error("ScrollWorld >> addLayer :: type layer ["+a.type+"] no set")}c.type=a.type;c.name=a.name;c.index=this.layers.length;c.parallaxFactorX=
a.parallaxFactorX[this.game.upgradeSpeedLevel];c.parallaxFactorY=a.parallaxFactorY;c.offsetX=a.ox||0;c.offsetY=a.oy||0;c.prefix=this.prefix;"wallgas"===c.name&&(c.prefix="",c.updateClips=!0);c.width=1900;c.init();this.layers.push(c);this.layersIndexesNames[a.name]=c};ScrollWorld.prototype.getLayer=function(a){return this.layersIndexesNames[a]};ScrollWorld.prototype.xOutCamera=function(){return this.camera.x*this.getLayer("objects").parallaxFactorX+this.camera.width};
ScrollWorld.prototype.createEffect=function(a,b,c,d,e){return Application.instance.effectManager.createEffect(a,b,c,e||this.getLayer(ScrollWorld.LAYER_EFFECTS_NAME).canvas,d)};ScrollWorld.prototype.update=function(a){this.camera&&this.camera.update(a);for(var b=0;b<this.layers.length;b++)this.layers[b].update(a)};
ScrollWorld.prototype.changePrefix=function(a,b){for(var c=0;c<this.layers.length;c++)"wallgas"!==this.layers[c].name&&(b&&this.layers[c].type===ScrollLayer.TYPE_CLIP&&this.layers[c].forceChangePrefix(a),this.layers[c].prefix=a);this.prefix=a};ScrollWorld.prototype.free=function(){for(var a in this.layersIndexesNames)this.layersIndexesNames[a]=null;this.layersIndexesNames=null;for(a=0;a<this.layers.length;a++)this.layers[a].free(),this.layers[a]=null;this.layers=null};
function CircleMask(a,b){PIXI.Graphics.call(this);this.yRadius=this.xRadius=a;this.ratio=0;this.direction=b?1:-1;this.redraw()}Application.subclass(CircleMask,PIXI.Graphics);CircleMask.prototype.setRatio=function(a){this.ratio=a;1<this.ratio?this.ratio=1:0>this.ratio&&(this.ratio=0);this.redraw()};
CircleMask.prototype.redraw=function(){this.clear();this.beginFill(16711680,1);var a=2*Math.PI/12,b=Math.ceil(12*this.ratio);this.moveTo(0,0);for(var c=0;c<b;c++){var d=c*a;this.lineTo(this.direction*SMath.fastSin(d)*this.xRadius,-SMath.fastCos(d)*this.yRadius)}d=this.ratio*Math.PI*2;this.lineTo(this.direction*SMath.fastSin(d)*this.xRadius,-SMath.fastCos(d)*this.yRadius);this.endFill()};
function PowerBar(a,b,c){this.m_clipMask=this.m_hpClip=null;this.m_progress=this.m_valueStatic=this.m_dropping=this.m_timeToDrop=0;this.m_hpClip=a.clip[b];this.m_clipMask=new CircleMask(c,!1);this.m_hpClip.addChild(this.m_clipMask);this.m_hpClip.mask=this.m_clipMask;this.setRatio()}PowerBar.TIME_TO_DROP=100;PowerBar.DROP_SPEED=.5;PowerBar.prototype.free=function(){this.m_hpClip.removeChild(this.m_clipMask);this.m_hpClip=null};
PowerBar.prototype.setRatio=function(){this.m_clipMask.setRatio(this.m_progress+this.m_valueStatic+this.m_dropping)};PowerBar.prototype.update=function(a){0<this.m_timeToDrop&&(this.m_timeToDrop-=a,0>=this.m_timeToDrop&&(this.m_dropping+=this.m_valueStatic,this.m_valueStatic=0));0<this.m_dropping&&(this.m_dropping-=PowerBar.DROP_SPEED*a/1E3,0>this.m_dropping&&(this.m_dropping=0),this.setRatio())};
PowerBar.prototype.setPercent=function(a){var b=this.m_progress-a;this.m_progress=a;0<b?(this.m_timeToDrop=PowerBar.TIME_TO_DROP,this.m_valueStatic+=b):this.m_dropping=this.m_valueStatic=0;this.setRatio()};function XYMovement(){this.distanceAlive=this.timeAlive=this.time=this.ay=this.ax=this.vy=this.vx=this.oy=this.oldX=this.ox=this.y=this.x=0;this.timeFactor=1;this.isAwaitingDelete=!1}
XYMovement.prototype.set=function(a,b,c,d,e,f){this.x=a;this.y=b;this.ox=this.x;this.oy=this.y;this.oldX=this.x;this.ax=e||0;this.ay=f||0;this.vx=c*Math.cos(d);this.vy=c*Math.sin(d);this.timeAlive=this.distanceAlive=this.time=0;this.timeFactor=1};
XYMovement.prototype.update=function(a){this.oldX=this.x;this.x=this.ox+this.vx*this.time+5E-4*this.ax*this.time*this.time;this.y=this.oy+this.vy*this.time+5E-4*this.ay*this.time*this.time;this.time+=a*this.timeFactor;if(0!==this.distanceAlive){a=this.x-this.ox;var b=this.y-this.oy;Math.sqrt(a*a+b*b)>this.distanceAlive&&(this.isAwaitingDelete=!0)}0!==this.timeAlive&&this.time>this.timeAlive&&(this.isAwaitingDelete=!0)};XYMovement.prototype.free=function(){};
function MoveRandom(a,b,c,d){this.angleY=this.angleX=this.angle=this.y=this.x=0;this.centerX=a;this.centerY=b;this.yOld=this.xOld=this.velY=this.velX=this.range=0;this.maxRange=d||MoveRandom.RANGE_MAX;this.velX=c||(Math.random()<MoveRandom.SPEED_RANGE?-1:1)*(.01+Math.random()*MoveRandom.SPEED_MAX);this.velY=c||(Math.random()<MoveRandom.SPEED_RANGE?-1:1)*(.009+Math.random()*MoveRandom.SPEED_MAX)}MoveRandom.RANGE_MAX=100;MoveRandom.SPEED_MAX=.005;MoveRandom.SPEED_RANGE=.4;
MoveRandom.prototype.update=function(a){this.xOld=this.x;this.yOld=this.y;this.x=this.centerX+SMath.fastSin(this.angleX)*this.range;this.y=this.centerY+SMath.fastCos(this.angleY)*this.range;this.angleX+=this.velX;this.angleY+=this.velY;this.range+=1+Math.random();this.angle=180*Math.atan2(this.yOld-this.y,this.xOld-this.x)/Math.PI;this.range>this.maxRange&&(this.range=this.maxRange)};
function ScrollActor(a,b,c,d,e){SActor.call(this,a,c,d);this.world=b;this.m_config=e||null;this.isVehicle=this.isReal=this.bossBullet=this.isBoss=this.isItem=this.isHazard=this.isEnemy=this.isHit=!1;this.isCollided=!0;this.isPlayer=!1;this.m_oldDirection=this.m_direction=0;this.m_uniqueId=e?e.uniqueId:-1;this.m_skin=e?e.skin:"";this.layerName="objects"}Application.subclass(ScrollActor,SActor);ScrollActor.ST_ENEMY_APPEAR="appear";ScrollActor.ST_ENEMY_STAND="stand";ScrollActor.ST_ENEMY_DEFEAT="defeat";
ScrollActor.ST_ENEMY_ATTACK="attack";ScrollActor.ST_ENEMY_ALERT="alert";ScrollActor.prototype.free=function(){SActor.prototype.free.call(this)};ScrollActor.prototype.forceRemove=function(){this.m_isAwaitingDelete=!0;this.world.createEffect("mcClearObj",this.m_x,this.m_y,1,this.world.getLayer("objects").canvas)};ScrollActor.prototype.onKeyDown=function(a){};ScrollActor.prototype.onKeyUp=function(a){};ScrollActor.prototype.update=function(a){this.render(a)};
ScrollActor.prototype.clearFrameContainer=function(a){if(a=this.m_clip.getInstance(a))a.texture._frame.height=0,a.texture._frame.width=0};ScrollActor.prototype.addFXHint=function(){this.world.createEffect("fxEnemyHit",this.m_x,this.m_y,1,this.world.getLayer("objects").canvas)};ScrollActor.prototype.getXWorld=function(){var a=Math.abs(this.world.getLayer("objects").x-this.world.getLayer("player").x);return this.m_x+a};
ScrollActor.prototype.render=function(a){null!==this.m_character?this.m_character.update(a):null!==this.m_clip&&this.m_clip.update(a);this.m_canvas.position.x=this.m_x;this.m_canvas.position.y=this.m_y};ScrollActor.prototype.setDirection=function(a){return this.m_direction!==a?(this.m_oldDirection=this.m_direction,this.m_direction=a,!0):!1};ScrollActor.prototype.onIdle=function(a){SActor.prototype.onIdle.call(this,a)};
ScrollActor.prototype.isInCamera=function(a){a=a||0;var b=this.world.getLayer(this.layerName).parallaxFactorX,c=this.m_x<=this.world.camera.x*b+this.world.camera.width+a;return this.m_x>=this.world.camera.x*b-a&&c};function ScrollEnemy(a,b,c,d,e){ScrollActor.call(this,a,b,c,d,e);this.m_skin="enemy01";this.isEnemy=!0;this.initCharacter()}Application.subclass(ScrollEnemy,ScrollActor);
ScrollEnemy.prototype.initCharacter=function(){this.m_character=new Character(0,0,this.m_canvas);this.m_character.addState(ScrollActor.ST_ENEMY_APPEAR,this.m_skin+"_appear");this.m_character.addState(ScrollActor.ST_ENEMY_DEFEAT,this.m_skin+"_defeat");this.m_character.addState(ScrollActor.ST_ENEMY_STAND,this.m_skin+"_stand");this.m_character.onEndAnimation(this,this.onEndAnimation);this.gotoState(ScrollActor.ST_ENEMY_STAND)};
ScrollEnemy.prototype.onEndAnimation=function(a){switch(a){case ScrollActor.ST_ENEMY_DEFEAT:this.m_isAwaitingDelete=!0}};
ScrollEnemy.prototype.onCollisionActor=function(a,b){this.world.createEffect("fxEnemyHit",this.m_x,this.m_y,1,this.world.getLayer("objects").canvas);this.gotoState(ScrollActor.ST_ENEMY_DEFEAT);this.isHit=!0;this.world.game.player.onBounce();a=this.world.game.player.state()===ScrollPlayer.ST_ON_VEHICLE?"drone":"none";this.world.game.missions.onCount(MissionManager.TYPE_MISSION_ENEMY,a);this.world.game.achievements.onCount(Achievements.TYPE_ENEMY);this.world.game.hud().addCombo();a=Application.config.settings.percentage_enemy_hit[this.world.game.upgradeStylish];
this.world.game.hud().addPower(a);Application.instance.playSound("SND_ENEMIES_NORMAL_HIT");return!0};function ScrollBullet(a,b,c,d){this.damage=this.angle=this.distance=this.speed=0;this.m_move=null;this.m_impulseBulletY=this.m_impulseBulletX=this.timeAlive=this.gravity=0;this.bullet=a;a={skin:this.bullet,uniqueId:ScrollActorManager.ENEMY_BULLET};ScrollActor.call(this,b.getLayer("objects").canvas,b,c,d,a);this.m_x=c;this.m_y=d;this.setActorClip(this.bullet)}Application.subclass(ScrollBullet,ScrollActor);
ScrollBullet.prototype.motionSettings=function(a,b,c,d,e,f){this.speed=a;this.distance=b;this.angle=d;this.damage=c;this.gravity=e;this.timeAlive=1E3*f;this.addMovement()};ScrollBullet.prototype.addMovement=function(){this.m_move=new XYMovement;this.m_move.set(this.m_x,this.m_y,this.speed,this.angle,0,this.gravity);this.m_move.distanceAlive=this.distance;this.m_move.timeAlive=this.timeAlive;this.update(0)};
ScrollBullet.prototype.onCollisionActor=function(a,b){this.world.createEffect("fxPlayerHit",this.m_x,this.m_y,1,this.world.getLayer("objects").canvas);this.m_isAwaitingDelete=!0;a.onHit(0);return!0};ScrollBullet.prototype.update=function(a){null!==this.m_move&&(this.m_move.update(a),this.m_x=this.m_move.x,this.m_y=this.m_move.y,this.m_move.isAwaitingDelete&&(this.m_isAwaitingDelete=!0));ScrollActor.prototype.update.call(this,a)};
ScrollBullet.prototype.free=function(){null!==this.m_move&&(this.m_move.free(),this.m_move=null);ScrollActor.prototype.free.call(this)};function ScrollShooterEnemy(a,b,c,d,e){ScrollActor.call(this,a,b,c,d,e);this.m_skin="enemy02";this.m_timer=0;this.m_distanceShoot=window.config.enemys.bullet_distance_shoot;this.isEnemy=!0;this.initCharacter()}Application.subclass(ScrollShooterEnemy,ScrollActor);
ScrollShooterEnemy.prototype.createBullet=function(){var a=this.m_x-65,b=this.m_y+15;Application.instance.playSound("SND_ENEMIES_SHOOTING_SHOOT");ScrollGame.instance.actorManager.createBullet(a,b)};
ScrollShooterEnemy.prototype.initCharacter=function(){this.m_character=new Character(0,0,this.m_canvas);this.m_character.addState(ScrollActor.ST_ENEMY_APPEAR,this.m_skin+"_appear");this.m_character.addState(ScrollActor.ST_ENEMY_STAND,this.m_skin+"_stand");this.m_character.addState(ScrollActor.ST_ENEMY_ALERT,this.m_skin+"_charge");this.m_character.addState(ScrollActor.ST_ENEMY_ATTACK,this.m_skin+"_attack",[{caller:this,callback:this.createBullet,frame:6}]);this.m_character.addState(ScrollActor.ST_ENEMY_DEFEAT,
this.m_skin+"_defeat");this.m_character.onEndAnimation(this,this.onEndAnimation);this.gotoState(ScrollActor.ST_ENEMY_STAND)};ScrollShooterEnemy.prototype.onEndAnimation=function(a){switch(a){case ScrollActor.ST_ENEMY_ALERT:this.gotoState(ScrollActor.ST_ENEMY_ATTACK);break;case ScrollActor.ST_ENEMY_DEFEAT:this.m_isAwaitingDelete=!0;break;case ScrollActor.ST_ENEMY_ATTACK:this.gotoState(ScrollActor.ST_ENEMY_STAND)}};
ScrollShooterEnemy.prototype.onCollisionActor=function(a,b){this.world.createEffect("fxEnemyHit",this.m_x,this.m_y,1,this.world.getLayer("objects").canvas);this.gotoState(ScrollActor.ST_ENEMY_DEFEAT);this.isHit=!0;this.world.game.player.onBounce();a=this.world.game.player.state()===ScrollPlayer.ST_ON_VEHICLE?"drone":"none";this.world.game.missions.onCount(MissionManager.TYPE_MISSION_ENEMY,a);this.world.game.achievements.onCount(Achievements.TYPE_ENEMY);this.world.game.hud().addCombo();a=Application.config.settings.percentage_enemy_hit[this.world.game.upgradeStylish];
this.world.game.hud().addPower(a);Application.instance.playSound("SND_ENEMIES_NORMAL_HIT");return!0};ScrollShooterEnemy.prototype.updateStates=function(a){switch(this.m_state){case ScrollActor.ST_ENEMY_STAND:var b=this.getXWorld()-this.world.game.player.m_x;0<b&&b<=this.m_distanceShoot&&(this.m_timer-=a,0>=this.m_timer&&(this.m_timer=1E3,this.gotoState(ScrollActor.ST_ENEMY_ALERT)))}};ScrollShooterEnemy.prototype.update=function(a){ScrollActor.prototype.update.call(this,a);this.updateStates(a)};
function ScrollExplodingEnemy(a,b,c,d,e){this.m_timer=0;this.m_timeShoot=500*Common.randomInt(4,8);this.m_activeDisplace=!1;this.m_move=null;ScrollActor.call(this,a,b,c,d,e);this.m_skin="enemy03";this.isEnemy=!0;this.initCharacter()}Application.subclass(ScrollExplodingEnemy,ScrollActor);ScrollExplodingEnemy.prototype.createBullet=function(){ScrollGame.instance.actorManager.createBullet(this.m_x-65,this.m_y+15)};
ScrollExplodingEnemy.prototype.initCharacter=function(){this.m_character=new Character(0,0,this.m_canvas);this.m_character.addState(ScrollActor.ST_ENEMY_APPEAR,this.m_skin+"_appear");this.m_character.addState(ScrollActor.ST_ENEMY_STAND,this.m_skin+"_stand");this.m_character.addState(ScrollActor.ST_ENEMY_ALERT,this.m_skin+"_alert");this.m_character.addState(ScrollActor.ST_ENEMY_DEFEAT,this.m_skin+"_exploding");this.m_character.onEndAnimation(this,this.onEndAnimation);this.gotoState(ScrollActor.ST_ENEMY_STAND)};
ScrollExplodingEnemy.prototype.gotoState=function(a){ScrollActor.prototype.gotoState.call(this,a);a===ScrollActor.ST_ENEMY_DEFEAT&&this.world.createEffect("fxEnemy03Explode",this.m_x,this.m_y,1,this.world.getLayer("objects").canvas)};
ScrollExplodingEnemy.prototype.onEndAnimation=function(a){switch(a){case ScrollActor.ST_ENEMY_APPEAR:this.gotoState(ScrollActor.ST_ENEMY_STAND);break;case ScrollActor.ST_ENEMY_ALERT:Application.instance.playSound("SND_ENEMIES_EXPLO_EXPLODES");this.gotoState(ScrollActor.ST_ENEMY_DEFEAT);break;case ScrollActor.ST_ENEMY_DEFEAT:this.m_isAwaitingDelete=!0}};
ScrollExplodingEnemy.prototype.onCollisionActor=function(a,b){if(this.world.game.boss)return this.m_isAwaitingDelete=!0,this.world.game.actorManager.createExplodingToBoss(this.m_x+this.world.getLayer("objects").canvas.position.x,this.m_y),Application.instance.playSound("SND_ENEMIES_EXPLO_HIT"),!0;if(a.actorId===ScrollActorManager.ID_ENEMY){if(!a.isCollided)return!1;a.addFXHint();switch(a.uniqueId()){case ScrollActorManager.ENEMY_EXPLODING:Application.instance.playSound("SND_ENEMIES_EXPLO_EXPLODES");
a.isHit=!0;this.isCollided=a.isCollided=!1;this.gotoState(ScrollActor.ST_ENEMY_DEFEAT);a.gotoState(ScrollActor.ST_ENEMY_DEFEAT);this.world.game.hud().addCombo();a=this.world.game.player.state()===ScrollPlayer.ST_ON_VEHICLE?"drone":"none";this.world.game.missions.onCount(MissionManager.TYPE_MISSION_ENEMY,a);this.world.game.achievements.onCount(Achievements.TYPE_ENEMY);break;case ScrollActorManager.ENEMY_HAZARD_1:Application.instance.playSound("SND_ENEMIES_EXPLO_EXPLODES");this.isCollided=a.isCollided=
!1;this.gotoState(ScrollActor.ST_ENEMY_DEFEAT);a.gotoState(ScrollActor.ST_ENEMY_DEFEAT);break;case ScrollActorManager.ENEMY_TYPE_NORMAL:case ScrollActorManager.ENEMY_TYPE_SHOOTING:a.isHit=!0;this.isCollided=a.isCollided=!1;this.gotoState(ScrollActor.ST_ENEMY_DEFEAT);a.gotoState(ScrollActor.ST_ENEMY_DEFEAT);Application.instance.playSound("SND_ENEMIES_EXPLO_EXPLODES");this.world.game.hud().addCombo();a=this.world.game.player.state()===ScrollPlayer.ST_ON_VEHICLE?"drone":"none";this.world.game.missions.onCount(MissionManager.TYPE_MISSION_ENEMY,
a);this.world.game.achievements.onCount(Achievements.TYPE_ENEMY);break;case ScrollActorManager.ENEMY_BULLET:a.isCollided=!1,a.m_isAwaitingDelete=!0}return!0}if(this.m_state===ScrollActor.ST_ENEMY_DEFEAT){if(!this.isCollided)return!1;this.world.createEffect("fxPlayerHit",this.m_x,this.m_y,1,this.world.getLayer("objects").canvas);a.onHit(0)}else if(!this.m_activeDisplace){Application.instance.playSound("SND_ENEMIES_EXPLO_HIT");this.isHit=!0;this.world.createEffect("fxEnemyHit",this.m_x,this.m_y,1,this.world.getLayer("objects").canvas);
this.world.game.player.onBounce();a=this.world.game.player.state()===ScrollPlayer.ST_ON_VEHICLE?"drone":"none";this.world.game.missions.onCount(MissionManager.TYPE_MISSION_ENEMY,a);this.world.game.achievements.onCount(Achievements.TYPE_ENEMY);this.m_activeDisplace=!0;a=window.config.enemys.skull_speed;b=.2*this.world.game.player.move.getTangentInv();var c=window.config.enemys.skull_distance+200*this.world.game.player.move.instantVelocity.x;this.m_move=new XYMovement;this.m_move.set(this.m_x,this.m_y,
a,b,-1.5,0);this.m_move.distanceAlive=c;this.world.game.hud().addCombo();a=Application.config.settings.percentage_enemy_hit[this.world.game.upgradeStylish];this.world.game.hud().addPower(a)}return!0};
ScrollExplodingEnemy.prototype.updateStates=function(a){(this.m_state!==ScrollActor.ST_ENEMY_DEFEAT||this.isCollided)&&this.m_activeDisplace&&null!==this.m_move&&(this.m_move.update(a),this.m_x=this.m_move.x,this.m_y=this.m_move.y,this.m_move.x<this.m_move.oldX&&(this.m_move.isAwaitingDelete=!0),this.m_move.isAwaitingDelete&&(this.m_activeDisplace=!1,this.gotoState(ScrollActor.ST_ENEMY_ALERT)))};ScrollExplodingEnemy.prototype.update=function(a){ScrollActor.prototype.update.call(this,a);this.updateStates(a)};
function ScrollExplodingEnemyToBoss(a,b,c,d,e){ScrollActor.call(this,a,b,c,d,e);this.bossBullet=!0;this.m_skin="enemy03";this.initCharacter();this.bossX=this.world.game.boss.getX();this.bossY=this.world.game.boss.getY()-80;a=Math.atan2(this.bossY-this.m_y,this.bossX-this.m_x);this.movexy=new XYMovement;this.movexy.set(this.m_x,this.m_y,1.2,a)}Application.subclass(ScrollExplodingEnemyToBoss,ScrollActor);
ScrollExplodingEnemyToBoss.prototype.initCharacter=function(){this.m_character=new Character(0,0,this.m_canvas);this.m_character.addState(ScrollActor.ST_ENEMY_APPEAR,this.m_skin+"_appear");this.m_character.addState(ScrollActor.ST_ENEMY_STAND,this.m_skin+"_stand");this.m_character.addState(ScrollActor.ST_ENEMY_ALERT,this.m_skin+"_alert");this.m_character.addState(ScrollActor.ST_ENEMY_DEFEAT,this.m_skin+"_exploding");this.m_character.onEndAnimation(this,this.onEndAnimation);this.gotoState(ScrollActor.ST_ENEMY_STAND)};
ScrollExplodingEnemyToBoss.prototype.update=function(a){ScrollActor.prototype.update.call(this,a);switch(this.m_state){case ScrollActor.ST_ENEMY_STAND:if(this.movexy&&(this.movexy.update(a),this.m_x=this.movexy.x,this.m_y=this.movexy.y),this.m_x>this.bossX-20&&this.m_x<this.bossX+15&&this.m_y>this.bossY-20&&this.m_y<this.bossY+20&&(Application.instance.playSound("SND_ENEMIES_EXPLO_EXPLODES"),this.world.createEffect("fxEnemy03Explode",this.m_x,this.m_y,1,this.world.getLayer("static_front").canvas),
this.m_isAwaitingDelete=!0,this.world.game.boss))this.world.game.boss.onHit()}};function ScrollRing(a,b,c,d,e,f){this.m_canvasFrom=b;this.m_clipFrom=null;ScrollActor.call(this,a,c,d,e,f);this.m_skin="mcRing";this.isItem=!1;this.initCharacter();this.isUsed=!1;this.fx=this.world.createEffect("fxRingBoost",0,0,1,this.m_canvas)}Application.subclass(ScrollRing,ScrollActor);ScrollRing.ST_APPEAR="appear";ScrollRing.ST_STAND="stand";ScrollRing.ST_CONTACT="contact";
ScrollRing.prototype.setFromClip=function(){this.m_clipFrom=Application.instance.getClip("mcRing_from");this.m_clipFrom.position.x=this.m_x;this.m_clipFrom.position.y=this.m_y;this.m_canvasFrom.addChild(this.m_clipFrom)};ScrollRing.prototype.destroyFrom=function(){null!==this.m_clipFrom&&this.m_canvasFrom.removeChild(this.m_clipFrom);this.m_clipFrom=null};
ScrollRing.prototype.initCharacter=function(){this.m_character=new Character(0,0,this.m_canvas);this.m_character.addState(ScrollRing.ST_APPEAR,this.m_skin+"_appear");this.m_character.addState(ScrollRing.ST_STAND,this.m_skin+"_stand");this.m_character.addState(ScrollRing.ST_CONTACT,this.m_skin+"_back");this.m_character.onEndAnimation(this,this.onEndAnimation);this.gotoState(ScrollRing.ST_APPEAR)};ScrollRing.prototype.onEndAnimation=function(a){switch(a){case ScrollRing.ST_APPEAR:this.gotoState(ScrollRing.ST_STAND)}};
ScrollRing.prototype.onCollisionActor=function(a,b){this.isUsed||(this.world.createEffect("fxRing",this.m_x,this.m_y,1,this.world.getLayer("objects_front").canvas),this.setFromClip(),this.world.game.player.onDash(),this.gotoState(ScrollRing.ST_CONTACT),this.isUsed=!0,Application.instance.playSound("SND_POWERUPS_RINGBOOST"),this.world.game.missions.onCount(MissionManager.TYPE_MISSION_RING),a=Application.config.settings.percentage_ring[this.world.game.upgradeStylish],this.world.game.hud().addPower(a),
this.world.game.hud().addCombo());return!0};ScrollRing.prototype.update=function(a){ScrollActor.prototype.update.call(this,a)};ScrollRing.prototype.free=function(){this.destroyFrom();this.fx&&(this.fx.isAwaitingDelete=!0,this.fx=null);ScrollActor.prototype.free.call(this)};function ScrollSensor(a,b,c,d,e){this.m_activeRocket=!1;ScrollActor.call(this,a,b,c+window.config.enemys.rocket_offSetX,d,e);this.m_skin="mcRocketSensor";this.isItem=!0;this.initCharacter()}Application.subclass(ScrollSensor,ScrollActor);
ScrollSensor.ST_STAND="stand";ScrollSensor.prototype.initCharacter=function(){this.m_character=new Character(0,0,this.m_canvas);this.m_character.addState(ScrollSensor.ST_STAND,this.m_skin);this.m_character.onEndAnimation(this,this.onEndAnimation);this.gotoState(ScrollSensor.ST_STAND)};ScrollSensor.prototype.onEndAnimation=function(a){};
ScrollSensor.prototype.createRocket=function(){var a=this.m_x+window.config.enemys.rocket_distance,b=this.m_y;this.world.game.hud().createWarning(b-this.world.camera.y);this.world.game.actorManager.createActor(a,b,{id:ScrollActorManager.ID_ENEMY,uniqueId:ScrollActorManager.ENEMY_ROCKET});Application.instance.playSound("SND_HAZARDS_ALERT")};ScrollSensor.prototype.onCollisionActor=function(a,b){return!1};
ScrollSensor.prototype.update=function(a){ScrollActor.prototype.update.call(this,a);!this.m_activeRocket&&this.getXWorld()<this.world.game.player.m_x&&(this.createRocket(),this.m_isAwaitingDelete=this.m_activeRocket=!0)};function ScrollItem(a,b,c,d,e){ScrollActor.call(this,a,b,c,d,e);this.isItem=!0}Application.subclass(ScrollItem,ScrollActor);ScrollItem.prototype.update=function(a){ScrollActor.prototype.update.call(this,a)};
function ScrollCoin(a,b,c,d,e){ScrollActor.call(this,a,b,c,d,e);this.m_skin="mc_spiderCoin";this.isItem=!0;this.initCharacter();this.followPlayer=!1;this.speedFollow=.2;this.a=this.ady=this.adx=this.dy=this.dx=0}Application.subclass(ScrollCoin,ScrollActor);ScrollCoin.ST_APPEAR="appear";ScrollCoin.ST_STAND="stand";ScrollCoin.ST_DEFEAT="defeat";
ScrollCoin.prototype.initCharacter=function(){this.m_character=new Character(0,0,this.m_canvas);this.m_character.addState(ScrollCoin.ST_APPEAR,this.m_skin+"_appear");this.m_character.addState(ScrollCoin.ST_STAND,this.m_skin+"_stand");this.m_character.addState(ScrollCoin.ST_DEFEAT,this.m_skin+"_defeat");this.m_character.onEndAnimation(this,this.onEndAnimation);this.gotoState(ScrollCoin.ST_APPEAR)};
ScrollCoin.prototype.onEndAnimation=function(a){switch(a){case ScrollCoin.ST_APPEAR:this.gotoState(ScrollCoin.ST_STAND);break;case ScrollCoin.ST_DEFEAT:this.m_isAwaitingDelete=!0}};ScrollCoin.prototype.onCollisionActor=function(a,b){this.collect();return!0};
ScrollCoin.prototype.collect=function(){this.world.createEffect("fxPickCoin",this.m_x,this.m_y,1,this.world.getLayer("objects").canvas);this.gotoState(ScrollCoin.ST_DEFEAT);Application.instance.playSound("SND_POWERUPS_SPIDEYCOINS");this.world.game.addCoins(1);this.world.game.missions.onCount(MissionManager.TYPE_MISSION_COINS);this.world.game.missions.onCount(MissionManager.TYPE_MISSION_COINS_TOTAL)};
ScrollCoin.prototype.update=function(a){ScrollActor.prototype.update.call(this,a);if(this.m_state!==ScrollCoin.ST_DEFEAT){var b=this.world.game.player.m_y-0;this.dx=this.world.game.player.m_x-this.getXWorld();this.dy=b-this.m_y;this.adx=0>this.dx?-this.dx:this.dx;this.ady=0>this.dy?-this.dy:this.dy;b=0<this.world.game.player.coinMagnetTimeDuration?400:70;this.adx<b&&this.ady<b&&(this.followPlayer=!0);this.followPlayer&&(this.speedFollow+=.005*a,this.a=Math.atan2(this.dy,this.dx),this.m_x+=this.speedFollow*
a*Math.cos(this.a),this.m_y+=this.speedFollow*a*Math.sin(this.a),30>this.adx&&30>this.ady&&this.collect())}};function ScrollMagnet(a,b,c,d,e){ScrollActor.call(this,a,b,c,d,e);this.m_skin="mc_magnet";this.isItem=!0;this.initCharacter();this.move=new MoveRandom(this.m_x,this.m_y)}Application.subclass(ScrollMagnet,ScrollActor);ScrollMagnet.ST_STAND="stand";
ScrollMagnet.prototype.initCharacter=function(){this.m_character=new Character(0,0,this.m_canvas);this.m_character.addState(ScrollMagnet.ST_STAND,this.m_skin);this.gotoState(ScrollMagnet.ST_STAND)};ScrollMagnet.prototype.onCollisionActor=function(a,b){this.m_isAwaitingDelete=!0;this.world.game.player.onCoinMagnet();Application.instance.playSound("SND_POWERUPS_MAGNET");return!0};
ScrollMagnet.prototype.update=function(a){ScrollActor.prototype.update.call(this,a);this.move&&(this.move.update(a),this.move.centerX+=.2*a,this.m_x=this.move.x,this.m_y=this.move.y)};function ScrollRocket(a,b,c,d,e){this.m_activeDisplace=!1;this.m_move=null;ScrollActor.call(this,a,b,c,d,e);this.m_skin="mcRocket";this.isItem=!0;this.initCharacter();this.fx=this.world.createEffect("fxRocketSmoke",90,0,1,this.m_canvas);this.changeRotateEffect=50}Application.subclass(ScrollRocket,ScrollActor);
ScrollRocket.ST_APPEAR="appear";ScrollRocket.ST_STAND="stand";ScrollRocket.ST_DEFEAT="defeat";ScrollRocket.prototype.initCharacter=function(){this.m_character=new Character(0,0,this.m_canvas);this.m_character.addState(ScrollRocket.ST_APPEAR,this.m_skin);this.m_character.addState(ScrollRocket.ST_STAND,this.m_skin);this.m_character.addState(ScrollRocket.ST_DEFEAT,this.m_skin);this.m_character.onEndAnimation(this,this.onEndAnimation);this.gotoState(ScrollRocket.ST_STAND)};
ScrollRocket.prototype.onEndAnimation=function(a){switch(a){case ScrollRocket.ST_APPEAR:this.gotoState(ScrollRocket.ST_STAND);break;case ScrollRocket.ST_DEFEAT:this.m_isAwaitingDelete=!0}};
ScrollRocket.prototype.onCollisionActor=function(a,b){this.world.createEffect("fxPlayerHit",this.m_x,this.m_y,1,this.world.getLayer("objects").canvas);this.world.createEffect("fxRocketExplode",this.m_x,this.m_y,1,this.world.getLayer("objects").canvas);this.m_isAwaitingDelete=!0;Application.instance.playSound("SND_HAZARDS_GASROCKETS");a.onHit(0);return!0};
ScrollRocket.prototype.addDisplace=function(){this.m_activeDisplace=!0;this.world.game.hud().destroyWarning();var a=window.config.enemys.rocket_speed;this.m_move=new XYMovement;this.m_move.set(this.m_x,this.m_y,a,Math.PI,0,0);this.m_move.distanceAlive=0;this.m_move.timeAlive=0;this.update(0)};ScrollRocket.prototype.forceRemove=function(){ScrollActor.prototype.forceRemove.call(this);this.m_activeDisplace||this.world.game.hud().destroyWarning()};
ScrollRocket.prototype.update=function(a){ScrollActor.prototype.update.call(this,a);this.m_activeDisplace?null!==this.m_move&&(this.m_move.update(a),this.m_x=this.m_move.x,this.m_y=this.m_move.y):this.isInCamera()&&this.addDisplace();this.changeRotateEffect-=a;0>this.changeRotateEffect&&(this.changeRotateEffect=Common.randomInt(50,100))};ScrollRocket.prototype.free=function(){null!==this.m_move&&(this.m_move.free(),this.m_move=null);this.fx&&(this.fx.isAwaitingDelete=!0,this.fx=null);ScrollActor.prototype.free.call(this)};
function ScrollHazard(a,b,c,d,e){ScrollActor.call(this,a,b,c,d,e);this.m_skin="mcHazard";this.isHazard=this.isEnemy=!0;this.initCharacter();this.fx=this.world.createEffect("fxBombSmoke",0,0,1,this.m_canvas)}Application.subclass(ScrollHazard,ScrollActor);ScrollHazard.prototype.free=function(){this.fx&&(this.fx.isAwaitingDelete=!0,this.fx=null);ScrollActor.prototype.free.call(this)};
ScrollHazard.prototype.initCharacter=function(){this.m_character=new Character(0,0,this.m_canvas);this.m_character.addState(ScrollActor.ST_ENEMY_APPEAR,this.m_skin+"_appear");this.m_character.addState(ScrollActor.ST_ENEMY_STAND,this.m_skin+"_stand");this.m_character.addState(ScrollActor.ST_ENEMY_DEFEAT,this.m_skin+"_defeat");this.m_character.onEndAnimation(this,this.onEndAnimation);this.gotoState(ScrollActor.ST_ENEMY_APPEAR)};
ScrollHazard.prototype.onEndAnimation=function(a){switch(a){case ScrollActor.ST_ENEMY_APPEAR:this.gotoState(ScrollActor.ST_ENEMY_STAND);break;case ScrollActor.ST_ENEMY_DEFEAT:this.m_isAwaitingDelete=!0}};ScrollHazard.prototype.onCollisionActor=function(a,b){this.world.createEffect("fxBombExplode",this.m_x,this.m_y,1,this.world.getLayer("objects").canvas);this.gotoState(ScrollActor.ST_ENEMY_DEFEAT);Application.instance.playSound("SND_HAZARDS_GASBOMBS");a.onHit(0);return!0};
ScrollHazard.prototype.update=function(a){ScrollActor.prototype.update.call(this,a)};function ScrollPivot(a,b,c,d,e){ScrollActor.call(this,a,b,c,d,e);this.m_dx=0;this.isPivot=!0;this.m_character=new Character(0,0,this.m_canvas);this.m_character.addState(ScrollPivot.ST_STAND,"pivot_"+Common.randomInt(1,4));this.gotoState(ScrollPivot.ST_STAND);this.m_clip.scale.x=2;this.m_clip.scale.y=2}Application.subclass(ScrollPivot,ScrollActor);ScrollPivot.ST_STAND="stand";ScrollPivot.pivotInRange=null;
ScrollPivot.prototype.update=function(a){ScrollActor.prototype.update.call(this,a);this.m_dx=this.m_x-this.world.game.player.m_x;350<this.m_dx&&800>this.m_dx&&(ScrollPivot.pivotInRange=this)};
function ScrollPlayer(a,b,c,d,e){ScrollActor.call(this,a,b,c,d,e);this.isPlayer=!0;this.initCharacter();this.m_speedModule=.75;this.keyboard=new SKeyboard(this);this.keyboard.bind(Common.KEY_RIGHT,this.onPressKeyMove,this.onReleaseKeyMove);this.keyboard.bind(Common.KEY_DOWN,this.onPressKeyMove,this.onReleaseKeyMove);this.keyboard.bind(Common.KEY_LEFT,this.onPressKeyMove,this.onReleaseKeyMove);this.keyboard.bind(Common.KEY_UP,this.onPressKeyMove,this.onReleaseKeyMove);this.mapKeyMove=new MapKeyMove(Common.KEY_RIGHT,
Common.KEY_DOWN,Common.KEY_LEFT,Common.KEY_UP)}Application.subclass(ScrollPlayer,ScrollActor);ScrollPlayer.LIMIT_TOP=216;ScrollPlayer.LIMIT_BOTTOM=784;ScrollPlayer.ST_APPEAR="appear";ScrollPlayer.ST_APPEAR_LOOP="appear_loop";ScrollPlayer.ST_SWING_IN="swing_in";ScrollPlayer.ST_SWING="swing";ScrollPlayer.ST_SWING_OUT="swing_out";ScrollPlayer.ST_STAND="stand";ScrollPlayer.ST_FALL="fall";ScrollPlayer.ST_HIT="hit";ScrollPlayer.ST_ATTACK="attack";ScrollPlayer.ST_WIN="win";ScrollPlayer.ST_DEFEAT="defeat";
ScrollPlayer.ST_BOUNCE="bounce";ScrollPlayer.ST_DASH="dash";ScrollPlayer.ST_DASH_OUT="dash_out";ScrollPlayer.ST_ON_VEHICLE="vehicle";ScrollPlayer.ST_VEHICLE_OUT="vehicle_out";ScrollPlayer.ST_WAIT_OUT_SCREEN="wait_out";ScrollPlayer.ST_BOUNCE_RECOVERY="bounce_recovery";ScrollPlayer.ST_STYLISH="stylish";ScrollPlayer.ST_HIDE="hide";ScrollPlayer.prototype.onAppLostFocus=function(){this.resetInputs()};
ScrollPlayer.prototype.resetInputs=function(){this.keyboard&&this.keyboard.reset();this.mapKeyMove&&this.mapKeyMove.reset();this.setSpeed(0,0);this.onChangeMapKey()};ScrollPlayer.prototype.onKeyDown=function(a){this.keyboard.onKeyPress(a)};ScrollPlayer.prototype.onKeyUp=function(a){this.keyboard.onKeyRelease(a)};ScrollPlayer.prototype.onPressKeyMove=function(a){this.mapKeyMove.onPress(a);this.onChangeMapKey()};ScrollPlayer.prototype.onReleaseKeyMove=function(a){this.mapKeyMove.onRelease(a);this.onChangeMapKey()};
ScrollPlayer.prototype.onChangeMapKey=function(){};ScrollPlayer.prototype.onStand=function(){this.canChangeState()&&this.m_state!==ScrollPlayer.ST_STAND&&(this.m_speed.x=0,this.m_speed.y=0,this.gotoState(ScrollPlayer.ST_STAND))};ScrollPlayer.prototype.onWalk=function(){this.canChangeState()&&(this.m_speed.x=this.m_speedModule*Math.cos(Dir.getAngleByDirection(this.m_direction,!0)),this.m_speed.y=this.m_speedModule*Math.sin(Dir.getAngleByDirection(this.m_direction,!0)))};
ScrollPlayer.prototype.canChangeState=function(){return this.m_state===ScrollPlayer.ST_DEFEAT||this.m_state===ScrollPlayer.ST_HIT?!1:!0};ScrollPlayer.prototype.update=function(a){ScrollActor.prototype.update.call(this,a);this.m_x+=this.m_speed.x*a;this.m_y+=this.m_speed.y*a;this.keyboard&&this.keyboard.update(a)};
function ScrollObjectStylish(a,b,c,d,e){ScrollActor.call(this,a,b,c,d,e);this.type=this.nextType();this.m_skin="mcStylishObject"+this.type;this.fixPlayerY=this.fixPlayerX=0;this.clipPlayer=null;this.isItem=!0;this.isUsed=!1;this.initCharacter();switch(this.type){case 1:this.fixPlayerX=0;this.fixPlayerY=630;break;case 2:this.fixPlayerX=0;this.fixPlayerY=284;break;case 3:this.fixPlayerX=-95,this.fixPlayerY=522}this.clearFrameContainer("mcContent");a=this.m_clip.getInstance("mcContent");a.setScale(a.scale.x/
Application.DPI);this.fx=Application.instance.effectManager.createEffect("fxStylishObj",0,0,a)}Application.subclass(ScrollObjectStylish,ScrollActor);ScrollObjectStylish.ST_STAND="stand";ScrollObjectStylish.typeList=[1,2,3];ScrollObjectStylish.prototype.initCharacter=function(){this.m_character=new Character(0,0,this.m_canvas);this.m_character.addState(ScrollObjectStylish.ST_STAND,this.m_skin);this.gotoState(ScrollObjectStylish.ST_STAND)};
ScrollObjectStylish.prototype.free=function(){this.clipPlayer&&(this.clipPlayer.free(),this.clipPlayer=null);this.fx&&(this.fx.isAwaitingDelete=!0,this.fx=null);ScrollActor.prototype.free.call(this)};ScrollObjectStylish.prototype.nextType=function(){var a=ScrollObjectStylish.typeList.splice(0,1)[0];ScrollObjectStylish.typeList.push(a);return a};
ScrollObjectStylish.prototype.onCollisionActor=function(a,b){if(!this.isUsed&&this.world.game.player.onStylish(this))for(this.clipPlayer=Application.instance.getAnimation("player_stylish_"+this.type),(a=this.m_clip.getInstance("mcContent"))&&a.addChild(this.clipPlayer),this.world.game.player.setPosition(this.getXWorld()+this.fixPlayerX,this.fixPlayerY),this.world.createEffect("fxStylishIn",0,0,1,a),this.isUsed=!0,this.fx&&this.fx.setPause(!0),b=0;b<this.world.game.actorManager.actors.length;b++)a=
this.world.game.actorManager.actors[b],a.actorId===ScrollActorManager.ID_ITEM&&a.m_uniqueId===ScrollActorManager.ITEM_TYPE_STYLISH&&a!==this&&a.forceDisable();return!0};ScrollObjectStylish.prototype.forceDisable=function(){this.m_isAwaitingDelete=!0};ScrollObjectStylish.prototype.hideClipPlayer=function(){this.clipPlayer&&(this.clipPlayer.visible=!1)};
ScrollObjectStylish.prototype.update=function(a){!this.isUsed&&this.world.game&&this.world.game.boss&&(this.isUsed=!0,this.fx&&this.fx.setPause(!0));ScrollActor.prototype.update.call(this,a)};
function Spiderman(a,b,c,d,e){ScrollPlayer.call(this,a,b,c,d,e);this.move=new PlayerMove(this);this.move.setPosition(this.m_x,this.m_y);this.invulnerableTime=this.timeWaitOutScreen=this.timeNoInputs=this.timeReactionSwing=0;this.isInvulnerable=this.receivedHit=!1;b=window.config.player.pivotRect;this.limitsRect=new Rectangle(b[0],b[1],b[2],b[3]);this.isHoldButton=!1;this.objectStylish=null;this.patchNoRelease=!1;PlayerMove.GRAVITY=window.config.player.gravity;this.move.gravity=window.config.player.gravity;
this.move.radiusDecreaseSpeed=window.config.player.radiusDecreaseSpeed[this.world.game.upgradeSpeedLevel];this.move.limitRadiusMin=window.config.player.limitRadiusMin;this.move.swingAngleAcceleration=window.config.player.swingAcceleration[this.world.game.upgradeSpeedLevel];this.move.limitCteAngularAcceleration=window.config.player.limitCteAngularAcceleration[this.world.game.upgradeSpeedLevel];this.move.swingAngleSpeed=window.config.player.swingSpeed[this.world.game.upgradeSpeedLevel];PlayerMove.SWING_ANGLE_SPEED_BASE=
window.config.player.swingSpeed[this.world.game.upgradeSpeedLevel];this.clipArm1=Application.instance.getAnimation("player_arm_1");this.clipArm1.setScale(1/Application.DPI);this.clipArm2=Application.instance.getAnimation("player_arm_2");this.clipArm2.setScale(1/Application.DPI);this.contentShield=null;this.shieldLevel=DataManager.instance.getGlobalRegister(DataManager.REG_STORE_UPGRAGE_5);0<this.shieldLevel&&(this.createClipShield(),this.contentShield.visible=!1);this.pivot=new SPoint;this.webString=
null;this.webString=new window.PIXI.extras.TilingSprite(window.PIXI.Texture.fromImage("webstring_01"),100,9);this.webString.visible=!1;this.m_canvas.addChild(this.webString);this.webStringIn=null;this.webStringIn=Application.instance.getAnimation("web_in");this.webStringIn.visible=!1;this.webStringIn.position.x=40;this.webStringIn.position.y=-30;this.m_canvas.addChild(this.webStringIn);this.contentWebStringOut=Application.instance.addDisplayContainer();a.addChild(this.contentWebStringOut);this.webStringOut=
null;this.webStringOut=Application.instance.getAnimation("web_out");this.contentWebStringOut.addChild(this.webStringOut);this.intepoleWeb=new Interpolate;this.intepoleWeb.easingFunction=TweenEasing.BounceOut;this.intepoleWeb.duration=1500;this.clipVehicle=Application.instance.getAnimation("mcDroneSpiderman");this.contentVehicle=Application.instance.addDisplayContainer();this.contentVehicle.addChild(this.clipVehicle);this.contentVehicle.visible=!1;this.m_canvas.addChild(this.contentVehicle);this.fxSmokeVehicle=
this.world.createEffect("fxDroneSmokeInPlayer",0,0,1,a);this.fxSmokeVehicle.setPause(!0);this.fxImpulseVehicle=this.world.createEffect("fxDroneUp",-15,150,1,this.m_canvas);this.fxImpulseVehicle.setPause(!0);this.coinMagnetTimeDuration=this.vehicleTimeDuration=0;this.fxCoinMagnet=this.world.createEffect("fxMagnetStand",0,10,1,this.m_canvas);this.fxCoinMagnet.setPause(!0)}Application.subclass(Spiderman,ScrollPlayer);Spiderman.LIMIT_SCRREN_TOP=-100;Spiderman.LIMIT_SCRREN_BOTTOM=1050;
Spiderman.INVULNERABLE_TIME=2200;
Spiderman.prototype.free=function(){this.webString&&(this.m_canvas.removeChild(this.webString),this.webString=null);this.clipVehicle&&(this.contentVehicle.removeChild(this.clipVehicle),this.clipVehicle=null);this.move&&(this.move.free(),this.move=null);this.contentShield&&(this.m_canvas.removeChild(this.contentShield),this.contentShield=null);this.fxSmokeVehicle&&(this.fxSmokeVehicle.isAwaitingDelete=!0,this.fxSmokeVehicle=null);this.fxImpulseVehicle&&(this.fxImpulseVehicle.isAwaitingDelete=!0,this.fxImpulseVehicle=
null);this.fxCoinMagnet&&(this.fxCoinMagnet.isAwaitingDelete=!0,this.fxCoinMagnet=null);this.objectStylish&&(this.objectStylish=null);ScrollPlayer.prototype.free.call(this)};
Spiderman.prototype.initCharacter=function(){this.m_character=new Character(0,0,this.m_canvas);this.m_character.addState(ScrollPlayer.ST_APPEAR,this.m_skin+"_appear");this.m_character.addState(ScrollPlayer.ST_APPEAR_LOOP,this.m_skin+"_appear_idle");this.m_character.addState(ScrollPlayer.ST_SWING_IN,this.m_skin+"_swing_in");this.m_character.addState(ScrollPlayer.ST_SWING,this.m_skin+"_swing");this.m_character.addState(ScrollPlayer.ST_SWING_OUT,this.m_skin+"_swing_out");this.m_character.addState(ScrollPlayer.ST_FALL,
this.m_skin+"_fall");this.m_character.addState(ScrollPlayer.ST_ATTACK,this.m_skin+"_attack");this.m_character.addState(ScrollPlayer.ST_HIT,this.m_skin+"_hit");this.m_character.addState(ScrollPlayer.ST_DEFEAT,this.m_skin+"_defeat");this.m_character.addState(ScrollPlayer.ST_WIN,this.m_skin+"_win");this.m_character.addState(ScrollPlayer.ST_DASH,this.m_skin+"_dash");this.m_character.addState(ScrollPlayer.ST_DASH_OUT,this.m_skin+"_dash_out");this.m_character.addState(ScrollPlayer.ST_ON_VEHICLE,this.m_skin+
"_drone");this.m_character.addState(ScrollPlayer.ST_VEHICLE_OUT,this.m_skin+"_drone_out");this.m_character.addState(ScrollPlayer.ST_BOUNCE,this.m_skin+"_bounce");this.m_character.addState(ScrollPlayer.ST_BOUNCE_RECOVERY,this.m_skin+"_bounce");this.m_character.addState(ScrollPlayer.ST_WAIT_OUT_SCREEN,"hide");this.m_character.addState(ScrollPlayer.ST_STYLISH,"hide");this.m_character.addState(ScrollPlayer.ST_HIDE,"hide");this.m_character.onEndAnimation(this,this.onEndAnimation);this.gotoState(ScrollPlayer.ST_APPEAR,
!1)};Spiderman.prototype.setPosition=function(a,b){this.m_x=a;this.m_y=b;this.move&&this.move.setPosition(a,b)};Spiderman.prototype.createClipShield=function(){this.contentShield&&(this.m_canvas.removeChild(this.contentShield),this.contentShield=null);0<this.shieldLevel&&(this.contentShield=Application.instance.getAnimation("mc_shieldLv"+this.shieldLevel),this.contentShield.position.x=20,this.contentShield.position.y=20,this.m_canvas.addChild(this.contentShield))};
Spiderman.prototype.onPointerPress=function(){this.onInitSwing();this.setHold(!0)};Spiderman.prototype.onPointerRelease=function(){if(this.m_state!==ScrollPlayer.ST_SWING_IN)this.onEndSwing();this.setHold(!1)};Spiderman.prototype.setHold=function(a){this.isHoldButton=a};
Spiderman.prototype.onInitSwing=function(){if(this.m_state!==ScrollPlayer.ST_APPEAR){if(this.m_state===ScrollPlayer.ST_APPEAR_LOOP)this.move.onFreeFallMode(0,0);var a=this.world.game.hud();a.enabledHand&&a.showHand(!1);this.m_state!==ScrollPlayer.ST_ON_VEHICLE&&this.m_state!==ScrollPlayer.ST_STYLISH&&(Application.instance.playSound("SND_PLAYER_SWING"),this.gotoState(ScrollPlayer.ST_SWING_IN),this.move.timeFactor=.85,this.timeReactionSwing=200,this.pivot.x=~~(this.m_x+this.limitsRect.x+this.limitsRect.w*
Math.random())+150,this.pivot.y=~~(this.limitsRect.y-this.limitsRect.h*Math.random()),this.webStringIn&&(this.webStringIn.visible=!0,this.webStringIn.gotoAndPlay(1)))}};
Spiderman.prototype.onEndSwing=function(){if(this.m_state!==ScrollPlayer.ST_APPEAR&&this.m_state!==ScrollPlayer.ST_APPEAR_LOOP&&this.m_state!==ScrollPlayer.ST_ON_VEHICLE){if(this.move){var a=this.move.getTangent();a=Common.clamp(a,Common.gradToRadian(window.config.player.fixMinAngleReleaseSwing),Common.gradToRadian(window.config.player.fixMaxAngleReleaseSwing));var b=this.move.instantVelocity.y,c=b- -1.2;-1.2>b&&(this.move.instantVelocity.y=-1.2+.2*c,this.move.instantVelocity.x-=.8*c);this.move.instantVelocity.x=
Math.abs(this.move.instantVelocity.x);this.move.onFreeFallMode(this.move.instantVelocity.x*Math.cos(a),this.move.instantVelocity.y*Math.sin(a))}this.gotoState(ScrollPlayer.ST_SWING_OUT);this.webStringOut&&(this.webStringOut.position.x=-this.move.radius,this.webStringOut.gotoAndPlay(1),this.webStringOut.scale.y=this.m_x>this.pivot.x?1:-1,this.contentWebStringOut.position.x=this.pivot.x,this.contentWebStringOut.position.y=this.pivot.y,this.contentWebStringOut.rotation=Math.atan2(this.pivot.y-this.m_y,
this.pivot.x-this.m_x),this.intepoleWeb.startValues={rot:this.contentWebStringOut.rotation},this.intepoleWeb.endValues={rot:.5*-Math.PI,x:-100},this.intepoleWeb.start())}};
Spiderman.prototype.gotoState=function(a,b){this.m_clip&&(this.m_clip.filters=null);this.m_character.addState(ScrollPlayer.ST_SWING_IN,this.m_skin+"_swing_in_"+Common.randomInt(1,3));this.m_character.addState(ScrollPlayer.ST_SWING,this.m_skin+"_swing_"+Common.randomInt(1,2));this.m_character.addState(ScrollPlayer.ST_SWING_OUT,this.m_skin+"_swing_out_"+Common.randomInt(1,4));ScrollPlayer.prototype.gotoState.call(this,a,b);this.webString&&(this.webString.visible=this.m_state===ScrollPlayer.ST_SWING);
this.webStringIn&&(this.webStringIn.visible=this.m_state===ScrollPlayer.ST_SWING_IN);this.fxSmokeVehicle&&this.fxSmokeVehicle.setPause(!0);this.m_state===ScrollPlayer.ST_SWING&&(this.clearFrameContainer("mcArm1"),this.m_clip.getInstance("mcArm1")&&this.m_clip.getInstance("mcArm1").addChild(this.clipArm1),this.m_clip.getInstance("mcArm2")&&this.m_clip.getInstance("mcArm2").addChild(this.clipArm2));this.fxImpulseVehicle&&this.fxImpulseVehicle.setPause(!0);this.contentShield&&(this.m_canvas.addChild(this.contentShield),
this.contentShield.position.y=this.m_state===ScrollPlayer.ST_ON_VEHICLE?50:20);this.fxCoinMagnet&&(this.fxCoinMagnet.y=this.m_state===ScrollPlayer.ST_ON_VEHICLE?50:10)};
Spiderman.prototype.onEndAnimation=function(a){switch(a){case ScrollPlayer.ST_SWING_IN:if(this.isHoldButton)this.gotoState(ScrollPlayer.ST_SWING),this.updateWebString();else this.onEndSwing();break;case ScrollPlayer.ST_SWING_OUT:case ScrollPlayer.ST_DASH_OUT:case ScrollPlayer.ST_BOUNCE:case ScrollPlayer.ST_VEHICLE_OUT:this.gotoState(ScrollPlayer.ST_FALL);break;case ScrollPlayer.ST_BOUNCE_RECOVERY:this.gotoState(ScrollPlayer.ST_FALL);break;case ScrollPlayer.ST_APPEAR:this.world.game.intro.init();if(this.contentShield)this.world.createEffect("mc_shieldInLv"+
this.shieldLevel,20,20,1,this.m_canvas).onComplete(this,this.showInitShield);this.gotoState(ScrollPlayer.ST_APPEAR_LOOP);break;case ScrollPlayer.ST_DEFEAT:if(this.world.game.boss&&this.world.game.boss.isReal)this.world.game.outro.onDefeatByBoss();else this.world.game.outro.onCreateTransition()}};Spiderman.prototype.showInitShield=function(){this.contentShield&&(this.contentShield.visible=!0)};
Spiderman.prototype.onBounce=function(){if((this.m_state===ScrollPlayer.ST_FALL||this.m_state===ScrollPlayer.ST_SWING_OUT||this.m_state===ScrollPlayer.ST_DASH_OUT||this.m_state===ScrollPlayer.ST_VEHICLE_OUT)&&this.move.isFalling()){var a=.8*-this.move.instantVelocity.y;a=-.5<a?-.5:a;var b=.8*this.move.instantVelocity.x;b=.9>b?.9:b;this.gotoState(ScrollPlayer.ST_BOUNCE);this.move.onFreeFallMode(b,a);this.world.game.missions.onCount(MissionManager.TYPE_MISSION_BOUNCE)}};
Spiderman.prototype.onStylish=function(a){if(this.m_state===ScrollPlayer.ST_ON_VEHICLE||this.m_state===ScrollPlayer.ST_DASH||this.m_state===ScrollPlayer.ST_STYLISH)return!1;this.objectStylish=a||null;this.timeNoInputs=Infinity;this.gotoState(ScrollPlayer.ST_STYLISH);this.move.onNoneMode();this.world.game.zoom.zoomIn(.8*ScrollZoom.SPEED,ScrollZoom.ZOOM_DETAIL);this.world.game.hud().showStylishBar(!0);this.world.game.intro.createTutorial(GuiPopupTutorial.ID_TUTORIAL_LAUNCH);this.world.game.hud().addCombo();
this.contentShield&&(this.contentShield.alpha=0);return!0};Spiderman.prototype.onHide=function(){this.timeNoInputs=Infinity;this.move.onNoneMode();this.contentShield&&(this.contentShield.visible=!1);this.gotoState(ScrollPlayer.ST_HIDE)};
Spiderman.prototype.applyStylish=function(){this.onDash();Application.instance.effectManager.createEffect("fxStylishOut",0,0,this.m_canvas);this.world.game.missions.onCount(MissionManager.TYPE_MISSION_ACROBATICS,"stylish");this.world.game.achievements.onCount(Achievements.TYPE_STYLISH);.75<this.world.game.hud().stylishBarPercent&&(this.world.createEffect("mcClearAll",0,0,1,this.m_canvas),this.world.game.actorManager.forceRemoveEnemies(),this.world.game.onShake(2E3,4));this.contentShield&&(this.contentShield.alpha=
1);Application.instance.playSound("SND_PLAYER_STYLISH")};
Spiderman.prototype.onDash=function(){if(this.m_state!==ScrollPlayer.ST_ON_VEHICLE&&(!this.m_clip||"player_stylish_out"!==this.m_clip.name)){switch(this.m_state){case ScrollPlayer.ST_STYLISH:var a=this.world.game.hud().stylishBarPercent;this.move.onDashMode(window.config.player.stylishMoveParams[0]+a*(window.config.player.stylishMoveParams[1]-window.config.player.stylishMoveParams[0]));this.move.ax=-20;this.world.camera.setRightLimit(.4);this.world.game.zoom.zoomOut(1.25*ScrollZoom.SPEED);this.m_character.addState(ScrollPlayer.ST_DASH,
"player_stylish_out");this.objectStylish&&this.objectStylish.hideClipPlayer();break;default:this.move.onDashMode(window.config.player.dashSpeed[this.world.game.upgradeSpeedLevel]),this.move.ax=window.config.player.dashAcceleration[this.world.game.upgradeSpeedLevel],this.world.camera.setRightLimit(.4),this.world.game.zoom.zoomOut(1.25*ScrollZoom.SPEED,ScrollZoom.ZOOM_MID),this.m_character.addState(ScrollPlayer.ST_DASH,this.m_skin+"_dash")}this.timeNoInputs=Infinity;this.gotoState(ScrollPlayer.ST_DASH)}};
Spiderman.prototype.onOut=function(a){if(this.m_state===ScrollPlayer.ST_DASH||this.m_state===ScrollPlayer.ST_ON_VEHICLE)this.move.ax=0,this.timeNoInputs=this.move.ay=0,this.invulnerableTime=Spiderman.INVULNERABLE_TIME,this.world.game.zoom.zoomIn(.5*ScrollZoom.SPEED),this.move.onFreeFallMode(this.move.instantVelocity.x,-.5),this.m_state===ScrollPlayer.ST_ON_VEHICLE?(this.gotoState(ScrollPlayer.ST_VEHICLE_OUT),this.world.createEffect("fxDroneExplode",0,100,1,this.m_canvas),this.contentVehicle.visible=
!1,Application.instance.playSound("SND_POWERUPS_DRONE_DEACTIVE"),Application.instance.stopSound("SND_POWERUPS_DRONE_LOOP"),this.world.createEffect("mcClearAll",0,0,1,this.m_canvas),this.world.game.actorManager.forceRemoveEnemies()):this.gotoState(ScrollPlayer.ST_DASH_OUT)};
Spiderman.prototype.onVehicle=function(){if(this.m_clip&&"player_stylish_out"===this.m_clip.name)return!1;this.gotoState(ScrollPlayer.ST_ON_VEHICLE);this.fxSmokeVehicle.setPause(!1);this.vehicleTimeDuration=window.config.player.glideTimeLife;this.invulnerableTime=Spiderman.INVULNERABLE_TIME;this.timeNoInputs=0;this.contentVehicle.visible=!0;this.move.onGlideMode(window.config.player.glideSpeed,window.config.player.glideAcc);this.world.game.missions.onCount(MissionManager.TYPE_MISSION_DRONE);var a=
this.world.game.intro.createTutorial(GuiPopupTutorial.ID_TUTORIAL_DRONE);Application.instance.playSound("SND_POWERUPS_DRONE_ACTIVE");Application.instance.playSound("SND_POWERUPS_DRONE_LOOP");if(!a)this.onCreateFXVehicle();return!0};Spiderman.prototype.onCreateFXVehicle=function(){this.world.createEffect("fxDroneIn",0,100,1,this.m_canvas);this.world.createEffect("mcClearAll",0,0,1,this.m_canvas);this.world.game.actorManager.forceRemoveEnemies();this.world.game.onShake()};
Spiderman.prototype.onCoinMagnet=function(){this.coinMagnetTimeDuration+=window.config.player.magnetTimeDuration;Application.instance.effectManager.createEffect("fxMagnetIn",0,0,this.m_canvas);this.world.game.gameShaders&&this.world.game.gameShaders.showMagnetShader(!0);this.fxCoinMagnet.setPause(!1)};
Spiderman.prototype.onEndCoinMagnet=function(a){a&&Application.instance.effectManager.createEffect("fxMagnetIn",0,0,this.m_canvas);this.world.game.gameShaders&&this.world.game.gameShaders.showMagnetShader(!1);this.fxCoinMagnet.setPause(!0)};
Spiderman.prototype.onHit=function(a,b,c,d){if(this.isInvulnerable||0<=this.invulnerableTime||this.m_state===ScrollPlayer.ST_DASH||this.m_state===ScrollPlayer.ST_STYLISH)return!1;this.receivedHit=!0;this.world.game.onShake();if(this.m_state===ScrollPlayer.ST_ON_VEHICLE)return this.onOut(!0),!0;if(this.contentShield&&this.contentShield.visible)return this.invulnerableTime=Spiderman.INVULNERABLE_TIME,Application.instance.effectManager.createEffect("mc_shieldOutLv"+this.shieldLevel,20,20,this.m_canvas),
Application.instance.playSound("SND_PLAYER_SHIELD"),this.shieldLevel--,this.createClipShield(),!0;this.onEndCoinMagnet(!1);this.world.game.outro.init();Application.instance.playSound("SND_PLAYER_HIT");return!0};Spiderman.prototype.onOutScreen=function(){this.m_state!==ScrollPlayer.ST_WAIT_OUT_SCREEN&&(this.move.onNoneMode(),this.gotoState(ScrollPlayer.ST_WAIT_OUT_SCREEN),this.timeNoInputs=Infinity,this.timeWaitOutScreen=800,this.world.game.outro.init())};
Spiderman.prototype.onBounceRecovery=function(){if(this.m_state!==ScrollPlayer.ST_BOUNCE_RECOVERY){this.resetInputs();this.timeNoInputs=300;this.gotoState(ScrollPlayer.ST_BOUNCE_RECOVERY);var a=0,b=0;this.m_y<Spiderman.LIMIT_SCRREN_TOP?(a=50,b=.2):this.m_y>Spiderman.LIMIT_SCRREN_BOTTOM&&(a=900,b=-1);this.move.setPosition(this.m_x,a);this.move.onFreeFallMode(.25,b)}};
Spiderman.prototype.update=function(a){ScrollPlayer.prototype.update.call(this,a);if(this.m_state!==ScrollPlayer.ST_DEFEAT){this.invulnerableTime-=a;this.m_clip.filters=this.world.game.gameShaders&&0<this.invulnerableTime&&0===~~this.invulnerableTime%4?[this.world.game.gameShaders.invulnerableFilter]:null;this.move&&(this.move.update(a),this.m_x=this.move.x,this.m_y=this.move.y);if(this.m_y<Spiderman.LIMIT_SCRREN_TOP||this.m_y>Spiderman.LIMIT_SCRREN_BOTTOM)this.onOutScreen();this.intepoleWeb.update(a);
this.webStringOut&&(this.webStringOut.update(a),this.contentWebStringOut.rotation=this.intepoleWeb.values.rot);if(0<this.coinMagnetTimeDuration&&(this.coinMagnetTimeDuration-=a,0>=this.coinMagnetTimeDuration))this.onEndCoinMagnet(!0);switch(this.m_state){case ScrollPlayer.ST_SWING_IN:this.timeReactionSwing-=a;this.webStringIn&&(this.webStringIn.update(a),this.webStringIn.rotation=Math.atan2(this.pivot.y-this.m_y,this.pivot.x-this.m_x));this.move&&this.move.mode===PlayerMove.MODE_FREE_FALL&&0>=this.timeReactionSwing&&
this.move&&(this.move.timeFactor=1,this.move.onSwingMode(this.m_x,this.m_y,this.pivot.x,this.pivot.y));break;case ScrollPlayer.ST_ON_VEHICLE:this.contentVehicle.visible&&this.clipVehicle.update(a);this.vehicleTimeDuration-=a;if(0>=this.vehicleTimeDuration)this.onOut();break;case ScrollPlayer.ST_WAIT_OUT_SCREEN:this.timeWaitOutScreen-=a;if(0>this.timeWaitOutScreen)this.onBounceRecovery();break;case ScrollPlayer.ST_SWING:this.updateWebString();this.checkForceEndSwing();this.m_clip.getInstance("mcArm1")&&
(this.m_clip.getInstance("mcArm1").rotation=this.move.swingAngle-Math.PI);this.m_clip.getInstance("mcArm2")&&(this.m_clip.getInstance("mcArm2").rotation=this.move.swingAngle-Math.PI);break;case ScrollPlayer.ST_DASH:if(this.move.instantVelocity.x<=window.config.player.dashMinSpeedToEnd[this.world.game.upgradeSpeedLevel])this.onOut();break;case ScrollPlayer.ST_DASH_OUT:case ScrollPlayer.ST_VEHICLE_OUT:if(8<=this.m_clip.currentFrame&&this.world.game.isPress)this.onInitSwing()}this.fxSmokeVehicle&&(this.fxSmokeVehicle.x=
this.m_x-60,this.fxSmokeVehicle.y=this.m_y+70);this.contentShield&&this.contentShield.visible&&this.contentShield.update(a);this.timeNoInputs-=a}};Spiderman.prototype.updateWebString=function(){this.webString&&this.move&&(this.webString.width=this.move.radius,this.webString.tilePosition.x-=5,this.webString.rotation=this.move.swingAngle,this.webString.position.x=this.move.centerX-this.m_x,this.webString.position.y=this.move.centerY-this.m_y)};
Spiderman.prototype.checkForceEndSwing=function(){this.move&&this.move.mode===PlayerMove.MODE_SWING&&this.m_y<window.config.player.limitYForceRelease&&this.move.getTangent()>window.config.player.limitAngleForceRelease&&(this.onEndSwing(),this.world.game.touchControl.reset(),this.patchNoRelease=!0)};
Spiderman.prototype.canCountTimeToVehicle=function(){return this.m_state===ScrollPlayer.ST_APPEAR||this.m_state===ScrollPlayer.ST_APPEAR_LOOP||this.m_state===ScrollPlayer.ST_HIT||this.m_state===ScrollPlayer.ST_ON_VEHICLE||this.m_state===ScrollPlayer.ST_VEHICLE_OUT||this.m_state===ScrollPlayer.ST_DASH||this.m_state===ScrollPlayer.ST_DEFEAT?!1:!0};
function ScrollVehicleFly(a,b,c,d,e){ScrollActor.call(this,a,b,c,d,e);this.isVehicle=!0;this.m_skin="mcDrone";this.time=0;this.oy=d;this.speedX=-.2;this.initCharacter();this.update(0);ScrollVehicleFly.instance=this}Application.subclass(ScrollVehicleFly,ScrollActor);ScrollVehicleFly.ST_STAND="stand";ScrollVehicleFly.ST_OUT="out";ScrollVehicleFly.instance=null;
ScrollVehicleFly.prototype.initCharacter=function(){this.m_character=new Character(0,0,this.m_canvas);this.m_character.addState(ScrollVehicleFly.ST_STAND,this.m_skin);this.m_character.addState(ScrollVehicleFly.ST_OUT,this.m_skin);this.m_character.onEndAnimation(this,this.onEndAnimation);this.gotoState(ScrollVehicleFly.ST_STAND)};
ScrollVehicleFly.prototype.forceDestroy=function(){this.world.createEffect("fxDroneExplode",this.m_x,this.m_y+30,1,this.world.getLayer("static_front").canvas);this.m_isAwaitingDelete=!0};
ScrollVehicleFly.prototype.update=function(a){ScrollActor.prototype.update.call(this,a);this.time+=7.5E-4*a;this.m_state===ScrollVehicleFly.ST_STAND&&(this.m_y=this.oy+150*SMath.fastSin(this.time));this.world.game.player&&this.world.game.player.state()===ScrollPlayer.ST_DEFEAT?this.forceDestroy():(this.m_x+=this.speedX*a,-200>this.m_x&&(this.m_isAwaitingDelete=!0,ScrollVehicleFly.instance=null))};
ScrollVehicleFly.prototype.onCollisionActor=function(a,b){this.m_state===ScrollVehicleFly.ST_STAND&&a.onVehicle()&&(this.m_isAwaitingDelete=!0,ScrollVehicleFly.instance=null);return!0};ScrollVehicleFly.prototype.free=function(){ScrollVehicleFly.instance=null;ScrollActor.prototype.free.call(this)};
function PlayerMove(a){this.player=a;this.ayGlide=this.ay=this.ax=this.vy=this.vx=this.oldY=this.oldX=this.oy=this.ox=this.y=this.x=this.time=0;this.glideIsTop=!1;this.timeGlide=0;this.gravity=PlayerMove.GRAVITY;this.dy=this.dx=0;this.timeFactor=1;this.mode=0;this.instantVelocity=new SPoint(0,0);this.radius=this.centerY=this.centerX=0;this.radiusDecreaseSpeed=-.5;this.swingAngle=0;this.swingAngleSpeed=-.002;this.swingAngleAcceleration=-.5;this.limitRadiusMin=500;this.limitCteAngularAcceleration=-.006;
this.canvasDraw=this.player.world.getLayer("player").canvas;this.debug=!1;this._debugCanvasTrajectory=this._debugCanvasLine=null;this._debugStepsGoalMaxSwingAcc=this._angleDeltaBezier=0;this.debug&&(this._debugCanvasLine=new SGraphics,this.canvasDraw.addChild(this._debugCanvasLine),this._debugCanvasTrajectory=new SGraphics,this.canvasDraw.addChild(this._debugCanvasTrajectory),this._debugCanvasTrajectory.moveTo(0,0))}PlayerMove.MODE_NONE=0;PlayerMove.MODE_FREE_FALL=1;PlayerMove.MODE_SWING=2;
PlayerMove.MODE_DASH=3;PlayerMove.MODE_GLIDE=4;PlayerMove.GRAVITY=20;PlayerMove.GLIDE_LIMIT_Y=130;PlayerMove.SWING_ANGLE_SPEED_BASE=-.002;PlayerMove.prototype.free=function(){this._debugCanvasLine&&(this.canvasDraw.removeChild(this._debugCanvasLine),this._debugCanvasLine=null);this._debugCanvasTrajectory&&(this.canvasDraw.removeChild(this._debugCanvasTrajectory),this._debugCanvasTrajectory=null);this.canvasDraw=null};
PlayerMove.prototype.setPosition=function(a,b){this.x=this.ox=this.oldX=a;this.y=this.oy=this.oldY=b};PlayerMove.prototype.setY=function(a){this.y=this.oy=this.oldY=a};PlayerMove.prototype.restoreGravity=function(){this.gravity=PlayerMove.GRAVITY};PlayerMove.prototype.applyImpulse=function(a,b){this.vx+=a;this.vy+=b};PlayerMove.prototype.getTangent=function(){return Math.atan2(-(this.y-this.oldY),this.x-this.oldX)};
PlayerMove.prototype.getTangentInv=function(){return Math.atan2(this.y-this.oldY,this.x-this.oldX)};PlayerMove.prototype.isFalling=function(){return this.mode===PlayerMove.MODE_FREE_FALL&&this.y>this.oldY?!0:!1};PlayerMove.prototype.onNoneMode=function(){this.mode=PlayerMove.MODE_NONE;this._debugCanvasLine&&this._debugCanvasLine.clear()};
PlayerMove.prototype.onFreeFallMode=function(a,b){this.vx=a||0;this.vy=b||0;this.time=0;this.ox=this.x;this.oy=this.y;this.ax=0;this.mode=PlayerMove.MODE_FREE_FALL;this._debugCanvasLine&&this._debugCanvasLine.clear()};PlayerMove.prototype.onDashMode=function(a){this.vx=a||0;this.time=this.vy=0;this.ox=this.x;this.oy=this.y;this.mode=PlayerMove.MODE_DASH;this._debugCanvasLine&&this._debugCanvasLine.clear()};
PlayerMove.prototype.onGlideMode=function(a,b){this.ayGlide=0;this.glideIsTop=!1;this.timeGlide=500;this.time=0;this.ox=this.x;this.vx=a;this.ax=b;this.mode=PlayerMove.MODE_GLIDE;this._debugCanvasLine&&this._debugCanvasLine.clear()};
PlayerMove.prototype.onSwingMode=function(a,b,c,d){this.swingAngleSpeed=PlayerMove.SWING_ANGLE_SPEED_BASE;this.swingAngleSpeed-=1E-4*Math.abs(this.instantVelocity.x);this.centerX=c;this.centerY=d;a=this.centerX-a;b=this.centerY-b;this.radius=Math.sqrt(a*a+b*b);this.swingAngle=Math.PI+Math.atan2(b,a);this.mode=PlayerMove.MODE_SWING;this._angleDeltaBezier=this._debugStepsGoalMaxSwingAcc=this.time=0};
PlayerMove.prototype.reset=function(){this.vx=0;this.vy=2;this.time=1;this.ox=this.x;this.oy=this.y;this.ay=this.ax=0};
PlayerMove.prototype.update=function(a){this.time+=a*this.timeFactor;this.oldX=this.x;this.oldY=this.y;switch(this.mode){case PlayerMove.MODE_FREE_FALL:this.x=this.ox+this.vx*this.time+5E-5*this.ax*this.time*this.time;this.y=this.oy+this.vy*this.time+5E-5*(this.gravity+this.ay)*this.time*this.time;break;case PlayerMove.MODE_GLIDE:this.timeGlide-=a;this.x=this.ox+this.vx*this.time+5E-5*this.ax*this.time*this.time;0>this.timeGlide&&(this.player.isHoldButton?this.ayGlide-=2.5:(this.glideIsTop&&(this.ayGlide=
0),this.ayGlide+=2.5),this.player.fxImpulseVehicle.setPause(!this.player.isHoldButton),this.y+=.5*(.005*a+.001*this.ayGlide*a*a),this.glideIsTop=!1,this.y<=PlayerMove.GLIDE_LIMIT_Y&&(this.y=PlayerMove.GLIDE_LIMIT_Y,this.glideIsTop=!0));break;case PlayerMove.MODE_DASH:this.x=this.ox+this.vx*this.time+5E-5*this.ax*this.time*this.time;break;case PlayerMove.MODE_SWING:if(this.updateSwingMove(a),this._debugCanvasLine){this._debugCanvasLine.clear();this._debugCanvasLine.lineStyle(6,0,1);this._debugCanvasLine.moveTo(this.x,
this.y);var b=this._angleDeltaBezier+=.0015*a,c=this.swingAngle-(.7-b);b*=.15;var d=this.centerX+this.radius*(.5-b)*Math.cos(c),e=this.centerY+this.radius*(.5-b)*Math.sin(c),f=this.centerX+this.radius*(.1-b)*Math.cos(c);b=this.centerY+this.radius*(.1-b)*Math.sin(c);this._debugCanvasLine.bezierCurveTo(d,e,f,b,this.centerX,this.centerY);this._debugCanvasLine.lineStyle(4,16777215,1);this._debugCanvasLine.moveTo(this.x,this.y);this._debugCanvasLine.bezierCurveTo(d,e,f,b,this.centerX,this.centerY)}}this._debugCanvasTrajectory&&
(this._debugCanvasTrajectory.lineStyle(1,65280,1),this._debugCanvasTrajectory.lineTo(this.x,this.y));this.instantVelocity.x=(this.x-this.oldX)/a;this.instantVelocity.y=(this.y-this.oldY)/a};
PlayerMove.prototype.updateSwingMove=function(a){this.radius>this.limitRadiusMin&&(this.radius+=this.radiusDecreaseSpeed*a);var b=0;0!==this.swingAngleAcceleration&&(b=5E-7*this.swingAngleAcceleration*this.time*this.time,b=b<this.limitCteAngularAcceleration?this.limitCteAngularAcceleration:b);this.swingAngle+=this.swingAngleSpeed*a+b;this.x=this.centerX+this.radius*Math.cos(this.swingAngle);this.y=this.centerY+this.radius*Math.sin(this.swingAngle);this.debug&&0<=this._debugStepsGoalMaxSwingAcc&&0!==
this.swingAngleAcceleration&&(this._debugStepsGoalMaxSwingAcc++,b===this.limitCteAngularAcceleration&&(Application.info("PlayerMove :: goal max Acce Angular in "+this._debugStepsGoalMaxSwingAcc+" steps, "+~~this.time+" millseconds"),1===this._debugStepsGoalMaxSwingAcc&&Application.warn('PlayerMove :: Reached " limit acceleration angular" very soon check values "swingAngleAcceleration" or "limitCteAngularAcceleration" '),this._debugStepsGoalMaxSwingAcc=-1))};
function ScrollActorManager(a,b){this.game=a;this.world=b;this.actors=[];this.putCoins=ScrollActorManager.MAX_COIN_CREATE;this.posCoinsY=this.posCoinsX=0;this.configToCoin={id:ScrollActorManager.ID_ITEM,uniqueId:ScrollActorManager.ITEM_TYPE_COIN};this.time=0}ScrollActorManager.ID_PLAYER=1;ScrollActorManager.ID_ENEMY=10;ScrollActorManager.ID_ITEM=20;ScrollActorManager.ID_VEHICLE=30;ScrollActorManager.ENEMY_TYPE_NORMAL=1;ScrollActorManager.ENEMY_TYPE_SHOOTING=2;ScrollActorManager.ENEMY_HAZARD_1=3;
ScrollActorManager.ENEMY_EXPLODING=4;ScrollActorManager.ENEMY_BULLET=5;ScrollActorManager.ENEMY_SENSOR=6;ScrollActorManager.ENEMY_ROCKET=7;ScrollActorManager.ENEMY_BOSS_HAND=8;ScrollActorManager.ENEMY_EXPLODING_TO_BOSS=9;ScrollActorManager.ITEM_TYPE_COIN=1;ScrollActorManager.ITEM_TYPE_RING=2;ScrollActorManager.ITEM_TYPE_MAGNET=3;ScrollActorManager.ITEM_TYPE_STYLISH=4;ScrollActorManager.VEHICLE_TYPE_FLY=1;ScrollActorManager.MAX_COIN_CREATE=20;
ScrollActorManager.prototype.free=function(){for(var a=0;a<this.actors.length;a++)this.actors[a].free(),this.actors[a]=null;this.actors=null};ScrollActorManager.prototype.createBullet=function(a,b){var c=Math.PI;a=new ScrollBullet("stickman_bullet",this.world,a,b);a.motionSettings(window.config.enemys.bullet_speed,0,8,c,0,window.config.enemys.bullet_timeALive);a.actorId=ScrollActorManager.ID_ENEMY;this.actors.push(a)};
ScrollActorManager.prototype.createBossHand=function(a,b){return this.createActor(a||0,b||0,{id:ScrollActorManager.ID_ENEMY,uniqueId:ScrollActorManager.ENEMY_BOSS_HAND})};ScrollActorManager.prototype.createExplodingToBoss=function(a,b){return this.createActor(a||0,b||0,{id:ScrollActorManager.ID_ENEMY,uniqueId:ScrollActorManager.ENEMY_EXPLODING_TO_BOSS})};
ScrollActorManager.prototype.createVehicle=function(a,b){return this.createActor(a||this.game.player.m_x-this.game.world.camera.x+1600,b||420,{id:ScrollActorManager.ID_VEHICLE,uniqueId:ScrollActorManager.VEHICLE_TYPE_FLY})};ScrollActorManager.prototype.createMagnet=function(a,b){var c={id:ScrollActorManager.ID_ITEM,uniqueId:ScrollActorManager.ITEM_TYPE_MAGNET};a=a||-this.world.getLayer("objects").canvas.position.x+this.game.world.camera.width+200;return this.createActor(a,b||500,c)};
ScrollActorManager.prototype.createStylishObject=function(a,b){var c={id:ScrollActorManager.ID_ITEM,uniqueId:ScrollActorManager.ITEM_TYPE_STYLISH};a=a||-this.world.getLayer("objects").canvas.position.x+this.game.world.camera.width+200;return this.createActor(a,b||0,c)};
ScrollActorManager.prototype.forceRemoveEnemies=function(){for(var a=0;a<this.actors.length;a++)this.actors[a].actorId===ScrollActorManager.ID_ENEMY&&this.actors[a].getXWorld()<this.game.world.camera.x+this.game.world.camera.width+300&&this.actors[a].forceRemove()};ScrollActorManager.prototype.forceRemoveAllsEnemies=function(){for(var a=0;a<this.actors.length;a++)this.actors[a].actorId===ScrollActorManager.ID_ENEMY&&this.actors[a].forceRemove()};
ScrollActorManager.prototype.update=function(a){this.time+=a;for(var b,c=0;c<this.actors.length;c++)b=this.actors[c],b.isAwaitingDelete()?(b.free(),this.actors[c]=null,this.actors.splice(c--,1)):(b.update(a),!b.isVehicle&&b.isEnemy&&!b.isHazard&&b.getXWorld(),!b.isVehicle&&!b.bossBullet&&b.getXWorld()<this.world.camera.x-500&&b.setAwaitingDelete(!0));this.putCoins<ScrollActorManager.MAX_COIN_CREATE&&0===~~this.time%4&&(this.putCoins++,this.createActor(this.posCoinsX+150*this.putCoins,this.posCoinsY,
this.configToCoin))};ScrollActorManager.prototype.createLineCoins=function(a,b){this.putCoins=0;this.posCoinsX=a;this.posCoinsY=b};
ScrollActorManager.prototype.createActor=function(a,b,c){var d=null,e=this.world.getLayer("objects").canvas;switch(c.id){case ScrollActorManager.ID_ITEM:switch(c.uniqueId){case ScrollActorManager.ITEM_TYPE_COIN:d=new ScrollCoin(e,this.world,a,b,c);d.actorId=ScrollActorManager.ID_ITEM;break;case ScrollActorManager.ITEM_TYPE_RING:d=new ScrollRing(e,this.world.getLayer("objects_front").canvas,this.world,a,b,c);d.actorId=ScrollActorManager.ID_ITEM;break;case ScrollActorManager.ITEM_TYPE_MAGNET:d=new ScrollMagnet(e,
this.world,a,b,c);d.actorId=ScrollActorManager.ID_ITEM;break;case ScrollActorManager.ITEM_TYPE_STYLISH:d=new ScrollObjectStylish(e,this.world,a,b,c),d.actorId=ScrollActorManager.ID_ITEM}break;case ScrollActorManager.ID_ENEMY:switch(c.uniqueId){case ScrollActorManager.ENEMY_TYPE_NORMAL:d=new ScrollEnemy(e,this.world,a,b,c);d.actorId=ScrollActorManager.ID_ENEMY;break;case ScrollActorManager.ENEMY_TYPE_SHOOTING:d=new ScrollShooterEnemy(e,this.world,a,b,c);d.actorId=ScrollActorManager.ID_ENEMY;break;
case ScrollActorManager.ENEMY_HAZARD_1:d=new ScrollHazard(e,this.world,a,b,c);d.actorId=ScrollActorManager.ID_ENEMY;break;case ScrollActorManager.ENEMY_EXPLODING:d=new ScrollExplodingEnemy(e,this.world,a,b,c);d.actorId=ScrollActorManager.ID_ENEMY;break;case ScrollActorManager.ENEMY_EXPLODING_TO_BOSS:e=this.world.getLayer("static_front").canvas;d=new ScrollExplodingEnemyToBoss(e,this.world,a,b,c);d.actorId=ScrollActorManager.ID_ENEMY;break;case ScrollActorManager.ENEMY_SENSOR:d=new ScrollSensor(e,
this.world,a,b,c);d.actorId=ScrollActorManager.ID_ENEMY;break;case ScrollActorManager.ENEMY_ROCKET:d=new ScrollRocket(e,this.world,a,b,c);d.actorId=ScrollActorManager.ID_ENEMY;break;case ScrollActorManager.ENEMY_BOSS_HAND:e=this.world.getLayer("static_front").canvas,d=new BossBulletHand(e,this.world,a,b,c),d.actorId=ScrollActorManager.ID_ENEMY}break;case ScrollActorManager.ID_VEHICLE:switch(e=this.world.getLayer("static_front").canvas,c.uniqueId){case ScrollActorManager.VEHICLE_TYPE_FLY:d=new ScrollVehicleFly(e,
this.world,a,b,c),d.actorId=ScrollActorManager.ID_VEHICLE}}d&&this.actors.push(d);return d};
ScrollActorManager.prototype.createSection=function(a,b,c,d){ScrollCollisionManager.fixFirtUpdate=!0;c=c||0;d=d||0;var e=0,f=window[a];for(a=0;a<f.layerTypes.length;a++)if("objects"===f.layerTypes[a].type){var g=1;var h=f.layerTypes[a].name;-1!==h.indexOf("ob_")&&(g=parseInt(h.split("_")[1],10));if(g<=b){var k=EDIUtils.getParseObjectList(f.layerTypes[a].object,f.mapWords);for(h=0;h<k.length;h++)this.createActor(c+k[h].x,d+k[h].y,k[h])}1==g&&(e=f.layerTypes[a].width*f.layerTypes[a].tileW)}0===e&&Application.warn("ScrollActorManager :: createSection map with is 0");
return e};function ScrollCollisionManager(a){this.game=a;ScrollCollisionManager.fixFirtUpdate=!0}ScrollCollisionManager.COLL_COLLISION="mcCollision";ScrollCollisionManager.COLL_ATTACK="mcCollisionAttack";ScrollCollisionManager.fixFirtUpdate=!0;ScrollCollisionManager.prototype.free=function(){this.game=null};
ScrollCollisionManager.prototype.update=function(a){if(ScrollCollisionManager.fixFirtUpdate)ScrollCollisionManager.fixFirtUpdate=!1;else{a=this.game.player;var b=this.game.actorManager.actors,c;if(this.game.boss&&a.hitTest(this.game.boss))this.game.boss.onCollisionActor(a,ScrollCollisionManager.COLL_COLLISION);for(var d=0;d<b.length;d++){var e=b[d];switch(e.actorId){case ScrollActorManager.ID_ENEMY:if(e.uniqueId()===ScrollActorManager.ENEMY_EXPLODING){var f=this.game.actorManager.actors;for(c=0;c<
f.length;c++){var g=f[c];if(g.actorId===ScrollActorManager.ID_ENEMY&&g!==e&&e.hitTest(g))e.onCollisionActor(g,ScrollCollisionManager.COLL_COLLISION)}}if(a.hitTest(e))e.onCollisionActor(a,ScrollCollisionManager.COLL_COLLISION);break;case ScrollActorManager.ID_VEHICLE:if(a.hitTest(e))e.onCollisionActor(a,ScrollCollisionManager.COLL_COLLISION);break;case ScrollActorManager.ID_ITEM:if(a.hitTest(e))e.onCollisionActor(a,ScrollCollisionManager.COLL_COLLISION)}}}};
ScrollCollisionManager.checkProximityActor=function(a,b,c){return b.m_x>a.m_x-c&&b.m_x<a.m_x+c&&b.m_y>a.m_y-c&&b.m_y<a.m_y+c};
function ScrollBoss(a,b,c,d,e){e.skin="mcBossTest";ScrollActor.call(this,a,b,c,d,e);this.layerName="static_front";this.m_skin="mcBoss";this.isReal=this.isBoss=!0;this.level=0;this.setScale(ScrollBoss.SCALE);this.waitInsertSection=!1;Application.sandbox&&(this.level=parseInt(Application.sandbox.startSettings.bossLevel,10));this.initCharacter();this.behavior=null;this.contentBack=Application.instance.addDisplayContainer();this.m_canvas.addChild(this.contentBack);this.fxCharge=this.world.createEffect("fxBossCharge",
0,-100,1,this.m_canvas);this.fxCharge.setPause(!0);this.fxCloud=this.world.createEffect("fxBossCloud",0,0,1,this.m_canvas);this.fxDefeat=this.world.createEffect("fxBossDefeat",0,0,1,this.m_canvas);this.fxDefeat.setPause(!0);this.fxDamage=null;this.clipCloud=Application.instance.getAnimation("mcCloud");this.clipCloud.scale.x=this.clipCloud.scale.y=ScrollBoss.SCALE;this.m_canvas.addChild(this.clipCloud);this.summonSection=null;this.showAchievement=this.finish=!1;this.onInitBehavior()}
Application.subclass(ScrollBoss,ScrollActor);ScrollBoss.MAX_LEVEL=2;ScrollBoss.SCALE=1.2;ScrollBoss.ST_APPEAR="appear";ScrollBoss.ST_STAND="stand";ScrollBoss.ST_DEFEAT="defeat";ScrollBoss.ST_PRE_SHOT="pre_shot";ScrollBoss.ST_SHOT="shot";ScrollBoss.ST_TAUNT="taunt";ScrollBoss.ST_SUMMON="summon";ScrollBoss.ST_DIZZY="dizzy";ScrollBoss.ST_HIT="hit";ScrollBoss.ST_FALL="fall";ScrollBoss.ST_HIDE="hide";
ScrollBoss.prototype.free=function(){this.behavior&&this.behavior.free();this.fxCharge&&(this.fxCharge.isAwaitingDelete=!0);this.fxCloud&&(this.fxCloud.isAwaitingDelete=!0);this.fxDamage&&(this.fxDamage.isAwaitingDelete=!0);this.fxDefeat&&(this.fxDefeat.isAwaitingDelete=!0);this.fxDamage=this.fxDefeat=this.fxCloud=this.fxCharge=this.behavior=null;ScrollActor.prototype.free.call(this)};
ScrollBoss.prototype.onInitBehavior=function(){this.behavior=new BossBehaviorIntro(this);BossBehaviorIntro.showFirstTime&&this.behavior.forceEnd()};ScrollBoss.prototype.onEndSummonSection=function(){this.summonSection=null;if(this.behavior)this.behavior.onEndSummonSection()};
ScrollBoss.prototype.onEndBehavior=function(a){a&&Application.info(" ScrollBoss :: onEndBehavior "+a.type);this.behavior&&(this.behavior.free(),this.behavior=null);switch(a.type){case BossBehavior.TYPE_INTRO:this.gotoState(ScrollBoss.ST_HIDE);this.behavior=new BossBehaviorHands(this);this.world.game.hud().showBarBoss(!0);break;case BossBehavior.TYPE_HAND:this.behavior=new BossBehaviorLaser(this);this.gotoState(ScrollBoss.ST_STAND);break;case BossBehavior.TYPE_LASER:this.behavior=new BossBehaviorSummon(this),
this.gotoState(ScrollBoss.ST_STAND)}};ScrollBoss.prototype.testBehaviorHand=function(){};ScrollBoss.prototype.onCollisionActor=function(a,b){if(this.m_state===ScrollBoss.ST_DIZZY)if(this.level++,this.world.game.hud().onUpdateBossbar(34),this.level>ScrollBoss.MAX_LEVEL)this.onDefeat();else this.onFall(),this.world.game.onShake();else this.world.game.player.onHit(0)&&this.world.createEffect("fxLaserHit",this.world.game.player.m_x,this.world.game.player.m_y,1,this.world.getLayer("player").canvas);return!0};
ScrollBoss.prototype.onHit=function(){return this.m_state!==ScrollBoss.ST_HIT&&this.behavior.type===BossBehavior.TYPE_SUMMON?(this.behavior.state=BossBehavior.ST_NONE,this.gotoState(ScrollBoss.ST_HIT),this.world.game.onShake(),Application.instance.playSound("SND_BOSS_HIT"),!0):!1};
ScrollBoss.prototype.gotoState=function(a,b){ScrollActor.prototype.gotoState.call(this,a);this.fxDefeat&&this.m_state===ScrollBoss.ST_DEFEAT&&(this.fxDefeat.swapOverDepth(),this.fxDefeat.setPause(!1));this.clipCloud&&(this.m_canvas.addChild(this.clipCloud),this.clipCloud.visible=this.m_state!==ScrollBoss.ST_HIDE&&this.m_state!==ScrollBoss.ST_FALL&&this.m_state!==ScrollBoss.ST_DEFEAT);this.fxCloud&&(this.fxCloud.swapOverDepth(),this.fxCloud.setPause(this.m_state===ScrollBoss.ST_HIDE||this.m_state===
ScrollBoss.ST_FALL||this.m_state===ScrollBoss.ST_DEFEAT));this.fxDamage&&(this.fxDamage.swapOverDepth(),this.fxDamage.setPause(this.m_state===ScrollBoss.ST_HIDE||this.m_state===ScrollBoss.ST_FALL||this.m_state===ScrollBoss.ST_DEFEAT));this.m_state===ScrollBoss.ST_PRE_SHOT?Application.instance.playSound("SND_BOSS_LASER_LOAD"):this.m_state===ScrollBoss.ST_SHOT&&Application.instance.playSound("SND_BOSS_LASER_SHOOT");this.m_state!==ScrollBoss.ST_SHOT&&Application.instance.stopSound("SND_BOSS_LASER_SHOOT")};
ScrollBoss.prototype.onFall=function(){this.behavior&&(this.behavior.free(),this.behavior=null);Application.instance.effectManager.createEffect("fxBossMidDefeat",this.m_x,this.m_y-100,this.world.getLayer("static_front").canvas);this.fxDamage&&(this.fxDamage.isAwaitingDelete=!0);1<=this.level&&2>=this.level&&(this.fxDamage=this.world.createEffect("fxBossDamage"+this.level,0,0,1,this.m_canvas));Application.instance.playSound("SND_BOSS_HIT");this.gotoState(ScrollBoss.ST_FALL)};
ScrollBoss.prototype.onDefeat=function(){this.behavior&&(this.behavior.free(),this.behavior=null);this.world.game.onShake(1500,8);Application.instance.effectManager.createEffect("fxTransition",window.innerWidth/Layout.scale*.5,500,this.world.getLayer("static_front").canvas);this.world.game.player.onHide();this.setPosition(this.m_x,this.m_y+80);this.gotoState(ScrollBoss.ST_DEFEAT);this.world.game.zoom.zoomIn(.8*ScrollZoom.SPEED,ScrollZoom.ZOOM_DETAIL);Application.instance.playSound("SND_BOSS_DEFEAT")};
ScrollBoss.prototype.initCharacter=function(){this.m_character=new Character(0,0,this.m_canvas);this.m_character.addState(ScrollBoss.ST_APPEAR,this.m_skin+"_appear");this.m_character.addState(ScrollBoss.ST_DEFEAT,this.m_skin+"_defeat");this.m_character.addState(ScrollBoss.ST_STAND,this.m_skin+"_stand");this.m_character.addState(ScrollBoss.ST_SHOT,this.m_skin+"_shot");this.m_character.addState(ScrollBoss.ST_PRE_SHOT,this.m_skin+"_pre_shot");this.m_character.addState(ScrollBoss.ST_TAUNT,this.m_skin+
"_taunt");this.m_character.addState(ScrollBoss.ST_SUMMON,this.m_skin+"_summon");this.m_character.addState(ScrollBoss.ST_DIZZY,this.m_skin+"_dizzy");this.m_character.addState(ScrollBoss.ST_HIT,this.m_skin+"_hit");this.m_character.addState(ScrollBoss.ST_FALL,this.m_skin+"_fall");this.m_character.addState(ScrollBoss.ST_HIDE,"hide");this.m_character.onEndAnimation(this,this.onEndAnimation);this.gotoState(ScrollBoss.ST_HIDE)};
ScrollBoss.prototype.onEndAnimation=function(a){this.behavior&&this.behavior.bossOnEndAnimation(a);this.m_state===ScrollBoss.ST_FALL&&(this.behavior=new BossBehaviorHands(this),this.gotoState(ScrollBoss.ST_HIDE),Application.instance.effectManager.createEffect("fxBossMidDefeat",this.m_x+320,this.m_y-120,this.world.getLayer("static_front").canvas),Application.instance.effectManager.createEffect("fxTransition",window.innerWidth/Layout.scale*.5,500,this.world.getLayer("static_front").canvas),this.world.game.onShake())};
ScrollBoss.prototype.update=function(a){this.behavior&&(this.m_x=this.behavior.x,this.m_y=this.behavior.y,this.behavior.update(a));if(this.summonSection&&this.world.xOutCamera()>this.summonSection.endX)this.onEndSummonSection();ScrollActor.prototype.update.call(this,a);this.clipCloud&&this.clipCloud.update(a);this.m_state!==ScrollBoss.ST_DEFEAT||this.showAchievement||42!==this.m_clip.currentFrame||(this.showAchievement=!0,this.world.game.achievements.onCount(Achievements.TYPE_REAL_MYSTERIO));this.m_state===
ScrollBoss.ST_DEFEAT&&145===this.m_clip.currentFrame&&(this.fxDefeat&&this.fxDefeat.setPause(!0),this.world.game.hud().showBarBoss(!1));this.m_state!==ScrollBoss.ST_DEFEAT||this.finish||85!==this.m_clip.currentFrame||(this.finish=!0,this.world.game.outro.onEndBoss());this.m_state===ScrollBoss.ST_SUMMON&&(1===this.m_clip.currentFrame&&this.world.game.showNegativeShader(!0),12===this.m_clip.currentFrame&&this.world.game.showNegativeShader(!1))};
function ScrollBossMid(a,b,c,d,e){ScrollBoss.call(this,a,b,c,d,e);this.isReal=!1}Application.subclass(ScrollBossMid,ScrollBoss);ScrollBossMid.APPEAR_COUNT=0;ScrollBossMid.APPEAR_LEVEL=0;ScrollBossMid.prototype.onInitBehavior=function(){ScrollBossMid.APPEAR_COUNT++;this.level=ScrollBossMid.APPEAR_LEVEL;0===ScrollBossMid.APPEAR_COUNT%2?(this.behavior=new BossBehaviorHands(this),this.gotoState(ScrollBoss.ST_HIDE)):(this.behavior=new BossBehaviorLaser(this),this.gotoState(ScrollBoss.ST_STAND))};
ScrollBossMid.prototype.onEndBehavior=function(a){this.level=ScrollBossMid.APPEAR_LEVEL;a&&Application.info(" ScrollBossMid :: onEndBehavior "+a.type);this.behavior&&(this.behavior.free(),this.behavior=null);switch(a.type){case BossBehavior.TYPE_HAND:this.setPosition(window.innerWidth/Layout.scale+100,600);case BossBehavior.TYPE_LASER:this.behavior=new BossBehaviorSummon(this),this.gotoState(ScrollBoss.ST_STAND)}};
ScrollBossMid.prototype.onEndAnimation=function(a){this.behavior&&this.behavior.bossOnEndAnimation(a);this.m_state===ScrollBoss.ST_FALL&&(ScrollBossMid.APPEAR_LEVEL++,2<ScrollBossMid.APPEAR_LEVEL&&(ScrollBossMid.APPEAR_LEVEL=2),this.m_isAwaitingDelete=!0,Application.instance.effectManager.createEffect("fxBossMidDefeat",this.m_x+320,this.m_y-120,this.world.getLayer("static_front").canvas),Application.instance.effectManager.createEffect("fxTransition",window.innerWidth/Layout.scale*.5,500,this.world.getLayer("static_front").canvas),
this.world.game.onShake(),this.world.game.achievements.onCount(Achievements.TYPE_MYSTERIO))};ScrollBossMid.prototype.onDefeat=function(){this.onFall()};function BossBehavior(a){this.boss=a;this.world=this.boss.world;this.player=this.boss.world.game.player;this.type=this.state=this.y=this.x=this.time=0;this.canvas=null}BossBehavior.ST_NONE=0;BossBehavior.TYPE_INTRO=1;BossBehavior.TYPE_HAND=2;BossBehavior.TYPE_LASER=3;BossBehavior.TYPE_SUMMON=4;
BossBehavior.prototype.free=function(){this.canvas=this.player=this.world=this.boss=null};BossBehavior.prototype.bossOnEndAnimation=function(a){};BossBehavior.prototype.onEndSummonSection=function(){};BossBehavior.prototype.update=function(a){};
function BossBehaviorHands(a){BossBehavior.call(this,a);this.type=BossBehavior.TYPE_HAND;this.frecuency=Application.config.boss_attack_hand[a.level].frecuency;this.timeHandStand=Application.config.boss_attack_hand[a.level].timeStandHand;this.speedHand=Application.config.boss_attack_hand[a.level].speedHand;this.pattern=Common.copyNumericArray(Application.config.boss_attack_hand[a.level].pattern);this.time=this.frecuency;this.state=BossBehaviorHands.ST_SHOT}Application.subclass(BossBehaviorHands,BossBehavior);
BossBehaviorHands.ST_SHOT=1;BossBehaviorHands.ST_WAIT_TO_REMOVE=2;BossBehaviorHands.prototype.free=function(){BossBehavior.prototype.free.call(this)};
BossBehaviorHands.prototype.update=function(a){this.time+=a;switch(this.state){case BossBehaviorHands.ST_SHOT:this.time>this.frecuency&&(this.time=0,0<this.pattern.length?(a=this.pattern.shift(),0!==a&&(a=this.world.game.actorManager.createBossHand(window.innerWidth/Layout.scale-230,1===a?360:2===a?500:710),a.timeStand=this.timeHandStand,a.speedHand=this.speedHand)):this.state=BossBehaviorHands.ST_WAIT_TO_REMOVE);break;case BossBehaviorHands.ST_WAIT_TO_REMOVE:if(2E3<this.time)this.boss.onEndBehavior(this)}};
function BossBehaviorLaser(a){BossBehavior.call(this,a);this.type=BossBehavior.TYPE_LASER;this.x=window.innerWidth/Layout.scale+100;this.y=600;a.setPosition(this.x,this.y);this.xIntro=this.x-300;this.timeFollow=Application.config.boss_attack_laser[a.level].timeFollow;this.speedFollow=Application.config.boss_attack_laser[a.level].speedFollow;this.timeAttack=Application.config.boss_attack_laser[a.level].timeAttack;this.repeats=Application.config.boss_attack_laser[a.level].repeats;this.move=null;this.state=
BossBehaviorLaser.ST_INTRO}Application.subclass(BossBehaviorLaser,BossBehavior);BossBehaviorLaser.ST_INTRO=1;BossBehaviorLaser.ST_FOLLOW=2;BossBehaviorLaser.ST_WAIT=3;BossBehaviorLaser.ST_ATTACK=4;BossBehaviorLaser.prototype.free=function(){BossBehavior.prototype.free.call(this)};
BossBehaviorLaser.prototype.bossOnEndAnimation=function(a){switch(a){case ScrollBoss.ST_TAUNT:this.boss.gotoState(ScrollBoss.ST_STAND);this.state=BossBehaviorLaser.ST_FOLLOW;break;case ScrollBoss.ST_PRE_SHOT:this.boss.gotoState(ScrollBoss.ST_SHOT),this.state=BossBehaviorLaser.ST_ATTACK,this.repeats--}};
BossBehaviorLaser.prototype.update=function(a){switch(this.state){case BossBehaviorLaser.ST_INTRO:this.x-=.25*a;this.x<=this.xIntro&&(this.boss.gotoState(ScrollBoss.ST_TAUNT),this.state=BossBehaviorLaser.ST_WAIT,this.move=new MoveRandom(this.x,this.y,.02,10),this.time=0);break;case BossBehaviorLaser.ST_FOLLOW:var b=this.y-150;if(this.player.m_y<b-10||this.player.m_y>b+10)this.y+=this.speedFollow*a*(this.player.m_y>b?1:-1);this.time+=a;900<this.y&&(this.y=900);330>this.y&&(this.y=330);this.time>=this.timeFollow-
2E3&&this.boss.fxCharge.setPause(!1);this.move&&this.move.update(a);this.time>=this.timeFollow&&(this.boss.fxCharge.setPause(!0),this.boss.gotoState(ScrollBoss.ST_PRE_SHOT),this.state=BossBehaviorLaser.ST_WAIT,this.time=0);break;case BossBehaviorLaser.ST_ATTACK:if(this.time+=a,this.time>this.timeAttack)if(a=this.world.createEffect("mcBoss_shot_out",this.boss.m_x,this.boss.m_y,1,this.world.getLayer("static_front").canvas),a.clip.scale.x=a.clip.scale.y=ScrollBoss.SCALE,0>=this.repeats)this.boss.onEndBehavior(this);
else this.boss.gotoState(ScrollBoss.ST_STAND),this.state=BossBehaviorLaser.ST_FOLLOW,this.move=new MoveRandom(this.x,this.y,.02,10),this.time=0}};
function BossBehaviorSummon(a){BossBehavior.call(this,a);this.type=BossBehavior.TYPE_SUMMON;this.xIntro=window.innerWidth/Layout.scale-230;this.yIntro=600;this.movexy=new XYMovement;var b=this.xIntro-this.boss.getX(),c=this.yIntro-this.boss.getY();a=Math.sqrt(b*b+c*c);b=Math.atan2(c,b);this.movexy.set(this.boss.getX(),this.boss.getY(),.2,b);this.movexy.distanceAlive=a;this.state=BossBehaviorSummon.ST_TO_INIT;this.moverandom=null}Application.subclass(BossBehaviorSummon,BossBehavior);
BossBehaviorSummon.ST_TO_INIT=1;BossBehaviorSummon.ST_WAIT=2;BossBehaviorSummon.ST_DIZZY=3;BossBehaviorSummon.prototype.bossOnEndAnimation=function(a){switch(a){case ScrollBoss.ST_SUMMON:this.boss.gotoState(ScrollBoss.ST_STAND);this.boss.waitInsertSection=!0;break;case ScrollBoss.ST_HIT:this.boss.gotoState(ScrollBoss.ST_DIZZY),this.state=BossBehaviorSummon.ST_DIZZY}};BossBehaviorSummon.prototype.onEndSummonSection=function(){this.boss.state()!==ScrollBoss.ST_DIZZY&&(this.time=0,this.state=BossBehaviorSummon.ST_WAIT)};
BossBehaviorSummon.prototype.update=function(a){this.time+=a;switch(this.state){case BossBehaviorSummon.ST_TO_INIT:this.movexy&&(this.movexy.update(a),this.x=this.movexy.x,this.y=this.movexy.y,this.x>this.xIntro-15&&this.x<this.xIntro+15&&this.y>this.yIntro-15&&this.y<this.yIntro+15&&(this.time=0,this.state=BossBehaviorSummon.ST_WAIT));break;case BossBehaviorSummon.ST_WAIT:1500<this.time&&(Application.instance.playSound("SND_BOSS_ROCKET_SUMMON"),this.boss.gotoState(ScrollBoss.ST_SUMMON),this.world.game.enviroment.bossEndIntro(),
this.state=BossBehavior.ST_NONE);break;case BossBehaviorSummon.ST_DIZZY:this.x-=.35*a,-200>this.x&&(this.boss.gotoState(ScrollBoss.ST_STAND),this.x=window.innerWidth/Layout.scale+200,this.y=this.yIntro,this.state=BossBehaviorSummon.ST_TO_INIT,this.movexy.set(this.x,this.y,.2,Math.PI))}};
function BossBehaviorIntro(a){BossBehavior.call(this,a);this.type=BossBehavior.TYPE_INTRO;this.x=window.innerWidth/Layout.scale+200;this.y=600;this.xIntro=this.x-400;this.boss.gotoState(ScrollBoss.ST_STAND);this.boss.setPosition(this.x,this.y);this.state=BossBehaviorIntro.ST_TO_INIT}Application.subclass(BossBehaviorIntro,BossBehavior);BossBehaviorIntro.showFirstTime=!1;BossBehaviorIntro.ST_TO_INIT=1;BossBehaviorIntro.ST_DIALOG=2;BossBehaviorIntro.ST_EXIT=3;BossBehaviorIntro.ST_WAIT_PLAYER_MOVE=4;
BossBehaviorIntro.prototype.bossOnEndAnimation=function(a){switch(a){case ScrollBoss.ST_TAUNT:ScrollGame.instance.intro.addDialog("DIAG_BOSS");this.boss.gotoState(ScrollBoss.ST_SUMMON);break;case ScrollBoss.ST_SUMMON:Application.instance.effectManager.createEffect("fxTransition",window.innerWidth/Layout.scale*.5,500,this.world.getLayer("static_front").canvas),Application.instance.effectManager.createEffect("fxBossMidDefeat",this.boss.m_x,this.boss.m_y-100,this.world.getLayer("static_front").canvas),
this.world.game.enviroment.bossEndIntro(),Application.instance.playSound("SND_SCN_CHANGE"),this.world.game.hud().showHand(!0),this.state=BossBehaviorIntro.ST_EXIT,this.boss.gotoState(ScrollBoss.ST_HIDE),this.time=0,this.world.game.onShake(800,8),BossBehaviorIntro.showFirstTime=!0}};
BossBehaviorIntro.prototype.forceEnd=function(){this.world.game.enviroment.bossEndIntro();this.world.game.hud().showHand(!0);this.state=BossBehaviorIntro.ST_EXIT;this.boss.gotoState(ScrollBoss.ST_HIDE);this.time=0;BossBehaviorIntro.showFirstTime=!0};
BossBehaviorIntro.prototype.update=function(a){this.time+=a;switch(this.state){case BossBehaviorIntro.ST_TO_INIT:this.world.game.hud().showHand(!1);this.x-=.2*a;this.x<=this.xIntro&&(this.state=BossBehavior.ST_NONE,this.boss.gotoState(ScrollBoss.ST_TAUNT));break;case BossBehaviorIntro.ST_EXIT:1E3<this.time&&(this.state=BossBehaviorIntro.ST_WAIT_PLAYER_MOVE);break;case BossBehaviorIntro.ST_WAIT_PLAYER_MOVE:if(-2E3>this.world.getLayer("player").canvas.position.x)this.boss.onEndBehavior(this)}};
function BossBulletHand(a,b,c,d,e){ScrollActor.call(this,a,b,c,d,e);this.bossBullet=!0;this.timeStand=this.speedHand=0;this.m_character=new Character(0,0,this.m_canvas);this.m_character.addState(BossBulletHand.ST_APPEAR,"mcBossHand_appear");this.m_character.addState(BossBulletHand.ST_STAND,"mcBossHand_stand");this.m_character.addState(BossBulletHand.ST_ATTACK,"mcBossHand_attack");this.m_character.addState(BossBulletHand.ST_PRE_ATTACK,"mcBossHand_pre_attack");this.m_character.onEndAnimation(this,this.onEndAnimation);
this.gotoState(BossBulletHand.ST_APPEAR);this.update(0);this.fxSmoke=this.world.createEffect("fxHandSmoke",400,-20,1,this.m_canvas);this.use=!1}Application.subclass(BossBulletHand,ScrollActor);BossBulletHand.ST_APPEAR="appear";BossBulletHand.ST_STAND="stand";BossBulletHand.ST_PRE_ATTACK="pre_attack";BossBulletHand.ST_ATTACK="attack";BossBulletHand.prototype.free=function(){this.fxSmoke&&(this.fxSmoke.isAwaitingDelete=!0,this.fxSmoke=null);ScrollActor.prototype.free.call(this)};
BossBulletHand.prototype.onCollisionActor=function(a,b){this.use||(this.world.createEffect("fxPlayerHit",this.m_x,this.m_y,1,this.world.getLayer("static_front").canvas),this.world.game.player.onHit(0),this.use=!0);return!0};BossBulletHand.prototype.onEndAnimation=function(a){switch(a){case BossBulletHand.ST_APPEAR:this.gotoState(BossBulletHand.ST_STAND);break;case BossBulletHand.ST_PRE_ATTACK:Application.instance.playSound("SND_BOSS_ROCKET_SHOOT"),this.gotoState(BossBulletHand.ST_ATTACK)}};
BossBulletHand.prototype.update=function(a){ScrollActor.prototype.update.call(this,a);switch(this.m_state){case BossBulletHand.ST_STAND:this.m_canvas.position.x+=Common.random(-5,5);this.m_canvas.position.y+=Common.random(-5,5);this.timeStand-=a;0>=this.timeStand&&(Application.instance.playSound("SND_BOSS_ROCKET_LOAD"),this.gotoState(BossBulletHand.ST_PRE_ATTACK));break;case BossBulletHand.ST_PRE_ATTACK:this.m_canvas.position.x+=Common.random(-5,5);this.m_canvas.position.y+=Common.random(-5,5);break;
case BossBulletHand.ST_ATTACK:this.m_x-=this.speedHand*a}-300>this.m_x&&(this.m_isAwaitingDelete=!0)};function Global(){}Global.baseScale=1;Global.minScale=1;Global.maxScale=1;Global.offsetZoomX=0;Global.offsetZoomY=0;Global.data=null;Global.game=null;Global.typeGame=1;Global.level=1;Global.oldCurrentMission=0;Global.oldMission=0;Global.idTitle=1;Global.valueStylish=0;Global.loaded_gameplay_assets=[];Global.sound_content=[0];Global.sound_elements=[0];Global.sound_gameplay=[[1]];
Global.TRANSITION_NORMAL_IN="gui_transition_in";Global.TRANSITION_NORMAL_OUT="gui_transition_out";Global.TRANSITION_SPECIAL_IN="gui_transition02_in";Global.TRANSITION_SPECIAL_OUT="gui_transition02_out";Global.createBossLevelCheat=!1;Global.trackIsContinue=!1;function Cheats(){}Cheats.enabled=Application.USE_CHEATS;Cheats.EVENT_ON_WIN="onWin";Cheats.EVENT_ON_LOSE="onLose";Cheats.EVENT_GET_MISSION_1="get_mission_1";Cheats.EVENT_GET_MISSION_2="get_mission_2";Cheats.EVENT_GET_MISSION_3="get_mission_3";
Cheats.EVENT_ON_TOGGLE_COLLISION="toggleCollision";Cheats.EVENT_ENABLE_MOUSECONTROL="enabledMouseControl";Cheats.events=[Cheats.EVENT_ON_TOGGLE_COLLISION,Cheats.EVENT_ON_WIN,Cheats.EVENT_ON_LOSE,Cheats.EVENT_GET_MISSION_1,Cheats.EVENT_GET_MISSION_2,Cheats.EVENT_GET_MISSION_3];
Cheats.onEvent=function(a){if(Cheats.enabled){switch(a){case Cheats.EVENT_ON_WIN:Global.game&&GuiGame.instance.addPopup(GuiPopupEndRun,"mcGuiPopupsEndRun1",0,0);break;case Cheats.EVENT_GET_MISSION_1:if(Global.game)Global.game.missions.onCheatsMission(0);break;case Cheats.EVENT_GET_MISSION_2:if(Global.game)Global.game.missions.onCheatsMission(1);break;case Cheats.EVENT_GET_MISSION_3:if(Global.game)Global.game.missions.onCheatsMission(2);break;case Cheats.EVENT_ON_TOGGLE_COLLISION:Application.instance.canvas.toggleCollision(),
Global.game&&Global.game.toggleDebugCollision&&Global.game.toggleDebugCollision()}Application.info("[CHEAT] "+a)}};Cheats.onKeyDown=function(a){};
function DataManager(){this.m_levelRegisters=[];this.m_globalRegisters=[];this.totalLevels=1;for(var a=0;a<this.totalLevels;++a){this.m_levelRegisters.push([]);for(var b=0;b<DataManager.TOTAL_LEVEL_REGISTERS;++b)this.m_levelRegisters[a].push(0)}for(a=0;a<DataManager.TOTAL_REGISTERS;++a)this.m_globalRegisters.push(0);this.loadData();DataManager.instance=this}DataManager.instance=null;DataManager.DATA_VERSION=4;DataManager.KEY_VERSION="switDataSpiderIntoV";DataManager.KEY_REGISTERS="switDataSpiderIntoR";
DataManager.REG_ACHIEVEMENT_1=0;DataManager.REG_ACHIEVEMENT_2=1;DataManager.REG_ACHIEVEMENT_3=2;DataManager.REG_ACHIEVEMENT_4=3;DataManager.REG_ACHIEVEMENT_5=4;DataManager.REG_ACHIEVEMENT_6=5;DataManager.REG_TUTORIAL_DRONE=6;DataManager.REG_TUTORIAL_LAUNCH=7;DataManager.REG_TUTORIAL_PAUSE=8;DataManager.REG_TUTORIAL_GRAB=9;DataManager.REG_CUTSCENE_INIT=10;DataManager.REG_CUTSCENE_END=11;DataManager.REG_MISSION_GAME_1=12;DataManager.REG_MISSION_GAME_2=13;DataManager.REG_MISSION_GAME_3=14;
DataManager.REG_MISSION_GAME_4=15;DataManager.REG_MISSION_GAME_5=16;DataManager.REG_MISSION_GAME_6=17;DataManager.REG_MISSION_GAME_7=18;DataManager.REG_MISSION_GAME_8=19;DataManager.REG_MISSION_GAME_9=20;DataManager.REG_MISSION_GAME_10=21;DataManager.REG_MISSION_GAME_11=22;DataManager.REG_MISSION_GAME_12=23;DataManager.REG_MISSION_GAME_13=24;DataManager.REG_MISSION_GAME_14=25;DataManager.REG_MISSION_GAME_15=26;DataManager.REG_MISSION_GAME_16=27;DataManager.REG_MISSION_GAME_17=28;
DataManager.REG_MISSION_GAME_18=29;DataManager.REG_MISSION_GAME_19=30;DataManager.REG_MISSION_GAME_20=31;DataManager.REG_MISSION_GAME_21=32;DataManager.REG_MISSION_GAME_22=33;DataManager.REG_MISSION_GAME_23=34;DataManager.REG_MISSION_GAME_24=35;DataManager.REG_MISSION_GAME_25=36;DataManager.REG_ALL_MISSIONS=37;DataManager.REG_STORE_UPGRAGE_1=38;DataManager.REG_STORE_UPGRAGE_2=39;DataManager.REG_STORE_UPGRAGE_3=40;DataManager.REG_STORE_UPGRAGE_4=41;DataManager.REG_STORE_UPGRAGE_5=42;
DataManager.REG_TOTAL_COINS=43;DataManager.REG_DISTANCE_RECORD=44;DataManager.REG_ALL_COINS=45;DataManager.REG_DEFEAT_MYSTERIO=46;DataManager.TOTAL_REGISTERS=47;DataManager.REG_LEVEL_MISSION_1=0;DataManager.REG_LEVEL_MISSION_2=1;DataManager.REG_LEVEL_MISSION_3=2;DataManager.TOTAL_LEVEL_REGISTERS=3;DataManager.prototype.free=function(){this.m_globalRegisters=this.m_levelRegisters=null;DataManager.instance=null};
DataManager.prototype.setGlobalRegister=function(a,b){if(this.validateGlobalRegister(a))return this.m_globalRegisters[a]=b,!0;Application.error("DataManager::setGlobalRegister() - Invalid register: "+a);return!1};DataManager.prototype.getGlobalRegister=function(a){if(this.validateGlobalRegister(a))return this.m_globalRegisters[a];Application.error("DataManager::getGlobalRegister() - Invalid register: "+a);return 0};
DataManager.prototype.setLevelRegister=function(a,b,c){if(this.validateLevelRegister(b,a))return this.m_levelRegisters[b][a]=c,!0;Application.error("DataManager::setLevelRegister() - Invalid register: "+a);return!1};DataManager.prototype.getLevelRegister=function(a,b){if(this.validateLevelRegister(b,a))return this.m_levelRegisters[b][a];Application.error("DataManager::getLevelRegister() - Invalid register: "+a);return 0};
DataManager.prototype.validateLevelRegister=function(a,b){return 0<=a&&a<this.totalLevels&&0<=b&&b<DataManager.TOTAL_LEVEL_REGISTERS};DataManager.prototype.validateGlobalRegister=function(a){return 0<=a&&a<DataManager.TOTAL_REGISTERS};DataManager.prototype.resetData=function(){this.clearRegisters();this.saveData()};
DataManager.prototype.saveData=function(){var a="",b,c;for(b=0;b<DataManager.TOTAL_REGISTERS;++b)a+=this.m_globalRegisters[b],b<DataManager.TOTAL_REGISTERS-1&&(a+="|");a+="^";for(b=0;b<this.totalLevels;++b){for(c=0;c<DataManager.TOTAL_LEVEL_REGISTERS;++c)a+=this.m_levelRegisters[b][c],c<DataManager.TOTAL_LEVEL_REGISTERS-1&&(a+=",");b<this.totalLevels-1&&(a+="|")}Common.saveData(DataManager.KEY_REGISTERS,a);Application.log("DataManager::saveData() - data: "+a)};
DataManager.prototype.loadData=function(){var a=~~Common.loadData(DataManager.KEY_VERSION,"0");if(a!==DataManager.DATA_VERSION)Application.warn("DataManager::loadData() - incompatible version: "+a),Common.saveData(DataManager.KEY_VERSION,""+DataManager.DATA_VERSION),this.resetData();else{a=Common.loadData(DataManager.KEY_REGISTERS,"");Application.log("DataManager::loadData() - data: "+a);var b=a.split("^");if(!(2>b.length)){var c;a=b[0].split("|");for(c=0;c<a.length;++c)this.m_globalRegisters[c]=
~~a[c];a=b[1].split("|");for(c=0;c<a.length;++c){var d=a[c].split(",");for(b=0;b<d.length;++b)this.m_levelRegisters[c][b]=~~d[b]}}}};DataManager.prototype.clearRegisters=function(){for(var a=0;a<this.totalLevels;++a)for(var b=0;b<DataManager.TOTAL_LEVEL_REGISTERS;++b)this.m_levelRegisters[a][b]=0;for(a=DataManager.TOTAL_REGISTERS-1;0<=a;--a)this.m_globalRegisters[a]=0};
function ZoomManager(a,b){this.m_canvas=a;this.m_mode=ZoomManager.MODE_NONE;this.m_game=b;this.m_zoomDisplaceYSpeed=this.m_zoomDisplaceXSpeed=this.m_zoomDisplaceYGoal=this.m_zoomDisplaceXGoal=this.m_zoomDisplaceTime=this.m_timeOut=this.m_timeIn=this.m_zoomOutSpeed=this.m_zoomInSpeed=this.m_factorY=this.m_factorX=0;this.m_returEnabled=!1;this.m_stayTime=0;this.m_zoomInInterpolator=this.m_zoomOutInterpolator=null;a=this.m_game.world.camera().width()/2;b=this.m_game.world.camera().height()/2;this.m_x=
a*Global.baseScale;this.m_y=b*Global.baseScale;this.m_rotation=this.m_initAngle=Math.atan2(this.m_y,this.m_x);this.m_turningRadius=Math.sqrt(this.m_x*this.m_x+this.m_y*this.m_y);this.m_rotationSpeed=.002*Math.random();Application.config.settings.rotationInZoomEnabled&&(ZoomManager.ROTATION_ENABLED=Application.config.settings.rotationInZoomEnabled);this.m_mode=ZoomManager.MODE_ZOOM_FOLLOW;this.m_endInterpolatorCallback=this.m_endInterpolatorCaller=this.m_actorToFollow=this.m_valFollowInterpolatorLinear=
this.m_valFollowInterpolator=null;this.m_lastInterpolatorValue=-1}ZoomManager.DEFAULT_TIME=500;ZoomManager.ROTATION_ENABLED=!1;ZoomManager.prototype.setEndInterpolatorCallback=function(a,b){this.m_endInterpolatorCaller=a;this.m_endInterpolatorCallback=b};
ZoomManager.prototype.free=function(){this.m_zoomInInterpolator=this.m_zoomOutInterpolator=this.m_actorToFollow=this.m_game=null;this.m_valFollowInterpolator&&(ElasticInterpolation.disposeObject(this.m_valFollowInterpolator),this.m_valFollowInterpolator=null);this.m_valFollowInterpolatorLinear&&(LinearInterpolation.disposeObject(this.m_valFollowInterpolatorLinear),this.m_valFollowInterpolatorLinear=null);this.m_canvas=this.m_endInterpolatorCallback=this.m_endInterpolatorCaller=null;this.m_mode=ZoomManager.MODE_NONE};
ZoomManager.prototype.setParams=function(a,b,c,d,e){e="undefined"!==typeof e?e:0;a="undefined"!==typeof a?a:ZoomManager.DEFAULT_TIME;b="undefined"!==typeof b?b:ZoomManager.DEFAULT_TIME;c="undefined"!==typeof c?c:ZoomManager.DEFAULT_TIME;this.m_mode===ZoomManager.MODE_NONE&&(this.m_factorX=this.limitFactors("undefined"!==typeof d?d:0,!0),this.m_factorY=this.limitFactors(e,!1),this.m_timeIn=a,this.m_timeOut=b,this.m_zoomInSpeed=(Global.maxScale-Global.minScale)/a,this.m_zoomOutSpeed=(-Global.maxScale+
Global.minScale)/b,this.m_stayTime=c)};ZoomManager.prototype.onDisplaceXY=function(a,b,c){this.m_mode===ZoomManager.MODE_NONE&&(this.m_zoomDisplaceTime=a,this.m_zoomDisplaceXGoal=this.limitFactors(b,!0),this.m_zoomDisplaceYGoal=this.limitFactors(c,!1),this.m_zoomDisplaceXSpeed=(this.m_zoomDisplaceXGoal-this.m_factorX)/a,this.m_zoomDisplaceYSpeed=(this.m_zoomDisplaceYGoal-this.m_factorY)/a,this.m_mode=ZoomManager.MODE_ZOOM_DISPLACE)};
ZoomManager.prototype.onZoomIn=function(a){this.m_mode===ZoomManager.MODE_NONE&&(this.m_mode=ZoomManager.MODE_ZOOM_IN);this.m_returEnabled="undefined"!==typeof a?a:!1;ZoomManager.ROTATION_ENABLED&&(this.m_rotationSpeed=2*Math.PI/this.m_timeIn);this.m_zoomInInterpolator=ZoomManager.ROTATION_ENABLED?ExponentialInterpolation.create(Global.baseScale,Global.maxScale,this.m_timeIn,10,0):ElasticInterpolation.create(Global.baseScale,Global.maxScale,this.m_timeIn,.2,2,0);this.m_zoomInInterpolator.onEndInterpolation(this,
this.onEndZoomIn)};ZoomManager.prototype.onZoomOut=function(){this.m_mode===ZoomManager.MODE_NONE&&(this.m_mode=ZoomManager.MODE_ZOOM_OUT);ZoomManager.ROTATION_ENABLED&&(this.m_rotationSpeed=-2*Math.PI/this.m_timeOut);this.m_zoomOutInterpolator=ExponentialInterpolation.create(Global.maxScale,Global.minScale,this.m_timeOut,10,0);this.m_zoomOutInterpolator.onEndInterpolation(this,this.onEndZoomOut)};
ZoomManager.prototype.onEndZoomIn=function(){ZoomManager.ROTATION_ENABLED&&(this.m_rotation=this.m_initAngle);Global.baseScale=Global.maxScale;this.m_mode=ZoomManager.MODE_NONE;0<this.m_stayTime?this.m_mode=ZoomManager.MODE_ZOOM_STAND_IN_ZOOM:this.m_returEnabled&&(this.onZoomOut(),this.m_returEnabled=!1)};ZoomManager.prototype.onEndZoomOut=function(){ZoomManager.ROTATION_ENABLED&&(this.m_rotation=this.m_initAngle);Global.baseScale=Global.minScale;this.m_mode=ZoomManager.MODE_NONE};
ZoomManager.prototype.update=function(a){switch(this.m_mode){case ZoomManager.MODE_ZOOM_STAND_IN_ZOOM:this.m_stayTime-=a;0>this.m_stayTime&&(this.m_stayTime=0,this.m_mode=ZoomManager.MODE_ZOOM_OUT,this.m_zoomOutInterpolator=ExponentialInterpolation.create(Global.maxScale,Global.minScale,this.m_timeOut,10,0),this.m_zoomOutInterpolator.onEndInterpolation(this,this.onEndZoomOut),ZoomManager.ROTATION_ENABLED&&(this.m_rotationSpeed=-2*Math.PI/this.m_timeOut));break;case ZoomManager.MODE_ZOOM_IN:ZoomManager.ROTATION_ENABLED&&
(this.m_rotation+=this.m_rotationSpeed*a);this.m_zoomInInterpolator.update(a);Global.baseScale=this.m_zoomInInterpolator.value();this.updateScale();break;case ZoomManager.MODE_ZOOM_DISPLACE:this.m_zoomDisplaceTime-=a;0>=this.m_zoomDisplaceTime?(this.m_factorX=this.m_zoomDisplaceXGoal,this.m_factorY=this.m_zoomDisplaceYGoal,this.m_mode=ZoomManager.MODE_NONE):(this.m_factorX+=a*this.m_zoomDisplaceXSpeed,this.m_factorY+=a*this.m_zoomDisplaceYSpeed);this.updateScale();break;case ZoomManager.MODE_ZOOM_OUT:ZoomManager.ROTATION_ENABLED&&
(this.m_rotation+=this.m_rotationSpeed*a);this.m_zoomOutInterpolator.update(a);Global.baseScale=this.m_zoomOutInterpolator.value();this.updateScale();break;case ZoomManager.MODE_ZOOM_FOLLOW:this.getFollowInterpolator()&&(Global.baseScale=this.getFollowInterpolator().value()*(Global.minScale-Global.maxScale)+Global.maxScale,this.getFollowInterpolator().update(a)),this.m_actorToFollow?this.updatePosition(this.m_actorToFollow.getX(),this.m_actorToFollow.getY()):this.updatePosition(0,0)}};
ZoomManager.prototype.limitFactors=function(a,b){var c=(1-Global.minScale/Global.maxScale)/2;b?(b=this.m_game.world.camera().getX()+this.m_game.world.camera().width()*c,c=b+Global.minScale/Global.maxScale*this.m_game.world.camera().width()):(b=this.m_game.world.camera().getY()+this.m_game.world.camera().height()*c,c=b+Global.minScale/Global.maxScale*this.m_game.world.camera().height());return 0===a?.5:a<=b?0:a>=c?1:(a-b)/(c-b)};
ZoomManager.prototype.updateScale=function(){this.m_game&&(this.m_canvas.scale.x=Global.baseScale,this.m_canvas.scale.y=Global.baseScale,Global.offsetZoomX=-this.m_factorX*(Global.baseScale-Global.minScale)*this.m_game.world.camera().width(),Global.offsetZoomY=-this.m_factorY*(Global.baseScale-Global.minScale)*this.m_game.world.camera().height(),ZoomManager.ROTATION_ENABLED?(this.m_canvas.rotation=this.m_rotation-this.m_initAngle,this.m_canvas.position.x=Global.offsetZoomX-Layout.left/Layout.scale+
this.m_x-this.m_turningRadius*Math.cos(this.m_rotation),this.m_canvas.position.y=Global.offsetZoomY-Layout.top/Layout.scale+this.m_y-this.m_turningRadius*Math.sin(this.m_rotation)):Application.WIDE_SCREEN?(this.m_canvas.position.x=Global.offsetZoomX-Layout.left/Layout.scale,this.m_canvas.position.y=Global.offsetZoomY-Layout.top/Layout.scale):(this.m_canvas.position.x=Global.offsetZoomX,this.m_canvas.position.y=Global.offsetZoomY))};
ZoomManager.prototype.setValueToFollowElastic=function(a,b){1<a&&(a=1);0>a&&(a=0);this.m_valFollowInterpolator=ElasticInterpolation.create(this.m_valFollowInterpolator?this.m_valFollowInterpolator.value():this.m_valFollowInterpolatorLinear?this.m_valFollowInterpolator.value():-1!==this.m_lastInterpolatorValue?this.m_lastInterpolatorValue:0,a,b,.001,0,0);this.m_valFollowInterpolatorLinear&&(LinearInterpolation.disposeObject(this.m_valFollowInterpolatorLinear),this.m_valFollowInterpolatorLinear=null);
this.m_valFollowInterpolator.onEndInterpolation(this,this.onEndInterpolation);this.m_valFollowInterpolator.update(0)};
ZoomManager.prototype.setValueToFollowLinear=function(a,b){1<a&&(a=1);0>a&&(a=0);this.m_valFollowInterpolatorLinear&&LinearInterpolation.disposeObject(this.m_valFollowInterpolatorLinear);this.m_valFollowInterpolatorLinear=LinearInterpolation.create(-1!==this.m_lastInterpolatorValue?this.m_lastInterpolatorValue:this.m_valFollowInterpolatorLinear?this.m_valFollowInterpolatorLinear.value():0,a,b,0);-1!==this.m_lastInterpolatorValue&&(this.m_lastInterpolatorValue=-1);this.m_valFollowInterpolatorLinear.update(0)};
ZoomManager.prototype.getFollowInterpolator=function(){return this.m_valFollowInterpolator?this.m_valFollowInterpolator:this.m_valFollowInterpolatorLinear};ZoomManager.prototype.setActorToFollow=function(a){this.m_actorToFollow=a};
ZoomManager.prototype.onEndInterpolation=function(a){this.m_endInterpolatorCallback&&this.m_endInterpolatorCaller&&this.m_endInterpolatorCallback.call(this.m_endInterpolatorCaller);this.m_lastInterpolatorValue=a.value();ElasticInterpolation.disposeObject(a);this.m_valFollowInterpolator=null};ZoomManager.prototype.updatePosition=function(a,b){this.m_factorX=this.limitFactors(a,!0);this.m_factorY=this.limitFactors(b,!1);this.updateScale()};
ZoomManager.prototype.setDynamicScale=function(a,b,c,d){1<c&&(c=1);0>c&&(c=0);d/=10;d<-Math.PI/18&&(d=-Math.PI/18);d>Math.PI/18&&(d=Math.PI/18);this.m_rotation=this.m_initAngle+d;c*=1-Math.abs(18*d/Math.PI);Global.baseScale=c*(Global.minScale-Global.maxScale)+Global.maxScale;this.updatePosition(a,b)};ZoomManager.MODE_NONE=0;ZoomManager.MODE_ZOOM_IN=1;ZoomManager.MODE_ZOOM_DISPLACE=2;ZoomManager.MODE_ZOOM_OUT=3;ZoomManager.MODE_ZOOM_STAND_IN_ZOOM=4;ZoomManager.MODE_ZOOM_FOLLOW=5;
function DialogueContent(a){this.clip=Application.instance.addDisplayContainer();this.guiParent=a;this.m_currentNode=null;this.m_lastSide=0;this.m_dialogueNodes=this.guiParent.dialogueNodes}DialogueContent.SIDE_LEFT=1;DialogueContent.SIDE_RIGHT=2;
DialogueContent.prototype.next=function(){0===this.m_dialogueNodes.length?(this.guiParent.showNameLeft(""),this.guiParent.showNameRight(""),this.guiParent.clearInfo(),this.guiParent.onResumeScreen()):(this.m_currentNode=this.m_dialogueNodes.splice(0,1)[0],this.m_currentNode.side===DialogueContent.SIDE_LEFT?(this.guiParent.showNameLeft(this.m_currentNode.strTitle),this.guiParent.showNameRight("")):(this.guiParent.showNameLeft(""),this.guiParent.showNameRight(this.m_currentNode.strTitle)),this.m_lastSide=
this.m_currentNode.side,this.guiParent.setInfo(this.m_currentNode.str))};DialogueContent.prototype.free=function(){this.m_dialogueNodes=null};function DialogueNode(){this.strTitle=this.str="";this.side=0}DialogueNode.ALIGN_LEFT=1;DialogueNode.ALIGN_RIGTH=2;
DialogueNode.getDialogueNodes=function(a){var b=[],c=window.config.dialogues,d;for(d in c)if(c[d].idData.toUpperCase()==a.toUpperCase()){var e=new DialogueNode;e.str=c[d].string.toUpperCase();e.strTitle=c[d].title.toUpperCase();e.side=parseInt(c[d].side,10);b.push(e)}return b};DialogueNode.exists=function(a){var b=window.config.dialogues,c;for(c in b)if(b[c].idData.toUpperCase()==a.toUpperCase())return!0;return!1};
function GuiDialogue(a,b,c,d){SScreen.call(this,a,b,c,d);this.setInteractive(!0);this.m_idDialog="";this.m_callback=this.m_caller=this.callbackClose=this.dialogue=null;this.delayNext=99999;this.dialogueNodes=null;this.getControl("mcGuiTextName01").setTextEmpty();this.getControl("mcGuiTextName02").setTextEmpty();this.getControl("mcGuiTextName01_s").setTextEmpty();this.getControl("mcGuiTextName02_s").setTextEmpty();this.getControl("mcGuiTextTap").setTextEmpty()}Application.subclass(GuiDialogue,SScreen);
GuiDialogue.FRAME_STOP_TITLE=10;GuiDialogue.DELAY_TIME_NEXT=1500;GuiDialogue.SPEED_APPEAR_INFO=.0015;GuiDialogue.prototype.initDialogue=function(a){this.m_idDialog=a;this.dialogueNodes=DialogueNode.getDialogueNodes(this.m_idDialog);this.clearInfo()};GuiDialogue.prototype.onComplete=function(a,b){this.m_caller=a;this.m_callback=b};
GuiDialogue.prototype.onStopScreen=function(){SScreen.prototype.onStopScreen.call(this);this.delayNext=GuiDialogue.DELAY_TIME_NEXT;this.dialogue=new DialogueContent(this);this.dialogue.next();this.activePressBar()};GuiDialogue.prototype.onFinishScreen=function(){SScreen.prototype.onFinishScreen.call(this);this.m_caller&&this.m_callback&&this.m_callback.call(this.m_caller);ScrollGame.instance.intro.state=GameIntro.ST_NONE;this.screenParent&&this.screenParent.dropPopup()};
GuiDialogue.prototype.onPointerPress=function(a){0>this.delayNext&&(this.delayNext=GuiDialogue.DELAY_TIME_NEXT,this.getControl("mcGuiTextTap").setTextEmpty(),this.dialogue.next())};GuiDialogue.prototype.onPressSpaceBar=function(){SScreen.prototype.onPressSpaceBar.call(this);this.onPointerPress(null)};GuiDialogue.prototype.setInfo=function(a){this.clearInfo();this.getControl("mcGuiTextDialogue").setTextLocalized(a);this.getControl("mcGuiTextDialogue").textfield.alpha=0};
GuiDialogue.prototype.clearInfo=function(){this.getControl("mcGuiTextDialogue").setTextEmpty()};GuiDialogue.prototype.showNameLeft=function(a){""===a?(this.getControl("mcGuiTextName01").setTextEmpty(),this.getControl("mcGuiTextName01_s").setTextEmpty()):(this.getControl("mcGuiTextName01").setTextLocalized(a),this.getControl("mcGuiTextName01_s").setTextLocalized(a))};
GuiDialogue.prototype.showNameRight=function(a){""===a?(this.getControl("mcGuiTextName02").setTextEmpty(),this.getControl("mcGuiTextName02_s").setTextEmpty()):(this.getControl("mcGuiTextName02").setTextLocalized(a),this.getControl("mcGuiTextName02_s").setTextLocalized(a))};
GuiDialogue.prototype.update=function(a){this.delayNext-=a;if(0>this.delayNext){var b=Application.instance.isMobileDevice?"STR_REP_DIALOGUE_TAP":"STR_REP_DIALOGUE_TAP_PC";this.getControl("mcGuiTextTap").setTextLocalized(b);this.activePressBar()}this.getControl("mcGuiTextDialogue").textfield.alpha+=GuiDialogue.SPEED_APPEAR_INFO*a;SScreen.prototype.update.call(this,a)};
function GuiLoader(a,b,c,d,e,f,g,h){SLoaderScreen.call(this,a,b,c,d,e,f,g,h);GuiLoader.instance=this;this.mcGuiLoaderFill=null;this.controls.mcGuiBar&&(this.mcGuiLoaderFill=this.getControl("mcGuiBar"),this.mcGuiLoaderFill.clip.scale.y=1-e/100);GuiLoader.doneFirstLoader=!0}Application.subclass(GuiLoader,SLoaderScreen);GuiLoader.instance=null;GuiLoader.doneFirstLoader=!1;GuiLoader.prototype.free=function(){this.mcGuiLoaderFill=null;GuiLoader.instance=null;SLoaderScreen.prototype.free.call(this)};
GuiLoader.prototype.onFileLoaded=function(){SLoaderScreen.prototype.onFileLoaded.call(this);var a=this.m_start;a+=this.m_loadedfiles/this.m_totalFiles*(this.m_end-this.m_start);a=parseInt(a,10);this.mcGuiLoaderFill&&(this.mcGuiLoaderFill.clip.scale.y=1-a/100);Application.info("onLoadProgress > "+this.m_loadedfiles+" of "+this.m_totalFiles+" percent : "+a+"%")};
GuiLoader.prototype.onFinishScreen=function(){SScreen.prototype.onFinishScreen.call(this);"mcGuiBtnNext"===this.lastInteractionControl&&(Application.instance.playSound("MUSIC_MAINMENU"),GuiManager.instance.gotoScreen(this.m_nextScreen))};GuiLoader.prototype.onUIPress=function(a){Application.instance.fullScreen();Application.instance.playSound("SND_UI_CLICK");this.lastInteractionControl=a.name;SLoaderScreen.prototype.onUIPress.call(this,a)};
GuiLoader.prototype.onUIRelease=function(a){try{"suspended"===createjs.WebAudioPlugin.context.state&&createjs.WebAudioPlugin.context.resume()}catch(b){Application.error("There was an error while trying to resume the SoundJS Web Audio context..."),Application.error(b)}switch(a.name){case "mcGuiBtnNext":Application.instance.hideAddressBar(),Application.instance.fullScreen(),this.onResumeScreen()}};
function GuiCutscene(a,b,c,d){SScreen.call(this,a,b,c,d);Application.instance.isPlayingSound("MUSIC_MAINMENU")||Application.instance.playSound("MUSIC_MAINMENU");this.m_oldPage=this.m_page=1;this.m_idClip=0;this.m_dataCutscene=[{text:"STR_REP_CUTSCENE_INFO_1",idClip:1},{text:"STR_REP_CUTSCENE_INFO_2",idClip:1},{text:"STR_REP_CUTSCENE_INFO_3",idClip:2}];this.activePress=!0;this.m_scrollR=this.m_scrollL=this.m_clipImage=null;this.m_clipImage=this.controls.mcGuiImage;this.m_scrollL=this.controls.mcGuiBtnScrollLeft;
this.m_scrollR=this.controls.mcGuiBtnScrollRight;Application.RIGHT_TO_LEFT?this.m_scrollR.setVisible(!1):this.m_scrollL.setVisible(!1);this.m_page=1;this.getControl("mcGuiTxt").setTextLocalized(this.m_dataCutscene[this.m_page-1].text);this.m_idClip=parseInt(this.m_dataCutscene[this.m_page-1].idClip,10);this.m_clipImage.setClip("gui_screen_cutscene0"+this.m_idClip);this.m_page=this.m_oldPage;Application.instance.effectManager.createEffect("fxCutscene",0,0,this.getControl("mcContentFX").canvas);this.createTransition(Global.TRANSITION_SPECIAL_OUT,
0,0,{},this.canvas);DataManager.instance.setGlobalRegister(DataManager.REG_CUTSCENE_INIT,1);DataManager.instance.saveData()}Application.subclass(GuiCutscene,SScreen);GuiCutscene.MAX_PAGE=3;GuiCutscene.prototype.onEndTransition=function(a){SScreen.prototype.onEndTransition.call(this,a);null!==a.params&&"undefined"!==typeof a.params.screen&&GuiManager.instance.gotoScreen(a.params.screen)};GuiCutscene.prototype.onStopScreen=function(){SScreen.prototype.onStopScreen.call(this);this.activePress=!1;this.m_clipImage.clip.gotoAndPlay(2)};
GuiCutscene.prototype.callGame=function(){this.activePress=!0;this.lastInteractionControl="mcGuiBtnPlay";this.createTransition(Global.TRANSITION_SPECIAL_IN,0,0,{screen:GuiManager.SC_GAME},this.canvas)};GuiCutscene.prototype.onFinishScreen=function(){switch(this.lastInteractionControl){case "mcGuiBtnPlay":GuiManager.instance.gotoScreen(GuiManager.SC_GAME)}};
GuiCutscene.prototype.onUIRelease=function(a){if(!this.activePress)switch(SScreen.prototype.onUIRelease.call(this,a),Application.instance.playSound("SND_UI_CLICK"),a.name){case "mcGuiBtnSkip":this.callGame();break;case "mcGuiBtnScrollLeft":a=Application.RIGHT_TO_LEFT?1:2;this.nextPage(a);break;case "mcGuiBtnScrollRight":a=Application.RIGHT_TO_LEFT?2:1,this.nextPage(a)}};
GuiCutscene.prototype.nextPage=function(a){this.m_oldPage=this.m_page=1===a?this.m_page>GuiCutscene.MAX_PAGE?GuiCutscene.MAX_PAGE:this.m_page+1:1>this.m_page?1:this.m_page-1;this.m_oldPage>GuiCutscene.MAX_PAGE?(Application.RIGHT_TO_LEFT?this.m_scrollL.setVisible(!1):this.m_scrollR.setVisible(!1),this.getControl("mcGuiBtnSkip").setVisible(!1),this.callGame()):(this.getControl("mcGuiBtnSkip").setVisible(this.m_oldPage!==GuiCutscene.MAX_PAGE),Application.RIGHT_TO_LEFT?this.m_scrollR.setVisible(1!==this.m_page):
this.m_scrollL.setVisible(1!==this.m_page),a=parseInt(this.m_dataCutscene[this.m_page-1].idClip,10),a!==this.m_idClip&&(this.m_idClip=a,this.m_clipImage.setClip("gui_screen_cutscene0"+this.m_idClip),this.m_clipImage.clip.resume()),this.getControl("mcGuiTxt").setTextLocalized(this.m_dataCutscene[this.m_page-1].text),this.m_page=this.m_oldPage)};
function GuiCutsceneEnd(a,b,c,d){SScreen.call(this,a,b,c,d);Application.instance.isPlayingSound("MUSIC_MAINMENU")||Application.instance.playSound("MUSIC_MAINMENU");this.m_oldPage=this.m_page=1;this.m_idClip=0;this.m_dataCutscene=[{text:"STR_REP_CUTSCENE_INFO_4",idClip:3},{text:"STR_REP_CUTSCENE_INFO_5",idClip:3},{text:"STR_REP_CUTSCENE_INFO_6",idClip:4},{text:"STR_REP_CUTSCENE_INFO_7",idClip:4}];this.activePress=!0;this.m_scrollR=this.m_scrollL=this.m_clipImage=null;this.m_clipImage=this.controls.mcGuiImage;
this.m_scrollL=this.controls.mcGuiBtnScrollLeft;this.m_scrollR=this.controls.mcGuiBtnScrollRight;this.m_scrollL.setVisible(!1);this.getControl("mcGuiTxt").setTextLocalized(this.m_dataCutscene[0].text);this.m_idClip=parseInt(this.m_dataCutscene[0].idClip,10);this.m_clipImage.setClip("gui_screen_cutscene0"+this.m_idClip);this.m_page=this.m_oldPage;Application.instance.effectManager.createEffect("fxCutscene",0,0,this.getControl("mcContentFX").canvas);DataManager.instance.setGlobalRegister(DataManager.REG_CUTSCENE_END,
1);DataManager.instance.saveData()}Application.subclass(GuiCutsceneEnd,SScreen);GuiCutsceneEnd.MAX_PAGE=4;GuiCutsceneEnd.prototype.onEndTransition=function(a){SScreen.prototype.onEndTransition.call(this,a);null!==a.params&&"undefined"!==typeof a.params.screen&&GuiManager.instance.gotoScreen(a.params.screen)};GuiCutsceneEnd.prototype.onStopScreen=function(){SScreen.prototype.onStopScreen.call(this);this.activePress=!1;this.m_clipImage.clip.gotoAndPlay(2)};
GuiCutsceneEnd.prototype.onCallNextScreen=function(){this.activePress=!0;this.lastInteractionControl="mcGuiBtnPlay";this.createTransition(Global.TRANSITION_SPECIAL_IN,0,0,{screen:GuiManager.SC_END_GAME},this.canvas)};GuiCutsceneEnd.prototype.onFinishScreen=function(){switch(this.lastInteractionControl){case "mcGuiBtnPlay":GuiManager.instance.gotoScreen(GuiManager.SC_END_GAME)}};
GuiCutsceneEnd.prototype.onUIRelease=function(a){if(!this.activePress)switch(SScreen.prototype.onUIRelease.call(this,a),Application.instance.playSound("SND_UI_CLICK"),a.name){case "mcGuiBtnSkip":this.onCallNextScreen();break;case "mcGuiBtnScrollLeft":this.nextPage(2);break;case "mcGuiBtnScrollRight":this.nextPage(1)}};
GuiCutsceneEnd.prototype.nextPage=function(a){this.m_oldPage=this.m_page=1===a?this.m_page>GuiCutsceneEnd.MAX_PAGE?GuiCutsceneEnd.MAX_PAGE:this.m_page+1:1>this.m_page?1:this.m_page-1;this.m_oldPage>GuiCutsceneEnd.MAX_PAGE?(this.getControl("mcGuiBtnSkip").setVisible(!1),this.onCallNextScreen()):(this.getControl("mcGuiBtnSkip").setVisible(this.m_oldPage!==GuiCutsceneEnd.MAX_PAGE),this.m_scrollL.setVisible(1!==this.m_page),a=parseInt(this.m_dataCutscene[this.m_page-1].idClip,10),a!==this.m_idClip&&(this.m_idClip=
a,this.m_clipImage.setClip("gui_screen_cutscene0"+this.m_idClip),this.m_clipImage.clip.resume()),this.getControl("mcGuiTxt").setTextLocalized(this.m_dataCutscene[this.m_page-1].text),this.m_page=this.m_oldPage)};function GuiConfirm(a,b,c,d){SScreen.call(this,a,b,c,d);this.setInteractive(!0)}Application.subclass(GuiConfirm,SScreen);GuiConfirm.prototype.localizedText=function(a){this.getControl("mcGuiTxtTittle").setTextLocalized(a);this.getControl("mcGuiTxtTittle_s").setTextLocalized(a)};
GuiConfirm.prototype.onStopScreen=function(){SScreen.prototype.onStopScreen.call(this);this.activePress=!1};GuiConfirm.prototype.onFinishScreen=function(){SScreen.prototype.onFinishScreen.call(this);Application.instance.playSound("SND_UI_CLICK");switch(this.lastInteractionControl){case "mcGuiBtnYes":this.onPressYes();break;case "mcGuiBtnNo":this.onPressNo()}};GuiConfirm.prototype.onPressNo=function(){};GuiConfirm.prototype.onPressYes=function(){};
GuiConfirm.prototype.onUIPress=function(a){SScreen.prototype.onUIPress.call(this,a);if(!this.activePress)switch(a.name){case "mcGuiBtnYes":case "mcGuiBtnNo":this.activePress=!0,this.onResumeScreen()}};
function GuiGame(a,b,c){SScreen.call(this,"",a,b);GuiGame.instance=this;this.game=null;this.deleteGame=!1;this.setInteractive(!0);this.canvasBackground=Application.instance.addDisplayContainer();this.canvasGame=Application.instance.addDisplayContainer();this.canvasControl=Application.instance.addDisplayContainer();this.canvasEffects=Application.instance.addDisplayContainer();this.canvas.addChild(this.canvasBackground);this.canvas.addChild(this.canvasGame);this.canvas.addChild(this.canvasControl);
this.canvas.addChild(this.canvasEffects);this.createGame();this.onStart();this.waitNextScreen="";this.fixGameScale();this.deleteGame=!1;this.createTransition(Global.TRANSITION_SPECIAL_OUT,0,0,{action:GuiGame.TX_INIT_GAME},this.canvas);Global.trackIsContinue=!1}Application.subclass(GuiGame,SScreen);GuiGame.instance=null;GuiGame.TX_INIT_GAME=0;GuiGame.TX_REMOVE_GAME=1;GuiGame.prototype.onStart=function(){};GuiGame.prototype.onAppLostFocus=function(){if(this.game)this.game.onAppLostFocus()};
GuiGame.prototype.onAppGotFocus=function(){if(this.game)this.game.onAppGotFocus()};GuiGame.prototype.fixGameScale=function(){this.canvasGame&&Application.WIDE_SCREEN&&this.game&&this.game.fixGameScale();this.canvasGame.scale.x=.5;this.canvasGame.scale.y=.5};
GuiGame.prototype.createGame=function(){if(Application.sandbox){Application.instance.isMobileDevice=Application.sandbox.startSettings.setAsMobileDevice;Application.log("-----------------------------------");Application.log("SANDBOX START SETTINGS");for(var a in Application.sandbox.startSettings)Application.log("SANDBOX "+a+" : "+Application.sandbox.startSettings[a]);Application.log("-----------------------------------")}this.game=new ScrollGame(this.canvasGame);Application.sandbox&&this.game.addSection();
Global.game=this.game};GuiGame.prototype.destroyGame=function(){this.dropPopup();null!==this.game&&(this.game.free(),this.game=null)};GuiGame.prototype.enabledGame=function(){null!==this.game&&this.game.enabledGame()};GuiGame.prototype.removeGame=function(){this.deleteGame||(this.deleteGame=!0)};
GuiGame.prototype.onEndTransition=function(a){SScreen.prototype.onEndTransition.call(this,a);if(a.params)switch(a.params.action){case GuiGame.TX_INIT_GAME:this.enabledGame();break;case GuiGame.TX_REMOVE_GAME:this.game.free(),this.game=null,Application.instance.guiManager.gotoScreen(GuiManager.SC_MAIN_MENU)}};GuiGame.prototype.onDebugDraw=function(a){if(null!==this.game)this.game.onDebugDraw(a)};GuiGame.prototype.onPointerPress=function(a){a=Layout.fixInteractionEvent(a);if(this.game&&null===this.popup)this.game.onPointerPress(a)};
GuiGame.prototype.onPointerRelease=function(a){a=Layout.fixInteractionEvent(a);if(this.game&&null===this.popup)this.game.onPointerRelease(a)};GuiGame.prototype.onPointerMove=function(a){a=Layout.fixInteractionEvent(a);if(this.game&&null===this.popup)this.game.onPointerMove(a)};GuiGame.prototype.onKeyUp=function(a){SScreen.prototype.onKeyUp.call(this,a);if(null!==this.game&&null===this.popup)this.game.onKeyUp(a)};
GuiGame.prototype.onKeyDown=function(a){SScreen.prototype.onKeyDown.call(this,a);if(null!==this.game&&null===this.popup)this.game.onKeyDown(a)};GuiGame.prototype.update=function(a){null!==this.game&&null===this.popup&&this.game.update(a);SScreen.prototype.update.call(this,a);""!==this.waitNextScreen&&(Application.instance.guiManager.gotoScreen(this.waitNextScreen),this.waitNextScreen="")};
GuiGame.prototype.free=function(){Application.instance.stopAllSounds();Application.instance.tweenManager.removeAll();Application.instance.effectManager.clear();null!=this.game&&(this.game.free(),this.game=null);Global.game=null;this.canvas.removeChild(this.canvasBackground);this.canvasBackground.free();this.canvasBackground=null;this.canvas.removeChild(this.canvasGame);this.canvasGame.free();this.canvasGame=null;this.canvas.removeChild(this.canvasControl);this.canvasControl.free();this.canvasControl=
null;this.canvas.removeChild(this.canvasEffects);this.canvasEffects.free();this.canvasEffects=null;GuiGame.instance=null;SScreen.prototype.free.call(this);0<Global.loaded_gameplay_assets.length&&(SLoader.unloadFromList(Global.loaded_gameplay_assets),Application.instance.unloadSoundsFromList(Global.sound_gameplay[0]),GuiLoader.doneFirstLoader=!1)};
function GuiPopupPause(a,b,c,d){this.m_missions=[];SScreen.call(this,a,b,c,d);this.setInteractive(!0);this.name="pause";this.getControl("mcGuiBtnSound").gotoState(GuiOnOff.ST_ON);Application.instance.isSoundOn()||this.getControl("mcGuiBtnSound").gotoState(GuiOnOff.ST_OFF);Application.instance.pauseAllSounds();this.createMissions()}Application.subclass(GuiPopupPause,SScreen);
GuiPopupPause.prototype.createMissions=function(){var a=DataManager.instance.getGlobalRegister(DataManager.REG_ALL_MISSIONS),b;for(b=1;3>=b;b++){var c=new GuiContentMission(ScrollGame.instance.missions.currentMissions[b-1],a,this.getControl("mcGuiContent_"+b),this);this.getControl("mcGuiContent_"+b).canvas.addChild(c.canvas);this.m_missions.push(c)}this.getControl("mcGuiSpiderIcon").setVisible(1===a);this.getControl("mcGuiTxtMissionsCleared").setVisible(1===a);this.getControl("mcGuiTxtMissionsClearedS").setVisible(1===
a)};GuiPopupPause.prototype.onUIPress=function(a){SScreen.prototype.onUIPress.call(this,a);if(!this.activePress)switch(Application.instance.playSound("SND_UI_CLICK"),a.name){case "mcGuiBtnResume":case "mcGuiBtnQuit":case "mcGuiBtnHelp":this.activePress=!0;this.onResumeScreen();break;case "mcGuiBtnSound":Application.instance.toggleMute()}};GuiPopupPause.prototype.onStopScreen=function(){SScreen.prototype.onStopScreen.call(this);this.activePress=!1};
GuiPopupPause.prototype.onFinishScreen=function(){SScreen.prototype.onFinishScreen.call(this);switch(this.lastInteractionControl){case "mcGuiBtnResume":Application.instance.resumeAllSounds();this.screenParent.addPopup(GuiPopupGo,"mcGuiGo");break;case "mcGuiBtnHelp":this.screenParent.addPopup(GuiPopupHelp,"mcGuiPopupsHelp");break;case "mcGuiBtnQuit":this.screenParent.addPopup(GuiPopupQuit,"mcGuiPopupsConfirm")}};
GuiPopupPause.prototype.onKeyDown=function(a){if(!this.activePress)switch(SScreen.prototype.onKeyDown.call(this,a),a){case Common.KEY_P:this.lastInteractionControl="mcGuiBtnResume",this.activePress=!0,this.onResumeScreen()}};GuiPopupPause.prototype.onEndTransition=function(a){SScreen.prototype.onEndTransition.call(this,a);a.params&&Application.instance.guiManager.gotoScreen(a.params.screen)};GuiPopupPause.prototype.onPressSpaceBar=function(){};
GuiPopupPause.prototype.update=function(a){SScreen.prototype.update.call(this,a);for(var b=0;b<this.m_missions.length;b++)null!==this.m_missions[b]&&this.m_missions[b].update(a)};GuiPopupPause.prototype.free=function(){this.m_missions=[];SScreen.prototype.free.call(this)};
function GuiMainMenu(a,b,c,d){SScreen.call(this,a,b,c,d);this.m_logoMarvel=this.m_logoGame=null;Application.instance.isPlayingSound("MUSIC_MAINMENU")||Application.instance.playSound("MUSIC_MAINMENU");this.m_count=0;this.initLocalizedSprites();this.percentageParallaxY=this.percentageParallaxX=0;this.m_isClickable=!0;this.getControl("mcGuiBtnSound").gotoState(GuiOnOff.ST_ON);Application.instance.isSoundOn()||this.getControl("mcGuiBtnSound").gotoState(GuiOnOff.ST_OFF);GuiLoader.doneFirstLoader||this.createTransition(Global.TRANSITION_SPECIAL_OUT,
0,0,{},this.canvas);BossBehaviorIntro.showFirstTime=!1}Application.subclass(GuiMainMenu,SScreen);GuiMainMenu.prototype.init=function(){SScreen.prototype.init.call(this);Application.instance.onOrientationchange(null)};GuiMainMenu.prototype.onStopScreen=function(){SScreen.prototype.onStopScreen.call(this);this.activePress=!1};GuiMainMenu.prototype.update=function(a){SScreen.prototype.update.call(this,a)};
GuiMainMenu.prototype.free=function(){null!=this.m_logoGame&&(this.m_logoGame.free(),this.m_logoGame=null);null!=this.m_logoMarvel&&(this.m_logoMarvel.free(),this.m_logoMarvel=null);SScreen.prototype.free.call(this)};
GuiMainMenu.prototype.initLocalizedSprites=function(){var a=Application.instance.getLocalizedImage("gui_screens_mainmenu_logo.png"),b=Application.instance.getLocalizedImage("gui_localized_logo03.png");this.m_logoGame=a;this.m_logoMarvel=b;this.controls.mcGuiLogo&&(this.getControl("mcGuiLogo").clip.addChild(this.m_logoGame),this.m_logoGame.pivot.x=200,this.m_logoGame.pivot.y=182);this.controls.mcGuiLogo2&&(this.getControl("mcGuiLogo2").clip.addChild(this.m_logoMarvel),this.m_logoMarvel.pivot.x=45,
this.m_logoMarvel.pivot.y=8)};
GuiMainMenu.prototype.onUIPress=function(a){if(!this.activePress)switch(SScreen.prototype.onUIPress.call(this,a),Application.instance.fullScreen(),a.name){case "mcGuiBtnPlay":this.activePress=!0;Application.instance.playSound("SND_UI_PLAY");Application.externalTrack("game_start");a=0===DataManager.instance.getGlobalRegister(DataManager.REG_CUTSCENE_INIT)?GuiManager.SC_CUTSCENE:GuiManager.SC_GAME;this.createTransition(Global.TRANSITION_SPECIAL_IN,0,0,{screen:a},this.canvas);break;case "mcGuiBtnReset":Application.instance.playSound("SND_UI_CLICK");
this.addPopup(GuiPopupReset,"mcGuiPopupsConfirm",0,0);break;case "mcGuiBtnCredits":this.activePress=!0;Application.instance.playSound("SND_UI_CLICK");this.createTransition(Global.TRANSITION_SPECIAL_IN,0,0,{screen:"POPUP_CREDITS"},this.canvas);break;case "mcGuiBtnTrophies":Application.instance.playSound("SND_UI_CLICK");this.activePress=!0;this.createTransition(Global.TRANSITION_SPECIAL_IN,0,0,{screen:GuiManager.SC_TROPHIES},this.canvas);break;case "mcGuiBtnSound":Application.instance.toggleMute()}};
GuiMainMenu.prototype.onFinishScreen=function(){switch(this.lastInteractionControl){case "mcGuiBtnPlay":GuiManager.instance.gotoScreen(GuiManager.SC_CUTSCENE);break;case "mcGuiBtnTrophies":GuiManager.instance.gotoScreen(GuiManager.SC_TROPHIES)}};GuiMainMenu.prototype.onEndTransition=function(a){SScreen.prototype.onEndTransition.call(this,a);null!==a.params&&"undefined"!==typeof a.params.screen&&("POPUP_CREDITS"===a.params.screen?this.addPopup(GuiPopupCredits,"mcGuiScreenCredits",0,0):GuiManager.instance.gotoScreen(a.params.screen))};
GuiMainMenu.prototype.returnCredits=function(){this.dropPopup();this.activePress=!1;this.createTransition(Global.TRANSITION_SPECIAL_OUT,0,0,{},this.canvas)};GuiMainMenu.prototype.onPressSpaceBar=function(){SScreen.prototype.onPressSpaceBar.call(this)};function GuiPopupGo(a,b,c,d){SScreen.call(this,a,b,c,d);this.setInteractive(!0);this.name="message_go"}Application.subclass(GuiPopupGo,SScreen);GuiPopupGo.prototype.onFinishScreen=function(){SScreen.prototype.onFinishScreen.call(this);this.screenParent.dropPopup()};
GuiPopupGo.prototype.update=function(a){SScreen.prototype.update.call(this,a)};GuiPopupGo.prototype.free=function(){SScreen.prototype.free.call(this)};function GuiTrophies(a,b,c,d){this.m_trophies=[];SScreen.call(this,a,b,c,d);this.name="popup_trophie";this.createTrophies();this.createTransition(Global.TRANSITION_SPECIAL_OUT,0,0,{},this.canvas)}Application.subclass(GuiTrophies,SScreen);GuiTrophies.MAX_TROPHIES=6;
GuiTrophies.prototype.createTrophies=function(){for(var a=Application.config.achievements,b=0;b<a.length;b++){var c=new AchievementData(a[b]),d=DataManager.instance.getGlobalRegister(DataManager["REG_ACHIEVEMENT_"+c.idSaveData]);c.progress=d;c.completed=d===c.objective;c=new GuiTrophiesItems("mcGuiAchievements",this,c);this.getControl("mcGuiContent_"+(b+1)).canvas.addChild(c.canvas);if(0===b)c.onSelectTrophy();this.m_trophies.push(c)}};
GuiTrophies.prototype.onStopScreen=function(){SScreen.prototype.onStopScreen.call(this);this.activePress=!1};GuiTrophies.prototype.onFinishScreen=function(){SScreen.prototype.onFinishScreen.call(this);switch(this.lastInteractionControl){case "mcGuiBtnBack":GuiManager.instance.gotoScreen(GuiManager.SC_MAIN_MENU)}};
GuiTrophies.prototype.onUIPress=function(a){SScreen.prototype.onUIPress.call(this,a);Application.instance.playSound("SND_UI_CLICK");switch(a.name){case "mcGuiBtnBack":this.activePress=!0,this.onResumeScreen()}};
GuiTrophies.prototype.onSelectTrophy=function(a,b){b=b?"mcGuiTrophy0"+a+"_lock":"mcGuiTrophy0"+a;this.getControl("mcGuiTrophie").setClip(b);this.getControl("mcGuiTxtTrophieTitle").setTextLocalized("STR_REP_NAME_TROPHIE_"+a);this.getControl("mcGuiTxtTrophieTitle_s").setTextLocalized("STR_REP_NAME_TROPHIE_"+a);this.getControl("mcGuiTxtTrophieInfo").setTextLocalized("STR_REP_INFO_TROPHIE_"+a)};GuiTrophies.prototype.onUnSelectAllTrophy=function(){for(var a=0;a<this.m_trophies.length;a++)if(this.m_trophies[a].isSelected)this.m_trophies[a].onUnSelectTrophy()};
GuiTrophies.prototype.update=function(a){SScreen.prototype.update.call(this,a)};function GuiTrophiesItems(a,b,c){this.m_parentSC=b;this.isSelected=this.isLocked=!1;this.m_data=c;this.m_nameClip="";SScreen.call(this,a,0,0,null);this.name="trophie_items";this.loadData()}Application.subclass(GuiTrophiesItems,SScreen);GuiTrophiesItems.MIN_SCALE=1;GuiTrophiesItems.MAX_SCALE=1.1;GuiTrophiesItems.MAX_SCALE_SELECT=1.25;
GuiTrophiesItems.prototype.loadData=function(){this.m_nameClip=this.nameTrophy();this.getControl("mcGuiIcon").setClip(this.m_nameClip);this.getControl("mcGuiBase").clip.gotoAndStop(1)};GuiTrophiesItems.prototype.nameTrophy=function(){this.isLocked=!this.m_data.completed;return"mcGuiTrophy0"+this.m_data.idSaveData+"_"+(this.isLocked?"lock":"off")};GuiTrophiesItems.prototype.onUIPress=function(a){SScreen.prototype.onUIPress.call(this,a);switch(a.name){case "mcGuiButton":this.onSelectTrophy()}};
GuiTrophiesItems.prototype.onUIOut=function(a){SScreen.prototype.onUIOut.call(this,a);switch(a.name){case "mcGuiButton":this.onOutButton()}};GuiTrophiesItems.prototype.onUIOver=function(a){SScreen.prototype.onUIOver.call(this,a);switch(a.name){case "mcGuiButton":this.onOverButton()}};
GuiTrophiesItems.prototype.onSelectTrophy=function(){this.m_parentSC.onUnSelectAllTrophy();this.isSelected=!0;this.isLocked||(this.m_nameClip="mcGuiTrophy0"+this.m_data.idSaveData+"_press",this.getControl("mcGuiBase").clip.gotoAndStop(2));this.getControl("mcGuiIcon").setClip(this.m_nameClip);this.getControl("mcGuiIcon").clip.scale.x=GuiTrophiesItems.MAX_SCALE_SELECT;this.getControl("mcGuiIcon").clip.scale.y=GuiTrophiesItems.MAX_SCALE_SELECT;this.getControl("mcGuiBase").clip.scale.x=GuiTrophiesItems.MAX_SCALE_SELECT;
this.getControl("mcGuiBase").clip.scale.y=GuiTrophiesItems.MAX_SCALE_SELECT;this.getControl("mcGuiButton").setEnabled(!1);this.getControl("mcGuiButton").setInteractive(!1);this.m_parentSC.onSelectTrophy(this.m_data.idSaveData,this.isLocked)};
GuiTrophiesItems.prototype.onUnSelectTrophy=function(){this.isSelected=!1;this.isLocked||(this.m_nameClip="mcGuiTrophy0"+this.m_data.idSaveData+"_off",this.getControl("mcGuiBase").clip.gotoAndStop(1));this.getControl("mcGuiIcon").setClip(this.m_nameClip);this.getControl("mcGuiIcon").clip.scale.x=GuiTrophiesItems.MIN_SCALE;this.getControl("mcGuiIcon").clip.scale.y=GuiTrophiesItems.MIN_SCALE;this.getControl("mcGuiBase").clip.scale.x=GuiTrophiesItems.MIN_SCALE;this.getControl("mcGuiBase").clip.scale.y=
GuiTrophiesItems.MIN_SCALE;this.getControl("mcGuiButton").setEnabled(!0);this.getControl("mcGuiButton").setInteractive(!0)};
GuiTrophiesItems.prototype.onOverButton=function(){this.isLocked||(this.m_nameClip="mcGuiTrophy0"+this.m_data.idSaveData);this.getControl("mcGuiIcon").setClip(this.m_nameClip);this.getControl("mcGuiIcon").clip.scale.x=GuiTrophiesItems.MAX_SCALE;this.getControl("mcGuiIcon").clip.scale.y=GuiTrophiesItems.MAX_SCALE;this.getControl("mcGuiBase").clip.scale.x=GuiTrophiesItems.MAX_SCALE;this.getControl("mcGuiBase").clip.scale.y=GuiTrophiesItems.MAX_SCALE};
GuiTrophiesItems.prototype.onOutButton=function(){this.isLocked||(this.m_nameClip="mcGuiTrophy0"+this.m_data.idSaveData+"_off");this.getControl("mcGuiIcon").setClip(this.m_nameClip);this.getControl("mcGuiIcon").clip.scale.x=GuiTrophiesItems.MIN_SCALE;this.getControl("mcGuiIcon").clip.scale.y=GuiTrophiesItems.MIN_SCALE;this.getControl("mcGuiBase").clip.scale.x=GuiTrophiesItems.MIN_SCALE;this.getControl("mcGuiBase").clip.scale.y=GuiTrophiesItems.MIN_SCALE};
function GuiManager(){new DataManager;ScreenManager.call(this);GuiManager.instance=this;this.loaderStart=0}Application.subclass(GuiManager,ScreenManager);GuiManager.instance=null;GuiManager.oldScreen="";GuiManager.sandboxGuiView="";GuiManager.SC_SANDBOX="gui_sandbox";GuiManager.SC_SANBOX_GUI_VIEW="gui_sandbox_gui_view";GuiManager.SC_SANBOX_NANO_VIEW="gui_sandbox_nano_view";GuiManager.SC_SOUND_LOADER="gui_soundloader";GuiManager.SC_PRELOAD="gui_preload";GuiManager.SC_LOADER="gui_loader";
GuiManager.SC_MAIN_MENU="gui_main_menu";GuiManager.SC_CUTSCENE="gui_cutscenes";GuiManager.SC_CUTSCENE_END="gui_cutscenes_end";GuiManager.SC_GAME="gui_game";GuiManager.SC_END_GAME="gui_end_game";GuiManager.SC_TROPHIES="gui_trophies";GuiManager.SC_TESTMENU="gui_test_menu";
GuiManager.prototype.gotoScreen=function(a){ScreenManager.prototype.gotoScreen.call(this,a);var b=Application.RIGHT_TO_LEFT?"_rtl":"";switch(a){case GuiManager.SC_PRELOAD:a=window.SWT_BUNDLES["preload"+b];SLoader.checkTexturesLoaded(a)||(this.currentScreen=new GuiLoader("",a,"",null,0,100,!0,window.SWT_BUNDLES.localized));break;case GuiManager.SC_MAIN_MENU:a=window.SWT_BUNDLES["media_content"+b];SLoader.checkTexturesLoaded(a)?(a=window.SWT_BUNDLES["media_elements"+b],SLoader.checkTexturesLoaded(a)?
this.currentScreen=new GuiMainMenu("mcGuiScreenMainMenu"):this.currentScreen=new GuiLoader("mcGuiScreenLoader",a,GuiManager.SC_MAIN_MENU,Global.sound_elements,Application.SOUND_PERCENT,100)):this.currentScreen=new GuiLoader("mcGuiScreenLoader",a,GuiManager.SC_MAIN_MENU,Global.sound_content,0,Application.SOUND_PERCENT);break;case GuiManager.SC_GAME:this.startGame();break;case GuiManager.SC_CUTSCENE_END:a=window.SWT_BUNDLES["media_elements"+b];SLoader.checkTexturesLoaded(a)?this.currentScreen=new GuiCutsceneEnd("mcGuiScreenCutscene"):
this.currentScreen=new GuiLoader("mcGuiScreenLoader",a,GuiManager.SC_CUTSCENE_END);break;case GuiManager.SC_CUTSCENE:a=window.SWT_BUNDLES["media_elements"+b];SLoader.checkTexturesLoaded(a)?this.currentScreen=new GuiCutscene("mcGuiScreenCutscene"):this.currentScreen=new GuiLoader("mcGuiScreenLoader",a,GuiManager.SC_CUTSCENE);break;case GuiManager.SC_TROPHIES:a=window.SWT_BUNDLES["media_elements"+b];SLoader.checkTexturesLoaded(a)?this.currentScreen=new GuiTrophies("mcGuiScreenTrophies"):this.currentScreen=
new GuiLoader("mcGuiScreenLoader",a,GuiManager.SC_TROPHIES);break;case GuiManager.SC_END_GAME:a=window.SWT_BUNDLES["media_elements"+b];SLoader.checkTexturesLoaded(a)?this.currentScreen=new GuiEndGameSpecial("mcGuiScreenEndGame"):this.currentScreen=new GuiLoader("mcGuiScreenLoader",a,GuiManager.SC_END_GAME);break;case GuiManager.SC_SANDBOX:var c=Global.sound_content;c=c.concat(Global.sound_elements);a=window.SWT_BUNDLES["media_content"+b];a=a.concat(window.SWT_BUNDLES["media_elements"+b]);SLoader.checkTexturesLoaded(a)?
this.startGame():this.currentScreen=new GuiLoader("mcGuiScreenLoader",a,GuiManager.SC_GAME,c);break;case GuiManager.SC_SANBOX_GUI_VIEW:a=window.SWT_BUNDLES["media_game_"+Global.level];a=a.concat(window.SWT_BUNDLES["media_content"+b]);a=a.concat(window.SWT_BUNDLES["media_gameplay"+b]);a=a.concat(window.SWT_BUNDLES["media_elements"+b]);a=a.concat(window.SWT_BUNDLES["preload"+b]);SLoader.checkTexturesLoaded(a)?this.currentScreen=new DebugScreen(GuiManager.sandboxGuiView):this.currentScreen=new GuiLoader("mcGuiScreenLoader",
a,GuiManager.SC_SANBOX_GUI_VIEW);break;case GuiManager.SC_SANBOX_NANO_VIEW:window.Assets.sandbox_nano?(this.currentScreen=new GuiLoader("mcGuiScreenLoader",window.Assets.sandbox_nano,GuiManager.SC_SANBOX_NANO_VIEW),window.Assets.sandbox_nano=null):this.currentScreen=new DebugScreenNano}};
GuiManager.prototype.startGame=function(){GuiManager.instance.currentScreen&&GuiManager.instance.currentScreen.free();Global.loaded_gameplay_assets=[];var a=[],b=Application.RIGHT_TO_LEFT?"_rtl":"",c=window.SWT_BUNDLES["media_elements"+b];SLoader.checkTexturesLoaded(c)&&SLoader.unloadFromList(c);Global.loaded_gameplay_assets=window.SWT_BUNDLES["media_gameplay"+b].slice();Global.loaded_gameplay_assets=Global.loaded_gameplay_assets.concat(window.SWT_BUNDLES["media_game_"+Global.level].slice());SLoader.checkTexturesLoaded(Global.loaded_gameplay_assets)?
GuiManager.instance.currentScreen=new GuiGame:GuiManager.instance.currentScreen=new GuiLoader("mcGuiScreenLoader",Global.loaded_gameplay_assets,GuiManager.SC_GAME,Global.sound_gameplay[0],0,100,!1,a)};GuiManager.prototype.onKeyDown=function(a){ScreenManager.prototype.onKeyDown.call(this,a);Cheats.onKeyDown(a)};GuiManager.prototype.free=function(){GuiManager.instance=null;ScreenManager.prototype.free.call(this)};
function GuiEndGameSpecial(a,b,c,d){SScreen.call(this,a,b,c,d);this.setInteractive(!0);this.name="special";this.createTransition(Global.TRANSITION_SPECIAL_OUT,0,0,{},this.canvas);Application.externalTrack("game_complete")}Application.subclass(GuiEndGameSpecial,SScreen);GuiEndGameSpecial.prototype.onStopScreen=function(){SScreen.prototype.onStopScreen.call(this);this.activePress=!1};
GuiEndGameSpecial.prototype.onUIPress=function(a){if(!this.activePress)switch(Application.instance.playSound("SND_UI_CLICK"),SScreen.prototype.onUIPress.call(this,a),a.name){case "mcGuiBtnMainmenu":Application.instance.playSound("SND_UI_CLICK"),this.activePress=!0,this.createTransition(Global.TRANSITION_SPECIAL_IN,0,0,{screen:GuiManager.SC_MAIN_MENU},this.canvas)}};GuiEndGameSpecial.prototype.onFinishScreen=function(){switch(this.lastInteractionControl){case "mcGuiBtnMainmenu":GuiManager.instance.gotoScreen(GuiManager.SC_MAIN_MENU)}};
GuiEndGameSpecial.prototype.onEndTransition=function(a){SScreen.prototype.onEndTransition.call(this,a);null!==a.params&&"undefined"!==typeof a.params.screen&&GuiManager.instance.gotoScreen(a.params.screen)};GuiEndGameSpecial.prototype.update=function(a){SScreen.prototype.update.call(this,a)};GuiEndGameSpecial.prototype.free=function(){SScreen.prototype.free.call(this)};
function GuiContentMission(a,b,c,d){this.dataMission=a;this.m_animationProgress=!1;this.m_totalProgress=this.m_currentProgress=0;this.m_icon=null;this.m_nameParent=d;this.m_validate=b;this.m_parentControl=c;SScreen.call(this,"mcGuiContentMission",0,0,null);this.canvas.hitArea=null;this.controls.mcGuiIcons&&(this.m_icon=this.getControl("mcGuiIcons"));this.loadMissions()}Application.subclass(GuiContentMission,SScreen);GuiContentMission.PROGRESS_SPEED=.9;
GuiContentMission.prototype.loadMissions=function(){this.m_currentProgress=0;this.m_totalProgress=this.dataMission.percentage/100;this.m_animationProgress=0!==this.m_totalProgress;this.m_icon.setClip("gui_missions_icons_"+("coins_total"===this.dataMission.type?"coins":this.dataMission.type));this.getControl("mcGuiTextMission").setTextReplace("STR_REP_NAME_MISSION_"+this.dataMission.idSaveData,["#"],[this.dataMission.objective]);this.getControl("mcGuiIcons").clip.gotoAndStop(1===this.m_totalProgress?
2:1);this.getControl("mcGuiCheck").setVisible(1===this.m_totalProgress);var a=this.getControl("mcGuiProgress");1===this.m_totalProgress&&(this.m_currentProgress=1,this.m_animationProgress=!1,"endRun"===this.m_nameParent.name?this.dataMission.viewEndFX||(this.dataMission.viewEndFX=!0,Application.instance.effectManager.createEffect("fxSquare",0,0,this.getControl("mcContentFX").canvas)):this.dataMission.viewHudFX||(this.dataMission.viewHudFX=!0,Application.instance.effectManager.createEffect("fxSquare",
0,0,this.getControl("mcContentFX").canvas)));a.clip.getInstance("mcBar").scale.y=this.m_currentProgress};
GuiContentMission.prototype.update=function(a){SScreen.prototype.update.call(this,a);this.m_animationProgress&&(this.m_currentProgress+=GuiContentMission.PROGRESS_SPEED*a/1E3,this.getControl("mcGuiProgress").clip.getInstance("mcBar").scale.y=this.m_currentProgress,this.m_currentProgress>=this.m_totalProgress&&(this.m_animationProgress=!1));1===this.m_validate&&0!==this.m_parentControl.canvas.alpha&&(this.m_parentControl.canvas.alpha=0)};
function GuiPopupStore(a,b,c,d){this.m_store=[];this.m_buy=null;this.m_spiderCoins=this.m_timeDefault=0;this.m_selectDefault=!1;this.m_itemSelected=null;this.m_activeInit=!1;SScreen.call(this,a,b,c,d);this.setInteractive(!0);this.name="popup_store";this.m_spiderCoins=DataManager.instance.getGlobalRegister(DataManager.REG_TOTAL_COINS);this.createItems();this.getControl("mcGuiTxtCoinsNumber").setTextReplace("STR_REP_HUD_COINS_DATA",["#"],[this.m_spiderCoins])}Application.subclass(GuiPopupStore,SScreen);
GuiPopupStore.MAX_ITEMS=5;GuiPopupStore.MIN_SCALE=1;GuiPopupStore.MAX_SCALE=1.1;GuiPopupStore.MAX_SCALE_SELECT=1.25;GuiPopupStore.prototype.free=function(){null!=this.m_buy&&(this.m_buy.free(),this.m_buy=null);for(var a=this.m_store.length-1;0<=a;--a)this.m_store[a].free(),this.m_store[a]=null;this.m_itemSelected=this.m_store=null;SScreen.prototype.free.call(this)};
GuiPopupStore.prototype.createItems=function(){this.m_buy=new GuiContentBuy("mcGuiContentBuy",0);this.getControl("mcGuiContentBuy").canvas.addChild(this.m_buy.canvas);for(var a=1;a<=GuiPopupStore.MAX_ITEMS;a++){var b=new GuiStoreItems("mcGuiContentStore",this,ScrollGame.instance.stores.data[a-1]);this.getControl("mcGuiContent_"+a).canvas.addChild(b.canvas);this.m_store.push(b)}this.m_activeInit=!0;this.onSelectItem(1);this.onCheckAllAlertBuy()};
GuiPopupStore.prototype.onCheckAllAlertBuy=function(){for(var a=0;a<ScrollGame.instance.stores.data.length;a++){var b=!1,c=ScrollGame.instance.stores.data[a];this.m_spiderCoins>=c.price&&!c.completed&&(b=!0);this.getControl("mcGuiNotification0"+(a+1)).setVisible(b)}};GuiPopupStore.prototype.onStopScreen=function(){SScreen.prototype.onStopScreen.call(this);this.m_activeInit=this.activePress=!1;this.onSelectItem(1)};
GuiPopupStore.prototype.onFinishScreen=function(){SScreen.prototype.onFinishScreen.call(this);switch(this.lastInteractionControl){case "mcGuiBtnBack":this.screenParent.onBack()}};
GuiPopupStore.prototype.onUIPress=function(a){if(!this.activePress)switch(SScreen.prototype.onUIPress.call(this,a),Application.instance.playSound("SND_UI_CLICK"),a.name){case "mcGuiBtnBack":this.activePress=!0;this.onResumeScreen();break;case "mcGuiBtnBuy":this.onBuyItem();break;case "mcGuiBtnItem_1":case "mcGuiBtnItem_2":case "mcGuiBtnItem_3":case "mcGuiBtnItem_4":case "mcGuiBtnItem_5":a=parseInt(a.name.substr(13),10),this.onUnSelectAllItems(),this.onSelectItem(a)}};
GuiPopupStore.prototype.onUIOut=function(a){SScreen.prototype.onUIOut.call(this,a);switch(a.name){case "mcGuiBtnBuy":this.getControl("mcGuiContentBuy").canvas.scale.x=GuiPopupStore.MIN_SCALE;this.getControl("mcGuiContentBuy").canvas.scale.y=GuiPopupStore.MIN_SCALE;break;case "mcGuiBtnItem_1":case "mcGuiBtnItem_2":case "mcGuiBtnItem_3":case "mcGuiBtnItem_4":case "mcGuiBtnItem_5":a=parseInt(a.name.substr(13),10),this.onOutItem(a)}};
GuiPopupStore.prototype.onUIOver=function(a){SScreen.prototype.onUIOver.call(this,a);switch(a.name){case "mcGuiBtnBuy":this.getControl("mcGuiContentBuy").canvas.scale.x=GuiPopupStore.MAX_SCALE;this.getControl("mcGuiContentBuy").canvas.scale.y=GuiPopupStore.MAX_SCALE;break;case "mcGuiBtnItem_1":case "mcGuiBtnItem_2":case "mcGuiBtnItem_3":case "mcGuiBtnItem_4":case "mcGuiBtnItem_5":a=parseInt(a.name.substr(13),10),this.onOverItem(a)}};
GuiPopupStore.prototype.onOverItem=function(a){this.m_store[a-1].onOverContent();this.getControl("mcGuiContent_"+a).canvas.scale.x=GuiPopupStore.MAX_SCALE;this.getControl("mcGuiContent_"+a).canvas.scale.y=GuiPopupStore.MAX_SCALE};GuiPopupStore.prototype.onOutItem=function(a){this.m_store[a-1].onOutContent();this.getControl("mcGuiContent_"+a).canvas.scale.x=GuiPopupStore.MIN_SCALE;this.getControl("mcGuiContent_"+a).canvas.scale.y=GuiPopupStore.MIN_SCALE};
GuiPopupStore.prototype.onSelectItem=function(a){this.m_itemSelected=this.m_store[a-1];this.m_itemSelected.onSelect();this.getControl("mcGuiContent_"+a).canvas.scale.x=GuiPopupStore.MAX_SCALE_SELECT;this.getControl("mcGuiContent_"+a).canvas.scale.y=GuiPopupStore.MAX_SCALE_SELECT;this.getControl("mcGuiBtnItem_"+a).setEnabled(!1);this.getControl("mcGuiBtnItem_"+a).setInteractive(!1);this.chargePanelData()};
GuiPopupStore.prototype.onUnSelectAllItems=function(){for(var a=0;a<this.m_store.length;a++)this.m_store[a].isSelected&&(this.m_store[a].onUnSelect(),this.getControl("mcGuiContent_"+(a+1)).canvas.scale.x=GuiPopupStore.MIN_SCALE,this.getControl("mcGuiContent_"+(a+1)).canvas.scale.y=GuiPopupStore.MIN_SCALE,this.getControl("mcGuiBtnItem_"+(a+1)).setEnabled(!0),this.getControl("mcGuiBtnItem_"+(a+1)).setInteractive(!0))};
GuiPopupStore.prototype.chargePanelData=function(){var a=1===this.m_itemSelected.maxUpgrade?"_02":"_01",b=this.m_itemSelected.idItem+GuiPopupStore.MAX_ITEMS;this.getControl("mcGuiIcon").clip.gotoAndStop(b);this.getControl("mcGuiBaseIcon").setClip("gui_shop_level_base"+a);this.getControl("mcGuiBaseIcon").clip.gotoAndStop(this.m_itemSelected.progress+1);this.getControl("mcGuiTxtShopInfo").setTextLocalized("STR_REP_SCREENS_SHOP_UPGRADE_INFO_"+this.m_itemSelected.idItem);this.getControl("mcGuiTxtShopTitle").setTextLocalized("STR_REP_SCREENS_SHOP_UPGRADE_TITLE_"+
this.m_itemSelected.idItem);a=this.m_itemSelected.onValidateBuy(this.m_spiderCoins);this.getControl("mcGuiBtnBuy").setEnabled(a);this.getControl("mcGuiBtnBuy").setInteractive(a);this.getControl("mcGuiTxtShopCost").setVisible(!this.m_itemSelected.data.completed);this.m_buy.refreshPrice(this.m_itemSelected.data,a);a||(this.getControl("mcGuiContentBuy").canvas.scale.x=1,this.getControl("mcGuiContentBuy").canvas.scale.y=1)};
GuiPopupStore.prototype.onBuyItem=function(){if(null!==this.m_itemSelected){var a=ScrollGame.instance.stores.onBuy(this.m_itemSelected.type);if(null!==a){var b=this.m_itemSelected.price;this.m_itemSelected.maxUpgrade=a.maxUpgrade;this.m_itemSelected.progress=a.progress;this.m_itemSelected.price=a.price;this.m_spiderCoins-=b;b=1===this.m_itemSelected.maxUpgrade?"fxShop02":"fxShop01";if(1!==this.m_itemSelected.maxUpgrade){var c=0;switch(this.m_itemSelected.progress){case 1:c=-10;Application.instance.effectManager.createEffect(b,
0,0,this.getControl("mcContentFX_1").canvas);break;case 2:c=20;Application.instance.effectManager.createEffect(b,0,0,this.getControl("mcContentFX_2").canvas);break;case 3:c=45,Application.instance.effectManager.createEffect(b,0,0,this.getControl("mcContentFX_3").canvas)}this.m_itemSelected.getControl("mcContentFX").canvas.position.x=c}else Application.instance.effectManager.createEffect(b,0,0,this.getControl("mcContentFX_2").canvas);Application.instance.effectManager.createEffect(b,0,0,this.m_itemSelected.getControl("mcContentFX").canvas);
this.m_itemSelected.data=a;DataManager.instance.setGlobalRegister(DataManager.REG_TOTAL_COINS,this.m_spiderCoins);ScrollGame.instance.stores.applyBuy(this.m_itemSelected.data);this.m_itemSelected.loadData(!0);this.getControl("mcGuiTxtCoinsNumber").setTextReplace("STR_REP_HUD_COINS_DATA",["#"],[this.m_spiderCoins]);this.chargePanelData();this.onCheckAllAlertBuy()}}};GuiPopupStore.prototype.update=function(a){SScreen.prototype.update.call(this,a);if(this.m_activeInit)this.onSelectItem(1)};
function GuiStoreItems(a,b,c){this.m_parentSC=b;this.isSelected=!1;this.price=this.progress=this.maxUpgrade=this.idItem=0;this.data=c;this.type="";SScreen.call(this,a,0,0,null);this.name="store_items";this.loadData()}Application.subclass(GuiStoreItems,SScreen);GuiStoreItems.prototype.free=function(){this.data=this.m_parentSC=null;SScreen.prototype.free.call(this)};
GuiStoreItems.prototype.loadData=function(a){this.type=this.data.type;this.idItem=this.data.idSaveData;this.maxUpgrade=this.data.maxUpgrade;this.progress=this.data.progress;this.price=this.data.price;var b=1===this.maxUpgrade?"_02":"_01";if("undefined"===typeof a||!a)if(this.getControl("mcGuiIcon").clip.gotoAndStop(this.idItem),1===this.idItem)this.onOverContent();this.getControl("mcGuiBase").setClip("gui_shop_level_base"+b);this.getControl("mcGuiBase").clip.gotoAndStop(this.progress+1)};
GuiStoreItems.prototype.onSelect=function(){this.isSelected=!0;this.onOverContent()};GuiStoreItems.prototype.onValidateBuy=function(a){var b=!0;if(a<this.price||this.progress===this.maxUpgrade)b=!1;return b};GuiStoreItems.prototype.onUnSelect=function(){this.isSelected=!1;this.onOutContent()};GuiStoreItems.prototype.onOverContent=function(){var a=this.idItem+GuiPopupStore.MAX_ITEMS;this.getControl("mcGuiIcon").clip.gotoAndStop(a)};GuiStoreItems.prototype.onOutContent=function(){this.getControl("mcGuiIcon").clip.gotoAndStop(this.idItem)};
function GuiContentBuy(a,b){this.price=b;SScreen.call(this,a,0,0,null);this.name="content_buy";this.loadData()}Application.subclass(GuiContentBuy,SScreen);GuiContentBuy.prototype.loadData=function(){this.getControl("mcGuiTextPrice").setTextReplace("STR_REP_SHOP_BUTTON",["#"],[this.price])};
GuiContentBuy.prototype.refreshPrice=function(a,b){this.getControl("mcGuiBase").setVisible(!a.completed);this.getControl("mcGuiCoin").setVisible(!a.completed);this.getControl("mcGuiTextPrice").setVisible(!a.completed);this.getControl("mcGuiMaxedOut").setVisible(a.completed);this.price=a.price;a.completed||(this.getControl("mcGuiTextPrice").setTextReplace("STR_REP_SHOP_BUTTON",["#"],[this.price]),a=b?"":"_off",this.getControl("mcGuiBase").setClip("gui_shop_panel_price"+a))};
function GuiPopupEndGame(a,b,c,d){SScreen.call(this,a,b,c,d);this.setInteractive(!0);this.name="endGame";this.m_totalCoins=0;this.m_record=null;this.m_animation=this.m_validateRecord=!1;this.m_totalDistance=this.m_currentDistance=0;this.m_callScreenSpecial=!1;this.interpolate=null;this.loadInformation()}Application.subclass(GuiPopupEndGame,SScreen);GuiPopupEndGame.PROGRESS_SPEED=5;
GuiPopupEndGame.prototype.loadInformation=function(){this.chargeCoins();this.m_currentDistance=0;this.m_totalDistance=ScrollGame.instance.distance;this.getControl("mcGuiTxtTitle").setTextLocalized("STR_REP_END_RUN_TITTLE_"+Global.idTitle);this.getControl("mcGuiTxtTitle_s").setTextLocalized("STR_REP_END_RUN_TITTLE_"+Global.idTitle);this.getControl("mcGuiTxtScore").setTextReplace("STR_REP_END_RUN_DISTANCE_DATA",["#"],[this.m_currentDistance]);this.getControl("mcGuiTxtScore_s").setTextReplace("STR_REP_END_RUN_DISTANCE_DATA",
["#"],[this.m_currentDistance]);var a=DataManager.instance.getGlobalRegister(DataManager.REG_DISTANCE_RECORD);ScrollGame.instance.distance>a&&(a=ScrollGame.instance.distance,DataManager.instance.setGlobalRegister(DataManager.REG_DISTANCE_RECORD,a),DataManager.instance.saveData(),this.m_validateRecord=!0);this.m_record=new GuiNewRecord(a,this.m_validateRecord);this.getControl("mcGuiBaseDistance").canvas.addChild(this.m_record.canvas);this.m_record.canvas.visible=!this.m_validateRecord;0===DataManager.instance.getGlobalRegister(DataManager.REG_CUTSCENE_END)&&
(a=0===DataManager.instance.getGlobalRegister(DataManager.REG_DEFEAT_MYSTERIO),this.getControl("mcGuiBtnShop").setVisible(a),this.getControl("mcGuiBtnHome").setVisible(a),a||(this.m_callScreenSpecial=!0,this.getControl("mcGuiBtnRetry").setNameClipBase("mcGuiButtonNext02")));this.interpolate=new Interpolate;this.interpolate.setValues(this.calculateTime(this.m_totalDistance),{distance:this.m_currentDistance},{distance:this.m_totalDistance},TweenEasing.LinearNone);this.interpolate.start();this.interpolate.addCompleteListener(this,
this.onCompletedProgress)};GuiPopupEndGame.prototype.onCompletedProgress=function(){this.m_validateRecord&&(Application.instance.effectManager.createEffect("fxNewRecord",0,0,this.getControl("mcContentFX").canvas),this.m_record.canvas.visible=!0,Common.tween({parent:this,clip:this.m_record.canvas,scale:1.5},{scale:1},1500,!0,0,TweenEasing.ElasticOut));this.m_animation=!1};GuiPopupEndGame.prototype.calculateTime=function(a){return 3E3<=a?3E3:3E3>a&&2E3<=a?2E3:2E3>a&&1E3<=a?1E3:1E3>a&&100<=a?500:200};
GuiPopupEndGame.prototype.onBack=function(){this.dropPopup();this.loadCoins()};
GuiPopupEndGame.prototype.chargeCoins=function(){0!==DataManager.instance.getGlobalRegister(DataManager.REG_ALL_MISSIONS)?(this.m_totalCoins=Math.floor(ScrollGame.instance.coins*ScrollGame.instance.upgradeCoinMultiplier)+DataManager.instance.getGlobalRegister(DataManager.REG_TOTAL_COINS),this.getControl("mcGuiTxtCoinsNumber").setTextReplace("STR_REP_HUD_COINS_DATA",["#"],[this.m_totalCoins]),DataManager.instance.setGlobalRegister(DataManager.REG_TOTAL_COINS,this.m_totalCoins),this.onShowAlert()):
this.loadCoins()};GuiPopupEndGame.prototype.loadCoins=function(){this.m_totalCoins=DataManager.instance.getGlobalRegister(DataManager.REG_TOTAL_COINS);this.getControl("mcGuiTxtCoinsNumber").setTextReplace("STR_REP_HUD_COINS_DATA",["#"],[this.m_totalCoins]);this.onShowAlert()};
GuiPopupEndGame.prototype.onShowAlert=function(){for(var a=!1,b=0;b<ScrollGame.instance.stores.data.length;b++){var c=ScrollGame.instance.stores.data[b];if(this.m_totalCoins>=c.price&&!c.completed){a=!0;break}}b=DataManager.instance.getGlobalRegister(DataManager.REG_CUTSCENE_END);c=a;0===b&&(c=0===DataManager.instance.getGlobalRegister(DataManager.REG_DEFEAT_MYSTERIO)?a:!1);this.getControl("mcGuiAlert").setVisible(c)};
GuiPopupEndGame.prototype.onStopScreen=function(){SScreen.prototype.onStopScreen.call(this);this.activePress=!1;this.m_animation=!0};
GuiPopupEndGame.prototype.onUIPress=function(a){if(!this.activePress)switch(Application.instance.playSound("SND_UI_CLICK"),SScreen.prototype.onUIPress.call(this,a),a.name){case "mcGuiBtnShop":Application.instance.playSound("SND_UI_CLICK");this.addPopup(GuiPopupStore,"mcGuiScreenShop");break;case "mcGuiBtnHome":Application.instance.playSound("SND_UI_CLICK");this.activePress=!0;this.createTransition(Global.TRANSITION_SPECIAL_IN,0,0,{screen:GuiManager.SC_MAIN_MENU},this.canvas);break;case "mcGuiBtnRetry":Global.trackIsContinue=
!0,Application.externalTrack("game_continue","1"),Application.instance.playSound("SND_UI_PLAY"),this.activePress=!0,this.createTransition(Global.TRANSITION_SPECIAL_IN,0,0,{screen:this.m_callScreenSpecial?GuiManager.SC_CUTSCENE_END:GuiManager.SC_GAME},this.canvas)}};GuiPopupEndGame.prototype.onFinishScreen=function(){switch(this.lastInteractionControl){case "mcGuiBtnHome":GuiManager.instance.gotoScreen(GuiManager.SC_MAIN_MENU);break;case "mcGuiBtnRetry":Global.loaded_gameplay_assets=[],GuiManager.instance.gotoScreen(GuiManager.SC_GAME)}};
GuiPopupEndGame.prototype.onEndTransition=function(a){SScreen.prototype.onEndTransition.call(this,a);null!==a.params&&"undefined"!==typeof a.params.screen&&("mcGuiBtnRetry"==this.lastInteractionControl&&(Global.loaded_gameplay_assets=[]),GuiManager.instance.gotoScreen(a.params.screen))};
GuiPopupEndGame.prototype.update=function(a){SScreen.prototype.update.call(this,a);null!==this.m_record&&this.m_record.update(a);this.m_animation&&this.interpolate&&(this.interpolate.update(a),this.getControl("mcGuiTxtScore").setTextReplace("STR_REP_END_RUN_DISTANCE_DATA",["#"],[~~this.interpolate.values.distance]),this.getControl("mcGuiTxtScore_s").setTextReplace("STR_REP_END_RUN_DISTANCE_DATA",["#"],[~~this.interpolate.values.distance]))};
GuiPopupEndGame.prototype.free=function(){null!==this.m_record&&this.getControl("mcGuiBaseDistance").canvas.removeChild(this.m_record.canvas);this.m_record=null;this.interpolate&&(this.interpolate.free(),this.interpolate=null);SScreen.prototype.free.call(this)};function GuiNewRecord(a,b){this.m_value=a;this.m_isVisible=b;SScreen.call(this,"mcGuiContentMaxRecord",0,0,null);this.canvas.hitArea=null;this.loadInformation()}Application.subclass(GuiNewRecord,SScreen);
GuiNewRecord.prototype.loadInformation=function(){this.getControl("mcGuiTxtMaxRecordNumber").setTextReplace("STR_REP_END_RUN_MAX_RECORD_NUMBER",["#"],[this.m_value]);this.getControl("mcGuiTxtNewRecord").setVisible(this.m_isVisible);this.getControl("mcGuiTxtMaxRecord").setVisible(!this.m_isVisible);this.getControl("mcGuiTxtMaxRecordNumber").setVisible(!this.m_isVisible)};
function GuiPopupEndRun(a,b,c,d){this.m_missions=[];this.m_barMission=null;SScreen.call(this,a,b,c,d);this.setInteractive(!0);this.name="endRun";Application.instance.isPlayingSound("SND_POWERUPS_DRONE_LOOP")&&Application.instance.stopSound("SND_POWERUPS_DRONE_LOOP");this.onLoadData()}Application.subclass(GuiPopupEndRun,SScreen);GuiPopupEndRun.instance=null;GuiPopupEndRun.MAX_MISSIONS=25;
GuiPopupEndRun.prototype.onLoadData=function(){var a=Math.floor(ScrollGame.instance.coins*ScrollGame.instance.upgradeCoinMultiplier),b=DataManager.instance.getGlobalRegister(DataManager.REG_TOTAL_COINS);DataManager.instance.setGlobalRegister(DataManager.REG_TOTAL_COINS,a+b);b=DataManager.instance.getGlobalRegister(DataManager.REG_ALL_COINS);DataManager.instance.setGlobalRegister(DataManager.REG_ALL_COINS,a+b);for(a=1;3>=a;a++)b=new GuiContentMission(ScrollGame.instance.missions.currentMissions[a-
1],0,this.getControl("mcGuiContent_"+a),this),this.getControl("mcGuiContent_"+a).canvas.addChild(b.canvas),this.m_missions.push(b);ScrollGame.instance.missions.onEndRun();ScrollGame.instance.achievements.onEndRun();a=this.checkCompleteMissions();this.m_barMission=new GuiContentBar(this,a);this.getControl("mcGuiContentBar").canvas.addChild(this.m_barMission.canvas);a=ScrollGame.instance.distance;Global.idTitle=1E3<=a?4:this.validateDistance(a);this.getControl("mcGuiTxtTitle").setTextLocalized("STR_REP_END_RUN_TITTLE_"+
Global.idTitle);this.getControl("mcGuiTxtTitle_s").setTextLocalized("STR_REP_END_RUN_TITTLE_"+Global.idTitle);this.onShowButtonNext(!1)};GuiPopupEndRun.prototype.validateDistance=function(a){return 150>=a?1:151<=a&&500>=a?2:3};GuiPopupEndRun.prototype.checkCompleteMissions=function(){for(var a=0,b=ScrollGame.instance.missions.missions,c=0;c<b.length;c++)b[c].completed&&a++;return a};
GuiPopupEndRun.prototype.update=function(a){SScreen.prototype.update.call(this,a);null!==this.m_barMission&&this.m_barMission.update(a);for(var b=0;b<this.m_missions.length;b++)null!==this.m_missions[b]&&this.m_missions[b].update(a)};GuiPopupEndRun.prototype.free=function(){null!==this.m_barMission&&this.getControl("mcGuiContentBar").canvas.removeChild(this.m_barMission.canvas);this.m_missions=[];this.m_barMission=null;SScreen.prototype.free.call(this)};
GuiPopupEndRun.prototype.onStopScreen=function(){SScreen.prototype.onStopScreen.call(this);this.activePress=!1;null!==this.m_barMission&&(this.m_barMission.activeAnimation=!0);this.onShowButtonNext(!0);Common.tween({parent:this,clip:this.getControl("mcGuiBtnNext").canvas,scale:.1},{scale:1},1200,!0,0,TweenEasing.ElasticOut)};GuiPopupEndRun.prototype.onShowButtonNext=function(a){this.getControl("mcGuiBtnNext").setVisible(a)};
GuiPopupEndRun.prototype.onUIPress=function(a){if(!this.activePress)switch(SScreen.prototype.onUIPress.call(this,a),a.name){case "mcGuiBtnNext":this.activePress=!0,this.onResumeScreen()}};GuiPopupEndRun.prototype.onFinishScreen=function(){SScreen.prototype.onFinishScreen.call(this);switch(this.lastInteractionControl){case "mcGuiBtnNext":this.screenParent.dropPopup(),GuiGame.instance.addPopup(GuiPopupEndGame,"mcGuiPopupsEndRun2")}};
GuiPopupEndRun.prototype.onEndTransition=function(a){SScreen.prototype.onEndTransition.call(this,a);null!==a.params&&"undefined"!==typeof a.params.screen&&GuiManager.instance.gotoScreen(a.params.screen)};
function GuiContentBar(a,b){this.parentSC=a;this.m_completedMissions=this.m_animationProgress=this.activeAnimation=!1;this.m_totalProgress=this.m_currentProgress=0;this.m_numMission=b;this.interpolate=null;SScreen.call(this,"mcGuiContentBar",0,0,null);this.canvas.hitArea=null;this.loadInformation()}Application.subclass(GuiContentBar,SScreen);GuiContentBar.MAX_SCALE=11.6;GuiContentBar.PROGRESS_SPEED=8;
GuiContentBar.prototype.loadInformation=function(){if(1===DataManager.instance.getGlobalRegister(DataManager.REG_ALL_MISSIONS))this.getControl("mcGuiTextInfo").setTextLocalized("STR_REP_ENDRUN_ALL_MISSIONS"),this.getControl("mcGuiProgress").clip.getInstance("mcBar").scale.x=GuiContentBar.MAX_SCALE;else{var a=100*GuiContentBar.MAX_SCALE;this.m_currentProgress=Global.oldCurrentMission;this.m_totalProgress=this.m_numMission*a/GuiPopupEndRun.MAX_MISSIONS/100;this.m_animationProgress=!(0===this.m_totalProgress||
this.m_totalProgress===this.m_currentProgress);this.m_numMission===GuiPopupEndRun.MAX_MISSIONS&&(DataManager.instance.setGlobalRegister(DataManager.REG_ALL_MISSIONS,1),DataManager.instance.saveData());this.getControl("mcGuiTextInfo").setTextReplace("STR_REP_ENDRUN_TOTAL_MISSIONS",["#","&"],[Global.oldMission,GuiPopupEndRun.MAX_MISSIONS]);this.getControl("mcGuiProgress").clip.getInstance("mcBar").scale.x=this.m_currentProgress;a=Global.oldMission;this.interpolate=new Interpolate;this.interpolate.setValues(500,
{numMission:a,progress:this.m_currentProgress},{numMission:this.m_numMission,progress:this.m_totalProgress},TweenEasing.LinearNone);this.interpolate.start();this.interpolate.addCompleteListener(this,this.onCompletedProgress);Global.oldMission=this.m_numMission;Global.oldCurrentMission=this.m_totalProgress}};
GuiContentBar.prototype.onCompletedProgress=function(){this.activeAnimation=!1;this.m_animationProgress&&(this.m_numMission===GuiPopupEndRun.MAX_MISSIONS&&(this.m_completedMissions=!0,this.getControl("mcGuiTextInfo").setTextLocalized("STR_REP_ENDRUN_ALL_MISSIONS")),Application.instance.effectManager.createEffect("fxBarMission",0,0,this.getControl("mcContentFX").canvas))};
GuiContentBar.prototype.update=function(a){SScreen.prototype.update.call(this,a);this.activeAnimation&&this.interpolate&&(this.interpolate.update(a),this.m_completedMissions||this.getControl("mcGuiTextInfo").setTextReplace("STR_REP_ENDRUN_TOTAL_MISSIONS",["#","&"],[~~this.interpolate.values.numMission,GuiPopupEndRun.MAX_MISSIONS]),this.getControl("mcGuiProgress").clip.getInstance("mcBar").scale.x=this.interpolate.values.progress)};
function GuiPopupHelp(a,b,c,d){SScreen.call(this,a,b,c,d);this.m_maxPage=this.m_currentPage=1;this.m_page=null;this.m_maxPage=Application.instance.isMobileDevice?5:6;this.setInteractive(!0);this.loadPage()}Application.subclass(GuiPopupHelp,SScreen);GuiPopupHelp.prototype.loadPage=function(){this.m_page=new GuiHelpPage;this.getControl("mcContentImage").canvas.addChild(this.m_page.canvas);this.scrollImageLeft()};
GuiPopupHelp.prototype.onStopScreen=function(){SScreen.prototype.onStopScreen.call(this);this.activePress=!1};GuiPopupHelp.prototype.onUIPress=function(a){if(!this.activePress)switch(SScreen.prototype.onUIPress.call(this,a),Application.instance.playSound("SND_UI_CLICK"),a.name){case "mcGuiBtnClose":this.activePress=!0;this.onResumeScreen();break;case "mcGuiBtnScrollL":this.scrollImageLeft();break;case "mcGuiBtnScrollR":this.scrollImageRight()}};
GuiPopupHelp.prototype.onFinishScreen=function(){SScreen.prototype.onFinishScreen.call(this);switch(this.lastInteractionControl){case "mcGuiBtnClose":this.screenParent&&this.screenParent.addPopup(GuiPopupPause,"mcGuiPopupsPause",0,0)}};
GuiPopupHelp.prototype.onShowButtonsScroll=function(){this.getControl("mcGuiBtnScrollL").canvas.visible=1!==this.m_currentPage;this.getControl("mcGuiBtnScrollR").canvas.visible=this.m_currentPage!==this.m_maxPage;Application.instance.isMobileDevice||4!==this.m_currentPage?this.getControl("mcGuiTxtInfo").setTextLocalized("STR_REP_TUTORIAL_INFO_"+this.m_currentPage):this.getControl("mcGuiTxtInfo").setTextLocalized("STR_REP_TUTORIAL_INFO_4_PC")};
GuiPopupHelp.prototype.scrollImageLeft=function(){this.m_currentPage--;this.m_currentPage=1>=this.m_currentPage?1:this.m_currentPage;this.m_page.changeImage(this.m_currentPage);this.onShowButtonsScroll()};GuiPopupHelp.prototype.scrollImageRight=function(){this.m_currentPage++;this.m_currentPage=this.m_currentPage>=this.m_maxPage?this.m_maxPage:this.m_currentPage;this.m_page.changeImage(this.m_currentPage);this.onShowButtonsScroll()};
GuiPopupHelp.prototype.update=function(a){SScreen.prototype.update.call(this,a);null!==this.m_page&&this.m_page.update(a)};GuiPopupHelp.prototype.free=function(){SScreen.prototype.free.call(this)};
function GuiHelpPage(){this.m_oldY=this.m_oldX=0;SScreen.call(this,"mcGuiPageHelp",0,0,null);this.name="help_page";this.m_oldX=this.getControl("mcGuiArrow").canvas.position.x;this.m_oldY=this.getControl("mcGuiArrow").canvas.position.y;Application.instance.effectManager.createEffect("fxBarFull",0,0,this.getControl("fx_clip_1").canvas);Application.instance.effectManager.createEffect("fxStylishObj",0,0,this.getControl("fx_clip_2").canvas);Application.instance.effectManager.createEffect("fxDroneSmokeInPlayer",
0,0,this.getControl("fx_clip_3").canvas);this.getControl("fx_clip_1").setVisible(!1);this.getControl("fx_clip_2").setVisible(!1);this.getControl("fx_clip_3").setVisible(!1)}Application.subclass(GuiHelpPage,SScreen);
GuiHelpPage.prototype.changeImage=function(a){this.getControl("fx_clip_1").setVisible(!1);this.getControl("fx_clip_2").setVisible(!1);this.getControl("fx_clip_3").setVisible(!1);var b="mcGuiTutorialsTap",c=this.m_oldX,d=this.m_oldY;switch(a){case 1:b="mcGuiTutorialsPressandhold";break;case 3:this.getControl("fx_clip_1").setVisible(!0);this.getControl("fx_clip_2").setVisible(!0);break;case 4:b="mcGuiTutorialsStylish";break;case 5:this.getControl("fx_clip_3").setVisible(!0);break;case 6:c=this.m_oldX-
110,d=this.m_oldY-20,b="mcGuiTutorialsTapButton"}this.getControl("mcGuiArrow").canvas.position.x=c;this.getControl("mcGuiArrow").canvas.position.y=d;this.getControl("mcGuiArrow").setClip(b+(Application.instance.isMobileDevice?"":"_pc"));this.getControl("mcGuiBackground").setClip("mcGuiTutorials0"+a);a=2===a||3===a?!1:!0;this.getControl("mcGuiArrow").setVisible(a)};function GuiPopupQuit(a,b,c,d){GuiConfirm.call(this,a,b,c,d);this.name="popup_quit";this.localizedText("STR_REP_POPUP_QUIT_TITLE")}
Application.subclass(GuiPopupQuit,GuiConfirm);GuiPopupQuit.prototype.onPressNo=function(){this.screenParent&&this.screenParent.addPopup(GuiPopupPause,"mcGuiPopupsPause",0,0)};GuiPopupQuit.prototype.onPressYes=function(){GuiManager.instance.gotoScreen(GuiManager.SC_MAIN_MENU)};
function GuiPopupCheats(a,b,c,d){SScreen.call(this,a,b,c,d);this.setInteractive(!0);this.name="cheats";for(a=0;3>a;a++)b=Global.game.missions.onCheckingMissionIsComplete(a),this.getControl("mcGuiBtnM_"+(a+1)).setEnabled(!b),this.getControl("mcGuiBtnM_"+(a+1)).setInteractive(!b),c=b?"_off":"",this.getControl("mcGuiMission_"+(a+1)).setClip("gui_shop_panel_price"+c),this.getControl("mcGuiMission_"+(a+1)).clip.alpha=b?.7:1}Application.subclass(GuiPopupCheats,SScreen);
GuiPopupCheats.prototype.onUIPress=function(a){SScreen.prototype.onUIPress.call(this,a);if(!this.activePress)switch(Application.instance.playSound("SND_UI_CLICK"),a.name){case "mcGuiBtnM_1":case "mcGuiBtnM_2":case "mcGuiBtnM_3":var b=parseInt(a.name.substr(10),10);Global.game.missions.onCheatsMission(b-1);this.getControl(a.name).setEnabled(!1);this.getControl(a.name).setInteractive(!1);this.getControl("mcGuiMission_"+b).setClip("gui_shop_panel_price_off");this.getControl("mcGuiMission_"+b).clip.alpha=
.7;break;case "mcGuiBtnCoins":Global.game.addCoins(100);break;case "mcGuiBtnClose":this.activePress=!0,this.onResumeScreen()}};GuiPopupCheats.prototype.onStopScreen=function(){SScreen.prototype.onStopScreen.call(this);this.activePress=!1};GuiPopupCheats.prototype.onFinishScreen=function(){SScreen.prototype.onFinishScreen.call(this);switch(this.lastInteractionControl){case "mcGuiBtnClose":this.screenParent.dropPopup()}};
GuiPopupCheats.prototype.onEndTransition=function(a){SScreen.prototype.onEndTransition.call(this,a);a.params&&Application.instance.guiManager.gotoScreen(a.params.screen)};function GuiPopupMissions(a,b,c,d){this.m_intro=this.m_content=null;SScreen.call(this,a,b,c,d);this.setInteractive(!0);this.name="pause";this.activePressBar();this.createContent()}Application.subclass(GuiPopupMissions,SScreen);GuiPopupMissions.prototype.onLoadPopup=function(a){this.m_intro=a};
GuiPopupMissions.prototype.createContent=function(){this.m_content=new GuiAllMissions;this.getControl("mcGuiContent").canvas.addChild(this.m_content.canvas)};GuiPopupMissions.prototype.onUIPress=function(a){SScreen.prototype.onUIPress.call(this,a);if(!this.activePress)switch(Application.instance.playSound("SND_UI_CLICK"),a.name){case "mcGuiBtnQuit":this.activePress=!0,this.onResumeScreen()}};
GuiPopupMissions.prototype.onStopScreen=function(){SScreen.prototype.onStopScreen.call(this);this.activePress=!1};GuiPopupMissions.prototype.onFinishScreen=function(){SScreen.prototype.onFinishScreen.call(this);switch(this.lastInteractionControl){case "mcGuiBtnQuit":this.screenParent.dropPopup(),this.m_intro.onCreateMessage()}};
GuiPopupMissions.prototype.onPressSpaceBar=function(){this.activePress||(SScreen.prototype.onPressSpaceBar.call(this),this.lastInteractionControl="mcGuiBtnQuit",this.activePress=!0,this.onResumeScreen())};GuiPopupMissions.prototype.onPointerPress=function(a){this.activePress||(this.lastInteractionControl="mcGuiBtnQuit",this.activePress=!0,this.onResumeScreen())};GuiPopupMissions.prototype.update=function(a){SScreen.prototype.update.call(this,a);null!==this.m_content&&this.m_content.update(a)};
GuiPopupMissions.prototype.free=function(){this.getControl("mcGuiContent").canvas.removeChild(this.m_content.canvas);this.m_content.free();this.m_content=null;SScreen.prototype.free.call(this)};function GuiAllMissions(){this.m_missions=[];SScreen.call(this,"mcGuiContentAllMission",0,0,null);this.canvas.hitArea=null;this.createMissions()}Application.subclass(GuiAllMissions,SScreen);
GuiAllMissions.prototype.createMissions=function(){for(var a=1;3>=a;a++){var b=ScrollGame.instance.missions.currentMissions[a-1],c=new GuiContentMission(b,0,this.getControl("mcGuiContent_"+a),this);this.getControl("mcGuiContent_"+a).canvas.addChild(c.canvas);this.getControl("mcGuiContent_"+a).setVisible(!b.completed);this.m_missions.push(c)}};GuiAllMissions.prototype.update=function(a){SScreen.prototype.update.call(this,a);for(var b=0;b<this.m_missions.length;b++)null!==this.m_missions[b]&&this.m_missions[b].update(a)};
GuiAllMissions.prototype.free=function(){this.m_missions=[];SScreen.prototype.free.call(this)};function GuiPopupReset(a,b,c,d){GuiConfirm.call(this,a,b,c,d);this.name="popup_reset";this.localizedText("STR_REP_POPUP_RESET_TITLE")}Application.subclass(GuiPopupReset,GuiConfirm);GuiPopupReset.prototype.onPressNo=function(){this.screenParent&&this.screenParent.dropPopup()};GuiPopupReset.prototype.onPressYes=function(){this.screenParent&&(DataManager.instance.resetData(),this.screenParent.dropPopup())};
function GuiPopupCredits(a,b,c,d){SScreen.call(this,a,b,c,d);this.name="popup_credits";this.m_logoMarvel=this.m_logoBamtang=null;this.activePress=!0;this.setInteractive(!0);this.initLocalizedSprites();this.createTransition(Global.TRANSITION_SPECIAL_OUT,0,0,{},this.canvas)}Application.subclass(GuiPopupCredits,SScreen);
GuiPopupCredits.prototype.initLocalizedSprites=function(){this.m_logoBamtang=Application.instance.getLocalizedImage("gui_screens_credits_logo01.png");this.m_logoMarvel=Application.instance.getLocalizedImage("gui_screens_credits_logo02.png");this.controls.mcGuiLogoBamtang&&(this.getControl("mcGuiLogoBamtang").clip.addChild(this.m_logoBamtang),this.m_logoBamtang.pivot.x=188,this.m_logoBamtang.pivot.y=99);this.controls.mcGuiLogoMarvel&&(this.getControl("mcGuiLogoMarvel").clip.addChild(this.m_logoMarvel),
this.m_logoMarvel.pivot.x=123,this.m_logoMarvel.pivot.y=50)};GuiPopupCredits.prototype.onStopScreen=function(){SScreen.prototype.onStopScreen.call(this);this.activePress=!1};GuiPopupCredits.prototype.onFinishScreen=function(){SScreen.prototype.onFinishScreen.call(this)};GuiPopupCredits.prototype.onEndTransition=function(a){SScreen.prototype.onEndTransition.call(this,a);null!==a.params&&"undefined"!==typeof a.params.screen&&("POPUP"===a.params.screen?this.screenParent.returnCredits():GuiManager.instance.gotoScreen(a.params.screen))};
GuiPopupCredits.prototype.onUIPress=function(a){if(!this.activePress)switch(SScreen.prototype.onUIPress.call(this,a),Application.instance.playSound("SND_UI_CLICK"),a.name){case "mcGuiBtnBack":this.activePress=!0,this.createTransition(Global.TRANSITION_SPECIAL_IN,0,0,{screen:"POPUP"},this.canvas)}};
GuiPopupCredits.prototype.free=function(){null!=this.m_logoBamtang&&(this.getControl("mcGuiLogoBamtang").clip.removeChild(this.m_logoBamtang),this.m_logoBamtang.free(),this.m_logoBamtang=null);null!=this.m_logoMarvel&&(this.getControl("mcGuiLogoMarvel").clip.removeChild(this.m_logoMarvel),this.m_logoMarvel.free(),this.m_logoMarvel=null);SScreen.prototype.free.call(this)};
function GuiPopupTutorial(a,b,c,d){SScreen.call(this,a,b,c,d);this.name="popup_tutorial";this.m_page=this.m_intro=null;this.m_idTutorial=0;this.activePress=!0;this.setInteractive(!0);this.m_page=new GuiTutorialPage;this.getControl("mcContentImage").canvas.addChild(this.m_page.canvas);a=Application.instance.isMobileDevice?"STR_REP_DIALOGUE_TAP":"STR_REP_DIALOGUE_TAP_PC";this.getControl("mcGuiTextTap").setTextLocalized(a)}Application.subclass(GuiPopupTutorial,SScreen);
GuiPopupTutorial.ID_TUTORIAL_LAUNCH=1;GuiPopupTutorial.ID_TUTORIAL_DRONE=2;GuiPopupTutorial.ID_TUTORIAL_PAUSE=3;GuiPopupTutorial.ID_TUTORIAL_GRAB=4;GuiPopupTutorial.prototype.onStopScreen=function(){SScreen.prototype.onStopScreen.call(this);this.activePress=!1};GuiPopupTutorial.prototype.onPointerPress=function(a){this.activePress||(this.lastInteractionControl="mcGuiBtnClose",this.activePress=!0,this.onResumeScreen())};
GuiPopupTutorial.prototype.onFinishScreen=function(){SScreen.prototype.onFinishScreen.call(this);switch(this.lastInteractionControl){case "mcGuiBtnClose":this.m_intro.resetValue(),this.screenParent.dropPopup()}};GuiPopupTutorial.prototype.onUIPress=function(a){if(!this.activePress)switch(SScreen.prototype.onUIPress.call(this,a),Application.instance.playSound("SND_UI_CLICK"),a.name){case "mcGuiBtnClose":this.activePress=!0,this.onResumeScreen()}};
GuiPopupTutorial.prototype.onLoadPage=function(a,b){var c="";this.m_idTutorial=a;switch(this.m_idTutorial){case GuiPopupTutorial.ID_TUTORIAL_LAUNCH:c="STR_REP_TUTORIAL_INFO_4"+(Application.instance.isMobileDevice?"":"_PC");break;case GuiPopupTutorial.ID_TUTORIAL_DRONE:c="STR_REP_TUTORIAL_INFO_5";break;case GuiPopupTutorial.ID_TUTORIAL_PAUSE:c="STR_REP_TUTORIAL_INFO_6";break;case GuiPopupTutorial.ID_TUTORIAL_GRAB:c="STR_REP_TUTORIAL_INFO_3"}this.m_intro=b;null!==this.m_page&&this.m_page.changeImage(this.m_idTutorial);
this.getControl("mcGuiTxtInfo").setTextLocalized(c)};GuiPopupTutorial.prototype.update=function(a){SScreen.prototype.update.call(this,a);null!==this.m_page&&this.m_page.update(a)};
function GuiTutorialPage(){this.m_oldY=this.m_oldX=0;SScreen.call(this,"mcGuiPageHelp",0,0,null);this.name="help_page";this.m_oldX=this.getControl("mcGuiArrow").canvas.position.x;this.m_oldY=this.getControl("mcGuiArrow").canvas.position.y;Application.instance.effectManager.createEffect("fxBarFull",0,0,this.getControl("fx_clip_1").canvas);Application.instance.effectManager.createEffect("fxStylishObj",0,0,this.getControl("fx_clip_2").canvas);Application.instance.effectManager.createEffect("fxDroneSmokeInPlayer",
0,0,this.getControl("fx_clip_3").canvas);this.getControl("fx_clip_1").setVisible(!1);this.getControl("fx_clip_2").setVisible(!1);this.getControl("fx_clip_3").setVisible(!1)}Application.subclass(GuiTutorialPage,SScreen);
GuiTutorialPage.prototype.changeImage=function(a){this.getControl("fx_clip_1").setVisible(!1);this.getControl("fx_clip_2").setVisible(!1);this.getControl("fx_clip_3").setVisible(!1);var b="",c="",d=this.m_oldX,e=this.m_oldY;switch(a){case 1:b="mcGuiTutorialsStylish";c="mcGuiTutorials04";break;case 2:b="mcGuiTutorialsTap";c="mcGuiTutorials05";this.getControl("fx_clip_3").setVisible(!0);break;case 3:d=this.m_oldX-110;e=this.m_oldY-20;b="mcGuiTutorialsTapButton";c="mcGuiTutorials06";break;case 4:this.getControl("fx_clip_1").setVisible(!0),
this.getControl("fx_clip_2").setVisible(!0),c="mcGuiTutorials03"}""===b?this.getControl("mcGuiArrow").setVisible(!1):(this.getControl("mcGuiArrow").canvas.position.x=d,this.getControl("mcGuiArrow").canvas.position.y=e,this.getControl("mcGuiArrow").setClip(b+(Application.instance.isMobileDevice?"":"_pc")));this.getControl("mcGuiBackground").setClip(c)};
PIXI.Container.prototype.countChildren=function(){if(!this.children)return 1;for(var a=this.children.length,b=0,c=this.children.length;b<c;b++)this.children[b].countChildren&&(a+=this.children[b].countChildren());return a};Application.warn("SwitJS[850] Mon Jul  1 08:58:19 2019 (PC-BG-020) <v20190121>");
