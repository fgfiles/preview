/* Created by Olphabet */var TProject;!function(a){var b=function(){function a(){}return a}();b.TYPE_MOUNTAIN=1,b.TYPE_ROCK=2,b.TYPE_SNOWBALL=3,b.TYPE_PLAYER=4,b.TYPE_DEAD_PLAYER=5,b.TYPE_DECORATION=6,a.BodyInfo=b}(TProject||(TProject={}));var TProject;!function(a){var b=function(){function a(a,b,c){this.type=a,this.body=b,this.soundsArray=c}return a}();b.DD_TYPE_TREE=0,b.DD_TYPE_GUNTER=1,b.DD_TYPE_SNOWMAN=2,b.collisionCounts=[0,0,0],a.DecorationData=b}(TProject||(TProject={}));var TProject;!function(a){var b=function(){function b(){this.pool=[],this.index=0}return b.prototype.fill=function(b,c){for(var d=0;d<c;++d){var e=a.BaseGame.FX_ANIMATIONS[b[d%b.length]];this.pool.push(e),e.animations.getAnimation("play").onComplete.add(function(a){return e.alpha=0})}},b.prototype.update=function(){},b.prototype.getMC=function(){return this.index=(this.index+1)%this.pool.length,this.pool[this.index]},b}();a.FXPool=b}(TProject||(TProject={}));var GamesConfig;!function(a){var b=function(){function a(){}return a}();b.density=1,b.friction=.35/.726,b.restitution=.1/.726,b.terraceSizes=[80,90,100,110,120],b.slopeSizes=[120,140,160,180],b.slopeAngle=[20,30],b.rocksByDistance=[[100,0,1],[200,0,2],[300,0,2],[400,0,3],[500,0,3]],b.rocks=[[7,6.4,.4,.3,0,10],[5,7.2,.45,.3,0,10],[9,8.25,.5,.3,0,10],[10,10.5,.55,.3,0,10]],b.snowballs=[[.0363,.3,0,10],[.0363,.3,0,10],[.0363,.3,0,10],[.0363,.3,0,10]],b.snowballBreakImpulse=.7,b.treeChancesTerrace=.1,b.treeCountTerrace=[1,3],b.treeChancesSlope=.7,b.treeCountSlope=[2,5],b.treeMoveToBodyFactor=[.5,.7],b.terraceDecorationChances=[10,10,10],b.bgsOffsetX=[-15,10],b.bgsOffsetY=[0,50],b.bgsChances=[10,10,1,1],a.Mountain=b;var c=function(){function a(){}return a}();c.startPos=new Phaser.Point(-150,-50),c.scrollFactor=1.5,c.separationX=450,a.Foreground=c;var d=function(){function a(){}return a}();d.characters=[["player_jake",0,14,17,1.5,.3,0,1500],["player_finn",1500,14,20,1.5,.3,0,1500],["player_bmo",3e3,12,15,1.5,.3,0,1500],["player_bubblegum",6e3,14,20,1.5,.3,0,1500],["player_iceking",9e3,14,20,1.5,.3,0,1500],["player_lumpy",15e3,14,17,1.5,.3,0,1500],["player_marceline",21e3,14,20,1.5,.3,0,1500]],d.groupBody=[0,0,0,0,0,0],d.launchSpeedMin=[7,-6],d.launchSpeedMax=[9,-8],d.launchTorqueMin=2,d.launchTorqueMax=7,d.launchPowerSpeed=1.5,d.iconEasing=.4,d.iconOnWait=1,d.impulseForHitAnimation=2.5,d.impulseForBounceSound=4,d.speedForHitFX=5,d.speedForBounceFX=5,a.Players=d;var e=function(){function a(){}return a}();e.followCharacter=!0,e.splitCooldown=1,e.splitSpeedLimit=.2,e.splitBonusSpeed=[[4,-1],[0,0]],e.splitSoloOffsetRotation=40,e.levitateDuration=5,e.levitateStrength=[0,-10],e.growDuration=5,e.growDefinition=[16,35,.8,.3,0],e.growTweenConfig=[.4,"easeOutBack"],e.bounceDuration=10,e.bounceStrength=.6,e.breakRocksDuration=5,e.soundBurstStrength=150,e.soundBurstRadius=250,a.Skills=e;var f=function(){function a(){}return a}();f.debug=!1,f.worldScale=1,f.HEIGHT=480,f.gravity=[0,10],f.wipeDistance=1e3,f.wipeHeight=100,f.gameOverSpeed=.2,f.gameOverTime=1,f.characterClickRadius=35,f.worldScaleInverse=1,f.WIDTH=640,f.STATE_MENU=1,f.STATE_MENU_OUT=2,f.STATE_PRE_LAUNCH=3,f.STATE_AVALANCHE=4,f.STATE_GAME_OVER=5,f.STATE_PAUSE=6,f.STATE_RESET=7,f.SKILL_CHAR_SPLIT=1,f.SKILL_CHAR_LEVITATE=2,f.SKILL_CHAR_GROW=4,f.SKILL_CHAR_BOUNCE=8,f.SKILL_CHAR_BREAK_ROCKS=16,f.SKILL_GLOBAL_FROZE_ROCKS=32,f.SKILL_GLOBAL_REMOVE_ROCKS=64,f.SKILL_GLOBAL_SOUND_BURST=128,f.SKILL_MASK_ALL=255,a.Game=f;var g=function(){function a(){}return a}();g.speedFactor=.5,g.target=[.2,.4],g.changeTime=3,g.trackSpeed=.3,g.bgScrollFactor=.1,g.cloudsScrollFactorX=.2,g.cloudsScrollFactorY=.1,g.cloudsScaleRange=[.2,1],g.cloudsSpeed=[0,0],g.cloudBaseY=250,a.Camera=g;var h=function(){function a(){}return a}();h.amountToRestoreSkills=3,h.maxSpeedValue=25,h.wnumbererFugitiveValue=5e3,h.winterFugitiveValue=5e3,h.soundOfMusicValue=4,h.swordValue=15,h.decorationHitsValues=[150,10,5],a.Medals=h;var i=function(){function a(){}return a}();i.DEG_TO_RAD=Math.PI/180,i.RAD_TO_DEG=180/Math.PI,a.General=i}(GamesConfig||(GamesConfig={}));var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),TProject;!function(a){var b=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.create=function(){this.isPaused=!1,this._debugMode=!1,this.game.device.desktop},b.prototype.clearKeyBoard=function(){for(var a in b.keysDown)b.keysDown[a]=!1,b.keysPressed[a]=!1},b.prototype.update=function(){for(var a in b.keysPressed)b.keysPressed[a]=!1},b.prototype.onKeyDown=function(a){b.ValidKeyCodes.indexOf(a.keyCode)>-1&&!b.keysDown[a.keyCode]&&(b.keysDown[a.keyCode]=!0,b.keysPressed[a.keyCode]=!0)},b.prototype.onKeyUp=function(a){b.ValidKeyCodes.indexOf(a.keyCode)>-1&&(b.keysDown[a.keyCode]=!1,b.keysPressed[a.keyCode]=!1)},b.prototype.isAnyKeyPressed=function(){for(var a in b.keysPressed)if(b.keysPressed[a])return!0;return!1},b.prototype.simulateKey=function(a,c){void 0===c&&(c=!0),c?b.ValidKeyCodes.indexOf(a)>-1&&!b.keysDown[a]&&(b.keysDown[a]=!0,b.keysPressed[a]=!0):b.ValidKeyCodes.indexOf(a)>-1&&(b.keysDown[a]=!1,b.keysPressed[a]=!1)},b.prototype.shutdown=function(){this.game.device.desktop,this.free()},b.prototype.setDebugMode=function(){this.game.time.advancedTiming=!0,this._debugMode=!0},b.prototype.free=function(){},b.prototype.replay=function(){},b.prototype.render=function(){this._debugMode&&this.game.debug.text(""+this.game.time.fps,2,14,"#00ff00")},Object.defineProperty(b.prototype,"currentLevel",{set:function(a){b.CURRENT_LEVEL=a},enumerable:!0,configurable:!0}),b}(Phaser.State);b.ValidKeyCodes=[Phaser.Keyboard.LEFT,Phaser.Keyboard.RIGHT,Phaser.Keyboard.UP,Phaser.Keyboard.DOWN,Phaser.Keyboard.W,Phaser.Keyboard.A,Phaser.Keyboard.S,Phaser.Keyboard.D],b.keysPressed={},b.keysDown={},b.CURRENT_LEVEL=0,a.AbstractGame=b;var c=function(a){function b(b,c,d,e,f){void 0===d&&(d=!1),void 0===e&&(e=0),void 0===f&&(f=0);var g=this;switch(g=a.call(this,b.game,e,f,"IngameUI","mobileButton")||this,c){case Phaser.Keyboard.LEFT:g.angle=-90;break;case Phaser.Keyboard.RIGHT:g.angle=90;break;case Phaser.Keyboard.UP:g.angle=0;break;case Phaser.Keyboard.DOWN:g.angle=180}return g._code=c,g._name=name,g.anchor.set(.5),g.inputEnabled=!1,g.defScale=1,g._sticky=d,g._agame=b,g.enabled=!0,g._agame.game.world.add(g),g}return __extends(b,a),Object.defineProperty(b.prototype,"enabled",{get:function(){return this.inputEnabled},set:function(a){a&&this.enabled||(this.inputEnabled=a,a?(this.events.onInputDown.add(this.down,this),this.events.onInputUp.add(this.up,this)):(this.events.onInputDown.removeAll(this),this.events.onInputUp.removeAll(this)))},enumerable:!0,configurable:!0}),b.prototype.update=function(){this._down&&this._sticky&&this.down()},b.prototype.testUp=function(){this.input.pointerDown()&&this._down&&this.up()},b.prototype.up=function(){this._agame.simulateKey(this._code,!1),this._down=!1,this.scale.set(this.defScale,1)},b.prototype.down=function(){if(!this._agame.isPaused){var a=!1;this._sticky&&(this._agame.simulateKey(this._code),a=!0),this._down||(this._down=!0,this.scale.set(.9*this.defScale,.9),a||this._agame.simulateKey(this._code))}},b.prototype.setPos=function(a,b){void 0===a&&(a=0),void 0===b&&(b=0),this.x=a,this.y=b},b}(Phaser.Sprite);a.SimpleButton=c}(TProject||(TProject={}));var TProject;!function(a){var b=function(){function a(){if(this._saveDataName="~NoName~",null!=a._instance)throw"Попытка создать дубликат SaveManager!";a._instance=this}return Object.defineProperty(a,"getInstance",{get:function(){return null==a._instance&&new a,a._instance},enumerable:!0,configurable:!0}),a.prototype.init=function(a,b){this._saveDataName=a,this._saveData=b},a.prototype.save=function(){return!!a._canSave&&(localStorage.setItem(this._saveDataName,JSON.stringify(this._saveData)),!0)},a.prototype.load=function(){if(a._canSave=!1,!this.isLocalStorageNameSupported())return void this._saveData.reset();a._canSave=!0;var b=JSON.parse(localStorage.getItem(this._saveDataName));return null==b?(this.save(),this._saveData):(this._saveData=b,this._saveData)},a.prototype.isLocalStorageNameSupported=function(){var a="test",b=window.localStorage;try{return b.setItem(a,"1"),b.removeItem(a),!0}catch(a){return!1}},a}();a.SaveManager=b}(TProject||(TProject={}));var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),TProject;!function(a){var b=function(a){function b(b,c,d,e){void 0===d&&(d=0);var f=a.call(this,b,0,0)||this;return b.world.add(f),f._images=[],f._images.push(new Phaser.Image(b,d,0,c,e)),f._imgWidth=f._images[0].width,f._images.push(new Phaser.Image(b,d+f._imgWidth-1,0,c,e)),f.addChild(f._images[0]),f.addChild(f._images[1]),f}return __extends(b,a),b.prototype.updateScroll=function(a){this._images[0].x-=a,this._images[1].x-=a,this._images[0].x<=-this._imgWidth&&(this._images[0].x=this._images[1].x+this._imgWidth-1),this._images[1].x<=-this._imgWidth&&(this._images[1].x=this._images[0].x+this._imgWidth-1)},b.prototype.free=function(){this.removeChild(this._images[0]),this.removeChild(this._images[1]),this._images.pop().destroy(!0),this._images.pop().destroy(!0),this._images=null},b.prototype.setPosition=function(a){this._images[0].x=a,this._images[1].x=a+this._imgWidth-1},b}(Phaser.Sprite);a.ParallaxImage=b}(TProject||(TProject={}));var TProject;!function(a){var b=function(){function a(a,b){this.names=[],this.chances=[];var c,d=0;for(c=0;c<b.length;++c)d+=b[c],this.chances.push(d),this.names.push(a[c])}return a.prototype.pickOne=function(){var a,b=Utils.randomRangeI(0,100);for(a=0;a<this.chances.length;++a)if(b<this.chances[a])return this.names[a];return null},a}();a.MysteryBox=b}(TProject||(TProject={}));var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),dragonBones;!function(a){var b=function(b){function c(a){var c=b.call(this,a)||this;return c._eventDispatcher=new EventEmitter,c}return __extends(c,b),c.prototype._onClear=function(){this._debugDrawer,this._armature=null,this._debugDrawer=null,this.destroy()},c.prototype._debugDraw=function(a){},c.prototype.hasEvent=function(a){return this._eventDispatcher.listeners(a,!0)},c.prototype.addEvent=function(a,b,c){this._eventDispatcher.addListener(a,b,c)},c.prototype.removeEvent=function(a,b,c){this._eventDispatcher.removeListener(a,b,c)},c.prototype._dispatchEvent=function(a,b){this._eventDispatcher.emit(a,b)},c.prototype.dispose=function(a){void 0===a&&(a=!0),this._armature&&(this._armature.dispose(),this._armature=null)},Object.defineProperty(c.prototype,"armature",{get:function(){return this._armature},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"animation",{get:function(){return this._armature.animation},enumerable:!0,configurable:!0}),c.prototype.advanceTimeBySelf=function(b){b?this._armature.clock=a.PhaserFactory._clock:this._armature.clock=null},c}(Phaser.Group);a.PhaserArmatureDisplay=b}(dragonBones||(dragonBones={}));var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),dragonBones;!function(a){var b=function(b){function c(d,e){void 0===d&&(d=null);var f=b.call(this,d)||this;return c._eventManager||(c._eventManager=new a.PhaserArmatureDisplay(e),c._clock=new a.WorldClock,c._game=e),f}return __extends(c,b),c._clockHandler=function(a){void 0===a&&(a=-1),null!=c._clock&&c._clock.advanceTime(a)},Object.defineProperty(c,"clock",{get:function(){return c._clock},enumerable:!0,configurable:!0}),Object.defineProperty(c,"factory",{get:function(){return c._factory||(c._factory=new c(null,this._game)),c._factory},enumerable:!0,configurable:!0}),c.startLoop=function(a){void 0===a&&(a=20),c._clockID=setInterval(function(){c._clockHandler()},a)},c.stopLoop=function(){c._clockID!=-1&&clearInterval(c._clockID)},c.prototype._generateTextureAtlasData=function(b,c){return b?b.texture=c:b=a.BaseObject.borrowObject(a.PhaserTextureAtlasData),b},c.prototype._generateArmature=function(b){var d=a.BaseObject.borrowObject(a.Armature),e=new a.PhaserArmatureDisplay(c._game);return e._armature=d,d._init(b.armature,b.skin,e,e,c._eventManager),d},c.prototype._generateSlot=function(b,d,e){var f=a.BaseObject.borrowObject(a.PhaserSlot);f._init(d,new Phaser.Sprite(c._game,null,null),null);for(var g=[],h=0,i=d.displays.length;h<i;++h){var j=d.displays[h];switch(j.type){case 0:j.texture&&!b.textureAtlasName||(j.texture=this._getTextureData(b.textureAtlasName||b.dataName,j.path)),g.push(f.rawDisplay);break;case 2:j.texture&&!b.textureAtlasName||(j.texture=this._getTextureData(b.textureAtlasName||b.dataName,j.path)),!j.mesh&&j.share&&(j.mesh=d.getMesh(j.share)),g.push(f.meshDisplay);break;case 1:var k=this.buildArmature(j.path,b.dataName,null,b.textureAtlasName);if(k){if(k.inheritAnimation=j.inheritAnimation,!k.inheritAnimation){var l=d.slot.actions.length>0?d.slot.actions:k.armatureData.actions;if(l.length>0)for(var m=0,n=l.length;m<n;++m)k._bufferAction(l[m]);else k.animation.play()}j.armature=k.armatureData}g.push(k);break;default:g.push(null)}}return f._setDisplayList(g),f},c.prototype.buildArmatureDisplay=function(a,b,d,e){void 0===b&&(b=null),void 0===d&&(d=null),void 0===e&&(e=null);var f=this.buildArmature(a,b,d,e);if(f){var g=f.display;return c._clock.add(f),g}return null},c.prototype.getTextureDisplay=function(a,b){void 0===b&&(b=null);var c=this._getTextureData(b,a);if(c){if(!c.texture){var d=c.parent.texture,e=new PIXI.Rectangle(0,0,c.region.width,c.region.height);c.texture=new PIXI.Texture(d,null,c.region,e)}return new PIXI.Sprite(c.texture)}return null},Object.defineProperty(c.prototype,"soundEventManater",{get:function(){return c._eventManager},enumerable:!0,configurable:!0}),c}(a.BaseFactory);b._factory=null,b._eventManager=null,b._clock=null,b._clockID=-1,a.PhaserFactory=b}(dragonBones||(dragonBones={}));var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),dragonBones;!function(a){var b=function(b){function c(){var a=b.call(this)||this;return a._renderDisplayX=0,a._renderDisplayY=0,a}return __extends(c,b),c.toString=function(){return"[class dragonBones.PhaserSlot]"},c.prototype._onClear=function(){b.prototype._onClear.call(this),this._renderDisplay=null},c.prototype._initDisplay=function(a){},c.prototype._disposeDisplay=function(a){a&&a.destroy()},c.prototype._onUpdateDisplay=function(){this._renderDisplay=this._display?this._display:this._rawDisplay},c.prototype._addDisplay=function(){var a=this._armature.display;a.addChild(this._renderDisplay),this._renderDisplayX=0*this.armature.getBone(this.name).origin.x,this._renderDisplayY=0*this.armature.getBone(this.name).origin.y},c.prototype._replaceDisplay=function(a){var b=this._armature.display,c=a;b.addChild(this._renderDisplay),b.swapChildren(this._renderDisplay,c),b.removeChild(c)},c.prototype._removeDisplay=function(){this._renderDisplay.parent.removeChild(this._renderDisplay)},c.prototype._updateZOrder=function(){var a=this._armature.display;a.addChildAt(this._renderDisplay,this._zOrder)},c.prototype._updateVisible=function(){this._renderDisplay.visible=this._parent.visible},c.prototype._updateBlendMode=function(){switch(this._blendMode){case 0:this._renderDisplay.blendMode=PIXI.blendModes.NORMAL;break;case 1:this._renderDisplay.blendMode=PIXI.blendModes.ADD;break;case 3:this._renderDisplay.blendMode=PIXI.blendModes.DARKEN;break;case 4:this._renderDisplay.blendMode=PIXI.blendModes.DIFFERENCE;break;case 6:this._renderDisplay.blendMode=PIXI.blendModes.HARD_LIGHT;break;case 9:this._renderDisplay.blendMode=PIXI.blendModes.LIGHTEN;break;case 10:this._renderDisplay.blendMode=PIXI.blendModes.MULTIPLY;break;case 11:this._renderDisplay.blendMode=PIXI.blendModes.OVERLAY;break;case 12:this._renderDisplay.blendMode=PIXI.blendModes.SCREEN}},c.prototype._updateColor=function(){this._renderDisplay.alpha=this._colorTransform.alphaMultiplier},c.prototype._updateFrame=function(){var b=this._meshData&&this._display===this._meshDisplay,c=this._textureData;if(this._displayIndex>=0&&this._display&&c){var d=c.parent;this._armature.replacedTexture&&this._displayData&&d===this._displayData.texture.parent&&(d=this._armature._replaceTextureAtlasData,d||(d=a.BaseObject.borrowObject(a.PhaserTextureAtlasData),d.copyFrom(c.parent),d.texture=this._armature.replacedTexture,this._armature._replaceTextureAtlasData=d),c=d.getTexture(c.name));var e=d.texture;if(e){if(c.texture||(c.texture=new PIXI.Texture(e,c.region,c.region,new PIXI.Rectangle(0,0,c.region.width,c.region.height))),b){var f=this._renderDisplay,g=e?e.width:1,h=e?e.height:1;f.uvs=new Float32Array(this._meshData.uvs),f.vertices=new Float32Array(this._meshData.vertices),f.indices=new Uint16Array(this._meshData.vertexIndices);for(var i=0,j=f.uvs.length;i<j;i+=2){var k=f.uvs[i],l=f.uvs[i+1];f.uvs[i]=(c.region.x+k*c.region.width)/g,f.uvs[i+1]=(c.region.y+l*c.region.height)/h}f.texture=c.texture,f.dirty=!0}else{var m=this._renderDisplay;m.texture=c.texture}return void this._updateVisible()}}if(b){var f=this._renderDisplay;f.visible=!1,f.texture=null,f.x=0,f.y=0}else{var m=this._renderDisplay;m.visible=!1,m.texture=null,m.x=0,m.y=0}},c.prototype._updateMesh=function(){var a=this._renderDisplay,b=this._ffdVertices.length>0;if(this._meshData.skinned)for(var c=0,d=0,e=this._meshData.vertices.length;c<e;c+=2){for(var f=c/2,g=this._meshData.boneIndices[f],h=this._meshData.boneVertices[f],i=this._meshData.weights[f],j=0,k=0,l=0,m=g.length;l<m;++l){var n=this._meshBones[g[l]],o=n.globalTransformMatrix,p=i[l],q=0,r=0;b?(q=h[2*l]+this._ffdVertices[d],r=h[2*l+1]+this._ffdVertices[d+1]):(q=h[2*l],r=h[2*l+1]),j+=(o.a*q+o.c*r+o.tx)*p,k+=(o.b*q+o.d*r+o.ty)*p,d+=2}a.vertices[c]=j,a.vertices[c+1]=k}else if(b)for(var s=this._meshData.vertices,c=0,e=this._meshData.vertices.length;c<e;c+=2){var j=s[c]+this._ffdVertices[c],k=s[c+1]+this._ffdVertices[c+1];a.vertices[c]=j,a.vertices[c+1]=k}},c.prototype._updateTransform=function(a){if(a)this._renderDisplay.position.x=0,this._renderDisplay.position.y=0,this._renderDisplay.scale.x=1,this._renderDisplay.scale.y=1,this._renderDisplay.rotation=0,this._renderDisplay.skew.x=0,this._renderDisplay.skew.y=0,this._renderDisplay.pivot.x=0,this._renderDisplay.pivot.y=0;else{var b=this.globalTransformMatrix.tx-(this.globalTransformMatrix.a*this._pivotX+this.globalTransformMatrix.c*this._pivotY),c=this.globalTransformMatrix.ty-(this.globalTransformMatrix.b*this._pivotX+this.globalTransformMatrix.d*this._pivotY);if(this._renderDisplay instanceof Phaser.Rope){this._renderDisplay.position.x=b||0,this._renderDisplay.position.y=c||0,this._renderDisplay.worldTransform.tx=this.globalTransformMatrix.tx,this._renderDisplay.worldTransform.ty=this.globalTransformMatrix.ty,this._renderDisplay.worldTransform.a=this.globalTransformMatrix.a,this._renderDisplay.worldTransform.b=this.globalTransformMatrix.b,this._renderDisplay.worldTransform.c=this.globalTransformMatrix.c,this._renderDisplay.worldTransform.d=this.globalTransformMatrix.d;var d=this._renderDisplay.parent.scale.x?this._renderDisplay.parent.scale.x:1,e=this._renderDisplay.parent.scale.y?this._renderDisplay.parent.scale.y:1;this._renderDisplay.worldTransform.scale(d,e),this._renderDisplay.worldTransform.translate(this._renderDisplay.parent.x,this._renderDisplay.parent.y)}else this.updateGlobalTransform(),this._renderDisplay.position.x=this._renderDisplayX+this.globalTransformMatrix.tx-(this.globalTransformMatrix.a*this._pivotX+this.globalTransformMatrix.c*this._pivotY),this._renderDisplay.position.y=this._renderDisplayY+this.globalTransformMatrix.ty-(this.globalTransformMatrix.b*this._pivotX+this.globalTransformMatrix.d*this._pivotY),this._renderDisplay.scale.x=this.global.scaleX?this.global.scaleX:1,this._renderDisplay.scale.y=this.global.scaleY?this.global.scaleY:1,this._renderDisplay.rotation=this.global.skewX,this._renderDisplay.skew.x=0,this._renderDisplay.skew.y=this.global.skewY-this.global.skewX}},c}(a.Slot);a.PhaserSlot=b}(dragonBones||(dragonBones={}));var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),dragonBones;!function(a){var b=function(b){function d(){return b.call(this)||this}return __extends(d,b),d.toString=function(){return"[class dragonBones.PhaserTextureAtlasData]"},d.prototype._onClear=function(){b.prototype._onClear.call(this),this.texture&&(this.texture=null)},d.prototype.generateTexture=function(){return a.BaseObject.borrowObject(c)},d}(a.TextureAtlasData);a.PhaserTextureAtlasData=b;var c=function(a){function b(){return a.call(this)||this}return __extends(b,a),b.toString=function(){return"[class dragonBones.PhaserTextureData]"},b.prototype._onClear=function(){a.prototype._onClear.call(this),this.texture&&(this.texture.destroy(!0),this.texture=null)},b}(a.TextureData);a.PhaserTextureData=c}(dragonBones||(dragonBones={}));var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),TProject;!function(a){var b=function(b){function c(a,c,d){var e=b.call(this,a,c,d)||this;return e._skillTime=0,e.skillData=new Object,e._physics=e.game.physics.box2d,e._removeDuration=2500,e._removeTimer=e._removeDuration,e._remove=!1,e._launch=!1,e._iconWasDisabled=!0,e._iconReactivateTimer=0,e._canSpleet=!1,e._hitTimer=0,e._bounceTimer=0,e._tween=null,e}return __extends(c,b),Object.defineProperty(c.prototype,"launch",{set:function(a){this._launch=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"remove",{get:function(){return this._remove},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"tween",{get:function(){return this._tween},set:function(a){this._tween=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"baseGame",{set:function(a){this._baseGame=a},enumerable:!0,configurable:!0}),c.prototype.hit=function(a,b){var c=a-this.x,d=b-this.y,e=this.sprite.width/2;return d*d+c*c<e*e&&(this._baseGame.activateIngameAbilityAndCameraMoveFromUI(this._name),!0)},Object.defineProperty(c.prototype,"spriteName",{set:function(b){this._sprite=new a.DBSprite(a.Boot.GAMEPLAY_DB,"_DB_FOR_GAMEPLAY/"+b),this._sprite.setPos(0,0),this._sprite.play("idle"),this._sprite.scale.set(1.33,1.33),this.addChild(this._sprite),this._sprite.getBoneArmature("Layer 5").animation.play("ingame_idle")},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"name",{get:function(){return this._name},set:function(a){this._name=a,this._body.data.SetUserData({name:a})},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"sprite",{get:function(){return this._sprite},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"cooldown",{set:function(a){this._cooldown=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"canspleet",{get:function(){return this._canSpleet},set:function(a){this._canSpleet=a},enumerable:!0,configurable:!0}),c.prototype.useSkill=function(a){void 0===a&&(a=!0)},c.prototype.createBody=function(b,c,d){void 0===b&&(b=14),this._body=this._physics.createBody();var e=(new box2d.b2PolygonShape,c||this._sprite.width),f=new box2d.b2FixtureDef,g=this.createShape(b,e/2);f.shape=(new box2d.b2PolygonShape).Set(g[0],g[0].length),f.density=this._densitry,f.friction=this._friction,f.restitution=this._restitution,f.filter.categoryBits=a.EntityCategory.PLAYER,f.filter.maskBits=a.EntityCategory.DECORATION|a.EntityCategory.MOUNTAIN|a.EntityCategory.ROCK|a.EntityCategory.PLAYER,this._body.setFixture(f);for(var h=1;h<g.length;h++)f.shape=(new box2d.b2PolygonShape).Set(g[h],g[h].length),this._body.addFixture(f);this._body.x=this.x,this._body.y=this.y,this._body.setCategoryContactCallback(a.EntityCategory.DECORATION,this.decorationContact,this),this._body.setCategoryContactCallback(a.EntityCategory.ROCK,this.rockContact,this),this._body.setCategoryContactCallback(a.EntityCategory.PLAYER,this.playerContact,this),this._body.setCategoryPostsolveCallback(a.EntityCategory.ROCK,this.postRockContact,this),this._body.setCategoryPostsolveCallback(a.EntityCategory.MOUNTAIN,this.postMountainContact,this)},Object.defineProperty(c.prototype,"hitFXs",{set:function(a){this._hitFXs=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"bounceFXs",{set:function(a){this._bounceFXs=a},enumerable:!0,configurable:!0}),c.prototype.postRockContact=function(b,c,d,e,f,g){var h=c.data.GetUserData();if(h.bodyType==a.BodyInfo.TYPE_SNOWBALL){var i=g.normalImpulses.reduce(function(a,b){return a+b});i/=c.data.GetMass(),i>GamesConfig.Mountain.snowballBreakImpulse&&(h.sprite.animations.play("explode").onComplete.addOnce(function(){h.sprite.parent.removeChild(h.sprite),h.sprite.destroy(!0)},this),h.body.destroy(),this._baseGame.destroyRock(h))}},c.prototype.postMountainContact=function(b,c,d,e,f,g){var h=(c.data.GetUserData(),g.normalImpulses.reduce(function(a,b){return a+b}));h/=b.data.GetMass(),h>GamesConfig.Players.impulseForHitAnimation&&(this.sprite.play("hit","idle"),this.showFX(this._bounceFXs,f),h>GamesConfig.Players.impulseForBounceSound&&this.isBodyOnScreen()&&a.SoundMixer.play(Utils.randomFromArray(a.BaseGame.BOUNCE_SOUNDS)))},c.prototype.decorationContact=function(b,c){var d=c.data.GetUserData(),e=d.sprite;if(null!=e&&void 0!==e)try{var f=d.hitPlayers.indexOf(this.name)<0;f&&"idle"==e.animations.currentAnim.name&&(a.SoundMixer.play(Utils.randomFromArray(d.soundsArray)),e.animations.play("hit"),d.updateTime=.5,d.hitPlayers.push(this.name),this._baseGame.updateDecorationCollision(d.typeIndex))}catch(a){}},c.prototype.isBodyOnScreen=function(){var a=this.worldPosition.x;return a>this.game.width*-.1&&a<1.1*this.game.width},c.prototype.refill=function(){},c.prototype.rockContact=function(a,b,c,d,e,f){if(e&&this._hitTimer<=0&&(this._hitTimer=500,this.showFX(this._hitFXs,f),null!=this.sprite&&void 0!==this.sprite&&this.sprite.children.length>0&&"idle"==this.sprite.currentLabel))try{this.sprite.play("hit","idle")}catch(a){}},c.prototype.showFX=function(b,c){if(!a.Boot.OPTIMIZATION){var d=new box2d.b2Vec2,e=new box2d.b2WorldManifold;d.x=d.y=0,c.GetWorldManifold(e);for(var f=0;f<c.GetManifold().points.length;++f)d.SelfAdd(e.points[f]);d.SelfMul(1/c.GetManifold().pointCount);var g=b.getMC();g.x=this._physics.mpx(-d.x),g.y=this._physics.mpx(-d.y),g.alpha=1,g.play("play")}},c.prototype.mountainContact=function(a,b,c,d,e,f){e&&this._bounceTimer<=0&&(this.showFX(this._bounceFXs,f),null!=this.sprite&&void 0!==this.sprite&&this.sprite.children.length>0&&"idle"==this.sprite.currentLabel&&this.sprite.play("hit","idle"),this._bounceTimer=500)},c.prototype.playerContact=function(a,b){if(null!=this.sprite&&void 0!==this.sprite&&this.sprite.children.length>0&&"idle"==this.sprite.currentLabel)try{this.sprite.play("hit","idle")}catch(a){}},c.prototype.createShape=function(a,b){void 0===a&&(a=14);for(var c=a,d=new box2d.b2Vec2(b,0),e=(box2d.b2Mat22.FromAngleRadians(2*Math.PI/c),[]),f=0;f<c;f++){d.SelfRotateRadians(2*Math.PI/c);var g=d.x,h=d.y;e.push(new box2d.b2Vec2(this._physics.pxm(-g),this._physics.pxm(-h)))}var i=new Phaser.Physics.Box2D.Polygon;return i.setFromXYObjects(e),i.decompose()},Object.defineProperty(c.prototype,"body",{get:function(){return this._body},enumerable:!0,configurable:!0}),c.prototype.update=function(){b.prototype.update.call(this);var a=this.game.time.elapsedMS;this.x=this._body.x,this.y=this._body.y,this.angle=this._body.angle;var c=this._launch?this._body.data.GetLinearVelocity().Length():0;if(c>1500){var d=this._body.data.GetLinearVelocity();d.Normalize(),d.SelfMul(1500),this._baseGame.awardMedal("max_speed")}c>.2?(this._iconWasDisabled&&(this._iconReactivateTimer<=0?(this._baseGame.enablePlayerIcon(this.name),this._iconWasDisabled=!1,this._iconReactivateTimer=2e3):this._iconReactivateTimer-=a),this._remove&&(this._remove=!1,this._removeTimer=this._removeDuration)):(this._launch&&this._removeTimer>0?this._removeTimer-=a:!this._remove&&this._removeTimer<=0&&(this._remove=!0),this._iconWasDisabled||(this._baseGame.disablePlayerIcon(this.name),this._iconWasDisabled=!0,this._iconReactivateTimer=2e3)),this._skillTime>0&&(this._skillTime-=a),this._hitTimer>0&&(this._hitTimer-=a),this._bounceTimer>0&&(this._bounceTimer-=a)},c.prototype.free=function(a){void 0===a&&(a=!1),this.tween&&this.game.tweens.remove(this.tween),this.parent.removeChild(this),a||this.body.destroy(),this._sprite.free(),this._baseGame.disablePlayerIcon(this.name)},c.prototype.getActiveSkill=function(){return!1},c}(Phaser.Sprite);a.Player=b}(TProject||(TProject={}));var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),TProject;!function(a){var b=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b}(a.BodyInfo);a.PlayerData=b}(TProject||(TProject={}));var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),TProject;!function(a){var b=function(b){function c(a,c,d){var e=b.call(this,a,c,d)||this;return e._densitry=1.089,e._restitution=0,e._friction=.2178,e.spriteName="player_bmo",e.sprite.width/=2,e.sprite.height/=2,e._physics=e.game.physics.box2d,e.createBody(12),e._skillWasUsed=!1,e.name="bmo",e._animationWasReset=!1,e._skillDuration=1e3,e}return __extends(c,b),c.prototype.useSkill=function(b){void 0===b&&(b=!0);var c=this.body.data.GetLinearVelocity().Length()>GamesConfig.Skills.splitSpeedLimit;!this._skillWasUsed&&c&&(a.SoundMixer.play("skill_"+this.name),this._baseGame.destroyRocks(),this._skillWasUsed=!0,this.sprite.getBoneArmature("Layer 5").animation.play("boost",1),b&&this._baseGame.activateBoostFromGame("bmo"),this._skillTime=this._skillDuration)},c.prototype.refill=function(){this._skillWasUsed=!1,this._animationWasReset=!1},c.prototype.getActiveSkill=function(){return!1},c.prototype.update=function(){b.prototype.update.call(this),this._skillTime<0&&!this._animationWasReset&&(this._animationWasReset=!0,this.sprite.getBoneArmature("Layer 5").animation.play("ingame_idle"));
},c}(a.Player);a.Bmo=b}(TProject||(TProject={}));var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),TProject;!function(a){var b=function(b){function c(a,c,d){var e=b.call(this,a,c,d)||this;return e._skillDuration=1e4,e.spriteName="player_bubblegum",e._densitry=1.089,e._restitution=0,e._friction=.2178,e.sprite.width/=2,e.sprite.height/=2,e._skillWasUsed=!1,e._animationWasChangedBack=!1,e._animationState=-1,e.createBody(14),e._bubbgum=e.sprite.getBoneArmature("Layer 5"),e.name="bubblegum",e}return __extends(c,b),c.prototype.useSkill=function(b){void 0===b&&(b=!0),this.body.data.GetLinearVelocity().Length()<GamesConfig.Skills.splitSpeedLimit||this._skillWasUsed||(a.SoundMixer.play("skill_"+this.name),this._bubbgum.animation.play("boost"),this._skillWasUsed=!0,this._animationState=0,this._skillTime=this._skillDuration,this.body.data.GetFixtureList().SetRestitution(GamesConfig.Skills.bounceStrength),b&&this._baseGame.activateBoostFromGame("bubblegum"))},c.prototype.getActiveSkill=function(){return this._skillTime>0},c.prototype.refill=function(){this._skillTime<=0&&(this._skillWasUsed=!1,this._animationWasChangedBack=!1)},c.prototype.update=function(){b.prototype.update.call(this),0==this._animationState&&this._bubbgum.animation.isCompleted&&this._skillTime>0?(this._bubbgum.animation.play("boostLoop"),this._animationState=1):2==this._animationState&&(this._bubbgum.animation.play("ingame_idle"),this._animationState=0),!this._animationWasChangedBack&&this._skillTime<=0&&this._skillWasUsed&&(this._animationWasChangedBack=!0,this.sprite.getBoneArmature("Layer 5").animation.play("boostOut"),this._animationState=2,this.body.data.GetFixtureList().SetRestitution(0))},c}(a.Player);a.Bubblegum=b}(TProject||(TProject={}));var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),TProject;!function(a){var b=function(b){function c(a,c,d){var e=b.call(this,a,c,d)||this;return e._animationWasReset=!1,e._skillTime=0,e._skillDuration=5e3,e.spriteName="player_finn",e._skillWasUsed=!1,e._densitry=1.089,e._restitution=0,e._friction=.2178,e._sprite.width/=2,e._sprite.height/=2,e._physics=e.game.physics.box2d,e._swordAttacks=0,e.createBody(),e.name="finn",e}return __extends(c,b),c.prototype.useSkill=function(b){void 0===b&&(b=!0),this.body.data.GetLinearVelocity().Length()<GamesConfig.Skills.splitSpeedLimit||this._skillWasUsed||(a.SoundMixer.play("skill_"+this.name),this._skillWasUsed=!0,this._skillTime=this._skillDuration,this.sprite.getBoneArmature("Layer 5").animation.play("boostLoop"),b&&this._baseGame.activateBoostFromGame("finn"))},c.prototype.getActiveSkill=function(){return this._skillTime>0},c.prototype.update=function(){b.prototype.update.call(this),!this._animationWasReset&&this._skillTime<=0&&this._skillWasUsed&&(this.sprite.getBoneArmature("Layer 5").animation.play("ingame_idle"),this._animationWasReset=!0),this._swordAttacks==GamesConfig.Medals.swordValue&&this._baseGame.awardMedal("sword")},c.prototype.playerContact=function(a,b){if(null!=b.data.GetUserData()){var c=b.data.GetUserData().name;void 0!==c&&c.indexOf("jake")>=0&&this._baseGame.awardMedal("best_buddies")}},c.prototype.refill=function(){this._skillTime<=0&&(this._skillWasUsed=!1,this._animationWasReset=!1)},c.prototype.rockContact=function(a,c,d,e,f,g){if(f)if(this._skillTime>0){var h=c.data.GetUserData(),i=h.sprite;i.animations.play("explode").onComplete.addOnce(function(){i.destroy(!0),c.destroy()},this),this._swordAttacks++,this.sprite.play("hit","idle")}else b.prototype.rockContact.call(this,a,c,d,e,f,g)},c}(a.Player);a.Finn=b}(TProject||(TProject={}));var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),TProject;!function(a){var b=function(b){function c(a,c,d){var e=b.call(this,a,c,d)||this;return e._skillWasUsed=!1,e._densitry=1.089,e._restitution=0,e._friction=.2178,e.spriteName="player_iceking",e.sprite.width/=2,e.sprite.height/=2,e.createBody(),e.name="iceking",e._iceking=e.sprite.getBoneArmature("Layer 5"),e}return __extends(c,b),c.prototype.useSkill=function(b){void 0===b&&(b=!0),this._skillWasUsed||void 0===this._baseGame||(a.SoundMixer.play("skill_"+this.name),this._baseGame.replaceRocks(),this._skillWasUsed=!0,this._iceking.animation.play("boost"),b&&this._baseGame.activateBoostFromGame("iceking"))},c.prototype.refill=function(){this._skillWasUsed=!1},c.prototype.getActiveSkill=function(){return!1},c.prototype.update=function(){b.prototype.update.call(this),"boost"==this._iceking.animation.lastAnimationName&&this._iceking.animation.isCompleted&&this._iceking.animation.play("ingame_idle")},c}(a.Player);a.Iceking=b}(TProject||(TProject={}));var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),TProject;!function(a){var b=function(b){function c(a,c,d){var e=b.call(this,a,c,d)||this;return e.growDefinition=[16,35,.8,.3,0],e.growTweenConfig=[.4,"easeOutBack"],e._growWasUsed=!1,e._growDuration=5e3,e._skillTime=0,e._spawnCooldown=1e3,e.spriteName="player",e._densitry=1.089,e._restitution=0,e._friction=.2178,e._scaleFactor=2,e._isBig=!1,e._defaultScale=1.33,e}return __extends(c,b),Object.defineProperty(c.prototype,"spriteName",{set:function(b){this._sprite=new a.DBSprite(a.Boot.GAMEPLAY_DB,"_DB_FOR_GAMEPLAY/"+b),this._sprite.setPos(0,0),this._sprite.play("idle"),this._defaultHeight=this._sprite.height,this._defaultWidth=this._sprite.width,this.addChild(this._sprite),this._sprite.getBoneArmature("characters").animation.play("ingame_idle")},enumerable:!0,configurable:!0}),c.prototype.prepare=function(){this._unlockedPlayers=7-this._baseGame.getLockedCharacters().length;var a=this._sprite.getBoneArmature("characters");this._baseGame.getLockedCharacters().forEach(function(b){var c=b[1].split("_")[1];"iceking"==c&&(c="ik"),"lumpy"==c&&(c="lsp"),a.getBone(c).visible=!1}),this._physics=this.game.physics.box2d,this._sprite.width=42,this._sprite.height=42,this.createBody(14,42,42),this.name="jake",setTimeout(function(){},400)},Object.defineProperty(c.prototype,"baseGame",{set:function(a){this._baseGame=a,this.prepare()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"unlockedPlayers",{set:function(a){this._unlockedPlayers=a},enumerable:!0,configurable:!0}),c.prototype.refill=function(){this._isBig||(this._growWasUsed=!1,this._bodyWasRecreated=!1)},c.prototype.getActiveSkill=function(){return this._isBig},c.prototype.useSkill=function(b){var c=this;if(void 0===b&&(b=!0),this._baseGame.currentUnlockedCounter<this._unlockedPlayers-1)this.canspleet&&(a.SoundMixer.play("bubble_fly"),this.canspleet=!1,this._sprite.play("divide","idle"),this._baseGame.spawnNextPlayer(),b&&this._baseGame.addPlayerFromGame());else if(!this._growWasUsed&&!this._isBig){a.SoundMixer.play("skill_"+this.name),this._skillTime=5e3,this._isBig=!0,this._growWasUsed=!0,this._sprite.animation.stop(),this._sprite.animation.play("idle"),this.tween=this.game.add.tween(this._sprite).to({width:68.97,height:68.97},400,Phaser.Easing.Back.Out,!0),this.tween.onComplete.addOnce(function(){c&&(c._sprite.animation.stop(),c._sprite.animation.play("idle"),c.sprite.width=c.sprite.height=68.97)}),this._densitry=this.growDefinition[2],this._friction=this.growDefinition[3];var d=this.body.data.GetLinearVelocity(),e=this.body.angularVelocity;this._baseGame.checkCameraTarget(this.body),this.body.destroy(),this.createBody(this.growDefinition[0],68.97,68.97),this._bodyWasRecreated=!1,this.body.data.SetLinearVelocity(d),this.body.angularVelocity=e,this._baseGame.setCameraTarget(this.body),this.body.data.SetUserData({name:"jake"}),b&&this._baseGame.activateBoostFromGame("jake")}},c.prototype.playerContact=function(a,c){if(null!=c.data.GetUserData()){var d=c.data.GetUserData().name;void 0!==d&&d.indexOf("finn")>=0&&this._baseGame.awardMedal("best_buddies")}b.prototype.playerContact.call(this,a,c)},c.prototype.update=function(){var a=this;if(b.prototype.update.call(this),this._growWasUsed&&this._skillTime<=0&&!this._bodyWasRecreated){this._densitry=1.5,this._restitution=0,this._friction=.3;var c=this.body.data.GetLinearVelocity(),d=this.body.angularVelocity;this._baseGame.checkCameraTarget(this.body),this.body.destroy(),this.createBody(14,42,42),this.body.data.SetLinearVelocity(c),this.body.angularVelocity=d,this._bodyWasRecreated=!0,this._sprite.animation.stop(),this._sprite.animation.play("idle"),this.tween=this.game.add.tween(this._sprite).to({width:42,height:42},400,Phaser.Easing.Back.Out,!0),this.tween.onComplete.addOnce(function(){a&&(a._isBig=!1,a._sprite.animation.stop(),a._sprite.animation.play("idle"),a.sprite.width=a.sprite.height=42)}),this._baseGame.setCameraTarget(this.body),this.body.data.SetUserData({name:"jake"})}},c}(a.Player);a.Jake=b}(TProject||(TProject={}));var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),TProject;!function(a){var b=function(b){function c(a,c,d){var e=b.call(this,a,c,d)||this;return e._skillWasUsed,e.spriteName="player_lumpy",e._densitry=1.089,e._restitution=0,e._friction=.2178,e.sprite.width/=2,e.sprite.height/=2,e.createBody(),e.name="lumpy",e._animationState=-1,e._skillDuration=5e3,e._animationWasChangedBack=!1,e._lsp=e.sprite.getBoneArmature("Layer 5"),e._levitationForce=new box2d.b2Vec2(0,4),e}return __extends(c,b),c.prototype.useSkill=function(b){void 0===b&&(b=!0),this._skillWasUsed||(a.SoundMixer.play("skill_"+this.name),this._skillWasUsed=!0,this._skillTime=this._skillDuration,this._lsp.animation.play("boost"),this._animationState=0,b&&this._baseGame.activateBoostFromGame("lumpy"))},c.prototype.getActiveSkill=function(){return this._skillTime>0},c.prototype.refill=function(){this._skillTime<=0&&(this._skillWasUsed=!1,this._animationWasChangedBack=!1)},c.prototype.update=function(){b.prototype.update.call(this),0==this._animationState&&this._lsp.animation.isCompleted&&this._skillTime>0?(this._lsp.animation.play("boostLoop"),this._animationState=1):2==this._animationState&&this._lsp.animation.isCompleted&&(this._lsp.animation.play("ingame_idle"),this._animationState=-1),!this._animationWasChangedBack&&this._skillTime<=0&&this._skillWasUsed&&(this._animationWasChangedBack=!0,this.sprite.getBoneArmature("Layer 5").animation.play("boostOut"),this._animationState=2),this._skillTime>0&&this.body.data.ApplyForce(this._levitationForce,this.body.data.GetWorldCenter())},c}(a.Player);a.Lumpy=b}(TProject||(TProject={}));var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),TProject;!function(a){var b=function(b){function c(a,c,d){var e=b.call(this,a,c,d)||this;return e._skillDuration=1500,e._skillWasUsed=!1,e._densitry=1.089,e._restitution=0,e._friction=.2178,e.spriteName="player_marceline",e.sprite.width/=2,e.sprite.height/=2,e.createBody(),e.name="marceline",e._animationWasReset=!1,e}return __extends(c,b),c.prototype.getActiveSkill=function(){return!1},c.prototype.useSkill=function(b){void 0===b&&(b=!0);var c=this.body.data.GetLinearVelocity().Length()>GamesConfig.Game.gameOverSpeed;!this._skillWasUsed&&c&&(a.SoundMixer.play("skill_"+this.name),this._skillWasUsed=!0,this._skillTime=this._skillDuration,this._baseGame.soundBurst(this.x,this.y),this.sprite.getBoneArmature("Layer 5").animation.play("boost"),b&&this._baseGame.activateBoostFromGame("marceline"),this._skillTime=this._skillDuration)},c.prototype.refill=function(){this._skillWasUsed=!1,this._animationWasReset=!1},c.prototype.update=function(){b.prototype.update.call(this),this._skillTime<0&&!this._animationWasReset&&(this._animationWasReset=!0,this.sprite.getBoneArmature("Layer 5").animation.play("ingame_idle"))},c}(a.Player);a.Marceline=b}(TProject||(TProject={}));var TProject;!function(a){var b=function(){function a(){this.maxDistance=0,this.unlockedCharacters=0,this.tutorState=0,this.playMusic=!0}return a}();a.SaveData=b}(TProject||(TProject={}));var TProject;!function(a){var b=function(){function b(){}return b.init=function(a){b._audio=a.add.audioSprite("sfx")},b.play=function(c,d,e){return void 0===d&&(d=.3),void 0===e&&(e=!1),0==a.Boot.GAME_DATA.playMusic?void(e&&(b._bgKey=c,b._bgVolume=d)):void(e?(b._bg&&b._bg.stop(),b._bgKey=c,b._bgVolume=d,b._bg=b._audio.play(c,d),b._bg.allowMultiple=!0,b._bg.loop=!0):b._audio.play(c,d).allowMultiple=!0)},b.stop=function(a){b._audio.stop(a)},b.on=function(){b._bgKey&&b.play(b._bgKey,b._bgVolume)},b.off=function(){b._audio.stop(null)},b}();a.SoundMixer=b}(TProject||(TProject={}));var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),TProject;!function(a){var b=function(){function a(){}return a}();a.BubbleForSort=b;var c=function(b){function c(c,d,e){var f=b.call(this,c,0,0)||this;f._bubbleDB=d,f._currentUI=e,f._currentBubbleLen=1,f._currentBubbleMax=0,f._timeToBubbleUpdate=.25,f._timeToActivateUpdate=.1,f._activeCooldown=0,f._tutorialCurrentStage=a.Boot.GAME_DATA.tutorState,f._followOnPlayer=!1,f._followOnBubble=!1,f._bubbleOrderArrayInProgress=!1,f._isReplay=!1,f._startTargetMarker=!1,f._mainPlayerActivateAbility=!0,f._mainPlayerAvailable=!0,f._mainPlayerIsMove=!1,f._playersArray=[],f._playersIconArray=[],f._playersAbilityArray=[],f._cooldownTimersArray=[],f._cooldownOptimalTimeArray=[],f._playersArrayButtonOB=[],f._playersArrayAbilityOB=[],f._playersCooldownAbilityArray=[],f._currentBubbleInGame=[],f._playersIsMove=[],f._abilityAvailable=[],f._playersActivate=[],f._bubblesForSort=[],f._abilityActivatedArray=[],f._positionXForBubble=[[320],[282,358],[244,320,396],[206,282,358,434],[168,244,320,396,472],[130,206,282,358,434,510],[92,168,244,320,396,472,548]],f._newCorrectPlaceArray=[],f._iconInPlayerBubble=["jake","finn","bmo","bubblegum","iceking","lumpy","marceline"],f._playerBubble=new a.DBSprite(a.Boot.GAME_HUD,"_DB_FOR_UI/icon_player",f.game),f._playerBubble.setPos(320,428),f._playerBubble.play("idle","out"),f.addChild(f._playerBubble),f._playerBubble.visible=!1,f._playerIcon=new a.DBSprite(f._playerBubble.getBone("icon"));for(var g=0;g<f._iconInPlayerBubble.length;g++)g+1>f._currentBubbleMax&&(f._playerIcon.getBone("player_"+f._iconInPlayerBubble[g]).visible=!1);for(var h=function(b){i._cooldownTimersArray[b]=-1,i._playersArray.push(new a.DBSprite(a.Boot.GAME_HUD,"_DB_FOR_UI/icon_"+i._iconInPlayerBubble[b],i.game)),i._playersArray[b].setPos(320,428),i._playersArray[b].play("idle","out"),i.addChild(i._playersArray[b]),i._playersArray[b].visible=!1,i._playersIsMove[b]=!1,i._bubblesForSort[b]={name:i._iconInPlayerBubble[b],currentPlace:0,orderPlace:0,linkToObject:i._playersArray[b],readyToMove:!1,inGame:!1,tween:null,currentActivated:!0,orderActivated:!0,skillUsed:!1,linkToPlayerButton:null,linkToSkillButton:null,linkToSkillDB:null,canChangeActivate:!0},0!=b&&1!=b&&3!=b&&5!=b||(i._playersCooldownAbilityArray[b]=i.createCooldownBubble(),i._playersCooldownAbilityArray[b].play("end_move"),i._playersArray[b].getBone("icon").addChild(i._playersCooldownAbilityArray[b]),i._cooldownOptimalTimeArray[b]=3==b?10:5),i._playersIconArray.push(new a.DBSprite(i._playersArray[b].getBone("icon"))),i._abilityAvailable.push(!0),i._playersActivate.push(!0),i._playersArrayButtonOB.push(new a.OverlayButton(i.game,i._playersIconArray[b],70,["idle","mouseOver","mouseOut","mouseOut"],function(){f._bubblesForSort[b].linkToPlayerButton.enabled=!1,f._bubblesForSort[b].linkToSkillButton.enabled=!1,f._followOnBubble&&f.tutorial3Start(!1),f._abilityActivatedArray.push(f._bubblesForSort[b].name),f._currentDBTarget!=f._bubblesForSort[b].linkToObject?(f.changeMarkerPosition(f._bubblesForSort[b].linkToPlayerButton,f._bubblesForSort[b].linkToObject),f._currentUI.feedBackSender(f._bubblesForSort[b].name,"CameraMove")):f.tryActivateAbility()},i)),i._playersArray[b].getBone("icon").addChild(i._playersArrayButtonOB[b]),i._playersArrayButtonOB[b].enabled=!1,i._playersAbilityArray.push(new a.DBSprite(i._playersArray[b].getBone("Layer 2"))),i._playersArrayAbilityOB.push(new a.OverlayButton(i.game,i._playersAbilityArray[b],40,["idle_ingame","mouseOver","mouseOut","idle_ingame"],function(){f._abilityActivatedArray.push(f._bubblesForSort[b].name),f._bubblesForSort[b].linkToPlayerButton.enabled=!1,f._bubblesForSort[b].linkToSkillButton.enabled=!1,f._followOnBubble&&f.tutorial3Start(!1),f._currentDBTarget!=f._bubblesForSort[b].linkToObject?(f.changeMarkerPosition(f._bubblesForSort[b].linkToPlayerButton,f._bubblesForSort[b].linkToObject),f._currentUI.feedBackSender(f._bubblesForSort[b].name,"CameraMove")):f.tryActivateAbility()},i)),i._playersAbilityArray[b].getBone("Layer 1").addChild(i._playersArrayAbilityOB[b]),i._playersArrayAbilityOB[b].y+=16,i._playersArrayAbilityOB[b].x+=25,i._playersArrayAbilityOB[b].enabled=!1,i._playersArrayAbilityOB[b].activeEndAnimation=!1,i._bubblesForSort[b].linkToSkillButton=i._playersArrayAbilityOB[b],i._bubblesForSort[b].linkToPlayerButton=i._playersArrayButtonOB[b],i._bubblesForSort[b].linkToSkillDB=i._playersAbilityArray[b],setTimeout(function(){f._bubblesForSort[b].linkToSkillDB.play("idleOut")},30)},i=this,j=0;j<7;j++)h(j);return f._playerButtonOB=new a.OverlayButton(f.game,f._playerIcon,70,["idle","mouseOver","mouseOut","mouseOut"],function(){f._playerButtonOB.enabled=!1,f._playerAbilityOB.enabled=!1,f._abilityActivatedArray.push("player"),f._currentDBTarget!=f._bubblesForSort[0].linkToObject?(f.changeMarkerPosition(f._playerButtonOB,f._bubblesForSort[0].linkToObject),f._currentUI.feedBackSender("player","CameraMove")):f.tryActivateAbility()},f),f._playerBubble.getBone("icon").addChild(f._playerButtonOB),f._playerButtonOB.enabled=!1,f._playerAbility=new a.DBSprite(f._playerBubble.getBone("Layer 2")),f._playerAbilityOB=new a.OverlayButton(f.game,f._playerAbility,40,["idle_ingame","mouseOver","mouseOut","idle_ingame"],function(){f._playerButtonOB.enabled=!1,f._playerAbilityOB.enabled=!1,f._abilityActivatedArray.push("player"),f._currentDBTarget!=f._bubblesForSort[0].linkToObject?(f.changeMarkerPosition(f._playerButtonOB,f._bubblesForSort[0].linkToObject),f._currentUI.feedBackSender("player","CameraMove")):f.tryActivateAbility()},f),f._playerAbility.getBone("Layer 1").addChild(f._playerAbilityOB),f._playerAbilityOB.y-=25,f._playerAbilityOB.enabled=!1,f._playerAbilityOB.activeEndAnimation=!1,setTimeout(function(){f._playerAbility.play("idleOut"),f._playerBubble.getSlot("Layer 2").play("idle_ingame")},30),f._startXPoint=f._playerBubble.x,f._currentMarker=new a.DBSprite(a.Boot.GAME_HUD,"_DB_FOR_UI/icon_selected",f.game),f._currentMarker.play("idleOut"),f._currentMarker.setPos(0,428),f.addChild(f._currentMarker),f._markerButton=new Phaser.Graphics(f.game,-35,-35),f._markerButton.beginFill(0,0),f._markerButton.drawRect(0,0,70,70),f._markerButton.endFill(),f.addChild(f._markerButton),f._markerButton.events.onInputDown.add(function(){f.markerAbilityActivate()},f),setTimeout(function(){},7500),f._tutorialCklick=new a.DBSprite(a.Boot.GAME_HUD,"_DB_FOR_UI/tutorial_click",f.game),f._tutorialCklick.play("idleOut"),f.addChild(f._tutorialCklick),f._tutorialLaunch=new a.DBSprite(a.Boot.GAME_HUD,"_DB_FOR_UI/tutorial_launch",f.game),f._tutorialLaunch.play("idleOut"),f.addChild(f._tutorialLaunch),f}return __extends(c,b),c.prototype.ActivateIngameAbilityAndCameraMove=function(a){for(var b=0;b<this._bubblesForSort.length;b++)this._bubblesForSort[b].name==a&&(this._currentDBTarget!=this._bubblesForSort[b].linkToObject&&(this.changeMarkerPosition(this._bubblesForSort[b].linkToPlayerButton,this._bubblesForSort[b].linkToObject),this._currentUI.feedBackSender(this._bubblesForSort[b].name,"CameraMove")),this._bubblesForSort[b].linkToSkillButton.enabled&&(this._bubblesForSort[b].linkToPlayerButton.enabled=!1,this._bubblesForSort[b].linkToSkillButton.enabled=!1,this._followOnBubble&&this.tutorial3Start(!1),this._abilityActivatedArray.push(this._bubblesForSort[b].name),this._currentDBTarget==this._bubblesForSort[b].linkToObject&&this.tryActivateAbility()))},c.prototype.tryActivateAbility=function(){var a=this;if(this._abilityActivatedArray.length>0)for(var b=Phaser.ArrayUtils.removeRandomItem(this._abilityActivatedArray),c=function(c){if(d._bubblesForSort[c].name==b)return 1==d._tutorialCurrentStage&&d.tutorial2Start(!1),d._followOnBubble&&d.tutorial3Start(!1),d._bubblesForSort[c].skillUsed||("player"==d._bubblesForSort[c].name?(d._playerAbilityOB.enabled=!1,d._bubblesForSort[c].skillUsed=!0,d.activateNewPlayer(),d.openPlank(),setTimeout(function(){!a._isReplay&&a.getRealBubbleStatus(c)&&"player"==a._bubblesForSort[c].name&&a._playerAbility.play("out","idleOut")},30),setTimeout(function(){!a._isReplay&&a.getRealBubbleStatus(c)&&"player"==a._bubblesForSort[c].name&&a.activeClonePlayer()},1050)):(d._bubblesForSort[c].linkToSkillButton.enabled=!1,d._bubblesForSort[c].skillUsed=!0,d._currentUI.feedBackSender(d._bubblesForSort[c].name,"Ability"),0!=c&&1!=c&&3!=c&&5!=c||(d._cooldownTimersArray[c]=0,d._activeCooldown++),setTimeout(function(){!a._isReplay&&a.getRealBubbleStatus(c)&&(a._bubblesForSort[c].linkToSkillDB.animation.stop(),a._bubblesForSort[c].linkToSkillDB.play("out","idleOut"))},30))),"break"},d=this,e=0;e<this._bubblesForSort.length;e++){var f=c(e);if("break"===f)break}},c.prototype.markerAbilityActivate=function(){for(var a=0;a<this._bubblesForSort.length;a++)if(this._bubblesForSort[a].linkToObject==this._currentDBTarget){this._bubblesForSort[a].linkToSkillButton.enabled&&(this._bubblesForSort[a].linkToPlayerButton.enabled=!1,this._bubblesForSort[a].linkToSkillButton.enabled=!1,this._followOnBubble&&this.tutorial3Start(!1),this._abilityActivatedArray.push(this._bubblesForSort[a].name),this._currentDBTarget!=this._bubblesForSort[a].linkToObject?(this.changeMarkerPosition(this._bubblesForSort[a].linkToPlayerButton,this._bubblesForSort[a].linkToObject),this._currentUI.feedBackSender(this._bubblesForSort[a].name,"CameraMove")):this.tryActivateAbility());break}},c.prototype.getRealBubbleStatus=function(a){return this._bubblesForSort[a].currentActivated&&this._bubblesForSort[a].orderActivated},c.prototype.tutorial1Start=function(b){0==this._tutorialCurrentStage&&(b?(this._tutorialLaunch.play("in","idle"),this._tutorialLaunch.getSlot("Layer 3").play(this.game.device.desktop?"idle_desktop":"idle_mobile")):(this._tutorialCurrentStage++,a.Boot.GAME_DATA.tutorState=this._tutorialCurrentStage,a.SaveManager.getInstance.save(),this._tutorialLaunch.play("out","idleOut")))},c.prototype.tutorial2Start=function(b){1==this._tutorialCurrentStage&&(b?(this._tutorialCklick.play("in","idle"),this._tutorialCklick.getSlot("Layer 3").play(this.game.device.desktop?"idle_desktop":"idle_mobile"),this._followOnPlayer=!0):(this._tutorialCurrentStage++,a.Boot.GAME_DATA.tutorState=this._tutorialCurrentStage,a.SaveManager.getInstance.save(),this._tutorialCklick.play("out","idleOut"),this._followOnPlayer=!1))},c.prototype.tutorial3Start=function(b){2==this._tutorialCurrentStage&&(b?(this._tutorialCklick.play("in","idle"),this._tutorialCklick.getSlot("Layer 3").play(this.game.device.desktop?"idle_desktop":"idle_mobile"),this._followOnBubble=!0):(this._tutorialCurrentStage++,a.Boot.GAME_DATA.tutorState=this._tutorialCurrentStage,a.SaveManager.getInstance.save(),this._tutorialCklick.play("out","idleOut"),this._followOnBubble=!1))},c.prototype.resetBubbleOrder=function(a,b){var c=this;if(this._bubbleOrderArrayInProgress)setTimeout(function(){c.resetBubbleOrder(a,b)},10);else{this._bubbleOrderArrayInProgress=!0;this._newCorrectPlaceArray.length,a.length;if(b)for(var d=0;d<this._newCorrectPlaceArray.length;d++)if("player"==this._newCorrectPlaceArray[d]){this._newCorrectPlaceArray[d]="jake";break}for(var e=[],f=0;f<this._newCorrectPlaceArray.length;f++){for(var g=!0,h=0;h<a.length;h++)this._newCorrectPlaceArray[f]==a[h]&&(g=!1);g&&e.push(this._newCorrectPlaceArray[f])}a.forEach(function(a){e.push(a)}),this._newCorrectPlaceArray=[],this._newCorrectPlaceArray=e,this._bubbleOrderArrayInProgress=!1}},c.prototype.updateBubble=function(){var a=this,b=!0;if(this._bubblesForSort.forEach(function(a){if(a.inGame&&!a.readyToMove)return void(b=!1)}),b)for(var c=0;c<this._newCorrectPlaceArray.length;c++)for(var d=function(b){e._newCorrectPlaceArray[c]==e._bubblesForSort[b].name&&e._bubblesForSort[b].currentPlace!=c&&e._bubblesForSort[b].inGame&&(e._bubblesForSort[b].readyToMove=!1,e._bubblesForSort[b].orderPlace=c,e._bubblesForSort[b].tween&&e.game.tweens.remove(e._bubblesForSort[b].tween),e._bubblesForSort[b].tween=e.game.add.tween(e._bubblesForSort[b].linkToObject).to({x:e._positionXForBubble[e._currentBubbleLen-1][e._bubblesForSort[b].orderPlace]},200,Phaser.Easing.Sinusoidal.In,!0),e._bubblesForSort[b].tween.onComplete.addOnce(function(){a._bubblesForSort[b].readyToMove=!0,a._bubblesForSort[b].currentPlace=a._bubblesForSort[b].orderPlace}),e.getRealBubbleStatus(b)?e._bubblesForSort[b].linkToObject.play("move",function(c){"move"==c.label&&(a.getRealBubbleStatus(b)||a._bubblesForSort[b].linkToObject.play("deactivate"))},e):e._bubblesForSort[b].linkToObject.play("move_deactivated",function(c){"move"==c.label&&(a.getRealBubbleStatus(b)||a._bubblesForSort[b].linkToObject.play("deactivated"))},e))},e=this,f=0;f<this._bubblesForSort.length;f++)d(f)},c.prototype.changeCameraTargetInGame=function(a){var b,c,d,e=this;if("player"!=a){for(var f=0;f<this._bubblesForSort.length;f++)if(this._bubblesForSort[f].name==a||"player"==this._bubblesForSort[f].name&&"jake"==a){b=this._bubblesForSort[f].linkToObject,c=this._bubblesForSort[f].linkToPlayerButton,d=f;break}}else b=this._bubblesForSort[0].linkToObject,c=this._bubblesForSort[0].linkToPlayerButton,d=0;this.getRealBubbleStatus(d)&&(null!=b||b.visible)&&(this._startTargetMarker=!1,this._currentDBTarget=b,c.enabled=!1,"idleOut"==this._currentMarker.currentLabel?(this._currentMarker.setPos(b.x,this._currentMarker.y),this._currentMarker.play("in","idle"),this._startTargetMarker=!0):this.game.add.tween(this._currentMarker).to({x:b.x},100,Phaser.Easing.Sinusoidal.In,!0).onComplete.addOnce(function(){e._startTargetMarker=!0},this))},c.prototype.hideIcons=function(){"idleOut"!=this._currentMarker.currentLabel&&this._currentMarker.play("out","idleOut"),"idleOut"!=this._tutorialCklick.currentLabel&&this._tutorialCklick.play("out","idleOut"),"idleOut"!=this._tutorialLaunch.currentLabel&&this._tutorialLaunch.play("out","idleOut"),this._followOnPlayer=!1,this._followOnBubble=!1},c.prototype.changeActivateCharacter=function(a,b){for(var c=0;c<this._bubblesForSort.length;c++)this._bubblesForSort[c].name==a&&(this._bubblesForSort[c].orderActivated==b||(this._bubblesForSort[c].orderActivated=b))},c.prototype.jakeOFF=function(){this._bubblesForSort[0].linkToObject.animation.stop(),this._bubblesForSort[0].linkToObject.play("deactivate"),this._bubblesForSort[0].skillUsed?"idleOut"!=this._bubblesForSort[0].linkToSkillDB.currentLabel&&(this._bubblesForSort[0].linkToSkillDB.animation.stop(),this._bubblesForSort[0].linkToSkillDB.play("idleOut")):(this._bubblesForSort[0].linkToSkillDB.animation.stop(),this._bubblesForSort[0].linkToSkillDB.play("out","idleOut")),this._bubblesForSort[0].linkToPlayerButton.enabled=!1,this._bubblesForSort[0].linkToSkillButton.enabled=!1},c.prototype.updateCurrentActivate=function(){for(var a=this,b=function(b){c._bubblesForSort[b].inGame&&c._bubblesForSort[b].orderActivated!=c._bubblesForSort[b].currentActivated&&c._bubblesForSort[b].canChangeActivate&&(c._bubblesForSort[b].currentActivated=c._bubblesForSort[b].orderActivated,c._bubblesForSort[b].canChangeActivate=!1,c._bubblesForSort[b].currentActivated?(c._bubblesForSort[b].linkToObject.animation.stop(),c._bubblesForSort[b].linkToObject.play("reactivate",function(c){"reactivate"==c.label&&(a._bubblesForSort[b].linkToObject.play("idle"),a._bubblesForSort[b].canChangeActivate=!0,a._currentDBTarget!=a._bubblesForSort[b].linkToObject&&(a._bubblesForSort[b].linkToPlayerButton.enabled=!0))}),"player"==c._bubblesForSort[b].name?(c._bubblesForSort[b].linkToSkillDB.animation.stop(),"idleOut"==c._bubblesForSort[b].linkToSkillDB.currentLabel?(c._bubblesForSort[b].linkToSkillDB.play("activate","idle_ingame"),c._bubblesForSort[b].linkToSkillButton.enabled=!0):(c._bubblesForSort[b].linkToSkillDB.play("idle_ingame"),c._bubblesForSort[b].linkToSkillButton.enabled=!0)):c._bubblesForSort[b].skillUsed||(c._bubblesForSort[b].linkToSkillDB.animation.stop(),"idleOut"==c._bubblesForSort[b].linkToSkillDB.currentLabel?(c._bubblesForSort[b].linkToSkillDB.play("activate","idle_ingame"),c._bubblesForSort[b].linkToSkillButton.enabled=!0):(c._bubblesForSort[b].linkToSkillDB.play("idle_ingame"),c._bubblesForSort[b].linkToSkillButton.enabled=!0))):(c._bubblesForSort[b].linkToPlayerButton.enabled=!1,c._bubblesForSort[b].linkToSkillButton.enabled=!1,"player"!=c._bubblesForSort[b].name&&c._playersAbilityArray[b].play("idle_ingame"),c._bubblesForSort[b].linkToObject.animation.stop(),c._bubblesForSort[b].linkToObject.play("deactivate"),c._bubblesForSort[b].skillUsed?"idleOut"!=c._bubblesForSort[b].linkToSkillDB.currentLabel&&(c._bubblesForSort[b].linkToSkillDB.animation.stop(),c._bubblesForSort[b].linkToSkillDB.play("idleOut")):(c._bubblesForSort[b].linkToSkillDB.animation.stop(),c._bubblesForSort[b].linkToSkillDB.play("out","idleOut")),c._bubblesForSort[b].canChangeActivate=!0))},c=this,d=0;d<this._bubblesForSort.length;d++)b(d)},c.prototype.updateAnimation=function(){},c.prototype.activateAbility=function(a){var b=this;this.getRealBubbleStatus(a)&&(this._bubblesForSort[a].linkToSkillButton.enabled=!1,this._currentUI.feedBackSender(this._bubblesForSort[a].name,"Ability"),this._bubblesForSort[a].skillUsed=!0,0!=a&&1!=a&&3!=a&&5!=a||this._playersCooldownAbilityArray[a].play("start_move","end_move",function(c){"start_move"==c.label&&b._currentUI.feedBackSender(b._bubblesForSort[a].name,"EndAbility")},this),setTimeout(function(){!b._isReplay&&b.getRealBubbleStatus(a)&&b._bubblesForSort[a].linkToSkillDB.play("out","idleOut")},30))},c.prototype.activateAbilityIngame=function(a){for(var b=0;b<this._bubblesForSort.length;b++)if(this._bubblesForSort[b].name==a){this.activateAbility(b),this._followOnPlayer&&this.tutorial2Start(!1);break}},c.prototype.openNewPlayer=function(){var a=this;this._bubblesForSort[0].linkToSkillButton.enabled=!1,this.activateNewPlayer(),this.openPlank(!1),this._followOnPlayer&&this.tutorial2Start(!1),setTimeout(function(){
!a._isReplay&&a.getRealBubbleStatus(0)&&a._bubblesForSort[0].linkToSkillDB.play("out","idleOut")},30),setTimeout(function(){!a._isReplay&&a.getRealBubbleStatus(0)&&a.activeClonePlayer()},1050)},c.prototype.createCooldownBubble=function(){var b=new a.DBSprite(a.Boot.GAME_HUD,"_DB_FOR_UI/portrait_cooldown_anim",this.game);b.play("end_move"),b.setPos(0,0);var c=new Phaser.Graphics(this.game,0,-32.65);c.beginFill(0,1),c.drawRect(0,0,32.65,32.65),c.endFill();var d=new Phaser.Graphics(this.game,0,0);d.beginFill(0,1),d.drawRect(0,0,32.65,32.65),d.endFill();var e=new Phaser.Graphics(this.game,-32.65,0);e.beginFill(0,1),e.drawRect(0,0,32.65,32.65),e.endFill();var f=new Phaser.Graphics(this.game,-32.65,-32.65);return f.beginFill(0,1),f.drawRect(0,0,32.65,32.65),f.endFill(),b.getBone("mask4").addChild(c),b.getBone("mask4").addChild(d),b.getBone("mask4").addChild(e),b.getBone("mask4").addChild(f),b.getBone("portrait_cooldown_module1").mask=c,b.getBone("portrait_cooldown_module2").mask=d,b.getBone("portrait_cooldown_module3").mask=e,b.getBone("portrait_cooldown_module4").mask=f,b},c.prototype.activeClonePlayer=function(){var a=this;this._currentBubbleLen<this._currentBubbleMax&&this.getRealBubbleStatus(0)&&"player"==this._bubblesForSort[0].name&&this._bubblesForSort[0].linkToSkillDB.play("activate","idle_ingame",function(b){"activate"==b.label&&(a._currentUI.feedBackSender("","PlayerAbilityReady"),a._bubblesForSort[0].linkToSkillButton.enabled=!0,a._bubblesForSort[0].skillUsed=!1)},this)},c.prototype.upBubbleAnimation=function(){var a=this;this._currentBubbleMax>0?(this._bubblesForSort[0]={name:"player",currentPlace:0,orderPlace:0,linkToObject:this._playerBubble,readyToMove:!1,inGame:!0,tween:null,currentActivated:!0,orderActivated:!0,skillUsed:!1,linkToSkillButton:null,linkToPlayerButton:null,linkToSkillDB:null,canChangeActivate:!0},this._bubblesForSort[0].linkToSkillButton=this._playerAbilityOB,this._bubblesForSort[0].linkToPlayerButton=this._playerButtonOB,this._bubblesForSort[0].linkToSkillDB=this._playerAbility,setTimeout(function(){!a._isReplay&&a.getRealBubbleStatus(0)&&a.activeClonePlayer()},600)):(setTimeout(function(){a._bubblesForSort[0].inGame=!0,a._bubblesForSort[0].linkToSkillDB.play("activate","idle_ingame",function(b){"activate"==b.label&&(a._bubblesForSort[0].linkToSkillButton.enabled=!0)},a)},600),this.tutorial2Start(!0)),this._bubblesForSort[0].linkToObject.visible=!0,this._bubblesForSort[0].linkToSkillButton.enabled=!0,this._bubblesForSort[0].linkToSkillDB.play("idleOut"),this._bubblesForSort[0].linkToSkillButton.enabled=!1,this._bubblesForSort[0].linkToPlayerButton.enabled=!1,this._bubblesForSort[0].linkToObject.play("in","idle",function(b){"in"==b.label&&(a._bubblesForSort[0].readyToMove=!0)},this),this.changeMarkerPosition(this._bubblesForSort[0].linkToPlayerButton,this._bubblesForSort[0].linkToObject)},c.prototype.refillAbility=function(){for(var a=this,b=function(b){if("player"!=c._bubblesForSort[b].name&&c._bubblesForSort[b].linkToObject.visible&&c.getRealBubbleStatus(b)&&("idleOut"==c._bubblesForSort[b].linkToSkillDB.currentLabel||"out"==c._bubblesForSort[b].linkToSkillDB.currentLabel)){var d=!0;0!=b&&1!=b&&3!=b&&5!=b||c._cooldownTimersArray[b]!=-1&&(d=!1),d&&!c._isReplay&&(c._bubblesForSort[b].skillUsed=!1,c._bubblesForSort[b].linkToSkillDB.play("activate","idle_ingame",function(c){"activate"==c.label&&(a.getRealBubbleStatus(b)?a._bubblesForSort[b].linkToSkillButton.enabled=!0:a._bubblesForSort[b].linkToSkillDB.animation.stop())},c))}},c=this,d=0;d<this._currentBubbleMax;d++)b(d)},c.prototype.activateNewPlayer=function(){var a=this,b=this._currentBubbleMax-this._currentBubbleLen;if(this.tutorial3Start(!0),this._bubblesForSort[b].linkToObject.setPos(this._positionXForBubble[this._currentBubbleLen][this._bubblesForSort[0].currentPlace+1],this._bubblesForSort[b].linkToObject.y),this._bubblesForSort[b].linkToPlayerButton.enabled=!0,this._bubblesForSort[b].inGame=!0,this._bubblesForSort[b].currentPlace=this._bubblesForSort[0].currentPlace+1,this._bubblesForSort[b].orderPlace=this._bubblesForSort[b].currentPlace,this._bubblesForSort[b].canChangeActivate=!1,this._bubblesForSort[b].skillUsed=!0,this._bubblesForSort[b].linkToObject.visible=!0,this._bubblesForSort[b].linkToObject.play("in",function(c){"in"==c.label&&(!a._isReplay&&a.getRealBubbleStatus(b)&&(a._bubblesForSort[b].linkToSkillDB.play("activate","idle_ingame",function(c){"activate"==c.label&&(a._bubblesForSort[b].linkToSkillButton.enabled=!0,a._bubblesForSort[b].skillUsed=!1)},a),a._bubblesForSort[b].linkToObject.play("idle")),setTimeout(function(){a._bubblesForSort[b].readyToMove=!0,a._bubblesForSort[b].canChangeActivate=!0},50))},this),this._currentBubbleInGame.length>0)for(var c=function(b){var c=d._currentBubbleMax-1-b;d._bubblesForSort[c].currentPlace>d._bubblesForSort[0].currentPlace&&d._bubblesForSort[c].orderPlace++,d._bubblesForSort[c].readyToMove=!1,d._bubblesForSort[c].tween&&d.game.tweens.remove(d._bubblesForSort[c].tween),d._bubblesForSort[c].tween=d.game.add.tween(d._bubblesForSort[c].linkToObject).to({x:d._positionXForBubble[d._currentBubbleLen][d._bubblesForSort[c].orderPlace]},200,Phaser.Easing.Sinusoidal.In,!0),d._bubblesForSort[c].tween.onComplete.addOnce(function(){a._bubblesForSort[c].currentPlace=a._bubblesForSort[c].orderPlace,a._bubblesForSort[c].readyToMove=!0}),d.getRealBubbleStatus(c)?d._bubblesForSort[c].linkToObject.play("move"):d._bubblesForSort[c].linkToObject.play("move_deactivated")},d=this,e=0;e<this._currentBubbleInGame.length;e++)c(e);this._currentBubbleInGame.push(this._bubblesForSort[b].linkToObject)},c.prototype.changeMarkerPosition=function(a,b){var c=this;if(this._startTargetMarker=!1,this._markerButton.inputEnabled=!1,this._currentDBTarget=b,"idleOut"==this._currentMarker.currentLabel)this._currentMarker.setPos(b.x,this._currentMarker.y),this._currentMarker.play("in","idle"),this._startTargetMarker=!0,this._markerButton.inputEnabled=!0;else{this.game.add.tween(this._currentMarker).to({x:b.x},100,Phaser.Easing.Sinusoidal.In,!0).onComplete.addOnce(function(){c._startTargetMarker=!0,c._markerButton.inputEnabled=!0},this);for(var d=0;d<this._bubblesForSort.length;d++)this._bubblesForSort[d].linkToPlayerButton!=a&&this._bubblesForSort[d].linkToObject.visible&&this.getRealBubbleStatus(d)&&(this._bubblesForSort[d].linkToPlayerButton.enabled=!0)}},c.prototype.openPlank=function(a){var b=this;void 0===a&&(a=!0),this._currentBubbleLen<this._currentBubbleMax&&(this._currentBubbleLen++,this._currentBubbleLen<this._currentBubbleMax?(this._bubblesForSort[0].readyToMove=!1,this._bubblesForSort[0].tween&&this.game.tweens.remove(this._bubblesForSort[0].tween),this._bubblesForSort[0].tween=this.game.add.tween(this._bubblesForSort[0].linkToObject).to({x:this._positionXForBubble[this._currentBubbleLen-1][this._bubblesForSort[0].orderPlace]},200,Phaser.Easing.Sinusoidal.In,!0),this._bubblesForSort[0].tween.onComplete.addOnce(function(){b._bubblesForSort[0].readyToMove=!0,b._bubblesForSort[0].currentPlace=b._bubblesForSort[0].orderPlace}),this.getRealBubbleStatus(0)?this._bubblesForSort[0].linkToObject.play("move"):this._bubblesForSort[0].linkToObject.play("move_deactivated"),this._playerIcon.getBone("player_"+this._bubblesForSort[this._currentBubbleMax-this._currentBubbleLen+1].name).visible=!1,a&&this._currentUI.feedBackSender(this._bubblesForSort[this._currentBubbleMax-this._currentBubbleLen+1].name,"AddNewPlayer")):(this._bubblesForSort[0].linkToObject.visible=!1,this._bubblesForSort[0].linkToPlayerButton.enabled=!1,this._bubblesForSort[0].linkToSkillButton.enabled=!1,this._bubblesForSort[0].name="jake",this._bubblesForSort[0].linkToObject=this._playersArray[0],this._bubblesForSort[0].inGame=!0,this._bubblesForSort[0].readyToMove=!1,this._bubblesForSort[0].skillUsed=!1,this._bubblesForSort[0].currentActivated=!0,this._bubblesForSort[0].orderActivated=!0,this._bubblesForSort[0].linkToSkillButton=this._playersArrayAbilityOB[0],this._bubblesForSort[0].linkToPlayerButton=this._playersArrayButtonOB[0],this._bubblesForSort[0].linkToSkillDB=this._playersAbilityArray[0],this._bubblesForSort[0].canChangeActivate=!0,this._bubblesForSort[0].tween=null,this._bubblesForSort[0].linkToObject.visible=!0,this.getRealBubbleStatus(0)?this._bubblesForSort[0].linkToObject.play("move"):this._bubblesForSort[0].linkToObject.play("move_deactivated"),this._bubblesForSort[0].linkToObject.setPos(this._playerBubble.x,this._playerBubble.y),this._bubblesForSort[0].linkToSkillDB.play("idleOut"),this._currentDBTarget==this._playerBubble&&this.changeMarkerPosition(this._bubblesForSort[0].linkToPlayerButton,this._bubblesForSort[0].linkToObject),a&&this._currentUI.feedBackSender(this._bubblesForSort[1].name,"AddNewPlayer"),a&&this._currentUI.feedBackSender(this._bubblesForSort[0].name,"AddNewPlayer"),setTimeout(function(){!b._isReplay&&b.getRealBubbleStatus(0)&&b._bubblesForSort[0].linkToSkillDB.play("activate","idle_ingame",function(a){"activate"==a.label&&(b._bubblesForSort[0].linkToSkillButton.enabled=!0,b._currentDBTarget!=b._bubblesForSort[0].linkToObject&&(b._bubblesForSort[0].linkToPlayerButton.enabled=!0))},b)},1300),this._bubblesForSort[0].tween&&this.game.tweens.remove(this._bubblesForSort[0].tween),this._bubblesForSort[0].tween=this.game.add.tween(this._bubblesForSort[0].linkToObject).to({x:this._positionXForBubble[this._currentBubbleLen-1][this._bubblesForSort[0].orderPlace]},200,Phaser.Easing.Sinusoidal.In,!0),this._bubblesForSort[0].tween.onComplete.addOnce(function(){b._bubblesForSort[0].currentPlace=b._bubblesForSort[0].orderPlace,b._bubblesForSort[0].readyToMove=!0})),this._bubbleDB.play("_"+this._currentBubbleLen))},c.prototype.bubblesUpdate=function(a){if(this._markerButton.x=this._currentMarker.x-35,this._markerButton.y=this._currentMarker.y-35,this._startTargetMarker&&(this._currentMarker.x=this._currentDBTarget.x),this._timeToBubbleUpdate-=a,this._timeToBubbleUpdate<=0&&(this._timeToBubbleUpdate=.25,this._isReplay||this._newCorrectPlaceArray.length>0&&!this._bubbleOrderArrayInProgress&&this.updateBubble()),this._timeToActivateUpdate-=a,this._timeToActivateUpdate<=0&&(this._timeToActivateUpdate=.1,this._isReplay||this.updateCurrentActivate()),this._followOnPlayer){var b=this._currentUI.getPlayerPos();this._tutorialCklick.setPos(b.x,b.y)}if(this._followOnBubble&&this._tutorialCklick.setPos(this._bubblesForSort[this._currentBubbleMax-1].linkToObject.worldPosition.x,this._bubblesForSort[this._currentBubbleMax-1].linkToObject.worldPosition.y),this._activeCooldown>0)for(var c=0;c<this._cooldownTimersArray.length;c++)if(this._cooldownTimersArray[c]>-1){this._cooldownTimersArray[c]+=a;var d=this._cooldownTimersArray[c]/this._cooldownOptimalTimeArray[c]*4.17;d>=4.17?(this._cooldownTimersArray[c]=-1,this._activeCooldown--,this._playersCooldownAbilityArray[c].play("end_move")):this._playersCooldownAbilityArray[c].animation.gotoAndStop("start_move",d)}},c.prototype.myInit=function(a){var b=this;if(this._currentBubbleMax=+a+1,this._currentBubbleMax>0)for(var c=0;c<this._iconInPlayerBubble.length;c++)c+1>this._currentBubbleMax?this._playerIcon.getBone("player_"+this._iconInPlayerBubble[c]).visible=!1:this._playerIcon.getBone("player_"+this._iconInPlayerBubble[c]).visible=!0;this._bubblesForSort[0].linkToSkillButton.enabled=!1,setTimeout(function(){b._playerAbility.play("idleOut")},10)},c.prototype.disableBtns=function(){this._isReplay=!0,this._startTargetMarker=!1,this._playerAbilityOB.enabled=!1,this._playerButtonOB.enabled=!1;for(var a=0;a<this._playersArray.length;a++)this._playersArrayButtonOB[a].enabled=!1,this._playersArrayAbilityOB[a].enabled=!1,0!=a&&1!=a&&3!=a&&5!=a||this._playersCooldownAbilityArray[a].animation.stop()},c.prototype.replayStart=function(){this._currentBubbleInGame=[],this._newCorrectPlaceArray=[],this._cooldownTimersArray=[],this._activeCooldown=0,this._currentBubbleLen=1,this._currentMarker.play("idleOut"),this._playerBubble.setPos(320,428),this._playerBubble.animation.stop(),this._playerBubble.play("out"),this._playerBubble.visible=!1,this._mainPlayerActivateAbility=!0,this._mainPlayerAvailable=!0,this._bubbleOrderArrayInProgress=!1,this._playerAbility.animation.stop(),this._playerAbility.play("idle_ingame","idleOut"),this.hideIcons();for(var a=0;a<this._playersArray.length;a++)this._playersArray[a].setPos(320,428),this._playersArray[a].animation.stop(),this._playersArray[a].play("out"),this._playersArray[a].visible=!1,this._abilityAvailable[a]=!0,this._playersActivate[a]=!0,this._playersAbilityArray[a].animation.stop(),this._playersAbilityArray[a].play("idle_ingame","idleOut"),this._bubblesForSort[a].inGame=!1,this._bubblesForSort[a].readyToMove=!1,this._bubblesForSort[a].skillUsed=!1,this._bubblesForSort[a].currentActivated=!0,this._bubblesForSort[a].orderActivated=!0,this._cooldownTimersArray[a]=-1,0!=a&&1!=a&&3!=a&&5!=a||this._playersCooldownAbilityArray[a].play("end_move")},c.prototype.replayEnd=function(){this._isReplay=!1},c}(Phaser.Sprite);a.BuubleIcons=c}(TProject||(TProject={}));var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),TProject;!function(a){var b=function(b){function c(c,d){var e=b.call(this,c,0,0)||this;e._baseGame=d,e._soundActive=a.Boot.GAME_DATA.playMusic,e._isReplay=!1,e._isStartPlay=!1,e._uiReadyToRestart=!1,e._achievementDistanceInThisRound=!1,0==a.Boot.GAME_DATA.tutorState&&(e._achievementDistanceInThisRound=!0),e._globalRestart=!1,e._laserPower="",e._achievementCount=0,e._distanceNumber=0,e._distanceMaxNumber=a.Boot.GAME_DATA.maxDistance,e._medalsDB=[],e._activeBoosterArray=[],e._activeBIconArray=[],e._abilityText=[],e.createStartScreen(),e._ingameHUD=new a.DBSprite(a.Boot.GAME_HUD,"_DB_FOR_UI/hud",e.game),e._ingameHUD.setPos(0,0),e._ingameHUD.play("idleOut"),e.addChild(e._ingameHUD);var f=new a.DBSprite(e._ingameHUD.getBone("score"));e._scorePlank=new a.DBSprite(f.getBone("distance_bg"));for(var g=new a.DBSprite(f.getBone("achievement_bg")),h=0;h<3;h++)e._medalsDB.push(new a.DBSprite(g.getBone("medals"+(h+1)))),e._medalsDB[h].play("idleOff");e._powerSymbolDB=new a.DBSprite(g.getBone("icon")),e._powerSymbolDB.play("idle"),e._bubblesPlank=new a.DBSprite(e._ingameHUD.getBone("bubbles")),e._gameBtnReplayDBMin=new a.DBSprite(e._ingameHUD.getBone("btn_replay_min")),e._gameBtnReplayDBBig=new a.DBSprite(e._ingameHUD.getBone("btn_replay_big")),e._sfxBtn=new a.DBSprite(e._startMainScreen.getBone("btn_sound")),e._sfxBtn.getSlot("icon").gotoAndStop(a.Boot.GAME_DATA.playMusic?"on":"off"),e._btnSound=new a.OverlayButton(e.game,e._sfxBtn,40,["idle","mouseOver","mouseOut","mouseDown"],function(){e._soundActive=!e._soundActive,a.Boot.GAME_DATA.playMusic=e._soundActive,a.SaveManager.getInstance.save(),e._soundActive?a.SoundMixer.on():a.SoundMixer.off(),e._sfxBtn.getSlot("icon").gotoAndStop(e._soundActive?"on":"off")},e),e._startMainScreen.getBone("btn_sound").addChild(e._btnSound),e._btnSound.enabled=!1,e._menuBtn=new a.DBSprite(e._ingameHUD.getBone("btn_menu")),e._btnMenu=new a.OverlayButton(e.game,e._menuBtn,70,["idle","mouseOver","mouseOut","mouseDown"],function(){e._ingameHUD.alpha=0,e._pauseMenu.startPause(),e._pauseMenu.visible=!0,e._pauseMenu.inputEnabled=!0},e),e._ingameHUD.getBone("btn_menu").addChild(e._btnMenu),e._btnMenu.enabled=!1,e._btnReplayBig=new a.OverlayButton(e.game,e._gameBtnReplayDBBig,110,["idle","mouseOver","mouseOut","mouseDown"],function(){e._ingameHUD.play("retryOut","idle",function(a){"retryOut"==a.label&&(e._btnReplayMin.enabled=!0)},e),e._btnReplayBig.enabled=!1,e.replayStart()},e),e._ingameHUD.getBone("btn_replay_big").addChild(e._btnReplayBig),e._btnReplayBig.enabled=!1,e._btnReplayMin=new a.OverlayButton(e.game,e._gameBtnReplayDBMin,40,["idle","mouseOver","mouseOut","mouseDown"],function(){e.replayStart(),e._btnReplayMin.enabled=!1},e),e._ingameHUD.getBone("btn_replay_min").addChild(e._btnReplayMin),e._btnReplayMin.enabled=!1,e._btn_launch_hairMask=new Phaser.Graphics(e.game,68,68),e._btn_launch_hairMask.beginFill(0,.5),e._btn_launch_hairMask.drawCircle(0,0,135),e._btn_launch_hairMask.endFill(),e._power_meter=new a.DBSprite(e._ingameHUD.getBone("power_meter")),e._power_btn=new a.DBSprite(e._power_meter.getBone("Layer 1")),e._power_btn.getBone("Layer 7").addChild(e._btn_launch_hairMask),e._power_btn.getBone("btn_launch_hair").mask=e._btn_launch_hairMask,e._power_btn.animation.timeScale=2.3,e._power_meter.animation.timeScale=2.3,e._buubleIcons=new a.BuubleIcons(e.game,e._bubblesPlank,e),e.addChild(e._buubleIcons);for(var h=0;h<5;h++)e._activeBoosterArray.push(new a.DBSprite(a.Boot.GAME_HUD,"_DB_FOR_UI/boost_feedback",e.game)),e._activeBoosterArray[h].setPos(0,50*h),e._activeBoosterArray[h].play("idle"),e.addChild(e._activeBoosterArray[h]),e._abilityText[h]=e.game.add.text(0,-4,"LA SUPRIME FEAR!",{font:a.Boot.FONT_NAME_LIGHT,fontSize:"22px",fontWeight:"normal",fill:"#ffffff",align:"center",stroke:"#8e0498",strokeThickness:5}),e._abilityText[h].anchor.set(.5,.5),e._abilityText[h].setShadow(3,3,"#5a0460",0),e._activeBIconArray.push(new a.DBSprite(e._activeBoosterArray[h].getBone("container"))),e._activeBIconArray[h].play("jake"),e._activeBIconArray[h].getBone("title").addChild(e._abilityText[h]);return e._openNewPlayer=new a.DBSprite(a.Boot.GAME_HUD,"_DB_FOR_UI/character_unlock",e.game),e._openNewPlayer.setPos(0,0),e._openNewPlayer.play("idle"),e.addChild(e._openNewPlayer),e._achievementPopUp=new a.DBSprite(a.Boot.GAME_HUD,"_DB_FOR_UI/medal_popup",e.game),e._achievementPopUp.setPos(0,0),e._achievementPopUp.play("idle"),e.addChild(e._achievementPopUp),e._achievementPopUp.addEvent("frameEvent",e.achievementPopUpTextEvent,e),e._transitionPopUp=new a.DBSprite(a.Boot.GAME_HUD,"_DB_FOR_UI/transition",e.game),e._transitionPopUp.setPos(0,0),e._transitionPopUp.play("idle"),e.addChild(e._transitionPopUp),e.game.input.enabled=!0,e._power_btn.addEvent("frameEvent",e.clickEvent,e),e.game.input.onDown.add(function(){e._pauseMenu.visible||e.btnDownOnStart()},e),e.createText(),e._pauseMenu=new a.PauseMenu(e.game,e),e.addChild(e._pauseMenu),e._pauseMenu.visible=!1,e._pauseMenu.inputEnabled=!1,e}return __extends(c,b),c.prototype.activeteGame=function(){this._ingameHUD.alpha=1,this._pauseMenu.visible=!1,this._pauseMenu.inputEnabled=!1,this.game.paused=!1},c.prototype.replayGame=function(){this._ingameHUD.alpha=1,this._pauseMenu.visible=!1,this._pauseMenu.inputEnabled=!1,this.game.paused=!1,this.replayStart(),this._btnReplayMin.enabled=!1},c.prototype.startGameToMainScreen=function(){var b=this;this.game.paused=!1,this._ingameHUD.alpha=1,this._pauseMenu.visible=!1,this._pauseMenu.inputEnabled=!1,this._sfxBtn.getSlot("icon").gotoAndStop(a.Boot.GAME_DATA.playMusic?"on":"off"),this._ingameHUD.animation.stop(),this._ingameHUD.play("out"),this._globalRestart=!0;var c=new Phaser.Graphics(this.game,0,0);c.beginFill(0,1),c.drawRect(0,0,this.game.width,this.game.height),c.endFill(),this.addChild(c),c.alpha=0,this.game.add.tween(c).to({alpha:1},100,Phaser.Easing.Linear.None,!0).onComplete.addOnce(function(){b.feedBackSender("","PrepareRestart"),b._isReplay=!0,b._isStartPlay=!1,b._buubleIcons.disableBtns(),b.feedBackSender("","Restart");for(var d=0;d<3;d++)b._medalsDB[d].play("idleOff");b._powerSymbolDB.play("idle"),b._achievementCount=0,b._achievementPopUp.visible=!1,b._achievementPopUp.play("idle",function(){b._achievementPopUp.visible=!0},b),b._distanceNumberText.text="0";for(var e=function(a){b._activeBoosterArray[a].visible=!1,b._activeBoosterArray[a].play("idle",function(){b._activeBoosterArray[a].visible=!0},b)},d=0;d<b._activeBoosterArray.length;d++)e(d);b._openNewPlayer.visible=!1,b._openNewPlayer.play("idle",function(){b._openNewPlayer.visible=!0},b),b._bubblesPlank.play("idleOut"),b._power_meter.play("idleOut"),b._buubleIcons.replayStart(),b._uiReadyToRestart=!1,setTimeout(function(){b._startMainScreen.visible=!0,b._btnPlay.enabled=!1,b._startMainScreen.visible=!0,b._btnPlay.enabled=!1,b._startMainScreen.play("in","idle",function(c){"in"==c.label&&(b._globalRestart=!1,b._btnPlay.enabled=!0,b._btnSound.enabled=!0,b._sfxBtn.play("idle"),b._sfxBtn.getSlot("icon").gotoAndStop(a.Boot.GAME_DATA.playMusic?"on":"off"))},b),b._gameBtnPlayDB.play("idle"),b.game.add.tween(c).to({alpha:0},100,Phaser.Easing.Linear.None,!0).onComplete.addOnce(function(){c.destroy(!0)},b)},250)},this)},c.prototype.pauseUpdate=function(){this._pauseMenu.game.tweens.update(),this._pauseMenu.game.input.update(),this._pauseMenu.pauseUpdate()},c.prototype.feedBackSender=function(a,b,c){switch(b){case"Ability":this.activateBooster(a),this._baseGame.activateBoostFromUI(a);break;case"AddNewPlayer":this._baseGame.addPlayerFromUI(a);break;case"CameraMove":this._baseGame.cameraTarget=this._baseGame.getPlayerByName(a),this._baseGame.moveCamera();break;case"SetPower":this._baseGame.setPowerToLaunch(a);break;case"Restart":this._baseGame.restart();break;case"PrepareRestart":break;case"EndAbility":break;case"PlayerAbilityReady":this._baseGame.refillJakeSplit()}},c.prototype.feedBackRecipient=function(a,b,c){var d=this;switch(b){case"AddAchievement":this.achivementActivate(a);break;case"OpenNewPlayer":this.openPlayer(a);break;case"Deactivate":this._buubleIcons.changeActivateCharacter(a,!1);break;case"Reactivate":this._buubleIcons.changeActivateCharacter(a,!0);break;case"SetCharsNumber":this._buubleIcons.myInit(a);break;case"RetryOpen":this._btnReplayMin.enabled=!1,this._buubleIcons.hideIcons(),this._buubleIcons.disableBtns(),this._ingameHUD.play("retryIn",function(a){"retryIn"==a.label&&(d._btnReplayBig.enabled=!0)},this);break;case"SetDistance":this.updateDistance(a);break;case"AddNewPlayerInScreen":this._buubleIcons.openNewPlayer();break;case"AbilityActivate":this._buubleIcons.activateAbilityIngame(a);break;case"CameraMove":this._buubleIcons.changeCameraTargetInGame(a);break;case"CameraMoveToCharIsEnd":this._buubleIcons.tryActivateAbility();break;case"ActivateIngameAbilityAndCameraMove":this._buubleIcons.ActivateIngameAbilityAndCameraMove(a)}},c.prototype.swapChars=function(a,b){this._buubleIcons.resetBubbleOrder(a,b)},c.prototype.updateDistance=function(a){this._distanceNumber=+a,this._distanceNumberText.text=this._distanceNumber.toString(),this._distanceNumber>this._distanceMaxNumber&&(this._achievementDistanceInThisRound||(this.feedBackRecipient("new_distance","AddAchievement"),this._achievementDistanceInThisRound=!0),this._distanceMaxNumber=this._distanceNumber,this._distanceMaxNumberText.text=this._distanceNumberText.text)},c.prototype.btnDownOnStart=function(){var b=this;this._isStartPlay&&null==this.game.input.activePointer.targetObject&&(a.SoundMixer.stop("powermeter"),a.SoundMixer.play("start_ray"),this.feedBackSender(this._laserPower.replace("power",""),"SetPower"),this._power_btn.pause(),this._buubleIcons.tutorial1Start(!1),this._isStartPlay=!1,setTimeout(function(){b._isReplay||(b._ingameHUD.getSlot("power_meter").play("out"),b._bubblesPlank.play("in_game"),b._buubleIcons.upBubbleAnimation())},500))},c.prototype.setDragToObject=function(a){a.inputEnabled=!0,a.input.enableDrag(),a.events.onDragStop.add(this.onDragStop,this)},c.prototype.onDragStop=function(a){},c.prototype.powerBtnEnable=function(){this._isStartPlay=!0,this._buubleIcons.tutorial1Start(!0)},c.prototype.clickEvent=function(a){this._laserPower=a.name},c.prototype.achievementPopUpTextEvent=function(a){"textIn"==a.name?this.game.add.tween(this._achievementBoldText).to({alpha:0},300,Phaser.Easing.Linear.None,!0):"textOut"==a.name&&this.game.add.tween(this._achievementBoldText).to({alpha:1},200,Phaser.Easing.Linear.None,!0)},c.prototype.achivementActivate=function(a){var b=this,c="";switch(a){case"max_power":c="Maximum Power!";break;case"max_speed":c="Maximum Speed!";break;case"new_distance":c="New Record!";break;case"boosters":c="Skill-o-rama";break;case"best_buddies":c="Best Buds!";break;case"winter_fugitive":c="Lone Wolf";break;case"sound_of_music":c="Music to My Ears";break;case"sword":c="March of the Sword Master";break;case"deforestation":c="Forest Companion";break;case"gunter":c="Penguin Hunter";break;case"snowman":c="Snowman Tumbler";break;case"crowded":c="Crowded!"}this._achievementText.text=c,this._achievementBoldText.text=c,"idle"==this._achievementPopUp.currentLabel?(this._achievementPopUp.play("in","idle"),this._achievementPopUp.getSlot("Layer 1").play(a),this.addAchievement()):setTimeout(function(){b._isReplay||b.achivementActivate(a)},50)},c.prototype.openPlayer=function(a){var b="";switch(a){case"finn":b="FINN!";break;case"jake":b="JAKE!";break;case"bmo":b="BMO!";break;case"bubblegum":b="BUBBLEGUM PRINCESS!";break;case"iceking":b="the ICE KING!";break;case"lumpy":b="LUMPY SPACE PRINCESS!";break;case"marceline":b="MARCELINE"}this._newCharOpenText.text="You've unlocked \n"+b,this._openNewPlayer.play("in","idle"),this._openNewPlayer.getSlot("portrait").play(a)},c.prototype.addAchievement=function(){if(a.SoundMixer.play("trophy"),this._achievementCount++,this._medalsDB[this._achievementCount-1].play("on_game","idle_game"),this._achievementCount>=3){for(var b=0;b<3;b++)this._medalsDB[b].play("off_game","idleOff");this._baseGame.refill(),this._powerSymbolDB.play("refill","idle"),this._achievementCount=0,this._buubleIcons.refillAbility()}},c.prototype.getSkillPlayersActive=function(a){return this._baseGame.getPlayerSkillInUse(a)},c.prototype.activateBooster=function(a){var b=this,c=!1,d="";switch(a){case"finn":d="SPIRIT SWORD";break;case"jake":d="GIANT JAKE";break;case"bubblegum":d="BOUNCY BUBBLE";break;case"marceline":d="VAMPIRE JAM";break;case"iceking":d="BOULDER FREEZE";break;case"lumpy":d="FLOAT N' GLOAT";break;case"bmo":d="DELETE ROCKS!"}for(var e=0;e<this._activeBoosterArray.length;e++)if("idle"==this._activeBoosterArray[e].currentLabel){this._activeBoosterArray[e].play("in","idle"),this._activeBIconArray[e].play(a),this._abilityText[e].text=d,c=!0;break}c||setTimeout(function(){b._isReplay||b.activateBooster(a)},50)},c.prototype.replayStart=function(){var b=this;this.feedBackSender("","PrepareRestart"),this._isReplay=!0,this._isStartPlay=!1,this._buubleIcons.disableBtns(),a.Boot.GAME_DATA.maxDistance=this._distanceMaxNumber,a.SaveManager.getInstance.save(),a.SoundMixer.play("snowslide"),this._transitionPopUp.play("in","idleIn",function(a){if("in"==a.label){b.feedBackSender("","Restart");for(var c=0;c<3;c++)b._medalsDB[c].play("idleOff");b._powerSymbolDB.play("idle"),b._achievementCount=0,b._achievementPopUp.visible=!1,b._achievementPopUp.play("idle",function(){b._achievementPopUp.visible=!0},b),b._distanceNumberText.text="0";for(var d=function(a){b._activeBoosterArray[a].visible=!1,b._activeBoosterArray[a].play("idle",function(){b._activeBoosterArray[a].visible=!0},b)},c=0;c<b._activeBoosterArray.length;c++)d(c);b._openNewPlayer.visible=!1,b._openNewPlayer.play("idle",function(){b._openNewPlayer.visible=!0},b),b._bubblesPlank.play("idleOut"),b._power_meter.play("idleOut"),b._buubleIcons.replayStart(),b._uiReadyToRestart=!0}},this)},c.prototype.gameIsRestart=function(){var a=this;this._globalRestart||(this._uiReadyToRestart?this._transitionPopUp.play("out","idle",function(b){"out"==b.label&&a.replayEnd()},this):setTimeout(function(){a.gameIsRestart()},50))},c.prototype.replayEnd=function(){var b=this;this._btnReplayMin.enabled=!0,this._isReplay=!1,this._uiReadyToRestart=!1,this._achievementDistanceInThisRound=!1,this._buubleIcons.replayEnd(),a.SoundMixer.play("bgm_powermeter",.2,!0),a.SoundMixer.play("powermeter"),setTimeout(function(){b._power_btn.play("idle_power_start")},10),this._power_meter.play("in_power","idle_power",function(a){"in_power"==a.label&&b.powerBtnEnable()},!0)},c.prototype.createBoxBorders=function(){this._blackBordersContainer=this.game.add.sprite(0,0),this.addChild(this._blackBordersContainer);var a=new Phaser.Graphics(this.game,-313.5,-234.3);a.beginFill(0,1),a.drawRect(-95.6,-83.65,95.65,647.55),a.endFill(),this._blackBordersContainer.addChild(a);var b=new Phaser.Graphics(this.game,-313.5,-234.3);b.beginFill(0,1),b.drawRect(-95.6,-85,832.85,84.15),b.endFill(),this._blackBordersContainer.addChild(b);var c=new Phaser.Graphics(this.game,-313.5,-234.3);c.beginFill(0,1),c.drawRect(640.25,-83.65,95.65,647.55),c.endFill(),this._blackBordersContainer.addChild(c);var d=new Phaser.Graphics(this.game,-313.5,-234.3);d.beginFill(0,1),d.drawRect(-96.5,480,832.85,84.15),d.endFill(),this._blackBordersContainer.addChild(d)},c.prototype.createStartScreen=function(){var b=this;this.createBoxBorders(),this._gameLogo=this.game.add.sprite(0,0,"gameLogo"),this._gameLogo.anchor.set(.5),this._startMainScreen=new a.DBSprite(a.Boot.GAME_HUD,"_DB_FOR_UI/main",this.game),this._gameBtnPlayDB=new a.DBSprite(this._startMainScreen.getBone("btn_play")),this._btnPlay=new a.OverlayButton(this.game,this._gameBtnPlayDB,110,["idle","mouseOver","mouseOut","mouseDown"],function(){a.SoundMixer.play("bgm_powermeter",.2,!0),a.SoundMixer.play("powermeter"),b._btnPlay.enabled=!1,b._startMainScreen.play("out",function(){b._startMainScreen.visible=!1,b._btnPlay.enabled=!1,b._menuBtn.play("idle"),b._ingameHUD.play("in","idle",function(a){"in"==a.label&&(b._btnReplayMin.enabled=!0,b._btnMenu.enabled=!0,b._power_btn.play("idle_power_start"),b._power_meter.play("in_power","idle_power"),setTimeout(function(){b.powerBtnEnable()},600))},b),b._ingameHUD.getSlot("btn_replay_min").play("idle"),b._ingameHUD.getSlot("btn_replay_big").play("idle")},b)},this),this._btnPlay.enabled=!1,this._startMainScreen.getBone("logo").addChild(this._gameLogo),this._startMainScreen.getBone("bg_overlay").addChild(this._blackBordersContainer),this._startMainScreen.getBone("btn_play").addChild(this._btnPlay),this._startMainScreen.setPos(0,0),this._startMainScreen.play("in","idle",function(c){"in"==c.label&&(b._btnPlay.enabled=!0,b._btnSound.enabled=!0,b._sfxBtn.play("idle"),b._sfxBtn.getSlot("icon").gotoAndStop(a.Boot.GAME_DATA.playMusic?"on":"off"))},this),this._gameBtnPlayDB.play("idle"),this.addChild(this._startMainScreen)},c.prototype.endlessSkill=function(){var a=this;this._isReplay||setTimeout(function(){a.feedBackRecipient("new_distance","AddAchievement"),a.endlessSkill()},200)},c.prototype.createText=function(){this._distanceNumberText=this.game.add.text(34,19,this._distanceNumber.toString(),{font:a.Boot.FONT_NAME_LIGHT,fontSize:"20px",fontWeight:"normal",fill:"#ffffff",align:"left",stroke:"#eb991d",strokeThickness:2}),this._distanceNumberText.anchor.set(0,.5),this._distanceNumberText.setShadow(0,2,"#a00601",0),this._scorePlank.getBone("bg").addChild(this._distanceNumberText),this._distanceMaxNumberText=this.game.add.text(153,26,this._distanceMaxNumber.toString(),{font:a.Boot.FONT_NAME_LIGHT,fontSize:"13px",fontWeight:"normal",fill:"#ffffff",align:"center",stroke:"#eb991d",strokeThickness:2}),this._distanceMaxNumberText.anchor.set(.5,.5),this._distanceMaxNumberText.setShadow(0,1,"#a00601",0),this._scorePlank.getBone("bg").addChild(this._distanceMaxNumberText),this._distanceMaxText=this.game.add.text(153,12,"RECORD",{font:a.Boot.FONT_NAME_LIGHT,fontSize:"13px",fontWeight:"normal",fill:"#ffffff",align:"center",stroke:"#eb991d",strokeThickness:2}),this._distanceMaxText.anchor.set(.5,.5),this._distanceMaxText.setShadow(0,2,"#a00601",0),this._scorePlank.getBone("bg").addChild(this._distanceMaxText),this._bigReplayText=this.game.add.text(0,-9,"TRY AGAIN!",{font:a.Boot.FONT_NAME_HARD,fontSize:"50px",fontWeight:"bold",fill:"#ffffff",align:"center",stroke:"#d4740a",strokeThickness:8}),this._bigReplayText.anchor.set(.5,.5),this._ingameHUD.getBone("try_again_text").addChild(this._bigReplayText),this._achievementText=this.game.add.text(0,0,"best enemies",{font:a.Boot.FONT_NAME_LIGHT,fontSize:"20px",fontWeight:"normal",fill:"#ffffff",align:"center",stroke:"#d68535",strokeThickness:5}),this._achievementText.anchor.set(.5,0),
this._achievementPopUp.getBone("Layer 3").addChild(this._achievementText),this._achievementBoldText=this.game.add.text(0,0,"best enemies",{font:a.Boot.FONT_NAME_HARD,fontSize:"20px",fontWeight:"bold",fill:"#ffffff",align:"center",stroke:"#ffffff",strokeThickness:5}),this._achievementBoldText.anchor.set(.5,0),this._achievementPopUp.getBone("Layer 3").addChild(this._achievementBoldText),this._newCharOpenText=this.game.add.text(57,-10,"Тебе доступна ПРИНЦЕССА ПУПЫРЧАТОГО КОРОЛЕВСТВА!",{font:a.Boot.FONT_NAME_LIGHT,fontSize:"12px",fontWeight:"normal",fill:"#ffffff",align:"right",stroke:"#000000",strokeThickness:1}),this._newCharOpenText.anchor.set(1,0),this._newCharOpenText.wordWrap=!0,this._newCharOpenText.wordWrapWidth=150,this._newCharOpenText.lineSpacing=-10,this._openNewPlayer.getBone("title").addChild(this._newCharOpenText)},c.prototype.init=function(){},c.prototype.guiUpdate=function(a){this._buubleIcons.bubblesUpdate(a)},c.prototype.getPlayerPos=function(){return this._baseGame.getPlayerPosition()},c}(Phaser.Sprite);a.GameUI=b}(TProject||(TProject={}));var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),TProject;!function(a){var b=function(b){function c(c,d){var e=b.call(this,c,0,0)||this;return e._gameUI=d,e._soundActive=a.Boot.GAME_DATA.playMusic,e._bgBlack=new Phaser.Graphics(e.game,0,0),e._bgBlack.beginFill(0,1),e._bgBlack.drawRect(0,0,e.game.width,e.game.height),e._bgBlack.endFill(),e.addChild(e._bgBlack),e._bgBlack.alpha=0,e._bgBlack.inputEnabled=!1,e._bgBlack.game.input.onDown.add(function(){e._isPaused},e),e._menuHUD=new a.DBSprite(a.Boot.GAME_HUD,"_DB_FOR_UI/pause_menu",e.game),e._menuHUD.setPos(0,0),e._menuHUD.play("menu_idle"),e.addChild(e._menuHUD),e._menuHUD.visible=!1,e._sfxBtn=new a.DBSprite(e._menuHUD.getBone("btn_sound")),e._sfxBtn.getSlot("icon").gotoAndStop(a.Boot.GAME_DATA.playMusic?"on":"off"),e._btnSound=new a.OverlayButtonForPause(e.game,e._sfxBtn,76,["idle","mouseOver","mouseOut","mouseDown"],function(){e._soundActive=!e._soundActive,a.Boot.GAME_DATA.playMusic=e._soundActive,a.SaveManager.getInstance.save(),e._soundActive?a.SoundMixer.on():a.SoundMixer.off(),e._sfxBtn.getSlot("icon").gotoAndStop(e._soundActive?"on":"off")},e),e._menuHUD.getBone("btn_sound").addChild(e._btnSound),e._btnSound.enabled=!1,e._backToMenuBtn=new a.DBSprite(e._menuHUD.getBone("btn_home")),e._btnMenu=new a.OverlayButtonForPause(e.game,e._backToMenuBtn,76,["idle","mouseOver","mouseOut","mouseDown"],function(){e._isPaused=!1,e._bgBlack.inputEnabled=!1,e._menuHUD.visible=!1,e._btnSound.enabled=!1,e._btnMenu.enabled=!1,e._btnPlay.enabled=!1,e._btnRestart.enabled=!1,e._btnNext.enabled=!1,e._btnPrev.enabled=!1,e._bgBlack.alpha=0,e._gameUI.startGameToMainScreen()},e),e._menuHUD.getBone("btn_home").addChild(e._btnMenu),e._btnMenu.enabled=!1,e._continueBtn=new a.DBSprite(e._menuHUD.getBone("btn_play")),e._btnPlay=new a.OverlayButtonForPause(e.game,e._continueBtn,106,["idle","mouseOver","mouseOut","mouseDown"],function(){e._isPaused=!1,e._bgBlack.inputEnabled=!1,e._menuHUD.visible=!1,e._btnSound.enabled=!1,e._btnMenu.enabled=!1,e._btnPlay.enabled=!1,e._btnRestart.enabled=!1,e._btnNext.enabled=!1,e._btnPrev.enabled=!1,e._bgBlack.alpha=0,e._gameUI.activeteGame()},e),e._menuHUD.getBone("btn_play").addChild(e._btnPlay),e._btnPlay.enabled=!1,e._restartBtn=new a.DBSprite(e._menuHUD.getBone("btn_restart")),e._btnRestart=new a.OverlayButtonForPause(e.game,e._restartBtn,76,["idle","mouseOver","mouseOut","mouseDown"],function(){e._isPaused=!1,e._bgBlack.inputEnabled=!1,e._menuHUD.visible=!1,e._btnSound.enabled=!1,e._btnMenu.enabled=!1,e._btnPlay.enabled=!1,e._btnRestart.enabled=!1,e._btnNext.enabled=!1,e._btnPrev.enabled=!1,e._bgBlack.alpha=0,e._gameUI.replayGame()},e),e._menuHUD.getBone("btn_restart").addChild(e._btnRestart),e._btnRestart.enabled=!1,e._nextBtn=new a.DBSprite(e._menuHUD.getBone("btn_next")),e._btnNext=new a.OverlayButtonForPause(e.game,e._nextBtn,76,["idle","mouseOver","mouseOut","mouseDown"],function(){e._firstCheck.play("off"),e._secondCheck.play("on"),e._btnPrev.enabled=!0,e._btnNext.enabled=!1,setTimeout(function(){e._nextBtn.animation.stop(),e._nextBtn.play("disable")},10),e._prevBtn.play("idle"),e._hints.play("2")},e),e._menuHUD.getBone("btn_next").addChild(e._btnNext),e._btnNext.enabled=!1,e._prevBtn=new a.DBSprite(e._menuHUD.getBone("btn_prev")),e._btnPrev=new a.OverlayButtonForPause(e.game,e._prevBtn,76,["idle","mouseOver","mouseOut","mouseDown"],function(){e._firstCheck.play("on"),e._secondCheck.play("off"),e._btnNext.enabled=!0,e._btnPrev.enabled=!1,e._nextBtn.play("idle"),setTimeout(function(){e._prevBtn.animation.stop(),e._prevBtn.play("disable")},10),e._hints.play("1")},e),e._menuHUD.getBone("btn_prev").addChild(e._btnPrev),e._btnPrev.enabled=!1,e._hints=new a.DBSprite(e._menuHUD.getBone("hints")),e._hints.play("1"),e._firstCheck=new a.DBSprite(e._menuHUD.getBone("switch_1")),e._firstCheck.play("on"),e._secondCheck=new a.DBSprite(e._menuHUD.getBone("switch_2")),e._secondCheck.play("off"),e}return __extends(c,b),c.prototype.pauseUpdate=function(){this._btnSound.update(),this._btnMenu.update(),this._btnPlay.update(),this._btnRestart.update(),this._btnNext.update(),this._btnPrev.update()},c.prototype.startPause=function(){var b=this;this.game.paused=!0,this._soundActive=a.Boot.GAME_DATA.playMusic,this._sfxBtn.getSlot("icon").gotoAndStop(this._soundActive?"on":"off"),this._firstCheck.play("on"),this._secondCheck.play("off"),this._hints.play("1"),this.game.add.tween(this._bgBlack).to({alpha:.9},300,Phaser.Easing.Linear.None,!0).onComplete.addOnce(function(){b._isPaused=!0,b._bgBlack.inputEnabled=!0,b._menuHUD.visible=!0,b._btnSound.enabled=!0,b._btnMenu.enabled=!0,b._btnPlay.enabled=!0,b._btnRestart.enabled=!0,b._btnNext.enabled=!0,b._btnPrev.enabled=!1,b._prevBtn.play("disable")},this)},c}(Phaser.Sprite);a.PauseMenu=b}(TProject||(TProject={}));var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),TProject;!function(a){var b=function(a){function b(b,c,d){var e=a.call(this)||this;return e._eventsBounds=null,b instanceof dragonBones.PhaserFactory?(d?d.world.add(e):"",e._visual=b.buildArmatureDisplay(c),e.addChild(e._visual)):e._visual=b,e._pausedTime=-1,e}return __extends(b,a),b.prototype.free=function(){this._eventsBounds&&this._eventsBounds.destroy(!0),this._visual.dispose(!0)},b.prototype.stopInteractive=function(){this._eventsBounds.inputEnabled=!1},b.prototype.addEvent=function(a,b,c){this._visual.addEvent(a,b,c?c:this)},b.prototype.removeEvent=function(a,b){this._visual.removeEvent(a,b,null)},b.prototype.removeFromParent=function(){this.parent&&this.parent.removeChild(this)},b.prototype._play=function(a,b){if(a!=this._currentLabel||0!=this._playTimes||!this._visual.animation.isPlaying)return this._currentLabel=a,this._pausedTime=-1,this._currentAnimState=this._visual.animation.play(a,b),this._playTimes=this._currentAnimState.playTimes,this._currentAnimState},b.prototype.playEx=function(a,b,c,d){return this._nextState=b,this._cb=c,this._cbContext=d?d:this,this._play(a),(b||c)&&this.addEvent(1==this._playTimes?"complete":"loopComplete",this.completePlaying),this._currentAnimState},b.prototype.play=function(a,b,c,d){return"string"==typeof b?this.playEx(a,b,c,d):"function"==typeof b?this.playEx(a,null,b,c):this._play(a)},b.prototype.stop=function(){this._visual.animation.stop()},b.prototype.pause=function(){null==this._currentAnimState&&this._visual.animation.stop(),this._pausedTime=this._currentAnimState.currentTime,this._visual.animation.stop(this._currentLabel)},b.prototype.resume=function(){this._pausedTime!=-1&&(this._pausedTime=-1,this._visual.animation.gotoAndPlayByTime(this._currentLabel,this._pausedTime))},b.prototype.completePlaying=function(a){this.removeEvent("complete",this.completePlaying),this.removeEvent("loopComplete",this.completePlaying),a.label=this.currentLabel,"function"==typeof this._cb&&this._cb.bind(this._cbContext)(a),this._nextState?this.playEx(this._nextState,null,this._cb,this._cbContext):this._cb=null},b.prototype.getBone=function(a){var b=this._visual.armature.getSlot(a);return b.childArmature?b.childArmature.display:b.display},b.prototype.getBoneArmature=function(a){return this._visual.armature.getSlot(a).childArmature},b.prototype.getSlot=function(a){var b=this._visual.armature.getSlot(a);return null==b||null==b.childArmature?null:b.childArmature.animation},b.prototype.setPos=function(a,b){this.x=a?a:this.x,this.y=b?b:this.y},b.prototype.createBounds=function(a){null!=this._eventsBounds&&(this.removeChild(this._eventsBounds),this._eventsBounds.destroy(!0));var b=this.getBounds();this._eventsBounds=new Phaser.Graphics(a,0,0),this._eventsBounds.beginFill(16711680,0),this._eventsBounds.drawRect(.5*-b.width,.5*-b.height,b.width,b.height),this._eventsBounds.endFill(),this.addChild(this._eventsBounds)},Object.defineProperty(b.prototype,"animation",{get:function(){return this._visual.animation},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"armature",{get:function(){return this._visual._armature},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"sprites",{get:function(){return this._visual.children},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"events",{get:function(){return this._eventsBounds?this._eventsBounds.events:null},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"input",{get:function(){return this._eventsBounds?this._eventsBounds.input:null},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"inputEnabled",{get:function(){return!!this._eventsBounds&&this._eventsBounds.inputEnabled},set:function(a){this._eventsBounds.inputEnabled=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"currentLabel",{get:function(){return this._currentLabel},enumerable:!0,configurable:!0}),b.prototype.update=function(){},b.prototype.postUpdate=function(){},b}(PIXI.DisplayObjectContainer);a.DBSprite=b}(TProject||(TProject={}));var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),TProject;!function(a){var b=function(a){function b(){return a.call(this)||this}return __extends(b,a),b.prototype.PushTransform=function(a){var b=this.m_ctx;b&&(b.save(),b.translate(a.p.x,a.p.y),b.rotate(a.q.GetAngle()))},b.prototype.PopTransform=function(a){var b=this.m_ctx;b&&b.restore()},b.prototype.DrawPolygon=function(a,b,c){var d=this.m_ctx;if(d){d.beginPath(),d.moveTo(a[0].x,a[0].y);for(var e=1;e<b;e++)d.lineTo(a[e].x,a[e].y);d.closePath(),d.strokeStyle=this.MakeStyleString(c,1),d.stroke()}},b.prototype.MakeStyleString=function(a,c){return void 0===c&&(c=1),b.MakeStyleString(a.r,a.g,a.b,c)},b.MakeStyleString=function(a,b,c,d){return void 0===d&&(d=1),a=Math.round(Math.max(0,Math.min(255,255*a))),b=Math.round(Math.max(0,Math.min(255,255*b))),c=Math.round(Math.max(0,Math.min(255,255*c))),d=Math.max(0,Math.min(1,d)),d<1?"rgba("+a+","+b+","+c+","+d+")":"rgb("+a+","+b+","+c+")"},b.prototype.DrawSolidPolygon=function(a,b,c){var d=this.m_ctx;if(d){d.beginPath(),d.moveTo(a[0].x,a[0].y);for(var e=1;e<b;e++)d.lineTo(a[e].x,a[e].y);d.closePath(),d.fillStyle=this.MakeStyleString(c,.5),d.fill(),d.strokeStyle=this.MakeStyleString(c,1),d.stroke()}},b.prototype.DrawCircle=function(a,b,c){var d=this.m_ctx;d&&(d.beginPath(),d.arc(a.x,a.y,b,0,2*box2d.b2_pi,!0),d.strokeStyle=this.MakeStyleString(c,1),d.stroke())},b.prototype.DrawSolidCircle=function(a,b,c,d){var e=this.m_ctx;if(e){var f=a.x,g=a.y;e.beginPath(),e.arc(f,g,b,0,2*box2d.b2_pi,!0),e.moveTo(f,g),e.lineTo(f+c.x*b,g+c.y*b),e.fillStyle=this.MakeStyleString(d,.5),e.fill(),e.strokeStyle=this.MakeStyleString(d,1),e.stroke()}},b.prototype.DrawParticles=function(a,b,c,d){var e=this.m_ctx;if(e)if(null!==c)for(var f=0;f<d;++f){var g=a[f],h=c[f];e.fillStyle=this.MakeStyleString(h),e.fillRect(g.x-b,g.y-b,2*b,2*b)}else{e.fillStyle="rgba(255,255,255,0.5)",e.beginPath();for(var f=0;f<d;++f){var g=a[f];e.rect(g.x-b,g.y-b,2*b,2*b)}e.fill()}},b.prototype.DrawSegment=function(a,b,c){var d=this.m_ctx;d&&(d.beginPath(),d.moveTo(a.x,a.y),d.lineTo(b.x,b.y),d.strokeStyle=this.MakeStyleString(c,1),d.stroke())},b.prototype.DrawTransform=function(a){var b=this.m_ctx;b&&(this.PushTransform(a),b.beginPath(),b.moveTo(0,0),b.lineTo(1,0),b.strokeStyle=this.MakeStyleString(box2d.b2Color.RED,1),b.stroke(),b.beginPath(),b.moveTo(0,0),b.lineTo(0,1),b.strokeStyle=this.MakeStyleString(box2d.b2Color.GREEN,1),b.stroke(),this.PopTransform(a))},b.prototype.DrawPoint=function(a,b,c){var d=this.m_ctx;if(d){d.fillStyle=this.MakeStyleString(c);var e=b/2;d.fillRect(a.x-e,a.y-e,b,b)}},b.prototype.DrawString=function(a,c,d){var e=this.m_ctx;if(e){e.save(),e.setTransform(1,0,0,1,0,0),e.font="15px DroidSans";var f=b.DrawString_s_color;e.fillStyle=this.MakeStyleString(f),e.fillText(d,a,c),e.restore()}},b.prototype.DrawStringWorld=function(a,c,d){var e=this.m_ctx;if(e){var f=b.DrawStringWorld_s_p.SetXY(a,c);e.save(),e.setTransform(1,0,0,1,0,0),e.font="15px DroidSans";var g=b.DrawStringWorld_s_color;e.fillStyle=this.MakeStyleString(g),e.fillText(d,f.x,f.y),e.restore()}},b.prototype.DrawAABB=function(a,b){var c=this.m_ctx;if(c){c.strokeStyle=this.MakeStyleString(b);var d=a.lowerBound.x,e=a.lowerBound.y,f=a.upperBound.x-a.lowerBound.x,g=a.upperBound.y-a.lowerBound.y;c.strokeRect(d,e,f,g)}},b}(box2d.b2Draw);b.DrawString_s_color=new box2d.b2Color(.9,.6,.6),b.DrawStringWorld_s_p=new box2d.b2Vec2,b.DrawStringWorld_s_cc=new box2d.b2Vec2,b.DrawStringWorld_s_color=new box2d.b2Color(.5,.9,.5),a.DebugDraw=b}(TProject||(TProject={}));var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),TProject;!function(a){var b=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.loadFactory=function(a,b,c,d,e){d=d?d:"_tex",e=e?e:"_ske",c+=b,a.load.json(b+"textureData",c+d+".json"),a.load.json(b+"dragonBonesData",c+e+".json"),a.load.image(b+"texture",c+d+".png")},b.createFactory=function(a,b){var c=new dragonBones.PhaserFactory(null,a);return c.parseDragonBonesData(a.cache.getJSON(b+"dragonBonesData")),c.parseTextureAtlasData(a.cache.getJSON(b+"textureData"),a.cache.getBaseTexture(b+"texture")),c},b}(Phaser.State);a.Factories=b}(TProject||(TProject={}));var TProject;!function(a){var b;!function(a){a[a.LIGHT=0]="LIGHT",a[a.MEDIUM=1]="MEDIUM",a[a.HARD=2]="HARD"}(b=a.FontType||(a.FontType={}));var c=function(){function a(a,b){this._xml=b,this._curLocale=a}return a.prototype.get=function(a){return this._xml.getElementById(a).innerHTML},a.prototype.pickUpFont=function(a){if(void 0===a&&(a=b.MEDIUM),"ar"==this._curLocale)return"Lubalin_Ara";if("ru"==this._curLocale)return a==b.LIGHT?"Fred Fredburger W04 Regular":"Fred Fredburger W04 Bold";switch(a){case b.LIGHT:return"Lubalin_CnObl";case b.MEDIUM:return"Lubalin_Book";default:return"Lubalin_D14"}},Object.defineProperty(a.prototype,"currentLocale",{get:function(){return this._curLocale},enumerable:!0,configurable:!0}),a}();a.LanguageManager=c}(TProject||(TProject={}));var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),TProject;!function(a){var b=function(a){function b(b,c,d,e){void 0===e&&(e=null);var f=this,g=null,h=null,i=null;return d.length>0&&(g=d[0],d.length>1?(h=d[1],i=d.length>2?d[2]:d[0]):(h=d[0],i=d[0])),f=a.call(this,b,0,0,c,null,null,h,g,i,null)||this,f._framesString=[g,h,i],f.soundOver="over",f.soundDown="click",f.anchor.setTo(.5),f._cb=e,f._deltaScale=.1,f._defaultScale=1,f._isDown=!1,f._isOver=!1,f.onInputOver.add(f.over,f),f.onInputOut.add(f.out,f),f.onInputDown.add(f.down,f),f.onInputUp.add(f.up,f),f}return __extends(b,a),b.prototype.setCBContext=function(a){this._cntxt=a},b.prototype.setAnimationScale=function(a,b){void 0===a&&(a=0),void 0===b&&(b=1),this._deltaScale=a,this._defaultScale=b},b.prototype.setNewFrames=function(a){var b=null,c=null,d=null;a.length>0&&(b=a[0],a.length>1?(c=a[1],d=a.length>2?a[2]:a[0]):(c=a[0],d=a[0])),this._framesString=[b,c,d],this.setFrames(c,b,d)},b.prototype.over=function(){!this._isDown,this._isOver=!0},b.prototype.out=function(){this._isDown||this.scale.set(this._defaultScale),this._isOver=!1},b.prototype.up=function(){var a=this;if(this._isDown){this.scale.set(this._defaultScale);var b=this.game.device.desktop?this._isOver:this.input.pointerOver();this._isOver?this.frameName=this._framesString[1]:b&&setTimeout(function(){a.frameName=a._framesString[0]},5),this._isDown=!1,b&&null!=this._cb?(this._cntxt?this._cb.bind(this._cntxt)():this._cb(),this.frameName=this._framesString[0]):0==b&&this.scale.set(this._defaultScale)}},b.prototype.down=function(){this._isDown||(this.scale.set(this._defaultScale-this._deltaScale),this._isDown=!0)},b.prototype.deleteFromParent=function(){this.parent&&this.parent.removeChild(this),this.onInputOver.remove(this.over,this),this.onInputOut.remove(this.out,this),this.onInputDown.remove(this.down,this),this.onInputUp.remove(this.up,this)},Object.defineProperty(b.prototype,"enabled",{set:function(a){var b=this;this.inputEnabled=a,a||setTimeout(function(){b.frameName=b._framesString[0],b.scale.set(b._defaultScale)},5)},enumerable:!0,configurable:!0}),b}(Phaser.Button);a.OButton=b}(TProject||(TProject={}));var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),TProject;!function(a){var b=function(){function a(a,b,c,d){this.up=a,this.over=null==b?a:b,this.out=null==c?a:c,this.down=null==d?a:d,this.scaleDefault=1,this.scaleDown=1,this.scaleOver=1}return a.prototype.setScale=function(a,b,c){this.scaleDefault=a?a:1,this.scaleDown=b?b:1,this.scaleOver=c?c:1},a}(),c=function(c){function d(a,d,e,f,g,h){var i=c.call(this,a,0,0)||this;return i.soundDown="button_click",i._activeEndAnimation=!0,i._visual=d,i._btnOverlay=new Phaser.Graphics(i.game,-e/2,-e/2),i._btnOverlay.beginFill(0,0),i._btnOverlay.drawRect(0,0,e,e),i._btnOverlay.endFill(),i.addChild(i._btnOverlay),i._cb=g,i._cntxt=h,i._states=new b(f[0],f[1],f[2],f[3]),i._visual.play(i._states.up),i.inputEnabled=!1,i._isDown=!1,i._isOver=!1,i.enabled=!0,i}return __extends(d,c),d.prototype.setScaleForAnimation=function(a,b,c){this._states.setScale(c,a,b)},d.prototype.over=function(){this._visual.play(this._states.over),this._isOver=!0,a.SoundMixer.play("button_over",.2),this._visual.scale.set(this._states.scaleOver,this._states.scaleOver)},d.prototype.out=function(){this._isOver&&(this._isOver=!1,this._isDown||(this._visual.play(this._states.out),this._visual.scale.set(this._states.scaleDefault,this._states.scaleDefault)))},d.prototype.down=function(){this._isDown||(a.SoundMixer.play(this.soundDown),this._visual.play(this._states.down),this._isDown=!0,this._visual.scale.set(this._states.scaleDown,this._states.scaleDown))},d.prototype.up=function(){if(this._isDown){this._isDown=!1;var a=this.game.device.desktop?this._isOver:this.input.pointerOver();a&&null!=this._cb&&(this._cntxt?this._cb.bind(this._cntxt)():this._cb()),this._isOver?(this._visual.play(this._states.over),this._visual.scale.set(this._states.scaleOver,this._states.scaleOver)):(this._visual.play(this._states.up),this._visual.scale.set(this._states.scaleDefault,this._states.scaleDefault))}},Object.defineProperty(d.prototype,"activeEndAnimation",{set:function(a){this._activeEndAnimation=a},enumerable:!0,configurable:!0}),d.prototype.setPos=function(a,b){this.x=a?a:this.x,this.y=b?b:this.y},Object.defineProperty(d.prototype,"enabled",{get:function(){return this.inputEnabled},set:function(a){var b=this;a&&this.enabled||(this.inputEnabled=a,a?(this.game.device.desktop&&(this.events.onInputOver.add(this.over,this),this.events.onInputOut.add(this.out,this),this.game.input.mouse.mouseOutCallback=function(){b.out()}),this.events.onInputDown.add(this.down,this),this.events.onInputUp.add(this.up,this),this._visual.scale.set(this._states.scaleDefault,this._states.scaleDefault),this._visual.play(this._states.up)):(setTimeout(function(){b._activeEndAnimation&&b._visual.play(b._states.up)},10),this.events.onInputOver.removeAll(this),this.events.onInputOut.removeAll(this),this.events.onInputDown.removeAll(this),this.events.onInputUp.removeAll(this),this.game.input.mouse.mouseOutCallback=null))},enumerable:!0,configurable:!0}),d}(Phaser.Sprite);a.OverlayButton=c}(TProject||(TProject={}));var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),TProject;!function(a){var b=function(){function a(a,b,c,d){this.up=a,this.over=null==b?a:b,this.out=null==c?a:c,this.down=null==d?a:d,this.scaleDefault=1,this.scaleDown=1,this.scaleOver=1}return a.prototype.setScale=function(a,b,c){this.scaleDefault=a?a:1,this.scaleDown=b?b:1,this.scaleOver=c?c:1},a}(),c=function(c){function d(a,d,e,f,g,h){var i=c.call(this,a,0,0)||this;return i.soundDown="button_click",i._activeEndAnimation=!0,i._visual=d,i._btnOverlay=new Phaser.Graphics(i.game,-e/2,-e/2),i._btnOverlay.beginFill(0,0),i._btnOverlay.drawRect(0,0,e,e),i._btnOverlay.endFill(),i.addChild(i._btnOverlay),i._cb=g,i._cntxt=h,i._states=new b(f[0],f[1],f[2],f[3]),i._visual.play(i._states.up),i.inputEnabled=!1,i._isDown=!1,i._isOver=!1,i.enabled=!1,i}return __extends(d,c),d.prototype.setScaleForAnimation=function(a,b,c){this._states.setScale(c,a,b)},d.prototype.update=function(){this.checkMouse()},d.prototype.checkMouse=function(){if(this._btnOverlay.getBounds().contains(this.game.input.x,this.game.input.y)){if(!this.enabled)return;this._isOver||(this._isOver=!0,this._visual.play(this._states.over),a.SoundMixer.play("button_over",.2),this._visual.scale.set(this._states.scaleOver,this._states.scaleOver))}else{if(!this.enabled)return;if(this._isOver){if(!this._isOver)return;if(this._isOver=!1,this._isDown)return;this._visual.play(this._states.out),this._visual.scale.set(this._states.scaleDefault,this._states.scaleDefault)}}},d.prototype.onUp=function(){if(this.inputEnabled&&(this.checkMouse(),this._isOver)){if(!this._isDown)return;this._isDown=!1;var a=this._isOver;a&&null!=this._cb&&(this._cntxt?this._cb.bind(this._cntxt)():this._cb()),this._isOver?(this._visual.play(this._states.over),this._visual.scale.set(this._states.scaleOver,this._states.scaleOver)):(this._visual.play(this._states.up),this._visual.scale.set(this._states.scaleDefault,this._states.scaleDefault))}},d.prototype.onDown=function(){this.inputEnabled&&(this.checkMouse(),this._isOver&&(a.SoundMixer.play(this.soundDown),this._visual.play(this._states.down),this._isDown=!0,this._visual.scale.set(this._states.scaleDown,this._states.scaleDown)))},Object.defineProperty(d.prototype,"activeEndAnimation",{set:function(a){this._activeEndAnimation=a},enumerable:!0,configurable:!0}),d.prototype.setPos=function(a,b){this.x=a?a:this.x,this.y=b?b:this.y},Object.defineProperty(d.prototype,"enabled",{get:function(){return this.inputEnabled},set:function(a){a&&this.inputEnabled||(this.inputEnabled=a,a?(this._isDown=!1,this._isOver=!1,this.game.input.onDown.add(this.onDown,this),this.game.input.onUp.add(this.onUp,this),this._visual.scale.set(this._states.scaleDefault,this._states.scaleDefault),this._visual.play(this._states.up)):(this.game.input.onDown.remove(this.onDown,this),this.game.input.onUp.remove(this.onUp,this)))},enumerable:!0,configurable:!0}),d}(Phaser.Sprite);a.OverlayButtonForPause=c}(TProject||(TProject={}));var Utils;!function(a){function b(a){return a[Math.floor(Math.random()*a.length)]}function c(a,b){return a+Math.floor(Math.random()*(b-a))}function d(a,b){return b.length>0&&a>=0&&a<b.length}function e(a,b){return f(a,b,Math.random())}function f(a,b,c){return a+(b-a)*c}function g(a){return c(a[0],a[1])}function h(a){return e(a[0],a[1])}function i(a,b,c){return a+(b-a)*c*c}function j(b,c,d){return new box2d.b2Vec2(a.lerp(b.x,c.x,d),a.lerp(b.y,c.y,d))}a.randomFromArray=b,a.randomRangeI=c,a.isInArrayRange=d,a.randomRangeF=e,a.lerp=f,a.randomRangeArray2I=g,a.randomRangeArray2F=h,a.easeInQuad=i,a.lerpV2=j}(Utils||(Utils={}));var TProject;!function(a){var b=function(){function a(){}return a}();b.CURRENT_STATE="BaseGame",a.LocalConfig=b}(TProject||(TProject={}));var TProject;!function(a){var b=function(){function b(){this.game=new Phaser.Game(640,480,Phaser.AUTO,"game_container",null,!1),this.game.state.add("PreBoot",a.PreBoot,!0),this.game.state.add("Boot",a.Boot),this.game.state.add("Preloader",a.Preloader),this.game.state.add("BaseGame",a.BaseGame),this.game.state.add("NewPhTest",a.NewPhTest)}return b.gotoFunction=function(a){var b=window[a];"function"==typeof b&&b()},b}();a.Main=b}(TProject||(TProject={})),window.onload=function(){new TProject.Main;setTimeout("window.scrollTo(0, 1)",10),document.body.addEventListener("touchmove",function(a){a.preventDefault()},!1)};var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),TProject;!function(a){function b(a,b){return void 0===b&&(b=1),new box2d.b2Vec2(a[0]*b,a[1]*b)}var c,d=GamesConfig.Mountain,e=GamesConfig.Players,f=GamesConfig.Camera,g=GamesConfig.Game,h=GamesConfig.Medals,i=GamesConfig.Skills,j=GamesConfig.Foreground,k=function(){function a(){}return a}();!function(a){a[a.STATE_MENU=0]="STATE_MENU",a[a.STATE_MENU_OUT=1]="STATE_MENU_OUT",a[a.STATE_PRE_LAUNCH=2]="STATE_PRE_LAUNCH",a[a.STATE_AVALANCHE=3]="STATE_AVALANCHE",a[a.STATE_GAME_OVER=4]="STATE_GAME_OVER",a[a.STATE_PAUSE=5]="STATE_PAUSE",a[a.STATE_RESET=6]="STATE_RESET"}(c=a.GameStates||(a.GameStates={}));var l;!function(a){a[a.SKILL_CHAR_SPLIT=0]="SKILL_CHAR_SPLIT",a[a.SKILL_CHAR_LEVITATE=1]="SKILL_CHAR_LEVITATE",a[a.SKILL_CHAR_GROW=2]="SKILL_CHAR_GROW",a[a.SKILL_CHAR_BOUNCE=3]="SKILL_CHAR_BOUNCE",a[a.SKILL_CHAR_BREAK_ROCKS=4]="SKILL_CHAR_BREAK_ROCKS",a[a.SKILL_GLOBAL_FROZE_ROCKS=5]="SKILL_GLOBAL_FROZE_ROCKS",a[a.SKILL_GLOBAL_REMOVE_ROCKS=6]="SKILL_GLOBAL_REMOVE_ROCKS",a[a.SKILL_GLOBAL_SOUND_BURST=7]="SKILL_GLOBAL_SOUND_BURST",a[a.SKILL_MASK_ALL=8]="SKILL_MASK_ALL"}(l||(l={}));var m;!function(a){a[a.ROCK=1]="ROCK",a[a.MOUNTAIN=2]="MOUNTAIN",a[a.DECORATION=4]="DECORATION",a[a.PLAYER=8]="PLAYER"}(m=a.EntityCategory||(a.EntityCategory={}));var n=function(l){function n(){var a=null!==l&&l.apply(this,arguments)||this;return a.helper_aabb=new box2d.b2AABB,a}return __extends(n,l),n.prototype.create=function(){var h=this;l.prototype.create.call(this),a.SoundMixer.play("bgm_menu",.2,!0),this._cameraMoveComplete=!0,this._players=[],this._mountainsAndBodies=[],this._playersData=[],this._cloudsBG=[],this._rocksAndBodies=[],this._newCharsArr=[0,0],this._newCharsOffset=[new box2d.b2Vec2,new box2d.b2Vec2],n.FX_ANIMATIONS=[],this._breakingSnowballsRocks=[],this._gravity=b(g.gravity),this.game.physics.startSystem(Phaser.Physics.BOX2D),this.game.physics.box2d.gravity.x=0,this.game.physics.box2d.gravity.y=300,this._world=this.game.physics.box2d,this._world.frameRate=1/30,this._world.velocityIterations=10,this._world.positionIterations=10,this._world.ptmRatio=30,this._unlockedCharacters=a.Boot.GAME_DATA.unlockedCharacters,this._wipeDistance=g.wipeDistance*g.worldScaleInverse,this._characterClickRadiusSq=g.characterClickRadius*g.characterClickRadius,this._mountainFixtDef=new box2d.b2FixtureDef,f.target=b(f.target),f.target.x*=g.WIDTH,f.target.y*=g.HEIGHT,this.game.debug.box2dWorld(),this._debugDraw=this.game.physics.box2d.debugDraw,this._skyBG=[],d.treeMoveToBodyFactor[(d.treeMoveToBodyFactor[0],.5*g.worldScaleInverse)],this.setupFixtures(d.rocks,m.ROCK,m.MOUNTAIN|m.PLAYER|m.ROCK);for(var p=0;p<d.rocks.length;++p)d.snowballs[p]=[d.rocks[p][0],d.rocks[p][1],d.snowballs[p][0],d.snowballs[p][1],d.snowballs[p][2],d.snowballs[p][3]];this.setupFixtures(d.snowballs,m.ROCK,m.MOUNTAIN|m.PLAYER|m.ROCK),e.bodies=[];var q=[],r=2;e.characters.sort(function(a,b){return a[1]<b[1]?-1:a[1]>b[1]?1:0}),this._decorationFixtureDef=new box2d.b2FixtureDef,this._decorationFixtureDef.friction=this.game.physics.box2d.friction,this._decorationFixtureDef.restitution=this.game.physics.box2d.restitution,this._decorationFixtureDef.density=this.game.physics.box2d.density,this._decorationFixtureDef.filter.maskBits=m.PLAYER|m.ROCK,this._decorationFixtureDef.filter.categoryBits=m.DECORATION;for(var s=0;s<e.characters.length;++s){for(var t=[],u=r;u<r+6;++u)t.push(e.characters[s][u]);e.bodies.push(t);var v=1<<s;q.push([v,e.characters[s][0],e.characters[s][1]])}e.characters=q,e.bodies.push(e.groupBody),this._launchSpeedMin=b(e.launchSpeedMin),this._launchSpeedMax=b(e.launchSpeedMax),this._mountainFixtDef.density=d.density,this._mountainFixtDef.friction=d.friction,this._mountainFixtDef.restitution=d.restitution,this._mountainFixtDef.shape=new box2d.b2PolygonShape,this._mountainFixtDef.filter.maskBits=m.PLAYER|m.ROCK,this._mountainFixtDef.filter.categoryBits=m.MOUNTAIN,this._skyContainer=this.game.make.sprite(0,0),this._cloudsContainer=this.game.make.sprite(0,0),this._gameContainer=this.game.make.sprite(0,0),this._fgContainer=this.game.make.sprite(j.startPos.x,j.startPos.y),this._fgCheckArray=[],this.game.world.addChild(this._skyContainer),this.game.world.addChild(this._cloudsContainer),this.game.world.addChild(this._gameContainer),this.game.world.addChild(this._fgContainer),this._startMC=new a.DBSprite(a.Boot.GAMEPLAY_DB,"_DB_FOR_GAMEPLAY/start"),this._startMC.x=49,this._startMC.y=-10,this._startMC.play("idle");var w=new Phaser.Graphics(this.game,0,0);w.beginFill(16777215,1),w.drawRect(0,0,this._startMC.width/1.7,600),w.endFill(),w.y=this._startMC.height-90,this._startMC.getBone("Layer 8").addChild(w),this._gameContainer.x=0,this._gameContainer.y=0,this._layerDecoration=this.game.make.sprite(0,0),this._layerTerrace=this.game.make.sprite(0,0),this._layerMountain=this.game.make.sprite(0,0),this._layerRocks=this.game.make.sprite(0,0),this._layerPlayer=this.game.make.sprite(0,0),this._layerFXs=this.game.make.sprite(0,0),this._gameContainer.addChild(this._layerMountain),this._gameContainer.addChild(this._layerTerrace),this._gameContainer.addChild(this._layerDecoration),this._gameContainer.addChild(this._layerRocks),this._gameContainer.addChild(this._startMC),this._gameContainer.addChild(this._layerPlayer),this._gameContainer.addChild(this._layerFXs),
this._decorationsBox=new a.MysteryBox(["gunter_1","gunter_2","snownman_1"],d.terraceDecorationChances),this._bkgBox=new a.MysteryBox(["bg_mountain_1","bg_mountain_2","bg_iceclops","golem"],d.bgsChances);for(var s=0;s<2;s++){var x=this.game.make.sprite(0,0,"bg");this._skyContainer.addChild(x);var y=new k;y.mc=x,y.x=0,this._skyBG.push(y)}this._lockedCharacters=[];for(var s=0;s<16;++s){var x=void 0;x=s%2==1?this.game.make.sprite(0,0,"ImagesGamePlay","cloud_10000"):this.game.make.sprite(0,0,"ImagesGamePlay","cloud_20000"),this._cloudsContainer.addChild(x);var z=new o;z.mc=x,this._cloudsBG.push(z)}this.loadFXAnimations(),this._splitBonusSpeed=[],this._splitSoloOffsetRotation=box2d.b2Mat22.FromAngleRadians(-i.splitSoloOffsetRotation*Math.PI/180),this._splitBonusSpeed[0]=b(i.splitBonusSpeed[0]),this._splitBonusSpeed[1]=b(i.splitBonusSpeed[1]),this._levitateStrength=b(i.levitateStrength),this._growDefinition=this.fixtureFromConfig(i.growDefinition,m.DECORATION,m.ROCK),this._growTweenConfig={scaleX:1,scaleY:1,time:i.growTweenConfig[0],transition:i.growTweenConfig[1]},this._shrinkTweenConfig={scaleX:1,scaleY:1,time:this._growTweenConfig.time,transition:i.growTweenConfig[1]},this._decorationAndBodies=[],this._gameUI=new a.GameUI(this.game,this),this.myinit(),this.game.input.enabled=!0,this.game.input.onDown.add(function(a){if(h._state==c.STATE_AVALANCHE){var b=a.positionDown.x,d=a.positionDown.y,e=b-h._gameContainer.x,f=d-h._gameContainer.y;h._players.forEach(function(a){return a.hit(e,f)})}},this),this.game.input.onTap.add(function(a){}),this._state=c.STATE_PRE_LAUNCH,this.game.world.addChild(this._gameUI),this._timeToBubbleUpdate=.25},Object.defineProperty(n.prototype,"cameraTarget",{set:function(a){this._cameraTargetBody=a},enumerable:!0,configurable:!0}),n.prototype.getPlayerByName=function(a){var b=-1;if("player"==a)return this._players[0].body;for(var c=0;c<this._players.length;c++)if(this._players[c].name==a){b=c;break}if(b<0)throw"Player not found "+a;return this._players[b].body},n.prototype.setPowerToLaunch=function(a){var b=this;10==+a&&this.awardMedal("max_power"),this._currentLaunchPower=+a<1?.1:+a/10,this._startMC.play("shoot","launch",function(a){"shoot"==a.label&&(b._click=!0)},this)},n.prototype.pauseUpdate=function(){this._gameUI.pauseUpdate()},n.prototype.activateBoostFromUI=function(a){var b=this;this._players.forEach(function(c){c.name.toLowerCase()==a&&(c.useSkill(!1),b._amountOfActiveSkills++)})},n.prototype.addPlayerFromUI=function(a){if("jake"!=a){var b=this._players.filter(function(a){return"jake"==a.name})[0];b&&b.useSkill(!1)}},n.prototype.disablePlayerIcon=function(a){"jake"==a&&this._nextSpawn>0&&(a="player"),this._gameUI.feedBackRecipient(a,"Deactivate")},n.prototype.enablePlayerIcon=function(a){"jake"==a&&this._nextSpawn>0&&(a="player"),this._gameUI.feedBackRecipient(a,"Reactivate")},n.prototype.activateIngameAbilityAndCameraMoveFromUI=function(a){"jake"==a&&this._nextSpawn>0&&(a="player"),this._gameUI.feedBackRecipient(a,"ActivateIngameAbilityAndCameraMove")},n.prototype.addPlayerFromGame=function(){this._gameUI.feedBackRecipient("","AddNewPlayerInScreen")},n.prototype.activateBoostFromGame=function(a){this._gameUI.feedBackRecipient(a,"AbilityActivate"),this._amountOfActiveSkills++},n.prototype.decActiveSkills=function(){this._amountOfActiveSkills--},n.prototype.loadFXAnimations=function(){var b=this.game.make.sprite(0,0,"ImagesGamePlay","fx_hit_10000");b.anchor.set(.5,.5),this._layerFXs.addChild(b),b.animations.add("play",Phaser.Animation.generateFrameNames("fx_hit_",1e4,10007),24),n.FX_ANIMATIONS.fx_hit_1=b;var c=this.game.make.sprite(0,0,"ImagesGamePlay","fx_bounce_10000");c.anchor.set(.5,1),c.animations.add("play",Phaser.Animation.generateFrameNames("fx_bounce_",1e4,10017),24),n.FX_ANIMATIONS.bounce_fx_1=c,this._layerFXs.addChild(c);var d=this.game.make.sprite(0,0,"ImagesGamePlay","fx_bounce_20000");d.anchor.set(.5,1),d.animations.add("play",Phaser.Animation.generateFrameNames("fx_bounce_",2e4,20008),24),n.FX_ANIMATIONS.bounce_fx_2=d,this._layerFXs.addChild(d);var e=this.game.make.sprite(0,0,"ImagesGamePlay","fx_bounce_30000");e.anchor.set(.5,1),e.animations.add("play",Phaser.Animation.generateFrameNames("fx_bounce_",3e4,30009),24),n.FX_ANIMATIONS.bounce_fx_3=e,this._layerFXs.addChild(e),this._bounceFXs=new a.FXPool,this._bounceFXs.fill(["bounce_fx_1","bounce_fx_2","bounce_fx_3"],10),this._hitFX=new a.FXPool,this._hitFX.fill(["fx_hit_1"],10)},n.prototype.checkHitOnPlayer=function(a,b){a-this._gameContainer.x-this._layerPlayer.y,b-this._gameContainer.y-this._layerPlayer.y;this._players.forEach(function(c){return c.hit(a,b)})},n.prototype.awardMedal=function(a){this._achivementsWasUsed[a]||(this._gameUI.feedBackRecipient(a,"AddAchievement"),this._achivementsWasUsed[a]=!0)},Object.defineProperty(n.prototype,"characterIdFinn",{get:function(){return this._characterIdFinn},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"characterIdJake",{get:function(){return this._characterIdJake},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bounceFXs",{get:function(){return this._bounceFXs},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"gameContainerPos",{get:function(){return new Phaser.Point(this._gameContainer.x,this._gameContainer.y)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"swordAttacks",{get:function(){return this._swordAttacks},set:function(a){this._swordAttacks=a},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"currentUnlockedCounter",{get:function(){return this._currentUnlockedCounter},enumerable:!0,configurable:!0}),n.prototype.getLockedCharacters=function(){return this._lockedCharacters},n.prototype.soundBurst=function(b,c){var d=this;this._rocksAndBodies.forEach(function(e,f){var g=e.sprite.x-b,h=e.sprite.y-c,j=g*g+h*h;if(j<62500)if(e.typeIndex==a.BodyInfo.TYPE_SNOWBALL)e.sprite.children.length>0&&e.sprite.animations.play("explode").onComplete.addOnce(function(){e.sprite.destroy(!0),d._rocksAndBodies.splice(f,1)},d),e.body.destroy();else{var k=Math.sqrt(j),l=(i.soundBurstRadius-k)/i.soundBurstRadius,m=new box2d.b2Vec2(g,h);m.SelfMul(-Utils.lerp(0,i.soundBurstStrength,l)/k/7),e.body.data.ApplyForce(m,e.body.data.GetWorldCenter())}});for(var e=0,f=0;f<this._players.length;f++){var g=this._players[f];if("marceline"!=g.name){var j=g.x-b,k=g.y-c,l=j*j+k*k;if(l<62500){var m=new box2d.b2Vec2(j,k),n=Math.sqrt(l),o=(i.soundBurstRadius-n)/i.soundBurstRadius;m.SelfMul(-Utils.lerp(0,i.soundBurstStrength,o)/n/7),g.body.data.ApplyForce(m,g.body.data.GetWorldCenter()),e++}}}e>=h.soundOfMusicValue&&this.awardMedal("sound_of_music")},n.prototype.spawnNextPlayer=function(){var b,c=this._players.filter(function(a){return"jake"==a.name})[0],d=c.body.data.GetLinearVelocity().Clone(),e=c.x+c.width+35,f=c.y-35;this._currentUnlockedCounter++;var g=6;switch(this._nextSpawn){case 1:var h=new a.Finn(this.game,e,f);h.launch=!0,b=h.body,h.hitFXs=this._hitFX,h.bounceFXs=this._bounceFXs,h.baseGame=this,c.sprite.getBoneArmature("characters").getBone("finn").visible=!1,this._layerPlayer.addChild(h),this._players.push(h),this._nextSpawn--;break;case 2:var i=new a.Bmo(this.game,e,f);i.launch=!0,b=i.body,i.hitFXs=this._hitFX,i.bounceFXs=this._bounceFXs,i.baseGame=this,c.sprite.getBoneArmature("characters").getBone("bmo").visible=!1,this._layerPlayer.addChild(i),this._players.push(i),this._nextSpawn--;break;case 3:var j=new a.Bubblegum(this.game,e,f);j.baseGame=this,j.launch=!0,b=j.body,j.hitFXs=this._hitFX,j.bounceFXs=this._bounceFXs,c.sprite.getBoneArmature("characters").getBone("bubblegum").visible=!1,this._layerPlayer.addChild(j),this._players.push(j),this._nextSpawn--;break;case 4:var k=new a.Iceking(this.game,e,f);k.baseGame=this,k.launch=!0,b=k.body,k.hitFXs=this._hitFX,k.bounceFXs=this._bounceFXs,c.sprite.getBoneArmature("characters").getBone("ik").visible=!1,this._layerPlayer.addChild(k),this._players.push(k),this._nextSpawn--;break;case 5:var l=new a.Lumpy(this.game,e,f);l.baseGame=this,l.launch=!0,b=l.body,l.hitFXs=this._hitFX,l.bounceFXs=this._bounceFXs,c.sprite.getBoneArmature("characters").getBone("lsp").visible=!1,this._layerPlayer.addChild(l),this._players.push(l),this._nextSpawn--;break;case 6:var m=new a.Marceline(this.game,e,f);m.baseGame=this,m.launch=!0,b=m.body,m.hitFXs=this._hitFX,m.bounceFXs=this._bounceFXs,c.sprite.getBoneArmature("characters").getBone("marceline").visible=!1,this._layerPlayer.addChild(m),this._players.push(m),this._nextSpawn--}b&&(d.SelfMul(-30),d.x+=180,d.y-=120,b.applyForce(d.x,d.y),b.angularVelocity=g)},n.prototype.destroyRock=function(a){var b=this._rocksAndBodies.indexOf(a);b>0&&this._rocksAndBodies.splice(b,1)},n.prototype.destroyRocks=function(){for(var b=this,c=0,d=function(){var d=e._rocksAndBodies[c];if(d.bodyType==a.BodyInfo.TYPE_ROCK){try{d.sprite.animations.play("explode").onComplete.addOnce(function(){b._layerRocks.removeChild(d.sprite),d.sprite.destroy(!0)},e)}catch(a){d.sprite.destroy(!0)}try{d.body.destroy()}catch(a){}e._rocksAndBodies.splice(c,1)}else c++},e=this;c<this._rocksAndBodies.length;)d()},n.prototype.initPlayerBuble=function(){var b=new a.Jake(this.game,60,-10);b.hitFXs=this._hitFX,b.bounceFXs=this._bounceFXs,b.baseGame=this,b.canspleet=!1,this._layerPlayer.addChild(b),this._players.push(b)},n.prototype.restart=function(){for(this._players.forEach(function(a){a.parent&&a.free()}),this._players.length=0,this._mountainsAndBodies.forEach(function(a){a.body.destroy(),a.sprite.parent&&a.sprite.parent.removeChild(a.sprite),a.sprite.destroy()}),this._mountainsAndBodies.length=0,this._rocksAndBodies.forEach(function(a){a.body.destroy(),void 0==a.sprite.parent||a.sprite.parent.removeChild(a.sprite),a.sprite.destroy(!0)}),this._rocksAndBodies.length=0;this._layerMountain.children.length>0;)this._layerMountain.removeChild(this._layerMountain.children[0]);for(;this._fgCheckArray.length;)this._fgCheckArray.pop();for(;this._fgContainer.children.length>0;)this._fgContainer.removeChild(this._fgContainer.children[0]);for(this._decorationAndBodies.forEach(function(a){a.body&&a.body.destroy(),void 0!==a.sprite.parent&&a.sprite.parent.removeChild(a.sprite),a.sprite.destroy(!0)}),this._decorationAndBodies.length=0;this._layerDecoration.children.length>0;)this._layerDecoration.removeChild(this._layerDecoration.children[0]);null==this._startMC&&(this._startMC=new a.DBSprite(a.Boot.GAMEPLAY_DB,"_DB_FOR_GAMEPLAY/start"),this._startMC.x=49,this._startMC.y=-10),this._startMC.play("idle");var b=new Phaser.Graphics(this.game,0,0);b.beginFill(16777215,1),b.drawRect(0,0,this._startMC.width/1.7,600),b.endFill(),b.y=this._startMC.height-90,this._startMC.getBone("Layer 8").addChild(b),this._gameContainer.addChildAt(this._startMC,0),this.myinit(),this._gameUI.gameIsRestart(),this._state=c.STATE_PRE_LAUNCH,a.SoundMixer.play("powermeter",.2,!0)},n.prototype.updateDecorationCollision=function(b){this._decorationCounters[b]++,this._decorationCounters[a.DecorationData.DD_TYPE_TREE]==h.decorationHitsValues[a.DecorationData.DD_TYPE_TREE]&&this.awardMedal("deforestation"),this._decorationCounters[a.DecorationData.DD_TYPE_SNOWMAN]==h.decorationHitsValues[a.DecorationData.DD_TYPE_SNOWMAN]&&this.awardMedal("snowman"),this._decorationCounters[a.DecorationData.DD_TYPE_GUNTER]==h.decorationHitsValues[a.DecorationData.DD_TYPE_GUNTER]&&this.awardMedal("gunter")},n.prototype.myinit=function(){this._achivementsWasUsed=new Object,this._achivementsWasUsed.max_power=!1,this._achivementsWasUsed.new_distance=!1,this._achivementsWasUsed.max_speed=!1,this._achivementsWasUsed.crowded=!1,this._achivementsWasUsed.winter_fugitive=!1,this._achivementsWasUsed.boosters=!1,this._achivementsWasUsed.sound_of_music=!1,this._achivementsWasUsed.sword=!1,this._achivementsWasUsed.best_buddies=!1,this._achivementsWasUsed.deforestation=!1,this._achivementsWasUsed.gunter=!1,this._achivementsWasUsed.snowman=!1,this._amountOfActiveSkills=0,this._gameOverTimer=g.gameOverTime,this._worldLimitLeft=-100500,this._skillTypeGlobalActive=0,this._skillTypeGlobalMustDisable=!1,this._worldLimitBottomPixel=0,this._currentDistance=0,this._distanceIndex=0,this._currentSegmentType=0,this._nextSegmentX=0,this._cameraChangeTime=0,this._nextSegmentY=0,this._arrayToSortMaxLen=0,this._decorationCounters=[0,0,0],this._decorationCounters[a.DecorationData.DD_TYPE_TREE]=0,this._decorationCounters[a.DecorationData.DD_TYPE_GUNTER]=0,this._decorationCounters[a.DecorationData.DD_TYPE_SNOWMAN]=0,this._fgNextSegmentX=0,this._fgNextSegmentY=50,this._currentLaunchPower=0,this._nextSpawn=-1;for(var b=this._unlockedCharacters;b>0;)this._nextSpawn++,b>>=1;1==this._unlockedCharacters&&(this._nextSpawn=-1),this._gameUI.feedBackRecipient(this._nextSpawn.toString(),"SetCharsNumber"),this._lockedCharacters.length=0,this._nextLockedCharacter=0,this._lastUnlockedCharacter=0,this._currentUnlockedCounter=0;for(var c=0;c<e.characters.length;++c)0==e.characters[c][2]?this._unlockedCharacters|=e.characters[c][0]:this.charContained(this._unlockedCharacters,e.characters[c][0])||this._lockedCharacters.push([e.characters[c][0],e.characters[c][1].replace("player","goal"),e.characters[c][2]]);this._cameraTargetPos=new box2d.b2Vec2,this.createNextChunk(!0),this.createNextChunk(!1),this.createNextChunk(!1),this.createNextFGChunk(),this.createNextFGChunk(),this.createNextFGChunk(),this.initPlayerBuble(),this._cameraTargetBody=this._players[0].body,this.updateCamera(0,1);for(var c=0;c<this._skyBG.length;++c)this._skyBG[c].x=this._skyBG[c].mc.width*c,this._skyBG[c].mc.x=this._skyBG[c].x;for(var c=0;c<this._cloudsBG.length;++c)c<this._cloudsBG.length/2?this.randomizeCloud(this._cloudsBG[c],-1*g.WIDTH):this.randomizeCloud(this._cloudsBG[c],0);this._startMC.play("idle")},n.prototype.randomizeCloud=function(a,b){var c=g.WIDTH+b;a.mc.x=Utils.randomRangeF(b,c);var d=a.mc.x/g.WIDTH;a.mc.y=Utils.randomRangeF(-1,1)*g.WIDTH,d>1?a.mc.y=Utils.randomRangeF(1,d)*f.cloudBaseY:d<0?a.mc.y=Utils.randomRangeF(g.HEIGHT*-2,g.HEIGHT*-1):a.mc.y=Utils.randomRangeF(0,f.cloudBaseY),a.mc.scale.x=a.mc.scale.y=Utils.randomRangeArray2F(f.cloudsScaleRange),a.speedX=-Utils.randomRangeArray2F(f.cloudsSpeed)},n.prototype.charContained=function(a,b){return 0!=(a&b)},n.prototype.createMountainSegment=function(a,b,c,d){var e=this.game.make.sprite(this._nextSegmentX-2,"terrace"==d?this._nextSegmentY:this._nextSegmentY-10,"ImagesGamePlay",d+"_"+Math.floor(2*a).toString()+"0000");0!=c&&(e.width=1.2*e.width,e.x-=10);var f=this.game.physics.box2d.pxm(e.width),g=this.game.physics.box2d.pxm(e.height);e.angle=c;var h=new box2d.b2PolygonShape,i=0,j=10;"terrace"==d&&(j=13);var k=c*Math.PI/180,l=this.game.physics.box2d;h.SetAsOrientedBox("terrace"==d?.4*f:.5*f,.5*g,new box2d.b2Vec2(l.pxm(-i),l.pxm(-j)),k);new box2d.b2FixtureDef;this._mountainFixtDef.shape=h;var m=l.createBody();if(m.setFixture(this._mountainFixtDef),m.static=!0,m.x=e.x+e.width*e.anchor.x+this._layerMountain.x,m.y=e.y+e.height*e.anchor.y+this._layerMountain.y,m.x+=Math.cos(k)*e.width/2-Math.sin(k)*e.height/2,m.y+=Math.sin(k)*e.width/2+Math.cos(k)*e.height/2,0==e.angle);else{var n=new Phaser.Graphics(this.game,0,0);n.beginFill(16777215,1),n.drawRect(0,0,250,600),n.endFill(),n.y=e.height-35,e.addChild(n)}var o=new Phaser.Graphics(this.game,0,0);return o.beginFill(16777215,1),o.drawRect(0,0,e.width,600),o.endFill(),o.y=e.height-5,e.addChild(o),"terrace"==d?this._layerTerrace.addChild(e):this._layerMountain.addChild(e),this._mountainsAndBodies.push({sprite:e,body:m,type:"terrace"==d?1:2}),e},n.prototype.getScale=function(a,b){b.ComputeAABB(this.helper_aabb,box2d.b2Transform.IDENTITY,1);var c=this.helper_aabb.GetExtents();c.SelfMul(2*g.worldScale);var d=new box2d.b2Vec2(c.x/(a.width/a.scale.x),c.y/(a.height/a.scale.y));return d},n.prototype.getScale2=function(a,b,c){c.ComputeAABB(this.helper_aabb,box2d.b2Transform.IDENTITY,1);var d=this.helper_aabb.GetExtents();d.SelfMul(2*g.worldScale);var e=new box2d.b2Vec2(d.x/a,d.y/b);return e},n.prototype.createNextChunk=function(b){for(var c=0;c<2;c++){if(this._currentDistance>=d.rocksByDistance[this._distanceIndex][0]&&this._distanceIndex+1<d.rocksByDistance.length&&++this._distanceIndex,this._currentSegmentType%2==0){var e=Utils.randomFromArray(d.terraceSizes),h=60,i=this.createMountainSegment(e/2,h/2,0,"terrace");if(!b){var j=this._decorationsBox.pickOne();if(Utils.isInArrayRange(this._nextLockedCharacter,this._lockedCharacters)&&this._lockedCharacters[this._nextLockedCharacter][2]<(this._nextSegmentX-f.target.x)*g.worldScaleInverse){var k=new a.DBSprite(a.Boot.GAMEPLAY_DB,"_DB_FOR_BG/"+this._lockedCharacters[this._nextLockedCharacter][1]);k.play("idle");var l=this._nextSegmentX+e/2;this._lockedCharacters[this._nextLockedCharacter][2]=l,k.x=l+20,k.y=this._nextSegmentY+10,this._layerDecoration.addChild(k),this._lockedCharacters[this._nextLockedCharacter].push(k),++this._nextLockedCharacter}else if(null!=j){var m=[],o=void 0;"gunter_1"==j?(o=a.DecorationData.DD_TYPE_GUNTER,m=n.GUNTER_A_SOUNDS):"gunter_2"==j?(o=a.DecorationData.DD_TYPE_GUNTER,m=n.GUNTER_B_SOUNDS):(m=n.SNOWMAN_SOUNDS,o=a.DecorationData.DD_TYPE_SNOWMAN);var p=this.game.add.sprite(0,0,"ImagesGamePlay",j+"0000");if("snownman_1"==j?(p.anchor.set(.62,.9),p.animations.add("idle",Phaser.Animation.generateFrameNames("snownman_",1e4,1e4),24,!1),a.Boot.OPTIMIZATION||p.animations.add("hit",Phaser.Animation.generateFrameNames("snownman_",1e4,10040),24,!1)):(p.anchor.set(.5,.7),"gunter_1"==j?(p.animations.add("idle",Phaser.Animation.generateFrameNames("gunter_",1e4,10051),24,!0),a.Boot.OPTIMIZATION||p.animations.add("hit",Phaser.Animation.generateFrameNames("gunter_",10052,10113),24,!1)):(p.animations.add("idle",Phaser.Animation.generateFrameNames("gunter_",2e4,20039),24,!0),a.Boot.OPTIMIZATION||p.animations.add("hit",Phaser.Animation.generateFrameNames("gunter_",20040,20093),24,!1))),p.animations.play("idle"),j.indexOf("gunter_1")>=0){var q=10,r=0;80!=e&&100!=e||(r=-5),this.createDecoration(p,o,m,this._nextSegmentX+.5*e+10+q,this._nextSegmentY+15+r)}else this.createDecoration(p,o,m,this._nextSegmentX+.5*e,this._nextSegmentY+10)}else{Math.random()<d.treeChancesTerrace&&this.createTree(this._nextSegmentX+e,this._nextSegmentY,1,0,e,Utils.randomRangeArray2I(d.treeCountTerrace));for(var s=this._nextSegmentX+e,t=i.y+8,u=Utils.randomRangeI(d.rocksByDistance[this._distanceIndex][1],d.rocksByDistance[this._distanceIndex][2]+1),v=Utils.randomRangeI(1,5),w=v,x=Utils.randomRangeI(1,v+1),y=d.rocks[u][1];x>0&&w>0;){s-=2*y;for(var z=0;z<w;++z){s-=2*y;var A=new box2d.b2BodyDef;A.type=box2d.b2BodyType.b2_dynamicBody,A.active=!0,A.position.SetXY(s,t),0==Utils.randomRangeI(0,2)?this.createRockSnowball(A,u,d.rocks,a.BodyInfo.TYPE_ROCK,n.ROCK_MC_NAMES):this.createRockSnowball(A,u,d.snowballs,a.BodyInfo.TYPE_SNOWBALL,n.SNOW_MC_NAMES)}--w,--x,s=this._nextSegmentX+e-y*(v-w),t-=2*y}}}this._nextSegmentX+=e,this._nextSegmentY+=h}else{this._nextSegmentX+=50,this._nextSegmentY+=20;var B=Utils.randomFromArray(d.slopeSizes),C=60,D=Utils.randomRangeArray2F(d.slopeAngle),i=this.createMountainSegment(B/2,C/2,D,"segment"),E=D*Math.PI/180,F=Math.cos(E),G=Math.sin(E),H=B*F,I=B*G;this._nextSegmentX+=H,this._nextSegmentY+=I-6,Math.random()<d.treeChancesSlope&&this.createTree(this._nextSegmentX,this._nextSegmentY,F,G,B,Utils.randomRangeArray2I(d.treeCountSlope))}++this._currentSegmentType}this._worldLimitBottomPixel=this._nextSegmentY+g.wipeHeight;var J=this._bkgBox.pickOne();if(null!=J)if(J.indexOf("mountain")>0){var K=this._nextSegmentX+Utils.randomRangeArray2I(d.bgsOffsetX)-20,L=this._nextSegmentY+Utils.randomRangeArray2I(d.bgsOffsetY)+50,M=this.game.make.sprite(K,L,"ImagesGamePlay",J+"0000");M.x+=M.width,M.anchor.set(1,1),this._layerMountain.addChildAt(M,this._layerMountain.children.length-1)}else if(a.Boot.OPTIMIZATION){var M=void 0;switch(J){case"golem":M=this.game.add.sprite(0,0,"ImagesGamePlay","snow_golem0000"),M.anchor.set(.5,.86);break;default:M=this.game.add.sprite(0,0,"ImagesGamePlay","iceclops0000"),M.anchor.set(.5,.8)}M.x=this._nextSegmentX+Utils.randomRangeArray2I(d.bgsOffsetX),M.y=this._nextSegmentY+Utils.randomRangeArray2I(d.bgsOffsetY),this._layerMountain.addChildAt(M,Math.max(0,this._layerMountain.children.length-1))}else{var M=void 0;switch(J){case"golem":M=new a.DBSprite(a.Boot.GAMEPLAY_DB,"_DB_FOR_BG/snow_golem"),M.play("idle");break;default:M=new a.DBSprite(a.Boot.GAMEPLAY_DB,"_DB_FOR_BG/iceclops"),M.play("idle")}M.x=this._nextSegmentX+Utils.randomRangeArray2I(d.bgsOffsetX),M.y=this._nextSegmentY+Utils.randomRangeArray2I(d.bgsOffsetY),this._layerMountain.addChildAt(M,this._layerMountain.children.length-1)}},n.prototype.createRockSnowball=function(a,b,c,e,f){var g=Utils.randomFromArray(f),h=this.game.add.sprite(0,0,"ImagesGamePlay","true_"+g+"0000");"rock_1"==g?h.animations.add("explode",Phaser.Animation.generateFrameNames("rock_",1e4,10010),24,!1):"rock_2"==g?h.animations.add("explode",Phaser.Animation.generateFrameNames("rock_",2e4,20013),24,!1):"rock_3"==g?h.animations.add("explode",Phaser.Animation.generateFrameNames("rock_",3e4,30011),24,!1):"snow_1"==g?h.animations.add("explode",Phaser.Animation.generateFrameNames("snow_",1e4,10011),24,!1):"snow_2"==g?h.animations.add("explode",Phaser.Animation.generateFrameNames("snow_",2e4,20013),24,!1):"snow_3"==g&&h.animations.add("explode",Phaser.Animation.generateFrameNames("snow_",3e4,30011),24,!1),h.anchor.set(.5,.5),h.position.set(a.position.x,a.position.y),this._layerRocks.addChild(h);var i=d.rocks[b][1];h.width=h.height=2*i;var j=c[b][6],k=this.game.physics.box2d.createBody();k.setFixture(j),k.x=h.x+this._layerRocks.x,k.y=h.y+this._layerRocks.y,k.dynamic=!0;var l={sprite:h,body:k,bodyType:e,typeIndex:b};k.data.SetUserData(l),this._rocksAndBodies.push(l)},n.prototype.createTree=function(b,c,d,e,f,g){for(var h=f*-.1,i=.8*f/g;g-- >0;){var j=Utils.randomRangeF(h-.8*i,h);h-=i;var k=Utils.randomFromArray(n.TREE_NAMES),l=this.game.add.sprite(0,0,"ImagesGamePlay",k+"0000");l.anchor.set(.5,.9),"tree_1"==k?l.animations.add("idle",Phaser.Animation.generateFrameNames("tree_",1e4,1e4),24,!1):"tree_2"==k?l.animations.add("idle",Phaser.Animation.generateFrameNames("tree_",2e4,2e4),24,!1):l.animations.add("idle",Phaser.Animation.generateFrameNames("tree_",3e4,3e4),24,!1),a.Boot.OPTIMIZATION||("tree_1"==k?l.animations.add("hit",Phaser.Animation.generateFrameNames("tree_",10001,10014),24,!1):"tree_2"==k?l.animations.add("hit",Phaser.Animation.generateFrameNames("tree_",20001,20018),24,!1):l.animations.add("hit",Phaser.Animation.generateFrameNames("tree_",30001,30018),24,!1)),l.animations.play("idle");var m=b+d*j,o=c+e*j+10;this.createDecoration(l,a.DecorationData.DD_TYPE_TREE,n.TREE_NAMES,m,o)}},n.prototype.createDecoration=function(b,c,d,e,f){b.x=e,b.y=f;var g=null;if(!a.Boot.OPTIMIZATION){var h=this._world.pxm(b.width),i=this._world.pxm(b.height);c==a.DecorationData.DD_TYPE_TREE&&(i=this._world.pxm(b.height-10));var j=new box2d.b2PolygonShape;j.SetAsOrientedBox(.5*h,.5*i,new box2d.b2Vec2(this._world.pxm(0),this._world.pxm(0)),0),this._decorationFixtureDef.shape=j,this._decorationFixtureDef.isSensor=!0,g=this._world.createBody(),g.setFixture(this._decorationFixtureDef),g.static=!0,g.x=b.x,g.y=b.y-b.height/2}var k={sprite:b,body:g,updateTime:0,hitPlayers:[],typeIndex:c,soundsArray:d};null!=g&&g.data.SetUserData(k),this._decorationAndBodies.push(k),this._layerDecoration.addChild(b)},n.prototype.getCharTypeIndex=function(a){var b;for(b=0;b<e.characters.length&&e.characters[b][0]!=a;++b);return b},n.prototype.charsCount=function(a){for(var b=0;a>0;)b+=1&a,a>>=1;return b},n.prototype.replaceRocks=function(){for(var b=0;b<this._rocksAndBodies.length;){var c=this._rocksAndBodies[b];if(c.bodyType==a.BodyInfo.TYPE_ROCK){var e=new box2d.b2BodyDef;e.position.SetXY(c.sprite.x,c.sprite.y),this._layerRocks.removeChild(c.sprite),c.sprite.destroy(!0),c.body.destroy(),this.createRockSnowball(e,c.typeIndex,d.snowballs,a.BodyInfo.TYPE_SNOWBALL,n.SNOW_MC_NAMES),this._rocksAndBodies.splice(b,1)}else b++}},n.prototype.destroyBody=function(b,c){switch(c.type){case a.BodyInfo.TYPE_ROCK:case a.BodyInfo.TYPE_SNOWBALL:c.mainMC.animations.play("explode"),this._breakingSnowballsRocks.push(c.mainMC),c.mainMC=null}null!=c.mainMC&&null!=c.mainMC.parent&&n.removeFromParent(c.mainMC),this._world.world.DestroyBody(b)},n.removeFromParent=function(a){a.parent.removeChild(a)},n.prototype.inScreen=function(a,b){return void 0===b&&(b=0),a+this._gameContainer.x+b>0&&a+this._gameContainer.x-b<g.WIDTH},n.prototype.update=function(){var b,d,i=this.game.time.elapsedMS/1e3,j=0,k=0,m=Number.MAX_VALUE,n=0,o=0,p=0;if(!this.isPaused){switch(this._gameUI.guiUpdate(i),this._state){case c.STATE_MENU:break;case c.STATE_MENU_OUT:break;case c.STATE_PRE_LAUNCH:this.preLaunch(i);break;case c.STATE_AVALANCHE:for(var q=this._cameraTargetBody,r="",s=0,t=this._currentDistance+g.WIDTH,u=0;u<this._players.length;u++){var v=this._players[u].body.data,w=this._players[u],x=v.GetLinearVelocity().Length();if(j=w.x,k=w.y,this._cameraChangeTime<=0&&null!=this._cameraTargetBody&&this._cameraTargetBody.data.GetLinearVelocity().Length()<f.trackSpeed&&(this._cameraTargetBody=null),x>s&&j<t&&(s=x),m>w.x&&(m=j),j>n&&(o=n,n=j),(null==b||b.x>w.x)&&(b=w,d=x),this._currentDistance<w.x&&(this._currentDistance=w.x),Utils.isInArrayRange(this._lastUnlockedCharacter,this._lockedCharacters)&&this._lockedCharacters[this._lastUnlockedCharacter][2]<w.x){var y=this._lockedCharacters[this._lastUnlockedCharacter];++this._lastUnlockedCharacter,this._unlockedCharacters|=y[0],a.Boot.GAME_DATA.unlockedCharacters=this._unlockedCharacters,a.SaveManager.getInstance.save(),y[3].play("stand");var z=y[1].replace("goal_","");a.SoundMixer.play("flag"),this._gameUI.feedBackRecipient(z,"OpenNewPlayer")}var A=j+this._gameContainer.x,B=k+this._gameContainer.y;A>0&&A<g.WIDTH&&B>0&&B<g.HEIGHT&&++p,j+g.WIDTH>this._nextSegmentX&&this.createNextChunk(!1),x>=h.maxSpeedValue&&this.awardMedal("max_speed"),x>f.trackSpeed&&null==this._cameraTargetBody&&(null==q||q.x<w.x)&&(q=w.body,r=w.name),null!=w.parent&&w.update()}if(p==e.characters.length&&this.awardMedal("crowded"),7==this._amountOfActiveSkills&&this.awardMedal("boosters"),this._worldLimitLeft=b.x-g.wipeDistance,s<g.gameOverSpeed)this._gameOverTimer-=i,this._gameOverTimer<=0&&(a.SoundMixer.play("bgm_powermeter",.2,!0),this._state=c.STATE_RESET);else if(this._gameOverTimer=g.gameOverTime,this._cameraChangeTime>0)this._cameraChangeTime-=i;else if(q!=this._cameraTargetBody&&r.length>0){null==this._cameraTargetBody&&(this._cameraChangeTime=f.changeTime),this._cameraTargetBody=q,"jake"==r&&this._nextSpawn>0&&(r="player"),""!=r&&this._gameUI.feedBackRecipient(r,"CameraMove");for(var C=this._worldLimitLeft-g.WIDTH,D=0;D<this._fgCheckArray.length;)this._fgCheckArray[D].x<C?(this._fgCheckArray[D].parent&&this._fgContainer.removeChild(this._fgCheckArray[D]),this._fgCheckArray.splice(D,1)):D++;for(var u=this._layerMountain.children.length-1;u>=0;--u)this._layerMountain.getChildAt(u).x<C&&this._layerMountain.removeChildAt(u)}var E=(this._currentDistance/30).toFixed(0);this._gameUI.feedBackRecipient(E.toString(),"SetDistance"),this.updateCamera(i,f.speedFactor);break;case c.STATE_RESET:this._gameUI.feedBackRecipient("","RetryOpen"),this._state=c.STATE_GAME_OVER;break;case c.STATE_GAME_OVER:}l.prototype.update.call(this);for(var F=0;F<this._rocksAndBodies.length;){var G=this._rocksAndBodies[F];G.sprite.x<this._worldLimitLeft||G.sprite.y>this._worldLimitBottomPixel?(G.body.destroy(),G.sprite.destroy(!0),this._rocksAndBodies.splice(F,1)):(this.inScreen(G.body.x)?null==G.sprite.parent&&this._layerRocks.addChild(G.sprite):null!=G.sprite.parent&&this._layerRocks.removeChild(G.sprite),G.sprite.x=G.body.x,G.sprite.y=G.body.y,G.sprite.rotation=G.body.data.GetAngle(),F++)}if(this._state!=c.STATE_AVALANCHE&&this._state!=c.STATE_RESET&&this._players.forEach(function(a,b){null!=a.parent&&a.update()}),this._players.length>1){var H=this._players.length-1,I=Math.abs(this._players[H].x-this._players[H-1].x);I>h.winterFugitiveValue&&this.awardMedal("winter_fugitive")}if(this._timeToBubbleUpdate-=i,this._timeToBubbleUpdate<=0&&(this._timeToBubbleUpdate=.25,this.checkPlayersArrayDistance()),d<.2&&b.remove&&b.parent){var A=b.x+this._gameContainer.x,B=b.y+this._gameContainer.y;if(!(A>0&&A<g.WIDTH)){this._players.indexOf(b);b.free()}}for(F=0;F<this._mountainsAndBodies.length;)if(this._mountainsAndBodies[F].sprite.x<this._worldLimitLeft){var J=this._mountainsAndBodies[F].sprite;J.parent&&J.parent.removeChild(J),J.destroy(),this._mountainsAndBodies[F].body.destroy(),this._mountainsAndBodies.splice(F,1)}else this.inScreen(this._mountainsAndBodies[F].sprite.x,this._mountainsAndBodies[F].sprite.width)?null==this._mountainsAndBodies[F].sprite.parent&&(1==this._mountainsAndBodies[F].type?this._layerTerrace.addChild(this._mountainsAndBodies[F].sprite):this._layerMountain.addChild(this._mountainsAndBodies[F].sprite)):null!=this._mountainsAndBodies[F].sprite.parent&&(1==this._mountainsAndBodies[F].type?this._layerTerrace.removeChild(this._mountainsAndBodies[F].sprite):this._layerMountain.removeChild(this._mountainsAndBodies[F].sprite)),F++;for(F=0;F<this._decorationAndBodies.length;){var K=this._decorationAndBodies[F];null!=K.sprite&&K.sprite.x<this._worldLimitLeft?(K.sprite.parent&&K.sprite.parent.removeChild(K.sprite),K.sprite.destroy(!0),K.body&&K.body.destroy(),this._decorationAndBodies.splice(F,1)):(a.Boot.OPTIMIZATION||K.sprite&&"hit"==K.sprite.animations.currentAnim.name&&K.sprite.animations.currentAnim.isFinished&&K.typeIndex!==a.DecorationData.DD_TYPE_SNOWMAN&&K.sprite.animations.play("idle"),K.sprite&&(this.inScreen(K.sprite.x,K.sprite.width)?null==K.sprite.parent&&this._layerDecoration.addChild(K.sprite):null!=K.sprite.parent&&this._layerDecoration.removeChild(K.sprite)),F++)}if(null!=this._startMC&&null!=this._startMC.parent&&this._startMC.x<this._worldLimitLeft){for(this._startMC.parent.removeChild(this._startMC);this._startMC.children.length>0;)this._startMC.removeChild(this._startMC.children[0]);this._startMC.free(),this._startMC=null}}},n.prototype.checkPlayersArrayDistance=function(){for(var a=this,b=!1,c=1;c<this._players.length;c++)for(var d=0;d<this._players.length-c;d++){var e=this._players[d],f=this._players[d+1];e.x>f.x&&(this._players[d]=f,this._players[d+1]=e,b=!0)}if(b){var g=[],h=!1;this._players.forEach(function(b){"jake"==b.name?a._nextSpawn>0?g.push("player"):(g.push("jake"),h=!0):g.push(b.name)}),this._gameUI.swapChars(g,h)}},n.prototype.checkCameraTarget=function(a){this._cameraTargetBody==a&&(this._cameraTargetBody=null)},n.prototype.setCameraTarget=function(a){null==this._cameraTargetBody&&(this._cameraTargetBody=a)},n.prototype.refillJakeSplit=function(){var a=this._players.filter(function(a){return"jake"==a.name})[0];a&&(a.canspleet=!0)},n.prototype.getPlayerSkillInUse=function(a){var b=this._players.filter(function(b){return b.name==a})[0];if(b)return b.getActiveSkill()},n.prototype.preLaunch=function(b){if(this._click){this._click=!1;var d=Utils.lerpV2(this._launchSpeedMin,this._launchSpeedMax,this._currentLaunchPower).SelfMul(30);this._cameraTargetBody.applyForce(d.x,d.y),this._cameraTargetBody.angularVelocity=Utils.lerp(e.launchTorqueMin,e.launchTorqueMax,this._currentLaunchPower),this._players[0].launch=!0,this._state=c.STATE_AVALANCHE,a.SoundMixer.play("bgm_ingame",.2,!0)}},n.prototype.free=function(){},n.prototype.moveCamera=function(){this._cameraMoveComplete=!1},n.prototype.updateCamera=function(a,b){if(null!=this._cameraTargetBody){this._cameraTargetPos.x=this._cameraTargetBody.x,this._cameraTargetPos.y=this._cameraTargetBody.y,this._cameraTargetPos.SelfSub(new box2d.b2Vec2(f.target.x,f.target.y));var c=Utils.easeInQuad(this._gameContainer.x,-this._cameraTargetPos.x,b)-this._gameContainer.x,d=Utils.easeInQuad(this._gameContainer.y,-this._cameraTargetPos.y,b)-this._gameContainer.y;this._cameraMoveComplete||Math.abs(c)<10&&(this._gameUI.feedBackRecipient("","CameraMoveToCharIsEnd"),this._cameraMoveComplete=!0),
this._gameContainer.x+=c,this._gameContainer.y+=d,this._fgContainer.x+=c*j.scrollFactor,this._fgContainer.y+=d*j.scrollFactor;for(var e=0;e<this._fgCheckArray.length;e++){var h=this._fgCheckArray[e].x+this._fgContainer.x;h+this._fgCheckArray[e].width>0&&h-this._fgCheckArray[e].width<g.WIDTH?null==this._fgCheckArray[e].parent&&this._fgContainer.addChild(this._fgCheckArray[e]):null!=this._fgCheckArray[e].parent&&this._fgContainer.removeChild(this._fgCheckArray[e])}(this._fgNextSegmentX+this._fgContainer.x<g.WIDTH||this._fgNextSegmentY+this._fgContainer.y<g.HEIGHT)&&this.createNextFGChunk();for(var e=0;e<this._skyBG.length;++e)this._skyBG[e].x+=c*f.bgScrollFactor,this._skyBG[e].x<=-this._skyBG[e].mc.width?this._skyBG[e].x+=this._skyBG[e].mc.width*this._skyBG.length:this._skyBG[e].x>=this._skyBG[e].mc.width*(this._skyBG.length-1)&&(this._skyBG[e].x-=this._skyBG[e].mc.width*this._skyBG.length),this._skyBG[e].mc.x=Math.floor(this._skyBG[e].x);for(var e=0;e<this._cloudsContainer.children.length;++e){var i=this._cloudsBG[e];i.mc.x+=(c*f.cloudsScrollFactorX+i.speedX*a)*i.mc.scale.x,i.mc.y+=d*f.cloudsScrollFactorY,i.mc.x<.5*-g.WIDTH?this.randomizeCloud(i,1.1*g.WIDTH):i.mc.x>1.5*g.WIDTH&&this.randomizeCloud(i,g.WIDTH*-2),e>0&&this._cloudsContainer.getChildAt(e-1).scale.x>this._cloudsContainer.getChildAt(e).scale.x&&this.swapChildren(e-1,e,this._cloudsContainer)}}},n.prototype.refill=function(){this._players.forEach(function(a){return a.refill()})},n.prototype.swapChildren=function(a,b,c){var d=c.getChildAt(a),e=c.getChildAt(b);c.swapChildren(d,e)},n.prototype.fixtureFromConfig=function(a,b,c){for(var d=new box2d.b2Vec2(a[1]*g.worldScaleInverse,0),e=box2d.b2Mat22.FromAngleRadians(2*Math.PI/a[0]),f=[],h=0;h<a[0];h++){var i=new box2d.b2Vec2;d.SelfRotateRadians(2*Math.PI/a[0]),box2d.b2MulMV(e,d,i),d=i;var j=i.x,k=i.y;f.push(new box2d.b2Vec2(this.game.physics.box2d.pxm(-j),this.game.physics.box2d.pxm(-k)))}var l=new box2d.b2FixtureDef;return l.shape=(new box2d.b2PolygonShape).SetAsVector(f),l.density=a[2],l.friction=a[3],l.restitution=a[4],l.filter.maskBits=c,l.filter.categoryBits=b,l},n.prototype.setupFixtures=function(a,b,c){for(var d=0;d<a.length;d++)a[d].push(this.fixtureFromConfig(a[d],b,c))},n.prototype.getPlayerPosition=function(){return new Phaser.Point(this._players[0].worldPosition.x,this._players[0].worldPosition.y)},n.prototype.createNextFGChunk=function(){for(var a=0;a<1;++a){var b=this.make.image(this._fgNextSegmentX,this._fgNextSegmentY,"ImagesGamePlay",Utils.randomFromArray(n.FG_MC_NAMES)+"0000");this._fgContainer.addChild(b),this._fgCheckArray.push(b);var c=(this._nextSegmentX+this._gameContainer.x)*j.scrollFactor-(this._fgNextSegmentX+this._fgContainer.x),d=(this._nextSegmentY+this._gameContainer.y)*j.scrollFactor-(this._fgNextSegmentY+this._fgContainer.y),e=Math.atan2(d,c);e<0&&(e=.1*Math.PI),this._fgNextSegmentX+=Math.floor(j.separationX*Math.cos(e)),this._fgNextSegmentY+=Math.floor(j.separationX*Math.sin(e)),b.rotation=e}},n}(a.AbstractGame);n.TREE_NAMES=["tree_1","tree_2","tree_3"],n.ROCK_MC_NAMES=["rock_1","rock_2","rock_3"],n.SNOW_MC_NAMES=["snow_1","snow_2","snow_3"],n.GUNTER_A_SOUNDS=["gunter_a1","gunter_a2"],n.GUNTER_B_SOUNDS=["gunter_b1","gunter_b2"],n.SNOWMAN_SOUNDS=["snowbounce_1","snowbounce_2","snowbounce_3"],n.BOUNCE_SOUNDS=["rebound_1","rebound_2","rebound_3","rebound_4"],n.FG_MC_NAMES=["fg_1","fg_2","fg_3"],a.BaseGame=n;var o=function(){function a(){}return a}()}(TProject||(TProject={}));var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),TProject;!function(a){var b=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;return a._loadedAssets=!1,a}return __extends(c,b),c.prototype.preload=function(){this.game.load.onFileComplete.add(this.loadingUpdate,this),this.initSaveMnager(),this.game.load.image("cn_logo",c.PATH_IMAGES+"Preloader/fglogo.jpg"),this.game.load.atlas("preload",c.PATH_IMAGES+"Preloader/Preloader.png",c.PATH_IMAGES+"Preloader/Preloader.json")},c.prototype.create=function(){this.enabledMultitouch(!0),this.game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.game.scale.fullScreenScaleMode=Phaser.ScaleManager.SHOW_ALL,this.LOCK(),this.game.scale.pageAlignHorizontally=!0,this.game.scale.pageAlignVertically=!0,this.game.scale.refresh(),this.game.input.touch.preventDefault=!1,this.game.device.desktop?this.game.input.mouse.enabled=!0:this.game.input.mouse.enabled=!1,this.game.stage.disableVisibilityChange=!0,this.game.stage.backgroundColor=0,1!=window.DONT_USE_OPTIMIZATION_FOR_MOBILE&&(c.OPTIMIZATION=!this.game.device.desktop)},c.prototype.initSaveMnager=function(){a.SaveManager.getInstance.init("AT_Avalaunch_014232sd3",c.GAME_DATA),c.GAME_DATA=a.SaveManager.getInstance.load()},c.prototype.loadingUpdate=function(a,b,c,d,e){a>=100&&(this.game.load.onFileComplete.removeAll(),this._loadedAssets=!0)},c.prototype.update=function(){this._loadedAssets&&c.CAN_START&&(this._loadedAssets=!1,this.game.state.start("Preloader",!0))},c.prototype.enabledMultitouch=function(a){a?(this.game.input.maxPointers=2,this.game.input.addPointer(),this.game.input.addPointer()):this.game.input.maxPointers=1},c.prototype.LOCK=function(){var a=this;c.CAN_START=this.game.scale.isLandscape,this.game.scale.forceOrientation(!0,!1),this.game.scale.enterIncorrectOrientation.add(function(){a.enterIncorrectOrientation()},this),this.game.scale.leaveIncorrectOrientation.add(function(){a.game.world.removeChild(c.LOCK_SCREN),c.CAN_START=!0},this)},c.prototype.enterIncorrectOrientation=function(){var a,b=this;null==c.LOCK_SCREN&&(c.LOCK_SCREN=this.game.make.graphics(0,0),c.LOCK_SCREN.beginFill(2169377),c.LOCK_SCREN.drawRect(0,0,5e4,5e4),c.LOCK_SCREN.endFill(),a=this.game.make.image(this.game.world.centerX,this.game.world.centerY,"lockOrientation"),a.anchor.set(.5),a.alpha=0,setTimeout(function(){b.game.add.tween(a).to({alpha:1},300,Phaser.Easing.Linear.None,!0),a.scale.set(.5/b.game.scale.scaleFactor.y,.5/b.game.scale.scaleFactor.x)},800),c.LOCK_SCREN.addChild(a)),this.game.world.addChild(c.LOCK_SCREN),c.CAN_START=!1},c}(Phaser.State);b.PATH_IMAGES="./assets/images/",b.PATH_FONTS="./assets/fonts/",b.PATH_SOUNDS="./assets/sounds/",b.FONT_NAME_HARD="curse_casualregular",b.FONT_NAME_LIGHT="curse_casualregular",b.GAME_DATA=new a.SaveData,b.OPTIMIZATION=!1,b.CAN_START=!1,a.Boot=b}(TProject||(TProject={}));var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),TProject;!function(a){var b=(GamesConfig.Mountain,GamesConfig.Players,GamesConfig.Camera,GamesConfig.Game,GamesConfig.Foreground,function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.create=function(){b.prototype.create.call(this),console.log("TEST! NEW!"),this.game.stage.backgroundColor="#124184",this.game.physics.startSystem(Phaser.Physics.BOX2D),this.game.physics.box2d.gravity.y=500,this._platformSprite=this.game.add.sprite(400,350,"ImagesGamePlay","segment_1600000"),this.game.physics.box2d.enable(this._platformSprite),this._platformSprite.body.static=!0,this._rockBody=this.game.physics.box2d.createCircle(430,0,32),this._player=new a.DBSprite(a.Boot.GAMEPLAY_DB,"_DB_FOR_GAMEPLAY/player",this.game),this._player.setPos(410,200),this._player.play("idle"),this._blockSprite=this.game.add.sprite(400,200,"ImagesGamePlay","fx_hit_10002"),this.game.physics.box2d.enable(this._blockSprite),this._blockSprite.body.setCircle(this._player.width/2),this._blockSprite.body.angle=30},c.prototype.update=function(){this._player.x=this._blockSprite.body.x,this._player.y=this._blockSprite.body.y,this._player.rotation=this._blockSprite.body.rotation},c.prototype.render=function(){this.game.debug.body(this._platformSprite),this.game.debug.box2dWorld();var a=.5*this._blockSprite.body.velocity.y;a=Math.min(Math.max(a,0),255);var a=Math.floor(a),b=255-a;this.game.debug.body(this._blockSprite,"rgb("+a+",0,"+b+")")},c}(a.AbstractGame));a.NewPhTest=b}(TProject||(TProject={}));var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),TProject;!function(a){var b=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.preload=function(){this.game.load.onFileComplete.add(this.loadingUpdate,this),this.game.load.image("lockOrientation",a.Boot.PATH_IMAGES+"ui/lock.png")},c.prototype.loadingUpdate=function(a,b,c,d,e){a>=100&&(this.game.load.onFileComplete.removeAll(),this.game.state.start("Boot",!0))},c}(Phaser.State);a.PreBoot=b}(TProject||(TProject={}));var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),TProject;!function(a){var b=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;return a._loadedAssets=!1,a._loadedFont=!1,a}return __extends(c,b),c.prototype.preload=function(){var b=this;this.game.load.onFileComplete.add(this.loadingUpdate,this),this._fglogo=this.add.image(this.world.centerX-3,this.world.centerY-100+60,"cn_logo"),this._fglogo.scale.set(.8),this._fglogo.anchor.set(.5),this._loading=new a.ParallaxImage(this.game,"preload",0,"bgProress0000"),this._loading.anchor.set(.5),this._footer=this.add.image(this.world.centerX,this.world.centerY+120-20,"preload","preloaderFooter0000"),this._footer.anchor.set(.5),this._loading.x=this._footer.x-.5*this._footer.width-2,this._loading.y=this._footer.y-50,this._loadingMask=this.add.graphics(4,24),this._loadingMask.beginFill(16711680,.5),this._loadingMask.drawRect(0,0,this._footer.width-5,this._footer.height-5),this._loadingMask.endFill(),this._loading.addChild(this._loadingMask),this._loading.mask=this._loadingMask,this._loadingMask.scale.x=0,this._intervalId=setInterval(function(){b._loading.updateScroll(1.2)},20),this.fontsLoading(),a.Boot.OPTIMIZATION?(this.game.load.atlas("ImagesGamePlay",a.Boot.PATH_IMAGES+"optimization_images.png",a.Boot.PATH_IMAGES+"optimization_images.json"),a.Factories.loadFactory(this.game,"db_for_gameplay",a.Boot.PATH_IMAGES+"DB/Optimization/")):(this.game.load.atlas("ImagesGamePlay",a.Boot.PATH_IMAGES+"no_optimization_images.png",a.Boot.PATH_IMAGES+"no_optimization_images.json"),a.Factories.loadFactory(this.game,"db_for_gameplay",a.Boot.PATH_IMAGES+"DB/NoOptimization/")),a.Factories.loadFactory(this.game,"db_hud",a.Boot.PATH_IMAGES+"DB/"),this.game.load.image("bg",a.Boot.PATH_IMAGES+"bg.png"),this.game.load.image("gameLogo",a.Boot.PATH_IMAGES+"logo_en.png"),this.game.load.audiosprite("sfx",[a.Boot.PATH_SOUNDS+"sfx.mp3",a.Boot.PATH_SOUNDS+"sfx.ogg"],a.Boot.PATH_SOUNDS+"sfx.json")},c.prototype.shutdown=function(){this._fglogo.destroy(),this._fglogo=null,this._loading.destroy(),this._loading=null,this._footer.destroy(),this._footer=null,this._loadingMask.destroy(),this._loadingMask=null},c.prototype.loadingUpdate=function(b,c,d,e,f){this._loadingMask.scale.x=b/100,b>=100&&(this.game.load.onFileComplete.removeAll(),a.Boot.GAMEPLAY_DB=a.Factories.createFactory(this.game,"db_for_gameplay"),a.Boot.GAME_HUD=a.Factories.createFactory(this.game,"db_hud"),dragonBones.PhaserFactory.startLoop(),this._loadedAssets=!0,a.SoundMixer.init(this.game),clearInterval(this._intervalId))},c.prototype.update=function(){var b=this;this._loadedAssets&&this._loadedFont&&(this._loadedAssets=!1,setTimeout(function(){b.game.state.start(a.LocalConfig.CURRENT_STATE,!0)},400))},c.prototype.fontsLoading=function(){var b=this;WebFont.load({custom:{families:["curse_casualregular"],urls:[a.Boot.PATH_FONTS+"font.css"]},active:function(){window.setTimeout(function(){b._loadedFont=!0},100)}})},c}(Phaser.State);a.Preloader=b}(TProject||(TProject={}));var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),TProject;!function(a){var b=(GamesConfig.Mountain,GamesConfig.Players,GamesConfig.Camera,GamesConfig.Game),c=(GamesConfig.Foreground,function(c){function d(){return null!==c&&c.apply(this,arguments)||this}return __extends(d,c),d.prototype.create=function(){c.prototype.create.call(this),console.log("TEST!");var b=(this.game.add.sprite(0,0,"ImagesGamePlay","sky0000"),new a.DBSprite(a.Boot.GAMEPLAY_DB,"_DB_FOR_GAMEPLAY/start",this.game));b.x=349,b.y=310,b.play("idle");var d=new a.DBSprite(a.Boot.GAMEPLAY_DB,"_DB_FOR_GAMEPLAY/player_marceline",this.game);d.x=349,d.y=310,d.scale.set(.7,.7),d.play("idle"),d.getSlot("Layer 5").play("ingame_idle"),setTimeout(function(){d.getSlot("Layer 5").play("boost")},1e3)},d.prototype.update=function(){this.isPaused||c.prototype.update.call(this)},d.prototype.free=function(){},d.prototype.fixtureFromConfig=function(a){for(var c=new box2d.b2Vec2(a[1]*b.worldScaleInverse,0),d=box2d.b2Mat22.FromAngleRadians(2*Math.PI/a[0]),e=[],f=0;f<a[0];f++){var g=new box2d.b2Vec2;c.SelfRotateRadians(2*Math.PI/a[0]),box2d.b2MulMV(d,c,g),c=g,e.push(c)}var h=new box2d.b2FixtureDef;return h.shape=(new box2d.b2PolygonShape).SetAsVector(e),h.density=a[2],h.friction=a[3],h.restitution=a[4],h},d.prototype.setupFixtures=function(a){for(var b=0;b<a.length;b++)a[b].push(this.fixtureFromConfig(a[b]))},d.prototype.render=function(){c.prototype.render.call(this)},d}(a.AbstractGame));a.Test=c}(TProject||(TProject={}));