/**
 * @license
 * pixi.js - v2.2.9
 * Copyright (c) 2012-2014, Mat Groves
 * http://goodboydigital.com/
 *
 * Compiled: 2015-04-08
 *
 * pixi.js is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license.php
 */
var root=this,PIXI=PIXI||{};PIXI.WEBGL_RENDERER=0,PIXI.CANVAS_RENDERER=1,PIXI.VERSION="v2.2.9",PIXI.blendModes={NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},PIXI.scaleModes={DEFAULT:0,LINEAR:0,NEAREST:1},PIXI._UID=0,"undefined"!=typeof Float32Array?(PIXI.Float32Array=Float32Array,PIXI.Uint16Array=Uint16Array,PIXI.Uint32Array=Uint32Array,PIXI.ArrayBuffer=ArrayBuffer):(PIXI.Float32Array=Array,PIXI.Uint16Array=Array),PIXI.INTERACTION_FREQUENCY=30,PIXI.AUTO_PREVENT_DEFAULT=!0,PIXI.PI_2=2*Math.PI,PIXI.RAD_TO_DEG=180/Math.PI,PIXI.DEG_TO_RAD=Math.PI/180,PIXI.RETINA_PREFIX="@2x",PIXI.dontSayHello=!1,PIXI.defaultRenderOptions={view:null,transparent:!1,antialias:!1,preserveDrawingBuffer:!1,resolution:1,clearBeforeRender:!0,autoResize:!1},PIXI.sayHello=function(type){if(!PIXI.dontSayHello){if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var args=["%c %c %c Pixi.js "+PIXI.VERSION+" - "+type+"  %c  %c  http://www.pixijs.com/  %c %c ♥%c♥%c♥ ","background: #ff66a5","background: #ff66a5","color: #ff66a5; background: #030307;","background: #ff66a5","background: #ffc3dc","background: #ff66a5","color: #ff2424; background: #fff","color: #ff2424; background: #fff","color: #ff2424; background: #fff"];console.log.apply(console,args)}else window.console&&console.log("Pixi.js "+PIXI.VERSION+" - http://www.pixijs.com/");PIXI.dontSayHello=!0}},PIXI.Point=function(x,y){this.x=x||0,this.y=y||0},PIXI.Point.prototype.clone=function(){return new PIXI.Point(this.x,this.y)},PIXI.Point.prototype.set=function(x,y){this.x=x||0,this.y=y||(0!==y?this.x:0)},PIXI.Point.prototype.constructor=PIXI.Point,PIXI.Rectangle=function(x,y,width,height){this.x=x||0,this.y=y||0,this.width=width||0,this.height=height||0},PIXI.Rectangle.prototype.clone=function(){return new PIXI.Rectangle(this.x,this.y,this.width,this.height)},PIXI.Rectangle.prototype.contains=function(x,y){if(this.width<=0||this.height<=0)return!1;var x1=this.x;if(x>=x1&&x<=x1+this.width){var y1=this.y;if(y>=y1&&y<=y1+this.height)return!0}return!1},PIXI.Rectangle.prototype.constructor=PIXI.Rectangle,PIXI.EmptyRectangle=new PIXI.Rectangle(0,0,0,0),PIXI.Polygon=function(points){if(points instanceof Array||(points=Array.prototype.slice.call(arguments)),points[0]instanceof PIXI.Point){for(var p=[],i=0,il=points.length;il>i;i++)p.push(points[i].x,points[i].y);points=p}this.closed=!0,this.points=points},PIXI.Polygon.prototype.clone=function(){var points=this.points.slice();return new PIXI.Polygon(points)},PIXI.Polygon.prototype.contains=function(x,y){for(var inside=!1,length=this.points.length/2,i=0,j=length-1;length>i;j=i++){var xi=this.points[2*i],yi=this.points[2*i+1],xj=this.points[2*j],yj=this.points[2*j+1],intersect=yi>y!=yj>y&&(xj-xi)*(y-yi)/(yj-yi)+xi>x;intersect&&(inside=!inside)}return inside},PIXI.Polygon.prototype.constructor=PIXI.Polygon,PIXI.Circle=function(x,y,radius){this.x=x||0,this.y=y||0,this.radius=radius||0},PIXI.Circle.prototype.clone=function(){return new PIXI.Circle(this.x,this.y,this.radius)},PIXI.Circle.prototype.contains=function(x,y){if(this.radius<=0)return!1;var dx=this.x-x,dy=this.y-y,r2=this.radius*this.radius;return dx*=dx,dy*=dy,r2>=dx+dy},PIXI.Circle.prototype.getBounds=function(){return new PIXI.Rectangle(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)},PIXI.Circle.prototype.constructor=PIXI.Circle,PIXI.Ellipse=function(x,y,width,height){this.x=x||0,this.y=y||0,this.width=width||0,this.height=height||0},PIXI.Ellipse.prototype.clone=function(){return new PIXI.Ellipse(this.x,this.y,this.width,this.height)},PIXI.Ellipse.prototype.contains=function(x,y){if(this.width<=0||this.height<=0)return!1;var normx=(x-this.x)/this.width,normy=(y-this.y)/this.height;return normx*=normx,normy*=normy,1>=normx+normy},PIXI.Ellipse.prototype.getBounds=function(){return new PIXI.Rectangle(this.x-this.width,this.y-this.height,this.width,this.height)},PIXI.Ellipse.prototype.constructor=PIXI.Ellipse,PIXI.RoundedRectangle=function(x,y,width,height,radius){this.x=x||0,this.y=y||0,this.width=width||0,this.height=height||0,this.radius=radius||20},PIXI.RoundedRectangle.prototype.clone=function(){return new PIXI.RoundedRectangle(this.x,this.y,this.width,this.height,this.radius)},PIXI.RoundedRectangle.prototype.contains=function(x,y){if(this.width<=0||this.height<=0)return!1;var x1=this.x;if(x>=x1&&x<=x1+this.width){var y1=this.y;if(y>=y1&&y<=y1+this.height)return!0}return!1},PIXI.RoundedRectangle.prototype.constructor=PIXI.RoundedRectangle,PIXI.Matrix=function(){this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0},PIXI.Matrix.prototype.fromArray=function(array){this.a=array[0],this.b=array[1],this.c=array[3],this.d=array[4],this.tx=array[2],this.ty=array[5]},PIXI.Matrix.prototype.toArray=function(transpose){this.array||(this.array=new PIXI.Float32Array(9));var array=this.array;return transpose?(array[0]=this.a,array[1]=this.b,array[2]=0,array[3]=this.c,array[4]=this.d,array[5]=0,array[6]=this.tx,array[7]=this.ty,array[8]=1):(array[0]=this.a,array[1]=this.c,array[2]=this.tx,array[3]=this.b,array[4]=this.d,array[5]=this.ty,array[6]=0,array[7]=0,array[8]=1),array},PIXI.Matrix.prototype.apply=function(pos,newPos){return newPos=newPos||new PIXI.Point,newPos.x=this.a*pos.x+this.c*pos.y+this.tx,newPos.y=this.b*pos.x+this.d*pos.y+this.ty,newPos},PIXI.Matrix.prototype.applyInverse=function(pos,newPos){newPos=newPos||new PIXI.Point;var id=1/(this.a*this.d+this.c*-this.b);return newPos.x=this.d*id*pos.x+-this.c*id*pos.y+(this.ty*this.c-this.tx*this.d)*id,newPos.y=this.a*id*pos.y+-this.b*id*pos.x+(-this.ty*this.a+this.tx*this.b)*id,newPos},PIXI.Matrix.prototype.translate=function(x,y){return this.tx+=x,this.ty+=y,this},PIXI.Matrix.prototype.scale=function(x,y){return this.a*=x,this.d*=y,this.c*=x,this.b*=y,this.tx*=x,this.ty*=y,this},PIXI.Matrix.prototype.rotate=function(angle){var cos=Math.cos(angle),sin=Math.sin(angle),a1=this.a,c1=this.c,tx1=this.tx;return this.a=a1*cos-this.b*sin,this.b=a1*sin+this.b*cos,this.c=c1*cos-this.d*sin,this.d=c1*sin+this.d*cos,this.tx=tx1*cos-this.ty*sin,this.ty=tx1*sin+this.ty*cos,this},PIXI.Matrix.prototype.append=function(matrix){var a1=this.a,b1=this.b,c1=this.c,d1=this.d;return this.a=matrix.a*a1+matrix.b*c1,this.b=matrix.a*b1+matrix.b*d1,this.c=matrix.c*a1+matrix.d*c1,this.d=matrix.c*b1+matrix.d*d1,this.tx=matrix.tx*a1+matrix.ty*c1+this.tx,this.ty=matrix.tx*b1+matrix.ty*d1+this.ty,this},PIXI.Matrix.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},PIXI.identityMatrix=new PIXI.Matrix,PIXI.DisplayObject=function(){this.position=new PIXI.Point,this.scale=new PIXI.Point(1,1),this.pivot=new PIXI.Point(0,0),this.rotation=0,this.alpha=1,this.visible=!0,this.hitArea=null,this.buttonMode=!1,this.renderable=!1,this.parent=null,this.stage=null,this.worldAlpha=1,this._interactive=!1,this.defaultCursor="pointer",this.worldTransform=new PIXI.Matrix,this._sr=0,this._cr=1,this.filterArea=null,this._bounds=new PIXI.Rectangle(0,0,1,1),this._currentBounds=null,this._mask=null,this._cacheAsBitmap=!1,this._cacheIsDirty=!1},PIXI.DisplayObject.prototype.constructor=PIXI.DisplayObject,Object.defineProperty(PIXI.DisplayObject.prototype,"interactive",{get:function(){return this._interactive},set:function(value){this._interactive=value,this.stage&&(this.stage.dirty=!0)}}),Object.defineProperty(PIXI.DisplayObject.prototype,"worldVisible",{get:function(){var item=this;do{if(!item.visible)return!1;item=item.parent}while(item);return!0}}),Object.defineProperty(PIXI.DisplayObject.prototype,"mask",{get:function(){return this._mask},set:function(value){this._mask&&(this._mask.isMask=!1),this._mask=value,this._mask&&(this._mask.isMask=!0)}}),Object.defineProperty(PIXI.DisplayObject.prototype,"filters",{get:function(){return this._filters},set:function(value){if(value){for(var passes=[],i=0;i<value.length;i++)for(var filterPasses=value[i].passes,j=0;j<filterPasses.length;j++)passes.push(filterPasses[j]);this._filterBlock={target:this,filterPasses:passes}}this._filters=value}}),Object.defineProperty(PIXI.DisplayObject.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(value){this._cacheAsBitmap!==value&&(value?this._generateCachedSprite():this._destroyCachedSprite(),this._cacheAsBitmap=value)}}),PIXI.DisplayObject.prototype.updateTransform=function(){var a,b,c,d,tx,ty,pt=this.parent.worldTransform,wt=this.worldTransform;this.rotation%PIXI.PI_2?(this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation)),a=this._cr*this.scale.x,b=this._sr*this.scale.x,c=-this._sr*this.scale.y,d=this._cr*this.scale.y,tx=this.position.x,ty=this.position.y,(this.pivot.x||this.pivot.y)&&(tx-=this.pivot.x*a+this.pivot.y*c,ty-=this.pivot.x*b+this.pivot.y*d),wt.a=a*pt.a+b*pt.c,wt.b=a*pt.b+b*pt.d,wt.c=c*pt.a+d*pt.c,wt.d=c*pt.b+d*pt.d,wt.tx=tx*pt.a+ty*pt.c+pt.tx,wt.ty=tx*pt.b+ty*pt.d+pt.ty):(a=this.scale.x,d=this.scale.y,tx=this.position.x-this.pivot.x*a,ty=this.position.y-this.pivot.y*d,wt.a=a*pt.a,wt.b=a*pt.b,wt.c=d*pt.c,wt.d=d*pt.d,wt.tx=tx*pt.a+ty*pt.c+pt.tx,wt.ty=tx*pt.b+ty*pt.d+pt.ty),this.worldAlpha=this.alpha*this.parent.worldAlpha},PIXI.DisplayObject.prototype.displayObjectUpdateTransform=PIXI.DisplayObject.prototype.updateTransform,PIXI.DisplayObject.prototype.getBounds=function(matrix){return matrix=matrix,PIXI.EmptyRectangle},PIXI.DisplayObject.prototype.getLocalBounds=function(){return this.getBounds(PIXI.identityMatrix)},PIXI.DisplayObject.prototype.setStageReference=function(stage){this.stage=stage,this._interactive&&(this.stage.dirty=!0)},PIXI.DisplayObject.prototype.generateTexture=function(resolution,scaleMode,renderer){var bounds=this.getLocalBounds(),renderTexture=new PIXI.RenderTexture(0|bounds.width,0|bounds.height,renderer,scaleMode,resolution);return PIXI.DisplayObject._tempMatrix.tx=-bounds.x,PIXI.DisplayObject._tempMatrix.ty=-bounds.y,renderTexture.render(this,PIXI.DisplayObject._tempMatrix),renderTexture},PIXI.DisplayObject.prototype.updateCache=function(){this._generateCachedSprite()},PIXI.DisplayObject.prototype.toGlobal=function(position){return this.displayObjectUpdateTransform(),this.worldTransform.apply(position)},PIXI.DisplayObject.prototype.toLocal=function(position,from){return from&&(position=from.toGlobal(position)),this.displayObjectUpdateTransform(),this.worldTransform.applyInverse(position)},PIXI.DisplayObject.prototype._renderCachedSprite=function(renderSession){this._cachedSprite.worldAlpha=this.worldAlpha,renderSession.gl?PIXI.Sprite.prototype._renderWebGL.call(this._cachedSprite,renderSession):PIXI.Sprite.prototype._renderCanvas.call(this._cachedSprite,renderSession)},PIXI.DisplayObject.prototype._generateCachedSprite=function(){this._cacheAsBitmap=!1;var bounds=this.getLocalBounds();if(this._cachedSprite)this._cachedSprite.texture.resize(0|bounds.width,0|bounds.height);else{var renderTexture=new PIXI.RenderTexture(0|bounds.width,0|bounds.height);this._cachedSprite=new PIXI.Sprite(renderTexture),this._cachedSprite.worldTransform=this.worldTransform}var tempFilters=this._filters;this._filters=null,this._cachedSprite.filters=tempFilters,PIXI.DisplayObject._tempMatrix.tx=-bounds.x,PIXI.DisplayObject._tempMatrix.ty=-bounds.y,this._cachedSprite.texture.render(this,PIXI.DisplayObject._tempMatrix,!0),this._cachedSprite.anchor.x=-(bounds.x/bounds.width),this._cachedSprite.anchor.y=-(bounds.y/bounds.height),this._filters=tempFilters,this._cacheAsBitmap=!0},PIXI.DisplayObject.prototype._destroyCachedSprite=function(){this._cachedSprite&&(this._cachedSprite.texture.destroy(!0),this._cachedSprite=null)},PIXI.DisplayObject.prototype._renderWebGL=function(renderSession){renderSession=renderSession},PIXI.DisplayObject.prototype._renderCanvas=function(renderSession){renderSession=renderSession},PIXI.DisplayObject._tempMatrix=new PIXI.Matrix,Object.defineProperty(PIXI.DisplayObject.prototype,"x",{get:function(){return this.position.x},set:function(value){this.position.x=value}}),Object.defineProperty(PIXI.DisplayObject.prototype,"y",{get:function(){return this.position.y},set:function(value){this.position.y=value}}),PIXI.DisplayObjectContainer=function(){PIXI.DisplayObject.call(this),this.children=[]},PIXI.DisplayObjectContainer.prototype=Object.create(PIXI.DisplayObject.prototype),PIXI.DisplayObjectContainer.prototype.constructor=PIXI.DisplayObjectContainer,Object.defineProperty(PIXI.DisplayObjectContainer.prototype,"width",{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(value){var width=this.getLocalBounds().width;0!==width?this.scale.x=value/width:this.scale.x=1,this._width=value}}),Object.defineProperty(PIXI.DisplayObjectContainer.prototype,"height",{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(value){var height=this.getLocalBounds().height;0!==height?this.scale.y=value/height:this.scale.y=1,this._height=value}}),PIXI.DisplayObjectContainer.prototype.addChild=function(child){return this.addChildAt(child,this.children.length)},PIXI.DisplayObjectContainer.prototype.addChildAt=function(child,index){if(index>=0&&index<=this.children.length)return child.parent&&child.parent.removeChild(child),child.parent=this,this.children.splice(index,0,child),this.stage&&child.setStageReference(this.stage),child;throw new Error(child+"addChildAt: The index "+index+" supplied is out of bounds "+this.children.length)},PIXI.DisplayObjectContainer.prototype.swapChildren=function(child,child2){if(child!==child2){var index1=this.getChildIndex(child),index2=this.getChildIndex(child2);if(0>index1||0>index2)throw new Error("swapChildren: Both the supplied DisplayObjects must be a child of the caller.");this.children[index1]=child2,this.children[index2]=child}},PIXI.DisplayObjectContainer.prototype.getChildIndex=function(child){var index=this.children.indexOf(child);if(-1===index)throw new Error("The supplied DisplayObject must be a child of the caller");return index},PIXI.DisplayObjectContainer.prototype.setChildIndex=function(child,index){if(0>index||index>=this.children.length)throw new Error("The supplied index is out of bounds");var currentIndex=this.getChildIndex(child);this.children.splice(currentIndex,1),this.children.splice(index,0,child)},PIXI.DisplayObjectContainer.prototype.getChildAt=function(index){if(0>index||index>=this.children.length)throw new Error("getChildAt: Supplied index "+index+" does not exist in the child list, or the supplied DisplayObject must be a child of the caller");return this.children[index]},PIXI.DisplayObjectContainer.prototype.removeChild=function(child){var index=this.children.indexOf(child);if(-1!==index)return this.removeChildAt(index)},PIXI.DisplayObjectContainer.prototype.removeChildAt=function(index){var child=this.getChildAt(index);return this.stage&&child.removeStageReference(),child.parent=void 0,this.children.splice(index,1),child},PIXI.DisplayObjectContainer.prototype.removeChildren=function(beginIndex,endIndex){var begin=beginIndex||0,end="number"==typeof endIndex?endIndex:this.children.length,range=end-begin;if(range>0&&end>=range){for(var removed=this.children.splice(begin,range),i=0;i<removed.length;i++){var child=removed[i];this.stage&&child.removeStageReference(),child.parent=void 0}return removed}if(0===range&&0===this.children.length)return[];throw new Error("removeChildren: Range Error, numeric values are outside the acceptable range")},PIXI.DisplayObjectContainer.prototype.updateTransform=function(){if(this.visible&&(this.displayObjectUpdateTransform(),!this._cacheAsBitmap))for(var i=0,j=this.children.length;j>i;i++)this.children[i].updateTransform()},PIXI.DisplayObjectContainer.prototype.displayObjectContainerUpdateTransform=PIXI.DisplayObjectContainer.prototype.updateTransform,PIXI.DisplayObjectContainer.prototype.getBounds=function(){if(0===this.children.length)return PIXI.EmptyRectangle;for(var childBounds,childMaxX,childMaxY,minX=1/0,minY=1/0,maxX=-(1/0),maxY=-(1/0),childVisible=!1,i=0,j=this.children.length;j>i;i++){var child=this.children[i];child.visible&&(childVisible=!0,childBounds=this.children[i].getBounds(),minX=minX<childBounds.x?minX:childBounds.x,minY=minY<childBounds.y?minY:childBounds.y,childMaxX=childBounds.width+childBounds.x,childMaxY=childBounds.height+childBounds.y,maxX=maxX>childMaxX?maxX:childMaxX,maxY=maxY>childMaxY?maxY:childMaxY)}if(!childVisible)return PIXI.EmptyRectangle;var bounds=this._bounds;return bounds.x=minX,bounds.y=minY,bounds.width=maxX-minX,bounds.height=maxY-minY,bounds},PIXI.DisplayObjectContainer.prototype.getLocalBounds=function(){var matrixCache=this.worldTransform;this.worldTransform=PIXI.identityMatrix;for(var i=0,j=this.children.length;j>i;i++)this.children[i].updateTransform();var bounds=this.getBounds();return this.worldTransform=matrixCache,bounds},PIXI.DisplayObjectContainer.prototype.setStageReference=function(stage){this.stage=stage,this._interactive&&(this.stage.dirty=!0);for(var i=0,j=this.children.length;j>i;i++){var child=this.children[i];child.setStageReference(stage)}},PIXI.DisplayObjectContainer.prototype.removeStageReference=function(){for(var i=0,j=this.children.length;j>i;i++){var child=this.children[i];child.removeStageReference()}this._interactive&&(this.stage.dirty=!0),this.stage=null},PIXI.DisplayObjectContainer.prototype._renderWebGL=function(renderSession){if(this.visible&&!(this.alpha<=0)){if(this._cacheAsBitmap)return void this._renderCachedSprite(renderSession);var i,j;if(this._mask||this._filters){for(this._filters&&(renderSession.spriteBatch.flush(),renderSession.filterManager.pushFilter(this._filterBlock)),this._mask&&(renderSession.spriteBatch.stop(),renderSession.maskManager.pushMask(this.mask,renderSession),renderSession.spriteBatch.start()),i=0,j=this.children.length;j>i;i++)this.children[i]._renderWebGL(renderSession);renderSession.spriteBatch.stop(),this._mask&&renderSession.maskManager.popMask(this._mask,renderSession),this._filters&&renderSession.filterManager.popFilter(),renderSession.spriteBatch.start()}else for(i=0,j=this.children.length;j>i;i++)this.children[i]._renderWebGL(renderSession)}},PIXI.DisplayObjectContainer.prototype._renderCanvas=function(renderSession){if(this.visible!==!1&&0!==this.alpha){if(this._cacheAsBitmap)return void this._renderCachedSprite(renderSession);this._mask&&renderSession.maskManager.pushMask(this._mask,renderSession);for(var i=0,j=this.children.length;j>i;i++){var child=this.children[i];child._renderCanvas(renderSession)}this._mask&&renderSession.maskManager.popMask(renderSession)}},PIXI.Sprite=function(texture){PIXI.DisplayObjectContainer.call(this),this.anchor=new PIXI.Point,this.texture=texture||PIXI.Texture.emptyTexture,this._width=0,this._height=0,this.tint=16777215,this.blendMode=PIXI.blendModes.NORMAL,this.shader=null,this.texture.baseTexture.hasLoaded?this.onTextureUpdate():this.texture.on("update",this.onTextureUpdate.bind(this)),this.renderable=!0},PIXI.Sprite.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),PIXI.Sprite.prototype.constructor=PIXI.Sprite,Object.defineProperty(PIXI.Sprite.prototype,"width",{get:function(){return this.scale.x*this.texture.frame.width},set:function(value){this.scale.x=value/this.texture.frame.width,this._width=value}}),Object.defineProperty(PIXI.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(value){this.scale.y=value/this.texture.frame.height,this._height=value}}),PIXI.Sprite.prototype.setTexture=function(texture){this.texture=texture,this.cachedTint=16777215},PIXI.Sprite.prototype.onTextureUpdate=function(){this._width&&(this.scale.x=this._width/this.texture.frame.width),this._height&&(this.scale.y=this._height/this.texture.frame.height)},PIXI.Sprite.prototype.getBounds=function(matrix){var width=this.texture.frame.width,height=this.texture.frame.height,w0=width*(1-this.anchor.x),w1=width*-this.anchor.x,h0=height*(1-this.anchor.y),h1=height*-this.anchor.y,worldTransform=matrix||this.worldTransform,a=worldTransform.a,b=worldTransform.b,c=worldTransform.c,d=worldTransform.d,tx=worldTransform.tx,ty=worldTransform.ty,maxX=-(1/0),maxY=-(1/0),minX=1/0,minY=1/0;if(0===b&&0===c)0>a&&(a*=-1),0>d&&(d*=-1),minX=a*w1+tx,maxX=a*w0+tx,minY=d*h1+ty,maxY=d*h0+ty;else{var x1=a*w1+c*h1+tx,y1=d*h1+b*w1+ty,x2=a*w0+c*h1+tx,y2=d*h1+b*w0+ty,x3=a*w0+c*h0+tx,y3=d*h0+b*w0+ty,x4=a*w1+c*h0+tx,y4=d*h0+b*w1+ty;minX=minX>x1?x1:minX,minX=minX>x2?x2:minX,minX=minX>x3?x3:minX,minX=minX>x4?x4:minX,minY=minY>y1?y1:minY,minY=minY>y2?y2:minY,minY=minY>y3?y3:minY,minY=minY>y4?y4:minY,maxX=x1>maxX?x1:maxX,maxX=x2>maxX?x2:maxX,maxX=x3>maxX?x3:maxX,maxX=x4>maxX?x4:maxX,maxY=y1>maxY?y1:maxY,maxY=y2>maxY?y2:maxY,maxY=y3>maxY?y3:maxY,maxY=y4>maxY?y4:maxY}var bounds=this._bounds;return bounds.x=minX,bounds.width=maxX-minX,bounds.y=minY,bounds.height=maxY-minY,this._currentBounds=bounds,bounds},PIXI.Sprite.prototype._renderWebGL=function(renderSession){if(this.visible&&!(this.alpha<=0)){var i,j;if(this._mask||this._filters){var spriteBatch=renderSession.spriteBatch;for(this._filters&&(spriteBatch.flush(),renderSession.filterManager.pushFilter(this._filterBlock)),this._mask&&(spriteBatch.stop(),renderSession.maskManager.pushMask(this.mask,renderSession),spriteBatch.start()),spriteBatch.render(this),i=0,j=this.children.length;j>i;i++)this.children[i]._renderWebGL(renderSession);spriteBatch.stop(),this._mask&&renderSession.maskManager.popMask(this._mask,renderSession),this._filters&&renderSession.filterManager.popFilter(),spriteBatch.start()}else for(renderSession.spriteBatch.render(this),i=0,j=this.children.length;j>i;i++)this.children[i]._renderWebGL(renderSession)}},PIXI.Sprite.prototype._renderCanvas=function(renderSession){if(!(this.visible===!1||0===this.alpha||this.texture.crop.width<=0||this.texture.crop.height<=0)){if(this.blendMode!==renderSession.currentBlendMode&&(renderSession.currentBlendMode=this.blendMode,renderSession.context.globalCompositeOperation=PIXI.blendModesCanvas[renderSession.currentBlendMode]),this._mask&&renderSession.maskManager.pushMask(this._mask,renderSession),this.texture.valid){var resolution=this.texture.baseTexture.resolution/renderSession.resolution;renderSession.context.globalAlpha=this.worldAlpha,renderSession.smoothProperty&&renderSession.scaleMode!==this.texture.baseTexture.scaleMode&&(renderSession.scaleMode=this.texture.baseTexture.scaleMode,renderSession.context[renderSession.smoothProperty]=renderSession.scaleMode===PIXI.scaleModes.LINEAR);var dx=this.texture.trim?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width,dy=this.texture.trim?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height;renderSession.roundPixels?(renderSession.context.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*renderSession.resolution|0,this.worldTransform.ty*renderSession.resolution|0),dx=0|dx,dy=0|dy):renderSession.context.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*renderSession.resolution,this.worldTransform.ty*renderSession.resolution),16777215!==this.tint?(this.cachedTint!==this.tint&&(this.cachedTint=this.tint,this.tintedTexture=PIXI.CanvasTinter.getTintedTexture(this,this.tint)),renderSession.context.drawImage(this.tintedTexture,0,0,this.texture.crop.width,this.texture.crop.height,dx/resolution,dy/resolution,this.texture.crop.width/resolution,this.texture.crop.height/resolution)):renderSession.context.drawImage(this.texture.baseTexture.source,this.texture.crop.x,this.texture.crop.y,this.texture.crop.width,this.texture.crop.height,dx/resolution,dy/resolution,this.texture.crop.width/resolution,this.texture.crop.height/resolution)}for(var i=0,j=this.children.length;j>i;i++)this.children[i]._renderCanvas(renderSession);this._mask&&renderSession.maskManager.popMask(renderSession)}},PIXI.Sprite.fromFrame=function(frameId){var texture=PIXI.TextureCache[frameId];if(!texture)throw new Error('The frameId "'+frameId+'" does not exist in the texture cache'+this);return new PIXI.Sprite(texture)},PIXI.Sprite.fromImage=function(imageId,crossorigin,scaleMode){var texture=PIXI.Texture.fromImage(imageId,crossorigin,scaleMode);return new PIXI.Sprite(texture)},PIXI.SpriteBatch=function(texture){PIXI.DisplayObjectContainer.call(this),this.textureThing=texture,this.ready=!1},PIXI.SpriteBatch.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),PIXI.SpriteBatch.prototype.constructor=PIXI.SpriteBatch,PIXI.SpriteBatch.prototype.initWebGL=function(gl){this.fastSpriteBatch=new PIXI.WebGLFastSpriteBatch(gl),this.ready=!0},PIXI.SpriteBatch.prototype.updateTransform=function(){this.displayObjectUpdateTransform()},PIXI.SpriteBatch.prototype._renderWebGL=function(renderSession){!this.visible||this.alpha<=0||!this.children.length||(this.ready||this.initWebGL(renderSession.gl),this.fastSpriteBatch.gl!==renderSession.gl&&this.fastSpriteBatch.setContext(renderSession.gl),renderSession.spriteBatch.stop(),renderSession.shaderManager.setShader(renderSession.shaderManager.fastShader),this.fastSpriteBatch.begin(this,renderSession),this.fastSpriteBatch.render(this),renderSession.spriteBatch.start())},PIXI.SpriteBatch.prototype._renderCanvas=function(renderSession){if(this.visible&&!(this.alpha<=0)&&this.children.length){var context=renderSession.context;context.globalAlpha=this.worldAlpha,this.displayObjectUpdateTransform();for(var transform=this.worldTransform,isRotated=!0,i=0;i<this.children.length;i++){var child=this.children[i];if(child.visible){var texture=child.texture,frame=texture.frame;if(context.globalAlpha=this.worldAlpha*child.alpha,child.rotation%(2*Math.PI)===0)isRotated&&(context.setTransform(transform.a,transform.b,transform.c,transform.d,transform.tx,transform.ty),isRotated=!1),context.drawImage(texture.baseTexture.source,frame.x,frame.y,frame.width,frame.height,child.anchor.x*-frame.width*child.scale.x+child.position.x+.5|0,child.anchor.y*-frame.height*child.scale.y+child.position.y+.5|0,frame.width*child.scale.x,frame.height*child.scale.y);else{isRotated||(isRotated=!0),child.displayObjectUpdateTransform();var childTransform=child.worldTransform;renderSession.roundPixels?context.setTransform(childTransform.a,childTransform.b,childTransform.c,childTransform.d,0|childTransform.tx,0|childTransform.ty):context.setTransform(childTransform.a,childTransform.b,childTransform.c,childTransform.d,childTransform.tx,childTransform.ty),context.drawImage(texture.baseTexture.source,frame.x,frame.y,frame.width,frame.height,child.anchor.x*-frame.width+.5|0,child.anchor.y*-frame.height+.5|0,frame.width,frame.height)}}}}},PIXI.MovieClip=function(textures){PIXI.Sprite.call(this,textures[0]),this.textures=textures,this.animationSpeed=1,this.loop=!0,this.onComplete=null,this.currentFrame=0,this.playing=!1},PIXI.MovieClip.prototype=Object.create(PIXI.Sprite.prototype),PIXI.MovieClip.prototype.constructor=PIXI.MovieClip,Object.defineProperty(PIXI.MovieClip.prototype,"totalFrames",{get:function(){return this.textures.length}}),PIXI.MovieClip.prototype.stop=function(){this.playing=!1},PIXI.MovieClip.prototype.play=function(){this.playing=!0},PIXI.MovieClip.prototype.gotoAndStop=function(frameNumber){this.playing=!1,this.currentFrame=frameNumber;var round=this.currentFrame+.5|0;this.setTexture(this.textures[round%this.textures.length])},PIXI.MovieClip.prototype.gotoAndPlay=function(frameNumber){this.currentFrame=frameNumber,this.playing=!0},PIXI.MovieClip.prototype.updateTransform=function(){if(this.displayObjectContainerUpdateTransform(),this.playing){this.currentFrame+=this.animationSpeed;var round=this.currentFrame+.5|0;this.currentFrame=this.currentFrame%this.textures.length,this.loop||round<this.textures.length?this.setTexture(this.textures[round%this.textures.length]):round>=this.textures.length&&(this.gotoAndStop(this.textures.length-1),this.onComplete&&this.onComplete())}},PIXI.MovieClip.fromFrames=function(frames){for(var textures=[],i=0;i<frames.length;i++)textures.push(new PIXI.Texture.fromFrame(frames[i]));return new PIXI.MovieClip(textures)},PIXI.MovieClip.fromImages=function(images){for(var textures=[],i=0;i<images.length;i++)textures.push(new PIXI.Texture.fromImage(images[i]));return new PIXI.MovieClip(textures)},PIXI.FilterBlock=function(){this.visible=!0,this.renderable=!0},PIXI.FilterBlock.prototype.constructor=PIXI.FilterBlock,PIXI.Text=function(text,style){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.resolution=1,PIXI.Sprite.call(this,PIXI.Texture.fromCanvas(this.canvas)),this.setText(text),this.setStyle(style)},PIXI.Text.prototype=Object.create(PIXI.Sprite.prototype),PIXI.Text.prototype.constructor=PIXI.Text,Object.defineProperty(PIXI.Text.prototype,"width",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.x*this.texture.frame.width},set:function(value){this.scale.x=value/this.texture.frame.width,this._width=value}}),Object.defineProperty(PIXI.Text.prototype,"height",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.y*this.texture.frame.height},set:function(value){this.scale.y=value/this.texture.frame.height,this._height=value}}),PIXI.Text.prototype.setStyle=function(style){style=style||{},style.font=style.font||"bold 20pt Arial",style.fill=style.fill||"black",style.align=style.align||"left",style.stroke=style.stroke||"black",style.strokeThickness=style.strokeThickness||0,style.wordWrap=style.wordWrap||!1,style.wordWrapWidth=style.wordWrapWidth||100,style.dropShadow=style.dropShadow||!1,style.dropShadowAngle=style.dropShadowAngle||Math.PI/6,style.dropShadowDistance=style.dropShadowDistance||4,style.dropShadowColor=style.dropShadowColor||"black",style.lineJoin=style.lineJoin||"miter",style.lineHeight=style.lineHeight||!1,this.style=style,this.dirty=!0},PIXI.Text.prototype.setText=function(text){this.text=text.toString()||" ",this.dirty=!0},PIXI.Text.prototype.updateText=function(){this.texture.baseTexture.resolution=this.resolution,this.context.font=this.style.font;var outputText=this.text;this.style.wordWrap&&(outputText=this.wordWrap(this.text));for(var lines=outputText.split(/(?:\r\n|\r|\n)/),lineWidths=[],maxLineWidth=0,fontProperties=this.determineFontProperties(this.style.font),i=0;i<lines.length;i++){var lineWidth=this.context.measureText(lines[i]).width;lineWidths[i]=lineWidth,maxLineWidth=Math.max(maxLineWidth,lineWidth)}var width=maxLineWidth+this.style.strokeThickness;this.style.dropShadow&&(width+=this.style.dropShadowDistance),this.canvas.width=(width+this.context.lineWidth)*this.resolution;var lineHeight=this.style.lineHeight||fontProperties.fontSize+this.style.strokeThickness,height=lineHeight*lines.length;this.style.dropShadow&&(height+=this.style.dropShadowDistance),this.canvas.height=height*this.resolution,this.context.scale(this.resolution,this.resolution),navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.font=this.style.font,this.context.strokeStyle=this.style.stroke,this.context.lineWidth=this.style.strokeThickness,this.context.textBaseline="alphabetic",this.context.lineJoin=this.style.lineJoin;var linePositionX,linePositionY;if(this.style.dropShadow){this.context.fillStyle=this.style.dropShadowColor;var xShadowOffset=Math.sin(this.style.dropShadowAngle)*this.style.dropShadowDistance,yShadowOffset=Math.cos(this.style.dropShadowAngle)*this.style.dropShadowDistance;for(i=0;i<lines.length;i++)linePositionX=this.style.strokeThickness/2,linePositionY=this.style.strokeThickness/2+i*lineHeight+fontProperties.ascent,"right"===this.style.align?linePositionX+=maxLineWidth-lineWidths[i]:"center"===this.style.align&&(linePositionX+=(maxLineWidth-lineWidths[i])/2),
this.style.fill&&this.context.fillText(lines[i],linePositionX+xShadowOffset,linePositionY+yShadowOffset)}for(this.context.fillStyle=this.style.fill,i=0;i<lines.length;i++)linePositionX=this.style.strokeThickness/2,linePositionY=this.style.strokeThickness/2+i*lineHeight+fontProperties.ascent,"right"===this.style.align?linePositionX+=maxLineWidth-lineWidths[i]:"center"===this.style.align&&(linePositionX+=(maxLineWidth-lineWidths[i])/2),this.style.stroke&&this.style.strokeThickness&&this.context.strokeText(lines[i],linePositionX,linePositionY),this.style.fill&&this.context.fillText(lines[i],linePositionX,linePositionY);this.updateTexture()},PIXI.Text.prototype.updateTexture=function(){this.texture.baseTexture.width=this.canvas.width,this.texture.baseTexture.height=this.canvas.height,this.texture.crop.width=this.texture.frame.width=this.canvas.width,this.texture.crop.height=this.texture.frame.height=this.canvas.height,this._width=this.canvas.width,this._height=this.canvas.height,this.texture.baseTexture.dirty()},PIXI.Text.prototype._renderWebGL=function(renderSession){this.dirty&&(this.resolution=renderSession.resolution,this.updateText(),this.dirty=!1),PIXI.Sprite.prototype._renderWebGL.call(this,renderSession)},PIXI.Text.prototype._renderCanvas=function(renderSession){this.dirty&&(this.resolution=renderSession.resolution,this.updateText(),this.dirty=!1),PIXI.Sprite.prototype._renderCanvas.call(this,renderSession)},PIXI.Text.prototype.determineFontProperties=function(fontStyle){var properties=PIXI.Text.fontPropertiesCache[fontStyle];if(!properties){properties={};var canvas=PIXI.Text.fontPropertiesCanvas,context=PIXI.Text.fontPropertiesContext;context.font=fontStyle;var width=Math.ceil(context.measureText("|Mq").width),baseline=Math.ceil(context.measureText("M").width),height=2*baseline;baseline=1.4*baseline|0,canvas.width=width,canvas.height=height,context.fillStyle="#f00",context.fillRect(0,0,width,height),context.font=fontStyle,context.textBaseline="alphabetic",context.fillStyle="#000",context.fillText("|MÉq",0,baseline);var i,j,imagedata=context.getImageData(0,0,width,height).data,pixels=imagedata.length,line=4*width,idx=0,stop=!1;for(i=0;baseline>i;i++){for(j=0;line>j;j+=4)if(255!==imagedata[idx+j]){stop=!0;break}if(stop)break;idx+=line}for(properties.ascent=baseline-i,idx=pixels-line,stop=!1,i=height;i>baseline;i--){for(j=0;line>j;j+=4)if(255!==imagedata[idx+j]){stop=!0;break}if(stop)break;idx-=line}properties.descent=i-baseline,properties.descent+=6,properties.fontSize=properties.ascent+properties.descent,PIXI.Text.fontPropertiesCache[fontStyle]=properties}return properties},PIXI.Text.prototype.wordWrap=function(text){for(var result="",lines=text.split("\n"),i=0;i<lines.length;i++){for(var spaceLeft=this.style.wordWrapWidth,words=lines[i].split(" "),j=0;j<words.length;j++){var wordWidth=this.context.measureText(words[j]).width,wordWidthWithSpace=wordWidth+this.context.measureText(" ").width;0===j||wordWidthWithSpace>spaceLeft?(j>0&&(result+="\n"),result+=words[j],spaceLeft=this.style.wordWrapWidth-wordWidth):(spaceLeft-=wordWidthWithSpace,result+=" "+words[j])}i<lines.length-1&&(result+="\n")}return result},PIXI.Text.prototype.getBounds=function(matrix){return this.dirty&&(this.updateText(),this.dirty=!1),PIXI.Sprite.prototype.getBounds.call(this,matrix)},PIXI.Text.prototype.destroy=function(destroyBaseTexture){this.context=null,this.canvas=null,this.texture.destroy(void 0===destroyBaseTexture?!0:destroyBaseTexture)},PIXI.Text.fontPropertiesCache={},PIXI.Text.fontPropertiesCanvas=document.createElement("canvas"),PIXI.Text.fontPropertiesContext=PIXI.Text.fontPropertiesCanvas.getContext("2d"),PIXI.BitmapText=function(text,style){PIXI.DisplayObjectContainer.call(this),this.textWidth=0,this.textHeight=0,this._pool=[],this.setText(text),this.setStyle(style),this.updateText(),this.dirty=!1},PIXI.BitmapText.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),PIXI.BitmapText.prototype.constructor=PIXI.BitmapText,PIXI.BitmapText.prototype.setText=function(text){this.text=text||" ",this.dirty=!0},PIXI.BitmapText.prototype.setStyle=function(style){style=style||{},style.align=style.align||"left",this.style=style;var font=style.font.split(" ");this.fontName=font[font.length-1],this.fontSize=font.length>=2?parseInt(font[font.length-2],10):PIXI.BitmapText.fonts[this.fontName].size,this.dirty=!0,this.tint=style.tint},PIXI.BitmapText.prototype.updateText=function(){for(var data=PIXI.BitmapText.fonts[this.fontName],pos=new PIXI.Point,prevCharCode=null,chars=[],maxLineWidth=0,lineWidths=[],line=0,scale=this.fontSize/data.size,i=0;i<this.text.length;i++){var charCode=this.text.charCodeAt(i);if(/(?:\r\n|\r|\n)/.test(this.text.charAt(i)))lineWidths.push(pos.x),maxLineWidth=Math.max(maxLineWidth,pos.x),line++,pos.x=0,pos.y+=data.lineHeight,prevCharCode=null;else{var charData=data.chars[charCode];charData&&(prevCharCode&&charData.kerning[prevCharCode]&&(pos.x+=charData.kerning[prevCharCode]),chars.push({texture:charData.texture,line:line,charCode:charCode,position:new PIXI.Point(pos.x+charData.xOffset,pos.y+charData.yOffset)}),pos.x+=charData.xAdvance,prevCharCode=charCode)}}lineWidths.push(pos.x),maxLineWidth=Math.max(maxLineWidth,pos.x);var lineAlignOffsets=[];for(i=0;line>=i;i++){var alignOffset=0;"right"===this.style.align?alignOffset=maxLineWidth-lineWidths[i]:"center"===this.style.align&&(alignOffset=(maxLineWidth-lineWidths[i])/2),lineAlignOffsets.push(alignOffset)}var lenChildren=this.children.length,lenChars=chars.length,tint=this.tint||16777215;for(i=0;lenChars>i;i++){var c=lenChildren>i?this.children[i]:this._pool.pop();c?c.setTexture(chars[i].texture):c=new PIXI.Sprite(chars[i].texture),c.position.x=(chars[i].position.x+lineAlignOffsets[chars[i].line])*scale,c.position.y=chars[i].position.y*scale,c.scale.x=c.scale.y=scale,c.tint=tint,c.parent||this.addChild(c)}for(;this.children.length>lenChars;){var child=this.getChildAt(this.children.length-1);this._pool.push(child),this.removeChild(child)}this.textWidth=maxLineWidth*scale,this.textHeight=(pos.y+data.lineHeight)*scale},PIXI.BitmapText.prototype.updateTransform=function(){this.dirty&&(this.updateText(),this.dirty=!1),PIXI.DisplayObjectContainer.prototype.updateTransform.call(this)},PIXI.BitmapText.fonts={},PIXI.InteractionData=function(){this.global=new PIXI.Point,this.target=null,this.originalEvent=null},PIXI.InteractionData.prototype.getLocalPosition=function(displayObject,point,globalPos){var worldTransform=displayObject.worldTransform,global=globalPos?globalPos:this.global,a00=worldTransform.a,a01=worldTransform.c,a02=worldTransform.tx,a10=worldTransform.b,a11=worldTransform.d,a12=worldTransform.ty,id=1/(a00*a11+a01*-a10);return point=point||new PIXI.Point,point.x=a11*id*global.x+-a01*id*global.y+(a12*a01-a02*a11)*id,point.y=a00*id*global.y+-a10*id*global.x+(-a12*a00+a02*a10)*id,point},PIXI.InteractionData.prototype.constructor=PIXI.InteractionData,PIXI.InteractionManager=function(stage){this.stage=stage,this.mouse=new PIXI.InteractionData,this.touches={},this.tempPoint=new PIXI.Point,this.mouseoverEnabled=!0,this.pool=[],this.interactiveItems=[],this.interactionDOMElement=null,this.onMouseMove=this.onMouseMove.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseOut=this.onMouseOut.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onTouchCancel=this.onTouchCancel.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.last=0,this.currentCursorStyle="inherit",this.mouseOut=!1,this.resolution=1,this._tempPoint=new PIXI.Point},PIXI.InteractionManager.prototype.constructor=PIXI.InteractionManager,PIXI.InteractionManager.prototype.collectInteractiveSprite=function(displayObject,iParent){for(var children=displayObject.children,length=children.length,i=length-1;i>=0;i--){var child=children[i];child._interactive?(iParent.interactiveChildren=!0,this.interactiveItems.push(child),child.children.length>0&&this.collectInteractiveSprite(child,child)):(child.__iParent=null,child.children.length>0&&this.collectInteractiveSprite(child,iParent))}},PIXI.InteractionManager.prototype.setTarget=function(target){this.target=target,this.resolution=target.resolution,null===this.interactionDOMElement&&this.setTargetDomElement(target.view)},PIXI.InteractionManager.prototype.setTargetDomElement=function(domElement){this.removeEvents(),window.navigator.msPointerEnabled&&(domElement.style["-ms-content-zooming"]="none",domElement.style["-ms-touch-action"]="none"),this.interactionDOMElement=domElement,domElement.addEventListener("mousemove",this.onMouseMove,!0),domElement.addEventListener("mousedown",this.onMouseDown,!0),domElement.addEventListener("mouseout",this.onMouseOut,!0),domElement.addEventListener("touchstart",this.onTouchStart,!0),domElement.addEventListener("touchend",this.onTouchEnd,!0),domElement.addEventListener("touchleave",this.onTouchCancel,!0),domElement.addEventListener("touchcancel",this.onTouchCancel,!0),domElement.addEventListener("touchmove",this.onTouchMove,!0),window.addEventListener("mouseup",this.onMouseUp,!0)},PIXI.InteractionManager.prototype.removeEvents=function(){this.interactionDOMElement&&(this.interactionDOMElement.style["-ms-content-zooming"]="",this.interactionDOMElement.style["-ms-touch-action"]="",this.interactionDOMElement.removeEventListener("mousemove",this.onMouseMove,!0),this.interactionDOMElement.removeEventListener("mousedown",this.onMouseDown,!0),this.interactionDOMElement.removeEventListener("mouseout",this.onMouseOut,!0),this.interactionDOMElement.removeEventListener("touchstart",this.onTouchStart,!0),this.interactionDOMElement.removeEventListener("touchend",this.onTouchEnd,!0),this.interactionDOMElement.removeEventListener("touchleave",this.onTouchCancel,!0),this.interactionDOMElement.removeEventListener("touchcancel",this.onTouchCancel,!0),this.interactionDOMElement.removeEventListener("touchmove",this.onTouchMove,!0),this.interactionDOMElement=null,window.removeEventListener("mouseup",this.onMouseUp,!0))},PIXI.InteractionManager.prototype.update=function(){if(this.target){var now=Date.now(),diff=now-this.last;if(diff=diff*PIXI.INTERACTION_FREQUENCY/1e3,!(1>diff)){this.last=now;var i=0;this.dirty&&this.rebuildInteractiveGraph();var length=this.interactiveItems.length,cursor="inherit",over=!1;for(i=0;length>i;i++){var item=this.interactiveItems[i];item.__hit=this.hitTest(item,this.mouse),this.mouse.target=item,item.__hit&&!over?(item.buttonMode&&(cursor=item.defaultCursor),item.interactiveChildren||(over=!0),item.__isOver||(item.mouseover&&item.mouseover(this.mouse),item.__isOver=!0)):item.__isOver&&(item.mouseout&&item.mouseout(this.mouse),item.__isOver=!1)}this.currentCursorStyle!==cursor&&(this.currentCursorStyle=cursor,this.interactionDOMElement.style.cursor=cursor)}}},PIXI.InteractionManager.prototype.rebuildInteractiveGraph=function(){this.dirty=!1;for(var len=this.interactiveItems.length,i=0;len>i;i++)this.interactiveItems[i].interactiveChildren=!1;this.interactiveItems=[],this.stage.interactive&&this.interactiveItems.push(this.stage),this.collectInteractiveSprite(this.stage,this.stage)},PIXI.InteractionManager.prototype.onMouseMove=function(event){this.dirty&&this.rebuildInteractiveGraph(),this.mouse.originalEvent=event;var rect=this.interactionDOMElement.getBoundingClientRect();this.mouse.global.x=(event.clientX-rect.left)*(this.target.width/rect.width)/this.resolution,this.mouse.global.y=(event.clientY-rect.top)*(this.target.height/rect.height)/this.resolution;for(var length=this.interactiveItems.length,i=0;length>i;i++){var item=this.interactiveItems[i];item.mousemove&&item.mousemove(this.mouse)}},PIXI.InteractionManager.prototype.onMouseDown=function(event){this.dirty&&this.rebuildInteractiveGraph(),this.mouse.originalEvent=event,PIXI.AUTO_PREVENT_DEFAULT&&this.mouse.originalEvent.preventDefault();for(var length=this.interactiveItems.length,e=this.mouse.originalEvent,isRightButton=2===e.button||3===e.which,downFunction=isRightButton?"rightdown":"mousedown",clickFunction=isRightButton?"rightclick":"click",buttonIsDown=isRightButton?"__rightIsDown":"__mouseIsDown",isDown=isRightButton?"__isRightDown":"__isDown",i=0;length>i;i++){var item=this.interactiveItems[i];if((item[downFunction]||item[clickFunction])&&(item[buttonIsDown]=!0,item.__hit=this.hitTest(item,this.mouse),item.__hit&&(item[downFunction]&&item[downFunction](this.mouse),item[isDown]=!0,!item.interactiveChildren)))break}},PIXI.InteractionManager.prototype.onMouseOut=function(event){this.dirty&&this.rebuildInteractiveGraph(),this.mouse.originalEvent=event;var length=this.interactiveItems.length;this.interactionDOMElement.style.cursor="inherit";for(var i=0;length>i;i++){var item=this.interactiveItems[i];item.__isOver&&(this.mouse.target=item,item.mouseout&&item.mouseout(this.mouse),item.__isOver=!1)}this.mouseOut=!0,this.mouse.global.x=-1e4,this.mouse.global.y=-1e4},PIXI.InteractionManager.prototype.onMouseUp=function(event){this.dirty&&this.rebuildInteractiveGraph(),this.mouse.originalEvent=event;for(var length=this.interactiveItems.length,up=!1,e=this.mouse.originalEvent,isRightButton=2===e.button||3===e.which,upFunction=isRightButton?"rightup":"mouseup",clickFunction=isRightButton?"rightclick":"click",upOutsideFunction=isRightButton?"rightupoutside":"mouseupoutside",isDown=isRightButton?"__isRightDown":"__isDown",i=0;length>i;i++){var item=this.interactiveItems[i];(item[clickFunction]||item[upFunction]||item[upOutsideFunction])&&(item.__hit=this.hitTest(item,this.mouse),item.__hit&&!up?(item[upFunction]&&item[upFunction](this.mouse),item[isDown]&&item[clickFunction]&&item[clickFunction](this.mouse),item.interactiveChildren||(up=!0)):item[isDown]&&item[upOutsideFunction]&&item[upOutsideFunction](this.mouse),item[isDown]=!1)}},PIXI.InteractionManager.prototype.hitTest=function(item,interactionData){var global=interactionData.global;if(!item.worldVisible)return!1;item.worldTransform.applyInverse(global,this._tempPoint);var i,x=this._tempPoint.x,y=this._tempPoint.y;if(interactionData.target=item,item.hitArea&&item.hitArea.contains)return item.hitArea.contains(x,y);if(item instanceof PIXI.Sprite){var y1,width=item.texture.frame.width,height=item.texture.frame.height,x1=-width*item.anchor.x;if(x>x1&&x1+width>x&&(y1=-height*item.anchor.y,y>y1&&y1+height>y))return!0}else if(item instanceof PIXI.Graphics){var graphicsData=item.graphicsData;for(i=0;i<graphicsData.length;i++){var data=graphicsData[i];if(data.fill&&data.shape&&data.shape.contains(x,y))return!0}}var length=item.children.length;for(i=0;length>i;i++){var tempItem=item.children[i],hit=this.hitTest(tempItem,interactionData);if(hit)return interactionData.target=item,!0}return!1},PIXI.InteractionManager.prototype.onTouchMove=function(event){this.dirty&&this.rebuildInteractiveGraph();for(var touchData,touchEvent,rect=this.interactionDOMElement.getBoundingClientRect(),changedTouches=event.changedTouches,cLength=changedTouches.length,wCalc=this.target.width/rect.width,hCalc=this.target.height/rect.height,isSupportCocoonJS=navigator.isCocoonJS&&!rect.left&&!rect.top&&!event.target.style.width&&!event.target.style.height,c=0;cLength>c;c++)touchEvent=changedTouches[c],isSupportCocoonJS?(touchEvent.globalX=touchEvent.clientX,touchEvent.globalY=touchEvent.clientY):(touchEvent.globalX=(touchEvent.clientX-rect.left)*wCalc/this.resolution,touchEvent.globalY=(touchEvent.clientY-rect.top)*hCalc/this.resolution);for(var i=0;cLength>i;i++){touchEvent=changedTouches[i],touchData=this.touches[touchEvent.identifier],touchData.originalEvent=event,isSupportCocoonJS?(touchData.global.x=touchEvent.clientX,touchData.global.y=touchEvent.clientY):(touchEvent.globalX=touchData.global.x=(touchEvent.clientX-rect.left)*wCalc/this.resolution,touchEvent.globalY=touchData.global.y=(touchEvent.clientY-rect.top)*hCalc/this.resolution);for(var j=0;j<this.interactiveItems.length;j++){var item=this.interactiveItems[j];item.touchmove&&item.__touchData&&item.__touchData[touchEvent.identifier]&&item.touchmove(touchData)}}},PIXI.InteractionManager.prototype.onTouchStart=function(event){this.dirty&&this.rebuildInteractiveGraph();var rect=this.interactionDOMElement.getBoundingClientRect();PIXI.AUTO_PREVENT_DEFAULT&&event.preventDefault();for(var touchEvent,changedTouches=event.changedTouches,cLength=changedTouches.length,wCalc=this.target.width/rect.width,hCalc=this.target.height/rect.height,isSupportCocoonJS=navigator.isCocoonJS&&!rect.left&&!rect.top&&!event.target.style.width&&!event.target.style.height,c=0;cLength>c;c++)touchEvent=changedTouches[c],isSupportCocoonJS?(touchEvent.globalX=touchEvent.clientX,touchEvent.globalY=touchEvent.clientY):(touchEvent.globalX=(touchEvent.clientX-rect.left)*wCalc/this.resolution,touchEvent.globalY=(touchEvent.clientY-rect.top)*hCalc/this.resolution);for(var i=0;cLength>i;i++){touchEvent=changedTouches[i];var touchData=this.pool.pop();touchData||(touchData=new PIXI.InteractionData),touchData.originalEvent=event,this.touches[touchEvent.identifier]=touchData,isSupportCocoonJS?(touchData.global.x=touchEvent.clientX,touchData.global.y=touchEvent.clientY):(touchData.global.x=(touchEvent.clientX-rect.left)*wCalc/this.resolution,touchData.global.y=(touchEvent.clientY-rect.top)*hCalc/this.resolution);for(var length=this.interactiveItems.length,j=0;length>j;j++){var item=this.interactiveItems[j];if((item.touchstart||item.tap)&&(item.__hit=this.hitTest(item,touchData),item.__hit&&(item.touchstart&&item.touchstart(touchData),item.__isDown=!0,item.__touchData=item.__touchData||{},item.__touchData[touchEvent.identifier]=touchData,!item.interactiveChildren)))break}}},PIXI.InteractionManager.prototype.onTouchEnd=function(event){this.dirty&&this.rebuildInteractiveGraph();for(var touchEvent,rect=this.interactionDOMElement.getBoundingClientRect(),changedTouches=event.changedTouches,cLength=changedTouches.length,wCalc=this.target.width/rect.width,hCalc=this.target.height/rect.height,isSupportCocoonJS=navigator.isCocoonJS&&!rect.left&&!rect.top&&!event.target.style.width&&!event.target.style.height,c=0;cLength>c;c++)touchEvent=changedTouches[c],isSupportCocoonJS?(touchEvent.globalX=touchEvent.clientX,touchEvent.globalY=touchEvent.clientY):(touchEvent.globalX=(touchEvent.clientX-rect.left)*wCalc/this.resolution,touchEvent.globalY=(touchEvent.clientY-rect.top)*hCalc/this.resolution);for(var i=0;cLength>i;i++){touchEvent=changedTouches[i];var touchData=this.touches[touchEvent.identifier],up=!1;isSupportCocoonJS?(touchData.global.x=touchEvent.clientX,touchData.global.y=touchEvent.clientY):(touchData.global.x=(touchEvent.clientX-rect.left)*wCalc/this.resolution,touchData.global.y=(touchEvent.clientY-rect.top)*hCalc/this.resolution);for(var length=this.interactiveItems.length,j=0;length>j;j++){var item=this.interactiveItems[j];item.__touchData&&item.__touchData[touchEvent.identifier]&&(item.__hit=this.hitTest(item,item.__touchData[touchEvent.identifier]),touchData.originalEvent=event,(item.touchend||item.tap)&&(item.__hit&&!up?(item.touchend&&item.touchend(touchData),item.__isDown&&item.tap&&item.tap(touchData),item.interactiveChildren||(up=!0)):item.__isDown&&item.touchendoutside&&item.touchendoutside(touchData),item.__isDown=!1),item.__touchData[touchEvent.identifier]=null)}this.pool.push(touchData),this.touches[touchEvent.identifier]=null}},PIXI.InteractionManager.prototype.onTouchCancel=function(event){this.dirty&&this.rebuildInteractiveGraph();for(var touchEvent,rect=this.interactionDOMElement.getBoundingClientRect(),changedTouches=event.changedTouches,cLength=changedTouches.length,wCalc=this.target.width/rect.width,hCalc=this.target.height/rect.height,isSupportCocoonJS=navigator.isCocoonJS&&!rect.left&&!rect.top&&!event.target.style.width&&!event.target.style.height,c=0;cLength>c;c++)touchEvent=changedTouches[c],isSupportCocoonJS?(touchEvent.globalX=touchEvent.clientX,touchEvent.globalY=touchEvent.clientY):(touchEvent.globalX=(touchEvent.clientX-rect.left)*wCalc/this.resolution,touchEvent.globalY=(touchEvent.clientY-rect.top)*hCalc/this.resolution);for(var i=0;cLength>i;i++){touchEvent=changedTouches[i];var touchData=this.touches[touchEvent.identifier],up=!1;isSupportCocoonJS?(touchData.global.x=touchEvent.clientX,touchData.global.y=touchEvent.clientY):(touchData.global.x=(touchEvent.clientX-rect.left)*wCalc/this.resolution,touchData.global.y=(touchEvent.clientY-rect.top)*hCalc/this.resolution);for(var length=this.interactiveItems.length,j=0;length>j;j++){var item=this.interactiveItems[j];item.__touchData&&item.__touchData[touchEvent.identifier]&&(item.__hit=this.hitTest(item,item.__touchData[touchEvent.identifier]),touchData.originalEvent=event,item.touchcancel&&!up&&(item.touchcancel(touchData),item.interactiveChildren||(up=!0)),item.__isDown=!1,item.__touchData[touchEvent.identifier]=null)}this.pool.push(touchData),this.touches[touchEvent.identifier]=null}},PIXI.Stage=function(backgroundColor){PIXI.DisplayObjectContainer.call(this),this.worldTransform=new PIXI.Matrix,this.interactive=!0,this.interactionManager=new PIXI.InteractionManager(this),this.dirty=!0,this.stage=this,this.stage.hitArea=new PIXI.Rectangle(0,0,1e5,1e5),this.setBackgroundColor(backgroundColor)},PIXI.Stage.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),PIXI.Stage.prototype.constructor=PIXI.Stage,PIXI.Stage.prototype.setInteractionDelegate=function(domElement){this.interactionManager.setTargetDomElement(domElement)},PIXI.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var i=0,j=this.children.length;j>i;i++)this.children[i].updateTransform();this.dirty&&(this.dirty=!1,this.interactionManager.dirty=!0),this.interactive&&this.interactionManager.update()},PIXI.Stage.prototype.setBackgroundColor=function(backgroundColor){this.backgroundColor=backgroundColor||0,this.backgroundColorSplit=PIXI.hex2rgb(this.backgroundColor);var hex=this.backgroundColor.toString(16);hex="000000".substr(0,6-hex.length)+hex,this.backgroundColorString="#"+hex},PIXI.Stage.prototype.getMousePosition=function(){return this.interactionManager.mouse.global},function(window){for(var lastTime=0,vendors=["ms","moz","webkit","o"],x=0;x<vendors.length&&!window.requestAnimationFrame;++x)window.requestAnimationFrame=window[vendors[x]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[vendors[x]+"CancelAnimationFrame"]||window[vendors[x]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(callback){var currTime=(new Date).getTime(),timeToCall=Math.max(0,16-(currTime-lastTime)),id=window.setTimeout(function(){callback(currTime+timeToCall)},timeToCall);return lastTime=currTime+timeToCall,id}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(id){clearTimeout(id)}),window.requestAnimFrame=window.requestAnimationFrame}(this),PIXI.hex2rgb=function(hex){return[(hex>>16&255)/255,(hex>>8&255)/255,(255&hex)/255]},PIXI.rgb2hex=function(rgb){return(255*rgb[0]<<16)+(255*rgb[1]<<8)+255*rgb[2]},"function"!=typeof Function.prototype.bind&&(Function.prototype.bind=function(){return function(thisArg){function bound(){for(var i=arguments.length,args=new Array(i);i--;)args[i]=arguments[i];return args=boundArgs.concat(args),target.apply(this instanceof bound?this:thisArg,args)}var target=this,i=arguments.length-1,boundArgs=[];if(i>0)for(boundArgs.length=i;i--;)boundArgs[i]=arguments[i+1];if("function"!=typeof target)throw new TypeError;return bound.prototype=function F(proto){return proto&&(F.prototype=proto),this instanceof F?void 0:new F}(target.prototype),bound}}()),PIXI.AjaxRequest=function(){var activexmodes=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Microsoft.XMLHTTP"];if(!window.ActiveXObject)return window.XMLHttpRequest?new window.XMLHttpRequest:!1;for(var i=0;i<activexmodes.length;i++)try{return new window.ActiveXObject(activexmodes[i])}catch(e){}},PIXI.canUseNewCanvasBlendModes=function(){if("undefined"==typeof document)return!1;var canvas=document.createElement("canvas");canvas.width=1,canvas.height=1;var context=canvas.getContext("2d");return context.fillStyle="#000",context.fillRect(0,0,1,1),context.globalCompositeOperation="multiply",context.fillStyle="#fff",context.fillRect(0,0,1,1),0===context.getImageData(0,0,1,1).data[0]},PIXI.getNextPowerOfTwo=function(number){if(number>0&&0===(number&number-1))return number;for(var result=1;number>result;)result<<=1;return result},PIXI.isPowerOfTwo=function(width,height){return width>0&&0===(width&width-1)&&height>0&&0===(height&height-1)},PIXI.EventTarget={call:function(obj){obj&&(obj=obj.prototype||obj,PIXI.EventTarget.mixin(obj))},mixin:function(obj){obj.listeners=function(eventName){return this._listeners=this._listeners||{},this._listeners[eventName]?this._listeners[eventName].slice():[]},obj.emit=obj.dispatchEvent=function(eventName,data){if(this._listeners=this._listeners||{},"object"==typeof eventName&&(data=eventName,eventName=eventName.type),data&&data.__isEventObject===!0||(data=new PIXI.Event(this,eventName,data)),this._listeners&&this._listeners[eventName]){var i,listeners=this._listeners[eventName].slice(0),length=listeners.length,fn=listeners[0];for(i=0;length>i;fn=listeners[++i])if(fn.call(this,data),data.stoppedImmediate)return this;if(data.stopped)return this}return this.parent&&this.parent.emit&&this.parent.emit.call(this.parent,eventName,data),this},obj.on=obj.addEventListener=function(eventName,fn){return this._listeners=this._listeners||{},(this._listeners[eventName]=this._listeners[eventName]||[]).push(fn),this},obj.once=function(eventName,fn){function onceHandlerWrapper(){fn.apply(self.off(eventName,onceHandlerWrapper),arguments)}this._listeners=this._listeners||{};var self=this;return onceHandlerWrapper._originalHandler=fn,this.on(eventName,onceHandlerWrapper)},obj.off=obj.removeEventListener=function(eventName,fn){if(this._listeners=this._listeners||{},!this._listeners[eventName])return this;for(var list=this._listeners[eventName],i=fn?list.length:0;i-->0;)(list[i]===fn||list[i]._originalHandler===fn)&&list.splice(i,1);return 0===list.length&&delete this._listeners[eventName],this},obj.removeAllListeners=function(eventName){return this._listeners=this._listeners||{},this._listeners[eventName]?(delete this._listeners[eventName],this):this}}},PIXI.Event=function(target,name,data){this.__isEventObject=!0,this.stopped=!1,this.stoppedImmediate=!1,this.target=target,this.type=name,this.data=data,this.content=data,this.timeStamp=Date.now()},PIXI.Event.prototype.stopPropagation=function(){this.stopped=!0},PIXI.Event.prototype.stopImmediatePropagation=function(){this.stoppedImmediate=!0},PIXI.autoDetectRenderer=function(width,height,options){width||(width=800),height||(height=600);var webgl=function(){try{var canvas=document.createElement("canvas");return!!window.WebGLRenderingContext&&(canvas.getContext("webgl")||canvas.getContext("experimental-webgl"))}catch(e){return!1}}();return webgl?new PIXI.WebGLRenderer(width,height,options):new PIXI.CanvasRenderer(width,height,options)},PIXI.autoDetectRecommendedRenderer=function(width,height,options){width||(width=800),height||(height=600);var webgl=function(){try{var canvas=document.createElement("canvas");return!!window.WebGLRenderingContext&&(canvas.getContext("webgl")||canvas.getContext("experimental-webgl"))}catch(e){return!1}}(),isAndroid=/Android/i.test(navigator.userAgent);return webgl&&!isAndroid?new PIXI.WebGLRenderer(width,height,options):new PIXI.CanvasRenderer(width,height,options)},PIXI.PolyK={},PIXI.PolyK.Triangulate=function(p){var sign=!0,n=p.length>>1;if(3>n)return[];for(var tgs=[],avl=[],i=0;n>i;i++)avl.push(i);i=0;for(var al=n;al>3;){var i0=avl[(i+0)%al],i1=avl[(i+1)%al],i2=avl[(i+2)%al],ax=p[2*i0],ay=p[2*i0+1],bx=p[2*i1],by=p[2*i1+1],cx=p[2*i2],cy=p[2*i2+1],earFound=!1;if(PIXI.PolyK._convex(ax,ay,bx,by,cx,cy,sign)){earFound=!0;for(var j=0;al>j;j++){var vi=avl[j];if(vi!==i0&&vi!==i1&&vi!==i2&&PIXI.PolyK._PointInTriangle(p[2*vi],p[2*vi+1],ax,ay,bx,by,cx,cy)){earFound=!1;break}}}if(earFound)tgs.push(i0,i1,i2),avl.splice((i+1)%al,1),al--,i=0;else if(i++>3*al){if(!sign)return null;for(tgs=[],avl=[],i=0;n>i;i++)avl.push(i);i=0,al=n,sign=!1}}return tgs.push(avl[0],avl[1],avl[2]),tgs},PIXI.PolyK._PointInTriangle=function(px,py,ax,ay,bx,by,cx,cy){var v0x=cx-ax,v0y=cy-ay,v1x=bx-ax,v1y=by-ay,v2x=px-ax,v2y=py-ay,dot00=v0x*v0x+v0y*v0y,dot01=v0x*v1x+v0y*v1y,dot02=v0x*v2x+v0y*v2y,dot11=v1x*v1x+v1y*v1y,dot12=v1x*v2x+v1y*v2y,invDenom=1/(dot00*dot11-dot01*dot01),u=(dot11*dot02-dot01*dot12)*invDenom,v=(dot00*dot12-dot01*dot02)*invDenom;return u>=0&&v>=0&&1>u+v},PIXI.PolyK._convex=function(ax,ay,bx,by,cx,cy,sign){return(ay-by)*(cx-bx)+(bx-ax)*(cy-by)>=0===sign},PIXI.initDefaultShaders=function(){},PIXI.CompileVertexShader=function(gl,shaderSrc){return PIXI._CompileShader(gl,shaderSrc,gl.VERTEX_SHADER)},PIXI.CompileFragmentShader=function(gl,shaderSrc){return PIXI._CompileShader(gl,shaderSrc,gl.FRAGMENT_SHADER)},PIXI._CompileShader=function(gl,shaderSrc,shaderType){var src=shaderSrc.join("\n"),shader=gl.createShader(shaderType);return gl.shaderSource(shader,src),gl.compileShader(shader),gl.getShaderParameter(shader,gl.COMPILE_STATUS)?shader:(window.console.log(gl.getShaderInfoLog(shader)),null)},PIXI.compileProgram=function(gl,vertexSrc,fragmentSrc){var fragmentShader=PIXI.CompileFragmentShader(gl,fragmentSrc),vertexShader=PIXI.CompileVertexShader(gl,vertexSrc),shaderProgram=gl.createProgram();return gl.attachShader(shaderProgram,vertexShader),gl.attachShader(shaderProgram,fragmentShader),gl.linkProgram(shaderProgram),gl.getProgramParameter(shaderProgram,gl.LINK_STATUS)||window.console.log("Could not initialise shaders"),shaderProgram},PIXI.PixiShader=function(gl){this._UID=PIXI._UID++,this.gl=gl,this.program=null,this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"],this.textureCount=0,this.firstRun=!0,this.dirty=!0,this.attributes=[],this.init()},PIXI.PixiShader.prototype.constructor=PIXI.PixiShader,PIXI.PixiShader.prototype.init=function(){var gl=this.gl,program=PIXI.compileProgram(gl,this.vertexSrc||PIXI.PixiShader.defaultVertexSrc,this.fragmentSrc);gl.useProgram(program),this.uSampler=gl.getUniformLocation(program,"uSampler"),this.projectionVector=gl.getUniformLocation(program,"projectionVector"),this.offsetVector=gl.getUniformLocation(program,"offsetVector"),this.dimensions=gl.getUniformLocation(program,"dimensions"),this.aVertexPosition=gl.getAttribLocation(program,"aVertexPosition"),this.aTextureCoord=gl.getAttribLocation(program,"aTextureCoord"),this.colorAttribute=gl.getAttribLocation(program,"aColor"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute];for(var key in this.uniforms)this.uniforms[key].uniformLocation=gl.getUniformLocation(program,key);this.initUniforms(),this.program=program},PIXI.PixiShader.prototype.initUniforms=function(){this.textureCount=1;var uniform,gl=this.gl;for(var key in this.uniforms){uniform=this.uniforms[key];var type=uniform.type;"sampler2D"===type?(uniform._init=!1,null!==uniform.value&&this.initSampler2D(uniform)):"mat2"===type||"mat3"===type||"mat4"===type?(uniform.glMatrix=!0,uniform.glValueLength=1,"mat2"===type?uniform.glFunc=gl.uniformMatrix2fv:"mat3"===type?uniform.glFunc=gl.uniformMatrix3fv:"mat4"===type&&(uniform.glFunc=gl.uniformMatrix4fv)):(uniform.glFunc=gl["uniform"+type],"2f"===type||"2i"===type?uniform.glValueLength=2:"3f"===type||"3i"===type?uniform.glValueLength=3:"4f"===type||"4i"===type?uniform.glValueLength=4:uniform.glValueLength=1)}},PIXI.PixiShader.prototype.initSampler2D=function(uniform){if(uniform.value&&uniform.value.baseTexture&&uniform.value.baseTexture.hasLoaded){var gl=this.gl;if(gl.activeTexture(gl["TEXTURE"+this.textureCount]),gl.bindTexture(gl.TEXTURE_2D,uniform.value.baseTexture._glTextures[gl.id]),
uniform.textureData){var data=uniform.textureData,magFilter=data.magFilter?data.magFilter:gl.LINEAR,minFilter=data.minFilter?data.minFilter:gl.LINEAR,wrapS=data.wrapS?data.wrapS:gl.CLAMP_TO_EDGE,wrapT=data.wrapT?data.wrapT:gl.CLAMP_TO_EDGE,format=data.luminance?gl.LUMINANCE:gl.RGBA;if(data.repeat&&(wrapS=gl.REPEAT,wrapT=gl.REPEAT),gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,!!data.flipY),data.width){var width=data.width?data.width:512,height=data.height?data.height:2,border=data.border?data.border:0;gl.texImage2D(gl.TEXTURE_2D,0,format,width,height,border,format,gl.UNSIGNED_BYTE,null)}else gl.texImage2D(gl.TEXTURE_2D,0,format,gl.RGBA,gl.UNSIGNED_BYTE,uniform.value.baseTexture.source);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,magFilter),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,minFilter),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,wrapS),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,wrapT)}gl.uniform1i(uniform.uniformLocation,this.textureCount),uniform._init=!0,this.textureCount++}},PIXI.PixiShader.prototype.syncUniforms=function(){this.textureCount=1;var uniform,gl=this.gl;for(var key in this.uniforms)uniform=this.uniforms[key],1===uniform.glValueLength?uniform.glMatrix===!0?uniform.glFunc.call(gl,uniform.uniformLocation,uniform.transpose,uniform.value):uniform.glFunc.call(gl,uniform.uniformLocation,uniform.value):2===uniform.glValueLength?uniform.glFunc.call(gl,uniform.uniformLocation,uniform.value.x,uniform.value.y):3===uniform.glValueLength?uniform.glFunc.call(gl,uniform.uniformLocation,uniform.value.x,uniform.value.y,uniform.value.z):4===uniform.glValueLength?uniform.glFunc.call(gl,uniform.uniformLocation,uniform.value.x,uniform.value.y,uniform.value.z,uniform.value.w):"sampler2D"===uniform.type&&(uniform._init?(gl.activeTexture(gl["TEXTURE"+this.textureCount]),uniform.value.baseTexture._dirty[gl.id]?PIXI.instances[gl.id].updateTexture(uniform.value.baseTexture):gl.bindTexture(gl.TEXTURE_2D,uniform.value.baseTexture._glTextures[gl.id]),gl.uniform1i(uniform.uniformLocation,this.textureCount),this.textureCount++):this.initSampler2D(uniform))},PIXI.PixiShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},PIXI.PixiShader.defaultVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","}"],PIXI.PixiFastShader=function(gl){this._UID=PIXI._UID++,this.gl=gl,this.program=null,this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aPositionCoord;","attribute vec2 aScale;","attribute float aRotation;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform mat3 uMatrix;","varying vec2 vTextureCoord;","varying float vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   vec2 v;","   vec2 sv = aVertexPosition * aScale;","   v.x = (sv.x) * cos(aRotation) - (sv.y) * sin(aRotation);","   v.y = (sv.x) * sin(aRotation) + (sv.y) * cos(aRotation);","   v = ( uMatrix * vec3(v + aPositionCoord , 1.0) ).xy ;","   gl_Position = vec4( ( v / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor;","}"],this.textureCount=0,this.init()},PIXI.PixiFastShader.prototype.constructor=PIXI.PixiFastShader,PIXI.PixiFastShader.prototype.init=function(){var gl=this.gl,program=PIXI.compileProgram(gl,this.vertexSrc,this.fragmentSrc);gl.useProgram(program),this.uSampler=gl.getUniformLocation(program,"uSampler"),this.projectionVector=gl.getUniformLocation(program,"projectionVector"),this.offsetVector=gl.getUniformLocation(program,"offsetVector"),this.dimensions=gl.getUniformLocation(program,"dimensions"),this.uMatrix=gl.getUniformLocation(program,"uMatrix"),this.aVertexPosition=gl.getAttribLocation(program,"aVertexPosition"),this.aPositionCoord=gl.getAttribLocation(program,"aPositionCoord"),this.aScale=gl.getAttribLocation(program,"aScale"),this.aRotation=gl.getAttribLocation(program,"aRotation"),this.aTextureCoord=gl.getAttribLocation(program,"aTextureCoord"),this.colorAttribute=gl.getAttribLocation(program,"aColor"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aPositionCoord,this.aScale,this.aRotation,this.aTextureCoord,this.colorAttribute],this.program=program},PIXI.PixiFastShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},PIXI.StripShader=function(gl){this._UID=PIXI._UID++,this.gl=gl,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * alpha;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","}"],this.init()},PIXI.StripShader.prototype.constructor=PIXI.StripShader,PIXI.StripShader.prototype.init=function(){var gl=this.gl,program=PIXI.compileProgram(gl,this.vertexSrc,this.fragmentSrc);gl.useProgram(program),this.uSampler=gl.getUniformLocation(program,"uSampler"),this.projectionVector=gl.getUniformLocation(program,"projectionVector"),this.offsetVector=gl.getUniformLocation(program,"offsetVector"),this.colorAttribute=gl.getAttribLocation(program,"aColor"),this.aVertexPosition=gl.getAttribLocation(program,"aVertexPosition"),this.aTextureCoord=gl.getAttribLocation(program,"aTextureCoord"),this.attributes=[this.aVertexPosition,this.aTextureCoord],this.translationMatrix=gl.getUniformLocation(program,"translationMatrix"),this.alpha=gl.getUniformLocation(program,"alpha"),this.program=program},PIXI.StripShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attribute=null},PIXI.PrimitiveShader=function(gl){this._UID=PIXI._UID++,this.gl=gl,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform float alpha;","uniform float flipY;","uniform vec3 tint;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"],this.init()},PIXI.PrimitiveShader.prototype.constructor=PIXI.PrimitiveShader,PIXI.PrimitiveShader.prototype.init=function(){var gl=this.gl,program=PIXI.compileProgram(gl,this.vertexSrc,this.fragmentSrc);gl.useProgram(program),this.projectionVector=gl.getUniformLocation(program,"projectionVector"),this.offsetVector=gl.getUniformLocation(program,"offsetVector"),this.tintColor=gl.getUniformLocation(program,"tint"),this.flipY=gl.getUniformLocation(program,"flipY"),this.aVertexPosition=gl.getAttribLocation(program,"aVertexPosition"),this.colorAttribute=gl.getAttribLocation(program,"aColor"),this.attributes=[this.aVertexPosition,this.colorAttribute],this.translationMatrix=gl.getUniformLocation(program,"translationMatrix"),this.alpha=gl.getUniformLocation(program,"alpha"),this.program=program},PIXI.PrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},PIXI.ComplexPrimitiveShader=function(gl){this._UID=PIXI._UID++,this.gl=gl,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform vec3 tint;","uniform float alpha;","uniform vec3 color;","uniform float flipY;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = vec4(color * alpha * tint, alpha);","}"],this.init()},PIXI.ComplexPrimitiveShader.prototype.constructor=PIXI.ComplexPrimitiveShader,PIXI.ComplexPrimitiveShader.prototype.init=function(){var gl=this.gl,program=PIXI.compileProgram(gl,this.vertexSrc,this.fragmentSrc);gl.useProgram(program),this.projectionVector=gl.getUniformLocation(program,"projectionVector"),this.offsetVector=gl.getUniformLocation(program,"offsetVector"),this.tintColor=gl.getUniformLocation(program,"tint"),this.color=gl.getUniformLocation(program,"color"),this.flipY=gl.getUniformLocation(program,"flipY"),this.aVertexPosition=gl.getAttribLocation(program,"aVertexPosition"),this.attributes=[this.aVertexPosition,this.colorAttribute],this.translationMatrix=gl.getUniformLocation(program,"translationMatrix"),this.alpha=gl.getUniformLocation(program,"alpha"),this.program=program},PIXI.ComplexPrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attribute=null},PIXI.WebGLGraphics=function(){},PIXI.WebGLGraphics.renderGraphics=function(graphics,renderSession){var webGLData,gl=renderSession.gl,projection=renderSession.projection,offset=renderSession.offset,shader=renderSession.shaderManager.primitiveShader;graphics.dirty&&PIXI.WebGLGraphics.updateGraphics(graphics,gl);for(var webGL=graphics._webGL[gl.id],i=0;i<webGL.data.length;i++)1===webGL.data[i].mode?(webGLData=webGL.data[i],renderSession.stencilManager.pushStencil(graphics,webGLData,renderSession),gl.drawElements(gl.TRIANGLE_FAN,4,gl.UNSIGNED_SHORT,2*(webGLData.indices.length-4)),renderSession.stencilManager.popStencil(graphics,webGLData,renderSession)):(webGLData=webGL.data[i],renderSession.shaderManager.setShader(shader),shader=renderSession.shaderManager.primitiveShader,gl.uniformMatrix3fv(shader.translationMatrix,!1,graphics.worldTransform.toArray(!0)),gl.uniform1f(shader.flipY,1),gl.uniform2f(shader.projectionVector,projection.x,-projection.y),gl.uniform2f(shader.offsetVector,-offset.x,-offset.y),gl.uniform3fv(shader.tintColor,PIXI.hex2rgb(graphics.tint)),gl.uniform1f(shader.alpha,graphics.worldAlpha),gl.bindBuffer(gl.ARRAY_BUFFER,webGLData.buffer),gl.vertexAttribPointer(shader.aVertexPosition,2,gl.FLOAT,!1,24,0),gl.vertexAttribPointer(shader.colorAttribute,4,gl.FLOAT,!1,24,8),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,webGLData.indexBuffer),gl.drawElements(gl.TRIANGLE_STRIP,webGLData.indices.length,gl.UNSIGNED_SHORT,0))},PIXI.WebGLGraphics.updateGraphics=function(graphics,gl){var webGL=graphics._webGL[gl.id];webGL||(webGL=graphics._webGL[gl.id]={lastIndex:0,data:[],gl:gl}),graphics.dirty=!1;var i;if(graphics.clearDirty){for(graphics.clearDirty=!1,i=0;i<webGL.data.length;i++){var graphicsData=webGL.data[i];graphicsData.reset(),PIXI.WebGLGraphics.graphicsDataPool.push(graphicsData)}webGL.data=[],webGL.lastIndex=0}var webGLData;for(i=webGL.lastIndex;i<graphics.graphicsData.length;i++){var data=graphics.graphicsData[i];if(data.type===PIXI.Graphics.POLY){if(data.points=data.shape.points.slice(),data.shape.closed&&(data.points[0]!==data.points[data.points.length-2]||data.points[1]!==data.points[data.points.length-1])&&data.points.push(data.points[0],data.points[1]),data.fill&&data.points.length>=6)if(data.points.length<12){webGLData=PIXI.WebGLGraphics.switchMode(webGL,0);var canDrawUsingSimple=PIXI.WebGLGraphics.buildPoly(data,webGLData);canDrawUsingSimple||(webGLData=PIXI.WebGLGraphics.switchMode(webGL,1),PIXI.WebGLGraphics.buildComplexPoly(data,webGLData))}else webGLData=PIXI.WebGLGraphics.switchMode(webGL,1),PIXI.WebGLGraphics.buildComplexPoly(data,webGLData);data.lineWidth>0&&(webGLData=PIXI.WebGLGraphics.switchMode(webGL,0),PIXI.WebGLGraphics.buildLine(data,webGLData))}else webGLData=PIXI.WebGLGraphics.switchMode(webGL,0),data.type===PIXI.Graphics.RECT?PIXI.WebGLGraphics.buildRectangle(data,webGLData):data.type===PIXI.Graphics.CIRC||data.type===PIXI.Graphics.ELIP?PIXI.WebGLGraphics.buildCircle(data,webGLData):data.type===PIXI.Graphics.RREC&&PIXI.WebGLGraphics.buildRoundedRectangle(data,webGLData);webGL.lastIndex++}for(i=0;i<webGL.data.length;i++)webGLData=webGL.data[i],webGLData.dirty&&webGLData.upload()},PIXI.WebGLGraphics.switchMode=function(webGL,type){var webGLData;return webGL.data.length?(webGLData=webGL.data[webGL.data.length-1],(webGLData.mode!==type||1===type)&&(webGLData=PIXI.WebGLGraphics.graphicsDataPool.pop()||new PIXI.WebGLGraphicsData(webGL.gl),webGLData.mode=type,webGL.data.push(webGLData))):(webGLData=PIXI.WebGLGraphics.graphicsDataPool.pop()||new PIXI.WebGLGraphicsData(webGL.gl),webGLData.mode=type,webGL.data.push(webGLData)),webGLData.dirty=!0,webGLData},PIXI.WebGLGraphics.buildRectangle=function(graphicsData,webGLData){var rectData=graphicsData.shape,x=rectData.x,y=rectData.y,width=rectData.width,height=rectData.height;if(graphicsData.fill){var color=PIXI.hex2rgb(graphicsData.fillColor),alpha=graphicsData.fillAlpha,r=color[0]*alpha,g=color[1]*alpha,b=color[2]*alpha,verts=webGLData.points,indices=webGLData.indices,vertPos=verts.length/6;verts.push(x,y),verts.push(r,g,b,alpha),verts.push(x+width,y),verts.push(r,g,b,alpha),verts.push(x,y+height),verts.push(r,g,b,alpha),verts.push(x+width,y+height),verts.push(r,g,b,alpha),indices.push(vertPos,vertPos,vertPos+1,vertPos+2,vertPos+3,vertPos+3)}if(graphicsData.lineWidth){var tempPoints=graphicsData.points;graphicsData.points=[x,y,x+width,y,x+width,y+height,x,y+height,x,y],PIXI.WebGLGraphics.buildLine(graphicsData,webGLData),graphicsData.points=tempPoints}},PIXI.WebGLGraphics.buildRoundedRectangle=function(graphicsData,webGLData){var rrectData=graphicsData.shape,x=rrectData.x,y=rrectData.y,width=rrectData.width,height=rrectData.height,radius=rrectData.radius,recPoints=[];if(recPoints.push(x,y+radius),recPoints=recPoints.concat(PIXI.WebGLGraphics.quadraticBezierCurve(x,y+height-radius,x,y+height,x+radius,y+height)),recPoints=recPoints.concat(PIXI.WebGLGraphics.quadraticBezierCurve(x+width-radius,y+height,x+width,y+height,x+width,y+height-radius)),recPoints=recPoints.concat(PIXI.WebGLGraphics.quadraticBezierCurve(x+width,y+radius,x+width,y,x+width-radius,y)),recPoints=recPoints.concat(PIXI.WebGLGraphics.quadraticBezierCurve(x+radius,y,x,y,x,y+radius)),graphicsData.fill){var color=PIXI.hex2rgb(graphicsData.fillColor),alpha=graphicsData.fillAlpha,r=color[0]*alpha,g=color[1]*alpha,b=color[2]*alpha,verts=webGLData.points,indices=webGLData.indices,vecPos=verts.length/6,triangles=PIXI.PolyK.Triangulate(recPoints),i=0;for(i=0;i<triangles.length;i+=3)indices.push(triangles[i]+vecPos),indices.push(triangles[i]+vecPos),indices.push(triangles[i+1]+vecPos),indices.push(triangles[i+2]+vecPos),indices.push(triangles[i+2]+vecPos);for(i=0;i<recPoints.length;i++)verts.push(recPoints[i],recPoints[++i],r,g,b,alpha)}if(graphicsData.lineWidth){var tempPoints=graphicsData.points;graphicsData.points=recPoints,PIXI.WebGLGraphics.buildLine(graphicsData,webGLData),graphicsData.points=tempPoints}},PIXI.WebGLGraphics.quadraticBezierCurve=function(fromX,fromY,cpX,cpY,toX,toY){function getPt(n1,n2,perc){var diff=n2-n1;return n1+diff*perc}for(var xa,ya,xb,yb,x,y,n=20,points=[],j=0,i=0;n>=i;i++)j=i/n,xa=getPt(fromX,cpX,j),ya=getPt(fromY,cpY,j),xb=getPt(cpX,toX,j),yb=getPt(cpY,toY,j),x=getPt(xa,xb,j),y=getPt(ya,yb,j),points.push(x,y);return points},PIXI.WebGLGraphics.buildCircle=function(graphicsData,webGLData){var width,height,circleData=graphicsData.shape,x=circleData.x,y=circleData.y;graphicsData.type===PIXI.Graphics.CIRC?(width=circleData.radius,height=circleData.radius):(width=circleData.width,height=circleData.height);var totalSegs=40,seg=2*Math.PI/totalSegs,i=0;if(graphicsData.fill){var color=PIXI.hex2rgb(graphicsData.fillColor),alpha=graphicsData.fillAlpha,r=color[0]*alpha,g=color[1]*alpha,b=color[2]*alpha,verts=webGLData.points,indices=webGLData.indices,vecPos=verts.length/6;for(indices.push(vecPos),i=0;totalSegs+1>i;i++)verts.push(x,y,r,g,b,alpha),verts.push(x+Math.sin(seg*i)*width,y+Math.cos(seg*i)*height,r,g,b,alpha),indices.push(vecPos++,vecPos++);indices.push(vecPos-1)}if(graphicsData.lineWidth){var tempPoints=graphicsData.points;for(graphicsData.points=[],i=0;totalSegs+1>i;i++)graphicsData.points.push(x+Math.sin(seg*i)*width,y+Math.cos(seg*i)*height);PIXI.WebGLGraphics.buildLine(graphicsData,webGLData),graphicsData.points=tempPoints}},PIXI.WebGLGraphics.buildLine=function(graphicsData,webGLData){var i=0,points=graphicsData.points;if(0!==points.length){if(graphicsData.lineWidth%2)for(i=0;i<points.length;i++)points[i]+=.5;var firstPoint=new PIXI.Point(points[0],points[1]),lastPoint=new PIXI.Point(points[points.length-2],points[points.length-1]);if(firstPoint.x===lastPoint.x&&firstPoint.y===lastPoint.y){points=points.slice(),points.pop(),points.pop(),lastPoint=new PIXI.Point(points[points.length-2],points[points.length-1]);var midPointX=lastPoint.x+.5*(firstPoint.x-lastPoint.x),midPointY=lastPoint.y+.5*(firstPoint.y-lastPoint.y);points.unshift(midPointX,midPointY),points.push(midPointX,midPointY)}var px,py,p1x,p1y,p2x,p2y,p3x,p3y,perpx,perpy,perp2x,perp2y,perp3x,perp3y,a1,b1,c1,a2,b2,c2,denom,pdist,dist,verts=webGLData.points,indices=webGLData.indices,length=points.length/2,indexCount=points.length,indexStart=verts.length/6,width=graphicsData.lineWidth/2,color=PIXI.hex2rgb(graphicsData.lineColor),alpha=graphicsData.lineAlpha,r=color[0]*alpha,g=color[1]*alpha,b=color[2]*alpha;for(p1x=points[0],p1y=points[1],p2x=points[2],p2y=points[3],perpx=-(p1y-p2y),perpy=p1x-p2x,dist=Math.sqrt(perpx*perpx+perpy*perpy),perpx/=dist,perpy/=dist,perpx*=width,perpy*=width,verts.push(p1x-perpx,p1y-perpy,r,g,b,alpha),verts.push(p1x+perpx,p1y+perpy,r,g,b,alpha),i=1;length-1>i;i++)p1x=points[2*(i-1)],p1y=points[2*(i-1)+1],p2x=points[2*i],p2y=points[2*i+1],p3x=points[2*(i+1)],p3y=points[2*(i+1)+1],perpx=-(p1y-p2y),perpy=p1x-p2x,dist=Math.sqrt(perpx*perpx+perpy*perpy),perpx/=dist,perpy/=dist,perpx*=width,perpy*=width,perp2x=-(p2y-p3y),perp2y=p2x-p3x,dist=Math.sqrt(perp2x*perp2x+perp2y*perp2y),perp2x/=dist,perp2y/=dist,perp2x*=width,perp2y*=width,a1=-perpy+p1y-(-perpy+p2y),b1=-perpx+p2x-(-perpx+p1x),c1=(-perpx+p1x)*(-perpy+p2y)-(-perpx+p2x)*(-perpy+p1y),a2=-perp2y+p3y-(-perp2y+p2y),b2=-perp2x+p2x-(-perp2x+p3x),c2=(-perp2x+p3x)*(-perp2y+p2y)-(-perp2x+p2x)*(-perp2y+p3y),denom=a1*b2-a2*b1,Math.abs(denom)<.1?(denom+=10.1,verts.push(p2x-perpx,p2y-perpy,r,g,b,alpha),verts.push(p2x+perpx,p2y+perpy,r,g,b,alpha)):(px=(b1*c2-b2*c1)/denom,py=(a2*c1-a1*c2)/denom,pdist=(px-p2x)*(px-p2x)+(py-p2y)+(py-p2y),pdist>19600?(perp3x=perpx-perp2x,perp3y=perpy-perp2y,dist=Math.sqrt(perp3x*perp3x+perp3y*perp3y),perp3x/=dist,perp3y/=dist,perp3x*=width,perp3y*=width,verts.push(p2x-perp3x,p2y-perp3y),verts.push(r,g,b,alpha),verts.push(p2x+perp3x,p2y+perp3y),verts.push(r,g,b,alpha),verts.push(p2x-perp3x,p2y-perp3y),verts.push(r,g,b,alpha),indexCount++):(verts.push(px,py),verts.push(r,g,b,alpha),verts.push(p2x-(px-p2x),p2y-(py-p2y)),verts.push(r,g,b,alpha)));for(p1x=points[2*(length-2)],p1y=points[2*(length-2)+1],p2x=points[2*(length-1)],p2y=points[2*(length-1)+1],perpx=-(p1y-p2y),perpy=p1x-p2x,dist=Math.sqrt(perpx*perpx+perpy*perpy),perpx/=dist,perpy/=dist,perpx*=width,perpy*=width,verts.push(p2x-perpx,p2y-perpy),verts.push(r,g,b,alpha),verts.push(p2x+perpx,p2y+perpy),verts.push(r,g,b,alpha),indices.push(indexStart),i=0;indexCount>i;i++)indices.push(indexStart++);indices.push(indexStart-1)}},PIXI.WebGLGraphics.buildComplexPoly=function(graphicsData,webGLData){var points=graphicsData.points.slice();if(!(points.length<6)){var indices=webGLData.indices;webGLData.points=points,webGLData.alpha=graphicsData.fillAlpha,webGLData.color=PIXI.hex2rgb(graphicsData.fillColor);for(var x,y,minX=1/0,maxX=-(1/0),minY=1/0,maxY=-(1/0),i=0;i<points.length;i+=2)x=points[i],y=points[i+1],minX=minX>x?x:minX,maxX=x>maxX?x:maxX,minY=minY>y?y:minY,maxY=y>maxY?y:maxY;points.push(minX,minY,maxX,minY,maxX,maxY,minX,maxY);var length=points.length/2;for(i=0;length>i;i++)indices.push(i)}},PIXI.WebGLGraphics.buildPoly=function(graphicsData,webGLData){var points=graphicsData.points;if(!(points.length<6)){var verts=webGLData.points,indices=webGLData.indices,length=points.length/2,color=PIXI.hex2rgb(graphicsData.fillColor),alpha=graphicsData.fillAlpha,r=color[0]*alpha,g=color[1]*alpha,b=color[2]*alpha,triangles=PIXI.PolyK.Triangulate(points);if(!triangles)return!1;var vertPos=verts.length/6,i=0;for(i=0;i<triangles.length;i+=3)indices.push(triangles[i]+vertPos),indices.push(triangles[i]+vertPos),indices.push(triangles[i+1]+vertPos),indices.push(triangles[i+2]+vertPos),indices.push(triangles[i+2]+vertPos);for(i=0;length>i;i++)verts.push(points[2*i],points[2*i+1],r,g,b,alpha);return!0}},PIXI.WebGLGraphics.graphicsDataPool=[],PIXI.WebGLGraphicsData=function(gl){this.gl=gl,this.color=[0,0,0],this.points=[],this.indices=[],this.buffer=gl.createBuffer(),this.indexBuffer=gl.createBuffer(),this.mode=1,this.alpha=1,this.dirty=!0},PIXI.WebGLGraphicsData.prototype.reset=function(){this.points=[],this.indices=[]},PIXI.WebGLGraphicsData.prototype.upload=function(){var gl=this.gl;this.glPoints=new PIXI.Float32Array(this.points),gl.bindBuffer(gl.ARRAY_BUFFER,this.buffer),gl.bufferData(gl.ARRAY_BUFFER,this.glPoints,gl.STATIC_DRAW),this.glIndicies=new PIXI.Uint16Array(this.indices),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer),gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,this.glIndicies,gl.STATIC_DRAW),this.dirty=!1},PIXI.glContexts=[],PIXI.instances=[],PIXI.WebGLRenderer=function(width,height,options){if(options)for(var i in PIXI.defaultRenderOptions)"undefined"==typeof options[i]&&(options[i]=PIXI.defaultRenderOptions[i]);else options=PIXI.defaultRenderOptions;PIXI.defaultRenderer||(PIXI.sayHello("webGL"),PIXI.defaultRenderer=this),this.type=PIXI.WEBGL_RENDERER,this.resolution=options.resolution,this.transparent=options.transparent,this.autoResize=options.autoResize||!1,this.preserveDrawingBuffer=options.preserveDrawingBuffer,this.clearBeforeRender=options.clearBeforeRender,this.width=width||800,this.height=height||600,this.view=options.view||document.createElement("canvas"),this.contextLostBound=this.handleContextLost.bind(this),this.contextRestoredBound=this.handleContextRestored.bind(this),this.view.addEventListener("webglcontextlost",this.contextLostBound,!1),this.view.addEventListener("webglcontextrestored",this.contextRestoredBound,!1),this._contextOptions={alpha:this.transparent,antialias:options.antialias,premultipliedAlpha:this.transparent&&"notMultiplied"!==this.transparent,stencil:!0,preserveDrawingBuffer:options.preserveDrawingBuffer},this.projection=new PIXI.Point,this.offset=new PIXI.Point(0,0),this.shaderManager=new PIXI.WebGLShaderManager,this.spriteBatch=new PIXI.WebGLSpriteBatch,this.maskManager=new PIXI.WebGLMaskManager,this.filterManager=new PIXI.WebGLFilterManager,this.stencilManager=new PIXI.WebGLStencilManager,this.blendModeManager=new PIXI.WebGLBlendModeManager,this.renderSession={},this.renderSession.gl=this.gl,this.renderSession.drawCount=0,this.renderSession.shaderManager=this.shaderManager,this.renderSession.maskManager=this.maskManager,this.renderSession.filterManager=this.filterManager,this.renderSession.blendModeManager=this.blendModeManager,this.renderSession.spriteBatch=this.spriteBatch,this.renderSession.stencilManager=this.stencilManager,this.renderSession.renderer=this,this.renderSession.resolution=this.resolution,this.initContext(),this.mapBlendModes()},PIXI.WebGLRenderer.prototype.constructor=PIXI.WebGLRenderer,PIXI.WebGLRenderer.prototype.initContext=function(){var gl=this.view.getContext("webgl",this._contextOptions)||this.view.getContext("experimental-webgl",this._contextOptions);if(this.gl=gl,!gl)throw new Error("This browser does not support webGL. Try using the canvas renderer");this.glContextId=gl.id=PIXI.WebGLRenderer.glContextId++,PIXI.glContexts[this.glContextId]=gl,PIXI.instances[this.glContextId]=this,gl.disable(gl.DEPTH_TEST),gl.disable(gl.CULL_FACE),gl.enable(gl.BLEND),this.shaderManager.setContext(gl),this.spriteBatch.setContext(gl),this.maskManager.setContext(gl),this.filterManager.setContext(gl),this.blendModeManager.setContext(gl),this.stencilManager.setContext(gl),this.renderSession.gl=this.gl,this.resize(this.width,this.height)},PIXI.WebGLRenderer.prototype.render=function(stage){if(!this.contextLost){this.__stage!==stage&&(stage.interactive&&stage.interactionManager.removeEvents(),this.__stage=stage),stage.updateTransform();var gl=this.gl;stage._interactive?stage._interactiveEventsAdded||(stage._interactiveEventsAdded=!0,stage.interactionManager.setTarget(this)):stage._interactiveEventsAdded&&(stage._interactiveEventsAdded=!1,stage.interactionManager.setTarget(this)),gl.viewport(0,0,this.width,this.height),gl.bindFramebuffer(gl.FRAMEBUFFER,null),this.clearBeforeRender&&(this.transparent?gl.clearColor(0,0,0,0):gl.clearColor(stage.backgroundColorSplit[0],stage.backgroundColorSplit[1],stage.backgroundColorSplit[2],1),gl.clear(gl.COLOR_BUFFER_BIT)),this.renderDisplayObject(stage,this.projection)}},PIXI.WebGLRenderer.prototype.renderDisplayObject=function(displayObject,projection,buffer){this.renderSession.blendModeManager.setBlendMode(PIXI.blendModes.NORMAL),this.renderSession.drawCount=0,this.renderSession.flipY=buffer?-1:1,this.renderSession.projection=projection,this.renderSession.offset=this.offset,this.spriteBatch.begin(this.renderSession),this.filterManager.begin(this.renderSession,buffer),displayObject._renderWebGL(this.renderSession),this.spriteBatch.end()},PIXI.WebGLRenderer.prototype.resize=function(width,height){this.width=width*this.resolution,this.height=height*this.resolution,this.view.width=this.width,this.view.height=this.height,this.autoResize&&(this.view.style.width=this.width/this.resolution+"px",this.view.style.height=this.height/this.resolution+"px"),this.gl.viewport(0,0,this.width,this.height),this.projection.x=this.width/2/this.resolution,this.projection.y=-this.height/2/this.resolution},PIXI.WebGLRenderer.prototype.updateTexture=function(texture){if(texture.hasLoaded){var gl=this.gl;return texture._glTextures[gl.id]||(texture._glTextures[gl.id]=gl.createTexture()),gl.bindTexture(gl.TEXTURE_2D,texture._glTextures[gl.id]),gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,texture.premultipliedAlpha),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,texture.source),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,texture.scaleMode===PIXI.scaleModes.LINEAR?gl.LINEAR:gl.NEAREST),texture.mipmap&&PIXI.isPowerOfTwo(texture.width,texture.height)?(gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,texture.scaleMode===PIXI.scaleModes.LINEAR?gl.LINEAR_MIPMAP_LINEAR:gl.NEAREST_MIPMAP_NEAREST),gl.generateMipmap(gl.TEXTURE_2D)):gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,texture.scaleMode===PIXI.scaleModes.LINEAR?gl.LINEAR:gl.NEAREST),texture._powerOf2?(gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.REPEAT),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.REPEAT)):(gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE)),texture._dirty[gl.id]=!1,texture._glTextures[gl.id]}},PIXI.WebGLRenderer.prototype.handleContextLost=function(event){event.preventDefault(),this.contextLost=!0},PIXI.WebGLRenderer.prototype.handleContextRestored=function(){this.initContext();for(var key in PIXI.TextureCache){var texture=PIXI.TextureCache[key].baseTexture;texture._glTextures=[]}this.contextLost=!1},PIXI.WebGLRenderer.prototype.destroy=function(){this.view.removeEventListener("webglcontextlost",this.contextLostBound),this.view.removeEventListener("webglcontextrestored",this.contextRestoredBound),PIXI.glContexts[this.glContextId]=null,this.projection=null,this.offset=null,this.shaderManager.destroy(),this.spriteBatch.destroy(),this.maskManager.destroy(),this.filterManager.destroy(),this.shaderManager=null,this.spriteBatch=null,this.maskManager=null,this.filterManager=null,this.gl=null,this.renderSession=null},PIXI.WebGLRenderer.prototype.mapBlendModes=function(){var gl=this.gl;PIXI.blendModesWebGL||(PIXI.blendModesWebGL=[],PIXI.blendModesWebGL[PIXI.blendModes.NORMAL]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],PIXI.blendModesWebGL[PIXI.blendModes.ADD]=[gl.SRC_ALPHA,gl.DST_ALPHA],PIXI.blendModesWebGL[PIXI.blendModes.MULTIPLY]=[gl.DST_COLOR,gl.ONE_MINUS_SRC_ALPHA],PIXI.blendModesWebGL[PIXI.blendModes.SCREEN]=[gl.SRC_ALPHA,gl.ONE],PIXI.blendModesWebGL[PIXI.blendModes.OVERLAY]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],PIXI.blendModesWebGL[PIXI.blendModes.DARKEN]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],PIXI.blendModesWebGL[PIXI.blendModes.LIGHTEN]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],PIXI.blendModesWebGL[PIXI.blendModes.COLOR_DODGE]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],PIXI.blendModesWebGL[PIXI.blendModes.COLOR_BURN]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],PIXI.blendModesWebGL[PIXI.blendModes.HARD_LIGHT]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],PIXI.blendModesWebGL[PIXI.blendModes.SOFT_LIGHT]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],PIXI.blendModesWebGL[PIXI.blendModes.DIFFERENCE]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],PIXI.blendModesWebGL[PIXI.blendModes.EXCLUSION]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],PIXI.blendModesWebGL[PIXI.blendModes.HUE]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],PIXI.blendModesWebGL[PIXI.blendModes.SATURATION]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],PIXI.blendModesWebGL[PIXI.blendModes.COLOR]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],PIXI.blendModesWebGL[PIXI.blendModes.LUMINOSITY]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA])},PIXI.WebGLRenderer.glContextId=0,PIXI.WebGLBlendModeManager=function(){this.currentBlendMode=99999},PIXI.WebGLBlendModeManager.prototype.constructor=PIXI.WebGLBlendModeManager,PIXI.WebGLBlendModeManager.prototype.setContext=function(gl){this.gl=gl},PIXI.WebGLBlendModeManager.prototype.setBlendMode=function(blendMode){if(this.currentBlendMode===blendMode)return!1;this.currentBlendMode=blendMode;var blendModeWebGL=PIXI.blendModesWebGL[this.currentBlendMode];return this.gl.blendFunc(blendModeWebGL[0],blendModeWebGL[1]),!0},PIXI.WebGLBlendModeManager.prototype.destroy=function(){this.gl=null},PIXI.WebGLMaskManager=function(){},PIXI.WebGLMaskManager.prototype.constructor=PIXI.WebGLMaskManager,PIXI.WebGLMaskManager.prototype.setContext=function(gl){this.gl=gl},PIXI.WebGLMaskManager.prototype.pushMask=function(maskData,renderSession){var gl=renderSession.gl;maskData.dirty&&PIXI.WebGLGraphics.updateGraphics(maskData,gl),maskData._webGL[gl.id].data.length&&renderSession.stencilManager.pushStencil(maskData,maskData._webGL[gl.id].data[0],renderSession)},PIXI.WebGLMaskManager.prototype.popMask=function(maskData,renderSession){var gl=this.gl;renderSession.stencilManager.popStencil(maskData,maskData._webGL[gl.id].data[0],renderSession)},PIXI.WebGLMaskManager.prototype.destroy=function(){this.gl=null},PIXI.WebGLStencilManager=function(){this.stencilStack=[],this.reverse=!0,this.count=0},PIXI.WebGLStencilManager.prototype.setContext=function(gl){
this.gl=gl},PIXI.WebGLStencilManager.prototype.pushStencil=function(graphics,webGLData,renderSession){var gl=this.gl;this.bindGraphics(graphics,webGLData,renderSession),0===this.stencilStack.length&&(gl.enable(gl.STENCIL_TEST),gl.clear(gl.STENCIL_BUFFER_BIT),this.reverse=!0,this.count=0),this.stencilStack.push(webGLData);var level=this.count;gl.colorMask(!1,!1,!1,!1),gl.stencilFunc(gl.ALWAYS,0,255),gl.stencilOp(gl.KEEP,gl.KEEP,gl.INVERT),1===webGLData.mode?(gl.drawElements(gl.TRIANGLE_FAN,webGLData.indices.length-4,gl.UNSIGNED_SHORT,0),this.reverse?(gl.stencilFunc(gl.EQUAL,255-level,255),gl.stencilOp(gl.KEEP,gl.KEEP,gl.DECR)):(gl.stencilFunc(gl.EQUAL,level,255),gl.stencilOp(gl.KEEP,gl.KEEP,gl.INCR)),gl.drawElements(gl.TRIANGLE_FAN,4,gl.UNSIGNED_SHORT,2*(webGLData.indices.length-4)),this.reverse?gl.stencilFunc(gl.EQUAL,255-(level+1),255):gl.stencilFunc(gl.EQUAL,level+1,255),this.reverse=!this.reverse):(this.reverse?(gl.stencilFunc(gl.EQUAL,level,255),gl.stencilOp(gl.KEEP,gl.KEEP,gl.INCR)):(gl.stencilFunc(gl.EQUAL,255-level,255),gl.stencilOp(gl.KEEP,gl.KEEP,gl.DECR)),gl.drawElements(gl.TRIANGLE_STRIP,webGLData.indices.length,gl.UNSIGNED_SHORT,0),this.reverse?gl.stencilFunc(gl.EQUAL,level+1,255):gl.stencilFunc(gl.EQUAL,255-(level+1),255)),gl.colorMask(!0,!0,!0,!0),gl.stencilOp(gl.KEEP,gl.KEEP,gl.KEEP),this.count++},PIXI.WebGLStencilManager.prototype.bindGraphics=function(graphics,webGLData,renderSession){this._currentGraphics=graphics;var shader,gl=this.gl,projection=renderSession.projection,offset=renderSession.offset;1===webGLData.mode?(shader=renderSession.shaderManager.complexPrimitiveShader,renderSession.shaderManager.setShader(shader),gl.uniform1f(shader.flipY,renderSession.flipY),gl.uniformMatrix3fv(shader.translationMatrix,!1,graphics.worldTransform.toArray(!0)),gl.uniform2f(shader.projectionVector,projection.x,-projection.y),gl.uniform2f(shader.offsetVector,-offset.x,-offset.y),gl.uniform3fv(shader.tintColor,PIXI.hex2rgb(graphics.tint)),gl.uniform3fv(shader.color,webGLData.color),gl.uniform1f(shader.alpha,graphics.worldAlpha*webGLData.alpha),gl.bindBuffer(gl.ARRAY_BUFFER,webGLData.buffer),gl.vertexAttribPointer(shader.aVertexPosition,2,gl.FLOAT,!1,8,0),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,webGLData.indexBuffer)):(shader=renderSession.shaderManager.primitiveShader,renderSession.shaderManager.setShader(shader),gl.uniformMatrix3fv(shader.translationMatrix,!1,graphics.worldTransform.toArray(!0)),gl.uniform1f(shader.flipY,renderSession.flipY),gl.uniform2f(shader.projectionVector,projection.x,-projection.y),gl.uniform2f(shader.offsetVector,-offset.x,-offset.y),gl.uniform3fv(shader.tintColor,PIXI.hex2rgb(graphics.tint)),gl.uniform1f(shader.alpha,graphics.worldAlpha),gl.bindBuffer(gl.ARRAY_BUFFER,webGLData.buffer),gl.vertexAttribPointer(shader.aVertexPosition,2,gl.FLOAT,!1,24,0),gl.vertexAttribPointer(shader.colorAttribute,4,gl.FLOAT,!1,24,8),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,webGLData.indexBuffer))},PIXI.WebGLStencilManager.prototype.popStencil=function(graphics,webGLData,renderSession){var gl=this.gl;if(this.stencilStack.pop(),this.count--,0===this.stencilStack.length)gl.disable(gl.STENCIL_TEST);else{var level=this.count;this.bindGraphics(graphics,webGLData,renderSession),gl.colorMask(!1,!1,!1,!1),1===webGLData.mode?(this.reverse=!this.reverse,this.reverse?(gl.stencilFunc(gl.EQUAL,255-(level+1),255),gl.stencilOp(gl.KEEP,gl.KEEP,gl.INCR)):(gl.stencilFunc(gl.EQUAL,level+1,255),gl.stencilOp(gl.KEEP,gl.KEEP,gl.DECR)),gl.drawElements(gl.TRIANGLE_FAN,4,gl.UNSIGNED_SHORT,2*(webGLData.indices.length-4)),gl.stencilFunc(gl.ALWAYS,0,255),gl.stencilOp(gl.KEEP,gl.KEEP,gl.INVERT),gl.drawElements(gl.TRIANGLE_FAN,webGLData.indices.length-4,gl.UNSIGNED_SHORT,0),this.reverse?gl.stencilFunc(gl.EQUAL,level,255):gl.stencilFunc(gl.EQUAL,255-level,255)):(this.reverse?(gl.stencilFunc(gl.EQUAL,level+1,255),gl.stencilOp(gl.KEEP,gl.KEEP,gl.DECR)):(gl.stencilFunc(gl.EQUAL,255-(level+1),255),gl.stencilOp(gl.KEEP,gl.KEEP,gl.INCR)),gl.drawElements(gl.TRIANGLE_STRIP,webGLData.indices.length,gl.UNSIGNED_SHORT,0),this.reverse?gl.stencilFunc(gl.EQUAL,level,255):gl.stencilFunc(gl.EQUAL,255-level,255)),gl.colorMask(!0,!0,!0,!0),gl.stencilOp(gl.KEEP,gl.KEEP,gl.KEEP)}},PIXI.WebGLStencilManager.prototype.destroy=function(){this.stencilStack=null,this.gl=null},PIXI.WebGLShaderManager=function(){this.maxAttibs=10,this.attribState=[],this.tempAttribState=[];for(var i=0;i<this.maxAttibs;i++)this.attribState[i]=!1;this.stack=[]},PIXI.WebGLShaderManager.prototype.constructor=PIXI.WebGLShaderManager,PIXI.WebGLShaderManager.prototype.setContext=function(gl){this.gl=gl,this.primitiveShader=new PIXI.PrimitiveShader(gl),this.complexPrimitiveShader=new PIXI.ComplexPrimitiveShader(gl),this.defaultShader=new PIXI.PixiShader(gl),this.fastShader=new PIXI.PixiFastShader(gl),this.stripShader=new PIXI.StripShader(gl),this.setShader(this.defaultShader)},PIXI.WebGLShaderManager.prototype.setAttribs=function(attribs){var i;for(i=0;i<this.tempAttribState.length;i++)this.tempAttribState[i]=!1;for(i=0;i<attribs.length;i++){var attribId=attribs[i];this.tempAttribState[attribId]=!0}var gl=this.gl;for(i=0;i<this.attribState.length;i++)this.attribState[i]!==this.tempAttribState[i]&&(this.attribState[i]=this.tempAttribState[i],this.tempAttribState[i]?gl.enableVertexAttribArray(i):gl.disableVertexAttribArray(i))},PIXI.WebGLShaderManager.prototype.setShader=function(shader){return this._currentId===shader._UID?!1:(this._currentId=shader._UID,this.currentShader=shader,this.gl.useProgram(shader.program),this.setAttribs(shader.attributes),!0)},PIXI.WebGLShaderManager.prototype.destroy=function(){this.attribState=null,this.tempAttribState=null,this.primitiveShader.destroy(),this.complexPrimitiveShader.destroy(),this.defaultShader.destroy(),this.fastShader.destroy(),this.stripShader.destroy(),this.gl=null},PIXI.WebGLSpriteBatch=function(){this.vertSize=5,this.size=2e3;var numVerts=4*this.size*4*this.vertSize,numIndices=6*this.size;this.vertices=new PIXI.ArrayBuffer(numVerts),this.positions=new PIXI.Float32Array(this.vertices),this.colors=new PIXI.Uint32Array(this.vertices),this.indices=new PIXI.Uint16Array(numIndices),this.lastIndexCount=0;for(var i=0,j=0;numIndices>i;i+=6,j+=4)this.indices[i+0]=j+0,this.indices[i+1]=j+1,this.indices[i+2]=j+2,this.indices[i+3]=j+0,this.indices[i+4]=j+2,this.indices[i+5]=j+3;this.drawing=!1,this.currentBatchSize=0,this.currentBaseTexture=null,this.dirty=!0,this.textures=[],this.blendModes=[],this.shaders=[],this.sprites=[],this.defaultShader=new PIXI.AbstractFilter(["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"])},PIXI.WebGLSpriteBatch.prototype.setContext=function(gl){this.gl=gl,this.vertexBuffer=gl.createBuffer(),this.indexBuffer=gl.createBuffer(),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer),gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,this.indices,gl.STATIC_DRAW),gl.bindBuffer(gl.ARRAY_BUFFER,this.vertexBuffer),gl.bufferData(gl.ARRAY_BUFFER,this.vertices,gl.DYNAMIC_DRAW),this.currentBlendMode=99999;var shader=new PIXI.PixiShader(gl);shader.fragmentSrc=this.defaultShader.fragmentSrc,shader.uniforms={},shader.init(),this.defaultShader.shaders[gl.id]=shader},PIXI.WebGLSpriteBatch.prototype.begin=function(renderSession){this.renderSession=renderSession,this.shader=this.renderSession.shaderManager.defaultShader,this.start()},PIXI.WebGLSpriteBatch.prototype.end=function(){this.flush()},PIXI.WebGLSpriteBatch.prototype.render=function(sprite){var texture=sprite.texture;this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=texture.baseTexture);var uvs=texture._uvs;if(uvs){var w0,w1,h0,h1,aX=sprite.anchor.x,aY=sprite.anchor.y;if(texture.trim){var trim=texture.trim;w1=trim.x-aX*trim.width,w0=w1+texture.crop.width,h1=trim.y-aY*trim.height,h0=h1+texture.crop.height}else w0=texture.frame.width*(1-aX),w1=texture.frame.width*-aX,h0=texture.frame.height*(1-aY),h1=texture.frame.height*-aY;var index=4*this.currentBatchSize*this.vertSize,resolution=texture.baseTexture.resolution,worldTransform=sprite.worldTransform,a=worldTransform.a/resolution,b=worldTransform.b/resolution,c=worldTransform.c/resolution,d=worldTransform.d/resolution,tx=worldTransform.tx,ty=worldTransform.ty,colors=this.colors,positions=this.positions;this.renderSession.roundPixels?(positions[index]=a*w1+c*h1+tx|0,positions[index+1]=d*h1+b*w1+ty|0,positions[index+5]=a*w0+c*h1+tx|0,positions[index+6]=d*h1+b*w0+ty|0,positions[index+10]=a*w0+c*h0+tx|0,positions[index+11]=d*h0+b*w0+ty|0,positions[index+15]=a*w1+c*h0+tx|0,positions[index+16]=d*h0+b*w1+ty|0):(positions[index]=a*w1+c*h1+tx,positions[index+1]=d*h1+b*w1+ty,positions[index+5]=a*w0+c*h1+tx,positions[index+6]=d*h1+b*w0+ty,positions[index+10]=a*w0+c*h0+tx,positions[index+11]=d*h0+b*w0+ty,positions[index+15]=a*w1+c*h0+tx,positions[index+16]=d*h0+b*w1+ty),positions[index+2]=uvs.x0,positions[index+3]=uvs.y0,positions[index+7]=uvs.x1,positions[index+8]=uvs.y1,positions[index+12]=uvs.x2,positions[index+13]=uvs.y2,positions[index+17]=uvs.x3,positions[index+18]=uvs.y3;var tint=sprite.tint;colors[index+4]=colors[index+9]=colors[index+14]=colors[index+19]=(tint>>16)+(65280&tint)+((255&tint)<<16)+(255*sprite.worldAlpha<<24),this.sprites[this.currentBatchSize++]=sprite}},PIXI.WebGLSpriteBatch.prototype.renderTilingSprite=function(tilingSprite){var texture=tilingSprite.tilingTexture;this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=texture.baseTexture),tilingSprite._uvs||(tilingSprite._uvs=new PIXI.TextureUvs);var uvs=tilingSprite._uvs;tilingSprite.tilePosition.x%=texture.baseTexture.width*tilingSprite.tileScaleOffset.x,tilingSprite.tilePosition.y%=texture.baseTexture.height*tilingSprite.tileScaleOffset.y;var offsetX=tilingSprite.tilePosition.x/(texture.baseTexture.width*tilingSprite.tileScaleOffset.x),offsetY=tilingSprite.tilePosition.y/(texture.baseTexture.height*tilingSprite.tileScaleOffset.y),scaleX=tilingSprite.width/texture.baseTexture.width/(tilingSprite.tileScale.x*tilingSprite.tileScaleOffset.x),scaleY=tilingSprite.height/texture.baseTexture.height/(tilingSprite.tileScale.y*tilingSprite.tileScaleOffset.y);uvs.x0=0-offsetX,uvs.y0=0-offsetY,uvs.x1=1*scaleX-offsetX,uvs.y1=0-offsetY,uvs.x2=1*scaleX-offsetX,uvs.y2=1*scaleY-offsetY,uvs.x3=0-offsetX,uvs.y3=1*scaleY-offsetY;var tint=tilingSprite.tint,color=(tint>>16)+(65280&tint)+((255&tint)<<16)+(255*tilingSprite.alpha<<24),positions=this.positions,colors=this.colors,width=tilingSprite.width,height=tilingSprite.height,aX=tilingSprite.anchor.x,aY=tilingSprite.anchor.y,w0=width*(1-aX),w1=width*-aX,h0=height*(1-aY),h1=height*-aY,index=4*this.currentBatchSize*this.vertSize,resolution=texture.baseTexture.resolution,worldTransform=tilingSprite.worldTransform,a=worldTransform.a/resolution,b=worldTransform.b/resolution,c=worldTransform.c/resolution,d=worldTransform.d/resolution,tx=worldTransform.tx,ty=worldTransform.ty;positions[index++]=a*w1+c*h1+tx,positions[index++]=d*h1+b*w1+ty,positions[index++]=uvs.x0,positions[index++]=uvs.y0,colors[index++]=color,positions[index++]=a*w0+c*h1+tx,positions[index++]=d*h1+b*w0+ty,positions[index++]=uvs.x1,positions[index++]=uvs.y1,colors[index++]=color,positions[index++]=a*w0+c*h0+tx,positions[index++]=d*h0+b*w0+ty,positions[index++]=uvs.x2,positions[index++]=uvs.y2,colors[index++]=color,positions[index++]=a*w1+c*h0+tx,positions[index++]=d*h0+b*w1+ty,positions[index++]=uvs.x3,positions[index++]=uvs.y3,colors[index++]=color,this.sprites[this.currentBatchSize++]=tilingSprite},PIXI.WebGLSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var shader,gl=this.gl;if(this.dirty){this.dirty=!1,gl.activeTexture(gl.TEXTURE0),gl.bindBuffer(gl.ARRAY_BUFFER,this.vertexBuffer),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer),shader=this.defaultShader.shaders[gl.id];var stride=4*this.vertSize;gl.vertexAttribPointer(shader.aVertexPosition,2,gl.FLOAT,!1,stride,0),gl.vertexAttribPointer(shader.aTextureCoord,2,gl.FLOAT,!1,stride,8),gl.vertexAttribPointer(shader.colorAttribute,4,gl.UNSIGNED_BYTE,!0,stride,16)}if(this.currentBatchSize>.5*this.size)gl.bufferSubData(gl.ARRAY_BUFFER,0,this.vertices);else{var view=this.positions.subarray(0,4*this.currentBatchSize*this.vertSize);gl.bufferSubData(gl.ARRAY_BUFFER,0,view)}for(var nextTexture,nextBlendMode,nextShader,sprite,batchSize=0,start=0,currentBaseTexture=null,currentBlendMode=this.renderSession.blendModeManager.currentBlendMode,currentShader=null,blendSwap=!1,shaderSwap=!1,i=0,j=this.currentBatchSize;j>i;i++){if(sprite=this.sprites[i],nextTexture=sprite.texture.baseTexture,nextBlendMode=sprite.blendMode,nextShader=sprite.shader||this.defaultShader,blendSwap=currentBlendMode!==nextBlendMode,shaderSwap=currentShader!==nextShader,(currentBaseTexture!==nextTexture||blendSwap||shaderSwap)&&(this.renderBatch(currentBaseTexture,batchSize,start),start=i,batchSize=0,currentBaseTexture=nextTexture,blendSwap&&(currentBlendMode=nextBlendMode,this.renderSession.blendModeManager.setBlendMode(currentBlendMode)),shaderSwap)){currentShader=nextShader,shader=currentShader.shaders[gl.id],shader||(shader=new PIXI.PixiShader(gl),shader.fragmentSrc=currentShader.fragmentSrc,shader.uniforms=currentShader.uniforms,shader.init(),currentShader.shaders[gl.id]=shader),this.renderSession.shaderManager.setShader(shader),shader.dirty&&shader.syncUniforms();var projection=this.renderSession.projection;gl.uniform2f(shader.projectionVector,projection.x,projection.y);var offsetVector=this.renderSession.offset;gl.uniform2f(shader.offsetVector,offsetVector.x,offsetVector.y)}batchSize++}this.renderBatch(currentBaseTexture,batchSize,start),this.currentBatchSize=0}},PIXI.WebGLSpriteBatch.prototype.renderBatch=function(texture,size,startIndex){if(0!==size){var gl=this.gl;texture._dirty[gl.id]?this.renderSession.renderer.updateTexture(texture):gl.bindTexture(gl.TEXTURE_2D,texture._glTextures[gl.id]),gl.drawElements(gl.TRIANGLES,6*size,gl.UNSIGNED_SHORT,6*startIndex*2),this.renderSession.drawCount++}},PIXI.WebGLSpriteBatch.prototype.stop=function(){this.flush(),this.dirty=!0},PIXI.WebGLSpriteBatch.prototype.start=function(){this.dirty=!0},PIXI.WebGLSpriteBatch.prototype.destroy=function(){this.vertices=null,this.indices=null,this.gl.deleteBuffer(this.vertexBuffer),this.gl.deleteBuffer(this.indexBuffer),this.currentBaseTexture=null,this.gl=null},PIXI.WebGLFastSpriteBatch=function(gl){this.vertSize=10,this.maxSize=6e3,this.size=this.maxSize;var numVerts=4*this.size*this.vertSize,numIndices=6*this.maxSize;this.vertices=new PIXI.Float32Array(numVerts),this.indices=new PIXI.Uint16Array(numIndices),this.vertexBuffer=null,this.indexBuffer=null,this.lastIndexCount=0;for(var i=0,j=0;numIndices>i;i+=6,j+=4)this.indices[i+0]=j+0,this.indices[i+1]=j+1,this.indices[i+2]=j+2,this.indices[i+3]=j+0,this.indices[i+4]=j+2,this.indices[i+5]=j+3;this.drawing=!1,this.currentBatchSize=0,this.currentBaseTexture=null,this.currentBlendMode=0,this.renderSession=null,this.shader=null,this.matrix=null,this.setContext(gl)},PIXI.WebGLFastSpriteBatch.prototype.constructor=PIXI.WebGLFastSpriteBatch,PIXI.WebGLFastSpriteBatch.prototype.setContext=function(gl){this.gl=gl,this.vertexBuffer=gl.createBuffer(),this.indexBuffer=gl.createBuffer(),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer),gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,this.indices,gl.STATIC_DRAW),gl.bindBuffer(gl.ARRAY_BUFFER,this.vertexBuffer),gl.bufferData(gl.ARRAY_BUFFER,this.vertices,gl.DYNAMIC_DRAW)},PIXI.WebGLFastSpriteBatch.prototype.begin=function(spriteBatch,renderSession){this.renderSession=renderSession,this.shader=this.renderSession.shaderManager.fastShader,this.matrix=spriteBatch.worldTransform.toArray(!0),this.start()},PIXI.WebGLFastSpriteBatch.prototype.end=function(){this.flush()},PIXI.WebGLFastSpriteBatch.prototype.render=function(spriteBatch){var children=spriteBatch.children,sprite=children[0];if(sprite.texture._uvs){this.currentBaseTexture=sprite.texture.baseTexture,sprite.blendMode!==this.renderSession.blendModeManager.currentBlendMode&&(this.flush(),this.renderSession.blendModeManager.setBlendMode(sprite.blendMode));for(var i=0,j=children.length;j>i;i++)this.renderSprite(children[i]);this.flush()}},PIXI.WebGLFastSpriteBatch.prototype.renderSprite=function(sprite){if(sprite.visible&&(sprite.texture.baseTexture===this.currentBaseTexture||(this.flush(),this.currentBaseTexture=sprite.texture.baseTexture,sprite.texture._uvs))){var uvs,width,height,w0,w1,h0,h1,index,vertices=this.vertices;if(uvs=sprite.texture._uvs,width=sprite.texture.frame.width,height=sprite.texture.frame.height,sprite.texture.trim){var trim=sprite.texture.trim;w1=trim.x-sprite.anchor.x*trim.width,w0=w1+sprite.texture.crop.width,h1=trim.y-sprite.anchor.y*trim.height,h0=h1+sprite.texture.crop.height}else w0=sprite.texture.frame.width*(1-sprite.anchor.x),w1=sprite.texture.frame.width*-sprite.anchor.x,h0=sprite.texture.frame.height*(1-sprite.anchor.y),h1=sprite.texture.frame.height*-sprite.anchor.y;index=4*this.currentBatchSize*this.vertSize,vertices[index++]=w1,vertices[index++]=h1,vertices[index++]=sprite.position.x,vertices[index++]=sprite.position.y,vertices[index++]=sprite.scale.x,vertices[index++]=sprite.scale.y,vertices[index++]=sprite.rotation,vertices[index++]=uvs.x0,vertices[index++]=uvs.y1,vertices[index++]=sprite.alpha,vertices[index++]=w0,vertices[index++]=h1,vertices[index++]=sprite.position.x,vertices[index++]=sprite.position.y,vertices[index++]=sprite.scale.x,vertices[index++]=sprite.scale.y,vertices[index++]=sprite.rotation,vertices[index++]=uvs.x1,vertices[index++]=uvs.y1,vertices[index++]=sprite.alpha,vertices[index++]=w0,vertices[index++]=h0,vertices[index++]=sprite.position.x,vertices[index++]=sprite.position.y,vertices[index++]=sprite.scale.x,vertices[index++]=sprite.scale.y,vertices[index++]=sprite.rotation,vertices[index++]=uvs.x2,vertices[index++]=uvs.y2,vertices[index++]=sprite.alpha,vertices[index++]=w1,vertices[index++]=h0,vertices[index++]=sprite.position.x,vertices[index++]=sprite.position.y,vertices[index++]=sprite.scale.x,vertices[index++]=sprite.scale.y,vertices[index++]=sprite.rotation,vertices[index++]=uvs.x3,vertices[index++]=uvs.y3,vertices[index++]=sprite.alpha,this.currentBatchSize++,this.currentBatchSize>=this.size&&this.flush()}},PIXI.WebGLFastSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var gl=this.gl;if(this.currentBaseTexture._glTextures[gl.id]||this.renderSession.renderer.updateTexture(this.currentBaseTexture,gl),gl.bindTexture(gl.TEXTURE_2D,this.currentBaseTexture._glTextures[gl.id]),this.currentBatchSize>.5*this.size)gl.bufferSubData(gl.ARRAY_BUFFER,0,this.vertices);else{var view=this.vertices.subarray(0,4*this.currentBatchSize*this.vertSize);gl.bufferSubData(gl.ARRAY_BUFFER,0,view)}gl.drawElements(gl.TRIANGLES,6*this.currentBatchSize,gl.UNSIGNED_SHORT,0),this.currentBatchSize=0,this.renderSession.drawCount++}},PIXI.WebGLFastSpriteBatch.prototype.stop=function(){this.flush()},PIXI.WebGLFastSpriteBatch.prototype.start=function(){var gl=this.gl;gl.activeTexture(gl.TEXTURE0),gl.bindBuffer(gl.ARRAY_BUFFER,this.vertexBuffer),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var projection=this.renderSession.projection;gl.uniform2f(this.shader.projectionVector,projection.x,projection.y),gl.uniformMatrix3fv(this.shader.uMatrix,!1,this.matrix);var stride=4*this.vertSize;gl.vertexAttribPointer(this.shader.aVertexPosition,2,gl.FLOAT,!1,stride,0),gl.vertexAttribPointer(this.shader.aPositionCoord,2,gl.FLOAT,!1,stride,8),gl.vertexAttribPointer(this.shader.aScale,2,gl.FLOAT,!1,stride,16),gl.vertexAttribPointer(this.shader.aRotation,1,gl.FLOAT,!1,stride,24),gl.vertexAttribPointer(this.shader.aTextureCoord,2,gl.FLOAT,!1,stride,28),gl.vertexAttribPointer(this.shader.colorAttribute,1,gl.FLOAT,!1,stride,36)},PIXI.WebGLFilterManager=function(){this.filterStack=[],this.offsetX=0,this.offsetY=0},PIXI.WebGLFilterManager.prototype.constructor=PIXI.WebGLFilterManager,PIXI.WebGLFilterManager.prototype.setContext=function(gl){this.gl=gl,this.texturePool=[],this.initShaderBuffers()},PIXI.WebGLFilterManager.prototype.begin=function(renderSession,buffer){this.renderSession=renderSession,this.defaultShader=renderSession.shaderManager.defaultShader;var projection=this.renderSession.projection;this.width=2*projection.x,this.height=2*-projection.y,this.buffer=buffer},PIXI.WebGLFilterManager.prototype.pushFilter=function(filterBlock){var gl=this.gl,projection=this.renderSession.projection,offset=this.renderSession.offset;filterBlock._filterArea=filterBlock.target.filterArea||filterBlock.target.getBounds(),this.filterStack.push(filterBlock);var filter=filterBlock.filterPasses[0];this.offsetX+=filterBlock._filterArea.x,this.offsetY+=filterBlock._filterArea.y;var texture=this.texturePool.pop();texture?texture.resize(this.width,this.height):texture=new PIXI.FilterTexture(this.gl,this.width,this.height),gl.bindTexture(gl.TEXTURE_2D,texture.texture);var filterArea=filterBlock._filterArea,padding=filter.padding;filterArea.x-=padding,filterArea.y-=padding,filterArea.width+=2*padding,filterArea.height+=2*padding,filterArea.x<0&&(filterArea.x=0),filterArea.width>this.width&&(filterArea.width=this.width),filterArea.y<0&&(filterArea.y=0),filterArea.height>this.height&&(filterArea.height=this.height),gl.bindFramebuffer(gl.FRAMEBUFFER,texture.frameBuffer),gl.viewport(0,0,filterArea.width,filterArea.height),projection.x=filterArea.width/2,projection.y=-filterArea.height/2,offset.x=-filterArea.x,offset.y=-filterArea.y,gl.colorMask(!0,!0,!0,!0),gl.clearColor(0,0,0,0),gl.clear(gl.COLOR_BUFFER_BIT),filterBlock._glFilterTexture=texture},PIXI.WebGLFilterManager.prototype.popFilter=function(){var gl=this.gl,filterBlock=this.filterStack.pop(),filterArea=filterBlock._filterArea,texture=filterBlock._glFilterTexture,projection=this.renderSession.projection,offset=this.renderSession.offset;if(filterBlock.filterPasses.length>1){gl.viewport(0,0,filterArea.width,filterArea.height),gl.bindBuffer(gl.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=0,this.vertexArray[1]=filterArea.height,this.vertexArray[2]=filterArea.width,this.vertexArray[3]=filterArea.height,this.vertexArray[4]=0,this.vertexArray[5]=0,this.vertexArray[6]=filterArea.width,this.vertexArray[7]=0,gl.bufferSubData(gl.ARRAY_BUFFER,0,this.vertexArray),gl.bindBuffer(gl.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=filterArea.width/this.width,this.uvArray[5]=filterArea.height/this.height,this.uvArray[6]=filterArea.width/this.width,this.uvArray[7]=filterArea.height/this.height,gl.bufferSubData(gl.ARRAY_BUFFER,0,this.uvArray);var inputTexture=texture,outputTexture=this.texturePool.pop();outputTexture||(outputTexture=new PIXI.FilterTexture(this.gl,this.width,this.height)),outputTexture.resize(this.width,this.height),gl.bindFramebuffer(gl.FRAMEBUFFER,outputTexture.frameBuffer),gl.clear(gl.COLOR_BUFFER_BIT),gl.disable(gl.BLEND);for(var i=0;i<filterBlock.filterPasses.length-1;i++){var filterPass=filterBlock.filterPasses[i];gl.bindFramebuffer(gl.FRAMEBUFFER,outputTexture.frameBuffer),gl.activeTexture(gl.TEXTURE0),gl.bindTexture(gl.TEXTURE_2D,inputTexture.texture),this.applyFilterPass(filterPass,filterArea,filterArea.width,filterArea.height);var temp=inputTexture;inputTexture=outputTexture,outputTexture=temp}gl.enable(gl.BLEND),texture=inputTexture,this.texturePool.push(outputTexture)}var filter=filterBlock.filterPasses[filterBlock.filterPasses.length-1];this.offsetX-=filterArea.x,this.offsetY-=filterArea.y;var sizeX=this.width,sizeY=this.height,offsetX=0,offsetY=0,buffer=this.buffer;if(0===this.filterStack.length)gl.colorMask(!0,!0,!0,!0);else{var currentFilter=this.filterStack[this.filterStack.length-1];filterArea=currentFilter._filterArea,sizeX=filterArea.width,sizeY=filterArea.height,offsetX=filterArea.x,offsetY=filterArea.y,buffer=currentFilter._glFilterTexture.frameBuffer}projection.x=sizeX/2,projection.y=-sizeY/2,offset.x=offsetX,offset.y=offsetY,filterArea=filterBlock._filterArea;var x=filterArea.x-offsetX,y=filterArea.y-offsetY;gl.bindBuffer(gl.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=x,this.vertexArray[1]=y+filterArea.height,this.vertexArray[2]=x+filterArea.width,this.vertexArray[3]=y+filterArea.height,this.vertexArray[4]=x,this.vertexArray[5]=y,this.vertexArray[6]=x+filterArea.width,this.vertexArray[7]=y,gl.bufferSubData(gl.ARRAY_BUFFER,0,this.vertexArray),gl.bindBuffer(gl.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=filterArea.width/this.width,this.uvArray[5]=filterArea.height/this.height,this.uvArray[6]=filterArea.width/this.width,this.uvArray[7]=filterArea.height/this.height,gl.bufferSubData(gl.ARRAY_BUFFER,0,this.uvArray),gl.viewport(0,0,sizeX*this.renderSession.resolution,sizeY*this.renderSession.resolution),gl.bindFramebuffer(gl.FRAMEBUFFER,buffer),gl.activeTexture(gl.TEXTURE0),gl.bindTexture(gl.TEXTURE_2D,texture.texture),this.applyFilterPass(filter,filterArea,sizeX,sizeY),this.texturePool.push(texture),filterBlock._glFilterTexture=null},PIXI.WebGLFilterManager.prototype.applyFilterPass=function(filter,filterArea,width,height){var gl=this.gl,shader=filter.shaders[gl.id];shader||(shader=new PIXI.PixiShader(gl),shader.fragmentSrc=filter.fragmentSrc,shader.uniforms=filter.uniforms,shader.init(),filter.shaders[gl.id]=shader),this.renderSession.shaderManager.setShader(shader),gl.uniform2f(shader.projectionVector,width/2,-height/2),gl.uniform2f(shader.offsetVector,0,0),filter.uniforms.dimensions&&(filter.uniforms.dimensions.value[0]=this.width,filter.uniforms.dimensions.value[1]=this.height,filter.uniforms.dimensions.value[2]=this.vertexArray[0],filter.uniforms.dimensions.value[3]=this.vertexArray[5]),shader.syncUniforms(),gl.bindBuffer(gl.ARRAY_BUFFER,this.vertexBuffer),gl.vertexAttribPointer(shader.aVertexPosition,2,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ARRAY_BUFFER,this.uvBuffer),gl.vertexAttribPointer(shader.aTextureCoord,2,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ARRAY_BUFFER,this.colorBuffer),gl.vertexAttribPointer(shader.colorAttribute,2,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer),gl.drawElements(gl.TRIANGLES,6,gl.UNSIGNED_SHORT,0),this.renderSession.drawCount++},PIXI.WebGLFilterManager.prototype.initShaderBuffers=function(){var gl=this.gl;this.vertexBuffer=gl.createBuffer(),this.uvBuffer=gl.createBuffer(),this.colorBuffer=gl.createBuffer(),this.indexBuffer=gl.createBuffer(),this.vertexArray=new PIXI.Float32Array([0,0,1,0,0,1,1,1]),gl.bindBuffer(gl.ARRAY_BUFFER,this.vertexBuffer),gl.bufferData(gl.ARRAY_BUFFER,this.vertexArray,gl.STATIC_DRAW),this.uvArray=new PIXI.Float32Array([0,0,1,0,0,1,1,1]),gl.bindBuffer(gl.ARRAY_BUFFER,this.uvBuffer),gl.bufferData(gl.ARRAY_BUFFER,this.uvArray,gl.STATIC_DRAW),this.colorArray=new PIXI.Float32Array([1,16777215,1,16777215,1,16777215,1,16777215]),gl.bindBuffer(gl.ARRAY_BUFFER,this.colorBuffer),gl.bufferData(gl.ARRAY_BUFFER,this.colorArray,gl.STATIC_DRAW),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer),gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),gl.STATIC_DRAW)},PIXI.WebGLFilterManager.prototype.destroy=function(){var gl=this.gl;this.filterStack=null,this.offsetX=0,this.offsetY=0;for(var i=0;i<this.texturePool.length;i++)this.texturePool[i].destroy();this.texturePool=null,gl.deleteBuffer(this.vertexBuffer),gl.deleteBuffer(this.uvBuffer),gl.deleteBuffer(this.colorBuffer),gl.deleteBuffer(this.indexBuffer)},PIXI.FilterTexture=function(gl,width,height,scaleMode){this.gl=gl,this.frameBuffer=gl.createFramebuffer(),this.texture=gl.createTexture(),scaleMode=scaleMode||PIXI.scaleModes.DEFAULT,gl.bindTexture(gl.TEXTURE_2D,this.texture),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,scaleMode===PIXI.scaleModes.LINEAR?gl.LINEAR:gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,scaleMode===PIXI.scaleModes.LINEAR?gl.LINEAR:gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.bindFramebuffer(gl.FRAMEBUFFER,this.frameBuffer),gl.bindFramebuffer(gl.FRAMEBUFFER,this.frameBuffer),gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,this.texture,0),this.renderBuffer=gl.createRenderbuffer(),gl.bindRenderbuffer(gl.RENDERBUFFER,this.renderBuffer),gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.DEPTH_STENCIL_ATTACHMENT,gl.RENDERBUFFER,this.renderBuffer),this.resize(width,height)},PIXI.FilterTexture.prototype.constructor=PIXI.FilterTexture,PIXI.FilterTexture.prototype.clear=function(){var gl=this.gl;gl.clearColor(0,0,0,0),gl.clear(gl.COLOR_BUFFER_BIT)},PIXI.FilterTexture.prototype.resize=function(width,height){if(this.width!==width||this.height!==height){this.width=width,this.height=height;var gl=this.gl;gl.bindTexture(gl.TEXTURE_2D,this.texture),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,width,height,0,gl.RGBA,gl.UNSIGNED_BYTE,null),gl.bindRenderbuffer(gl.RENDERBUFFER,this.renderBuffer),gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_STENCIL,width,height)}},PIXI.FilterTexture.prototype.destroy=function(){var gl=this.gl;gl.deleteFramebuffer(this.frameBuffer),gl.deleteTexture(this.texture),this.frameBuffer=null,this.texture=null},PIXI.CanvasBuffer=function(width,height){this.width=width,this.height=height,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=width,this.canvas.height=height},PIXI.CanvasBuffer.prototype.constructor=PIXI.CanvasBuffer,PIXI.CanvasBuffer.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.width,this.height)},PIXI.CanvasBuffer.prototype.resize=function(width,height){this.width=this.canvas.width=width,this.height=this.canvas.height=height},PIXI.CanvasMaskManager=function(){},PIXI.CanvasMaskManager.prototype.constructor=PIXI.CanvasMaskManager,PIXI.CanvasMaskManager.prototype.pushMask=function(maskData,renderSession){var context=renderSession.context;context.save();var cacheAlpha=maskData.alpha,transform=maskData.worldTransform,resolution=renderSession.resolution;context.setTransform(transform.a*resolution,transform.b*resolution,transform.c*resolution,transform.d*resolution,transform.tx*resolution,transform.ty*resolution),PIXI.CanvasGraphics.renderGraphicsMask(maskData,context),context.clip(),maskData.worldAlpha=cacheAlpha},PIXI.CanvasMaskManager.prototype.popMask=function(renderSession){renderSession.context.restore()},PIXI.CanvasTinter=function(){},PIXI.CanvasTinter.getTintedTexture=function(sprite,color){var texture=sprite.texture;color=PIXI.CanvasTinter.roundColor(color);var stringColor="#"+("00000"+(0|color).toString(16)).substr(-6);if(texture.tintCache=texture.tintCache||{},texture.tintCache[stringColor])return texture.tintCache[stringColor];var canvas=PIXI.CanvasTinter.canvas||document.createElement("canvas");if(PIXI.CanvasTinter.tintMethod(texture,color,canvas),PIXI.CanvasTinter.convertTintToImage){var tintImage=new Image;tintImage.src=canvas.toDataURL(),texture.tintCache[stringColor]=tintImage}else texture.tintCache[stringColor]=canvas,PIXI.CanvasTinter.canvas=null;return canvas},PIXI.CanvasTinter.tintWithMultiply=function(texture,color,canvas){var context=canvas.getContext("2d"),crop=texture.crop;canvas.width=crop.width,canvas.height=crop.height,context.fillStyle="#"+("00000"+(0|color).toString(16)).substr(-6),context.fillRect(0,0,crop.width,crop.height),context.globalCompositeOperation="multiply",context.drawImage(texture.baseTexture.source,crop.x,crop.y,crop.width,crop.height,0,0,crop.width,crop.height),context.globalCompositeOperation="destination-atop",context.drawImage(texture.baseTexture.source,crop.x,crop.y,crop.width,crop.height,0,0,crop.width,crop.height)},PIXI.CanvasTinter.tintWithOverlay=function(texture,color,canvas){var context=canvas.getContext("2d"),crop=texture.crop;canvas.width=crop.width,canvas.height=crop.height,context.globalCompositeOperation="copy",context.fillStyle="#"+("00000"+(0|color).toString(16)).substr(-6),
context.fillRect(0,0,crop.width,crop.height),context.globalCompositeOperation="destination-atop",context.drawImage(texture.baseTexture.source,crop.x,crop.y,crop.width,crop.height,0,0,crop.width,crop.height)},PIXI.CanvasTinter.tintWithPerPixel=function(texture,color,canvas){var context=canvas.getContext("2d"),crop=texture.crop;canvas.width=crop.width,canvas.height=crop.height,context.globalCompositeOperation="copy",context.drawImage(texture.baseTexture.source,crop.x,crop.y,crop.width,crop.height,0,0,crop.width,crop.height);for(var rgbValues=PIXI.hex2rgb(color),r=rgbValues[0],g=rgbValues[1],b=rgbValues[2],pixelData=context.getImageData(0,0,crop.width,crop.height),pixels=pixelData.data,i=0;i<pixels.length;i+=4)pixels[i+0]*=r,pixels[i+1]*=g,pixels[i+2]*=b;context.putImageData(pixelData,0,0)},PIXI.CanvasTinter.roundColor=function(color){var step=PIXI.CanvasTinter.cacheStepsPerColorChannel,rgbValues=PIXI.hex2rgb(color);return rgbValues[0]=Math.min(255,rgbValues[0]/step*step),rgbValues[1]=Math.min(255,rgbValues[1]/step*step),rgbValues[2]=Math.min(255,rgbValues[2]/step*step),PIXI.rgb2hex(rgbValues)},PIXI.CanvasTinter.cacheStepsPerColorChannel=8,PIXI.CanvasTinter.convertTintToImage=!1,PIXI.CanvasTinter.canUseMultiply=PIXI.canUseNewCanvasBlendModes(),PIXI.CanvasTinter.tintMethod=PIXI.CanvasTinter.canUseMultiply?PIXI.CanvasTinter.tintWithMultiply:PIXI.CanvasTinter.tintWithPerPixel,PIXI.CanvasRenderer=function(width,height,options){if(options)for(var i in PIXI.defaultRenderOptions)"undefined"==typeof options[i]&&(options[i]=PIXI.defaultRenderOptions[i]);else options=PIXI.defaultRenderOptions;PIXI.defaultRenderer||(PIXI.sayHello("Canvas"),PIXI.defaultRenderer=this),this.type=PIXI.CANVAS_RENDERER,this.resolution=options.resolution,this.clearBeforeRender=options.clearBeforeRender,this.transparent=options.transparent,this.autoResize=options.autoResize||!1,this.width=width||800,this.height=height||600,this.width*=this.resolution,this.height*=this.resolution,this.view=options.view||document.createElement("canvas"),this.context=this.view.getContext("2d",{alpha:this.transparent}),this.refresh=!0,this.view.width=this.width*this.resolution,this.view.height=this.height*this.resolution,this.count=0,this.maskManager=new PIXI.CanvasMaskManager,this.renderSession={context:this.context,maskManager:this.maskManager,scaleMode:null,smoothProperty:null,roundPixels:!1},this.mapBlendModes(),this.resize(width,height),"imageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="imageSmoothingEnabled":"webkitImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="webkitImageSmoothingEnabled":"mozImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="mozImageSmoothingEnabled":"oImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="oImageSmoothingEnabled":"msImageSmoothingEnabled"in this.context&&(this.renderSession.smoothProperty="msImageSmoothingEnabled")},PIXI.CanvasRenderer.prototype.constructor=PIXI.CanvasRenderer,PIXI.CanvasRenderer.prototype.render=function(stage){stage.updateTransform(),this.context.setTransform(1,0,0,1,0,0),this.context.globalAlpha=1,this.renderSession.currentBlendMode=PIXI.blendModes.NORMAL,this.context.globalCompositeOperation=PIXI.blendModesCanvas[PIXI.blendModes.NORMAL],navigator.isCocoonJS&&this.view.screencanvas&&(this.context.fillStyle="black",this.context.clear()),this.clearBeforeRender&&(this.transparent?this.context.clearRect(0,0,this.width,this.height):(this.context.fillStyle=stage.backgroundColorString,this.context.fillRect(0,0,this.width,this.height))),this.renderDisplayObject(stage),stage.interactive&&(stage._interactiveEventsAdded||(stage._interactiveEventsAdded=!0,stage.interactionManager.setTarget(this)))},PIXI.CanvasRenderer.prototype.destroy=function(removeView){"undefined"==typeof removeView&&(removeView=!0),removeView&&this.view.parent&&this.view.parent.removeChild(this.view),this.view=null,this.context=null,this.maskManager=null,this.renderSession=null},PIXI.CanvasRenderer.prototype.resize=function(width,height){this.width=width*this.resolution,this.height=height*this.resolution,this.view.width=this.width,this.view.height=this.height,this.autoResize&&(this.view.style.width=this.width/this.resolution+"px",this.view.style.height=this.height/this.resolution+"px")},PIXI.CanvasRenderer.prototype.renderDisplayObject=function(displayObject,context){this.renderSession.context=context||this.context,this.renderSession.resolution=this.resolution,displayObject._renderCanvas(this.renderSession)},PIXI.CanvasRenderer.prototype.mapBlendModes=function(){PIXI.blendModesCanvas||(PIXI.blendModesCanvas=[],PIXI.canUseNewCanvasBlendModes()?(PIXI.blendModesCanvas[PIXI.blendModes.NORMAL]="source-over",PIXI.blendModesCanvas[PIXI.blendModes.ADD]="lighter",PIXI.blendModesCanvas[PIXI.blendModes.MULTIPLY]="multiply",PIXI.blendModesCanvas[PIXI.blendModes.SCREEN]="screen",PIXI.blendModesCanvas[PIXI.blendModes.OVERLAY]="overlay",PIXI.blendModesCanvas[PIXI.blendModes.DARKEN]="darken",PIXI.blendModesCanvas[PIXI.blendModes.LIGHTEN]="lighten",PIXI.blendModesCanvas[PIXI.blendModes.COLOR_DODGE]="color-dodge",PIXI.blendModesCanvas[PIXI.blendModes.COLOR_BURN]="color-burn",PIXI.blendModesCanvas[PIXI.blendModes.HARD_LIGHT]="hard-light",PIXI.blendModesCanvas[PIXI.blendModes.SOFT_LIGHT]="soft-light",PIXI.blendModesCanvas[PIXI.blendModes.DIFFERENCE]="difference",PIXI.blendModesCanvas[PIXI.blendModes.EXCLUSION]="exclusion",PIXI.blendModesCanvas[PIXI.blendModes.HUE]="hue",PIXI.blendModesCanvas[PIXI.blendModes.SATURATION]="saturation",PIXI.blendModesCanvas[PIXI.blendModes.COLOR]="color",PIXI.blendModesCanvas[PIXI.blendModes.LUMINOSITY]="luminosity"):(PIXI.blendModesCanvas[PIXI.blendModes.NORMAL]="source-over",PIXI.blendModesCanvas[PIXI.blendModes.ADD]="lighter",PIXI.blendModesCanvas[PIXI.blendModes.MULTIPLY]="source-over",PIXI.blendModesCanvas[PIXI.blendModes.SCREEN]="source-over",PIXI.blendModesCanvas[PIXI.blendModes.OVERLAY]="source-over",PIXI.blendModesCanvas[PIXI.blendModes.DARKEN]="source-over",PIXI.blendModesCanvas[PIXI.blendModes.LIGHTEN]="source-over",PIXI.blendModesCanvas[PIXI.blendModes.COLOR_DODGE]="source-over",PIXI.blendModesCanvas[PIXI.blendModes.COLOR_BURN]="source-over",PIXI.blendModesCanvas[PIXI.blendModes.HARD_LIGHT]="source-over",PIXI.blendModesCanvas[PIXI.blendModes.SOFT_LIGHT]="source-over",PIXI.blendModesCanvas[PIXI.blendModes.DIFFERENCE]="source-over",PIXI.blendModesCanvas[PIXI.blendModes.EXCLUSION]="source-over",PIXI.blendModesCanvas[PIXI.blendModes.HUE]="source-over",PIXI.blendModesCanvas[PIXI.blendModes.SATURATION]="source-over",PIXI.blendModesCanvas[PIXI.blendModes.COLOR]="source-over",PIXI.blendModesCanvas[PIXI.blendModes.LUMINOSITY]="source-over"))},PIXI.CanvasGraphics=function(){},PIXI.CanvasGraphics.renderGraphics=function(graphics,context){var worldAlpha=graphics.worldAlpha;graphics.dirty&&(this.updateGraphicsTint(graphics),graphics.dirty=!1);for(var i=0;i<graphics.graphicsData.length;i++){var data=graphics.graphicsData[i],shape=data.shape,fillColor=data._fillTint,lineColor=data._lineTint;if(context.lineWidth=data.lineWidth,data.type===PIXI.Graphics.POLY){context.beginPath();var points=shape.points;context.moveTo(points[0],points[1]);for(var j=1;j<points.length/2;j++)context.lineTo(points[2*j],points[2*j+1]);shape.closed&&context.lineTo(points[0],points[1]),points[0]===points[points.length-2]&&points[1]===points[points.length-1]&&context.closePath(),data.fill&&(context.globalAlpha=data.fillAlpha*worldAlpha,context.fillStyle="#"+("00000"+(0|fillColor).toString(16)).substr(-6),context.fill()),data.lineWidth&&(context.globalAlpha=data.lineAlpha*worldAlpha,context.strokeStyle="#"+("00000"+(0|lineColor).toString(16)).substr(-6),context.stroke())}else if(data.type===PIXI.Graphics.RECT)(data.fillColor||0===data.fillColor)&&(context.globalAlpha=data.fillAlpha*worldAlpha,context.fillStyle="#"+("00000"+(0|fillColor).toString(16)).substr(-6),context.fillRect(shape.x,shape.y,shape.width,shape.height)),data.lineWidth&&(context.globalAlpha=data.lineAlpha*worldAlpha,context.strokeStyle="#"+("00000"+(0|lineColor).toString(16)).substr(-6),context.strokeRect(shape.x,shape.y,shape.width,shape.height));else if(data.type===PIXI.Graphics.CIRC)context.beginPath(),context.arc(shape.x,shape.y,shape.radius,0,2*Math.PI),context.closePath(),data.fill&&(context.globalAlpha=data.fillAlpha*worldAlpha,context.fillStyle="#"+("00000"+(0|fillColor).toString(16)).substr(-6),context.fill()),data.lineWidth&&(context.globalAlpha=data.lineAlpha*worldAlpha,context.strokeStyle="#"+("00000"+(0|lineColor).toString(16)).substr(-6),context.stroke());else if(data.type===PIXI.Graphics.ELIP){var w=2*shape.width,h=2*shape.height,x=shape.x-w/2,y=shape.y-h/2;context.beginPath();var kappa=.5522848,ox=w/2*kappa,oy=h/2*kappa,xe=x+w,ye=y+h,xm=x+w/2,ym=y+h/2;context.moveTo(x,ym),context.bezierCurveTo(x,ym-oy,xm-ox,y,xm,y),context.bezierCurveTo(xm+ox,y,xe,ym-oy,xe,ym),context.bezierCurveTo(xe,ym+oy,xm+ox,ye,xm,ye),context.bezierCurveTo(xm-ox,ye,x,ym+oy,x,ym),context.closePath(),data.fill&&(context.globalAlpha=data.fillAlpha*worldAlpha,context.fillStyle="#"+("00000"+(0|fillColor).toString(16)).substr(-6),context.fill()),data.lineWidth&&(context.globalAlpha=data.lineAlpha*worldAlpha,context.strokeStyle="#"+("00000"+(0|lineColor).toString(16)).substr(-6),context.stroke())}else if(data.type===PIXI.Graphics.RREC){var rx=shape.x,ry=shape.y,width=shape.width,height=shape.height,radius=shape.radius,maxRadius=Math.min(width,height)/2|0;radius=radius>maxRadius?maxRadius:radius,context.beginPath(),context.moveTo(rx,ry+radius),context.lineTo(rx,ry+height-radius),context.quadraticCurveTo(rx,ry+height,rx+radius,ry+height),context.lineTo(rx+width-radius,ry+height),context.quadraticCurveTo(rx+width,ry+height,rx+width,ry+height-radius),context.lineTo(rx+width,ry+radius),context.quadraticCurveTo(rx+width,ry,rx+width-radius,ry),context.lineTo(rx+radius,ry),context.quadraticCurveTo(rx,ry,rx,ry+radius),context.closePath(),(data.fillColor||0===data.fillColor)&&(context.globalAlpha=data.fillAlpha*worldAlpha,context.fillStyle="#"+("00000"+(0|fillColor).toString(16)).substr(-6),context.fill()),data.lineWidth&&(context.globalAlpha=data.lineAlpha*worldAlpha,context.strokeStyle="#"+("00000"+(0|lineColor).toString(16)).substr(-6),context.stroke())}}},PIXI.CanvasGraphics.renderGraphicsMask=function(graphics,context){var len=graphics.graphicsData.length;if(0!==len){len>1&&(len=1,window.console.log("Pixi.js warning: masks in canvas can only mask using the first path in the graphics object"));for(var i=0;1>i;i++){var data=graphics.graphicsData[i],shape=data.shape;if(data.type===PIXI.Graphics.POLY){context.beginPath();var points=shape.points;context.moveTo(points[0],points[1]);for(var j=1;j<points.length/2;j++)context.lineTo(points[2*j],points[2*j+1]);points[0]===points[points.length-2]&&points[1]===points[points.length-1]&&context.closePath()}else if(data.type===PIXI.Graphics.RECT)context.beginPath(),context.rect(shape.x,shape.y,shape.width,shape.height),context.closePath();else if(data.type===PIXI.Graphics.CIRC)context.beginPath(),context.arc(shape.x,shape.y,shape.radius,0,2*Math.PI),context.closePath();else if(data.type===PIXI.Graphics.ELIP){var w=2*shape.width,h=2*shape.height,x=shape.x-w/2,y=shape.y-h/2;context.beginPath();var kappa=.5522848,ox=w/2*kappa,oy=h/2*kappa,xe=x+w,ye=y+h,xm=x+w/2,ym=y+h/2;context.moveTo(x,ym),context.bezierCurveTo(x,ym-oy,xm-ox,y,xm,y),context.bezierCurveTo(xm+ox,y,xe,ym-oy,xe,ym),context.bezierCurveTo(xe,ym+oy,xm+ox,ye,xm,ye),context.bezierCurveTo(xm-ox,ye,x,ym+oy,x,ym),context.closePath()}else if(data.type===PIXI.Graphics.RREC){var pts=shape.points,rx=pts[0],ry=pts[1],width=pts[2],height=pts[3],radius=pts[4],maxRadius=Math.min(width,height)/2|0;radius=radius>maxRadius?maxRadius:radius,context.beginPath(),context.moveTo(rx,ry+radius),context.lineTo(rx,ry+height-radius),context.quadraticCurveTo(rx,ry+height,rx+radius,ry+height),context.lineTo(rx+width-radius,ry+height),context.quadraticCurveTo(rx+width,ry+height,rx+width,ry+height-radius),context.lineTo(rx+width,ry+radius),context.quadraticCurveTo(rx+width,ry,rx+width-radius,ry),context.lineTo(rx+radius,ry),context.quadraticCurveTo(rx,ry,rx,ry+radius),context.closePath()}}}},PIXI.CanvasGraphics.updateGraphicsTint=function(graphics){if(16777215!==graphics.tint)for(var tintR=(graphics.tint>>16&255)/255,tintG=(graphics.tint>>8&255)/255,tintB=(255&graphics.tint)/255,i=0;i<graphics.graphicsData.length;i++){var data=graphics.graphicsData[i],fillColor=0|data.fillColor,lineColor=0|data.lineColor;data._fillTint=((fillColor>>16&255)/255*tintR*255<<16)+((fillColor>>8&255)/255*tintG*255<<8)+(255&fillColor)/255*tintB*255,data._lineTint=((lineColor>>16&255)/255*tintR*255<<16)+((lineColor>>8&255)/255*tintG*255<<8)+(255&lineColor)/255*tintB*255}},PIXI.Graphics=function(){PIXI.DisplayObjectContainer.call(this),this.renderable=!0,this.fillAlpha=1,this.lineWidth=0,this.lineColor=0,this.graphicsData=[],this.tint=16777215,this.blendMode=PIXI.blendModes.NORMAL,this.currentPath=null,this._webGL=[],this.isMask=!1,this.boundsPadding=0,this._localBounds=new PIXI.Rectangle(0,0,1,1),this.dirty=!0,this.webGLDirty=!1,this.cachedSpriteDirty=!1},PIXI.Graphics.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),PIXI.Graphics.prototype.constructor=PIXI.Graphics,Object.defineProperty(PIXI.Graphics.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(value){this._cacheAsBitmap=value,this._cacheAsBitmap?this._generateCachedSprite():(this.destroyCachedSprite(),this.dirty=!0)}}),PIXI.Graphics.prototype.lineStyle=function(lineWidth,color,alpha){if(this.lineWidth=lineWidth||0,this.lineColor=color||0,this.lineAlpha=void 0===alpha?1:alpha,this.currentPath){if(this.currentPath.shape.points.length)return this.drawShape(new PIXI.Polygon(this.currentPath.shape.points.slice(-2))),this;this.currentPath.lineWidth=this.lineWidth,this.currentPath.lineColor=this.lineColor,this.currentPath.lineAlpha=this.lineAlpha}return this},PIXI.Graphics.prototype.moveTo=function(x,y){return this.drawShape(new PIXI.Polygon([x,y])),this},PIXI.Graphics.prototype.lineTo=function(x,y){return this.currentPath.shape.points.push(x,y),this.dirty=!0,this},PIXI.Graphics.prototype.quadraticCurveTo=function(cpX,cpY,toX,toY){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);var xa,ya,n=20,points=this.currentPath.shape.points;0===points.length&&this.moveTo(0,0);for(var fromX=points[points.length-2],fromY=points[points.length-1],j=0,i=1;n>=i;i++)j=i/n,xa=fromX+(cpX-fromX)*j,ya=fromY+(cpY-fromY)*j,points.push(xa+(cpX+(toX-cpX)*j-xa)*j,ya+(cpY+(toY-cpY)*j-ya)*j);return this.dirty=!0,this},PIXI.Graphics.prototype.bezierCurveTo=function(cpX,cpY,cpX2,cpY2,toX,toY){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);for(var dt,dt2,dt3,t2,t3,n=20,points=this.currentPath.shape.points,fromX=points[points.length-2],fromY=points[points.length-1],j=0,i=1;n>=i;i++)j=i/n,dt=1-j,dt2=dt*dt,dt3=dt2*dt,t2=j*j,t3=t2*j,points.push(dt3*fromX+3*dt2*j*cpX+3*dt*t2*cpX2+t3*toX,dt3*fromY+3*dt2*j*cpY+3*dt*t2*cpY2+t3*toY);return this.dirty=!0,this},PIXI.Graphics.prototype.arcTo=function(x1,y1,x2,y2,radius){this.currentPath?0===this.currentPath.shape.points.length&&this.currentPath.shape.points.push(x1,y1):this.moveTo(x1,y1);var points=this.currentPath.shape.points,fromX=points[points.length-2],fromY=points[points.length-1],a1=fromY-y1,b1=fromX-x1,a2=y2-y1,b2=x2-x1,mm=Math.abs(a1*b2-b1*a2);if(1e-8>mm||0===radius)(points[points.length-2]!==x1||points[points.length-1]!==y1)&&points.push(x1,y1);else{var dd=a1*a1+b1*b1,cc=a2*a2+b2*b2,tt=a1*a2+b1*b2,k1=radius*Math.sqrt(dd)/mm,k2=radius*Math.sqrt(cc)/mm,j1=k1*tt/dd,j2=k2*tt/cc,cx=k1*b2+k2*b1,cy=k1*a2+k2*a1,px=b1*(k2+j1),py=a1*(k2+j1),qx=b2*(k1+j2),qy=a2*(k1+j2),startAngle=Math.atan2(py-cy,px-cx),endAngle=Math.atan2(qy-cy,qx-cx);this.arc(cx+x1,cy+y1,radius,startAngle,endAngle,b1*a2>b2*a1)}return this.dirty=!0,this},PIXI.Graphics.prototype.arc=function(cx,cy,radius,startAngle,endAngle,anticlockwise){if(anticlockwise=anticlockwise||!1,startAngle===endAngle)return this;!anticlockwise&&startAngle>=endAngle?endAngle+=2*Math.PI:anticlockwise&&endAngle>=startAngle&&(startAngle+=2*Math.PI);var sweep=anticlockwise?-1*(startAngle-endAngle):endAngle-startAngle,segs=Math.abs(sweep)/(2*Math.PI)*40;if(0===sweep)return this;var startX=cx+Math.cos(startAngle)*radius,startY=cy+Math.sin(startAngle)*radius;anticlockwise&&this.filling?this.moveTo(cx,cy):this.moveTo(startX,startY);for(var points=this.currentPath.shape.points,theta=sweep/(2*segs),theta2=2*theta,cTheta=Math.cos(theta),sTheta=Math.sin(theta),segMinus=segs-1,remainder=segMinus%1/segMinus,i=0;segMinus>=i;i++){var real=i+remainder*i,angle=theta+startAngle+theta2*real,c=Math.cos(angle),s=-Math.sin(angle);points.push((cTheta*c+sTheta*s)*radius+cx,(cTheta*-s+sTheta*c)*radius+cy)}return this.dirty=!0,this},PIXI.Graphics.prototype.beginFill=function(color,alpha){return this.filling=!0,this.fillColor=color||0,this.fillAlpha=void 0===alpha?1:alpha,this.currentPath&&this.currentPath.shape.points.length<=2&&(this.currentPath.fill=this.filling,this.currentPath.fillColor=this.fillColor,this.currentPath.fillAlpha=this.fillAlpha),this},PIXI.Graphics.prototype.endFill=function(){return this.filling=!1,this.fillColor=null,this.fillAlpha=1,this},PIXI.Graphics.prototype.drawRect=function(x,y,width,height){return this.drawShape(new PIXI.Rectangle(x,y,width,height)),this},PIXI.Graphics.prototype.drawRoundedRect=function(x,y,width,height,radius){return this.drawShape(new PIXI.RoundedRectangle(x,y,width,height,radius)),this},PIXI.Graphics.prototype.drawCircle=function(x,y,radius){return this.drawShape(new PIXI.Circle(x,y,radius)),this},PIXI.Graphics.prototype.drawEllipse=function(x,y,width,height){return this.drawShape(new PIXI.Ellipse(x,y,width,height)),this},PIXI.Graphics.prototype.drawPolygon=function(path){return path instanceof Array||(path=Array.prototype.slice.call(arguments)),this.drawShape(new PIXI.Polygon(path)),this},PIXI.Graphics.prototype.clear=function(){return this.lineWidth=0,this.filling=!1,this.dirty=!0,this.clearDirty=!0,this.graphicsData=[],this},PIXI.Graphics.prototype.generateTexture=function(resolution,scaleMode){resolution=resolution||1;var bounds=this.getBounds(),canvasBuffer=new PIXI.CanvasBuffer(bounds.width*resolution,bounds.height*resolution),texture=PIXI.Texture.fromCanvas(canvasBuffer.canvas,scaleMode);return texture.baseTexture.resolution=resolution,canvasBuffer.context.scale(resolution,resolution),canvasBuffer.context.translate(-bounds.x,-bounds.y),PIXI.CanvasGraphics.renderGraphics(this,canvasBuffer.context),texture},PIXI.Graphics.prototype._renderWebGL=function(renderSession){if(this.visible!==!1&&0!==this.alpha&&this.isMask!==!0){if(this._cacheAsBitmap)return(this.dirty||this.cachedSpriteDirty)&&(this._generateCachedSprite(),this.updateCachedSpriteTexture(),this.cachedSpriteDirty=!1,this.dirty=!1),this._cachedSprite.worldAlpha=this.worldAlpha,void PIXI.Sprite.prototype._renderWebGL.call(this._cachedSprite,renderSession);if(renderSession.spriteBatch.stop(),renderSession.blendModeManager.setBlendMode(this.blendMode),this._mask&&renderSession.maskManager.pushMask(this._mask,renderSession),this._filters&&renderSession.filterManager.pushFilter(this._filterBlock),this.blendMode!==renderSession.spriteBatch.currentBlendMode){renderSession.spriteBatch.currentBlendMode=this.blendMode;var blendModeWebGL=PIXI.blendModesWebGL[renderSession.spriteBatch.currentBlendMode];renderSession.spriteBatch.gl.blendFunc(blendModeWebGL[0],blendModeWebGL[1])}if(this.webGLDirty&&(this.dirty=!0,this.webGLDirty=!1),PIXI.WebGLGraphics.renderGraphics(this,renderSession),this.children.length){renderSession.spriteBatch.start();for(var i=0,j=this.children.length;j>i;i++)this.children[i]._renderWebGL(renderSession);renderSession.spriteBatch.stop()}this._filters&&renderSession.filterManager.popFilter(),this._mask&&renderSession.maskManager.popMask(this.mask,renderSession),renderSession.drawCount++,renderSession.spriteBatch.start()}},PIXI.Graphics.prototype._renderCanvas=function(renderSession){if(this.visible!==!1&&0!==this.alpha&&this.isMask!==!0){if(this._cacheAsBitmap)return(this.dirty||this.cachedSpriteDirty)&&(this._generateCachedSprite(),this.updateCachedSpriteTexture(),this.cachedSpriteDirty=!1,this.dirty=!1),this._cachedSprite.alpha=this.alpha,void PIXI.Sprite.prototype._renderCanvas.call(this._cachedSprite,renderSession);var context=renderSession.context,transform=this.worldTransform;this.blendMode!==renderSession.currentBlendMode&&(renderSession.currentBlendMode=this.blendMode,context.globalCompositeOperation=PIXI.blendModesCanvas[renderSession.currentBlendMode]),this._mask&&renderSession.maskManager.pushMask(this._mask,renderSession);var resolution=renderSession.resolution;context.setTransform(transform.a*resolution,transform.b*resolution,transform.c*resolution,transform.d*resolution,transform.tx*resolution,transform.ty*resolution),PIXI.CanvasGraphics.renderGraphics(this,context);for(var i=0,j=this.children.length;j>i;i++)this.children[i]._renderCanvas(renderSession);this._mask&&renderSession.maskManager.popMask(renderSession)}},PIXI.Graphics.prototype.getBounds=function(matrix){if(this.isMask)return PIXI.EmptyRectangle;this.dirty&&(this.updateLocalBounds(),this.webGLDirty=!0,this.cachedSpriteDirty=!0,this.dirty=!1);var bounds=this._localBounds,w0=bounds.x,w1=bounds.width+bounds.x,h0=bounds.y,h1=bounds.height+bounds.y,worldTransform=matrix||this.worldTransform,a=worldTransform.a,b=worldTransform.b,c=worldTransform.c,d=worldTransform.d,tx=worldTransform.tx,ty=worldTransform.ty,x1=a*w1+c*h1+tx,y1=d*h1+b*w1+ty,x2=a*w0+c*h1+tx,y2=d*h1+b*w0+ty,x3=a*w0+c*h0+tx,y3=d*h0+b*w0+ty,x4=a*w1+c*h0+tx,y4=d*h0+b*w1+ty,maxX=x1,maxY=y1,minX=x1,minY=y1;return minX=minX>x2?x2:minX,minX=minX>x3?x3:minX,minX=minX>x4?x4:minX,minY=minY>y2?y2:minY,minY=minY>y3?y3:minY,minY=minY>y4?y4:minY,maxX=x2>maxX?x2:maxX,maxX=x3>maxX?x3:maxX,maxX=x4>maxX?x4:maxX,maxY=y2>maxY?y2:maxY,maxY=y3>maxY?y3:maxY,maxY=y4>maxY?y4:maxY,this._bounds.x=minX,this._bounds.width=maxX-minX,this._bounds.y=minY,this._bounds.height=maxY-minY,this._bounds},PIXI.Graphics.prototype.updateLocalBounds=function(){var minX=1/0,maxX=-(1/0),minY=1/0,maxY=-(1/0);if(this.graphicsData.length)for(var shape,points,x,y,w,h,i=0;i<this.graphicsData.length;i++){var data=this.graphicsData[i],type=data.type,lineWidth=data.lineWidth;if(shape=data.shape,type===PIXI.Graphics.RECT||type===PIXI.Graphics.RREC)x=shape.x-lineWidth/2,y=shape.y-lineWidth/2,w=shape.width+lineWidth,h=shape.height+lineWidth,minX=minX>x?x:minX,maxX=x+w>maxX?x+w:maxX,minY=minY>y?y:minY,maxY=y+h>maxY?y+h:maxY;else if(type===PIXI.Graphics.CIRC)x=shape.x,y=shape.y,w=shape.radius+lineWidth/2,h=shape.radius+lineWidth/2,minX=minX>x-w?x-w:minX,maxX=x+w>maxX?x+w:maxX,minY=minY>y-h?y-h:minY,maxY=y+h>maxY?y+h:maxY;else if(type===PIXI.Graphics.ELIP)x=shape.x,y=shape.y,w=shape.width+lineWidth/2,h=shape.height+lineWidth/2,minX=minX>x-w?x-w:minX,maxX=x+w>maxX?x+w:maxX,minY=minY>y-h?y-h:minY,maxY=y+h>maxY?y+h:maxY;else{points=shape.points;for(var j=0;j<points.length;j+=2)x=points[j],y=points[j+1],minX=minX>x-lineWidth?x-lineWidth:minX,maxX=x+lineWidth>maxX?x+lineWidth:maxX,minY=minY>y-lineWidth?y-lineWidth:minY,maxY=y+lineWidth>maxY?y+lineWidth:maxY}}else minX=0,maxX=0,minY=0,maxY=0;var padding=this.boundsPadding;this._localBounds.x=minX-padding,this._localBounds.width=maxX-minX+2*padding,this._localBounds.y=minY-padding,this._localBounds.height=maxY-minY+2*padding},PIXI.Graphics.prototype._generateCachedSprite=function(){var bounds=this.getLocalBounds();if(this._cachedSprite)this._cachedSprite.buffer.resize(bounds.width,bounds.height);else{var canvasBuffer=new PIXI.CanvasBuffer(bounds.width,bounds.height),texture=PIXI.Texture.fromCanvas(canvasBuffer.canvas);this._cachedSprite=new PIXI.Sprite(texture),this._cachedSprite.buffer=canvasBuffer,this._cachedSprite.worldTransform=this.worldTransform}this._cachedSprite.anchor.x=-(bounds.x/bounds.width),this._cachedSprite.anchor.y=-(bounds.y/bounds.height),this._cachedSprite.buffer.context.translate(-bounds.x,-bounds.y),this.worldAlpha=1,PIXI.CanvasGraphics.renderGraphics(this,this._cachedSprite.buffer.context),this._cachedSprite.alpha=this.alpha},PIXI.Graphics.prototype.updateCachedSpriteTexture=function(){var cachedSprite=this._cachedSprite,texture=cachedSprite.texture,canvas=cachedSprite.buffer.canvas;texture.baseTexture.width=canvas.width,texture.baseTexture.height=canvas.height,texture.crop.width=texture.frame.width=canvas.width,texture.crop.height=texture.frame.height=canvas.height,cachedSprite._width=canvas.width,cachedSprite._height=canvas.height,texture.baseTexture.dirty()},PIXI.Graphics.prototype.destroyCachedSprite=function(){this._cachedSprite.texture.destroy(!0),this._cachedSprite=null},PIXI.Graphics.prototype.drawShape=function(shape){this.currentPath&&this.currentPath.shape.points.length<=2&&this.graphicsData.pop(),this.currentPath=null;var data=new PIXI.GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.filling,shape);return this.graphicsData.push(data),data.type===PIXI.Graphics.POLY&&(data.shape.closed=this.filling,this.currentPath=data),this.dirty=!0,data},PIXI.GraphicsData=function(lineWidth,lineColor,lineAlpha,fillColor,fillAlpha,fill,shape){this.lineWidth=lineWidth,this.lineColor=lineColor,this.lineAlpha=lineAlpha,this._lineTint=lineColor,this.fillColor=fillColor,this.fillAlpha=fillAlpha,this._fillTint=fillColor,this.fill=fill,this.shape=shape,this.type=shape.type},PIXI.Graphics.POLY=0,PIXI.Graphics.RECT=1,PIXI.Graphics.CIRC=2,PIXI.Graphics.ELIP=3,PIXI.Graphics.RREC=4,PIXI.Polygon.prototype.type=PIXI.Graphics.POLY,PIXI.Rectangle.prototype.type=PIXI.Graphics.RECT,PIXI.Circle.prototype.type=PIXI.Graphics.CIRC,PIXI.Ellipse.prototype.type=PIXI.Graphics.ELIP,PIXI.RoundedRectangle.prototype.type=PIXI.Graphics.RREC,PIXI.Strip=function(texture){PIXI.DisplayObjectContainer.call(this),this.texture=texture,this.uvs=new PIXI.Float32Array([0,1,1,1,1,0,0,1]),this.vertices=new PIXI.Float32Array([0,0,100,0,100,100,0,100]),this.colors=new PIXI.Float32Array([1,1,1,1]),this.indices=new PIXI.Uint16Array([0,1,2,3]),this.dirty=!0,this.blendMode=PIXI.blendModes.NORMAL,this.canvasPadding=0,this.drawMode=PIXI.Strip.DrawModes.TRIANGLE_STRIP},PIXI.Strip.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),PIXI.Strip.prototype.constructor=PIXI.Strip,PIXI.Strip.prototype._renderWebGL=function(renderSession){!this.visible||this.alpha<=0||(renderSession.spriteBatch.stop(),this._vertexBuffer||this._initWebGL(renderSession),renderSession.shaderManager.setShader(renderSession.shaderManager.stripShader),this._renderStrip(renderSession),renderSession.spriteBatch.start())},PIXI.Strip.prototype._initWebGL=function(renderSession){var gl=renderSession.gl;this._vertexBuffer=gl.createBuffer(),this._indexBuffer=gl.createBuffer(),this._uvBuffer=gl.createBuffer(),this._colorBuffer=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,this._vertexBuffer),gl.bufferData(gl.ARRAY_BUFFER,this.vertices,gl.DYNAMIC_DRAW),gl.bindBuffer(gl.ARRAY_BUFFER,this._uvBuffer),gl.bufferData(gl.ARRAY_BUFFER,this.uvs,gl.STATIC_DRAW),gl.bindBuffer(gl.ARRAY_BUFFER,this._colorBuffer),gl.bufferData(gl.ARRAY_BUFFER,this.colors,gl.STATIC_DRAW),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this._indexBuffer),gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,this.indices,gl.STATIC_DRAW)},PIXI.Strip.prototype._renderStrip=function(renderSession){var gl=renderSession.gl,projection=renderSession.projection,offset=renderSession.offset,shader=renderSession.shaderManager.stripShader,drawMode=this.drawMode===PIXI.Strip.DrawModes.TRIANGLE_STRIP?gl.TRIANGLE_STRIP:gl.TRIANGLES;renderSession.blendModeManager.setBlendMode(this.blendMode),gl.uniformMatrix3fv(shader.translationMatrix,!1,this.worldTransform.toArray(!0)),gl.uniform2f(shader.projectionVector,projection.x,-projection.y),gl.uniform2f(shader.offsetVector,-offset.x,-offset.y),gl.uniform1f(shader.alpha,this.worldAlpha),this.dirty?(this.dirty=!1,gl.bindBuffer(gl.ARRAY_BUFFER,this._vertexBuffer),gl.bufferData(gl.ARRAY_BUFFER,this.vertices,gl.STATIC_DRAW),gl.vertexAttribPointer(shader.aVertexPosition,2,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ARRAY_BUFFER,this._uvBuffer),gl.bufferData(gl.ARRAY_BUFFER,this.uvs,gl.STATIC_DRAW),gl.vertexAttribPointer(shader.aTextureCoord,2,gl.FLOAT,!1,0,0),gl.activeTexture(gl.TEXTURE0),this.texture.baseTexture._dirty[gl.id]?renderSession.renderer.updateTexture(this.texture.baseTexture):gl.bindTexture(gl.TEXTURE_2D,this.texture.baseTexture._glTextures[gl.id]),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this._indexBuffer),gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,this.indices,gl.STATIC_DRAW)):(gl.bindBuffer(gl.ARRAY_BUFFER,this._vertexBuffer),gl.bufferSubData(gl.ARRAY_BUFFER,0,this.vertices),gl.vertexAttribPointer(shader.aVertexPosition,2,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ARRAY_BUFFER,this._uvBuffer),gl.vertexAttribPointer(shader.aTextureCoord,2,gl.FLOAT,!1,0,0),gl.activeTexture(gl.TEXTURE0),this.texture.baseTexture._dirty[gl.id]?renderSession.renderer.updateTexture(this.texture.baseTexture):gl.bindTexture(gl.TEXTURE_2D,this.texture.baseTexture._glTextures[gl.id]),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this._indexBuffer)),gl.drawElements(drawMode,this.indices.length,gl.UNSIGNED_SHORT,0)},PIXI.Strip.prototype._renderCanvas=function(renderSession){var context=renderSession.context,transform=this.worldTransform;renderSession.roundPixels?context.setTransform(transform.a,transform.b,transform.c,transform.d,0|transform.tx,0|transform.ty):context.setTransform(transform.a,transform.b,transform.c,transform.d,transform.tx,transform.ty),this.drawMode===PIXI.Strip.DrawModes.TRIANGLE_STRIP?this._renderCanvasTriangleStrip(context):this._renderCanvasTriangles(context)},PIXI.Strip.prototype._renderCanvasTriangleStrip=function(context){var vertices=this.vertices,uvs=this.uvs,length=vertices.length/2;this.count++;for(var i=0;length-2>i;i++){var index=2*i;this._renderCanvasDrawTriangle(context,vertices,uvs,index,index+2,index+4)}},PIXI.Strip.prototype._renderCanvasTriangles=function(context){var vertices=this.vertices,uvs=this.uvs,indices=this.indices,length=indices.length;this.count++;for(var i=0;length>i;i+=3){var index0=2*indices[i],index1=2*indices[i+1],index2=2*indices[i+2];this._renderCanvasDrawTriangle(context,vertices,uvs,index0,index1,index2)}},PIXI.Strip.prototype._renderCanvasDrawTriangle=function(context,vertices,uvs,index0,index1,index2){var textureSource=this.texture.baseTexture.source,textureWidth=this.texture.width,textureHeight=this.texture.height,x0=vertices[index0],x1=vertices[index1],x2=vertices[index2],y0=vertices[index0+1],y1=vertices[index1+1],y2=vertices[index2+1],u0=uvs[index0]*textureWidth,u1=uvs[index1]*textureWidth,u2=uvs[index2]*textureWidth,v0=uvs[index0+1]*textureHeight,v1=uvs[index1+1]*textureHeight,v2=uvs[index2+1]*textureHeight;if(this.canvasPadding>0){var paddingX=this.canvasPadding/this.worldTransform.a,paddingY=this.canvasPadding/this.worldTransform.d,centerX=(x0+x1+x2)/3,centerY=(y0+y1+y2)/3,normX=x0-centerX,normY=y0-centerY,dist=Math.sqrt(normX*normX+normY*normY);x0=centerX+normX/dist*(dist+paddingX),y0=centerY+normY/dist*(dist+paddingY),normX=x1-centerX,normY=y1-centerY,dist=Math.sqrt(normX*normX+normY*normY),x1=centerX+normX/dist*(dist+paddingX),y1=centerY+normY/dist*(dist+paddingY),normX=x2-centerX,normY=y2-centerY,dist=Math.sqrt(normX*normX+normY*normY),x2=centerX+normX/dist*(dist+paddingX),y2=centerY+normY/dist*(dist+paddingY)}context.save(),context.beginPath(),context.moveTo(x0,y0),context.lineTo(x1,y1),context.lineTo(x2,y2),context.closePath(),context.clip();var delta=u0*v1+v0*u2+u1*v2-v1*u2-v0*u1-u0*v2,deltaA=x0*v1+v0*x2+x1*v2-v1*x2-v0*x1-x0*v2,deltaB=u0*x1+x0*u2+u1*x2-x1*u2-x0*u1-u0*x2,deltaC=u0*v1*x2+v0*x1*u2+x0*u1*v2-x0*v1*u2-v0*u1*x2-u0*x1*v2,deltaD=y0*v1+v0*y2+y1*v2-v1*y2-v0*y1-y0*v2,deltaE=u0*y1+y0*u2+u1*y2-y1*u2-y0*u1-u0*y2,deltaF=u0*v1*y2+v0*y1*u2+y0*u1*v2-y0*v1*u2-v0*u1*y2-u0*y1*v2;
context.transform(deltaA/delta,deltaD/delta,deltaB/delta,deltaE/delta,deltaC/delta,deltaF/delta),context.drawImage(textureSource,0,0),context.restore()},PIXI.Strip.prototype.renderStripFlat=function(strip){var context=this.context,vertices=strip.vertices,length=vertices.length/2;this.count++,context.beginPath();for(var i=1;length-2>i;i++){var index=2*i,x0=vertices[index],x1=vertices[index+2],x2=vertices[index+4],y0=vertices[index+1],y1=vertices[index+3],y2=vertices[index+5];context.moveTo(x0,y0),context.lineTo(x1,y1),context.lineTo(x2,y2)}context.fillStyle="#FF0000",context.fill(),context.closePath()},PIXI.Strip.prototype.onTextureUpdate=function(){this.updateFrame=!0},PIXI.Strip.prototype.getBounds=function(matrix){for(var worldTransform=matrix||this.worldTransform,a=worldTransform.a,b=worldTransform.b,c=worldTransform.c,d=worldTransform.d,tx=worldTransform.tx,ty=worldTransform.ty,maxX=-(1/0),maxY=-(1/0),minX=1/0,minY=1/0,vertices=this.vertices,i=0,n=vertices.length;n>i;i+=2){var rawX=vertices[i],rawY=vertices[i+1],x=a*rawX+c*rawY+tx,y=d*rawY+b*rawX+ty;minX=minX>x?x:minX,minY=minY>y?y:minY,maxX=x>maxX?x:maxX,maxY=y>maxY?y:maxY}if(minX===-(1/0)||maxY===1/0)return PIXI.EmptyRectangle;var bounds=this._bounds;return bounds.x=minX,bounds.width=maxX-minX,bounds.y=minY,bounds.height=maxY-minY,this._currentBounds=bounds,bounds},PIXI.Strip.DrawModes={TRIANGLE_STRIP:0,TRIANGLES:1},PIXI.Rope=function(texture,points){PIXI.Strip.call(this,texture),this.points=points,this.vertices=new PIXI.Float32Array(4*points.length),this.uvs=new PIXI.Float32Array(4*points.length),this.colors=new PIXI.Float32Array(2*points.length),this.indices=new PIXI.Uint16Array(2*points.length),this.refresh()},PIXI.Rope.prototype=Object.create(PIXI.Strip.prototype),PIXI.Rope.prototype.constructor=PIXI.Rope,PIXI.Rope.prototype.refresh=function(){var points=this.points;if(!(points.length<1)){var uvs=this.uvs,lastPoint=points[0],indices=this.indices,colors=this.colors;this.count-=.2,uvs[0]=0,uvs[1]=0,uvs[2]=0,uvs[3]=1,colors[0]=1,colors[1]=1,indices[0]=0,indices[1]=1;for(var point,index,amount,total=points.length,i=1;total>i;i++)point=points[i],index=4*i,amount=i/(total-1),i%2?(uvs[index]=amount,uvs[index+1]=0,uvs[index+2]=amount,uvs[index+3]=1):(uvs[index]=amount,uvs[index+1]=0,uvs[index+2]=amount,uvs[index+3]=1),index=2*i,colors[index]=1,colors[index+1]=1,index=2*i,indices[index]=index,indices[index+1]=index+1,lastPoint=point}},PIXI.Rope.prototype.updateTransform=function(){var points=this.points;if(!(points.length<1)){var nextPoint,lastPoint=points[0],perp={x:0,y:0};this.count-=.2;for(var point,index,ratio,perpLength,num,vertices=this.vertices,total=points.length,i=0;total>i;i++)point=points[i],index=4*i,nextPoint=i<points.length-1?points[i+1]:point,perp.y=-(nextPoint.x-lastPoint.x),perp.x=nextPoint.y-lastPoint.y,ratio=10*(1-i/(total-1)),ratio>1&&(ratio=1),perpLength=Math.sqrt(perp.x*perp.x+perp.y*perp.y),num=this.texture.height/2,perp.x/=perpLength,perp.y/=perpLength,perp.x*=num,perp.y*=num,vertices[index]=point.x+perp.x,vertices[index+1]=point.y+perp.y,vertices[index+2]=point.x-perp.x,vertices[index+3]=point.y-perp.y,lastPoint=point;PIXI.DisplayObjectContainer.prototype.updateTransform.call(this)}},PIXI.Rope.prototype.setTexture=function(texture){this.texture=texture},PIXI.TilingSprite=function(texture,width,height){PIXI.Sprite.call(this,texture),this._width=width||100,this._height=height||100,this.tileScale=new PIXI.Point(1,1),this.tileScaleOffset=new PIXI.Point(1,1),this.tilePosition=new PIXI.Point(0,0),this.renderable=!0,this.tint=16777215,this.blendMode=PIXI.blendModes.NORMAL},PIXI.TilingSprite.prototype=Object.create(PIXI.Sprite.prototype),PIXI.TilingSprite.prototype.constructor=PIXI.TilingSprite,Object.defineProperty(PIXI.TilingSprite.prototype,"width",{get:function(){return this._width},set:function(value){this._width=value}}),Object.defineProperty(PIXI.TilingSprite.prototype,"height",{get:function(){return this._height},set:function(value){this._height=value}}),PIXI.TilingSprite.prototype.setTexture=function(texture){this.texture!==texture&&(this.texture=texture,this.refreshTexture=!0,this.cachedTint=16777215)},PIXI.TilingSprite.prototype._renderWebGL=function(renderSession){if(this.visible!==!1&&0!==this.alpha){var i,j;for(this._mask&&(renderSession.spriteBatch.stop(),renderSession.maskManager.pushMask(this.mask,renderSession),renderSession.spriteBatch.start()),this._filters&&(renderSession.spriteBatch.flush(),renderSession.filterManager.pushFilter(this._filterBlock)),!this.tilingTexture||this.refreshTexture?(this.generateTilingTexture(!0),this.tilingTexture&&this.tilingTexture.needsUpdate&&(renderSession.renderer.updateTexture(this.tilingTexture.baseTexture),this.tilingTexture.needsUpdate=!1)):renderSession.spriteBatch.renderTilingSprite(this),i=0,j=this.children.length;j>i;i++)this.children[i]._renderWebGL(renderSession);renderSession.spriteBatch.stop(),this._filters&&renderSession.filterManager.popFilter(),this._mask&&renderSession.maskManager.popMask(this._mask,renderSession),renderSession.spriteBatch.start()}},PIXI.TilingSprite.prototype._renderCanvas=function(renderSession){if(this.visible!==!1&&0!==this.alpha){var context=renderSession.context;this._mask&&renderSession.maskManager.pushMask(this._mask,renderSession),context.globalAlpha=this.worldAlpha;var i,j,transform=this.worldTransform,resolution=renderSession.resolution;if(context.setTransform(transform.a*resolution,transform.b*resolution,transform.c*resolution,transform.d*resolution,transform.tx*resolution,transform.ty*resolution),!this.__tilePattern||this.refreshTexture){if(this.generateTilingTexture(!1),!this.tilingTexture)return;this.__tilePattern=context.createPattern(this.tilingTexture.baseTexture.source,"repeat")}this.blendMode!==renderSession.currentBlendMode&&(renderSession.currentBlendMode=this.blendMode,context.globalCompositeOperation=PIXI.blendModesCanvas[renderSession.currentBlendMode]);var tilePosition=this.tilePosition,tileScale=this.tileScale;for(tilePosition.x%=this.tilingTexture.baseTexture.width,tilePosition.y%=this.tilingTexture.baseTexture.height,context.scale(tileScale.x,tileScale.y),context.translate(tilePosition.x+this.anchor.x*-this._width,tilePosition.y+this.anchor.y*-this._height),context.fillStyle=this.__tilePattern,context.fillRect(-tilePosition.x,-tilePosition.y,this._width/tileScale.x,this._height/tileScale.y),context.scale(1/tileScale.x,1/tileScale.y),context.translate(-tilePosition.x+this.anchor.x*this._width,-tilePosition.y+this.anchor.y*this._height),this._mask&&renderSession.maskManager.popMask(renderSession),i=0,j=this.children.length;j>i;i++)this.children[i]._renderCanvas(renderSession)}},PIXI.TilingSprite.prototype.getBounds=function(){var width=this._width,height=this._height,w0=width*(1-this.anchor.x),w1=width*-this.anchor.x,h0=height*(1-this.anchor.y),h1=height*-this.anchor.y,worldTransform=this.worldTransform,a=worldTransform.a,b=worldTransform.b,c=worldTransform.c,d=worldTransform.d,tx=worldTransform.tx,ty=worldTransform.ty,x1=a*w1+c*h1+tx,y1=d*h1+b*w1+ty,x2=a*w0+c*h1+tx,y2=d*h1+b*w0+ty,x3=a*w0+c*h0+tx,y3=d*h0+b*w0+ty,x4=a*w1+c*h0+tx,y4=d*h0+b*w1+ty,maxX=-(1/0),maxY=-(1/0),minX=1/0,minY=1/0;minX=minX>x1?x1:minX,minX=minX>x2?x2:minX,minX=minX>x3?x3:minX,minX=minX>x4?x4:minX,minY=minY>y1?y1:minY,minY=minY>y2?y2:minY,minY=minY>y3?y3:minY,minY=minY>y4?y4:minY,maxX=x1>maxX?x1:maxX,maxX=x2>maxX?x2:maxX,maxX=x3>maxX?x3:maxX,maxX=x4>maxX?x4:maxX,maxY=y1>maxY?y1:maxY,maxY=y2>maxY?y2:maxY,maxY=y3>maxY?y3:maxY,maxY=y4>maxY?y4:maxY;var bounds=this._bounds;return bounds.x=minX,bounds.width=maxX-minX,bounds.y=minY,bounds.height=maxY-minY,this._currentBounds=bounds,bounds},PIXI.TilingSprite.prototype.onTextureUpdate=function(){},PIXI.TilingSprite.prototype.generateTilingTexture=function(forcePowerOfTwo){if(this.texture.baseTexture.hasLoaded){var targetWidth,targetHeight,texture=this.originalTexture||this.texture,frame=texture.frame,isFrame=frame.width!==texture.baseTexture.width||frame.height!==texture.baseTexture.height,newTextureRequired=!1;if(forcePowerOfTwo?(targetWidth=PIXI.getNextPowerOfTwo(frame.width),targetHeight=PIXI.getNextPowerOfTwo(frame.height),(frame.width!==targetWidth||frame.height!==targetHeight||texture.baseTexture.width!==targetWidth||texture.baseTexture.height||targetHeight)&&(newTextureRequired=!0)):isFrame&&(texture.trim?(targetWidth=texture.trim.width,targetHeight=texture.trim.height):(targetWidth=frame.width,targetHeight=frame.height),newTextureRequired=!0),newTextureRequired){var canvasBuffer;this.tilingTexture&&this.tilingTexture.isTiling?(canvasBuffer=this.tilingTexture.canvasBuffer,canvasBuffer.resize(targetWidth,targetHeight),this.tilingTexture.baseTexture.width=targetWidth,this.tilingTexture.baseTexture.height=targetHeight,this.tilingTexture.needsUpdate=!0):(canvasBuffer=new PIXI.CanvasBuffer(targetWidth,targetHeight),this.tilingTexture=PIXI.Texture.fromCanvas(canvasBuffer.canvas),this.tilingTexture.canvasBuffer=canvasBuffer,this.tilingTexture.isTiling=!0),canvasBuffer.context.drawImage(texture.baseTexture.source,texture.crop.x,texture.crop.y,texture.crop.width,texture.crop.height,0,0,targetWidth,targetHeight),this.tileScaleOffset.x=frame.width/targetWidth,this.tileScaleOffset.y=frame.height/targetHeight}else this.tilingTexture&&this.tilingTexture.isTiling&&this.tilingTexture.destroy(!0),this.tileScaleOffset.x=1,this.tileScaleOffset.y=1,this.tilingTexture=texture;this.refreshTexture=!1,this.originalTexture=this.texture,this.texture=this.tilingTexture,this.tilingTexture.baseTexture._powerOf2=!0}},PIXI.TilingSprite.prototype.destroy=function(){PIXI.Sprite.prototype.destroy.call(this),this.tileScale=null,this.tileScaleOffset=null,this.tilePosition=null,this.tilingTexture&&(this.tilingTexture.destroy(!0),this.tilingTexture=null)};var spine={radDeg:180/Math.PI,degRad:Math.PI/180,temp:[],Float32Array:"undefined"==typeof Float32Array?Array:Float32Array,Uint16Array:"undefined"==typeof Uint16Array?Array:Uint16Array};spine.BoneData=function(name,parent){this.name=name,this.parent=parent},spine.BoneData.prototype={length:0,x:0,y:0,rotation:0,scaleX:1,scaleY:1,inheritScale:!0,inheritRotation:!0,flipX:!1,flipY:!1},spine.SlotData=function(name,boneData){this.name=name,this.boneData=boneData},spine.SlotData.prototype={r:1,g:1,b:1,a:1,attachmentName:null,additiveBlending:!1},spine.IkConstraintData=function(name){this.name=name,this.bones=[]},spine.IkConstraintData.prototype={target:null,bendDirection:1,mix:1},spine.Bone=function(boneData,skeleton,parent){this.data=boneData,this.skeleton=skeleton,this.parent=parent,this.setToSetupPose()},spine.Bone.yDown=!1,spine.Bone.prototype={x:0,y:0,rotation:0,rotationIK:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,m00:0,m01:0,worldX:0,m10:0,m11:0,worldY:0,worldRotation:0,worldScaleX:1,worldScaleY:1,worldFlipX:!1,worldFlipY:!1,updateWorldTransform:function(){var parent=this.parent;if(parent)this.worldX=this.x*parent.m00+this.y*parent.m01+parent.worldX,this.worldY=this.x*parent.m10+this.y*parent.m11+parent.worldY,this.data.inheritScale?(this.worldScaleX=parent.worldScaleX*this.scaleX,this.worldScaleY=parent.worldScaleY*this.scaleY):(this.worldScaleX=this.scaleX,this.worldScaleY=this.scaleY),this.worldRotation=this.data.inheritRotation?parent.worldRotation+this.rotationIK:this.rotationIK,this.worldFlipX=parent.worldFlipX!=this.flipX,this.worldFlipY=parent.worldFlipY!=this.flipY;else{var skeletonFlipX=this.skeleton.flipX,skeletonFlipY=this.skeleton.flipY;this.worldX=skeletonFlipX?-this.x:this.x,this.worldY=skeletonFlipY!=spine.Bone.yDown?-this.y:this.y,this.worldScaleX=this.scaleX,this.worldScaleY=this.scaleY,this.worldRotation=this.rotationIK,this.worldFlipX=skeletonFlipX!=this.flipX,this.worldFlipY=skeletonFlipY!=this.flipY}var radians=this.worldRotation*spine.degRad,cos=Math.cos(radians),sin=Math.sin(radians);this.worldFlipX?(this.m00=-cos*this.worldScaleX,this.m01=sin*this.worldScaleY):(this.m00=cos*this.worldScaleX,this.m01=-sin*this.worldScaleY),this.worldFlipY!=spine.Bone.yDown?(this.m10=-sin*this.worldScaleX,this.m11=-cos*this.worldScaleY):(this.m10=sin*this.worldScaleX,this.m11=cos*this.worldScaleY)},setToSetupPose:function(){var data=this.data;this.x=data.x,this.y=data.y,this.rotation=data.rotation,this.rotationIK=this.rotation,this.scaleX=data.scaleX,this.scaleY=data.scaleY,this.flipX=data.flipX,this.flipY=data.flipY},worldToLocal:function(world){var dx=world[0]-this.worldX,dy=world[1]-this.worldY,m00=this.m00,m10=this.m10,m01=this.m01,m11=this.m11;this.worldFlipX!=(this.worldFlipY!=spine.Bone.yDown)&&(m00=-m00,m11=-m11);var invDet=1/(m00*m11-m01*m10);world[0]=dx*m00*invDet-dy*m01*invDet,world[1]=dy*m11*invDet-dx*m10*invDet},localToWorld:function(local){var localX=local[0],localY=local[1];local[0]=localX*this.m00+localY*this.m01+this.worldX,local[1]=localX*this.m10+localY*this.m11+this.worldY}},spine.Slot=function(slotData,bone){this.data=slotData,this.bone=bone,this.setToSetupPose()},spine.Slot.prototype={r:1,g:1,b:1,a:1,_attachmentTime:0,attachment:null,attachmentVertices:[],setAttachment:function(attachment){this.attachment=attachment,this._attachmentTime=this.bone.skeleton.time,this.attachmentVertices.length=0},setAttachmentTime:function(time){this._attachmentTime=this.bone.skeleton.time-time},getAttachmentTime:function(){return this.bone.skeleton.time-this._attachmentTime},setToSetupPose:function(){var data=this.data;this.r=data.r,this.g=data.g,this.b=data.b,this.a=data.a;for(var slotDatas=this.bone.skeleton.data.slots,i=0,n=slotDatas.length;n>i;i++)if(slotDatas[i]==data){this.setAttachment(data.attachmentName?this.bone.skeleton.getAttachmentBySlotIndex(i,data.attachmentName):null);break}}},spine.IkConstraint=function(data,skeleton){this.data=data,this.mix=data.mix,this.bendDirection=data.bendDirection,this.bones=[];for(var i=0,n=data.bones.length;n>i;i++)this.bones.push(skeleton.findBone(data.bones[i].name));this.target=skeleton.findBone(data.target.name)},spine.IkConstraint.prototype={apply:function(){var target=this.target,bones=this.bones;switch(bones.length){case 1:spine.IkConstraint.apply1(bones[0],target.worldX,target.worldY,this.mix);break;case 2:spine.IkConstraint.apply2(bones[0],bones[1],target.worldX,target.worldY,this.bendDirection,this.mix)}}},spine.IkConstraint.apply1=function(bone,targetX,targetY,alpha){var parentRotation=bone.data.inheritRotation&&bone.parent?bone.parent.worldRotation:0,rotation=bone.rotation,rotationIK=Math.atan2(targetY-bone.worldY,targetX-bone.worldX)*spine.radDeg-parentRotation;bone.rotationIK=rotation+(rotationIK-rotation)*alpha},spine.IkConstraint.apply2=function(parent,child,targetX,targetY,bendDirection,alpha){var childRotation=child.rotation,parentRotation=parent.rotation;if(!alpha)return child.rotationIK=childRotation,void(parent.rotationIK=parentRotation);var positionX,positionY,tempPosition=spine.temp,parentParent=parent.parent;parentParent?(tempPosition[0]=targetX,tempPosition[1]=targetY,parentParent.worldToLocal(tempPosition),targetX=(tempPosition[0]-parent.x)*parentParent.worldScaleX,targetY=(tempPosition[1]-parent.y)*parentParent.worldScaleY):(targetX-=parent.x,targetY-=parent.y),child.parent==parent?(positionX=child.x,positionY=child.y):(tempPosition[0]=child.x,tempPosition[1]=child.y,child.parent.localToWorld(tempPosition),parent.worldToLocal(tempPosition),positionX=tempPosition[0],positionY=tempPosition[1]);var childX=positionX*parent.worldScaleX,childY=positionY*parent.worldScaleY,offset=Math.atan2(childY,childX),len1=Math.sqrt(childX*childX+childY*childY),len2=child.data.length*child.worldScaleX,cosDenom=2*len1*len2;if(1e-4>cosDenom)return void(child.rotationIK=childRotation+(Math.atan2(targetY,targetX)*spine.radDeg-parentRotation-childRotation)*alpha);var cos=(targetX*targetX+targetY*targetY-len1*len1-len2*len2)/cosDenom;-1>cos?cos=-1:cos>1&&(cos=1);var childAngle=Math.acos(cos)*bendDirection,adjacent=len1+len2*cos,opposite=len2*Math.sin(childAngle),parentAngle=Math.atan2(targetY*adjacent-targetX*opposite,targetX*adjacent+targetY*opposite),rotation=(parentAngle-offset)*spine.radDeg-parentRotation;rotation>180?rotation-=360:-180>rotation&&(rotation+=360),parent.rotationIK=parentRotation+rotation*alpha,rotation=(childAngle+offset)*spine.radDeg-childRotation,rotation>180?rotation-=360:-180>rotation&&(rotation+=360),child.rotationIK=childRotation+(rotation+parent.worldRotation-child.parent.worldRotation)*alpha},spine.Skin=function(name){this.name=name,this.attachments={}},spine.Skin.prototype={addAttachment:function(slotIndex,name,attachment){this.attachments[slotIndex+":"+name]=attachment},getAttachment:function(slotIndex,name){return this.attachments[slotIndex+":"+name]},_attachAll:function(skeleton,oldSkin){for(var key in oldSkin.attachments){var colon=key.indexOf(":"),slotIndex=parseInt(key.substring(0,colon)),name=key.substring(colon+1),slot=skeleton.slots[slotIndex];if(slot.attachment&&slot.attachment.name==name){var attachment=this.getAttachment(slotIndex,name);attachment&&slot.setAttachment(attachment)}}}},spine.Animation=function(name,timelines,duration){this.name=name,this.timelines=timelines,this.duration=duration},spine.Animation.prototype={apply:function(skeleton,lastTime,time,loop,events){loop&&0!=this.duration&&(time%=this.duration,lastTime%=this.duration);for(var timelines=this.timelines,i=0,n=timelines.length;n>i;i++)timelines[i].apply(skeleton,lastTime,time,events,1)},mix:function(skeleton,lastTime,time,loop,events,alpha){loop&&0!=this.duration&&(time%=this.duration,lastTime%=this.duration);for(var timelines=this.timelines,i=0,n=timelines.length;n>i;i++)timelines[i].apply(skeleton,lastTime,time,events,alpha)}},spine.Animation.binarySearch=function(values,target,step){var low=0,high=Math.floor(values.length/step)-2;if(!high)return step;for(var current=high>>>1;;){if(values[(current+1)*step]<=target?low=current+1:high=current,low==high)return(low+1)*step;current=low+high>>>1}},spine.Animation.binarySearch1=function(values,target){var low=0,high=values.length-2;if(!high)return 1;for(var current=high>>>1;;){if(values[current+1]<=target?low=current+1:high=current,low==high)return low+1;current=low+high>>>1}},spine.Animation.linearSearch=function(values,target,step){for(var i=0,last=values.length-step;last>=i;i+=step)if(values[i]>target)return i;return-1},spine.Curves=function(frameCount){this.curves=[]},spine.Curves.prototype={setLinear:function(frameIndex){this.curves[19*frameIndex]=0},setStepped:function(frameIndex){this.curves[19*frameIndex]=1},setCurve:function(frameIndex,cx1,cy1,cx2,cy2){var subdiv1=.1,subdiv2=subdiv1*subdiv1,subdiv3=subdiv2*subdiv1,pre1=3*subdiv1,pre2=3*subdiv2,pre4=6*subdiv2,pre5=6*subdiv3,tmp1x=2*-cx1+cx2,tmp1y=2*-cy1+cy2,tmp2x=3*(cx1-cx2)+1,tmp2y=3*(cy1-cy2)+1,dfx=cx1*pre1+tmp1x*pre2+tmp2x*subdiv3,dfy=cy1*pre1+tmp1y*pre2+tmp2y*subdiv3,ddfx=tmp1x*pre4+tmp2x*pre5,ddfy=tmp1y*pre4+tmp2y*pre5,dddfx=tmp2x*pre5,dddfy=tmp2y*pre5,i=19*frameIndex,curves=this.curves;curves[i++]=2;for(var x=dfx,y=dfy,n=i+19-1;n>i;i+=2)curves[i]=x,curves[i+1]=y,dfx+=ddfx,dfy+=ddfy,ddfx+=dddfx,ddfy+=dddfy,x+=dfx,y+=dfy},getCurvePercent:function(frameIndex,percent){percent=0>percent?0:percent>1?1:percent;var curves=this.curves,i=19*frameIndex,type=curves[i];if(0===type)return percent;if(1==type)return 0;i++;for(var x=0,start=i,n=i+19-1;n>i;i+=2)if(x=curves[i],x>=percent){var prevX,prevY;return i==start?(prevX=0,prevY=0):(prevX=curves[i-2],prevY=curves[i-1]),prevY+(curves[i+1]-prevY)*(percent-prevX)/(x-prevX)}var y=curves[i-1];return y+(1-y)*(percent-x)/(1-x)}},spine.RotateTimeline=function(frameCount){this.curves=new spine.Curves(frameCount),this.frames=[],this.frames.length=2*frameCount},spine.RotateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(frameIndex,time,angle){frameIndex*=2,this.frames[frameIndex]=time,this.frames[frameIndex+1]=angle},apply:function(skeleton,lastTime,time,firedEvents,alpha){var frames=this.frames;if(!(time<frames[0])){var bone=skeleton.bones[this.boneIndex];if(time>=frames[frames.length-2]){for(var amount=bone.data.rotation+frames[frames.length-1]-bone.rotation;amount>180;)amount-=360;for(;-180>amount;)amount+=360;return void(bone.rotation+=amount*alpha)}var frameIndex=spine.Animation.binarySearch(frames,time,2),prevFrameValue=frames[frameIndex-1],frameTime=frames[frameIndex],percent=1-(time-frameTime)/(frames[frameIndex-2]-frameTime);percent=this.curves.getCurvePercent(frameIndex/2-1,percent);for(var amount=frames[frameIndex+1]-prevFrameValue;amount>180;)amount-=360;for(;-180>amount;)amount+=360;for(amount=bone.data.rotation+(prevFrameValue+amount*percent)-bone.rotation;amount>180;)amount-=360;for(;-180>amount;)amount+=360;bone.rotation+=amount*alpha}}},spine.TranslateTimeline=function(frameCount){this.curves=new spine.Curves(frameCount),this.frames=[],this.frames.length=3*frameCount},spine.TranslateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(frameIndex,time,x,y){frameIndex*=3,this.frames[frameIndex]=time,this.frames[frameIndex+1]=x,this.frames[frameIndex+2]=y},apply:function(skeleton,lastTime,time,firedEvents,alpha){var frames=this.frames;if(!(time<frames[0])){var bone=skeleton.bones[this.boneIndex];if(time>=frames[frames.length-3])return bone.x+=(bone.data.x+frames[frames.length-2]-bone.x)*alpha,void(bone.y+=(bone.data.y+frames[frames.length-1]-bone.y)*alpha);var frameIndex=spine.Animation.binarySearch(frames,time,3),prevFrameX=frames[frameIndex-2],prevFrameY=frames[frameIndex-1],frameTime=frames[frameIndex],percent=1-(time-frameTime)/(frames[frameIndex+-3]-frameTime);percent=this.curves.getCurvePercent(frameIndex/3-1,percent),bone.x+=(bone.data.x+prevFrameX+(frames[frameIndex+1]-prevFrameX)*percent-bone.x)*alpha,bone.y+=(bone.data.y+prevFrameY+(frames[frameIndex+2]-prevFrameY)*percent-bone.y)*alpha}}},spine.ScaleTimeline=function(frameCount){this.curves=new spine.Curves(frameCount),this.frames=[],this.frames.length=3*frameCount},spine.ScaleTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(frameIndex,time,x,y){frameIndex*=3,this.frames[frameIndex]=time,this.frames[frameIndex+1]=x,this.frames[frameIndex+2]=y},apply:function(skeleton,lastTime,time,firedEvents,alpha){var frames=this.frames;if(!(time<frames[0])){var bone=skeleton.bones[this.boneIndex];if(time>=frames[frames.length-3])return bone.scaleX+=(bone.data.scaleX*frames[frames.length-2]-bone.scaleX)*alpha,void(bone.scaleY+=(bone.data.scaleY*frames[frames.length-1]-bone.scaleY)*alpha);var frameIndex=spine.Animation.binarySearch(frames,time,3),prevFrameX=frames[frameIndex-2],prevFrameY=frames[frameIndex-1],frameTime=frames[frameIndex],percent=1-(time-frameTime)/(frames[frameIndex+-3]-frameTime);percent=this.curves.getCurvePercent(frameIndex/3-1,percent),bone.scaleX+=(bone.data.scaleX*(prevFrameX+(frames[frameIndex+1]-prevFrameX)*percent)-bone.scaleX)*alpha,bone.scaleY+=(bone.data.scaleY*(prevFrameY+(frames[frameIndex+2]-prevFrameY)*percent)-bone.scaleY)*alpha}}},spine.ColorTimeline=function(frameCount){this.curves=new spine.Curves(frameCount),this.frames=[],this.frames.length=5*frameCount},spine.ColorTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length/5},setFrame:function(frameIndex,time,r,g,b,a){frameIndex*=5,this.frames[frameIndex]=time,this.frames[frameIndex+1]=r,this.frames[frameIndex+2]=g,this.frames[frameIndex+3]=b,this.frames[frameIndex+4]=a},apply:function(skeleton,lastTime,time,firedEvents,alpha){var frames=this.frames;if(!(time<frames[0])){var r,g,b,a;if(time>=frames[frames.length-5]){var i=frames.length-1;r=frames[i-3],g=frames[i-2],b=frames[i-1],a=frames[i]}else{var frameIndex=spine.Animation.binarySearch(frames,time,5),prevFrameR=frames[frameIndex-4],prevFrameG=frames[frameIndex-3],prevFrameB=frames[frameIndex-2],prevFrameA=frames[frameIndex-1],frameTime=frames[frameIndex],percent=1-(time-frameTime)/(frames[frameIndex-5]-frameTime);percent=this.curves.getCurvePercent(frameIndex/5-1,percent),r=prevFrameR+(frames[frameIndex+1]-prevFrameR)*percent,g=prevFrameG+(frames[frameIndex+2]-prevFrameG)*percent,b=prevFrameB+(frames[frameIndex+3]-prevFrameB)*percent,a=prevFrameA+(frames[frameIndex+4]-prevFrameA)*percent}var slot=skeleton.slots[this.slotIndex];1>alpha?(slot.r+=(r-slot.r)*alpha,slot.g+=(g-slot.g)*alpha,slot.b+=(b-slot.b)*alpha,slot.a+=(a-slot.a)*alpha):(slot.r=r,slot.g=g,slot.b=b,slot.a=a)}}},spine.AttachmentTimeline=function(frameCount){this.curves=new spine.Curves(frameCount),this.frames=[],this.frames.length=frameCount,this.attachmentNames=[],this.attachmentNames.length=frameCount},spine.AttachmentTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length},setFrame:function(frameIndex,time,attachmentName){this.frames[frameIndex]=time,this.attachmentNames[frameIndex]=attachmentName},apply:function(skeleton,lastTime,time,firedEvents,alpha){var frames=this.frames;if(time<frames[0])return void(lastTime>time&&this.apply(skeleton,lastTime,Number.MAX_VALUE,null,0));lastTime>time&&(lastTime=-1);var frameIndex=time>=frames[frames.length-1]?frames.length-1:spine.Animation.binarySearch1(frames,time)-1;if(!(frames[frameIndex]<lastTime)){var attachmentName=this.attachmentNames[frameIndex];skeleton.slots[this.slotIndex].setAttachment(attachmentName?skeleton.getAttachmentBySlotIndex(this.slotIndex,attachmentName):null)}}},spine.EventTimeline=function(frameCount){this.frames=[],this.frames.length=frameCount,this.events=[],this.events.length=frameCount},spine.EventTimeline.prototype={getFrameCount:function(){return this.frames.length},setFrame:function(frameIndex,time,event){this.frames[frameIndex]=time,this.events[frameIndex]=event},apply:function(skeleton,lastTime,time,firedEvents,alpha){if(firedEvents){var frames=this.frames,frameCount=frames.length;if(lastTime>time)this.apply(skeleton,lastTime,Number.MAX_VALUE,firedEvents,alpha),lastTime=-1;else if(lastTime>=frames[frameCount-1])return;if(!(time<frames[0])){var frameIndex;if(lastTime<frames[0])frameIndex=0;else{frameIndex=spine.Animation.binarySearch1(frames,lastTime);for(var frame=frames[frameIndex];frameIndex>0&&frames[frameIndex-1]==frame;)frameIndex--}for(var events=this.events;frameCount>frameIndex&&time>=frames[frameIndex];frameIndex++)firedEvents.push(events[frameIndex])}}}},spine.DrawOrderTimeline=function(frameCount){this.frames=[],this.frames.length=frameCount,this.drawOrders=[],this.drawOrders.length=frameCount},spine.DrawOrderTimeline.prototype={getFrameCount:function(){return this.frames.length},setFrame:function(frameIndex,time,drawOrder){this.frames[frameIndex]=time,this.drawOrders[frameIndex]=drawOrder},apply:function(skeleton,lastTime,time,firedEvents,alpha){var frames=this.frames;if(!(time<frames[0])){var frameIndex;frameIndex=time>=frames[frames.length-1]?frames.length-1:spine.Animation.binarySearch1(frames,time)-1;var drawOrder=skeleton.drawOrder,drawOrderToSetupIndex=(skeleton.slots,this.drawOrders[frameIndex]);if(drawOrderToSetupIndex)for(var i=0,n=drawOrderToSetupIndex.length;n>i;i++)drawOrder[i]=drawOrderToSetupIndex[i]}}},spine.FfdTimeline=function(frameCount){this.curves=new spine.Curves(frameCount),this.frames=[],this.frames.length=frameCount,this.frameVertices=[],this.frameVertices.length=frameCount},spine.FfdTimeline.prototype={slotIndex:0,attachment:0,getFrameCount:function(){return this.frames.length},setFrame:function(frameIndex,time,vertices){this.frames[frameIndex]=time,this.frameVertices[frameIndex]=vertices},apply:function(skeleton,lastTime,time,firedEvents,alpha){var slot=skeleton.slots[this.slotIndex];if(slot.attachment==this.attachment){var frames=this.frames;if(!(time<frames[0])){var frameVertices=this.frameVertices,vertexCount=frameVertices[0].length,vertices=slot.attachmentVertices;if(vertices.length!=vertexCount&&(alpha=1),vertices.length=vertexCount,time>=frames[frames.length-1]){var lastVertices=frameVertices[frames.length-1];if(1>alpha)for(var i=0;vertexCount>i;i++)vertices[i]+=(lastVertices[i]-vertices[i])*alpha;else for(var i=0;vertexCount>i;i++)vertices[i]=lastVertices[i]}else{var frameIndex=spine.Animation.binarySearch1(frames,time),frameTime=frames[frameIndex],percent=1-(time-frameTime)/(frames[frameIndex-1]-frameTime);percent=this.curves.getCurvePercent(frameIndex-1,0>percent?0:percent>1?1:percent);var prevVertices=frameVertices[frameIndex-1],nextVertices=frameVertices[frameIndex];if(1>alpha)for(var i=0;vertexCount>i;i++){var prev=prevVertices[i];vertices[i]+=(prev+(nextVertices[i]-prev)*percent-vertices[i])*alpha}else for(var i=0;vertexCount>i;i++){var prev=prevVertices[i];vertices[i]=prev+(nextVertices[i]-prev)*percent}}}}}},spine.IkConstraintTimeline=function(frameCount){this.curves=new spine.Curves(frameCount),this.frames=[],this.frames.length=3*frameCount},spine.IkConstraintTimeline.prototype={ikConstraintIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(frameIndex,time,mix,bendDirection){frameIndex*=3,this.frames[frameIndex]=time,this.frames[frameIndex+1]=mix,this.frames[frameIndex+2]=bendDirection},apply:function(skeleton,lastTime,time,firedEvents,alpha){var frames=this.frames;if(!(time<frames[0])){var ikConstraint=skeleton.ikConstraints[this.ikConstraintIndex];if(time>=frames[frames.length-3])return ikConstraint.mix+=(frames[frames.length-2]-ikConstraint.mix)*alpha,void(ikConstraint.bendDirection=frames[frames.length-1]);var frameIndex=spine.Animation.binarySearch(frames,time,3),prevFrameMix=frames[frameIndex+-2],frameTime=frames[frameIndex],percent=1-(time-frameTime)/(frames[frameIndex+-3]-frameTime);percent=this.curves.getCurvePercent(frameIndex/3-1,percent);var mix=prevFrameMix+(frames[frameIndex+1]-prevFrameMix)*percent;ikConstraint.mix+=(mix-ikConstraint.mix)*alpha,ikConstraint.bendDirection=frames[frameIndex+-1]}}},spine.FlipXTimeline=function(frameCount){this.curves=new spine.Curves(frameCount),this.frames=[],this.frames.length=2*frameCount},spine.FlipXTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(frameIndex,time,flip){frameIndex*=2,this.frames[frameIndex]=time,this.frames[frameIndex+1]=flip?1:0},apply:function(skeleton,lastTime,time,firedEvents,alpha){var frames=this.frames;if(time<frames[0])return void(lastTime>time&&this.apply(skeleton,lastTime,Number.MAX_VALUE,null,0));lastTime>time&&(lastTime=-1);var frameIndex=(time>=frames[frames.length-2]?frames.length:spine.Animation.binarySearch(frames,time,2))-2;frames[frameIndex]<lastTime||(skeleton.bones[this.boneIndex].flipX=0!=frames[frameIndex+1])}},spine.FlipYTimeline=function(frameCount){this.curves=new spine.Curves(frameCount),this.frames=[],this.frames.length=2*frameCount},spine.FlipYTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(frameIndex,time,flip){frameIndex*=2,this.frames[frameIndex]=time,this.frames[frameIndex+1]=flip?1:0},apply:function(skeleton,lastTime,time,firedEvents,alpha){var frames=this.frames;if(time<frames[0])return void(lastTime>time&&this.apply(skeleton,lastTime,Number.MAX_VALUE,null,0));lastTime>time&&(lastTime=-1);var frameIndex=(time>=frames[frames.length-2]?frames.length:spine.Animation.binarySearch(frames,time,2))-2;frames[frameIndex]<lastTime||(skeleton.bones[this.boneIndex].flipY=0!=frames[frameIndex+1])}},spine.SkeletonData=function(){this.bones=[],this.slots=[],this.skins=[],this.events=[],this.animations=[],this.ikConstraints=[]},spine.SkeletonData.prototype={name:null,defaultSkin:null,width:0,height:0,version:null,hash:null,findBone:function(boneName){for(var bones=this.bones,i=0,n=bones.length;n>i;i++)if(bones[i].name==boneName)return bones[i];return null},findBoneIndex:function(boneName){for(var bones=this.bones,i=0,n=bones.length;n>i;i++)if(bones[i].name==boneName)return i;return-1},findSlot:function(slotName){for(var slots=this.slots,i=0,n=slots.length;n>i;i++)if(slots[i].name==slotName)return slot[i];return null},findSlotIndex:function(slotName){for(var slots=this.slots,i=0,n=slots.length;n>i;i++)if(slots[i].name==slotName)return i;
return-1},findSkin:function(skinName){for(var skins=this.skins,i=0,n=skins.length;n>i;i++)if(skins[i].name==skinName)return skins[i];return null},findEvent:function(eventName){for(var events=this.events,i=0,n=events.length;n>i;i++)if(events[i].name==eventName)return events[i];return null},findAnimation:function(animationName){for(var animations=this.animations,i=0,n=animations.length;n>i;i++)if(animations[i].name==animationName)return animations[i];return null},findIkConstraint:function(ikConstraintName){for(var ikConstraints=this.ikConstraints,i=0,n=ikConstraints.length;n>i;i++)if(ikConstraints[i].name==ikConstraintName)return ikConstraints[i];return null}},spine.Skeleton=function(skeletonData){this.data=skeletonData,this.bones=[];for(var i=0,n=skeletonData.bones.length;n>i;i++){var boneData=skeletonData.bones[i],parent=boneData.parent?this.bones[skeletonData.bones.indexOf(boneData.parent)]:null;this.bones.push(new spine.Bone(boneData,this,parent))}this.slots=[],this.drawOrder=[];for(var i=0,n=skeletonData.slots.length;n>i;i++){var slotData=skeletonData.slots[i],bone=this.bones[skeletonData.bones.indexOf(slotData.boneData)],slot=new spine.Slot(slotData,bone);this.slots.push(slot),this.drawOrder.push(i)}this.ikConstraints=[];for(var i=0,n=skeletonData.ikConstraints.length;n>i;i++)this.ikConstraints.push(new spine.IkConstraint(skeletonData.ikConstraints[i],this));this.boneCache=[],this.updateCache()},spine.Skeleton.prototype={x:0,y:0,skin:null,r:1,g:1,b:1,a:1,time:0,flipX:!1,flipY:!1,updateCache:function(){var ikConstraints=this.ikConstraints,ikConstraintsCount=ikConstraints.length,arrayCount=ikConstraintsCount+1,boneCache=this.boneCache;boneCache.length>arrayCount&&(boneCache.length=arrayCount);for(var i=0,n=boneCache.length;n>i;i++)boneCache[i].length=0;for(;boneCache.length<arrayCount;)boneCache[boneCache.length]=[];var nonIkBones=boneCache[0],bones=this.bones;outer:for(var i=0,n=bones.length;n>i;i++){var bone=bones[i],current=bone;do{for(var ii=0;ikConstraintsCount>ii;ii++)for(var ikConstraint=ikConstraints[ii],parent=ikConstraint.bones[0],child=ikConstraint.bones[ikConstraint.bones.length-1];;){if(current==child){boneCache[ii].push(bone),boneCache[ii+1].push(bone);continue outer}if(child==parent)break;child=child.parent}current=current.parent}while(current);nonIkBones[nonIkBones.length]=bone}},updateWorldTransform:function(){for(var bones=this.bones,i=0,n=bones.length;n>i;i++){var bone=bones[i];bone.rotationIK=bone.rotation}for(var i=0,last=this.boneCache.length-1;;){for(var cacheBones=this.boneCache[i],ii=0,nn=cacheBones.length;nn>ii;ii++)cacheBones[ii].updateWorldTransform();if(i==last)break;this.ikConstraints[i].apply(),i++}},setToSetupPose:function(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()},setBonesToSetupPose:function(){for(var bones=this.bones,i=0,n=bones.length;n>i;i++)bones[i].setToSetupPose();for(var ikConstraints=this.ikConstraints,i=0,n=ikConstraints.length;n>i;i++){var ikConstraint=ikConstraints[i];ikConstraint.bendDirection=ikConstraint.data.bendDirection,ikConstraint.mix=ikConstraint.data.mix}},setSlotsToSetupPose:function(){for(var slots=this.slots,i=0,n=slots.length;n>i;i++)slots[i].setToSetupPose(i);this.resetDrawOrder()},getRootBone:function(){return this.bones.length?this.bones[0]:null},findBone:function(boneName){for(var bones=this.bones,i=0,n=bones.length;n>i;i++)if(bones[i].data.name==boneName)return bones[i];return null},findBoneIndex:function(boneName){for(var bones=this.bones,i=0,n=bones.length;n>i;i++)if(bones[i].data.name==boneName)return i;return-1},findSlot:function(slotName){for(var slots=this.slots,i=0,n=slots.length;n>i;i++)if(slots[i].data.name==slotName)return slots[i];return null},findSlotIndex:function(slotName){for(var slots=this.slots,i=0,n=slots.length;n>i;i++)if(slots[i].data.name==slotName)return i;return-1},setSkinByName:function(skinName){var skin=this.data.findSkin(skinName);if(!skin)throw"Skin not found: "+skinName;this.setSkin(skin)},setSkin:function(newSkin){if(newSkin)if(this.skin)newSkin._attachAll(this,this.skin);else for(var slots=this.slots,i=0,n=slots.length;n>i;i++){var slot=slots[i],name=slot.data.attachmentName;if(name){var attachment=newSkin.getAttachment(i,name);attachment&&slot.setAttachment(attachment)}}this.skin=newSkin},getAttachmentBySlotName:function(slotName,attachmentName){return this.getAttachmentBySlotIndex(this.data.findSlotIndex(slotName),attachmentName)},getAttachmentBySlotIndex:function(slotIndex,attachmentName){if(this.skin){var attachment=this.skin.getAttachment(slotIndex,attachmentName);if(attachment)return attachment}return this.data.defaultSkin?this.data.defaultSkin.getAttachment(slotIndex,attachmentName):null},setAttachment:function(slotName,attachmentName){for(var slots=this.slots,i=0,n=slots.length;n>i;i++){var slot=slots[i];if(slot.data.name==slotName){var attachment=null;if(attachmentName&&(attachment=this.getAttachmentBySlotIndex(i,attachmentName),!attachment))throw"Attachment not found: "+attachmentName+", for slot: "+slotName;return void slot.setAttachment(attachment)}}throw"Slot not found: "+slotName},findIkConstraint:function(ikConstraintName){for(var ikConstraints=this.ikConstraints,i=0,n=ikConstraints.length;n>i;i++)if(ikConstraints[i].data.name==ikConstraintName)return ikConstraints[i];return null},update:function(delta){this.time+=delta},resetDrawOrder:function(){for(var i=0,n=this.drawOrder.length;n>i;i++)this.drawOrder[i]=i}},spine.EventData=function(name){this.name=name},spine.EventData.prototype={intValue:0,floatValue:0,stringValue:null},spine.Event=function(data){this.data=data},spine.Event.prototype={intValue:0,floatValue:0,stringValue:null},spine.AttachmentType={region:0,boundingbox:1,mesh:2,skinnedmesh:3},spine.RegionAttachment=function(name){this.name=name,this.offset=[],this.offset.length=8,this.uvs=[],this.uvs.length=8},spine.RegionAttachment.prototype={type:spine.AttachmentType.region,x:0,y:0,rotation:0,scaleX:1,scaleY:1,width:0,height:0,r:1,g:1,b:1,a:1,path:null,rendererObject:null,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,setUVs:function(u,v,u2,v2,rotate){var uvs=this.uvs;rotate?(uvs[2]=u,uvs[3]=v2,uvs[4]=u,uvs[5]=v,uvs[6]=u2,uvs[7]=v,uvs[0]=u2,uvs[1]=v2):(uvs[0]=u,uvs[1]=v2,uvs[2]=u,uvs[3]=v,uvs[4]=u2,uvs[5]=v,uvs[6]=u2,uvs[7]=v2)},updateOffset:function(){var regionScaleX=this.width/this.regionOriginalWidth*this.scaleX,regionScaleY=this.height/this.regionOriginalHeight*this.scaleY,localX=-this.width/2*this.scaleX+this.regionOffsetX*regionScaleX,localY=-this.height/2*this.scaleY+this.regionOffsetY*regionScaleY,localX2=localX+this.regionWidth*regionScaleX,localY2=localY+this.regionHeight*regionScaleY,radians=this.rotation*spine.degRad,cos=Math.cos(radians),sin=Math.sin(radians),localXCos=localX*cos+this.x,localXSin=localX*sin,localYCos=localY*cos+this.y,localYSin=localY*sin,localX2Cos=localX2*cos+this.x,localX2Sin=localX2*sin,localY2Cos=localY2*cos+this.y,localY2Sin=localY2*sin,offset=this.offset;offset[0]=localXCos-localYSin,offset[1]=localYCos+localXSin,offset[2]=localXCos-localY2Sin,offset[3]=localY2Cos+localXSin,offset[4]=localX2Cos-localY2Sin,offset[5]=localY2Cos+localX2Sin,offset[6]=localX2Cos-localYSin,offset[7]=localYCos+localX2Sin},computeVertices:function(x,y,bone,vertices){x+=bone.worldX,y+=bone.worldY;var m00=bone.m00,m01=bone.m01,m10=bone.m10,m11=bone.m11,offset=this.offset;vertices[0]=offset[0]*m00+offset[1]*m01+x,vertices[1]=offset[0]*m10+offset[1]*m11+y,vertices[2]=offset[2]*m00+offset[3]*m01+x,vertices[3]=offset[2]*m10+offset[3]*m11+y,vertices[4]=offset[4]*m00+offset[5]*m01+x,vertices[5]=offset[4]*m10+offset[5]*m11+y,vertices[6]=offset[6]*m00+offset[7]*m01+x,vertices[7]=offset[6]*m10+offset[7]*m11+y}},spine.MeshAttachment=function(name){this.name=name},spine.MeshAttachment.prototype={type:spine.AttachmentType.mesh,vertices:null,uvs:null,regionUVs:null,triangles:null,hullLength:0,r:1,g:1,b:1,a:1,path:null,rendererObject:null,regionU:0,regionV:0,regionU2:0,regionV2:0,regionRotate:!1,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,edges:null,width:0,height:0,updateUVs:function(){var width=this.regionU2-this.regionU,height=this.regionV2-this.regionV,n=this.regionUVs.length;if(this.uvs&&this.uvs.length==n||(this.uvs=new spine.Float32Array(n)),this.regionRotate)for(var i=0;n>i;i+=2)this.uvs[i]=this.regionU+this.regionUVs[i+1]*width,this.uvs[i+1]=this.regionV+height-this.regionUVs[i]*height;else for(var i=0;n>i;i+=2)this.uvs[i]=this.regionU+this.regionUVs[i]*width,this.uvs[i+1]=this.regionV+this.regionUVs[i+1]*height},computeWorldVertices:function(x,y,slot,worldVertices){var bone=slot.bone;x+=bone.worldX,y+=bone.worldY;var m00=bone.m00,m01=bone.m01,m10=bone.m10,m11=bone.m11,vertices=this.vertices,verticesCount=vertices.length;slot.attachmentVertices.length==verticesCount&&(vertices=slot.attachmentVertices);for(var i=0;verticesCount>i;i+=2){var vx=vertices[i],vy=vertices[i+1];worldVertices[i]=vx*m00+vy*m01+x,worldVertices[i+1]=vx*m10+vy*m11+y}}},spine.SkinnedMeshAttachment=function(name){this.name=name},spine.SkinnedMeshAttachment.prototype={type:spine.AttachmentType.skinnedmesh,bones:null,weights:null,uvs:null,regionUVs:null,triangles:null,hullLength:0,r:1,g:1,b:1,a:1,path:null,rendererObject:null,regionU:0,regionV:0,regionU2:0,regionV2:0,regionRotate:!1,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,edges:null,width:0,height:0,updateUVs:function(u,v,u2,v2,rotate){var width=this.regionU2-this.regionU,height=this.regionV2-this.regionV,n=this.regionUVs.length;if(this.uvs&&this.uvs.length==n||(this.uvs=new spine.Float32Array(n)),this.regionRotate)for(var i=0;n>i;i+=2)this.uvs[i]=this.regionU+this.regionUVs[i+1]*width,this.uvs[i+1]=this.regionV+height-this.regionUVs[i]*height;else for(var i=0;n>i;i+=2)this.uvs[i]=this.regionU+this.regionUVs[i]*width,this.uvs[i+1]=this.regionV+this.regionUVs[i+1]*height},computeWorldVertices:function(x,y,slot,worldVertices){var nn,wx,wy,bone,vx,vy,weight,skeletonBones=slot.bone.skeleton.bones,weights=this.weights,bones=this.bones,w=0,v=0,b=0,f=0,n=bones.length;if(slot.attachmentVertices.length)for(var ffd=slot.attachmentVertices;n>v;w+=2){for(wx=0,wy=0,nn=bones[v++]+v;nn>v;v++,b+=3,f+=2)bone=skeletonBones[bones[v]],vx=weights[b]+ffd[f],vy=weights[b+1]+ffd[f+1],weight=weights[b+2],wx+=(vx*bone.m00+vy*bone.m01+bone.worldX)*weight,wy+=(vx*bone.m10+vy*bone.m11+bone.worldY)*weight;worldVertices[w]=wx+x,worldVertices[w+1]=wy+y}else for(;n>v;w+=2){for(wx=0,wy=0,nn=bones[v++]+v;nn>v;v++,b+=3)bone=skeletonBones[bones[v]],vx=weights[b],vy=weights[b+1],weight=weights[b+2],wx+=(vx*bone.m00+vy*bone.m01+bone.worldX)*weight,wy+=(vx*bone.m10+vy*bone.m11+bone.worldY)*weight;worldVertices[w]=wx+x,worldVertices[w+1]=wy+y}}},spine.BoundingBoxAttachment=function(name){this.name=name,this.vertices=[]},spine.BoundingBoxAttachment.prototype={type:spine.AttachmentType.boundingbox,computeWorldVertices:function(x,y,bone,worldVertices){x+=bone.worldX,y+=bone.worldY;for(var m00=bone.m00,m01=bone.m01,m10=bone.m10,m11=bone.m11,vertices=this.vertices,i=0,n=vertices.length;n>i;i+=2){var px=vertices[i],py=vertices[i+1];worldVertices[i]=px*m00+py*m01+x,worldVertices[i+1]=px*m10+py*m11+y}}},spine.AnimationStateData=function(skeletonData){this.skeletonData=skeletonData,this.animationToMixTime={}},spine.AnimationStateData.prototype={defaultMix:0,setMixByName:function(fromName,toName,duration){var from=this.skeletonData.findAnimation(fromName);if(!from)throw"Animation not found: "+fromName;var to=this.skeletonData.findAnimation(toName);if(!to)throw"Animation not found: "+toName;this.setMix(from,to,duration)},setMix:function(from,to,duration){this.animationToMixTime[from.name+":"+to.name]=duration},getMix:function(from,to){var key=from.name+":"+to.name;return this.animationToMixTime.hasOwnProperty(key)?this.animationToMixTime[key]:this.defaultMix}},spine.TrackEntry=function(){},spine.TrackEntry.prototype={next:null,previous:null,animation:null,loop:!1,delay:0,time:0,lastTime:-1,endTime:0,timeScale:1,mixTime:0,mixDuration:0,mix:1,onStart:null,onEnd:null,onComplete:null,onEvent:null},spine.AnimationState=function(stateData){this.data=stateData,this.tracks=[],this.events=[]},spine.AnimationState.prototype={onStart:null,onEnd:null,onComplete:null,onEvent:null,timeScale:1,update:function(delta){delta*=this.timeScale;for(var i=0;i<this.tracks.length;i++){var current=this.tracks[i];if(current){if(current.time+=delta*current.timeScale,current.previous){var previousDelta=delta*current.previous.timeScale;current.previous.time+=previousDelta,current.mixTime+=previousDelta}var next=current.next;next?(next.time=current.lastTime-next.delay,next.time>=0&&this.setCurrent(i,next)):!current.loop&&current.lastTime>=current.endTime&&this.clearTrack(i)}}},apply:function(skeleton){skeleton.resetDrawOrder();for(var i=0;i<this.tracks.length;i++){var current=this.tracks[i];if(current){this.events.length=0;var time=current.time,lastTime=current.lastTime,endTime=current.endTime,loop=current.loop;!loop&&time>endTime&&(time=endTime);var previous=current.previous;if(previous){var previousTime=previous.time;!previous.loop&&previousTime>previous.endTime&&(previousTime=previous.endTime),previous.animation.apply(skeleton,previousTime,previousTime,previous.loop,null);var alpha=current.mixTime/current.mixDuration*current.mix;alpha>=1&&(alpha=1,current.previous=null),current.animation.mix(skeleton,current.lastTime,time,loop,this.events,alpha)}else 1==current.mix?current.animation.apply(skeleton,current.lastTime,time,loop,this.events):current.animation.mix(skeleton,current.lastTime,time,loop,this.events,current.mix);for(var ii=0,nn=this.events.length;nn>ii;ii++){var event=this.events[ii];current.onEvent&&current.onEvent(i,event),this.onEvent&&this.onEvent(i,event)}if(loop?lastTime%endTime>time%endTime:endTime>lastTime&&time>=endTime){var count=Math.floor(time/endTime);current.onComplete&&current.onComplete(i,count),this.onComplete&&this.onComplete(i,count)}current.lastTime=current.time}}},clearTracks:function(){for(var i=0,n=this.tracks.length;n>i;i++)this.clearTrack(i);this.tracks.length=0},clearTrack:function(trackIndex){if(!(trackIndex>=this.tracks.length)){var current=this.tracks[trackIndex];current&&(current.onEnd&&current.onEnd(trackIndex),this.onEnd&&this.onEnd(trackIndex),this.tracks[trackIndex]=null)}},_expandToIndex:function(index){if(index<this.tracks.length)return this.tracks[index];for(;index>=this.tracks.length;)this.tracks.push(null);return null},setCurrent:function(index,entry){var current=this._expandToIndex(index);if(current){var previous=current.previous;current.previous=null,current.onEnd&&current.onEnd(index),this.onEnd&&this.onEnd(index),entry.mixDuration=this.data.getMix(current.animation,entry.animation),entry.mixDuration>0&&(entry.mixTime=0,previous&&current.mixTime/current.mixDuration<.5?entry.previous=previous:entry.previous=current)}this.tracks[index]=entry,entry.onStart&&entry.onStart(index),this.onStart&&this.onStart(index)},setAnimationByName:function(trackIndex,animationName,loop){var animation=this.data.skeletonData.findAnimation(animationName);if(!animation)throw"Animation not found: "+animationName;return this.setAnimation(trackIndex,animation,loop)},setAnimation:function(trackIndex,animation,loop){var entry=new spine.TrackEntry;return entry.animation=animation,entry.loop=loop,entry.endTime=animation.duration,this.setCurrent(trackIndex,entry),entry},addAnimationByName:function(trackIndex,animationName,loop,delay){var animation=this.data.skeletonData.findAnimation(animationName);if(!animation)throw"Animation not found: "+animationName;return this.addAnimation(trackIndex,animation,loop,delay)},addAnimation:function(trackIndex,animation,loop,delay){var entry=new spine.TrackEntry;entry.animation=animation,entry.loop=loop,entry.endTime=animation.duration;var last=this._expandToIndex(trackIndex);if(last){for(;last.next;)last=last.next;last.next=entry}else this.tracks[trackIndex]=entry;return 0>=delay&&(last?delay+=last.endTime-this.data.getMix(last.animation,animation):delay=0),entry.delay=delay,entry},getCurrent:function(trackIndex){return trackIndex>=this.tracks.length?null:this.tracks[trackIndex]}},spine.SkeletonJson=function(attachmentLoader){this.attachmentLoader=attachmentLoader},spine.SkeletonJson.prototype={scale:1,readSkeletonData:function(root,name){var skeletonData=new spine.SkeletonData;skeletonData.name=name;var skeletonMap=root.skeleton;skeletonMap&&(skeletonData.hash=skeletonMap.hash,skeletonData.version=skeletonMap.spine,skeletonData.width=skeletonMap.width||0,skeletonData.height=skeletonMap.height||0);for(var bones=root.bones,i=0,n=bones.length;n>i;i++){var boneMap=bones[i],parent=null;if(boneMap.parent&&(parent=skeletonData.findBone(boneMap.parent),!parent))throw"Parent bone not found: "+boneMap.parent;var boneData=new spine.BoneData(boneMap.name,parent);boneData.length=(boneMap.length||0)*this.scale,boneData.x=(boneMap.x||0)*this.scale,boneData.y=(boneMap.y||0)*this.scale,boneData.rotation=boneMap.rotation||0,boneData.scaleX=boneMap.hasOwnProperty("scaleX")?boneMap.scaleX:1,boneData.scaleY=boneMap.hasOwnProperty("scaleY")?boneMap.scaleY:1,boneData.inheritScale=boneMap.hasOwnProperty("inheritScale")?boneMap.inheritScale:!0,boneData.inheritRotation=boneMap.hasOwnProperty("inheritRotation")?boneMap.inheritRotation:!0,skeletonData.bones.push(boneData)}var ik=root.ik;if(ik)for(var i=0,n=ik.length;n>i;i++){for(var ikMap=ik[i],ikConstraintData=new spine.IkConstraintData(ikMap.name),bones=ikMap.bones,ii=0,nn=bones.length;nn>ii;ii++){var bone=skeletonData.findBone(bones[ii]);if(!bone)throw"IK bone not found: "+bones[ii];ikConstraintData.bones.push(bone)}if(ikConstraintData.target=skeletonData.findBone(ikMap.target),!ikConstraintData.target)throw"Target bone not found: "+ikMap.target;ikConstraintData.bendDirection=!ikMap.hasOwnProperty("bendPositive")||ikMap.bendPositive?1:-1,ikConstraintData.mix=ikMap.hasOwnProperty("mix")?ikMap.mix:1,skeletonData.ikConstraints.push(ikConstraintData)}for(var slots=root.slots,i=0,n=slots.length;n>i;i++){var slotMap=slots[i],boneData=skeletonData.findBone(slotMap.bone);if(!boneData)throw"Slot bone not found: "+slotMap.bone;var slotData=new spine.SlotData(slotMap.name,boneData),color=slotMap.color;color&&(slotData.r=this.toColor(color,0),slotData.g=this.toColor(color,1),slotData.b=this.toColor(color,2),slotData.a=this.toColor(color,3)),slotData.attachmentName=slotMap.attachment,slotData.additiveBlending=slotMap.additive&&"true"==slotMap.additive,skeletonData.slots.push(slotData)}var skins=root.skins;for(var skinName in skins)if(skins.hasOwnProperty(skinName)){var skinMap=skins[skinName],skin=new spine.Skin(skinName);for(var slotName in skinMap)if(skinMap.hasOwnProperty(slotName)){var slotIndex=skeletonData.findSlotIndex(slotName),slotEntry=skinMap[slotName];for(var attachmentName in slotEntry)if(slotEntry.hasOwnProperty(attachmentName)){var attachment=this.readAttachment(skin,attachmentName,slotEntry[attachmentName]);attachment&&skin.addAttachment(slotIndex,attachmentName,attachment)}}skeletonData.skins.push(skin),"default"==skin.name&&(skeletonData.defaultSkin=skin)}var events=root.events;for(var eventName in events)if(events.hasOwnProperty(eventName)){var eventMap=events[eventName],eventData=new spine.EventData(eventName);eventData.intValue=eventMap["int"]||0,eventData.floatValue=eventMap["float"]||0,eventData.stringValue=eventMap.string||null,skeletonData.events.push(eventData)}var animations=root.animations;for(var animationName in animations)animations.hasOwnProperty(animationName)&&this.readAnimation(animationName,animations[animationName],skeletonData);return skeletonData},readAttachment:function(skin,name,map){name=map.name||name;var type=spine.AttachmentType[map.type||"region"],path=map.path||name,scale=this.scale;if(type==spine.AttachmentType.region){var region=this.attachmentLoader.newRegionAttachment(skin,name,path);if(!region)return null;region.path=path,region.x=(map.x||0)*scale,region.y=(map.y||0)*scale,region.scaleX=map.hasOwnProperty("scaleX")?map.scaleX:1,region.scaleY=map.hasOwnProperty("scaleY")?map.scaleY:1,region.rotation=map.rotation||0,region.width=(map.width||0)*scale,region.height=(map.height||0)*scale;var color=map.color;return color&&(region.r=this.toColor(color,0),region.g=this.toColor(color,1),region.b=this.toColor(color,2),region.a=this.toColor(color,3)),region.updateOffset(),region}if(type==spine.AttachmentType.mesh){var mesh=this.attachmentLoader.newMeshAttachment(skin,name,path);return mesh?(mesh.path=path,mesh.vertices=this.getFloatArray(map,"vertices",scale),mesh.triangles=this.getIntArray(map,"triangles"),mesh.regionUVs=this.getFloatArray(map,"uvs",1),mesh.updateUVs(),color=map.color,color&&(mesh.r=this.toColor(color,0),mesh.g=this.toColor(color,1),mesh.b=this.toColor(color,2),mesh.a=this.toColor(color,3)),mesh.hullLength=2*(map.hull||0),map.edges&&(mesh.edges=this.getIntArray(map,"edges")),mesh.width=(map.width||0)*scale,mesh.height=(map.height||0)*scale,mesh):null}if(type==spine.AttachmentType.skinnedmesh){var mesh=this.attachmentLoader.newSkinnedMeshAttachment(skin,name,path);if(!mesh)return null;mesh.path=path;for(var uvs=this.getFloatArray(map,"uvs",1),vertices=this.getFloatArray(map,"vertices",1),weights=[],bones=[],i=0,n=vertices.length;n>i;){var boneCount=0|vertices[i++];bones[bones.length]=boneCount;for(var nn=i+4*boneCount;nn>i;)bones[bones.length]=vertices[i],weights[weights.length]=vertices[i+1]*scale,weights[weights.length]=vertices[i+2]*scale,weights[weights.length]=vertices[i+3],i+=4}return mesh.bones=bones,mesh.weights=weights,mesh.triangles=this.getIntArray(map,"triangles"),mesh.regionUVs=uvs,mesh.updateUVs(),color=map.color,color&&(mesh.r=this.toColor(color,0),mesh.g=this.toColor(color,1),mesh.b=this.toColor(color,2),mesh.a=this.toColor(color,3)),mesh.hullLength=2*(map.hull||0),map.edges&&(mesh.edges=this.getIntArray(map,"edges")),mesh.width=(map.width||0)*scale,mesh.height=(map.height||0)*scale,mesh}if(type==spine.AttachmentType.boundingbox){for(var attachment=this.attachmentLoader.newBoundingBoxAttachment(skin,name),vertices=map.vertices,i=0,n=vertices.length;n>i;i++)attachment.vertices.push(vertices[i]*scale);return attachment}throw"Unknown attachment type: "+type},readAnimation:function(name,map,skeletonData){var timelines=[],duration=0,slots=map.slots;for(var slotName in slots)if(slots.hasOwnProperty(slotName)){var slotMap=slots[slotName],slotIndex=skeletonData.findSlotIndex(slotName);for(var timelineName in slotMap)if(slotMap.hasOwnProperty(timelineName)){var values=slotMap[timelineName];if("color"==timelineName){var timeline=new spine.ColorTimeline(values.length);timeline.slotIndex=slotIndex;for(var frameIndex=0,i=0,n=values.length;n>i;i++){var valueMap=values[i],color=valueMap.color,r=this.toColor(color,0),g=this.toColor(color,1),b=this.toColor(color,2),a=this.toColor(color,3);timeline.setFrame(frameIndex,valueMap.time,r,g,b,a),this.readCurve(timeline,frameIndex,valueMap),frameIndex++}timelines.push(timeline),duration=Math.max(duration,timeline.frames[5*timeline.getFrameCount()-5])}else{if("attachment"!=timelineName)throw"Invalid timeline type for a slot: "+timelineName+" ("+slotName+")";var timeline=new spine.AttachmentTimeline(values.length);timeline.slotIndex=slotIndex;for(var frameIndex=0,i=0,n=values.length;n>i;i++){var valueMap=values[i];timeline.setFrame(frameIndex++,valueMap.time,valueMap.name)}timelines.push(timeline),duration=Math.max(duration,timeline.frames[timeline.getFrameCount()-1])}}}var bones=map.bones;for(var boneName in bones)if(bones.hasOwnProperty(boneName)){var boneIndex=skeletonData.findBoneIndex(boneName);if(-1==boneIndex)throw"Bone not found: "+boneName;var boneMap=bones[boneName];for(var timelineName in boneMap)if(boneMap.hasOwnProperty(timelineName)){var values=boneMap[timelineName];if("rotate"==timelineName){var timeline=new spine.RotateTimeline(values.length);timeline.boneIndex=boneIndex;for(var frameIndex=0,i=0,n=values.length;n>i;i++){var valueMap=values[i];timeline.setFrame(frameIndex,valueMap.time,valueMap.angle),this.readCurve(timeline,frameIndex,valueMap),frameIndex++}timelines.push(timeline),duration=Math.max(duration,timeline.frames[2*timeline.getFrameCount()-2])}else if("translate"==timelineName||"scale"==timelineName){var timeline,timelineScale=1;"scale"==timelineName?timeline=new spine.ScaleTimeline(values.length):(timeline=new spine.TranslateTimeline(values.length),timelineScale=this.scale),timeline.boneIndex=boneIndex;for(var frameIndex=0,i=0,n=values.length;n>i;i++){var valueMap=values[i],x=(valueMap.x||0)*timelineScale,y=(valueMap.y||0)*timelineScale;timeline.setFrame(frameIndex,valueMap.time,x,y),this.readCurve(timeline,frameIndex,valueMap),frameIndex++}timelines.push(timeline),duration=Math.max(duration,timeline.frames[3*timeline.getFrameCount()-3])}else{if("flipX"!=timelineName&&"flipY"!=timelineName)throw"Invalid timeline type for a bone: "+timelineName+" ("+boneName+")";var x="flipX"==timelineName,timeline=x?new spine.FlipXTimeline(values.length):new spine.FlipYTimeline(values.length);timeline.boneIndex=boneIndex;for(var field=x?"x":"y",frameIndex=0,i=0,n=values.length;n>i;i++){var valueMap=values[i];timeline.setFrame(frameIndex,valueMap.time,valueMap[field]||!1),frameIndex++}timelines.push(timeline),duration=Math.max(duration,timeline.frames[2*timeline.getFrameCount()-2])}}}var ikMap=map.ik;for(var ikConstraintName in ikMap)if(ikMap.hasOwnProperty(ikConstraintName)){var ikConstraint=skeletonData.findIkConstraint(ikConstraintName),values=ikMap[ikConstraintName],timeline=new spine.IkConstraintTimeline(values.length);timeline.ikConstraintIndex=skeletonData.ikConstraints.indexOf(ikConstraint);for(var frameIndex=0,i=0,n=values.length;n>i;i++){var valueMap=values[i],mix=valueMap.hasOwnProperty("mix")?valueMap.mix:1,bendDirection=!valueMap.hasOwnProperty("bendPositive")||valueMap.bendPositive?1:-1;timeline.setFrame(frameIndex,valueMap.time,mix,bendDirection),this.readCurve(timeline,frameIndex,valueMap),frameIndex++}timelines.push(timeline),duration=Math.max(duration,timeline.frames[3*timeline.getFrameCount()-3])}var ffd=map.ffd;for(var skinName in ffd){var skin=skeletonData.findSkin(skinName),slotMap=ffd[skinName];for(slotName in slotMap){var slotIndex=skeletonData.findSlotIndex(slotName),meshMap=slotMap[slotName];for(var meshName in meshMap){var values=meshMap[meshName],timeline=new spine.FfdTimeline(values.length),attachment=skin.getAttachment(slotIndex,meshName);if(!attachment)throw"FFD attachment not found: "+meshName;timeline.slotIndex=slotIndex,timeline.attachment=attachment;var vertexCount,isMesh=attachment.type==spine.AttachmentType.mesh;vertexCount=isMesh?attachment.vertices.length:attachment.weights.length/3*2;for(var frameIndex=0,i=0,n=values.length;n>i;i++){var vertices,valueMap=values[i];if(valueMap.vertices){var verticesValue=valueMap.vertices,vertices=[];vertices.length=vertexCount;var start=valueMap.offset||0,nn=verticesValue.length;if(1==this.scale)for(var ii=0;nn>ii;ii++)vertices[ii+start]=verticesValue[ii];else for(var ii=0;nn>ii;ii++)vertices[ii+start]=verticesValue[ii]*this.scale;if(isMesh)for(var meshVertices=attachment.vertices,ii=0,nn=vertices.length;nn>ii;ii++)vertices[ii]+=meshVertices[ii]}else isMesh?vertices=attachment.vertices:(vertices=[],vertices.length=vertexCount);timeline.setFrame(frameIndex,valueMap.time,vertices),this.readCurve(timeline,frameIndex,valueMap),frameIndex++}timelines[timelines.length]=timeline,duration=Math.max(duration,timeline.frames[timeline.getFrameCount()-1])}}}var drawOrderValues=map.drawOrder;if(drawOrderValues||(drawOrderValues=map.draworder),drawOrderValues){for(var timeline=new spine.DrawOrderTimeline(drawOrderValues.length),slotCount=skeletonData.slots.length,frameIndex=0,i=0,n=drawOrderValues.length;n>i;i++){var drawOrderMap=drawOrderValues[i],drawOrder=null;if(drawOrderMap.offsets){drawOrder=[],drawOrder.length=slotCount;for(var ii=slotCount-1;ii>=0;ii--)drawOrder[ii]=-1;var offsets=drawOrderMap.offsets,unchanged=[];unchanged.length=slotCount-offsets.length;for(var originalIndex=0,unchangedIndex=0,ii=0,nn=offsets.length;nn>ii;ii++){var offsetMap=offsets[ii],slotIndex=skeletonData.findSlotIndex(offsetMap.slot);if(-1==slotIndex)throw"Slot not found: "+offsetMap.slot;for(;originalIndex!=slotIndex;)unchanged[unchangedIndex++]=originalIndex++;drawOrder[originalIndex+offsetMap.offset]=originalIndex++}for(;slotCount>originalIndex;)unchanged[unchangedIndex++]=originalIndex++;for(var ii=slotCount-1;ii>=0;ii--)-1==drawOrder[ii]&&(drawOrder[ii]=unchanged[--unchangedIndex])}timeline.setFrame(frameIndex++,drawOrderMap.time,drawOrder)}timelines.push(timeline),duration=Math.max(duration,timeline.frames[timeline.getFrameCount()-1])}var events=map.events;if(events){for(var timeline=new spine.EventTimeline(events.length),frameIndex=0,i=0,n=events.length;n>i;i++){var eventMap=events[i],eventData=skeletonData.findEvent(eventMap.name);if(!eventData)throw"Event not found: "+eventMap.name;var event=new spine.Event(eventData);event.intValue=eventMap.hasOwnProperty("int")?eventMap["int"]:eventData.intValue,event.floatValue=eventMap.hasOwnProperty("float")?eventMap["float"]:eventData.floatValue,event.stringValue=eventMap.hasOwnProperty("string")?eventMap.string:eventData.stringValue,timeline.setFrame(frameIndex++,eventMap.time,event)}timelines.push(timeline),duration=Math.max(duration,timeline.frames[timeline.getFrameCount()-1])}skeletonData.animations.push(new spine.Animation(name,timelines,duration))},readCurve:function(timeline,frameIndex,valueMap){var curve=valueMap.curve;curve?"stepped"==curve?timeline.curves.setStepped(frameIndex):curve instanceof Array&&timeline.curves.setCurve(frameIndex,curve[0],curve[1],curve[2],curve[3]):timeline.curves.setLinear(frameIndex)},toColor:function(hexString,colorIndex){if(8!=hexString.length)throw"Color hexidecimal length must be 8, recieved: "+hexString;return parseInt(hexString.substring(2*colorIndex,2*colorIndex+2),16)/255},getFloatArray:function(map,name,scale){var list=map[name],values=new spine.Float32Array(list.length),i=0,n=list.length;if(1==scale)for(;n>i;i++)values[i]=list[i];else for(;n>i;i++)values[i]=list[i]*scale;return values},getIntArray:function(map,name){for(var list=map[name],values=new spine.Uint16Array(list.length),i=0,n=list.length;n>i;i++)values[i]=0|list[i];return values}},spine.Atlas=function(atlasText,textureLoader){this.textureLoader=textureLoader,this.pages=[],this.regions=[];var reader=new spine.AtlasReader(atlasText),tuple=[];tuple.length=4;for(var page=null;;){var line=reader.readLine();if(null===line)break;if(line=reader.trim(line),line.length)if(page){var region=new spine.AtlasRegion;region.name=line,region.page=page,region.rotate="true"==reader.readValue(),reader.readTuple(tuple);var x=parseInt(tuple[0]),y=parseInt(tuple[1]);reader.readTuple(tuple);var width=parseInt(tuple[0]),height=parseInt(tuple[1]);region.u=x/page.width,region.v=y/page.height,region.rotate?(region.u2=(x+height)/page.width,region.v2=(y+width)/page.height):(region.u2=(x+width)/page.width,region.v2=(y+height)/page.height),region.x=x,region.y=y,region.width=Math.abs(width),region.height=Math.abs(height),4==reader.readTuple(tuple)&&(region.splits=[parseInt(tuple[0]),parseInt(tuple[1]),parseInt(tuple[2]),parseInt(tuple[3])],4==reader.readTuple(tuple)&&(region.pads=[parseInt(tuple[0]),parseInt(tuple[1]),parseInt(tuple[2]),parseInt(tuple[3])],reader.readTuple(tuple))),region.originalWidth=parseInt(tuple[0]),region.originalHeight=parseInt(tuple[1]),reader.readTuple(tuple),region.offsetX=parseInt(tuple[0]),region.offsetY=parseInt(tuple[1]),region.index=parseInt(reader.readValue()),this.regions.push(region)}else{page=new spine.AtlasPage,page.name=line,2==reader.readTuple(tuple)&&(page.width=parseInt(tuple[0]),page.height=parseInt(tuple[1]),reader.readTuple(tuple)),page.format=spine.Atlas.Format[tuple[0]],
reader.readTuple(tuple),page.minFilter=spine.Atlas.TextureFilter[tuple[0]],page.magFilter=spine.Atlas.TextureFilter[tuple[1]];var direction=reader.readValue();page.uWrap=spine.Atlas.TextureWrap.clampToEdge,page.vWrap=spine.Atlas.TextureWrap.clampToEdge,"x"==direction?page.uWrap=spine.Atlas.TextureWrap.repeat:"y"==direction?page.vWrap=spine.Atlas.TextureWrap.repeat:"xy"==direction&&(page.uWrap=page.vWrap=spine.Atlas.TextureWrap.repeat),textureLoader.load(page,line,this),this.pages.push(page)}else page=null}},spine.Atlas.prototype={findRegion:function(name){for(var regions=this.regions,i=0,n=regions.length;n>i;i++)if(regions[i].name==name)return regions[i];return null},dispose:function(){for(var pages=this.pages,i=0,n=pages.length;n>i;i++)this.textureLoader.unload(pages[i].rendererObject)},updateUVs:function(page){for(var regions=this.regions,i=0,n=regions.length;n>i;i++){var region=regions[i];region.page==page&&(region.u=region.x/page.width,region.v=region.y/page.height,region.rotate?(region.u2=(region.x+region.height)/page.width,region.v2=(region.y+region.width)/page.height):(region.u2=(region.x+region.width)/page.width,region.v2=(region.y+region.height)/page.height))}}},spine.Atlas.Format={alpha:0,intensity:1,luminanceAlpha:2,rgb565:3,rgba4444:4,rgb888:5,rgba8888:6},spine.Atlas.TextureFilter={nearest:0,linear:1,mipMap:2,mipMapNearestNearest:3,mipMapLinearNearest:4,mipMapNearestLinear:5,mipMapLinearLinear:6},spine.Atlas.TextureWrap={mirroredRepeat:0,clampToEdge:1,repeat:2},spine.AtlasPage=function(){},spine.AtlasPage.prototype={name:null,format:null,minFilter:null,magFilter:null,uWrap:null,vWrap:null,rendererObject:null,width:0,height:0},spine.AtlasRegion=function(){},spine.AtlasRegion.prototype={page:null,name:null,x:0,y:0,width:0,height:0,u:0,v:0,u2:0,v2:0,offsetX:0,offsetY:0,originalWidth:0,originalHeight:0,index:0,rotate:!1,splits:null,pads:null},spine.AtlasReader=function(text){this.lines=text.split(/\r\n|\r|\n/)},spine.AtlasReader.prototype={index:0,trim:function(value){return value.replace(/^\s+|\s+$/g,"")},readLine:function(){return this.index>=this.lines.length?null:this.lines[this.index++]},readValue:function(){var line=this.readLine(),colon=line.indexOf(":");if(-1==colon)throw"Invalid line: "+line;return this.trim(line.substring(colon+1))},readTuple:function(tuple){var line=this.readLine(),colon=line.indexOf(":");if(-1==colon)throw"Invalid line: "+line;for(var i=0,lastMatch=colon+1;3>i;i++){var comma=line.indexOf(",",lastMatch);if(-1==comma)break;tuple[i]=this.trim(line.substr(lastMatch,comma-lastMatch)),lastMatch=comma+1}return tuple[i]=this.trim(line.substring(lastMatch)),i+1}},spine.AtlasAttachmentLoader=function(atlas){this.atlas=atlas},spine.AtlasAttachmentLoader.prototype={newRegionAttachment:function(skin,name,path){var region=this.atlas.findRegion(path);if(!region)throw"Region not found in atlas: "+path+" (region attachment: "+name+")";var attachment=new spine.RegionAttachment(name);return attachment.rendererObject=region,attachment.setUVs(region.u,region.v,region.u2,region.v2,region.rotate),attachment.regionOffsetX=region.offsetX,attachment.regionOffsetY=region.offsetY,attachment.regionWidth=region.width,attachment.regionHeight=region.height,attachment.regionOriginalWidth=region.originalWidth,attachment.regionOriginalHeight=region.originalHeight,attachment},newMeshAttachment:function(skin,name,path){var region=this.atlas.findRegion(path);if(!region)throw"Region not found in atlas: "+path+" (mesh attachment: "+name+")";var attachment=new spine.MeshAttachment(name);return attachment.rendererObject=region,attachment.regionU=region.u,attachment.regionV=region.v,attachment.regionU2=region.u2,attachment.regionV2=region.v2,attachment.regionRotate=region.rotate,attachment.regionOffsetX=region.offsetX,attachment.regionOffsetY=region.offsetY,attachment.regionWidth=region.width,attachment.regionHeight=region.height,attachment.regionOriginalWidth=region.originalWidth,attachment.regionOriginalHeight=region.originalHeight,attachment},newSkinnedMeshAttachment:function(skin,name,path){var region=this.atlas.findRegion(path);if(!region)throw"Region not found in atlas: "+path+" (skinned mesh attachment: "+name+")";var attachment=new spine.SkinnedMeshAttachment(name);return attachment.rendererObject=region,attachment.regionU=region.u,attachment.regionV=region.v,attachment.regionU2=region.u2,attachment.regionV2=region.v2,attachment.regionRotate=region.rotate,attachment.regionOffsetX=region.offsetX,attachment.regionOffsetY=region.offsetY,attachment.regionWidth=region.width,attachment.regionHeight=region.height,attachment.regionOriginalWidth=region.originalWidth,attachment.regionOriginalHeight=region.originalHeight,attachment},newBoundingBoxAttachment:function(skin,name){return new spine.BoundingBoxAttachment(name)}},spine.SkeletonBounds=function(){this.polygonPool=[],this.polygons=[],this.boundingBoxes=[]},spine.SkeletonBounds.prototype={minX:0,minY:0,maxX:0,maxY:0,update:function(skeleton,updateAabb){var slots=skeleton.slots,slotCount=slots.length,x=skeleton.x,y=skeleton.y,boundingBoxes=this.boundingBoxes,polygonPool=this.polygonPool,polygons=this.polygons;boundingBoxes.length=0;for(var i=0,n=polygons.length;n>i;i++)polygonPool.push(polygons[i]);polygons.length=0;for(var i=0;slotCount>i;i++){var slot=slots[i],boundingBox=slot.attachment;if(boundingBox.type==spine.AttachmentType.boundingbox){boundingBoxes.push(boundingBox);var polygon,poolCount=polygonPool.length;poolCount>0?(polygon=polygonPool[poolCount-1],polygonPool.splice(poolCount-1,1)):polygon=[],polygons.push(polygon),polygon.length=boundingBox.vertices.length,boundingBox.computeWorldVertices(x,y,slot.bone,polygon)}}updateAabb&&this.aabbCompute()},aabbCompute:function(){for(var polygons=this.polygons,minX=Number.MAX_VALUE,minY=Number.MAX_VALUE,maxX=Number.MIN_VALUE,maxY=Number.MIN_VALUE,i=0,n=polygons.length;n>i;i++)for(var vertices=polygons[i],ii=0,nn=vertices.length;nn>ii;ii+=2){var x=vertices[ii],y=vertices[ii+1];minX=Math.min(minX,x),minY=Math.min(minY,y),maxX=Math.max(maxX,x),maxY=Math.max(maxY,y)}this.minX=minX,this.minY=minY,this.maxX=maxX,this.maxY=maxY},aabbContainsPoint:function(x,y){return x>=this.minX&&x<=this.maxX&&y>=this.minY&&y<=this.maxY},aabbIntersectsSegment:function(x1,y1,x2,y2){var minX=this.minX,minY=this.minY,maxX=this.maxX,maxY=this.maxY;if(minX>=x1&&minX>=x2||minY>=y1&&minY>=y2||x1>=maxX&&x2>=maxX||y1>=maxY&&y2>=maxY)return!1;var m=(y2-y1)/(x2-x1),y=m*(minX-x1)+y1;if(y>minY&&maxY>y)return!0;if(y=m*(maxX-x1)+y1,y>minY&&maxY>y)return!0;var x=(minY-y1)/m+x1;return x>minX&&maxX>x?!0:(x=(maxY-y1)/m+x1,x>minX&&maxX>x?!0:!1)},aabbIntersectsSkeleton:function(bounds){return this.minX<bounds.maxX&&this.maxX>bounds.minX&&this.minY<bounds.maxY&&this.maxY>bounds.minY},containsPoint:function(x,y){for(var polygons=this.polygons,i=0,n=polygons.length;n>i;i++)if(this.polygonContainsPoint(polygons[i],x,y))return this.boundingBoxes[i];return null},intersectsSegment:function(x1,y1,x2,y2){for(var polygons=this.polygons,i=0,n=polygons.length;n>i;i++)if(polygons[i].intersectsSegment(x1,y1,x2,y2))return this.boundingBoxes[i];return null},polygonContainsPoint:function(polygon,x,y){for(var nn=polygon.length,prevIndex=nn-2,inside=!1,ii=0;nn>ii;ii+=2){var vertexY=polygon[ii+1],prevY=polygon[prevIndex+1];if(y>vertexY&&prevY>=y||y>prevY&&vertexY>=y){var vertexX=polygon[ii];vertexX+(y-vertexY)/(prevY-vertexY)*(polygon[prevIndex]-vertexX)<x&&(inside=!inside)}prevIndex=ii}return inside},polygonIntersectsSegment:function(polygon,x1,y1,x2,y2){for(var nn=polygon.length,width12=x1-x2,height12=y1-y2,det1=x1*y2-y1*x2,x3=polygon[nn-2],y3=polygon[nn-1],ii=0;nn>ii;ii+=2){var x4=polygon[ii],y4=polygon[ii+1],det2=x3*y4-y3*x4,width34=x3-x4,height34=y3-y4,det3=width12*height34-height12*width34,x=(det1*width34-width12*det2)/det3;if((x>=x3&&x4>=x||x>=x4&&x3>=x)&&(x>=x1&&x2>=x||x>=x2&&x1>=x)){var y=(det1*height34-height12*det2)/det3;if((y>=y3&&y4>=y||y>=y4&&y3>=y)&&(y>=y1&&y2>=y||y>=y2&&y1>=y))return!0}x3=x4,y3=y4}return!1},getPolygon:function(attachment){var index=this.boundingBoxes.indexOf(attachment);return-1==index?null:this.polygons[index]},getWidth:function(){return this.maxX-this.minX},getHeight:function(){return this.maxY-this.minY}},spine.Bone.yDown=!0,PIXI.AnimCache={},PIXI.SpineTextureLoader=function(basePath,crossorigin){PIXI.EventTarget.call(this),this.basePath=basePath,this.crossorigin=crossorigin,this.loadingCount=0},PIXI.SpineTextureLoader.prototype=PIXI.SpineTextureLoader,PIXI.SpineTextureLoader.prototype.load=function(page,file){if(page.rendererObject=PIXI.BaseTexture.fromImage(this.basePath+"/"+file,this.crossorigin),!page.rendererObject.hasLoaded){var scope=this;++scope.loadingCount,page.rendererObject.addEventListener("loaded",function(){--scope.loadingCount,scope.dispatchEvent({type:"loadedBaseTexture",content:scope})})}},PIXI.SpineTextureLoader.prototype.unload=function(texture){texture.destroy(!0)},PIXI.Spine=function(url){if(PIXI.DisplayObjectContainer.call(this),this.spineData=PIXI.AnimCache[url],!this.spineData)throw new Error("Spine data must be preloaded using PIXI.SpineLoader or PIXI.AssetLoader: "+url);this.skeleton=new spine.Skeleton(this.spineData),this.skeleton.updateWorldTransform(),this.stateData=new spine.AnimationStateData(this.spineData),this.state=new spine.AnimationState(this.stateData),this.slotContainers=[];for(var i=0,n=this.skeleton.slots.length;n>i;i++){var slot=this.skeleton.slots[i],attachment=slot.attachment,slotContainer=new PIXI.DisplayObjectContainer;if(this.slotContainers.push(slotContainer),this.addChild(slotContainer),attachment instanceof spine.RegionAttachment){var spriteName=attachment.rendererObject.name,sprite=this.createSprite(slot,attachment);slot.currentSprite=sprite,slot.currentSpriteName=spriteName,slotContainer.addChild(sprite)}else{if(!(attachment instanceof spine.MeshAttachment))continue;var mesh=this.createMesh(slot,attachment);slot.currentMesh=mesh,slot.currentMeshName=attachment.name,slotContainer.addChild(mesh)}}this.autoUpdate=!0},PIXI.Spine.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),PIXI.Spine.prototype.constructor=PIXI.Spine,Object.defineProperty(PIXI.Spine.prototype,"autoUpdate",{get:function(){return this.updateTransform===PIXI.Spine.prototype.autoUpdateTransform},set:function(value){this.updateTransform=value?PIXI.Spine.prototype.autoUpdateTransform:PIXI.DisplayObjectContainer.prototype.updateTransform}}),PIXI.Spine.prototype.update=function(dt){this.state.update(dt),this.state.apply(this.skeleton),this.skeleton.updateWorldTransform();for(var drawOrder=this.skeleton.drawOrder,slots=this.skeleton.slots,i=0,n=drawOrder.length;n>i;i++)this.children[i]=this.slotContainers[drawOrder[i]];for(i=0,n=slots.length;n>i;i++){var slot=slots[i],attachment=slot.attachment,slotContainer=this.slotContainers[i];if(attachment){var type=attachment.type;if(type===spine.AttachmentType.region){if(attachment.rendererObject&&(!slot.currentSpriteName||slot.currentSpriteName!==attachment.name)){var spriteName=attachment.rendererObject.name;if(void 0!==slot.currentSprite&&(slot.currentSprite.visible=!1),slot.sprites=slot.sprites||{},void 0!==slot.sprites[spriteName])slot.sprites[spriteName].visible=!0;else{var sprite=this.createSprite(slot,attachment);slotContainer.addChild(sprite)}slot.currentSprite=slot.sprites[spriteName],slot.currentSpriteName=spriteName}var bone=slot.bone;slotContainer.position.x=bone.worldX+attachment.x*bone.m00+attachment.y*bone.m01,slotContainer.position.y=bone.worldY+attachment.x*bone.m10+attachment.y*bone.m11,slotContainer.scale.x=bone.worldScaleX,slotContainer.scale.y=bone.worldScaleY,slotContainer.rotation=-(slot.bone.worldRotation*spine.degRad),slot.currentSprite.tint=PIXI.rgb2hex([slot.r,slot.g,slot.b])}else{if(type!==spine.AttachmentType.skinnedmesh){slotContainer.visible=!1;continue}if(!slot.currentMeshName||slot.currentMeshName!==attachment.name){var meshName=attachment.name;if(void 0!==slot.currentMesh&&(slot.currentMesh.visible=!1),slot.meshes=slot.meshes||{},void 0!==slot.meshes[meshName])slot.meshes[meshName].visible=!0;else{var mesh=this.createMesh(slot,attachment);slotContainer.addChild(mesh)}slot.currentMesh=slot.meshes[meshName],slot.currentMeshName=meshName}attachment.computeWorldVertices(slot.bone.skeleton.x,slot.bone.skeleton.y,slot,slot.currentMesh.vertices)}slotContainer.visible=!0,slotContainer.alpha=slot.a}else slotContainer.visible=!1}},PIXI.Spine.prototype.autoUpdateTransform=function(){this.lastTime=this.lastTime||Date.now();var timeDelta=.001*(Date.now()-this.lastTime);this.lastTime=Date.now(),this.update(timeDelta),PIXI.DisplayObjectContainer.prototype.updateTransform.call(this)},PIXI.Spine.prototype.createSprite=function(slot,attachment){var descriptor=attachment.rendererObject,baseTexture=descriptor.page.rendererObject,spriteRect=new PIXI.Rectangle(descriptor.x,descriptor.y,descriptor.rotate?descriptor.height:descriptor.width,descriptor.rotate?descriptor.width:descriptor.height),spriteTexture=new PIXI.Texture(baseTexture,spriteRect),sprite=new PIXI.Sprite(spriteTexture),baseRotation=descriptor.rotate?.5*Math.PI:0;return sprite.scale.set(descriptor.width/descriptor.originalWidth*attachment.scaleX,descriptor.height/descriptor.originalHeight*attachment.scaleY),sprite.rotation=baseRotation-attachment.rotation*spine.degRad,sprite.anchor.x=sprite.anchor.y=.5,sprite.alpha=attachment.a,slot.sprites=slot.sprites||{},slot.sprites[descriptor.name]=sprite,sprite},PIXI.Spine.prototype.createMesh=function(slot,attachment){var descriptor=attachment.rendererObject,baseTexture=descriptor.page.rendererObject,texture=new PIXI.Texture(baseTexture),strip=new PIXI.Strip(texture);return strip.drawMode=PIXI.Strip.DrawModes.TRIANGLES,strip.canvasPadding=1.5,strip.vertices=new PIXI.Float32Array(attachment.uvs.length),strip.uvs=attachment.uvs,strip.indices=attachment.triangles,strip.alpha=attachment.a,slot.meshes=slot.meshes||{},slot.meshes[attachment.name]=strip,strip},PIXI.BaseTextureCache={},PIXI.BaseTextureCacheIdGenerator=0,PIXI.BaseTexture=function(source,scaleMode){if(this.resolution=1,this.width=100,this.height=100,this.scaleMode=scaleMode||PIXI.scaleModes.DEFAULT,this.hasLoaded=!1,this.source=source,this._UID=PIXI._UID++,this.premultipliedAlpha=!0,this._glTextures=[],this.mipmap=!1,this._dirty=[!0,!0,!0,!0],source){if((this.source.complete||this.source.getContext)&&this.source.width&&this.source.height)this.hasLoaded=!0,this.width=this.source.naturalWidth||this.source.width,this.height=this.source.naturalHeight||this.source.height,this.dirty();else{var scope=this;this.source.onload=function(){scope.hasLoaded=!0,scope.width=scope.source.naturalWidth||scope.source.width,scope.height=scope.source.naturalHeight||scope.source.height,scope.dirty(),scope.dispatchEvent({type:"loaded",content:scope})},this.source.onerror=function(){scope.dispatchEvent({type:"error",content:scope})}}this.imageUrl=null,this._powerOf2=!1}},PIXI.BaseTexture.prototype.constructor=PIXI.BaseTexture,PIXI.EventTarget.mixin(PIXI.BaseTexture.prototype),PIXI.BaseTexture.prototype.destroy=function(){this.imageUrl?(delete PIXI.BaseTextureCache[this.imageUrl],delete PIXI.TextureCache[this.imageUrl],this.imageUrl=null,navigator.isCocoonJS||(this.source.src="")):this.source&&this.source._pixiId&&delete PIXI.BaseTextureCache[this.source._pixiId],this.source=null,this.unloadFromGPU()},PIXI.BaseTexture.prototype.updateSourceImage=function(newSrc){this.hasLoaded=!1,this.source.src=null,this.source.src=newSrc},PIXI.BaseTexture.prototype.dirty=function(){for(var i=0;i<this._glTextures.length;i++)this._dirty[i]=!0},PIXI.BaseTexture.prototype.unloadFromGPU=function(){this.dirty();for(var i=this._glTextures.length-1;i>=0;i--){var glTexture=this._glTextures[i],gl=PIXI.glContexts[i];gl&&glTexture&&gl.deleteTexture(glTexture)}this._glTextures.length=0,this.dirty()},PIXI.BaseTexture.fromImage=function(imageUrl,crossorigin,scaleMode){var baseTexture=PIXI.BaseTextureCache[imageUrl];if(void 0===crossorigin&&-1===imageUrl.indexOf("data:")&&(crossorigin=!0),!baseTexture){var image=new Image;crossorigin&&(image.crossOrigin=""),image.src=imageUrl,baseTexture=new PIXI.BaseTexture(image,scaleMode),baseTexture.imageUrl=imageUrl,PIXI.BaseTextureCache[imageUrl]=baseTexture,-1!==imageUrl.indexOf(PIXI.RETINA_PREFIX+".")&&(baseTexture.resolution=2)}return baseTexture},PIXI.BaseTexture.fromCanvas=function(canvas,scaleMode){canvas._pixiId||(canvas._pixiId="canvas_"+PIXI.TextureCacheIdGenerator++);var baseTexture=PIXI.BaseTextureCache[canvas._pixiId];return baseTexture||(baseTexture=new PIXI.BaseTexture(canvas,scaleMode),PIXI.BaseTextureCache[canvas._pixiId]=baseTexture),baseTexture},PIXI.TextureCache={},PIXI.FrameCache={},PIXI.TextureCacheIdGenerator=0,PIXI.Texture=function(baseTexture,frame,crop,trim){this.noFrame=!1,frame||(this.noFrame=!0,frame=new PIXI.Rectangle(0,0,1,1)),baseTexture instanceof PIXI.Texture&&(baseTexture=baseTexture.baseTexture),this.baseTexture=baseTexture,this.frame=frame,this.trim=trim,this.valid=!1,this.requiresUpdate=!1,this._uvs=null,this.width=0,this.height=0,this.crop=crop||new PIXI.Rectangle(0,0,1,1),baseTexture.hasLoaded?(this.noFrame&&(frame=new PIXI.Rectangle(0,0,baseTexture.width,baseTexture.height)),this.setFrame(frame)):baseTexture.addEventListener("loaded",this.onBaseTextureLoaded.bind(this))},PIXI.Texture.prototype.constructor=PIXI.Texture,PIXI.EventTarget.mixin(PIXI.Texture.prototype),PIXI.Texture.prototype.onBaseTextureLoaded=function(){var baseTexture=this.baseTexture;baseTexture.removeEventListener("loaded",this.onLoaded),this.noFrame&&(this.frame=new PIXI.Rectangle(0,0,baseTexture.width,baseTexture.height)),this.setFrame(this.frame),this.dispatchEvent({type:"update",content:this})},PIXI.Texture.prototype.destroy=function(destroyBase){destroyBase&&this.baseTexture.destroy(),this.valid=!1},PIXI.Texture.prototype.setFrame=function(frame){if(this.noFrame=!1,this.frame=frame,this.width=frame.width,this.height=frame.height,this.crop.x=frame.x,this.crop.y=frame.y,this.crop.width=frame.width,this.crop.height=frame.height,!this.trim&&(frame.x+frame.width>this.baseTexture.width||frame.y+frame.height>this.baseTexture.height))throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this);this.valid=frame&&frame.width&&frame.height&&this.baseTexture.source&&this.baseTexture.hasLoaded,this.trim&&(this.width=this.trim.width,this.height=this.trim.height,this.frame.width=this.trim.width,this.frame.height=this.trim.height),this.valid&&this._updateUvs()},PIXI.Texture.prototype._updateUvs=function(){this._uvs||(this._uvs=new PIXI.TextureUvs);var frame=this.crop,tw=this.baseTexture.width,th=this.baseTexture.height;this._uvs.x0=frame.x/tw,this._uvs.y0=frame.y/th,this._uvs.x1=(frame.x+frame.width)/tw,this._uvs.y1=frame.y/th,this._uvs.x2=(frame.x+frame.width)/tw,this._uvs.y2=(frame.y+frame.height)/th,this._uvs.x3=frame.x/tw,this._uvs.y3=(frame.y+frame.height)/th},PIXI.Texture.fromImage=function(imageUrl,crossorigin,scaleMode){var texture=PIXI.TextureCache[imageUrl];return texture||(texture=new PIXI.Texture(PIXI.BaseTexture.fromImage(imageUrl,crossorigin,scaleMode)),PIXI.TextureCache[imageUrl]=texture),texture},PIXI.Texture.fromFrame=function(frameId){var texture=PIXI.TextureCache[frameId];if(!texture)throw new Error('The frameId "'+frameId+'" does not exist in the texture cache ');return texture},PIXI.Texture.fromCanvas=function(canvas,scaleMode){var baseTexture=PIXI.BaseTexture.fromCanvas(canvas,scaleMode);return new PIXI.Texture(baseTexture)},PIXI.Texture.addTextureToCache=function(texture,id){PIXI.TextureCache[id]=texture},PIXI.Texture.removeTextureFromCache=function(id){var texture=PIXI.TextureCache[id];return delete PIXI.TextureCache[id],delete PIXI.BaseTextureCache[id],texture},PIXI.TextureUvs=function(){this.x0=0,this.y0=0,this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.x3=0,this.y3=0},PIXI.Texture.emptyTexture=new PIXI.Texture(new PIXI.BaseTexture),PIXI.RenderTexture=function(width,height,renderer,scaleMode,resolution){if(this.width=width||100,this.height=height||100,this.resolution=resolution||1,this.frame=new PIXI.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution),this.crop=new PIXI.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution),this.baseTexture=new PIXI.BaseTexture,this.baseTexture.width=this.width*this.resolution,this.baseTexture.height=this.height*this.resolution,this.baseTexture._glTextures=[],this.baseTexture.resolution=this.resolution,this.baseTexture.scaleMode=scaleMode||PIXI.scaleModes.DEFAULT,this.baseTexture.hasLoaded=!0,PIXI.Texture.call(this,this.baseTexture,new PIXI.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution)),this.renderer=renderer||PIXI.defaultRenderer,this.renderer.type===PIXI.WEBGL_RENDERER){var gl=this.renderer.gl;this.baseTexture._dirty[gl.id]=!1,this.textureBuffer=new PIXI.FilterTexture(gl,this.width,this.height,this.baseTexture.scaleMode),this.baseTexture._glTextures[gl.id]=this.textureBuffer.texture,this.render=this.renderWebGL,this.projection=new PIXI.Point(.5*this.width,.5*-this.height)}else this.render=this.renderCanvas,this.textureBuffer=new PIXI.CanvasBuffer(this.width*this.resolution,this.height*this.resolution),this.baseTexture.source=this.textureBuffer.canvas;this.valid=!0,this._updateUvs()},PIXI.RenderTexture.prototype=Object.create(PIXI.Texture.prototype),PIXI.RenderTexture.prototype.constructor=PIXI.RenderTexture,PIXI.RenderTexture.prototype.resize=function(width,height,updateBase){(width!==this.width||height!==this.height)&&(this.valid=width>0&&height>0,this.width=width,this.height=height,this.frame.width=this.crop.width=width*this.resolution,this.frame.height=this.crop.height=height*this.resolution,updateBase&&(this.baseTexture.width=this.width*this.resolution,this.baseTexture.height=this.height*this.resolution),this.renderer.type===PIXI.WEBGL_RENDERER&&(this.projection.x=this.width/2,this.projection.y=-this.height/2),this.valid&&this.textureBuffer.resize(this.width,this.height))},PIXI.RenderTexture.prototype.clear=function(){this.valid&&(this.renderer.type===PIXI.WEBGL_RENDERER&&this.renderer.gl.bindFramebuffer(this.renderer.gl.FRAMEBUFFER,this.textureBuffer.frameBuffer),this.textureBuffer.clear())},PIXI.RenderTexture.prototype.renderWebGL=function(displayObject,matrix,clear){if(this.valid){var wt=displayObject.worldTransform;wt.identity(),wt.translate(0,2*this.projection.y),matrix&&wt.append(matrix),wt.scale(1,-1),displayObject.worldAlpha=1;for(var children=displayObject.children,i=0,j=children.length;j>i;i++)children[i].updateTransform();var gl=this.renderer.gl;gl.viewport(0,0,this.width*this.resolution,this.height*this.resolution),gl.bindFramebuffer(gl.FRAMEBUFFER,this.textureBuffer.frameBuffer),clear&&this.textureBuffer.clear(),this.renderer.spriteBatch.dirty=!0,this.renderer.renderDisplayObject(displayObject,this.projection,this.textureBuffer.frameBuffer),this.renderer.spriteBatch.dirty=!0}},PIXI.RenderTexture.prototype.renderCanvas=function(displayObject,matrix,clear){if(this.valid){var wt=displayObject.worldTransform;wt.identity(),matrix&&wt.append(matrix),displayObject.worldAlpha=1;for(var children=displayObject.children,i=0,j=children.length;j>i;i++)children[i].updateTransform();clear&&this.textureBuffer.clear();var context=this.textureBuffer.context,realResolution=this.renderer.resolution;this.renderer.resolution=this.resolution,this.renderer.renderDisplayObject(displayObject,context),this.renderer.resolution=realResolution}},PIXI.RenderTexture.prototype.getImage=function(){var image=new Image;return image.src=this.getBase64(),image},PIXI.RenderTexture.prototype.getBase64=function(){return this.getCanvas().toDataURL()},PIXI.RenderTexture.prototype.getCanvas=function(){if(this.renderer.type===PIXI.WEBGL_RENDERER){var gl=this.renderer.gl,width=this.textureBuffer.width,height=this.textureBuffer.height,webGLPixels=new Uint8Array(4*width*height);gl.bindFramebuffer(gl.FRAMEBUFFER,this.textureBuffer.frameBuffer),gl.readPixels(0,0,width,height,gl.RGBA,gl.UNSIGNED_BYTE,webGLPixels),gl.bindFramebuffer(gl.FRAMEBUFFER,null);var tempCanvas=new PIXI.CanvasBuffer(width,height),canvasData=tempCanvas.context.getImageData(0,0,width,height);return canvasData.data.set(webGLPixels),tempCanvas.context.putImageData(canvasData,0,0),tempCanvas.canvas}return this.textureBuffer.canvas},PIXI.RenderTexture.tempMatrix=new PIXI.Matrix,PIXI.VideoTexture=function(source,scaleMode){if(!source)throw new Error("No video source element specified.");(source.readyState===source.HAVE_ENOUGH_DATA||source.readyState===source.HAVE_FUTURE_DATA)&&source.width&&source.height&&(source.complete=!0),PIXI.BaseTexture.call(this,source,scaleMode),this.autoUpdate=!1,this.updateBound=this._onUpdate.bind(this),source.complete||(this._onCanPlay=this.onCanPlay.bind(this),source.addEventListener("canplay",this._onCanPlay),source.addEventListener("canplaythrough",this._onCanPlay),source.addEventListener("play",this.onPlayStart.bind(this)),source.addEventListener("pause",this.onPlayStop.bind(this)))},PIXI.VideoTexture.prototype=Object.create(PIXI.BaseTexture.prototype),PIXI.VideoTexture.constructor=PIXI.VideoTexture,PIXI.VideoTexture.prototype._onUpdate=function(){this.autoUpdate&&(window.requestAnimationFrame(this.updateBound),this.dirty())},PIXI.VideoTexture.prototype.onPlayStart=function(){this.autoUpdate||(window.requestAnimationFrame(this.updateBound),this.autoUpdate=!0)},PIXI.VideoTexture.prototype.onPlayStop=function(){this.autoUpdate=!1},PIXI.VideoTexture.prototype.onCanPlay=function(){"canplaythrough"===event.type&&(this.hasLoaded=!0,this.source&&(this.source.removeEventListener("canplay",this._onCanPlay),this.source.removeEventListener("canplaythrough",this._onCanPlay),this.width=this.source.videoWidth,this.height=this.source.videoHeight,this.__loaded||(this.__loaded=!0,this.dispatchEvent({type:"loaded",content:this}))))},PIXI.VideoTexture.prototype.destroy=function(){this.source&&this.source._pixiId&&(PIXI.BaseTextureCache[this.source._pixiId]=null,delete PIXI.BaseTextureCache[this.source._pixiId],this.source._pixiId=null,delete this.source._pixiId),PIXI.BaseTexture.prototype.destroy.call(this)},PIXI.VideoTexture.baseTextureFromVideo=function(video,scaleMode){video._pixiId||(video._pixiId="video_"+PIXI.TextureCacheIdGenerator++);var baseTexture=PIXI.BaseTextureCache[video._pixiId];return baseTexture||(baseTexture=new PIXI.VideoTexture(video,scaleMode),PIXI.BaseTextureCache[video._pixiId]=baseTexture),baseTexture},PIXI.VideoTexture.textureFromVideo=function(video,scaleMode){var baseTexture=PIXI.VideoTexture.baseTextureFromVideo(video,scaleMode);return new PIXI.Texture(baseTexture)},PIXI.VideoTexture.fromUrl=function(videoSrc,scaleMode){var video=document.createElement("video");return video.src=videoSrc,video.autoPlay=!0,video.play(),PIXI.VideoTexture.textureFromVideo(video,scaleMode)},PIXI.AssetLoader=function(assetURLs,crossorigin){this.assetURLs=assetURLs,this.crossorigin=crossorigin,this.loadersByType={jpg:PIXI.ImageLoader,jpeg:PIXI.ImageLoader,png:PIXI.ImageLoader,gif:PIXI.ImageLoader,webp:PIXI.ImageLoader,json:PIXI.JsonLoader,atlas:PIXI.AtlasLoader,anim:PIXI.SpineLoader,xml:PIXI.BitmapFontLoader,fnt:PIXI.BitmapFontLoader}},PIXI.EventTarget.mixin(PIXI.AssetLoader.prototype),PIXI.AssetLoader.prototype.constructor=PIXI.AssetLoader,PIXI.AssetLoader.prototype._getDataType=function(str){var test="data:",start=str.slice(0,test.length).toLowerCase();if(start===test){var data=str.slice(test.length),sepIdx=data.indexOf(",");if(-1===sepIdx)return null;var info=data.slice(0,sepIdx).split(";")[0];return info&&"text/plain"!==info.toLowerCase()?info.split("/").pop().toLowerCase():"txt"}return null},PIXI.AssetLoader.prototype.load=function(){function onLoad(evt){scope.onAssetLoaded(evt.data.content)}var scope=this;this.loadCount=this.assetURLs.length;for(var i=0;i<this.assetURLs.length;i++){var fileName=this.assetURLs[i],fileType=this._getDataType(fileName);fileType||(fileType=fileName.split("?").shift().split(".").pop().toLowerCase());var Constructor=this.loadersByType[fileType];if(!Constructor)throw new Error(fileType+" is an unsupported file type");var loader=new Constructor(fileName,this.crossorigin);loader.on("loaded",onLoad),loader.load()}},PIXI.AssetLoader.prototype.onAssetLoaded=function(loader){this.loadCount--,this.emit("onProgress",{content:this,loader:loader,loaded:this.assetURLs.length-this.loadCount,total:this.assetURLs.length}),this.onProgress&&this.onProgress(loader),this.loadCount||(this.emit("onComplete",{content:this}),this.onComplete&&this.onComplete())},PIXI.JsonLoader=function(url,crossorigin){this.url=url,this.crossorigin=crossorigin,this.baseUrl=url.replace(/[^\/]*$/,""),this.loaded=!1},PIXI.JsonLoader.prototype.constructor=PIXI.JsonLoader,PIXI.EventTarget.mixin(PIXI.JsonLoader.prototype),PIXI.JsonLoader.prototype.load=function(){window.XDomainRequest&&this.crossorigin?(this.ajaxRequest=new window.XDomainRequest,this.ajaxRequest.timeout=3e3,this.ajaxRequest.onerror=this.onError.bind(this),this.ajaxRequest.ontimeout=this.onError.bind(this),this.ajaxRequest.onprogress=function(){},this.ajaxRequest.onload=this.onJSONLoaded.bind(this)):(window.XMLHttpRequest?this.ajaxRequest=new window.XMLHttpRequest:this.ajaxRequest=new window.ActiveXObject("Microsoft.XMLHTTP"),this.ajaxRequest.onreadystatechange=this.onReadyStateChanged.bind(this)),this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.send()},PIXI.JsonLoader.prototype.onReadyStateChanged=function(){4!==this.ajaxRequest.readyState||200!==this.ajaxRequest.status&&-1!==window.location.href.indexOf("http")||this.onJSONLoaded()},PIXI.JsonLoader.prototype.onJSONLoaded=function(){if(!this.ajaxRequest.responseText)return void this.onError();if(this.json=JSON.parse(this.ajaxRequest.responseText),this.json.frames&&this.json.meta&&this.json.meta.image){var textureUrl=this.json.meta.image;-1===textureUrl.indexOf("data:")&&(textureUrl=this.baseUrl+textureUrl);var image=new PIXI.ImageLoader(textureUrl,this.crossorigin),frameData=this.json.frames;this.texture=image.texture.baseTexture,image.addEventListener("loaded",this.onLoaded.bind(this));for(var i in frameData){var rect=frameData[i].frame;if(rect){var textureSize=new PIXI.Rectangle(rect.x,rect.y,rect.w,rect.h),crop=textureSize.clone(),trim=null;if(frameData[i].trimmed){var actualSize=frameData[i].sourceSize,realSize=frameData[i].spriteSourceSize;trim=new PIXI.Rectangle(realSize.x,realSize.y,actualSize.w,actualSize.h)}PIXI.TextureCache[i]=new PIXI.Texture(this.texture,textureSize,crop,trim)}}image.load()}else if(this.json.bones)if(PIXI.AnimCache[this.url])this.onLoaded();else{var atlasPath=this.url.substr(0,this.url.lastIndexOf("."))+".atlas",atlasLoader=new PIXI.JsonLoader(atlasPath,this.crossorigin),originalLoader=this;atlasLoader.onJSONLoaded=function(){if(!this.ajaxRequest.responseText)return void this.onError();var textureLoader=new PIXI.SpineTextureLoader(this.url.substring(0,this.url.lastIndexOf("/"))),spineAtlas=new spine.Atlas(this.ajaxRequest.responseText,textureLoader),attachmentLoader=new spine.AtlasAttachmentLoader(spineAtlas),spineJsonParser=new spine.SkeletonJson(attachmentLoader),skeletonData=spineJsonParser.readSkeletonData(originalLoader.json);PIXI.AnimCache[originalLoader.url]=skeletonData,originalLoader.spine=skeletonData,originalLoader.spineAtlas=spineAtlas,originalLoader.spineAtlasLoader=atlasLoader,textureLoader.loadingCount>0?textureLoader.addEventListener("loadedBaseTexture",function(evt){evt.content.content.loadingCount<=0&&originalLoader.onLoaded()}):originalLoader.onLoaded()},atlasLoader.load()}else this.onLoaded()},PIXI.JsonLoader.prototype.onLoaded=function(){this.loaded=!0,this.dispatchEvent({type:"loaded",content:this})},PIXI.JsonLoader.prototype.onError=function(){this.dispatchEvent({type:"error",content:this})},PIXI.AtlasLoader=function(url,crossorigin){this.url=url,this.baseUrl=url.replace(/[^\/]*$/,""),this.crossorigin=crossorigin,this.loaded=!1},PIXI.AtlasLoader.constructor=PIXI.AtlasLoader,
PIXI.EventTarget.mixin(PIXI.AtlasLoader.prototype),PIXI.AtlasLoader.prototype.load=function(){this.ajaxRequest=new PIXI.AjaxRequest,this.ajaxRequest.onreadystatechange=this.onAtlasLoaded.bind(this),this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/json"),this.ajaxRequest.send(null)},PIXI.AtlasLoader.prototype.onAtlasLoaded=function(){if(4===this.ajaxRequest.readyState)if(200===this.ajaxRequest.status||-1===window.location.href.indexOf("http")){this.atlas={meta:{image:[]},frames:[]};var result=this.ajaxRequest.responseText.split(/\r?\n/),lineCount=-3,currentImageId=0,currentFrame=null,nameInNextLine=!1,i=0,j=0,selfOnLoaded=this.onLoaded.bind(this);for(i=0;i<result.length;i++)if(result[i]=result[i].replace(/^\s+|\s+$/g,""),""===result[i]&&(nameInNextLine=i+1),result[i].length>0){if(nameInNextLine===i)this.atlas.meta.image.push(result[i]),currentImageId=this.atlas.meta.image.length-1,this.atlas.frames.push({}),lineCount=-3;else if(lineCount>0)if(lineCount%7===1)null!=currentFrame&&(this.atlas.frames[currentImageId][currentFrame.name]=currentFrame),currentFrame={name:result[i],frame:{}};else{var text=result[i].split(" ");if(lineCount%7===3)currentFrame.frame.x=Number(text[1].replace(",","")),currentFrame.frame.y=Number(text[2]);else if(lineCount%7===4)currentFrame.frame.w=Number(text[1].replace(",","")),currentFrame.frame.h=Number(text[2]);else if(lineCount%7===5){var realSize={x:0,y:0,w:Number(text[1].replace(",","")),h:Number(text[2])};realSize.w>currentFrame.frame.w||realSize.h>currentFrame.frame.h?(currentFrame.trimmed=!0,currentFrame.realSize=realSize):currentFrame.trimmed=!1}}lineCount++}if(null!=currentFrame&&(this.atlas.frames[currentImageId][currentFrame.name]=currentFrame),this.atlas.meta.image.length>0){for(this.images=[],j=0;j<this.atlas.meta.image.length;j++){var textureUrl=this.baseUrl+this.atlas.meta.image[j],frameData=this.atlas.frames[j];this.images.push(new PIXI.ImageLoader(textureUrl,this.crossorigin));for(i in frameData){var rect=frameData[i].frame;rect&&(PIXI.TextureCache[i]=new PIXI.Texture(this.images[j].texture.baseTexture,{x:rect.x,y:rect.y,width:rect.w,height:rect.h}),frameData[i].trimmed&&(PIXI.TextureCache[i].realSize=frameData[i].realSize,PIXI.TextureCache[i].trim.x=0,PIXI.TextureCache[i].trim.y=0))}}for(this.currentImageId=0,j=0;j<this.images.length;j++)this.images[j].on("loaded",selfOnLoaded);this.images[this.currentImageId].load()}else this.onLoaded()}else this.onError()},PIXI.AtlasLoader.prototype.onLoaded=function(){this.images.length-1>this.currentImageId?(this.currentImageId++,this.images[this.currentImageId].load()):(this.loaded=!0,this.emit("loaded",{content:this}))},PIXI.AtlasLoader.prototype.onError=function(){this.emit("error",{content:this})},PIXI.SpriteSheetLoader=function(url,crossorigin){this.url=url,this.crossorigin=crossorigin,this.baseUrl=url.replace(/[^\/]*$/,""),this.texture=null,this.frames={}},PIXI.SpriteSheetLoader.prototype.constructor=PIXI.SpriteSheetLoader,PIXI.EventTarget.mixin(PIXI.SpriteSheetLoader.prototype),PIXI.SpriteSheetLoader.prototype.load=function(){var scope=this,jsonLoader=new PIXI.JsonLoader(this.url,this.crossorigin);jsonLoader.on("loaded",function(event){scope.json=event.data.content.json,scope.onLoaded()}),jsonLoader.load()},PIXI.SpriteSheetLoader.prototype.onLoaded=function(){this.emit("loaded",{content:this})},PIXI.ImageLoader=function(url,crossorigin){this.texture=PIXI.Texture.fromImage(url,crossorigin),this.frames=[]},PIXI.ImageLoader.prototype.constructor=PIXI.ImageLoader,PIXI.EventTarget.mixin(PIXI.ImageLoader.prototype),PIXI.ImageLoader.prototype.load=function(){this.texture.baseTexture.hasLoaded?this.onLoaded():this.texture.baseTexture.on("loaded",this.onLoaded.bind(this))},PIXI.ImageLoader.prototype.onLoaded=function(){this.emit("loaded",{content:this})},PIXI.ImageLoader.prototype.loadFramedSpriteSheet=function(frameWidth,frameHeight,textureName){this.frames=[];for(var cols=Math.floor(this.texture.width/frameWidth),rows=Math.floor(this.texture.height/frameHeight),i=0,y=0;rows>y;y++)for(var x=0;cols>x;x++,i++){var texture=new PIXI.Texture(this.texture.baseTexture,{x:x*frameWidth,y:y*frameHeight,width:frameWidth,height:frameHeight});this.frames.push(texture),textureName&&(PIXI.TextureCache[textureName+"-"+i]=texture)}this.load()},PIXI.BitmapFontLoader=function(url,crossorigin){this.url=url,this.crossorigin=crossorigin,this.baseUrl=url.replace(/[^\/]*$/,""),this.texture=null},PIXI.BitmapFontLoader.prototype.constructor=PIXI.BitmapFontLoader,PIXI.EventTarget.mixin(PIXI.BitmapFontLoader.prototype),PIXI.BitmapFontLoader.prototype.load=function(){this.ajaxRequest=new PIXI.AjaxRequest,this.ajaxRequest.onreadystatechange=this.onXMLLoaded.bind(this),this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/xml"),this.ajaxRequest.send(null)},PIXI.BitmapFontLoader.prototype.onXMLLoaded=function(){if(4===this.ajaxRequest.readyState&&(200===this.ajaxRequest.status||-1===window.location.protocol.indexOf("http"))){var responseXML=this.ajaxRequest.responseXML;if(!responseXML||/MSIE 9/i.test(navigator.userAgent)||navigator.isCocoonJS)if("function"==typeof window.DOMParser){var domparser=new DOMParser;responseXML=domparser.parseFromString(this.ajaxRequest.responseText,"text/xml")}else{var div=document.createElement("div");div.innerHTML=this.ajaxRequest.responseText,responseXML=div}var textureUrl=this.baseUrl+responseXML.getElementsByTagName("page")[0].getAttribute("file"),image=new PIXI.ImageLoader(textureUrl,this.crossorigin);this.texture=image.texture.baseTexture;var data={},info=responseXML.getElementsByTagName("info")[0],common=responseXML.getElementsByTagName("common")[0];data.font=info.getAttribute("face"),data.size=parseInt(info.getAttribute("size"),10),data.lineHeight=parseInt(common.getAttribute("lineHeight"),10),data.chars={};for(var letters=responseXML.getElementsByTagName("char"),i=0;i<letters.length;i++){var charCode=parseInt(letters[i].getAttribute("id"),10),textureRect=new PIXI.Rectangle(parseInt(letters[i].getAttribute("x"),10),parseInt(letters[i].getAttribute("y"),10),parseInt(letters[i].getAttribute("width"),10),parseInt(letters[i].getAttribute("height"),10));data.chars[charCode]={xOffset:parseInt(letters[i].getAttribute("xoffset"),10),yOffset:parseInt(letters[i].getAttribute("yoffset"),10),xAdvance:parseInt(letters[i].getAttribute("xadvance"),10),kerning:{},texture:PIXI.TextureCache[charCode]=new PIXI.Texture(this.texture,textureRect)}}var kernings=responseXML.getElementsByTagName("kerning");for(i=0;i<kernings.length;i++){var first=parseInt(kernings[i].getAttribute("first"),10),second=parseInt(kernings[i].getAttribute("second"),10),amount=parseInt(kernings[i].getAttribute("amount"),10);data.chars[second].kerning[first]=amount}PIXI.BitmapText.fonts[data.font]=data,image.addEventListener("loaded",this.onLoaded.bind(this)),image.load()}},PIXI.BitmapFontLoader.prototype.onLoaded=function(){this.emit("loaded",{content:this})},PIXI.SpineLoader=function(url,crossorigin){this.url=url,this.crossorigin=crossorigin,this.loaded=!1},PIXI.SpineLoader.prototype.constructor=PIXI.SpineLoader,PIXI.EventTarget.mixin(PIXI.SpineLoader.prototype),PIXI.SpineLoader.prototype.load=function(){var scope=this,jsonLoader=new PIXI.JsonLoader(this.url,this.crossorigin);jsonLoader.on("loaded",function(event){scope.json=event.data.content.json,scope.onLoaded()}),jsonLoader.load()},PIXI.SpineLoader.prototype.onLoaded=function(){this.loaded=!0,this.emit("loaded",{content:this})},PIXI.AbstractFilter=function(fragmentSrc,uniforms){this.passes=[this],this.shaders=[],this.dirty=!0,this.padding=0,this.uniforms=uniforms||{},this.fragmentSrc=fragmentSrc||[]},PIXI.AbstractFilter.prototype.constructor=PIXI.AbstractFilter,PIXI.AbstractFilter.prototype.syncUniforms=function(){for(var i=0,j=this.shaders.length;j>i;i++)this.shaders[i].dirty=!0},PIXI.AlphaMaskFilter=function(texture){PIXI.AbstractFilter.call(this),this.passes=[this],texture.baseTexture._powerOf2=!0,this.uniforms={mask:{type:"sampler2D",value:texture},mapDimensions:{type:"2f",value:{x:1,y:5112}},dimensions:{type:"4fv",value:[0,0,0,0]}},texture.baseTexture.hasLoaded?(this.uniforms.mask.value.x=texture.width,this.uniforms.mask.value.y=texture.height):(this.boundLoadedFunction=this.onTextureLoaded.bind(this),texture.baseTexture.on("loaded",this.boundLoadedFunction)),this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D mask;","uniform sampler2D uSampler;","uniform vec2 offset;","uniform vec4 dimensions;","uniform vec2 mapDimensions;","void main(void) {","   vec2 mapCords = vTextureCoord.xy;","   mapCords += (dimensions.zw + offset)/ dimensions.xy ;","   mapCords.y *= -1.0;","   mapCords.y += 1.0;","   mapCords *= dimensions.xy / mapDimensions;","   vec4 original =  texture2D(uSampler, vTextureCoord);","   float maskAlpha =  texture2D(mask, mapCords).r;","   original *= maskAlpha;","   gl_FragColor =  original;","}"]},PIXI.AlphaMaskFilter.prototype=Object.create(PIXI.AbstractFilter.prototype),PIXI.AlphaMaskFilter.prototype.constructor=PIXI.AlphaMaskFilter,PIXI.AlphaMaskFilter.prototype.onTextureLoaded=function(){this.uniforms.mapDimensions.value.x=this.uniforms.mask.value.width,this.uniforms.mapDimensions.value.y=this.uniforms.mask.value.height,this.uniforms.mask.value.baseTexture.off("loaded",this.boundLoadedFunction)},Object.defineProperty(PIXI.AlphaMaskFilter.prototype,"map",{get:function(){return this.uniforms.mask.value},set:function(value){this.uniforms.mask.value=value}}),PIXI.ColorMatrixFilter=function(){PIXI.AbstractFilter.call(this),this.passes=[this],this.uniforms={matrix:{type:"mat4",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float invert;","uniform mat4 matrix;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * matrix;","}"]},PIXI.ColorMatrixFilter.prototype=Object.create(PIXI.AbstractFilter.prototype),PIXI.ColorMatrixFilter.prototype.constructor=PIXI.ColorMatrixFilter,Object.defineProperty(PIXI.ColorMatrixFilter.prototype,"matrix",{get:function(){return this.uniforms.matrix.value},set:function(value){this.uniforms.matrix.value=value}}),PIXI.GrayFilter=function(){PIXI.AbstractFilter.call(this),this.passes=[this],this.uniforms={gray:{type:"1f",value:1}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform float gray;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix(gl_FragColor.rgb, vec3(0.2126*gl_FragColor.r + 0.7152*gl_FragColor.g + 0.0722*gl_FragColor.b), gray);","}"]},PIXI.GrayFilter.prototype=Object.create(PIXI.AbstractFilter.prototype),PIXI.GrayFilter.prototype.constructor=PIXI.GrayFilter,Object.defineProperty(PIXI.GrayFilter.prototype,"gray",{get:function(){return this.uniforms.gray.value},set:function(value){this.uniforms.gray.value=value}}),PIXI.DisplacementFilter=function(texture){PIXI.AbstractFilter.call(this),this.passes=[this],texture.baseTexture._powerOf2=!0,this.uniforms={displacementMap:{type:"sampler2D",value:texture},scale:{type:"2f",value:{x:30,y:30}},offset:{type:"2f",value:{x:0,y:0}},mapDimensions:{type:"2f",value:{x:1,y:5112}},dimensions:{type:"4fv",value:[0,0,0,0]}},texture.baseTexture.hasLoaded?(this.uniforms.mapDimensions.value.x=texture.width,this.uniforms.mapDimensions.value.y=texture.height):(this.boundLoadedFunction=this.onTextureLoaded.bind(this),texture.baseTexture.on("loaded",this.boundLoadedFunction)),this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D displacementMap;","uniform sampler2D uSampler;","uniform vec2 scale;","uniform vec2 offset;","uniform vec4 dimensions;","uniform vec2 mapDimensions;","void main(void) {","   vec2 mapCords = vTextureCoord.xy;","   mapCords += (dimensions.zw + offset)/ dimensions.xy ;","   mapCords.y *= -1.0;","   mapCords.y += 1.0;","   vec2 matSample = texture2D(displacementMap, mapCords).xy;","   matSample -= 0.5;","   matSample *= scale;","   matSample /= mapDimensions;","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x + matSample.x, vTextureCoord.y + matSample.y));","   gl_FragColor.rgb = mix( gl_FragColor.rgb, gl_FragColor.rgb, 1.0);","   vec2 cord = vTextureCoord;","}"]},PIXI.DisplacementFilter.prototype=Object.create(PIXI.AbstractFilter.prototype),PIXI.DisplacementFilter.prototype.constructor=PIXI.DisplacementFilter,PIXI.DisplacementFilter.prototype.onTextureLoaded=function(){this.uniforms.mapDimensions.value.x=this.uniforms.displacementMap.value.width,this.uniforms.mapDimensions.value.y=this.uniforms.displacementMap.value.height,this.uniforms.displacementMap.value.baseTexture.off("loaded",this.boundLoadedFunction)},Object.defineProperty(PIXI.DisplacementFilter.prototype,"map",{get:function(){return this.uniforms.displacementMap.value},set:function(value){this.uniforms.displacementMap.value=value}}),Object.defineProperty(PIXI.DisplacementFilter.prototype,"scale",{get:function(){return this.uniforms.scale.value},set:function(value){this.uniforms.scale.value=value}}),Object.defineProperty(PIXI.DisplacementFilter.prototype,"offset",{get:function(){return this.uniforms.offset.value},set:function(value){this.uniforms.offset.value=value}}),PIXI.PixelateFilter=function(){PIXI.AbstractFilter.call(this),this.passes=[this],this.uniforms={invert:{type:"1f",value:0},dimensions:{type:"4fv",value:new PIXI.Float32Array([1e4,100,10,10])},pixelSize:{type:"2f",value:{x:10,y:10}}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec2 testDim;","uniform vec4 dimensions;","uniform vec2 pixelSize;","uniform sampler2D uSampler;","void main(void) {","   vec2 coord = vTextureCoord;","   vec2 size = dimensions.xy/pixelSize;","   vec2 color = floor( ( vTextureCoord * size ) ) / size + pixelSize/dimensions.xy * 0.5;","   gl_FragColor = texture2D(uSampler, color);","}"]},PIXI.PixelateFilter.prototype=Object.create(PIXI.AbstractFilter.prototype),PIXI.PixelateFilter.prototype.constructor=PIXI.PixelateFilter,Object.defineProperty(PIXI.PixelateFilter.prototype,"size",{get:function(){return this.uniforms.pixelSize.value},set:function(value){this.dirty=!0,this.uniforms.pixelSize.value=value}}),PIXI.BlurXFilter=function(){PIXI.AbstractFilter.call(this),this.passes=[this],this.uniforms={blur:{type:"1f",value:1/512}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","   vec4 sum = vec4(0.0);","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 4.0*blur, vTextureCoord.y)) * 0.05;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 3.0*blur, vTextureCoord.y)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 2.0*blur, vTextureCoord.y)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - blur, vTextureCoord.y)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * 0.16;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + blur, vTextureCoord.y)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 2.0*blur, vTextureCoord.y)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 3.0*blur, vTextureCoord.y)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 4.0*blur, vTextureCoord.y)) * 0.05;","   gl_FragColor = sum;","}"]},PIXI.BlurXFilter.prototype=Object.create(PIXI.AbstractFilter.prototype),PIXI.BlurXFilter.prototype.constructor=PIXI.BlurXFilter,Object.defineProperty(PIXI.BlurXFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(value){this.dirty=!0,this.uniforms.blur.value=1/7e3*value}}),PIXI.BlurYFilter=function(){PIXI.AbstractFilter.call(this),this.passes=[this],this.uniforms={blur:{type:"1f",value:1/512}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","   vec4 sum = vec4(0.0);","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 4.0*blur)) * 0.05;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 3.0*blur)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 2.0*blur)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - blur)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * 0.16;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + blur)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 2.0*blur)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 3.0*blur)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 4.0*blur)) * 0.05;","   gl_FragColor = sum;","}"]},PIXI.BlurYFilter.prototype=Object.create(PIXI.AbstractFilter.prototype),PIXI.BlurYFilter.prototype.constructor=PIXI.BlurYFilter,Object.defineProperty(PIXI.BlurYFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(value){this.uniforms.blur.value=1/7e3*value}}),PIXI.BlurFilter=function(){this.blurXFilter=new PIXI.BlurXFilter,this.blurYFilter=new PIXI.BlurYFilter,this.passes=[this.blurXFilter,this.blurYFilter]},PIXI.BlurFilter.prototype=Object.create(PIXI.AbstractFilter.prototype),PIXI.BlurFilter.prototype.constructor=PIXI.BlurFilter,Object.defineProperty(PIXI.BlurFilter.prototype,"blur",{get:function(){return this.blurXFilter.blur},set:function(value){this.blurXFilter.blur=this.blurYFilter.blur=value}}),Object.defineProperty(PIXI.BlurFilter.prototype,"blurX",{get:function(){return this.blurXFilter.blur},set:function(value){this.blurXFilter.blur=value}}),Object.defineProperty(PIXI.BlurFilter.prototype,"blurY",{get:function(){return this.blurYFilter.blur},set:function(value){this.blurYFilter.blur=value}}),PIXI.InvertFilter=function(){PIXI.AbstractFilter.call(this),this.passes=[this],this.uniforms={invert:{type:"1f",value:1}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float invert;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix( (vec3(1)-gl_FragColor.rgb) * gl_FragColor.a, gl_FragColor.rgb, 1.0 - invert);","}"]},PIXI.InvertFilter.prototype=Object.create(PIXI.AbstractFilter.prototype),PIXI.InvertFilter.prototype.constructor=PIXI.InvertFilter,Object.defineProperty(PIXI.InvertFilter.prototype,"invert",{get:function(){return this.uniforms.invert.value},set:function(value){this.uniforms.invert.value=value}}),PIXI.SepiaFilter=function(){PIXI.AbstractFilter.call(this),this.passes=[this],this.uniforms={sepia:{type:"1f",value:1}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float sepia;","uniform sampler2D uSampler;","const mat3 sepiaMatrix = mat3(0.3588, 0.7044, 0.1368, 0.2990, 0.5870, 0.1140, 0.2392, 0.4696, 0.0912);","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix( gl_FragColor.rgb, gl_FragColor.rgb * sepiaMatrix, sepia);","}"]},PIXI.SepiaFilter.prototype=Object.create(PIXI.AbstractFilter.prototype),PIXI.SepiaFilter.prototype.constructor=PIXI.SepiaFilter,Object.defineProperty(PIXI.SepiaFilter.prototype,"sepia",{get:function(){return this.uniforms.sepia.value},set:function(value){this.uniforms.sepia.value=value}}),PIXI.TwistFilter=function(){PIXI.AbstractFilter.call(this),this.passes=[this],this.uniforms={radius:{type:"1f",value:.5},angle:{type:"1f",value:5},offset:{type:"2f",value:{x:.5,y:.5}}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec4 dimensions;","uniform sampler2D uSampler;","uniform float radius;","uniform float angle;","uniform vec2 offset;","void main(void) {","   vec2 coord = vTextureCoord - offset;","   float distance = length(coord);","   if (distance < radius) {","       float ratio = (radius - distance) / radius;","       float angleMod = ratio * ratio * angle;","       float s = sin(angleMod);","       float c = cos(angleMod);","       coord = vec2(coord.x * c - coord.y * s, coord.x * s + coord.y * c);","   }","   gl_FragColor = texture2D(uSampler, coord+offset);","}"]},PIXI.TwistFilter.prototype=Object.create(PIXI.AbstractFilter.prototype),PIXI.TwistFilter.prototype.constructor=PIXI.TwistFilter,Object.defineProperty(PIXI.TwistFilter.prototype,"offset",{get:function(){return this.uniforms.offset.value},set:function(value){this.dirty=!0,this.uniforms.offset.value=value}}),Object.defineProperty(PIXI.TwistFilter.prototype,"radius",{get:function(){return this.uniforms.radius.value},set:function(value){this.dirty=!0,this.uniforms.radius.value=value}}),Object.defineProperty(PIXI.TwistFilter.prototype,"angle",{get:function(){return this.uniforms.angle.value},set:function(value){this.dirty=!0,this.uniforms.angle.value=value}}),PIXI.ColorStepFilter=function(){PIXI.AbstractFilter.call(this),this.passes=[this],this.uniforms={step:{type:"1f",value:5}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform float step;","void main(void) {","   vec4 color = texture2D(uSampler, vTextureCoord);","   color = floor(color * step) / step;","   gl_FragColor = color;","}"]},PIXI.ColorStepFilter.prototype=Object.create(PIXI.AbstractFilter.prototype),PIXI.ColorStepFilter.prototype.constructor=PIXI.ColorStepFilter,Object.defineProperty(PIXI.ColorStepFilter.prototype,"step",{get:function(){return this.uniforms.step.value},set:function(value){this.uniforms.step.value=value}}),PIXI.DotScreenFilter=function(){PIXI.AbstractFilter.call(this),this.passes=[this],this.uniforms={scale:{type:"1f",value:1},angle:{type:"1f",value:5},dimensions:{type:"4fv",value:[0,0,0,0]}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec4 dimensions;","uniform sampler2D uSampler;","uniform float angle;","uniform float scale;","float pattern() {","   float s = sin(angle), c = cos(angle);","   vec2 tex = vTextureCoord * dimensions.xy;","   vec2 point = vec2(","       c * tex.x - s * tex.y,","       s * tex.x + c * tex.y","   ) * scale;","   return (sin(point.x) * sin(point.y)) * 4.0;","}","void main() {","   vec4 color = texture2D(uSampler, vTextureCoord);","   float average = (color.r + color.g + color.b) / 3.0;","   gl_FragColor = vec4(vec3(average * 10.0 - 5.0 + pattern()), color.a);","}"]},PIXI.DotScreenFilter.prototype=Object.create(PIXI.AbstractFilter.prototype),PIXI.DotScreenFilter.prototype.constructor=PIXI.DotScreenFilter,Object.defineProperty(PIXI.DotScreenFilter.prototype,"scale",{get:function(){return this.uniforms.scale.value},set:function(value){this.dirty=!0,this.uniforms.scale.value=value}}),Object.defineProperty(PIXI.DotScreenFilter.prototype,"angle",{get:function(){return this.uniforms.angle.value},set:function(value){this.dirty=!0,this.uniforms.angle.value=value}}),PIXI.CrossHatchFilter=function(){PIXI.AbstractFilter.call(this),this.passes=[this],this.uniforms={blur:{type:"1f",value:1/512}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","    float lum = length(texture2D(uSampler, vTextureCoord.xy).rgb);","    gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);","    if (lum < 1.00) {","        if (mod(gl_FragCoord.x + gl_FragCoord.y, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.75) {","        if (mod(gl_FragCoord.x - gl_FragCoord.y, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.50) {","        if (mod(gl_FragCoord.x + gl_FragCoord.y - 5.0, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.3) {","        if (mod(gl_FragCoord.x - gl_FragCoord.y - 5.0, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","}"]},PIXI.CrossHatchFilter.prototype=Object.create(PIXI.AbstractFilter.prototype),PIXI.CrossHatchFilter.prototype.constructor=PIXI.CrossHatchFilter,Object.defineProperty(PIXI.CrossHatchFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(value){this.uniforms.blur.value=1/7e3*value}}),PIXI.RGBSplitFilter=function(){PIXI.AbstractFilter.call(this),this.passes=[this],this.uniforms={red:{type:"2f",value:{x:20,y:20}},green:{type:"2f",value:{x:-20,y:20}},blue:{type:"2f",value:{x:20,y:-20}},dimensions:{type:"4fv",value:[0,0,0,0]}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec2 red;","uniform vec2 green;","uniform vec2 blue;","uniform vec4 dimensions;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor.r = texture2D(uSampler, vTextureCoord + red/dimensions.xy).r;","   gl_FragColor.g = texture2D(uSampler, vTextureCoord + green/dimensions.xy).g;","   gl_FragColor.b = texture2D(uSampler, vTextureCoord + blue/dimensions.xy).b;","   gl_FragColor.a = texture2D(uSampler, vTextureCoord).a;","}"]},PIXI.RGBSplitFilter.prototype=Object.create(PIXI.AbstractFilter.prototype),PIXI.RGBSplitFilter.prototype.constructor=PIXI.RGBSplitFilter,Object.defineProperty(PIXI.RGBSplitFilter.prototype,"red",{get:function(){return this.uniforms.red.value},set:function(value){this.uniforms.red.value=value}}),Object.defineProperty(PIXI.RGBSplitFilter.prototype,"green",{get:function(){return this.uniforms.green.value},set:function(value){this.uniforms.green.value=value}}),Object.defineProperty(PIXI.RGBSplitFilter.prototype,"blue",{get:function(){return this.uniforms.blue.value},set:function(value){this.uniforms.blue.value=value}}),!function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.p2=e()}}(function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){function Buffer(subject,encoding,noZero){if(!(this instanceof Buffer))return new Buffer(subject,encoding,noZero);var type=typeof subject;if("base64"===encoding&&"string"===type)for(subject=stringtrim(subject);subject.length%4!==0;)subject+="=";var length;if("number"===type)length=coerce(subject);else if("string"===type)length=Buffer.byteLength(subject,encoding);else{if("object"!==type)throw new Error("First argument needs to be a number, array or string.");length=coerce(subject.length)}var buf;Buffer._useTypedArrays?buf=augment(new Uint8Array(length)):(buf=this,buf.length=length,buf._isBuffer=!0);var i;if(Buffer._useTypedArrays&&"function"==typeof Uint8Array&&subject instanceof Uint8Array)buf._set(subject);else if(isArrayish(subject))for(i=0;length>i;i++)Buffer.isBuffer(subject)?buf[i]=subject.readUInt8(i):buf[i]=subject[i];else if("string"===type)buf.write(subject,0,encoding);else if("number"===type&&!Buffer._useTypedArrays&&!noZero)for(i=0;length>i;i++)buf[i]=0;return buf}function _hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;length?(length=Number(length),length>remaining&&(length=remaining)):length=remaining;var strLen=string.length;assert(strLen%2===0,"Invalid hex string"),length>strLen/2&&(length=strLen/2);for(var i=0;length>i;i++){var byte=parseInt(string.substr(2*i,2),16);assert(!isNaN(byte),"Invalid hex string"),buf[offset+i]=byte}return Buffer._charsWritten=2*i,i}function _utf8Write(buf,string,offset,length){var charsWritten=Buffer._charsWritten=blitBuffer(utf8ToBytes(string),buf,offset,length);return charsWritten}function _asciiWrite(buf,string,offset,length){var charsWritten=Buffer._charsWritten=blitBuffer(asciiToBytes(string),buf,offset,length);return charsWritten}function _binaryWrite(buf,string,offset,length){return _asciiWrite(buf,string,offset,length)}function _base64Write(buf,string,offset,length){var charsWritten=Buffer._charsWritten=blitBuffer(base64ToBytes(string),buf,offset,length);return charsWritten}function _utf16leWrite(buf,string,offset,length){var charsWritten=Buffer._charsWritten=blitBuffer(utf16leToBytes(string),buf,offset,length);return charsWritten}function _base64Slice(buf,start,end){return 0===start&&end===buf.length?base64.fromByteArray(buf):base64.fromByteArray(buf.slice(start,end))}function _utf8Slice(buf,start,end){var res="",tmp="";end=Math.min(buf.length,end);for(var i=start;end>i;i++)buf[i]<=127?(res+=decodeUtf8Char(tmp)+String.fromCharCode(buf[i]),tmp=""):tmp+="%"+buf[i].toString(16);return res+decodeUtf8Char(tmp)}function _asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;end>i;i++)ret+=String.fromCharCode(buf[i]);return ret}function _binarySlice(buf,start,end){return _asciiSlice(buf,start,end)}function _hexSlice(buf,start,end){var len=buf.length;(!start||0>start)&&(start=0),(!end||0>end||end>len)&&(end=len);for(var out="",i=start;end>i;i++)out+=toHex(buf[i]);return out}function _utf16leSlice(buf,start,end){for(var bytes=buf.slice(start,end),res="",i=0;i<bytes.length;i+=2)res+=String.fromCharCode(bytes[i]+256*bytes[i+1]);return res}function _readUInt16(buf,offset,littleEndian,noAssert){noAssert||(assert("boolean"==typeof littleEndian,"missing or invalid endian"),assert(void 0!==offset&&null!==offset,"missing offset"),assert(offset+1<buf.length,"Trying to read beyond buffer length"));var len=buf.length;if(!(offset>=len)){var val;return littleEndian?(val=buf[offset],len>offset+1&&(val|=buf[offset+1]<<8)):(val=buf[offset]<<8,len>offset+1&&(val|=buf[offset+1])),val}}function _readUInt32(buf,offset,littleEndian,noAssert){noAssert||(assert("boolean"==typeof littleEndian,"missing or invalid endian"),assert(void 0!==offset&&null!==offset,"missing offset"),assert(offset+3<buf.length,"Trying to read beyond buffer length"));var len=buf.length;if(!(offset>=len)){var val;return littleEndian?(len>offset+2&&(val=buf[offset+2]<<16),len>offset+1&&(val|=buf[offset+1]<<8),val|=buf[offset],len>offset+3&&(val+=buf[offset+3]<<24>>>0)):(len>offset+1&&(val=buf[offset+1]<<16),len>offset+2&&(val|=buf[offset+2]<<8),len>offset+3&&(val|=buf[offset+3]),val+=buf[offset]<<24>>>0),val}}function _readInt16(buf,offset,littleEndian,noAssert){noAssert||(assert("boolean"==typeof littleEndian,"missing or invalid endian"),assert(void 0!==offset&&null!==offset,"missing offset"),assert(offset+1<buf.length,"Trying to read beyond buffer length"));var len=buf.length;if(!(offset>=len)){var val=_readUInt16(buf,offset,littleEndian,!0),neg=32768&val;return neg?-1*(65535-val+1):val}}function _readInt32(buf,offset,littleEndian,noAssert){noAssert||(assert("boolean"==typeof littleEndian,"missing or invalid endian"),assert(void 0!==offset&&null!==offset,"missing offset"),assert(offset+3<buf.length,"Trying to read beyond buffer length"));var len=buf.length;if(!(offset>=len)){var val=_readUInt32(buf,offset,littleEndian,!0),neg=2147483648&val;return neg?-1*(4294967295-val+1):val}}function _readFloat(buf,offset,littleEndian,noAssert){
return noAssert||(assert("boolean"==typeof littleEndian,"missing or invalid endian"),assert(offset+3<buf.length,"Trying to read beyond buffer length")),ieee754.read(buf,offset,littleEndian,23,4)}function _readDouble(buf,offset,littleEndian,noAssert){return noAssert||(assert("boolean"==typeof littleEndian,"missing or invalid endian"),assert(offset+7<buf.length,"Trying to read beyond buffer length")),ieee754.read(buf,offset,littleEndian,52,8)}function _writeUInt16(buf,value,offset,littleEndian,noAssert){noAssert||(assert(void 0!==value&&null!==value,"missing value"),assert("boolean"==typeof littleEndian,"missing or invalid endian"),assert(void 0!==offset&&null!==offset,"missing offset"),assert(offset+1<buf.length,"trying to write beyond buffer length"),verifuint(value,65535));var len=buf.length;if(!(offset>=len))for(var i=0,j=Math.min(len-offset,2);j>i;i++)buf[offset+i]=(value&255<<8*(littleEndian?i:1-i))>>>8*(littleEndian?i:1-i)}function _writeUInt32(buf,value,offset,littleEndian,noAssert){noAssert||(assert(void 0!==value&&null!==value,"missing value"),assert("boolean"==typeof littleEndian,"missing or invalid endian"),assert(void 0!==offset&&null!==offset,"missing offset"),assert(offset+3<buf.length,"trying to write beyond buffer length"),verifuint(value,4294967295));var len=buf.length;if(!(offset>=len))for(var i=0,j=Math.min(len-offset,4);j>i;i++)buf[offset+i]=value>>>8*(littleEndian?i:3-i)&255}function _writeInt16(buf,value,offset,littleEndian,noAssert){noAssert||(assert(void 0!==value&&null!==value,"missing value"),assert("boolean"==typeof littleEndian,"missing or invalid endian"),assert(void 0!==offset&&null!==offset,"missing offset"),assert(offset+1<buf.length,"Trying to write beyond buffer length"),verifsint(value,32767,-32768));var len=buf.length;offset>=len||(value>=0?_writeUInt16(buf,value,offset,littleEndian,noAssert):_writeUInt16(buf,65535+value+1,offset,littleEndian,noAssert))}function _writeInt32(buf,value,offset,littleEndian,noAssert){noAssert||(assert(void 0!==value&&null!==value,"missing value"),assert("boolean"==typeof littleEndian,"missing or invalid endian"),assert(void 0!==offset&&null!==offset,"missing offset"),assert(offset+3<buf.length,"Trying to write beyond buffer length"),verifsint(value,2147483647,-2147483648));var len=buf.length;offset>=len||(value>=0?_writeUInt32(buf,value,offset,littleEndian,noAssert):_writeUInt32(buf,4294967295+value+1,offset,littleEndian,noAssert))}function _writeFloat(buf,value,offset,littleEndian,noAssert){noAssert||(assert(void 0!==value&&null!==value,"missing value"),assert("boolean"==typeof littleEndian,"missing or invalid endian"),assert(void 0!==offset&&null!==offset,"missing offset"),assert(offset+3<buf.length,"Trying to write beyond buffer length"),verifIEEE754(value,3.4028234663852886e38,-3.4028234663852886e38));var len=buf.length;offset>=len||ieee754.write(buf,value,offset,littleEndian,23,4)}function _writeDouble(buf,value,offset,littleEndian,noAssert){noAssert||(assert(void 0!==value&&null!==value,"missing value"),assert("boolean"==typeof littleEndian,"missing or invalid endian"),assert(void 0!==offset&&null!==offset,"missing offset"),assert(offset+7<buf.length,"Trying to write beyond buffer length"),verifIEEE754(value,1.7976931348623157e308,-1.7976931348623157e308));var len=buf.length;offset>=len||ieee754.write(buf,value,offset,littleEndian,52,8)}function stringtrim(str){return str.trim?str.trim():str.replace(/^\s+|\s+$/g,"")}function augment(arr){return arr._isBuffer=!0,arr._get=arr.get,arr._set=arr.set,arr.get=BP.get,arr.set=BP.set,arr.write=BP.write,arr.toString=BP.toString,arr.toLocaleString=BP.toString,arr.toJSON=BP.toJSON,arr.copy=BP.copy,arr.slice=BP.slice,arr.readUInt8=BP.readUInt8,arr.readUInt16LE=BP.readUInt16LE,arr.readUInt16BE=BP.readUInt16BE,arr.readUInt32LE=BP.readUInt32LE,arr.readUInt32BE=BP.readUInt32BE,arr.readInt8=BP.readInt8,arr.readInt16LE=BP.readInt16LE,arr.readInt16BE=BP.readInt16BE,arr.readInt32LE=BP.readInt32LE,arr.readInt32BE=BP.readInt32BE,arr.readFloatLE=BP.readFloatLE,arr.readFloatBE=BP.readFloatBE,arr.readDoubleLE=BP.readDoubleLE,arr.readDoubleBE=BP.readDoubleBE,arr.writeUInt8=BP.writeUInt8,arr.writeUInt16LE=BP.writeUInt16LE,arr.writeUInt16BE=BP.writeUInt16BE,arr.writeUInt32LE=BP.writeUInt32LE,arr.writeUInt32BE=BP.writeUInt32BE,arr.writeInt8=BP.writeInt8,arr.writeInt16LE=BP.writeInt16LE,arr.writeInt16BE=BP.writeInt16BE,arr.writeInt32LE=BP.writeInt32LE,arr.writeInt32BE=BP.writeInt32BE,arr.writeFloatLE=BP.writeFloatLE,arr.writeFloatBE=BP.writeFloatBE,arr.writeDoubleLE=BP.writeDoubleLE,arr.writeDoubleBE=BP.writeDoubleBE,arr.fill=BP.fill,arr.inspect=BP.inspect,arr.toArrayBuffer=BP.toArrayBuffer,arr}function clamp(index,len,defaultValue){return"number"!=typeof index?defaultValue:(index=~~index,index>=len?len:index>=0?index:(index+=len,index>=0?index:0))}function coerce(length){return length=~~Math.ceil(+length),0>length?0:length}function isArray(subject){return(Array.isArray||function(subject){return"[object Array]"===Object.prototype.toString.call(subject)})(subject)}function isArrayish(subject){return isArray(subject)||Buffer.isBuffer(subject)||subject&&"object"==typeof subject&&"number"==typeof subject.length}function toHex(n){return 16>n?"0"+n.toString(16):n.toString(16)}function utf8ToBytes(str){for(var byteArray=[],i=0;i<str.length;i++){var b=str.charCodeAt(i);if(127>=b)byteArray.push(str.charCodeAt(i));else{var start=i;b>=55296&&57343>=b&&i++;for(var h=encodeURIComponent(str.slice(start,i+1)).substr(1).split("%"),j=0;j<h.length;j++)byteArray.push(parseInt(h[j],16))}}return byteArray}function asciiToBytes(str){for(var byteArray=[],i=0;i<str.length;i++)byteArray.push(255&str.charCodeAt(i));return byteArray}function utf16leToBytes(str){for(var c,hi,lo,byteArray=[],i=0;i<str.length;i++)c=str.charCodeAt(i),hi=c>>8,lo=c%256,byteArray.push(lo),byteArray.push(hi);return byteArray}function base64ToBytes(str){return base64.toByteArray(str)}function blitBuffer(src,dst,offset,length){for(var i=0;length>i&&!(i+offset>=dst.length||i>=src.length);i++)dst[i+offset]=src[i];return i}function decodeUtf8Char(str){try{return decodeURIComponent(str)}catch(err){return String.fromCharCode(65533)}}function verifuint(value,max){assert("number"==typeof value,"cannot write a non-number as a number"),assert(value>=0,"specified a negative value for writing an unsigned value"),assert(max>=value,"value is larger than maximum value for type"),assert(Math.floor(value)===value,"value has a fractional component")}function verifsint(value,max,min){assert("number"==typeof value,"cannot write a non-number as a number"),assert(max>=value,"value larger than maximum allowed value"),assert(value>=min,"value smaller than minimum allowed value"),assert(Math.floor(value)===value,"value has a fractional component")}function verifIEEE754(value,max,min){assert("number"==typeof value,"cannot write a non-number as a number"),assert(max>=value,"value larger than maximum allowed value"),assert(value>=min,"value smaller than minimum allowed value")}function assert(test,message){if(!test)throw new Error(message||"Failed assertion")}var base64=_dereq_("base64-js"),ieee754=_dereq_("ieee754");exports.Buffer=Buffer,exports.SlowBuffer=Buffer,exports.INSPECT_MAX_BYTES=50,Buffer.poolSize=8192,Buffer._useTypedArrays=function(){if("function"!=typeof Uint8Array||"function"!=typeof ArrayBuffer)return!1;try{var arr=new Uint8Array(0);return arr.foo=function(){return 42},42===arr.foo()&&"function"==typeof arr.subarray}catch(e){return!1}}(),Buffer.isEncoding=function(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.isBuffer=function(b){return!(null===b||void 0===b||!b._isBuffer)},Buffer.byteLength=function(str,encoding){var ret;switch(str+="",encoding||"utf8"){case"hex":ret=str.length/2;break;case"utf8":case"utf-8":ret=utf8ToBytes(str).length;break;case"ascii":case"binary":case"raw":ret=str.length;break;case"base64":ret=base64ToBytes(str).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":ret=2*str.length;break;default:throw new Error("Unknown encoding")}return ret},Buffer.concat=function(list,totalLength){if(assert(isArray(list),"Usage: Buffer.concat(list, [totalLength])\nlist should be an Array."),0===list.length)return new Buffer(0);if(1===list.length)return list[0];var i;if("number"!=typeof totalLength)for(totalLength=0,i=0;i<list.length;i++)totalLength+=list[i].length;var buf=new Buffer(totalLength),pos=0;for(i=0;i<list.length;i++){var item=list[i];item.copy(buf,pos),pos+=item.length}return buf},Buffer.prototype.write=function(string,offset,length,encoding){if(isFinite(offset))isFinite(length)||(encoding=length,length=void 0);else{var swap=encoding;encoding=offset,offset=length,length=swap}offset=Number(offset)||0;var remaining=this.length-offset;length?(length=Number(length),length>remaining&&(length=remaining)):length=remaining,encoding=String(encoding||"utf8").toLowerCase();var ret;switch(encoding){case"hex":ret=_hexWrite(this,string,offset,length);break;case"utf8":case"utf-8":ret=_utf8Write(this,string,offset,length);break;case"ascii":ret=_asciiWrite(this,string,offset,length);break;case"binary":ret=_binaryWrite(this,string,offset,length);break;case"base64":ret=_base64Write(this,string,offset,length);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":ret=_utf16leWrite(this,string,offset,length);break;default:throw new Error("Unknown encoding")}return ret},Buffer.prototype.toString=function(encoding,start,end){var self=this;if(encoding=String(encoding||"utf8").toLowerCase(),start=Number(start)||0,end=void 0!==end?Number(end):end=self.length,end===start)return"";var ret;switch(encoding){case"hex":ret=_hexSlice(self,start,end);break;case"utf8":case"utf-8":ret=_utf8Slice(self,start,end);break;case"ascii":ret=_asciiSlice(self,start,end);break;case"binary":ret=_binarySlice(self,start,end);break;case"base64":ret=_base64Slice(self,start,end);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":ret=_utf16leSlice(self,start,end);break;default:throw new Error("Unknown encoding")}return ret},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},Buffer.prototype.copy=function(target,target_start,start,end){var source=this;if(start||(start=0),end||0===end||(end=this.length),target_start||(target_start=0),end!==start&&0!==target.length&&0!==source.length){assert(end>=start,"sourceEnd < sourceStart"),assert(target_start>=0&&target_start<target.length,"targetStart out of bounds"),assert(start>=0&&start<source.length,"sourceStart out of bounds"),assert(end>=0&&end<=source.length,"sourceEnd out of bounds"),end>this.length&&(end=this.length),target.length-target_start<end-start&&(end=target.length-target_start+start);for(var i=0;end-start>i;i++)target[i+target_start]=this[i+start]}},Buffer.prototype.slice=function(start,end){var len=this.length;if(start=clamp(start,len,0),end=clamp(end,len,len),Buffer._useTypedArrays)return augment(this.subarray(start,end));for(var sliceLen=end-start,newBuf=new Buffer(sliceLen,void 0,!0),i=0;sliceLen>i;i++)newBuf[i]=this[i+start];return newBuf},Buffer.prototype.get=function(offset){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(offset)},Buffer.prototype.set=function(v,offset){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(v,offset)},Buffer.prototype.readUInt8=function(offset,noAssert){return noAssert||(assert(void 0!==offset&&null!==offset,"missing offset"),assert(offset<this.length,"Trying to read beyond buffer length")),offset>=this.length?void 0:this[offset]},Buffer.prototype.readUInt16LE=function(offset,noAssert){return _readUInt16(this,offset,!0,noAssert)},Buffer.prototype.readUInt16BE=function(offset,noAssert){return _readUInt16(this,offset,!1,noAssert)},Buffer.prototype.readUInt32LE=function(offset,noAssert){return _readUInt32(this,offset,!0,noAssert)},Buffer.prototype.readUInt32BE=function(offset,noAssert){return _readUInt32(this,offset,!1,noAssert)},Buffer.prototype.readInt8=function(offset,noAssert){if(noAssert||(assert(void 0!==offset&&null!==offset,"missing offset"),assert(offset<this.length,"Trying to read beyond buffer length")),!(offset>=this.length)){var neg=128&this[offset];return neg?-1*(255-this[offset]+1):this[offset]}},Buffer.prototype.readInt16LE=function(offset,noAssert){return _readInt16(this,offset,!0,noAssert)},Buffer.prototype.readInt16BE=function(offset,noAssert){return _readInt16(this,offset,!1,noAssert)},Buffer.prototype.readInt32LE=function(offset,noAssert){return _readInt32(this,offset,!0,noAssert)},Buffer.prototype.readInt32BE=function(offset,noAssert){return _readInt32(this,offset,!1,noAssert)},Buffer.prototype.readFloatLE=function(offset,noAssert){return _readFloat(this,offset,!0,noAssert)},Buffer.prototype.readFloatBE=function(offset,noAssert){return _readFloat(this,offset,!1,noAssert)},Buffer.prototype.readDoubleLE=function(offset,noAssert){return _readDouble(this,offset,!0,noAssert)},Buffer.prototype.readDoubleBE=function(offset,noAssert){return _readDouble(this,offset,!1,noAssert)},Buffer.prototype.writeUInt8=function(value,offset,noAssert){noAssert||(assert(void 0!==value&&null!==value,"missing value"),assert(void 0!==offset&&null!==offset,"missing offset"),assert(offset<this.length,"trying to write beyond buffer length"),verifuint(value,255)),offset>=this.length||(this[offset]=value)},Buffer.prototype.writeUInt16LE=function(value,offset,noAssert){_writeUInt16(this,value,offset,!0,noAssert)},Buffer.prototype.writeUInt16BE=function(value,offset,noAssert){_writeUInt16(this,value,offset,!1,noAssert)},Buffer.prototype.writeUInt32LE=function(value,offset,noAssert){_writeUInt32(this,value,offset,!0,noAssert)},Buffer.prototype.writeUInt32BE=function(value,offset,noAssert){_writeUInt32(this,value,offset,!1,noAssert)},Buffer.prototype.writeInt8=function(value,offset,noAssert){noAssert||(assert(void 0!==value&&null!==value,"missing value"),assert(void 0!==offset&&null!==offset,"missing offset"),assert(offset<this.length,"Trying to write beyond buffer length"),verifsint(value,127,-128)),offset>=this.length||(value>=0?this.writeUInt8(value,offset,noAssert):this.writeUInt8(255+value+1,offset,noAssert))},Buffer.prototype.writeInt16LE=function(value,offset,noAssert){_writeInt16(this,value,offset,!0,noAssert)},Buffer.prototype.writeInt16BE=function(value,offset,noAssert){_writeInt16(this,value,offset,!1,noAssert)},Buffer.prototype.writeInt32LE=function(value,offset,noAssert){_writeInt32(this,value,offset,!0,noAssert)},Buffer.prototype.writeInt32BE=function(value,offset,noAssert){_writeInt32(this,value,offset,!1,noAssert)},Buffer.prototype.writeFloatLE=function(value,offset,noAssert){_writeFloat(this,value,offset,!0,noAssert)},Buffer.prototype.writeFloatBE=function(value,offset,noAssert){_writeFloat(this,value,offset,!1,noAssert)},Buffer.prototype.writeDoubleLE=function(value,offset,noAssert){_writeDouble(this,value,offset,!0,noAssert)},Buffer.prototype.writeDoubleBE=function(value,offset,noAssert){_writeDouble(this,value,offset,!1,noAssert)},Buffer.prototype.fill=function(value,start,end){if(value||(value=0),start||(start=0),end||(end=this.length),"string"==typeof value&&(value=value.charCodeAt(0)),assert("number"==typeof value&&!isNaN(value),"value is not a number"),assert(end>=start,"end < start"),end!==start&&0!==this.length){assert(start>=0&&start<this.length,"start out of bounds"),assert(end>=0&&end<=this.length,"end out of bounds");for(var i=start;end>i;i++)this[i]=value}},Buffer.prototype.inspect=function(){for(var out=[],len=this.length,i=0;len>i;i++)if(out[i]=toHex(this[i]),i===exports.INSPECT_MAX_BYTES){out[i+1]="...";break}return"<Buffer "+out.join(" ")+">"},Buffer.prototype.toArrayBuffer=function(){if("function"==typeof Uint8Array){if(Buffer._useTypedArrays)return new Buffer(this).buffer;for(var buf=new Uint8Array(this.length),i=0,len=buf.length;len>i;i+=1)buf[i]=this[i];return buf.buffer}throw new Error("Buffer.toArrayBuffer not supported in this browser")};var BP=Buffer.prototype}).call(this,_dereq_("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/../node_modules/grunt-browserify/node_modules/browserify/node_modules/buffer/index.js","/../node_modules/grunt-browserify/node_modules/browserify/node_modules/buffer")},{"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,"base64-js":2,buffer:1,ieee754:3}],2:[function(_dereq_,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){var lookup="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";!function(exports){"use strict";function decode(elt){var code=elt.charCodeAt(0);return code===PLUS?62:code===SLASH?63:NUMBER>code?-1:NUMBER+10>code?code-NUMBER+26+26:UPPER+26>code?code-UPPER:LOWER+26>code?code-LOWER+26:void 0}function b64ToByteArray(b64){function push(v){arr[L++]=v}var i,j,l,tmp,placeHolders,arr;if(b64.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var len=b64.length;placeHolders="="===b64.charAt(len-2)?2:"="===b64.charAt(len-1)?1:0,arr=new Arr(3*b64.length/4-placeHolders),l=placeHolders>0?b64.length-4:b64.length;var L=0;for(i=0,j=0;l>i;i+=4,j+=3)tmp=decode(b64.charAt(i))<<18|decode(b64.charAt(i+1))<<12|decode(b64.charAt(i+2))<<6|decode(b64.charAt(i+3)),push((16711680&tmp)>>16),push((65280&tmp)>>8),push(255&tmp);return 2===placeHolders?(tmp=decode(b64.charAt(i))<<2|decode(b64.charAt(i+1))>>4,push(255&tmp)):1===placeHolders&&(tmp=decode(b64.charAt(i))<<10|decode(b64.charAt(i+1))<<4|decode(b64.charAt(i+2))>>2,push(tmp>>8&255),push(255&tmp)),arr}function uint8ToBase64(uint8){function encode(num){return lookup.charAt(num)}function tripletToBase64(num){return encode(num>>18&63)+encode(num>>12&63)+encode(num>>6&63)+encode(63&num)}var i,temp,length,extraBytes=uint8.length%3,output="";for(i=0,length=uint8.length-extraBytes;length>i;i+=3)temp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2],output+=tripletToBase64(temp);switch(extraBytes){case 1:temp=uint8[uint8.length-1],output+=encode(temp>>2),output+=encode(temp<<4&63),output+="==";break;case 2:temp=(uint8[uint8.length-2]<<8)+uint8[uint8.length-1],output+=encode(temp>>10),output+=encode(temp>>4&63),output+=encode(temp<<2&63),output+="="}return output}var Arr="undefined"!=typeof Uint8Array?Uint8Array:Array,PLUS=("0".charCodeAt(0),"+".charCodeAt(0)),SLASH="/".charCodeAt(0),NUMBER="0".charCodeAt(0),LOWER="a".charCodeAt(0),UPPER="A".charCodeAt(0);module.exports.toByteArray=b64ToByteArray,module.exports.fromByteArray=uint8ToBase64}()}).call(this,_dereq_("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/../node_modules/grunt-browserify/node_modules/browserify/node_modules/buffer/node_modules/base64-js/lib/b64.js","/../node_modules/grunt-browserify/node_modules/browserify/node_modules/buffer/node_modules/base64-js/lib")},{"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],3:[function(_dereq_,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=isLE?nBytes-1:0,d=isLE?-1:1,s=buffer[offset+i];for(i+=d,e=s&(1<<-nBits)-1,s>>=-nBits,nBits+=eLen;nBits>0;e=256*e+buffer[offset+i],i+=d,nBits-=8);for(m=e&(1<<-nBits)-1,e>>=-nBits,nBits+=mLen;nBits>0;m=256*m+buffer[offset+i],i+=d,nBits-=8);if(0===e)e=1-eBias;else{if(e===eMax)return m?NaN:(s?-1:1)*(1/0);m+=Math.pow(2,mLen),e-=eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)},exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=23===mLen?Math.pow(2,-24)-Math.pow(2,-77):0,i=isLE?0:nBytes-1,d=isLE?1:-1,s=0>value||0===value&&0>1/value?1:0;for(value=Math.abs(value),isNaN(value)||value===1/0?(m=isNaN(value)?1:0,e=eMax):(e=Math.floor(Math.log(value)/Math.LN2),value*(c=Math.pow(2,-e))<1&&(e--,c*=2),value+=e+eBias>=1?rt/c:rt*Math.pow(2,1-eBias),value*c>=2&&(e++,c/=2),e+eBias>=eMax?(m=0,e=eMax):e+eBias>=1?(m=(value*c-1)*Math.pow(2,mLen),e+=eBias):(m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen),e=0));mLen>=8;buffer[offset+i]=255&m,i+=d,m/=256,mLen-=8);for(e=e<<mLen|m,eLen+=mLen;eLen>0;buffer[offset+i]=255&e,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=128*s}}).call(this,_dereq_("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/../node_modules/grunt-browserify/node_modules/browserify/node_modules/buffer/node_modules/ieee754/index.js","/../node_modules/grunt-browserify/node_modules/browserify/node_modules/buffer/node_modules/ieee754")},{"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],4:[function(_dereq_,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){function noop(){}var process=module.exports={};process.nextTick=function(){var canSetImmediate="undefined"!=typeof window&&window.setImmediate,canPost="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(canSetImmediate)return function(f){return window.setImmediate(f)};if(canPost){var queue=[];return window.addEventListener("message",function(ev){var source=ev.source;if((source===window||null===source)&&"process-tick"===ev.data&&(ev.stopPropagation(),queue.length>0)){var fn=queue.shift();fn()}},!0),function(fn){queue.push(fn),window.postMessage("process-tick","*")}}return function(fn){setTimeout(fn,0)}}(),process.title="browser",process.browser=!0,process.env={},process.argv=[],process.on=noop,process.once=noop,process.off=noop,process.emit=noop,process.binding=function(name){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(dir){throw new Error("process.chdir is not supported")}}).call(this,_dereq_("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/../node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js","/../node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process")},{"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],5:[function(_dereq_,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){function Line(){}var Scalar=_dereq_("./Scalar");module.exports=Line,Line.lineInt=function(l1,l2,precision){precision=precision||0;var a1,b1,c1,a2,b2,c2,det,i=[0,0];return a1=l1[1][1]-l1[0][1],b1=l1[0][0]-l1[1][0],c1=a1*l1[0][0]+b1*l1[0][1],a2=l2[1][1]-l2[0][1],b2=l2[0][0]-l2[1][0],c2=a2*l2[0][0]+b2*l2[0][1],det=a1*b2-a2*b1,Scalar.eq(det,0,precision)||(i[0]=(b2*c1-b1*c2)/det,i[1]=(a1*c2-a2*c1)/det),i},Line.segmentsIntersect=function(p1,p2,q1,q2){var dx=p2[0]-p1[0],dy=p2[1]-p1[1],da=q2[0]-q1[0],db=q2[1]-q1[1];if(da*dy-db*dx==0)return!1;var s=(dx*(q1[1]-p1[1])+dy*(p1[0]-q1[0]))/(da*dy-db*dx),t=(da*(p1[1]-q1[1])+db*(q1[0]-p1[0]))/(db*dx-da*dy);return s>=0&&1>=s&&t>=0&&1>=t}}).call(this,_dereq_("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/../node_modules/poly-decomp/src/Line.js","/../node_modules/poly-decomp/src")},{"./Scalar":8,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],6:[function(_dereq_,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){function Point(){}module.exports=Point,Point.area=function(a,b,c){return(b[0]-a[0])*(c[1]-a[1])-(c[0]-a[0])*(b[1]-a[1])},Point.left=function(a,b,c){return Point.area(a,b,c)>0},Point.leftOn=function(a,b,c){return Point.area(a,b,c)>=0},Point.right=function(a,b,c){return Point.area(a,b,c)<0},Point.rightOn=function(a,b,c){return Point.area(a,b,c)<=0};var tmpPoint1=[],tmpPoint2=[];Point.collinear=function(a,b,c,thresholdAngle){if(thresholdAngle){var ab=tmpPoint1,bc=tmpPoint2;ab[0]=b[0]-a[0],ab[1]=b[1]-a[1],bc[0]=c[0]-b[0],bc[1]=c[1]-b[1];var dot=ab[0]*bc[0]+ab[1]*bc[1],magA=Math.sqrt(ab[0]*ab[0]+ab[1]*ab[1]),magB=Math.sqrt(bc[0]*bc[0]+bc[1]*bc[1]),angle=Math.acos(dot/(magA*magB));return thresholdAngle>angle}return 0==Point.area(a,b,c)},Point.sqdist=function(a,b){var dx=b[0]-a[0],dy=b[1]-a[1];return dx*dx+dy*dy}}).call(this,_dereq_("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/../node_modules/poly-decomp/src/Point.js","/../node_modules/poly-decomp/src")},{"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],7:[function(_dereq_,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){function Polygon(){this.vertices=[]}function getIntersectionPoint(p1,p2,q1,q2,delta){delta=delta||0;var a1=p2[1]-p1[1],b1=p1[0]-p2[0],c1=a1*p1[0]+b1*p1[1],a2=q2[1]-q1[1],b2=q1[0]-q2[0],c2=a2*q1[0]+b2*q1[1],det=a1*b2-a2*b1;return Scalar.eq(det,0,delta)?[0,0]:[(b2*c1-b1*c2)/det,(a1*c2-a2*c1)/det]}var Line=_dereq_("./Line"),Point=_dereq_("./Point"),Scalar=_dereq_("./Scalar");module.exports=Polygon,Polygon.prototype.at=function(i){var v=this.vertices,s=v.length;return v[0>i?i%s+s:i%s]},Polygon.prototype.first=function(){return this.vertices[0]},Polygon.prototype.last=function(){return this.vertices[this.vertices.length-1]},Polygon.prototype.clear=function(){this.vertices.length=0},Polygon.prototype.append=function(poly,from,to){if("undefined"==typeof from)throw new Error("From is not given!");if("undefined"==typeof to)throw new Error("To is not given!");if(from>to-1)throw new Error("lol1");if(to>poly.vertices.length)throw new Error("lol2");if(0>from)throw new Error("lol3");for(var i=from;to>i;i++)this.vertices.push(poly.vertices[i])},Polygon.prototype.makeCCW=function(){for(var br=0,v=this.vertices,i=1;i<this.vertices.length;++i)(v[i][1]<v[br][1]||v[i][1]==v[br][1]&&v[i][0]>v[br][0])&&(br=i);Point.left(this.at(br-1),this.at(br),this.at(br+1))||this.reverse()},Polygon.prototype.reverse=function(){for(var tmp=[],i=0,N=this.vertices.length;i!==N;i++)tmp.push(this.vertices.pop());this.vertices=tmp},Polygon.prototype.isReflex=function(i){return Point.right(this.at(i-1),this.at(i),this.at(i+1))};var tmpLine1=[],tmpLine2=[];Polygon.prototype.canSee=function(a,b){var p,dist,l1=tmpLine1,l2=tmpLine2;if(Point.leftOn(this.at(a+1),this.at(a),this.at(b))&&Point.rightOn(this.at(a-1),this.at(a),this.at(b)))return!1;dist=Point.sqdist(this.at(a),this.at(b));for(var i=0;i!==this.vertices.length;++i)if((i+1)%this.vertices.length!==a&&i!==a&&Point.leftOn(this.at(a),this.at(b),this.at(i+1))&&Point.rightOn(this.at(a),this.at(b),this.at(i))&&(l1[0]=this.at(a),l1[1]=this.at(b),l2[0]=this.at(i),l2[1]=this.at(i+1),p=Line.lineInt(l1,l2),Point.sqdist(this.at(a),p)<dist))return!1;return!0},Polygon.prototype.copy=function(i,j,targetPoly){var p=targetPoly||new Polygon;if(p.clear(),j>i)for(var k=i;j>=k;k++)p.vertices.push(this.vertices[k]);else{for(var k=0;j>=k;k++)p.vertices.push(this.vertices[k]);for(var k=i;k<this.vertices.length;k++)p.vertices.push(this.vertices[k])}return p},Polygon.prototype.getCutEdges=function(){for(var min=[],tmp1=[],tmp2=[],tmpPoly=new Polygon,nDiags=Number.MAX_VALUE,i=0;i<this.vertices.length;++i)if(this.isReflex(i))for(var j=0;j<this.vertices.length;++j)if(this.canSee(i,j)){tmp1=this.copy(i,j,tmpPoly).getCutEdges(),tmp2=this.copy(j,i,tmpPoly).getCutEdges();for(var k=0;k<tmp2.length;k++)tmp1.push(tmp2[k]);tmp1.length<nDiags&&(min=tmp1,nDiags=tmp1.length,min.push([this.at(i),this.at(j)]))}return min},Polygon.prototype.decomp=function(){var edges=this.getCutEdges();return edges.length>0?this.slice(edges):[this]},Polygon.prototype.slice=function(cutEdges){if(0==cutEdges.length)return[this];if(cutEdges instanceof Array&&cutEdges.length&&cutEdges[0]instanceof Array&&2==cutEdges[0].length&&cutEdges[0][0]instanceof Array){for(var polys=[this],i=0;i<cutEdges.length;i++)for(var cutEdge=cutEdges[i],j=0;j<polys.length;j++){var poly=polys[j],result=poly.slice(cutEdge);if(result){polys.splice(j,1),polys.push(result[0],result[1]);break}}return polys}var cutEdge=cutEdges,i=this.vertices.indexOf(cutEdge[0]),j=this.vertices.indexOf(cutEdge[1]);return-1!=i&&-1!=j?[this.copy(i,j),this.copy(j,i)]:!1},Polygon.prototype.isSimple=function(){for(var path=this.vertices,i=0;i<path.length-1;i++)for(var j=0;i-1>j;j++)if(Line.segmentsIntersect(path[i],path[i+1],path[j],path[j+1]))return!1;for(var i=1;i<path.length-2;i++)if(Line.segmentsIntersect(path[0],path[path.length-1],path[i],path[i+1]))return!1;return!0},Polygon.prototype.quickDecomp=function(result,reflexVertices,steinerPoints,delta,maxlevel,level){maxlevel=maxlevel||100,level=level||0,delta=delta||25,result="undefined"!=typeof result?result:[],reflexVertices=reflexVertices||[],steinerPoints=steinerPoints||[];var upperInt=[0,0],lowerInt=[0,0],p=[0,0],upperDist=0,lowerDist=0,d=0,closestDist=0,upperIndex=0,lowerIndex=0,closestIndex=0,lowerPoly=new Polygon,upperPoly=new Polygon,poly=this,v=this.vertices;if(v.length<3)return result;if(level++,level>maxlevel)return console.warn("quickDecomp: max level ("+maxlevel+") reached."),result;for(var i=0;i<this.vertices.length;++i)if(poly.isReflex(i)){reflexVertices.push(poly.vertices[i]),upperDist=lowerDist=Number.MAX_VALUE;for(var j=0;j<this.vertices.length;++j)Point.left(poly.at(i-1),poly.at(i),poly.at(j))&&Point.rightOn(poly.at(i-1),poly.at(i),poly.at(j-1))&&(p=getIntersectionPoint(poly.at(i-1),poly.at(i),poly.at(j),poly.at(j-1)),Point.right(poly.at(i+1),poly.at(i),p)&&(d=Point.sqdist(poly.vertices[i],p),lowerDist>d&&(lowerDist=d,lowerInt=p,lowerIndex=j))),Point.left(poly.at(i+1),poly.at(i),poly.at(j+1))&&Point.rightOn(poly.at(i+1),poly.at(i),poly.at(j))&&(p=getIntersectionPoint(poly.at(i+1),poly.at(i),poly.at(j),poly.at(j+1)),Point.left(poly.at(i-1),poly.at(i),p)&&(d=Point.sqdist(poly.vertices[i],p),upperDist>d&&(upperDist=d,upperInt=p,upperIndex=j)));if(lowerIndex==(upperIndex+1)%this.vertices.length)p[0]=(lowerInt[0]+upperInt[0])/2,p[1]=(lowerInt[1]+upperInt[1])/2,
steinerPoints.push(p),upperIndex>i?(lowerPoly.append(poly,i,upperIndex+1),lowerPoly.vertices.push(p),upperPoly.vertices.push(p),0!=lowerIndex&&upperPoly.append(poly,lowerIndex,poly.vertices.length),upperPoly.append(poly,0,i+1)):(0!=i&&lowerPoly.append(poly,i,poly.vertices.length),lowerPoly.append(poly,0,upperIndex+1),lowerPoly.vertices.push(p),upperPoly.vertices.push(p),upperPoly.append(poly,lowerIndex,i+1));else{if(lowerIndex>upperIndex&&(upperIndex+=this.vertices.length),closestDist=Number.MAX_VALUE,lowerIndex>upperIndex)return result;for(var j=lowerIndex;upperIndex>=j;++j)Point.leftOn(poly.at(i-1),poly.at(i),poly.at(j))&&Point.rightOn(poly.at(i+1),poly.at(i),poly.at(j))&&(d=Point.sqdist(poly.at(i),poly.at(j)),closestDist>d&&(closestDist=d,closestIndex=j%this.vertices.length));closestIndex>i?(lowerPoly.append(poly,i,closestIndex+1),0!=closestIndex&&upperPoly.append(poly,closestIndex,v.length),upperPoly.append(poly,0,i+1)):(0!=i&&lowerPoly.append(poly,i,v.length),lowerPoly.append(poly,0,closestIndex+1),upperPoly.append(poly,closestIndex,i+1))}return lowerPoly.vertices.length<upperPoly.vertices.length?(lowerPoly.quickDecomp(result,reflexVertices,steinerPoints,delta,maxlevel,level),upperPoly.quickDecomp(result,reflexVertices,steinerPoints,delta,maxlevel,level)):(upperPoly.quickDecomp(result,reflexVertices,steinerPoints,delta,maxlevel,level),lowerPoly.quickDecomp(result,reflexVertices,steinerPoints,delta,maxlevel,level)),result}return result.push(this),result},Polygon.prototype.removeCollinearPoints=function(precision){for(var num=0,i=this.vertices.length-1;this.vertices.length>3&&i>=0;--i)Point.collinear(this.at(i-1),this.at(i),this.at(i+1),precision)&&(this.vertices.splice(i%this.vertices.length,1),i--,num++);return num}}).call(this,_dereq_("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/../node_modules/poly-decomp/src/Polygon.js","/../node_modules/poly-decomp/src")},{"./Line":5,"./Point":6,"./Scalar":8,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],8:[function(_dereq_,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){function Scalar(){}module.exports=Scalar,Scalar.eq=function(a,b,precision){return precision=precision||0,Math.abs(a-b)<precision}}).call(this,_dereq_("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/../node_modules/poly-decomp/src/Scalar.js","/../node_modules/poly-decomp/src")},{"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],9:[function(_dereq_,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){module.exports={Polygon:_dereq_("./Polygon"),Point:_dereq_("./Point")}}).call(this,_dereq_("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/../node_modules/poly-decomp/src/index.js","/../node_modules/poly-decomp/src")},{"./Point":6,"./Polygon":7,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],10:[function(_dereq_,module,exports){module.exports={name:"p2",version:"0.6.0",description:"A JavaScript 2D physics engine.",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["p2.js","p2","physics","engine","2d"],main:"./src/p2.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/p2.js.git"},bugs:{url:"https://github.com/schteppe/p2.js/issues"},licenses:[{type:"MIT"}],devDependencies:{grunt:"~0.4.0","grunt-contrib-jshint":"~0.9.2","grunt-contrib-nodeunit":"~0.1.2","grunt-contrib-uglify":"~0.4.0","grunt-contrib-watch":"~0.5.0","grunt-browserify":"~2.0.1","grunt-contrib-concat":"^0.4.0"},dependencies:{"poly-decomp":"0.1.0"}}},{}],11:[function(_dereq_,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){function AABB(options){this.lowerBound=vec2.create(),options&&options.lowerBound&&vec2.copy(this.lowerBound,options.lowerBound),this.upperBound=vec2.create(),options&&options.upperBound&&vec2.copy(this.upperBound,options.upperBound)}var vec2=_dereq_("../math/vec2");_dereq_("../utils/Utils");module.exports=AABB;var tmp=vec2.create();AABB.prototype.setFromPoints=function(points,position,angle,skinSize){var l=this.lowerBound,u=this.upperBound;"number"!=typeof angle&&(angle=0),0!==angle?vec2.rotate(l,points[0],angle):vec2.copy(l,points[0]),vec2.copy(u,l);for(var cosAngle=Math.cos(angle),sinAngle=Math.sin(angle),i=1;i<points.length;i++){var p=points[i];if(0!==angle){var x=p[0],y=p[1];tmp[0]=cosAngle*x-sinAngle*y,tmp[1]=sinAngle*x+cosAngle*y,p=tmp}for(var j=0;2>j;j++)p[j]>u[j]&&(u[j]=p[j]),p[j]<l[j]&&(l[j]=p[j])}position&&(vec2.add(this.lowerBound,this.lowerBound,position),vec2.add(this.upperBound,this.upperBound,position)),skinSize&&(this.lowerBound[0]-=skinSize,this.lowerBound[1]-=skinSize,this.upperBound[0]+=skinSize,this.upperBound[1]+=skinSize)},AABB.prototype.copy=function(aabb){vec2.copy(this.lowerBound,aabb.lowerBound),vec2.copy(this.upperBound,aabb.upperBound)},AABB.prototype.extend=function(aabb){for(var i=2;i--;){var l=aabb.lowerBound[i];this.lowerBound[i]>l&&(this.lowerBound[i]=l);var u=aabb.upperBound[i];this.upperBound[i]<u&&(this.upperBound[i]=u)}},AABB.prototype.overlaps=function(aabb){var l1=this.lowerBound,u1=this.upperBound,l2=aabb.lowerBound,u2=aabb.upperBound;return(l2[0]<=u1[0]&&u1[0]<=u2[0]||l1[0]<=u2[0]&&u2[0]<=u1[0])&&(l2[1]<=u1[1]&&u1[1]<=u2[1]||l1[1]<=u2[1]&&u2[1]<=u1[1])}}).call(this,_dereq_("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/collision/AABB.js","/collision")},{"../math/vec2":33,"../utils/Utils":52,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],12:[function(_dereq_,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){function Broadphase(type){this.type=type,this.result=[],this.world=null,this.boundingVolumeType=Broadphase.AABB}var vec2=_dereq_("../math/vec2"),Body=_dereq_("../objects/Body");module.exports=Broadphase,Broadphase.AABB=1,Broadphase.BOUNDING_CIRCLE=2,Broadphase.prototype.setWorld=function(world){this.world=world},Broadphase.prototype.getCollisionPairs=function(world){throw new Error("getCollisionPairs must be implemented in a subclass!")};var dist=vec2.create();Broadphase.boundingRadiusCheck=function(bodyA,bodyB){vec2.sub(dist,bodyA.position,bodyB.position);var d2=vec2.squaredLength(dist),r=bodyA.boundingRadius+bodyB.boundingRadius;return r*r>=d2},Broadphase.aabbCheck=function(bodyA,bodyB){return bodyA.aabbNeedsUpdate&&bodyA.updateAABB(),bodyB.aabbNeedsUpdate&&bodyB.updateAABB(),bodyA.aabb.overlaps(bodyB.aabb)},Broadphase.prototype.boundingVolumeCheck=function(bodyA,bodyB){var result;switch(this.boundingVolumeType){case Broadphase.BOUNDING_CIRCLE:result=Broadphase.boundingRadiusCheck(bodyA,bodyB);break;case Broadphase.AABB:result=Broadphase.aabbCheck(bodyA,bodyB);break;default:throw new Error("Bounding volume type not recognized: "+this.boundingVolumeType)}return result},Broadphase.canCollide=function(bodyA,bodyB){return bodyA.type===Body.STATIC&&bodyB.type===Body.STATIC?!1:bodyA.type===Body.KINEMATIC&&bodyB.type===Body.STATIC||bodyA.type===Body.STATIC&&bodyB.type===Body.KINEMATIC?!1:bodyA.type===Body.KINEMATIC&&bodyB.type===Body.KINEMATIC?!1:bodyA.sleepState===Body.SLEEPING&&bodyB.sleepState===Body.SLEEPING?!1:bodyA.sleepState===Body.SLEEPING&&bodyB.type===Body.STATIC||bodyB.sleepState===Body.SLEEPING&&bodyA.type===Body.STATIC?!1:!0},Broadphase.NAIVE=1,Broadphase.SAP=2}).call(this,_dereq_("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/collision/Broadphase.js","/collision")},{"../math/vec2":33,"../objects/Body":34,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],13:[function(_dereq_,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){function GridBroadphase(options){Broadphase.apply(this),options=Utils.defaults(options,{xmin:-100,xmax:100,ymin:-100,ymax:100,nx:10,ny:10}),this.xmin=options.xmin,this.ymin=options.ymin,this.xmax=options.xmax,this.ymax=options.ymax,this.nx=options.nx,this.ny=options.ny,this.binsizeX=(this.xmax-this.xmin)/this.nx,this.binsizeY=(this.ymax-this.ymin)/this.ny}var Broadphase=(_dereq_("../shapes/Circle"),_dereq_("../shapes/Plane"),_dereq_("../shapes/Particle"),_dereq_("../collision/Broadphase")),Utils=(_dereq_("../math/vec2"),_dereq_("../utils/Utils"));module.exports=GridBroadphase,GridBroadphase.prototype=new Broadphase,GridBroadphase.prototype.getCollisionPairs=function(world){for(var result=[],bodies=world.bodies,Ncolliding=bodies.length,nx=(this.binsizeX,this.binsizeY,this.nx),ny=this.ny,xmin=this.xmin,ymin=this.ymin,xmax=this.xmax,ymax=this.ymax,bins=[],Nbins=nx*ny,i=0;Nbins>i;i++)bins.push([]);for(var xmult=nx/(xmax-xmin),ymult=ny/(ymax-ymin),i=0;i!==Ncolliding;i++)for(var bi=bodies[i],aabb=bi.aabb,lowerX=Math.max(aabb.lowerBound[0],xmin),lowerY=Math.max(aabb.lowerBound[1],ymin),upperX=Math.min(aabb.upperBound[0],xmax),upperY=Math.min(aabb.upperBound[1],ymax),xi1=Math.floor(xmult*(lowerX-xmin)),yi1=Math.floor(ymult*(lowerY-ymin)),xi2=Math.floor(xmult*(upperX-xmin)),yi2=Math.floor(ymult*(upperY-ymin)),j=xi1;xi2>=j;j++)for(var k=yi1;yi2>=k;k++){var xi=j,yi=k,idx=xi*(ny-1)+yi;idx>=0&&Nbins>idx&&bins[idx].push(bi)}for(var i=0;i!==Nbins;i++)for(var bin=bins[i],j=0,NbodiesInBin=bin.length;j!==NbodiesInBin;j++)for(var bi=bin[j],k=0;k!==j;k++){var bj=bin[k];Broadphase.canCollide(bi,bj)&&this.boundingVolumeCheck(bi,bj)&&result.push(bi,bj)}return result}}).call(this,_dereq_("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/collision/GridBroadphase.js","/collision")},{"../collision/Broadphase":12,"../math/vec2":33,"../shapes/Circle":40,"../shapes/Particle":44,"../shapes/Plane":45,"../utils/Utils":52,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],14:[function(_dereq_,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){function NaiveBroadphase(){Broadphase.call(this,Broadphase.NAIVE)}var Broadphase=(_dereq_("../shapes/Circle"),_dereq_("../shapes/Plane"),_dereq_("../shapes/Shape"),_dereq_("../shapes/Particle"),_dereq_("../collision/Broadphase"));_dereq_("../math/vec2");module.exports=NaiveBroadphase,NaiveBroadphase.prototype=new Broadphase,NaiveBroadphase.prototype.getCollisionPairs=function(world){var bodies=world.bodies,result=this.result;result.length=0;for(var i=0,Ncolliding=bodies.length;i!==Ncolliding;i++)for(var bi=bodies[i],j=0;i>j;j++){var bj=bodies[j];Broadphase.canCollide(bi,bj)&&this.boundingVolumeCheck(bi,bj)&&result.push(bi,bj)}return result}}).call(this,_dereq_("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/collision/NaiveBroadphase.js","/collision")},{"../collision/Broadphase":12,"../math/vec2":33,"../shapes/Circle":40,"../shapes/Particle":44,"../shapes/Plane":45,"../shapes/Shape":47,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],15:[function(_dereq_,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){function Narrowphase(){this.contactEquations=[],this.frictionEquations=[],this.enableFriction=!0,this.slipForce=10,this.frictionCoefficient=.3,this.surfaceVelocity=0,this.reuseObjects=!0,this.reusableContactEquations=[],this.reusableFrictionEquations=[],this.restitution=0,this.stiffness=Equation.DEFAULT_STIFFNESS,this.relaxation=Equation.DEFAULT_RELAXATION,this.frictionStiffness=Equation.DEFAULT_STIFFNESS,this.frictionRelaxation=Equation.DEFAULT_RELAXATION,this.enableFrictionReduction=!0,this.collidingBodiesLastStep=new TupleDictionary,this.contactSkinSize=.01}function setConvexToCapsuleShapeMiddle(convexShape,capsuleShape){vec2.set(convexShape.vertices[0],.5*-capsuleShape.length,-capsuleShape.radius),vec2.set(convexShape.vertices[1],.5*capsuleShape.length,-capsuleShape.radius),vec2.set(convexShape.vertices[2],.5*capsuleShape.length,capsuleShape.radius),vec2.set(convexShape.vertices[3],.5*-capsuleShape.length,capsuleShape.radius)}function pointInConvex(worldPoint,convexShape,convexOffset,convexAngle){for(var worldVertex0=pic_worldVertex0,worldVertex1=pic_worldVertex1,r0=pic_r0,r1=pic_r1,point=worldPoint,verts=convexShape.vertices,lastCross=null,i=0;i!==verts.length+1;i++){var v0=verts[i%verts.length],v1=verts[(i+1)%verts.length];vec2.rotate(worldVertex0,v0,convexAngle),vec2.rotate(worldVertex1,v1,convexAngle),add(worldVertex0,worldVertex0,convexOffset),add(worldVertex1,worldVertex1,convexOffset),sub(r0,worldVertex0,point),sub(r1,worldVertex1,point);var cross=vec2.crossLength(r0,r1);if(null===lastCross&&(lastCross=cross),0>=cross*lastCross)return!1;lastCross=cross}return!0}var vec2=_dereq_("../math/vec2"),sub=vec2.sub,add=vec2.add,dot=vec2.dot,Utils=_dereq_("../utils/Utils"),TupleDictionary=_dereq_("../utils/TupleDictionary"),Equation=_dereq_("../equations/Equation"),ContactEquation=_dereq_("../equations/ContactEquation"),FrictionEquation=_dereq_("../equations/FrictionEquation"),Circle=_dereq_("../shapes/Circle"),Convex=_dereq_("../shapes/Convex"),Shape=_dereq_("../shapes/Shape"),Rectangle=(_dereq_("../objects/Body"),_dereq_("../shapes/Rectangle"));module.exports=Narrowphase;var yAxis=vec2.fromValues(0,1),tmp1=vec2.fromValues(0,0),tmp2=vec2.fromValues(0,0),tmp3=vec2.fromValues(0,0),tmp4=vec2.fromValues(0,0),tmp5=vec2.fromValues(0,0),tmp6=vec2.fromValues(0,0),tmp7=vec2.fromValues(0,0),tmp8=vec2.fromValues(0,0),tmp9=vec2.fromValues(0,0),tmp10=vec2.fromValues(0,0),tmp11=vec2.fromValues(0,0),tmp12=vec2.fromValues(0,0),tmp13=vec2.fromValues(0,0),tmp14=vec2.fromValues(0,0),tmp15=vec2.fromValues(0,0),tmp16=vec2.fromValues(0,0),tmp17=vec2.fromValues(0,0),tmp18=vec2.fromValues(0,0),tmpArray=[];Narrowphase.prototype.collidedLastStep=function(bodyA,bodyB){var id1=0|bodyA.id,id2=0|bodyB.id;return!!this.collidingBodiesLastStep.get(id1,id2)},Narrowphase.prototype.reset=function(){this.collidingBodiesLastStep.reset();for(var eqs=this.contactEquations,l=eqs.length;l--;){var eq=eqs[l],id1=eq.bodyA.id,id2=eq.bodyB.id;this.collidingBodiesLastStep.set(id1,id2,!0)}if(this.reuseObjects){var ce=this.contactEquations,fe=this.frictionEquations,rfe=this.reusableFrictionEquations,rce=this.reusableContactEquations;Utils.appendArray(rce,ce),Utils.appendArray(rfe,fe)}this.contactEquations.length=this.frictionEquations.length=0},Narrowphase.prototype.createContactEquation=function(bodyA,bodyB,shapeA,shapeB){var c=this.reusableContactEquations.length?this.reusableContactEquations.pop():new ContactEquation(bodyA,bodyB);return c.bodyA=bodyA,c.bodyB=bodyB,c.shapeA=shapeA,c.shapeB=shapeB,c.restitution=this.restitution,c.firstImpact=!this.collidedLastStep(bodyA,bodyB),c.stiffness=this.stiffness,c.relaxation=this.relaxation,c.needsUpdate=!0,c.enabled=!0,c.offset=this.contactSkinSize,c},Narrowphase.prototype.createFrictionEquation=function(bodyA,bodyB,shapeA,shapeB){var c=this.reusableFrictionEquations.length?this.reusableFrictionEquations.pop():new FrictionEquation(bodyA,bodyB);return c.bodyA=bodyA,c.bodyB=bodyB,c.shapeA=shapeA,c.shapeB=shapeB,c.setSlipForce(this.slipForce),c.frictionCoefficient=this.frictionCoefficient,c.relativeVelocity=this.surfaceVelocity,c.enabled=!0,c.needsUpdate=!0,c.stiffness=this.frictionStiffness,c.relaxation=this.frictionRelaxation,c.contactEquations.length=0,c},Narrowphase.prototype.createFrictionFromContact=function(c){var eq=this.createFrictionEquation(c.bodyA,c.bodyB,c.shapeA,c.shapeB);return vec2.copy(eq.contactPointA,c.contactPointA),vec2.copy(eq.contactPointB,c.contactPointB),vec2.rotate90cw(eq.t,c.normalA),eq.contactEquations.push(c),eq},Narrowphase.prototype.createFrictionFromAverage=function(numContacts){if(!numContacts)throw new Error("numContacts == 0!");var c=this.contactEquations[this.contactEquations.length-1],eq=this.createFrictionEquation(c.bodyA,c.bodyB,c.shapeA,c.shapeB),bodyA=c.bodyA;c.bodyB;vec2.set(eq.contactPointA,0,0),vec2.set(eq.contactPointB,0,0),vec2.set(eq.t,0,0);for(var i=0;i!==numContacts;i++)c=this.contactEquations[this.contactEquations.length-1-i],c.bodyA===bodyA?(vec2.add(eq.t,eq.t,c.normalA),vec2.add(eq.contactPointA,eq.contactPointA,c.contactPointA),vec2.add(eq.contactPointB,eq.contactPointB,c.contactPointB)):(vec2.sub(eq.t,eq.t,c.normalA),vec2.add(eq.contactPointA,eq.contactPointA,c.contactPointB),vec2.add(eq.contactPointB,eq.contactPointB,c.contactPointA)),eq.contactEquations.push(c);var invNumContacts=1/numContacts;return vec2.scale(eq.contactPointA,eq.contactPointA,invNumContacts),vec2.scale(eq.contactPointB,eq.contactPointB,invNumContacts),vec2.normalize(eq.t,eq.t),vec2.rotate90cw(eq.t,eq.t),eq},Narrowphase.prototype[Shape.LINE|Shape.CONVEX]=Narrowphase.prototype.convexLine=function(convexBody,convexShape,convexOffset,convexAngle,lineBody,lineShape,lineOffset,lineAngle,justTest){return justTest?!1:0},Narrowphase.prototype[Shape.LINE|Shape.RECTANGLE]=Narrowphase.prototype.lineRectangle=function(lineBody,lineShape,lineOffset,lineAngle,rectangleBody,rectangleShape,rectangleOffset,rectangleAngle,justTest){return justTest?!1:0};var convexCapsule_tempRect=new Rectangle(1,1),convexCapsule_tempVec=vec2.create();Narrowphase.prototype[Shape.CAPSULE|Shape.CONVEX]=Narrowphase.prototype[Shape.CAPSULE|Shape.RECTANGLE]=Narrowphase.prototype.convexCapsule=function(convexBody,convexShape,convexPosition,convexAngle,capsuleBody,capsuleShape,capsulePosition,capsuleAngle,justTest){var circlePos=convexCapsule_tempVec;vec2.set(circlePos,capsuleShape.length/2,0),vec2.rotate(circlePos,circlePos,capsuleAngle),vec2.add(circlePos,circlePos,capsulePosition);var result1=this.circleConvex(capsuleBody,capsuleShape,circlePos,capsuleAngle,convexBody,convexShape,convexPosition,convexAngle,justTest,capsuleShape.radius);vec2.set(circlePos,-capsuleShape.length/2,0),vec2.rotate(circlePos,circlePos,capsuleAngle),vec2.add(circlePos,circlePos,capsulePosition);var result2=this.circleConvex(capsuleBody,capsuleShape,circlePos,capsuleAngle,convexBody,convexShape,convexPosition,convexAngle,justTest,capsuleShape.radius);if(justTest&&(result1||result2))return!0;var r=convexCapsule_tempRect;setConvexToCapsuleShapeMiddle(r,capsuleShape);var result=this.convexConvex(convexBody,convexShape,convexPosition,convexAngle,capsuleBody,r,capsulePosition,capsuleAngle,justTest);return result+result1+result2},Narrowphase.prototype[Shape.CAPSULE|Shape.LINE]=Narrowphase.prototype.lineCapsule=function(lineBody,lineShape,linePosition,lineAngle,capsuleBody,capsuleShape,capsulePosition,capsuleAngle,justTest){return justTest?!1:0};var capsuleCapsule_tempVec1=vec2.create(),capsuleCapsule_tempVec2=vec2.create(),capsuleCapsule_tempRect1=new Rectangle(1,1);Narrowphase.prototype[Shape.CAPSULE|Shape.CAPSULE]=Narrowphase.prototype.capsuleCapsule=function(bi,si,xi,ai,bj,sj,xj,aj,justTest){for(var enableFrictionBefore,circlePosi=capsuleCapsule_tempVec1,circlePosj=capsuleCapsule_tempVec2,numContacts=0,i=0;2>i;i++){vec2.set(circlePosi,(0===i?-1:1)*si.length/2,0),vec2.rotate(circlePosi,circlePosi,ai),vec2.add(circlePosi,circlePosi,xi);for(var j=0;2>j;j++){vec2.set(circlePosj,(0===j?-1:1)*sj.length/2,0),vec2.rotate(circlePosj,circlePosj,aj),vec2.add(circlePosj,circlePosj,xj),this.enableFrictionReduction&&(enableFrictionBefore=this.enableFriction,this.enableFriction=!1);var result=this.circleCircle(bi,si,circlePosi,ai,bj,sj,circlePosj,aj,justTest,si.radius,sj.radius);if(this.enableFrictionReduction&&(this.enableFriction=enableFrictionBefore),justTest&&result)return!0;numContacts+=result}}this.enableFrictionReduction&&(enableFrictionBefore=this.enableFriction,this.enableFriction=!1);var rect=capsuleCapsule_tempRect1;setConvexToCapsuleShapeMiddle(rect,si);var result1=this.convexCapsule(bi,rect,xi,ai,bj,sj,xj,aj,justTest);if(this.enableFrictionReduction&&(this.enableFriction=enableFrictionBefore),justTest&&result1)return!0;if(numContacts+=result1,this.enableFrictionReduction){var enableFrictionBefore=this.enableFriction;this.enableFriction=!1}setConvexToCapsuleShapeMiddle(rect,sj);var result2=this.convexCapsule(bj,rect,xj,aj,bi,si,xi,ai,justTest);return this.enableFrictionReduction&&(this.enableFriction=enableFrictionBefore),justTest&&result2?!0:(numContacts+=result2,this.enableFrictionReduction&&numContacts&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(numContacts)),numContacts)},Narrowphase.prototype[Shape.LINE|Shape.LINE]=Narrowphase.prototype.lineLine=function(bodyA,shapeA,positionA,angleA,bodyB,shapeB,positionB,angleB,justTest){return justTest?!1:0},Narrowphase.prototype[Shape.PLANE|Shape.LINE]=Narrowphase.prototype.planeLine=function(planeBody,planeShape,planeOffset,planeAngle,lineBody,lineShape,lineOffset,lineAngle,justTest){var worldVertex0=tmp1,worldVertex1=tmp2,worldVertex01=tmp3,worldVertex11=tmp4,worldEdge=tmp5,worldEdgeUnit=tmp6,dist=tmp7,worldNormal=tmp8,worldTangent=tmp9,verts=tmpArray,numContacts=0;vec2.set(worldVertex0,-lineShape.length/2,0),vec2.set(worldVertex1,lineShape.length/2,0),vec2.rotate(worldVertex01,worldVertex0,lineAngle),vec2.rotate(worldVertex11,worldVertex1,lineAngle),add(worldVertex01,worldVertex01,lineOffset),add(worldVertex11,worldVertex11,lineOffset),vec2.copy(worldVertex0,worldVertex01),vec2.copy(worldVertex1,worldVertex11),sub(worldEdge,worldVertex1,worldVertex0),vec2.normalize(worldEdgeUnit,worldEdge),vec2.rotate90cw(worldTangent,worldEdgeUnit),vec2.rotate(worldNormal,yAxis,planeAngle),verts[0]=worldVertex0,verts[1]=worldVertex1;for(var i=0;i<verts.length;i++){var v=verts[i];sub(dist,v,planeOffset);var d=dot(dist,worldNormal);if(0>d){if(justTest)return!0;var c=this.createContactEquation(planeBody,lineBody,planeShape,lineShape);numContacts++,vec2.copy(c.normalA,worldNormal),vec2.normalize(c.normalA,c.normalA),vec2.scale(dist,worldNormal,d),sub(c.contactPointA,v,dist),sub(c.contactPointA,c.contactPointA,planeBody.position),sub(c.contactPointB,v,lineOffset),add(c.contactPointB,c.contactPointB,lineOffset),sub(c.contactPointB,c.contactPointB,lineBody.position),this.contactEquations.push(c),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(c))}}return justTest?!1:(this.enableFrictionReduction||numContacts&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(numContacts)),numContacts)},Narrowphase.prototype[Shape.PARTICLE|Shape.CAPSULE]=Narrowphase.prototype.particleCapsule=function(particleBody,particleShape,particlePosition,particleAngle,capsuleBody,capsuleShape,capsulePosition,capsuleAngle,justTest){return this.circleLine(particleBody,particleShape,particlePosition,particleAngle,capsuleBody,capsuleShape,capsulePosition,capsuleAngle,justTest,capsuleShape.radius,0)},Narrowphase.prototype[Shape.CIRCLE|Shape.LINE]=Narrowphase.prototype.circleLine=function(circleBody,circleShape,circleOffset,circleAngle,lineBody,lineShape,lineOffset,lineAngle,justTest,lineRadius,circleRadius){var lineRadius=lineRadius||0,circleRadius="undefined"!=typeof circleRadius?circleRadius:circleShape.radius,orthoDist=tmp1,lineToCircleOrthoUnit=tmp2,projectedPoint=tmp3,centerDist=tmp4,worldTangent=tmp5,worldEdge=tmp6,worldEdgeUnit=tmp7,worldVertex0=tmp8,worldVertex1=tmp9,worldVertex01=tmp10,worldVertex11=tmp11,dist=tmp12,lineToCircle=tmp13,lineEndToLineRadius=tmp14,verts=tmpArray;vec2.set(worldVertex0,-lineShape.length/2,0),vec2.set(worldVertex1,lineShape.length/2,0),vec2.rotate(worldVertex01,worldVertex0,lineAngle),vec2.rotate(worldVertex11,worldVertex1,lineAngle),add(worldVertex01,worldVertex01,lineOffset),add(worldVertex11,worldVertex11,lineOffset),vec2.copy(worldVertex0,worldVertex01),vec2.copy(worldVertex1,worldVertex11),sub(worldEdge,worldVertex1,worldVertex0),vec2.normalize(worldEdgeUnit,worldEdge),vec2.rotate90cw(worldTangent,worldEdgeUnit),sub(dist,circleOffset,worldVertex0);var d=dot(dist,worldTangent);sub(centerDist,worldVertex0,lineOffset),sub(lineToCircle,circleOffset,lineOffset);var radiusSum=circleRadius+lineRadius;if(Math.abs(d)<radiusSum){vec2.scale(orthoDist,worldTangent,d),sub(projectedPoint,circleOffset,orthoDist),vec2.scale(lineToCircleOrthoUnit,worldTangent,dot(worldTangent,lineToCircle)),vec2.normalize(lineToCircleOrthoUnit,lineToCircleOrthoUnit),vec2.scale(lineToCircleOrthoUnit,lineToCircleOrthoUnit,lineRadius),add(projectedPoint,projectedPoint,lineToCircleOrthoUnit);var pos=dot(worldEdgeUnit,projectedPoint),pos0=dot(worldEdgeUnit,worldVertex0),pos1=dot(worldEdgeUnit,worldVertex1);if(pos>pos0&&pos1>pos){if(justTest)return!0;var c=this.createContactEquation(circleBody,lineBody,circleShape,lineShape);return vec2.scale(c.normalA,orthoDist,-1),vec2.normalize(c.normalA,c.normalA),vec2.scale(c.contactPointA,c.normalA,circleRadius),add(c.contactPointA,c.contactPointA,circleOffset),sub(c.contactPointA,c.contactPointA,circleBody.position),sub(c.contactPointB,projectedPoint,lineOffset),add(c.contactPointB,c.contactPointB,lineOffset),sub(c.contactPointB,c.contactPointB,lineBody.position),this.contactEquations.push(c),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(c)),1}}verts[0]=worldVertex0,verts[1]=worldVertex1;for(var i=0;i<verts.length;i++){var v=verts[i];if(sub(dist,v,circleOffset),vec2.squaredLength(dist)<Math.pow(radiusSum,2)){if(justTest)return!0;var c=this.createContactEquation(circleBody,lineBody,circleShape,lineShape);return vec2.copy(c.normalA,dist),vec2.normalize(c.normalA,c.normalA),vec2.scale(c.contactPointA,c.normalA,circleRadius),add(c.contactPointA,c.contactPointA,circleOffset),sub(c.contactPointA,c.contactPointA,circleBody.position),sub(c.contactPointB,v,lineOffset),vec2.scale(lineEndToLineRadius,c.normalA,-lineRadius),add(c.contactPointB,c.contactPointB,lineEndToLineRadius),add(c.contactPointB,c.contactPointB,lineOffset),sub(c.contactPointB,c.contactPointB,lineBody.position),this.contactEquations.push(c),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(c)),1}}return 0},Narrowphase.prototype[Shape.CIRCLE|Shape.CAPSULE]=Narrowphase.prototype.circleCapsule=function(bi,si,xi,ai,bj,sj,xj,aj,justTest){return this.circleLine(bi,si,xi,ai,bj,sj,xj,aj,justTest,sj.radius)},Narrowphase.prototype[Shape.CIRCLE|Shape.CONVEX]=Narrowphase.prototype[Shape.CIRCLE|Shape.RECTANGLE]=Narrowphase.prototype.circleConvex=function(circleBody,circleShape,circleOffset,circleAngle,convexBody,convexShape,convexOffset,convexAngle,justTest,circleRadius){for(var circleRadius="number"==typeof circleRadius?circleRadius:circleShape.radius,worldVertex0=tmp1,worldVertex1=tmp2,worldEdge=tmp3,worldEdgeUnit=tmp4,worldNormal=tmp5,dist=tmp10,worldVertex=tmp11,closestEdgeProjectedPoint=tmp13,candidate=tmp14,candidateDist=tmp15,minCandidate=tmp16,found=!1,minCandidateDistance=Number.MAX_VALUE,verts=convexShape.vertices,i=0;i!==verts.length+1;i++){var v0=verts[i%verts.length],v1=verts[(i+1)%verts.length];if(vec2.rotate(worldVertex0,v0,convexAngle),vec2.rotate(worldVertex1,v1,convexAngle),add(worldVertex0,worldVertex0,convexOffset),add(worldVertex1,worldVertex1,convexOffset),sub(worldEdge,worldVertex1,worldVertex0),vec2.normalize(worldEdgeUnit,worldEdge),vec2.rotate90cw(worldNormal,worldEdgeUnit),vec2.scale(candidate,worldNormal,-circleShape.radius),add(candidate,candidate,circleOffset),pointInConvex(candidate,convexShape,convexOffset,convexAngle)){vec2.sub(candidateDist,worldVertex0,candidate);var candidateDistance=Math.abs(vec2.dot(candidateDist,worldNormal));minCandidateDistance>candidateDistance&&(vec2.copy(minCandidate,candidate),minCandidateDistance=candidateDistance,vec2.scale(closestEdgeProjectedPoint,worldNormal,candidateDistance),vec2.add(closestEdgeProjectedPoint,closestEdgeProjectedPoint,candidate),found=!0)}}if(found){if(justTest)return!0;var c=this.createContactEquation(circleBody,convexBody,circleShape,convexShape);return vec2.sub(c.normalA,minCandidate,circleOffset),vec2.normalize(c.normalA,c.normalA),vec2.scale(c.contactPointA,c.normalA,circleRadius),add(c.contactPointA,c.contactPointA,circleOffset),sub(c.contactPointA,c.contactPointA,circleBody.position),sub(c.contactPointB,closestEdgeProjectedPoint,convexOffset),add(c.contactPointB,c.contactPointB,convexOffset),sub(c.contactPointB,c.contactPointB,convexBody.position),this.contactEquations.push(c),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(c)),1}if(circleRadius>0)for(var i=0;i<verts.length;i++){var localVertex=verts[i];if(vec2.rotate(worldVertex,localVertex,convexAngle),add(worldVertex,worldVertex,convexOffset),sub(dist,worldVertex,circleOffset),vec2.squaredLength(dist)<Math.pow(circleRadius,2)){if(justTest)return!0;var c=this.createContactEquation(circleBody,convexBody,circleShape,convexShape);return vec2.copy(c.normalA,dist),vec2.normalize(c.normalA,c.normalA),vec2.scale(c.contactPointA,c.normalA,circleRadius),add(c.contactPointA,c.contactPointA,circleOffset),sub(c.contactPointA,c.contactPointA,circleBody.position),sub(c.contactPointB,worldVertex,convexOffset),add(c.contactPointB,c.contactPointB,convexOffset),sub(c.contactPointB,c.contactPointB,convexBody.position),this.contactEquations.push(c),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(c)),1}}return 0};var pic_worldVertex0=vec2.create(),pic_worldVertex1=vec2.create(),pic_r0=vec2.create(),pic_r1=vec2.create();Narrowphase.prototype[Shape.PARTICLE|Shape.CONVEX]=Narrowphase.prototype[Shape.PARTICLE|Shape.RECTANGLE]=Narrowphase.prototype.particleConvex=function(particleBody,particleShape,particleOffset,particleAngle,convexBody,convexShape,convexOffset,convexAngle,justTest){var worldVertex0=tmp1,worldVertex1=tmp2,worldEdge=tmp3,worldEdgeUnit=tmp4,worldTangent=tmp5,centerDist=tmp6,convexToparticle=tmp7,dist=tmp10,closestEdgeProjectedPoint=tmp13,candidateDist=tmp17,minEdgeNormal=tmp18,minCandidateDistance=Number.MAX_VALUE,found=!1,verts=convexShape.vertices;
if(!pointInConvex(particleOffset,convexShape,convexOffset,convexAngle))return 0;if(justTest)return!0;for(var i=0;i!==verts.length+1;i++){var v0=verts[i%verts.length],v1=verts[(i+1)%verts.length];vec2.rotate(worldVertex0,v0,convexAngle),vec2.rotate(worldVertex1,v1,convexAngle),add(worldVertex0,worldVertex0,convexOffset),add(worldVertex1,worldVertex1,convexOffset),sub(worldEdge,worldVertex1,worldVertex0),vec2.normalize(worldEdgeUnit,worldEdge),vec2.rotate90cw(worldTangent,worldEdgeUnit),sub(dist,particleOffset,worldVertex0);dot(dist,worldTangent);sub(centerDist,worldVertex0,convexOffset),sub(convexToparticle,particleOffset,convexOffset),vec2.sub(candidateDist,worldVertex0,particleOffset);var candidateDistance=Math.abs(vec2.dot(candidateDist,worldTangent));minCandidateDistance>candidateDistance&&(minCandidateDistance=candidateDistance,vec2.scale(closestEdgeProjectedPoint,worldTangent,candidateDistance),vec2.add(closestEdgeProjectedPoint,closestEdgeProjectedPoint,particleOffset),vec2.copy(minEdgeNormal,worldTangent),found=!0)}if(found){var c=this.createContactEquation(particleBody,convexBody,particleShape,convexShape);return vec2.scale(c.normalA,minEdgeNormal,-1),vec2.normalize(c.normalA,c.normalA),vec2.set(c.contactPointA,0,0),add(c.contactPointA,c.contactPointA,particleOffset),sub(c.contactPointA,c.contactPointA,particleBody.position),sub(c.contactPointB,closestEdgeProjectedPoint,convexOffset),add(c.contactPointB,c.contactPointB,convexOffset),sub(c.contactPointB,c.contactPointB,convexBody.position),this.contactEquations.push(c),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(c)),1}return 0},Narrowphase.prototype[Shape.CIRCLE]=Narrowphase.prototype.circleCircle=function(bodyA,shapeA,offsetA,angleA,bodyB,shapeB,offsetB,angleB,justTest,radiusA,radiusB){var dist=tmp1,radiusA=radiusA||shapeA.radius,radiusB=radiusB||shapeB.radius;sub(dist,offsetA,offsetB);var r=radiusA+radiusB;if(vec2.squaredLength(dist)>Math.pow(r,2))return 0;if(justTest)return!0;var c=this.createContactEquation(bodyA,bodyB,shapeA,shapeB);return sub(c.normalA,offsetB,offsetA),vec2.normalize(c.normalA,c.normalA),vec2.scale(c.contactPointA,c.normalA,radiusA),vec2.scale(c.contactPointB,c.normalA,-radiusB),add(c.contactPointA,c.contactPointA,offsetA),sub(c.contactPointA,c.contactPointA,bodyA.position),add(c.contactPointB,c.contactPointB,offsetB),sub(c.contactPointB,c.contactPointB,bodyB.position),this.contactEquations.push(c),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(c)),1},Narrowphase.prototype[Shape.PLANE|Shape.CONVEX]=Narrowphase.prototype[Shape.PLANE|Shape.RECTANGLE]=Narrowphase.prototype.planeConvex=function(planeBody,planeShape,planeOffset,planeAngle,convexBody,convexShape,convexOffset,convexAngle,justTest){var worldVertex=tmp1,worldNormal=tmp2,dist=tmp3,numReported=0;vec2.rotate(worldNormal,yAxis,planeAngle);for(var i=0;i!==convexShape.vertices.length;i++){var v=convexShape.vertices[i];if(vec2.rotate(worldVertex,v,convexAngle),add(worldVertex,worldVertex,convexOffset),sub(dist,worldVertex,planeOffset),dot(dist,worldNormal)<=0){if(justTest)return!0;numReported++;var c=this.createContactEquation(planeBody,convexBody,planeShape,convexShape);sub(dist,worldVertex,planeOffset),vec2.copy(c.normalA,worldNormal);var d=dot(dist,c.normalA);vec2.scale(dist,c.normalA,d),sub(c.contactPointB,worldVertex,convexBody.position),sub(c.contactPointA,worldVertex,dist),sub(c.contactPointA,c.contactPointA,planeBody.position),this.contactEquations.push(c),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(c))}}return this.enableFrictionReduction&&this.enableFriction&&numReported&&this.frictionEquations.push(this.createFrictionFromAverage(numReported)),numReported},Narrowphase.prototype[Shape.PARTICLE|Shape.PLANE]=Narrowphase.prototype.particlePlane=function(particleBody,particleShape,particleOffset,particleAngle,planeBody,planeShape,planeOffset,planeAngle,justTest){var dist=tmp1,worldNormal=tmp2;planeAngle=planeAngle||0,sub(dist,particleOffset,planeOffset),vec2.rotate(worldNormal,yAxis,planeAngle);var d=dot(dist,worldNormal);if(d>0)return 0;if(justTest)return!0;var c=this.createContactEquation(planeBody,particleBody,planeShape,particleShape);return vec2.copy(c.normalA,worldNormal),vec2.scale(dist,c.normalA,d),sub(c.contactPointA,particleOffset,dist),sub(c.contactPointA,c.contactPointA,planeBody.position),sub(c.contactPointB,particleOffset,particleBody.position),this.contactEquations.push(c),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(c)),1},Narrowphase.prototype[Shape.CIRCLE|Shape.PARTICLE]=Narrowphase.prototype.circleParticle=function(circleBody,circleShape,circleOffset,circleAngle,particleBody,particleShape,particleOffset,particleAngle,justTest){var dist=tmp1;if(sub(dist,particleOffset,circleOffset),vec2.squaredLength(dist)>Math.pow(circleShape.radius,2))return 0;if(justTest)return!0;var c=this.createContactEquation(circleBody,particleBody,circleShape,particleShape);return vec2.copy(c.normalA,dist),vec2.normalize(c.normalA,c.normalA),vec2.scale(c.contactPointA,c.normalA,circleShape.radius),add(c.contactPointA,c.contactPointA,circleOffset),sub(c.contactPointA,c.contactPointA,circleBody.position),sub(c.contactPointB,particleOffset,particleBody.position),this.contactEquations.push(c),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(c)),1};var planeCapsule_tmpCircle=new Circle(1),planeCapsule_tmp1=vec2.create(),planeCapsule_tmp2=vec2.create();vec2.create();Narrowphase.prototype[Shape.PLANE|Shape.CAPSULE]=Narrowphase.prototype.planeCapsule=function(planeBody,planeShape,planeOffset,planeAngle,capsuleBody,capsuleShape,capsuleOffset,capsuleAngle,justTest){var end1=planeCapsule_tmp1,end2=planeCapsule_tmp2,circle=planeCapsule_tmpCircle;vec2.set(end1,-capsuleShape.length/2,0),vec2.rotate(end1,end1,capsuleAngle),add(end1,end1,capsuleOffset),vec2.set(end2,capsuleShape.length/2,0),vec2.rotate(end2,end2,capsuleAngle),add(end2,end2,capsuleOffset),circle.radius=capsuleShape.radius;var enableFrictionBefore;this.enableFrictionReduction&&(enableFrictionBefore=this.enableFriction,this.enableFriction=!1);var numContacts1=this.circlePlane(capsuleBody,circle,end1,0,planeBody,planeShape,planeOffset,planeAngle,justTest),numContacts2=this.circlePlane(capsuleBody,circle,end2,0,planeBody,planeShape,planeOffset,planeAngle,justTest);if(this.enableFrictionReduction&&(this.enableFriction=enableFrictionBefore),justTest)return numContacts1||numContacts2;var numTotal=numContacts1+numContacts2;return this.enableFrictionReduction&&numTotal&&this.frictionEquations.push(this.createFrictionFromAverage(numTotal)),numTotal},Narrowphase.prototype[Shape.CIRCLE|Shape.PLANE]=Narrowphase.prototype.circlePlane=function(bi,si,xi,ai,bj,sj,xj,aj,justTest){var circleBody=bi,circleShape=si,circleOffset=xi,planeBody=bj,planeOffset=xj,planeAngle=aj;planeAngle=planeAngle||0;var planeToCircle=tmp1,worldNormal=tmp2,temp=tmp3;sub(planeToCircle,circleOffset,planeOffset),vec2.rotate(worldNormal,yAxis,planeAngle);var d=dot(worldNormal,planeToCircle);if(d>circleShape.radius)return 0;if(justTest)return!0;var contact=this.createContactEquation(planeBody,circleBody,sj,si);return vec2.copy(contact.normalA,worldNormal),vec2.scale(contact.contactPointB,contact.normalA,-circleShape.radius),add(contact.contactPointB,contact.contactPointB,circleOffset),sub(contact.contactPointB,contact.contactPointB,circleBody.position),vec2.scale(temp,contact.normalA,d),sub(contact.contactPointA,planeToCircle,temp),add(contact.contactPointA,contact.contactPointA,planeOffset),sub(contact.contactPointA,contact.contactPointA,planeBody.position),this.contactEquations.push(contact),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(contact)),1},Narrowphase.prototype[Shape.CONVEX]=Narrowphase.prototype[Shape.CONVEX|Shape.RECTANGLE]=Narrowphase.prototype[Shape.RECTANGLE]=Narrowphase.prototype.convexConvex=function(bi,si,xi,ai,bj,sj,xj,aj,justTest,precision){var sepAxis=tmp1,worldPoint=tmp2,worldPoint0=tmp3,worldPoint1=tmp4,worldEdge=tmp5,penetrationVec=tmp7,dist=tmp8,worldNormal=tmp9,numContacts=0,precision="number"==typeof precision?precision:0,found=Narrowphase.findSeparatingAxis(si,xi,ai,sj,xj,aj,sepAxis);if(!found)return 0;sub(dist,xj,xi),dot(sepAxis,dist)>0&&vec2.scale(sepAxis,sepAxis,-1);var closestEdge1=Narrowphase.getClosestEdge(si,ai,sepAxis,!0),closestEdge2=Narrowphase.getClosestEdge(sj,aj,sepAxis);if(-1===closestEdge1||-1===closestEdge2)return 0;for(var k=0;2>k;k++){var closestEdgeA=closestEdge1,closestEdgeB=closestEdge2,shapeA=si,shapeB=sj,offsetA=xi,offsetB=xj,angleA=ai,angleB=aj,bodyA=bi,bodyB=bj;if(0===k){var tmp;tmp=closestEdgeA,closestEdgeA=closestEdgeB,closestEdgeB=tmp,tmp=shapeA,shapeA=shapeB,shapeB=tmp,tmp=offsetA,offsetA=offsetB,offsetB=tmp,tmp=angleA,angleA=angleB,angleB=tmp,tmp=bodyA,bodyA=bodyB,bodyB=tmp}for(var j=closestEdgeB;closestEdgeB+2>j;j++){var v=shapeB.vertices[(j+shapeB.vertices.length)%shapeB.vertices.length];vec2.rotate(worldPoint,v,angleB),add(worldPoint,worldPoint,offsetB);for(var insideNumEdges=0,i=closestEdgeA-1;closestEdgeA+2>i;i++){var v0=shapeA.vertices[(i+shapeA.vertices.length)%shapeA.vertices.length],v1=shapeA.vertices[(i+1+shapeA.vertices.length)%shapeA.vertices.length];vec2.rotate(worldPoint0,v0,angleA),vec2.rotate(worldPoint1,v1,angleA),add(worldPoint0,worldPoint0,offsetA),add(worldPoint1,worldPoint1,offsetA),sub(worldEdge,worldPoint1,worldPoint0),vec2.rotate90cw(worldNormal,worldEdge),vec2.normalize(worldNormal,worldNormal),sub(dist,worldPoint,worldPoint0);var d=dot(worldNormal,dist);(i===closestEdgeA&&precision>=d||i!==closestEdgeA&&0>=d)&&insideNumEdges++}if(insideNumEdges>=3){if(justTest)return!0;var c=this.createContactEquation(bodyA,bodyB,shapeA,shapeB);numContacts++;var v0=shapeA.vertices[closestEdgeA%shapeA.vertices.length],v1=shapeA.vertices[(closestEdgeA+1)%shapeA.vertices.length];vec2.rotate(worldPoint0,v0,angleA),vec2.rotate(worldPoint1,v1,angleA),add(worldPoint0,worldPoint0,offsetA),add(worldPoint1,worldPoint1,offsetA),sub(worldEdge,worldPoint1,worldPoint0),vec2.rotate90cw(c.normalA,worldEdge),vec2.normalize(c.normalA,c.normalA),sub(dist,worldPoint,worldPoint0);var d=dot(c.normalA,dist);vec2.scale(penetrationVec,c.normalA,d),sub(c.contactPointA,worldPoint,offsetA),sub(c.contactPointA,c.contactPointA,penetrationVec),add(c.contactPointA,c.contactPointA,offsetA),sub(c.contactPointA,c.contactPointA,bodyA.position),sub(c.contactPointB,worldPoint,offsetB),add(c.contactPointB,c.contactPointB,offsetB),sub(c.contactPointB,c.contactPointB,bodyB.position),this.contactEquations.push(c),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(c))}}}return this.enableFrictionReduction&&this.enableFriction&&numContacts&&this.frictionEquations.push(this.createFrictionFromAverage(numContacts)),numContacts};var pcoa_tmp1=vec2.fromValues(0,0);Narrowphase.projectConvexOntoAxis=function(convexShape,convexOffset,convexAngle,worldAxis,result){var v,value,max=null,min=null,localAxis=pcoa_tmp1;vec2.rotate(localAxis,worldAxis,-convexAngle);for(var i=0;i<convexShape.vertices.length;i++)v=convexShape.vertices[i],value=dot(v,localAxis),(null===max||value>max)&&(max=value),(null===min||min>value)&&(min=value);if(min>max){var t=min;min=max,max=t}var offset=dot(convexOffset,worldAxis);vec2.set(result,min+offset,max+offset)};var fsa_tmp1=vec2.fromValues(0,0),fsa_tmp2=vec2.fromValues(0,0),fsa_tmp3=vec2.fromValues(0,0),fsa_tmp4=vec2.fromValues(0,0),fsa_tmp5=vec2.fromValues(0,0),fsa_tmp6=vec2.fromValues(0,0);Narrowphase.findSeparatingAxis=function(c1,offset1,angle1,c2,offset2,angle2,sepAxis){var maxDist=null,overlap=!1,found=!1,edge=fsa_tmp1,worldPoint0=fsa_tmp2,worldPoint1=fsa_tmp3,normal=fsa_tmp4,span1=fsa_tmp5,span2=fsa_tmp6;if(c1 instanceof Rectangle&&c2 instanceof Rectangle)for(var j=0;2!==j;j++){var c=c1,angle=angle1;1===j&&(c=c2,angle=angle2);for(var i=0;2!==i;i++){0===i?vec2.set(normal,0,1):1===i&&vec2.set(normal,1,0),0!==angle&&vec2.rotate(normal,normal,angle),Narrowphase.projectConvexOntoAxis(c1,offset1,angle1,normal,span1),Narrowphase.projectConvexOntoAxis(c2,offset2,angle2,normal,span2);var a=span1,b=span2,swapped=!1;span1[0]>span2[0]&&(b=span1,a=span2,swapped=!0);var dist=b[0]-a[1];overlap=0>=dist,(null===maxDist||dist>maxDist)&&(vec2.copy(sepAxis,normal),maxDist=dist,found=overlap)}}else for(var j=0;2!==j;j++){var c=c1,angle=angle1;1===j&&(c=c2,angle=angle2);for(var i=0;i!==c.vertices.length;i++){vec2.rotate(worldPoint0,c.vertices[i],angle),vec2.rotate(worldPoint1,c.vertices[(i+1)%c.vertices.length],angle),sub(edge,worldPoint1,worldPoint0),vec2.rotate90cw(normal,edge),vec2.normalize(normal,normal),Narrowphase.projectConvexOntoAxis(c1,offset1,angle1,normal,span1),Narrowphase.projectConvexOntoAxis(c2,offset2,angle2,normal,span2);var a=span1,b=span2,swapped=!1;span1[0]>span2[0]&&(b=span1,a=span2,swapped=!0);var dist=b[0]-a[1];overlap=0>=dist,(null===maxDist||dist>maxDist)&&(vec2.copy(sepAxis,normal),maxDist=dist,found=overlap)}}return found};var gce_tmp1=vec2.fromValues(0,0),gce_tmp2=vec2.fromValues(0,0),gce_tmp3=vec2.fromValues(0,0);Narrowphase.getClosestEdge=function(c,angle,axis,flip){var localAxis=gce_tmp1,edge=gce_tmp2,normal=gce_tmp3;vec2.rotate(localAxis,axis,-angle),flip&&vec2.scale(localAxis,localAxis,-1);for(var closestEdge=-1,N=c.vertices.length,maxDot=-1,i=0;i!==N;i++){sub(edge,c.vertices[(i+1)%N],c.vertices[i%N]),vec2.rotate90cw(normal,edge),vec2.normalize(normal,normal);var d=dot(normal,localAxis);(-1===closestEdge||d>maxDot)&&(closestEdge=i%N,maxDot=d)}return closestEdge};var circleHeightfield_candidate=vec2.create(),circleHeightfield_dist=vec2.create(),circleHeightfield_v0=vec2.create(),circleHeightfield_v1=vec2.create(),circleHeightfield_minCandidate=vec2.create(),circleHeightfield_worldNormal=vec2.create(),circleHeightfield_minCandidateNormal=vec2.create();Narrowphase.prototype[Shape.CIRCLE|Shape.HEIGHTFIELD]=Narrowphase.prototype.circleHeightfield=function(circleBody,circleShape,circlePos,circleAngle,hfBody,hfShape,hfPos,hfAngle,justTest,radius){var data=hfShape.data,radius=radius||circleShape.radius,w=hfShape.elementWidth,dist=circleHeightfield_dist,candidate=circleHeightfield_candidate,minCandidate=circleHeightfield_minCandidate,minCandidateNormal=circleHeightfield_minCandidateNormal,worldNormal=circleHeightfield_worldNormal,v0=circleHeightfield_v0,v1=circleHeightfield_v1,idxA=Math.floor((circlePos[0]-radius-hfPos[0])/w),idxB=Math.ceil((circlePos[0]+radius-hfPos[0])/w);0>idxA&&(idxA=0),idxB>=data.length&&(idxB=data.length-1);for(var max=data[idxA],min=data[idxB],i=idxA;idxB>i;i++)data[i]<min&&(min=data[i]),data[i]>max&&(max=data[i]);if(circlePos[1]-radius>max)return justTest?!1:0;circlePos[1]+radius<min;for(var found=!1,i=idxA;idxB>i;i++){vec2.set(v0,i*w,data[i]),vec2.set(v1,(i+1)*w,data[i+1]),vec2.add(v0,v0,hfPos),vec2.add(v1,v1,hfPos),vec2.sub(worldNormal,v1,v0),vec2.rotate(worldNormal,worldNormal,Math.PI/2),vec2.normalize(worldNormal,worldNormal),vec2.scale(candidate,worldNormal,-radius),vec2.add(candidate,candidate,circlePos),vec2.sub(dist,candidate,v0);var d=vec2.dot(dist,worldNormal);if(candidate[0]>=v0[0]&&candidate[0]<v1[0]&&0>=d){if(justTest)return!0;found=!0,vec2.scale(dist,worldNormal,-d),vec2.add(minCandidate,candidate,dist),vec2.copy(minCandidateNormal,worldNormal);var c=this.createContactEquation(hfBody,circleBody,hfShape,circleShape);vec2.copy(c.normalA,minCandidateNormal),vec2.scale(c.contactPointB,c.normalA,-radius),add(c.contactPointB,c.contactPointB,circlePos),sub(c.contactPointB,c.contactPointB,circleBody.position),vec2.copy(c.contactPointA,minCandidate),vec2.sub(c.contactPointA,c.contactPointA,hfBody.position),this.contactEquations.push(c),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(c))}}if(found=!1,radius>0)for(var i=idxA;idxB>=i;i++)if(vec2.set(v0,i*w,data[i]),vec2.add(v0,v0,hfPos),vec2.sub(dist,circlePos,v0),vec2.squaredLength(dist)<Math.pow(radius,2)){if(justTest)return!0;found=!0;var c=this.createContactEquation(hfBody,circleBody,hfShape,circleShape);vec2.copy(c.normalA,dist),vec2.normalize(c.normalA,c.normalA),vec2.scale(c.contactPointB,c.normalA,-radius),add(c.contactPointB,c.contactPointB,circlePos),sub(c.contactPointB,c.contactPointB,circleBody.position),sub(c.contactPointA,v0,hfPos),add(c.contactPointA,c.contactPointA,hfPos),sub(c.contactPointA,c.contactPointA,hfBody.position),this.contactEquations.push(c),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(c))}return found?1:0};var convexHeightfield_v0=vec2.create(),convexHeightfield_v1=vec2.create(),convexHeightfield_tilePos=vec2.create(),convexHeightfield_tempConvexShape=new Convex([vec2.create(),vec2.create(),vec2.create(),vec2.create()]);Narrowphase.prototype[Shape.RECTANGLE|Shape.HEIGHTFIELD]=Narrowphase.prototype[Shape.CONVEX|Shape.HEIGHTFIELD]=Narrowphase.prototype.convexHeightfield=function(convexBody,convexShape,convexPos,convexAngle,hfBody,hfShape,hfPos,hfAngle,justTest){var data=hfShape.data,w=hfShape.elementWidth,v0=convexHeightfield_v0,v1=convexHeightfield_v1,tilePos=convexHeightfield_tilePos,tileConvex=convexHeightfield_tempConvexShape,idxA=Math.floor((convexBody.aabb.lowerBound[0]-hfPos[0])/w),idxB=Math.ceil((convexBody.aabb.upperBound[0]-hfPos[0])/w);0>idxA&&(idxA=0),idxB>=data.length&&(idxB=data.length-1);for(var max=data[idxA],min=data[idxB],i=idxA;idxB>i;i++)data[i]<min&&(min=data[i]),data[i]>max&&(max=data[i]);if(convexBody.aabb.lowerBound[1]>max)return justTest?!1:0;for(var numContacts=0,i=idxA;idxB>i;i++){vec2.set(v0,i*w,data[i]),vec2.set(v1,(i+1)*w,data[i+1]),vec2.add(v0,v0,hfPos),vec2.add(v1,v1,hfPos);var tileHeight=100;vec2.set(tilePos,.5*(v1[0]+v0[0]),.5*(v1[1]+v0[1]-tileHeight)),vec2.sub(tileConvex.vertices[0],v1,tilePos),vec2.sub(tileConvex.vertices[1],v0,tilePos),vec2.copy(tileConvex.vertices[2],tileConvex.vertices[1]),vec2.copy(tileConvex.vertices[3],tileConvex.vertices[0]),tileConvex.vertices[2][1]-=tileHeight,tileConvex.vertices[3][1]-=tileHeight,numContacts+=this.convexConvex(convexBody,convexShape,convexPos,convexAngle,hfBody,tileConvex,tilePos,0,justTest)}return numContacts}}).call(this,_dereq_("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/collision/Narrowphase.js","/collision")},{"../equations/ContactEquation":24,"../equations/Equation":25,"../equations/FrictionEquation":26,"../math/vec2":33,"../objects/Body":34,"../shapes/Circle":40,"../shapes/Convex":41,"../shapes/Rectangle":46,"../shapes/Shape":47,"../utils/TupleDictionary":51,"../utils/Utils":52,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],16:[function(_dereq_,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){function SAPBroadphase(){Broadphase.call(this,Broadphase.SAP),this.axisList=[],this.world=null,this.axisIndex=0;var axisList=this.axisList;this._addBodyHandler=function(e){axisList.push(e.body)},this._removeBodyHandler=function(e){var idx=axisList.indexOf(e.body);-1!==idx&&axisList.splice(idx,1)}}var Utils=_dereq_("../utils/Utils"),Broadphase=_dereq_("../collision/Broadphase");module.exports=SAPBroadphase,SAPBroadphase.prototype=new Broadphase,SAPBroadphase.prototype.setWorld=function(world){this.axisList.length=0,Utils.appendArray(this.axisList,world.bodies),world.off("addBody",this._addBodyHandler).off("removeBody",this._removeBodyHandler),world.on("addBody",this._addBodyHandler).on("removeBody",this._removeBodyHandler),this.world=world},SAPBroadphase.sortAxisList=function(a,axisIndex){axisIndex=0|axisIndex;for(var i=1,l=a.length;l>i;i++){for(var v=a[i],j=i-1;j>=0&&!(a[j].aabb.lowerBound[axisIndex]<=v.aabb.lowerBound[axisIndex]);j--)a[j+1]=a[j];a[j+1]=v}return a},SAPBroadphase.prototype.getCollisionPairs=function(world){var bodies=this.axisList,result=this.result,axisIndex=this.axisIndex;result.length=0;for(var l=bodies.length;l--;){var b=bodies[l];b.aabbNeedsUpdate&&b.updateAABB()}SAPBroadphase.sortAxisList(bodies,axisIndex);for(var i=0,N=0|bodies.length;i!==N;i++)for(var bi=bodies[i],j=i+1;N>j;j++){var bj=bodies[j],overlaps=bj.aabb.lowerBound[axisIndex]<=bi.aabb.upperBound[axisIndex];if(!overlaps)break;Broadphase.canCollide(bi,bj)&&this.boundingVolumeCheck(bi,bj)&&result.push(bi,bj)}return result}}).call(this,_dereq_("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/collision/SAPBroadphase.js","/collision")},{"../collision/Broadphase":12,"../utils/Utils":52,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],17:[function(_dereq_,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){function Constraint(bodyA,bodyB,type,options){this.type=type,options=Utils.defaults(options,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=bodyA,this.bodyB=bodyB,this.collideConnected=options.collideConnected,options.wakeUpBodies&&(bodyA&&bodyA.wakeUp(),bodyB&&bodyB.wakeUp())}module.exports=Constraint;var Utils=_dereq_("../utils/Utils");Constraint.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},Constraint.DISTANCE=1,Constraint.GEAR=2,Constraint.LOCK=3,Constraint.PRISMATIC=4,Constraint.REVOLUTE=5,Constraint.prototype.setStiffness=function(stiffness){for(var eqs=this.equations,i=0;i!==eqs.length;i++){var eq=eqs[i];eq.stiffness=stiffness,eq.needsUpdate=!0}},Constraint.prototype.setRelaxation=function(relaxation){for(var eqs=this.equations,i=0;i!==eqs.length;i++){var eq=eqs[i];eq.relaxation=relaxation,eq.needsUpdate=!0}}}).call(this,_dereq_("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/constraints/Constraint.js","/constraints")},{"../utils/Utils":52,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],18:[function(_dereq_,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){function DistanceConstraint(bodyA,bodyB,options){options=Utils.defaults(options,{localAnchorA:[0,0],localAnchorB:[0,0]}),Constraint.call(this,bodyA,bodyB,Constraint.DISTANCE,options),this.localAnchorA=vec2.fromValues(options.localAnchorA[0],options.localAnchorA[1]),this.localAnchorB=vec2.fromValues(options.localAnchorB[0],options.localAnchorB[1]);var localAnchorA=this.localAnchorA,localAnchorB=this.localAnchorB;if(this.distance=0,"number"==typeof options.distance)this.distance=options.distance;else{var worldAnchorA=vec2.create(),worldAnchorB=vec2.create(),r=vec2.create();vec2.rotate(worldAnchorA,localAnchorA,bodyA.angle),vec2.rotate(worldAnchorB,localAnchorB,bodyB.angle),vec2.add(r,bodyB.position,worldAnchorB),vec2.sub(r,r,worldAnchorA),vec2.sub(r,r,bodyA.position),this.distance=vec2.length(r)}var maxForce;maxForce="undefined"==typeof options.maxForce?Number.MAX_VALUE:options.maxForce;var normal=new Equation(bodyA,bodyB,-maxForce,maxForce);this.equations=[normal],this.maxForce=maxForce;var r=vec2.create(),ri=vec2.create(),rj=vec2.create(),that=this;normal.computeGq=function(){var bodyA=this.bodyA,bodyB=this.bodyB,xi=bodyA.position,xj=bodyB.position;return vec2.rotate(ri,localAnchorA,bodyA.angle),vec2.rotate(rj,localAnchorB,bodyB.angle),vec2.add(r,xj,rj),vec2.sub(r,r,ri),vec2.sub(r,r,xi),vec2.length(r)-that.distance},this.setMaxForce(maxForce),this.upperLimitEnabled=!1,this.upperLimit=1,this.lowerLimitEnabled=!1,this.lowerLimit=0,this.position=0}var Constraint=_dereq_("./Constraint"),Equation=_dereq_("../equations/Equation"),vec2=_dereq_("../math/vec2"),Utils=_dereq_("../utils/Utils");module.exports=DistanceConstraint,DistanceConstraint.prototype=new Constraint;var n=vec2.create(),ri=vec2.create(),rj=vec2.create();DistanceConstraint.prototype.update=function(){var normal=this.equations[0],bodyA=this.bodyA,bodyB=this.bodyB,xi=(this.distance,bodyA.position),xj=bodyB.position,normalEquation=this.equations[0],G=normal.G;vec2.rotate(ri,this.localAnchorA,bodyA.angle),vec2.rotate(rj,this.localAnchorB,bodyB.angle),vec2.add(n,xj,rj),vec2.sub(n,n,ri),vec2.sub(n,n,xi),this.position=vec2.length(n);var violating=!1;if(this.upperLimitEnabled&&this.position>this.upperLimit&&(normalEquation.maxForce=0,normalEquation.minForce=-this.maxForce,this.distance=this.upperLimit,violating=!0),this.lowerLimitEnabled&&this.position<this.lowerLimit&&(normalEquation.maxForce=this.maxForce,normalEquation.minForce=0,this.distance=this.lowerLimit,violating=!0),(this.lowerLimitEnabled||this.upperLimitEnabled)&&!violating)return void(normalEquation.enabled=!1);normalEquation.enabled=!0,vec2.normalize(n,n);var rixn=vec2.crossLength(ri,n),rjxn=vec2.crossLength(rj,n);G[0]=-n[0],G[1]=-n[1],G[2]=-rixn,G[3]=n[0],G[4]=n[1],G[5]=rjxn},DistanceConstraint.prototype.setMaxForce=function(f){var normal=this.equations[0];normal.minForce=-f,normal.maxForce=f},DistanceConstraint.prototype.getMaxForce=function(f){var normal=this.equations[0];return normal.maxForce}}).call(this,_dereq_("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/constraints/DistanceConstraint.js","/constraints")},{"../equations/Equation":25,"../math/vec2":33,"../utils/Utils":52,"./Constraint":17,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],19:[function(_dereq_,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){function GearConstraint(bodyA,bodyB,options){options=options||{},Constraint.call(this,bodyA,bodyB,Constraint.GEAR,options),this.ratio="number"==typeof options.ratio?options.ratio:1,this.angle="number"==typeof options.angle?options.angle:bodyB.angle-this.ratio*bodyA.angle,options.angle=this.angle,options.ratio=this.ratio,this.equations=[new AngleLockEquation(bodyA,bodyB,options)],"number"==typeof options.maxTorque&&this.setMaxTorque(options.maxTorque)}var Constraint=_dereq_("./Constraint"),AngleLockEquation=(_dereq_("../equations/Equation"),_dereq_("../equations/AngleLockEquation"));_dereq_("../math/vec2");module.exports=GearConstraint,GearConstraint.prototype=new Constraint,GearConstraint.prototype.update=function(){var eq=this.equations[0];eq.ratio!==this.ratio&&eq.setRatio(this.ratio),eq.angle=this.angle},GearConstraint.prototype.setMaxTorque=function(torque){this.equations[0].setMaxTorque(torque)},GearConstraint.prototype.getMaxTorque=function(torque){return this.equations[0].maxForce}}).call(this,_dereq_("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/constraints/GearConstraint.js","/constraints")},{"../equations/AngleLockEquation":23,"../equations/Equation":25,"../math/vec2":33,"./Constraint":17,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],20:[function(_dereq_,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){function LockConstraint(bodyA,bodyB,options){options=options||{},Constraint.call(this,bodyA,bodyB,Constraint.LOCK,options);var maxForce="undefined"==typeof options.maxForce?Number.MAX_VALUE:options.maxForce,x=(options.localAngleB||0,new Equation(bodyA,bodyB,-maxForce,maxForce)),y=new Equation(bodyA,bodyB,-maxForce,maxForce),rot=new Equation(bodyA,bodyB,-maxForce,maxForce),l=vec2.create(),g=vec2.create(),that=this;x.computeGq=function(){return vec2.rotate(l,that.localOffsetB,bodyA.angle),vec2.sub(g,bodyB.position,bodyA.position),vec2.sub(g,g,l),g[0]},y.computeGq=function(){return vec2.rotate(l,that.localOffsetB,bodyA.angle),vec2.sub(g,bodyB.position,bodyA.position),vec2.sub(g,g,l),g[1]};var r=vec2.create(),t=vec2.create();rot.computeGq=function(){return vec2.rotate(r,that.localOffsetB,bodyB.angle-that.localAngleB),vec2.scale(r,r,-1),vec2.sub(g,bodyA.position,bodyB.position),vec2.add(g,g,r),vec2.rotate(t,r,-Math.PI/2),vec2.normalize(t,t),vec2.dot(g,t)},this.localOffsetB=vec2.create(),options.localOffsetB?vec2.copy(this.localOffsetB,options.localOffsetB):(vec2.sub(this.localOffsetB,bodyB.position,bodyA.position),vec2.rotate(this.localOffsetB,this.localOffsetB,-bodyA.angle)),this.localAngleB=0,"number"==typeof options.localAngleB?this.localAngleB=options.localAngleB:this.localAngleB=bodyB.angle-bodyA.angle,this.equations.push(x,y,rot),this.setMaxForce(maxForce)}var Constraint=_dereq_("./Constraint"),vec2=_dereq_("../math/vec2"),Equation=_dereq_("../equations/Equation");module.exports=LockConstraint,LockConstraint.prototype=new Constraint,LockConstraint.prototype.setMaxForce=function(force){for(var eqs=this.equations,i=0;i<this.equations.length;i++)eqs[i].maxForce=force,eqs[i].minForce=-force},LockConstraint.prototype.getMaxForce=function(){return this.equations[0].maxForce};var l=vec2.create(),r=vec2.create(),t=vec2.create(),xAxis=vec2.fromValues(1,0),yAxis=vec2.fromValues(0,1);LockConstraint.prototype.update=function(){var x=this.equations[0],y=this.equations[1],rot=this.equations[2],bodyA=this.bodyA,bodyB=this.bodyB;vec2.rotate(l,this.localOffsetB,bodyA.angle),vec2.rotate(r,this.localOffsetB,bodyB.angle-this.localAngleB),vec2.scale(r,r,-1),vec2.rotate(t,r,Math.PI/2),vec2.normalize(t,t),x.G[0]=-1,x.G[1]=0,x.G[2]=-vec2.crossLength(l,xAxis),x.G[3]=1,y.G[0]=0,y.G[1]=-1,y.G[2]=-vec2.crossLength(l,yAxis),y.G[4]=1,rot.G[0]=-t[0],rot.G[1]=-t[1],rot.G[3]=t[0],rot.G[4]=t[1],rot.G[5]=vec2.crossLength(r,t)}}).call(this,_dereq_("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/constraints/LockConstraint.js","/constraints")},{"../equations/Equation":25,"../math/vec2":33,"./Constraint":17,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],21:[function(_dereq_,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){function PrismaticConstraint(bodyA,bodyB,options){options=options||{},Constraint.call(this,bodyA,bodyB,Constraint.PRISMATIC,options);var localAnchorA=vec2.fromValues(0,0),localAxisA=vec2.fromValues(1,0),localAnchorB=vec2.fromValues(0,0);options.localAnchorA&&vec2.copy(localAnchorA,options.localAnchorA),
options.localAxisA&&vec2.copy(localAxisA,options.localAxisA),options.localAnchorB&&vec2.copy(localAnchorB,options.localAnchorB),this.localAnchorA=localAnchorA,this.localAnchorB=localAnchorB,this.localAxisA=localAxisA;var maxForce=this.maxForce="undefined"!=typeof options.maxForce?options.maxForce:Number.MAX_VALUE,trans=new Equation(bodyA,bodyB,-maxForce,maxForce),ri=new vec2.create,rj=new vec2.create,gg=new vec2.create,t=new vec2.create;if(trans.computeGq=function(){return vec2.dot(gg,t)},trans.updateJacobian=function(){var G=this.G,xi=bodyA.position,xj=bodyB.position;vec2.rotate(ri,localAnchorA,bodyA.angle),vec2.rotate(rj,localAnchorB,bodyB.angle),vec2.add(gg,xj,rj),vec2.sub(gg,gg,xi),vec2.sub(gg,gg,ri),vec2.rotate(t,localAxisA,bodyA.angle+Math.PI/2),G[0]=-t[0],G[1]=-t[1],G[2]=-vec2.crossLength(ri,t)+vec2.crossLength(t,gg),G[3]=t[0],G[4]=t[1],G[5]=vec2.crossLength(rj,t)},this.equations.push(trans),!options.disableRotationalLock){var rot=new RotationalLockEquation(bodyA,bodyB,-maxForce,maxForce);this.equations.push(rot)}this.position=0,this.velocity=0,this.lowerLimitEnabled="undefined"!=typeof options.lowerLimit?!0:!1,this.upperLimitEnabled="undefined"!=typeof options.upperLimit?!0:!1,this.lowerLimit="undefined"!=typeof options.lowerLimit?options.lowerLimit:0,this.upperLimit="undefined"!=typeof options.upperLimit?options.upperLimit:1,this.upperLimitEquation=new ContactEquation(bodyA,bodyB),this.lowerLimitEquation=new ContactEquation(bodyA,bodyB),this.upperLimitEquation.minForce=this.lowerLimitEquation.minForce=0,this.upperLimitEquation.maxForce=this.lowerLimitEquation.maxForce=maxForce,this.motorEquation=new Equation(bodyA,bodyB),this.motorEnabled=!1,this.motorSpeed=0;var that=this,motorEquation=this.motorEquation;motorEquation.computeGW;motorEquation.computeGq=function(){return 0},motorEquation.computeGW=function(){var G=this.G,bi=this.bodyA,bj=this.bodyB,vi=bi.velocity,vj=bj.velocity,wi=bi.angularVelocity,wj=bj.angularVelocity;return this.gmult(G,vi,wi,vj,wj)+that.motorSpeed}}var Constraint=_dereq_("./Constraint"),ContactEquation=_dereq_("../equations/ContactEquation"),Equation=_dereq_("../equations/Equation"),vec2=_dereq_("../math/vec2"),RotationalLockEquation=_dereq_("../equations/RotationalLockEquation");module.exports=PrismaticConstraint,PrismaticConstraint.prototype=new Constraint;var worldAxisA=vec2.create(),worldAnchorA=vec2.create(),worldAnchorB=vec2.create(),orientedAnchorA=vec2.create(),orientedAnchorB=vec2.create(),tmp=vec2.create();PrismaticConstraint.prototype.update=function(){var eqs=this.equations,trans=eqs[0],upperLimit=this.upperLimit,lowerLimit=this.lowerLimit,upperLimitEquation=this.upperLimitEquation,lowerLimitEquation=this.lowerLimitEquation,bodyA=this.bodyA,bodyB=this.bodyB,localAxisA=this.localAxisA,localAnchorA=this.localAnchorA,localAnchorB=this.localAnchorB;trans.updateJacobian(),vec2.rotate(worldAxisA,localAxisA,bodyA.angle),vec2.rotate(orientedAnchorA,localAnchorA,bodyA.angle),vec2.add(worldAnchorA,orientedAnchorA,bodyA.position),vec2.rotate(orientedAnchorB,localAnchorB,bodyB.angle),vec2.add(worldAnchorB,orientedAnchorB,bodyB.position);var relPosition=this.position=vec2.dot(worldAnchorB,worldAxisA)-vec2.dot(worldAnchorA,worldAxisA);if(this.motorEnabled){var G=this.motorEquation.G;G[0]=worldAxisA[0],G[1]=worldAxisA[1],G[2]=vec2.crossLength(worldAxisA,orientedAnchorB),G[3]=-worldAxisA[0],G[4]=-worldAxisA[1],G[5]=-vec2.crossLength(worldAxisA,orientedAnchorA)}if(this.upperLimitEnabled&&relPosition>upperLimit)vec2.scale(upperLimitEquation.normalA,worldAxisA,-1),vec2.sub(upperLimitEquation.contactPointA,worldAnchorA,bodyA.position),vec2.sub(upperLimitEquation.contactPointB,worldAnchorB,bodyB.position),vec2.scale(tmp,worldAxisA,upperLimit),vec2.add(upperLimitEquation.contactPointA,upperLimitEquation.contactPointA,tmp),-1===eqs.indexOf(upperLimitEquation)&&eqs.push(upperLimitEquation);else{var idx=eqs.indexOf(upperLimitEquation);-1!==idx&&eqs.splice(idx,1)}if(this.lowerLimitEnabled&&lowerLimit>relPosition)vec2.scale(lowerLimitEquation.normalA,worldAxisA,1),vec2.sub(lowerLimitEquation.contactPointA,worldAnchorA,bodyA.position),vec2.sub(lowerLimitEquation.contactPointB,worldAnchorB,bodyB.position),vec2.scale(tmp,worldAxisA,lowerLimit),vec2.sub(lowerLimitEquation.contactPointB,lowerLimitEquation.contactPointB,tmp),-1===eqs.indexOf(lowerLimitEquation)&&eqs.push(lowerLimitEquation);else{var idx=eqs.indexOf(lowerLimitEquation);-1!==idx&&eqs.splice(idx,1)}},PrismaticConstraint.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},PrismaticConstraint.prototype.disableMotor=function(){if(this.motorEnabled){var i=this.equations.indexOf(this.motorEquation);this.equations.splice(i,1),this.motorEnabled=!1}},PrismaticConstraint.prototype.setLimits=function(lower,upper){"number"==typeof lower?(this.lowerLimit=lower,this.lowerLimitEnabled=!0):(this.lowerLimit=lower,this.lowerLimitEnabled=!1),"number"==typeof upper?(this.upperLimit=upper,this.upperLimitEnabled=!0):(this.upperLimit=upper,this.upperLimitEnabled=!1)}}).call(this,_dereq_("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/constraints/PrismaticConstraint.js","/constraints")},{"../equations/ContactEquation":24,"../equations/Equation":25,"../equations/RotationalLockEquation":27,"../math/vec2":33,"./Constraint":17,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],22:[function(_dereq_,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){function RevoluteConstraint(bodyA,bodyB,options){options=options||{},Constraint.call(this,bodyA,bodyB,Constraint.REVOLUTE,options);var maxForce=this.maxForce="undefined"!=typeof options.maxForce?options.maxForce:Number.MAX_VALUE;this.pivotA=vec2.create(),this.pivotB=vec2.create(),options.worldPivot?(vec2.sub(this.pivotA,options.worldPivot,bodyA.position),vec2.sub(this.pivotB,options.worldPivot,bodyB.position),vec2.rotate(this.pivotA,this.pivotA,-bodyA.angle),vec2.rotate(this.pivotB,this.pivotB,-bodyB.angle)):(vec2.copy(this.pivotA,options.localPivotA),vec2.copy(this.pivotB,options.localPivotB));var eqs=this.equations=[new Equation(bodyA,bodyB,-maxForce,maxForce),new Equation(bodyA,bodyB,-maxForce,maxForce)],x=eqs[0],y=eqs[1],that=this;x.computeGq=function(){return vec2.rotate(worldPivotA,that.pivotA,bodyA.angle),vec2.rotate(worldPivotB,that.pivotB,bodyB.angle),vec2.add(g,bodyB.position,worldPivotB),vec2.sub(g,g,bodyA.position),vec2.sub(g,g,worldPivotA),vec2.dot(g,xAxis)},y.computeGq=function(){return vec2.rotate(worldPivotA,that.pivotA,bodyA.angle),vec2.rotate(worldPivotB,that.pivotB,bodyB.angle),vec2.add(g,bodyB.position,worldPivotB),vec2.sub(g,g,bodyA.position),vec2.sub(g,g,worldPivotA),vec2.dot(g,yAxis)},y.minForce=x.minForce=-maxForce,y.maxForce=x.maxForce=maxForce,this.motorEquation=new RotationalVelocityEquation(bodyA,bodyB),this.motorEnabled=!1,this.angle=0,this.lowerLimitEnabled=!1,this.upperLimitEnabled=!1,this.lowerLimit=0,this.upperLimit=0,this.upperLimitEquation=new RotationalLockEquation(bodyA,bodyB),this.lowerLimitEquation=new RotationalLockEquation(bodyA,bodyB),this.upperLimitEquation.minForce=0,this.lowerLimitEquation.maxForce=0}var Constraint=_dereq_("./Constraint"),Equation=_dereq_("../equations/Equation"),RotationalVelocityEquation=_dereq_("../equations/RotationalVelocityEquation"),RotationalLockEquation=_dereq_("../equations/RotationalLockEquation"),vec2=_dereq_("../math/vec2");module.exports=RevoluteConstraint;var worldPivotA=vec2.create(),worldPivotB=vec2.create(),xAxis=vec2.fromValues(1,0),yAxis=vec2.fromValues(0,1),g=vec2.create();RevoluteConstraint.prototype=new Constraint,RevoluteConstraint.prototype.setLimits=function(lower,upper){"number"==typeof lower?(this.lowerLimit=lower,this.lowerLimitEnabled=!0):(this.lowerLimit=lower,this.lowerLimitEnabled=!1),"number"==typeof upper?(this.upperLimit=upper,this.upperLimitEnabled=!0):(this.upperLimit=upper,this.upperLimitEnabled=!1)},RevoluteConstraint.prototype.update=function(){var bodyA=this.bodyA,bodyB=this.bodyB,pivotA=this.pivotA,pivotB=this.pivotB,eqs=this.equations,x=(eqs[0],eqs[1],eqs[0]),y=eqs[1],upperLimit=this.upperLimit,lowerLimit=this.lowerLimit,upperLimitEquation=this.upperLimitEquation,lowerLimitEquation=this.lowerLimitEquation,relAngle=this.angle=bodyB.angle-bodyA.angle;if(this.upperLimitEnabled&&relAngle>upperLimit)upperLimitEquation.angle=upperLimit,-1===eqs.indexOf(upperLimitEquation)&&eqs.push(upperLimitEquation);else{var idx=eqs.indexOf(upperLimitEquation);-1!==idx&&eqs.splice(idx,1)}if(this.lowerLimitEnabled&&lowerLimit>relAngle)lowerLimitEquation.angle=lowerLimit,-1===eqs.indexOf(lowerLimitEquation)&&eqs.push(lowerLimitEquation);else{var idx=eqs.indexOf(lowerLimitEquation);-1!==idx&&eqs.splice(idx,1)}vec2.rotate(worldPivotA,pivotA,bodyA.angle),vec2.rotate(worldPivotB,pivotB,bodyB.angle),x.G[0]=-1,x.G[1]=0,x.G[2]=-vec2.crossLength(worldPivotA,xAxis),x.G[3]=1,x.G[4]=0,x.G[5]=vec2.crossLength(worldPivotB,xAxis),y.G[0]=0,y.G[1]=-1,y.G[2]=-vec2.crossLength(worldPivotA,yAxis),y.G[3]=0,y.G[4]=1,y.G[5]=vec2.crossLength(worldPivotB,yAxis)},RevoluteConstraint.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},RevoluteConstraint.prototype.disableMotor=function(){if(this.motorEnabled){var i=this.equations.indexOf(this.motorEquation);this.equations.splice(i,1),this.motorEnabled=!1}},RevoluteConstraint.prototype.motorIsEnabled=function(){return!!this.motorEnabled},RevoluteConstraint.prototype.setMotorSpeed=function(speed){if(this.motorEnabled){var i=this.equations.indexOf(this.motorEquation);this.equations[i].relativeVelocity=speed}},RevoluteConstraint.prototype.getMotorSpeed=function(){return this.motorEnabled?this.motorEquation.relativeVelocity:!1}}).call(this,_dereq_("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/constraints/RevoluteConstraint.js","/constraints")},{"../equations/Equation":25,"../equations/RotationalLockEquation":27,"../equations/RotationalVelocityEquation":28,"../math/vec2":33,"./Constraint":17,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],23:[function(_dereq_,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){function AngleLockEquation(bodyA,bodyB,options){options=options||{},Equation.call(this,bodyA,bodyB,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=options.angle||0,this.ratio="number"==typeof options.ratio?options.ratio:1,this.setRatio(this.ratio)}var Equation=_dereq_("./Equation");_dereq_("../math/vec2");module.exports=AngleLockEquation,AngleLockEquation.prototype=new Equation,AngleLockEquation.prototype.constructor=AngleLockEquation,AngleLockEquation.prototype.computeGq=function(){return this.ratio*this.bodyA.angle-this.bodyB.angle+this.angle},AngleLockEquation.prototype.setRatio=function(ratio){var G=this.G;G[2]=ratio,G[5]=-1,this.ratio=ratio},AngleLockEquation.prototype.setMaxTorque=function(torque){this.maxForce=torque,this.minForce=-torque}}).call(this,_dereq_("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/equations/AngleLockEquation.js","/equations")},{"../math/vec2":33,"./Equation":25,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],24:[function(_dereq_,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){function ContactEquation(bodyA,bodyB){Equation.call(this,bodyA,bodyB,0,Number.MAX_VALUE),this.contactPointA=vec2.create(),this.penetrationVec=vec2.create(),this.contactPointB=vec2.create(),this.normalA=vec2.create(),this.restitution=0,this.firstImpact=!1,this.shapeA=null,this.shapeB=null}var Equation=_dereq_("./Equation"),vec2=_dereq_("../math/vec2");module.exports=ContactEquation,ContactEquation.prototype=new Equation,ContactEquation.prototype.constructor=ContactEquation,ContactEquation.prototype.computeB=function(a,b,h){var bi=this.bodyA,bj=this.bodyB,ri=this.contactPointA,rj=this.contactPointB,xi=bi.position,xj=bj.position,penetrationVec=this.penetrationVec,n=this.normalA,G=this.G,rixn=vec2.crossLength(ri,n),rjxn=vec2.crossLength(rj,n);G[0]=-n[0],G[1]=-n[1],G[2]=-rixn,G[3]=n[0],G[4]=n[1],G[5]=rjxn,vec2.add(penetrationVec,xj,rj),vec2.sub(penetrationVec,penetrationVec,xi),vec2.sub(penetrationVec,penetrationVec,ri);var GW,Gq;this.firstImpact&&0!==this.restitution?(Gq=0,GW=1/b*(1+this.restitution)*this.computeGW()):(Gq=vec2.dot(n,penetrationVec)+this.offset,GW=this.computeGW());var GiMf=this.computeGiMf(),B=-Gq*a-GW*b-h*GiMf;return B}}).call(this,_dereq_("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/equations/ContactEquation.js","/equations")},{"../math/vec2":33,"./Equation":25,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],25:[function(_dereq_,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){function Equation(bodyA,bodyB,minForce,maxForce){this.minForce="undefined"==typeof minForce?-Number.MAX_VALUE:minForce,this.maxForce="undefined"==typeof maxForce?Number.MAX_VALUE:maxForce,this.bodyA=bodyA,this.bodyB=bodyB,this.stiffness=Equation.DEFAULT_STIFFNESS,this.relaxation=Equation.DEFAULT_RELAXATION,this.G=new Utils.ARRAY_TYPE(6);for(var i=0;6>i;i++)this.G[i]=0;this.offset=0,this.a=0,this.b=0,this.epsilon=0,this.timeStep=1/60,this.needsUpdate=!0,this.multiplier=0,this.relativeVelocity=0,this.enabled=!0}module.exports=Equation;var vec2=_dereq_("../math/vec2"),Utils=_dereq_("../utils/Utils");_dereq_("../objects/Body");Equation.prototype.constructor=Equation,Equation.DEFAULT_STIFFNESS=1e6,Equation.DEFAULT_RELAXATION=4,Equation.prototype.update=function(){var k=this.stiffness,d=this.relaxation,h=this.timeStep;this.a=4/(h*(1+4*d)),this.b=4*d/(1+4*d),this.epsilon=4/(h*h*k*(1+4*d)),this.needsUpdate=!1},Equation.prototype.gmult=function(G,vi,wi,vj,wj){return G[0]*vi[0]+G[1]*vi[1]+G[2]*wi+G[3]*vj[0]+G[4]*vj[1]+G[5]*wj},Equation.prototype.computeB=function(a,b,h){var GW=this.computeGW(),Gq=this.computeGq(),GiMf=this.computeGiMf();return-Gq*a-GW*b-GiMf*h};var qi=vec2.create(),qj=vec2.create();Equation.prototype.computeGq=function(){var G=this.G,bi=this.bodyA,bj=this.bodyB,ai=(bi.position,bj.position,bi.angle),aj=bj.angle;return this.gmult(G,qi,ai,qj,aj)+this.offset},Equation.prototype.computeGW=function(){var G=this.G,bi=this.bodyA,bj=this.bodyB,vi=bi.velocity,vj=bj.velocity,wi=bi.angularVelocity,wj=bj.angularVelocity;return this.gmult(G,vi,wi,vj,wj)+this.relativeVelocity},Equation.prototype.computeGWlambda=function(){var G=this.G,bi=this.bodyA,bj=this.bodyB,vi=bi.vlambda,vj=bj.vlambda,wi=bi.wlambda,wj=bj.wlambda;return this.gmult(G,vi,wi,vj,wj)};var iMfi=vec2.create(),iMfj=vec2.create();Equation.prototype.computeGiMf=function(){var bi=this.bodyA,bj=this.bodyB,fi=bi.force,ti=bi.angularForce,fj=bj.force,tj=bj.angularForce,invMassi=bi.invMassSolve,invMassj=bj.invMassSolve,invIi=bi.invInertiaSolve,invIj=bj.invInertiaSolve,G=this.G;return vec2.scale(iMfi,fi,invMassi),vec2.scale(iMfj,fj,invMassj),this.gmult(G,iMfi,ti*invIi,iMfj,tj*invIj)},Equation.prototype.computeGiMGt=function(){var bi=this.bodyA,bj=this.bodyB,invMassi=bi.invMassSolve,invMassj=bj.invMassSolve,invIi=bi.invInertiaSolve,invIj=bj.invInertiaSolve,G=this.G;return G[0]*G[0]*invMassi+G[1]*G[1]*invMassi+G[2]*G[2]*invIi+G[3]*G[3]*invMassj+G[4]*G[4]*invMassj+G[5]*G[5]*invIj};var addToWlambda_temp=vec2.create(),addToWlambda_Gi=vec2.create(),addToWlambda_Gj=vec2.create();vec2.create(),vec2.create(),vec2.create();Equation.prototype.addToWlambda=function(deltalambda){var bi=this.bodyA,bj=this.bodyB,temp=addToWlambda_temp,Gi=addToWlambda_Gi,Gj=addToWlambda_Gj,invMassi=bi.invMassSolve,invMassj=bj.invMassSolve,invIi=bi.invInertiaSolve,invIj=bj.invInertiaSolve,G=this.G;Gi[0]=G[0],Gi[1]=G[1],Gj[0]=G[3],Gj[1]=G[4],vec2.scale(temp,Gi,invMassi*deltalambda),vec2.add(bi.vlambda,bi.vlambda,temp),bi.wlambda+=invIi*G[2]*deltalambda,vec2.scale(temp,Gj,invMassj*deltalambda),vec2.add(bj.vlambda,bj.vlambda,temp),bj.wlambda+=invIj*G[5]*deltalambda},Equation.prototype.computeInvC=function(eps){return 1/(this.computeGiMGt()+eps)}}).call(this,_dereq_("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/equations/Equation.js","/equations")},{"../math/vec2":33,"../objects/Body":34,"../utils/Utils":52,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],26:[function(_dereq_,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){function FrictionEquation(bodyA,bodyB,slipForce){Equation.call(this,bodyA,bodyB,-slipForce,slipForce),this.contactPointA=vec2.create(),this.contactPointB=vec2.create(),this.t=vec2.create(),this.contactEquations=[],this.shapeA=null,this.shapeB=null,this.frictionCoefficient=.3}var vec2=_dereq_("../math/vec2"),Equation=_dereq_("./Equation");_dereq_("../utils/Utils");module.exports=FrictionEquation,FrictionEquation.prototype=new Equation,FrictionEquation.prototype.constructor=FrictionEquation,FrictionEquation.prototype.setSlipForce=function(slipForce){this.maxForce=slipForce,this.minForce=-slipForce},FrictionEquation.prototype.getSlipForce=function(){return this.maxForce},FrictionEquation.prototype.computeB=function(a,b,h){var ri=(this.bodyA,this.bodyB,this.contactPointA),rj=this.contactPointB,t=this.t,G=this.G;G[0]=-t[0],G[1]=-t[1],G[2]=-vec2.crossLength(ri,t),G[3]=t[0],G[4]=t[1],G[5]=vec2.crossLength(rj,t);var GW=this.computeGW(),GiMf=this.computeGiMf(),B=-GW*b-h*GiMf;return B}}).call(this,_dereq_("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/equations/FrictionEquation.js","/equations")},{"../math/vec2":33,"../utils/Utils":52,"./Equation":25,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],27:[function(_dereq_,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){function RotationalLockEquation(bodyA,bodyB,options){options=options||{},Equation.call(this,bodyA,bodyB,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=options.angle||0;var G=this.G;G[2]=1,G[5]=-1}var Equation=_dereq_("./Equation"),vec2=_dereq_("../math/vec2");module.exports=RotationalLockEquation,RotationalLockEquation.prototype=new Equation,RotationalLockEquation.prototype.constructor=RotationalLockEquation;var worldVectorA=vec2.create(),worldVectorB=vec2.create(),xAxis=vec2.fromValues(1,0),yAxis=vec2.fromValues(0,1);RotationalLockEquation.prototype.computeGq=function(){return vec2.rotate(worldVectorA,xAxis,this.bodyA.angle+this.angle),vec2.rotate(worldVectorB,yAxis,this.bodyB.angle),vec2.dot(worldVectorA,worldVectorB)}}).call(this,_dereq_("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/equations/RotationalLockEquation.js","/equations")},{"../math/vec2":33,"./Equation":25,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],28:[function(_dereq_,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){function RotationalVelocityEquation(bodyA,bodyB){Equation.call(this,bodyA,bodyB,-Number.MAX_VALUE,Number.MAX_VALUE),this.relativeVelocity=1,this.ratio=1}var Equation=_dereq_("./Equation");_dereq_("../math/vec2");module.exports=RotationalVelocityEquation,RotationalVelocityEquation.prototype=new Equation,RotationalVelocityEquation.prototype.constructor=RotationalVelocityEquation,RotationalVelocityEquation.prototype.computeB=function(a,b,h){var G=this.G;G[2]=-1,G[5]=this.ratio;var GiMf=this.computeGiMf(),GW=this.computeGW(),B=-GW*b-h*GiMf;return B}}).call(this,_dereq_("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/equations/RotationalVelocityEquation.js","/equations")},{"../math/vec2":33,"./Equation":25,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],29:[function(_dereq_,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){var EventEmitter=function(){};module.exports=EventEmitter,EventEmitter.prototype={constructor:EventEmitter,on:function(type,listener,context){listener.context=context||this,void 0===this._listeners&&(this._listeners={});var listeners=this._listeners;return void 0===listeners[type]&&(listeners[type]=[]),-1===listeners[type].indexOf(listener)&&listeners[type].push(listener),this},has:function(type,listener){if(void 0===this._listeners)return!1;var listeners=this._listeners;if(listener){if(void 0!==listeners[type]&&-1!==listeners[type].indexOf(listener))return!0}else if(void 0!==listeners[type])return!0;return!1},off:function(type,listener){if(void 0===this._listeners)return this;var listeners=this._listeners,index=listeners[type].indexOf(listener);return-1!==index&&listeners[type].splice(index,1),this},emit:function(event){if(void 0===this._listeners)return this;var listeners=this._listeners,listenerArray=listeners[event.type];if(void 0!==listenerArray){event.target=this;for(var i=0,l=listenerArray.length;l>i;i++){var listener=listenerArray[i];listener.call(listener.context,event)}}return this}}}).call(this,_dereq_("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/events/EventEmitter.js","/events")},{"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],30:[function(_dereq_,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){function ContactMaterial(materialA,materialB,options){if(options=options||{},!(materialA instanceof Material&&materialB instanceof Material))throw new Error("First two arguments must be Material instances.");this.id=ContactMaterial.idCounter++,this.materialA=materialA,this.materialB=materialB,this.friction="undefined"!=typeof options.friction?Number(options.friction):.3,this.restitution="undefined"!=typeof options.restitution?Number(options.restitution):0,this.stiffness="undefined"!=typeof options.stiffness?Number(options.stiffness):Equation.DEFAULT_STIFFNESS,this.relaxation="undefined"!=typeof options.relaxation?Number(options.relaxation):Equation.DEFAULT_RELAXATION,this.frictionStiffness="undefined"!=typeof options.frictionStiffness?Number(options.frictionStiffness):Equation.DEFAULT_STIFFNESS,this.frictionRelaxation="undefined"!=typeof options.frictionRelaxation?Number(options.frictionRelaxation):Equation.DEFAULT_RELAXATION,this.surfaceVelocity="undefined"!=typeof options.surfaceVelocity?Number(options.surfaceVelocity):0,this.contactSkinSize=.005}var Material=_dereq_("./Material"),Equation=_dereq_("../equations/Equation");module.exports=ContactMaterial,ContactMaterial.idCounter=0}).call(this,_dereq_("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/material/ContactMaterial.js","/material")},{"../equations/Equation":25,"./Material":31,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],31:[function(_dereq_,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){function Material(id){this.id=id||Material.idCounter++}module.exports=Material,Material.idCounter=0}).call(this,_dereq_("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/material/Material.js","/material")},{"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],32:[function(_dereq_,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){var PolyK={};PolyK.GetArea=function(p){if(p.length<6)return 0;for(var l=p.length-2,sum=0,i=0;l>i;i+=2)sum+=(p[i+2]-p[i])*(p[i+1]+p[i+3]);return sum+=(p[0]-p[l])*(p[l+1]+p[1]),.5*-sum},PolyK.Triangulate=function(p){var n=p.length>>1;if(3>n)return[];for(var tgs=[],avl=[],i=0;n>i;i++)avl.push(i);for(var i=0,al=n;al>3;){var i0=avl[(i+0)%al],i1=avl[(i+1)%al],i2=avl[(i+2)%al],ax=p[2*i0],ay=p[2*i0+1],bx=p[2*i1],by=p[2*i1+1],cx=p[2*i2],cy=p[2*i2+1],earFound=!1;if(PolyK._convex(ax,ay,bx,by,cx,cy)){earFound=!0;for(var j=0;al>j;j++){var vi=avl[j];if(vi!=i0&&vi!=i1&&vi!=i2&&PolyK._PointInTriangle(p[2*vi],p[2*vi+1],ax,ay,bx,by,cx,cy)){earFound=!1;break}}}if(earFound)tgs.push(i0,i1,i2),avl.splice((i+1)%al,1),al--,i=0;else if(i++>3*al)break}return tgs.push(avl[0],avl[1],avl[2]),tgs},PolyK._PointInTriangle=function(px,py,ax,ay,bx,by,cx,cy){var v0x=cx-ax,v0y=cy-ay,v1x=bx-ax,v1y=by-ay,v2x=px-ax,v2y=py-ay,dot00=v0x*v0x+v0y*v0y,dot01=v0x*v1x+v0y*v1y,dot02=v0x*v2x+v0y*v2y,dot11=v1x*v1x+v1y*v1y,dot12=v1x*v2x+v1y*v2y,invDenom=1/(dot00*dot11-dot01*dot01),u=(dot11*dot02-dot01*dot12)*invDenom,v=(dot00*dot12-dot01*dot02)*invDenom;return u>=0&&v>=0&&1>u+v},PolyK._convex=function(ax,ay,bx,by,cx,cy){return(ay-by)*(cx-bx)+(bx-ax)*(cy-by)>=0},module.exports=PolyK}).call(this,_dereq_("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/math/polyk.js","/math")},{"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],33:[function(_dereq_,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){var vec2=module.exports={},Utils=_dereq_("../utils/Utils");vec2.crossLength=function(a,b){return a[0]*b[1]-a[1]*b[0]},vec2.crossVZ=function(out,vec,zcomp){return vec2.rotate(out,vec,-Math.PI/2),vec2.scale(out,out,zcomp),out},vec2.crossZV=function(out,zcomp,vec){return vec2.rotate(out,vec,Math.PI/2),vec2.scale(out,out,zcomp),out},vec2.rotate=function(out,a,angle){if(0!==angle){var c=Math.cos(angle),s=Math.sin(angle),x=a[0],y=a[1];out[0]=c*x-s*y,out[1]=s*x+c*y}else out[0]=a[0],out[1]=a[1]},vec2.rotate90cw=function(out,a){var x=a[0],y=a[1];out[0]=y,out[1]=-x},vec2.toLocalFrame=function(out,worldPoint,framePosition,frameAngle){vec2.copy(out,worldPoint),vec2.sub(out,out,framePosition),vec2.rotate(out,out,-frameAngle)},vec2.toGlobalFrame=function(out,localPoint,framePosition,frameAngle){vec2.copy(out,localPoint),vec2.rotate(out,out,frameAngle),vec2.add(out,out,framePosition)},vec2.centroid=function(out,a,b,c){return vec2.add(out,a,b),vec2.add(out,out,c),vec2.scale(out,out,1/3),out},vec2.create=function(){var out=new Utils.ARRAY_TYPE(2);return out[0]=0,out[1]=0,out},vec2.clone=function(a){var out=new Utils.ARRAY_TYPE(2);return out[0]=a[0],out[1]=a[1],out},vec2.fromValues=function(x,y){var out=new Utils.ARRAY_TYPE(2);return out[0]=x,out[1]=y,out},vec2.copy=function(out,a){return out[0]=a[0],out[1]=a[1],out},vec2.set=function(out,x,y){return out[0]=x,out[1]=y,out},vec2.add=function(out,a,b){return out[0]=a[0]+b[0],out[1]=a[1]+b[1],out},vec2.subtract=function(out,a,b){return out[0]=a[0]-b[0],out[1]=a[1]-b[1],out},vec2.sub=vec2.subtract,vec2.multiply=function(out,a,b){return out[0]=a[0]*b[0],out[1]=a[1]*b[1],out},vec2.mul=vec2.multiply,vec2.divide=function(out,a,b){return out[0]=a[0]/b[0],out[1]=a[1]/b[1],out},vec2.div=vec2.divide,vec2.scale=function(out,a,b){return out[0]=a[0]*b,out[1]=a[1]*b,out},vec2.distance=function(a,b){var x=b[0]-a[0],y=b[1]-a[1];return Math.sqrt(x*x+y*y)},vec2.dist=vec2.distance,vec2.squaredDistance=function(a,b){var x=b[0]-a[0],y=b[1]-a[1];return x*x+y*y},vec2.sqrDist=vec2.squaredDistance,vec2.length=function(a){var x=a[0],y=a[1];return Math.sqrt(x*x+y*y)},vec2.len=vec2.length,vec2.squaredLength=function(a){var x=a[0],y=a[1];return x*x+y*y},vec2.sqrLen=vec2.squaredLength,vec2.negate=function(out,a){return out[0]=-a[0],out[1]=-a[1],out},vec2.normalize=function(out,a){var x=a[0],y=a[1],len=x*x+y*y;return len>0&&(len=1/Math.sqrt(len),out[0]=a[0]*len,out[1]=a[1]*len),out},vec2.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]},vec2.str=function(a){return"vec2("+a[0]+", "+a[1]+")"}}).call(this,_dereq_("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/math/vec2.js","/math")},{"../utils/Utils":52,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],34:[function(_dereq_,module,exports){
(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){function Body(options){options=options||{},EventEmitter.call(this),this.id=++Body._idCounter,this.world=null,this.shapes=[],this.shapeOffsets=[],this.shapeAngles=[],this.mass=options.mass||0,this.invMass=0,this.inertia=0,this.invInertia=0,this.invMassSolve=0,this.invInertiaSolve=0,this.fixedRotation=!!options.fixedRotation||!1,this.position=vec2.fromValues(0,0),options.position&&vec2.copy(this.position,options.position),this.interpolatedPosition=vec2.fromValues(0,0),this.interpolatedAngle=0,this.previousPosition=vec2.fromValues(0,0),this.previousAngle=0,this.velocity=vec2.fromValues(0,0),options.velocity&&vec2.copy(this.velocity,options.velocity),this.vlambda=vec2.fromValues(0,0),this.wlambda=0,this.angle=options.angle||0,this.angularVelocity=options.angularVelocity||0,this.force=vec2.create(),options.force&&vec2.copy(this.force,options.force),this.angularForce=options.angularForce||0,this.damping="number"==typeof options.damping?options.damping:.1,this.angularDamping="number"==typeof options.angularDamping?options.angularDamping:.1,this.type=Body.STATIC,"undefined"!=typeof options.type?this.type=options.type:options.mass?this.type=Body.DYNAMIC:this.type=Body.STATIC,this.boundingRadius=0,this.aabb=new AABB,this.aabbNeedsUpdate=!0,this.allowSleep=!0,this.wantsToSleep=!1,this.sleepState=Body.AWAKE,this.sleepSpeedLimit=.2,this.sleepTimeLimit=1,this.gravityScale=1,this.timeLastSleepy=0,this.concavePath=null,this.lastDampingScale=1,this.lastAngularDampingScale=1,this.lastDampingTimeStep=-1,this._wakeUpAfterNarrowphase=!1,this.updateMassProperties()}var vec2=_dereq_("../math/vec2"),decomp=_dereq_("poly-decomp"),Convex=_dereq_("../shapes/Convex"),AABB=_dereq_("../collision/AABB"),EventEmitter=_dereq_("../events/EventEmitter");module.exports=Body,Body.prototype=new EventEmitter,Body._idCounter=0,Body.prototype.updateSolveMassProperties=function(){this.sleepState===Body.SLEEPING||this.type===Body.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve=0):(this.invMassSolve=this.invMass,this.invInertiaSolve=this.invInertia)},Body.prototype.setDensity=function(density){var totalArea=this.getArea();this.mass=totalArea*density,this.updateMassProperties()},Body.prototype.getArea=function(){for(var totalArea=0,i=0;i<this.shapes.length;i++)totalArea+=this.shapes[i].area;return totalArea},Body.prototype.getAABB=function(){return this.aabbNeedsUpdate&&this.updateAABB(),this.aabb};var shapeAABB=new AABB,tmp=vec2.create();Body.prototype.updateAABB=function(){for(var shapes=this.shapes,shapeOffsets=this.shapeOffsets,shapeAngles=this.shapeAngles,N=shapes.length,offset=tmp,bodyAngle=this.angle,i=0;i!==N;i++){var shape=shapes[i],angle=shapeAngles[i]+bodyAngle;vec2.rotate(offset,shapeOffsets[i],bodyAngle),vec2.add(offset,offset,this.position),shape.computeAABB(shapeAABB,offset,angle),0===i?this.aabb.copy(shapeAABB):this.aabb.extend(shapeAABB)}this.aabbNeedsUpdate=!1},Body.prototype.updateBoundingRadius=function(){for(var shapes=this.shapes,shapeOffsets=this.shapeOffsets,N=shapes.length,radius=0,i=0;i!==N;i++){var shape=shapes[i],offset=vec2.length(shapeOffsets[i]),r=shape.boundingRadius;offset+r>radius&&(radius=offset+r)}this.boundingRadius=radius},Body.prototype.addShape=function(shape,offset,angle){angle=angle||0,offset=offset?vec2.fromValues(offset[0],offset[1]):vec2.fromValues(0,0),this.shapes.push(shape),this.shapeOffsets.push(offset),this.shapeAngles.push(angle),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0},Body.prototype.removeShape=function(shape){var idx=this.shapes.indexOf(shape);return-1!==idx?(this.shapes.splice(idx,1),this.shapeOffsets.splice(idx,1),this.shapeAngles.splice(idx,1),this.aabbNeedsUpdate=!0,!0):!1},Body.prototype.updateMassProperties=function(){if(this.type===Body.STATIC||this.type===Body.KINEMATIC)this.mass=Number.MAX_VALUE,this.invMass=0,this.inertia=Number.MAX_VALUE,this.invInertia=0;else{var shapes=this.shapes,N=shapes.length,m=this.mass/N,I=0;if(this.fixedRotation)this.inertia=Number.MAX_VALUE,this.invInertia=0;else{for(var i=0;N>i;i++){var shape=shapes[i],r2=vec2.squaredLength(this.shapeOffsets[i]),Icm=shape.computeMomentOfInertia(m);I+=Icm+m*r2}this.inertia=I,this.invInertia=I>0?1/I:0}this.invMass=1/this.mass}};var Body_applyForce_r=vec2.create();Body.prototype.applyForce=function(force,worldPoint){var r=Body_applyForce_r;vec2.sub(r,worldPoint,this.position),vec2.add(this.force,this.force,force);var rotForce=vec2.crossLength(r,force);this.angularForce+=rotForce},Body.prototype.toLocalFrame=function(out,worldPoint){vec2.toLocalFrame(out,worldPoint,this.position,this.angle)},Body.prototype.toWorldFrame=function(out,localPoint){vec2.toGlobalFrame(out,localPoint,this.position,this.angle)},Body.prototype.fromPolygon=function(path,options){options=options||{};for(var i=this.shapes.length;i>=0;--i)this.removeShape(this.shapes[i]);var p=new decomp.Polygon;if(p.vertices=path,p.makeCCW(),"number"==typeof options.removeCollinearPoints&&p.removeCollinearPoints(options.removeCollinearPoints),"undefined"==typeof options.skipSimpleCheck&&!p.isSimple())return!1;this.concavePath=p.vertices.slice(0);for(var i=0;i<this.concavePath.length;i++){var v=[0,0];vec2.copy(v,this.concavePath[i]),this.concavePath[i]=v}var convexes;convexes=options.optimalDecomp?p.decomp():p.quickDecomp();for(var cm=vec2.create(),i=0;i!==convexes.length;i++){for(var c=new Convex(convexes[i].vertices),j=0;j!==c.vertices.length;j++){var v=c.vertices[j];vec2.sub(v,v,c.centerOfMass)}vec2.scale(cm,c.centerOfMass,1),c.updateTriangles(),c.updateCenterOfMass(),c.updateBoundingRadius(),this.addShape(c,cm)}return this.adjustCenterOfMass(),this.aabbNeedsUpdate=!0,!0};var adjustCenterOfMass_tmp2=(vec2.fromValues(0,0),vec2.fromValues(0,0)),adjustCenterOfMass_tmp3=vec2.fromValues(0,0),adjustCenterOfMass_tmp4=vec2.fromValues(0,0);Body.prototype.adjustCenterOfMass=function(){var offset_times_area=adjustCenterOfMass_tmp2,sum=adjustCenterOfMass_tmp3,cm=adjustCenterOfMass_tmp4,totalArea=0;vec2.set(sum,0,0);for(var i=0;i!==this.shapes.length;i++){var s=this.shapes[i],offset=this.shapeOffsets[i];vec2.scale(offset_times_area,offset,s.area),vec2.add(sum,sum,offset_times_area),totalArea+=s.area}vec2.scale(cm,sum,1/totalArea);for(var i=0;i!==this.shapes.length;i++){var s=this.shapes[i],offset=this.shapeOffsets[i];offset||(offset=this.shapeOffsets[i]=vec2.create()),vec2.sub(offset,offset,cm)}vec2.add(this.position,this.position,cm);for(var i=0;this.concavePath&&i<this.concavePath.length;i++)vec2.sub(this.concavePath[i],this.concavePath[i],cm);this.updateMassProperties(),this.updateBoundingRadius()},Body.prototype.setZeroForce=function(){vec2.set(this.force,0,0),this.angularForce=0},Body.prototype.resetConstraintVelocity=function(){var b=this,vlambda=b.vlambda;vec2.set(vlambda,0,0),b.wlambda=0},Body.prototype.addConstraintVelocity=function(){var b=this,v=b.velocity;vec2.add(v,v,b.vlambda),b.angularVelocity+=b.wlambda},Body.prototype.applyDamping=function(dt){if(this.type===Body.DYNAMIC){dt!==this.lastDampingTimeStep&&(this.lastDampingScale=Math.pow(1-this.damping,dt),this.lastAngularDampingScale=Math.pow(1-this.angularDamping,dt),this.lastDampingTimeStep=dt);var v=this.velocity;vec2.scale(v,v,this.lastDampingScale),this.angularVelocity*=this.lastAngularDampingScale}},Body.prototype.wakeUp=function(){var s=this.sleepState;this.sleepState=Body.AWAKE,this.idleTime=0,s!==Body.AWAKE&&this.emit(Body.wakeUpEvent)},Body.prototype.sleep=function(){this.sleepState=Body.SLEEPING,this.angularVelocity=0,this.angularForce=0,vec2.set(this.velocity,0,0),vec2.set(this.force,0,0),this.emit(Body.sleepEvent)},Body.prototype.sleepTick=function(time,dontSleep,dt){if(this.allowSleep&&this.type!==Body.SLEEPING){this.wantsToSleep=!1;var speedSquared=(this.sleepState,vec2.squaredLength(this.velocity)+Math.pow(this.angularVelocity,2)),speedLimitSquared=Math.pow(this.sleepSpeedLimit,2);speedSquared>=speedLimitSquared?(this.idleTime=0,this.sleepState=Body.AWAKE):(this.idleTime+=dt,this.sleepState=Body.SLEEPY),this.idleTime>this.sleepTimeLimit&&(dontSleep?this.wantsToSleep=!0:this.sleep())}},Body.prototype.getVelocityFromPosition=function(store,timeStep){return store=store||vec2.create(),vec2.sub(store,this.position,this.previousPosition),vec2.scale(store,store,1/timeStep),store},Body.prototype.getAngularVelocityFromPosition=function(timeStep){return(this.angle-this.previousAngle)/timeStep},Body.prototype.overlaps=function(body){return this.world.overlapKeeper.bodiesAreOverlapping(this,body)},Body.sleepyEvent={type:"sleepy"},Body.sleepEvent={type:"sleep"},Body.wakeUpEvent={type:"wakeup"},Body.DYNAMIC=1,Body.STATIC=2,Body.KINEMATIC=4,Body.AWAKE=0,Body.SLEEPY=1,Body.SLEEPING=2}).call(this,_dereq_("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/objects/Body.js","/objects")},{"../collision/AABB":11,"../events/EventEmitter":29,"../math/vec2":33,"../shapes/Convex":41,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1,"poly-decomp":9}],35:[function(_dereq_,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){function LinearSpring(bodyA,bodyB,options){options=options||{},Spring.call(this,bodyA,bodyB,options),this.localAnchorA=vec2.fromValues(0,0),this.localAnchorB=vec2.fromValues(0,0),options.localAnchorA&&vec2.copy(this.localAnchorA,options.localAnchorA),options.localAnchorB&&vec2.copy(this.localAnchorB,options.localAnchorB),options.worldAnchorA&&this.setWorldAnchorA(options.worldAnchorA),options.worldAnchorB&&this.setWorldAnchorB(options.worldAnchorB);var worldAnchorA=vec2.create(),worldAnchorB=vec2.create();this.getWorldAnchorA(worldAnchorA),this.getWorldAnchorB(worldAnchorB);var worldDistance=vec2.distance(worldAnchorA,worldAnchorB);this.restLength="number"==typeof options.restLength?options.restLength:worldDistance}var vec2=_dereq_("../math/vec2"),Spring=_dereq_("./Spring");_dereq_("../utils/Utils");module.exports=LinearSpring,LinearSpring.prototype=new Spring,LinearSpring.prototype.setWorldAnchorA=function(worldAnchorA){this.bodyA.toLocalFrame(this.localAnchorA,worldAnchorA)},LinearSpring.prototype.setWorldAnchorB=function(worldAnchorB){this.bodyB.toLocalFrame(this.localAnchorB,worldAnchorB)},LinearSpring.prototype.getWorldAnchorA=function(result){this.bodyA.toWorldFrame(result,this.localAnchorA)},LinearSpring.prototype.getWorldAnchorB=function(result){this.bodyB.toWorldFrame(result,this.localAnchorB)};var applyForce_r=vec2.create(),applyForce_r_unit=vec2.create(),applyForce_u=vec2.create(),applyForce_f=vec2.create(),applyForce_worldAnchorA=vec2.create(),applyForce_worldAnchorB=vec2.create(),applyForce_ri=vec2.create(),applyForce_rj=vec2.create(),applyForce_tmp=vec2.create();LinearSpring.prototype.applyForce=function(){var k=this.stiffness,d=this.damping,l=this.restLength,bodyA=this.bodyA,bodyB=this.bodyB,r=applyForce_r,r_unit=applyForce_r_unit,u=applyForce_u,f=applyForce_f,tmp=applyForce_tmp,worldAnchorA=applyForce_worldAnchorA,worldAnchorB=applyForce_worldAnchorB,ri=applyForce_ri,rj=applyForce_rj;this.getWorldAnchorA(worldAnchorA),this.getWorldAnchorB(worldAnchorB),vec2.sub(ri,worldAnchorA,bodyA.position),vec2.sub(rj,worldAnchorB,bodyB.position),vec2.sub(r,worldAnchorB,worldAnchorA);var rlen=vec2.len(r);vec2.normalize(r_unit,r),vec2.sub(u,bodyB.velocity,bodyA.velocity),vec2.crossZV(tmp,bodyB.angularVelocity,rj),vec2.add(u,u,tmp),vec2.crossZV(tmp,bodyA.angularVelocity,ri),vec2.sub(u,u,tmp),vec2.scale(f,r_unit,-k*(rlen-l)-d*vec2.dot(u,r_unit)),vec2.sub(bodyA.force,bodyA.force,f),vec2.add(bodyB.force,bodyB.force,f);var ri_x_f=vec2.crossLength(ri,f),rj_x_f=vec2.crossLength(rj,f);bodyA.angularForce-=ri_x_f,bodyB.angularForce+=rj_x_f}}).call(this,_dereq_("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/objects/LinearSpring.js","/objects")},{"../math/vec2":33,"../utils/Utils":52,"./Spring":37,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],36:[function(_dereq_,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){function RotationalSpring(bodyA,bodyB,options){options=options||{},Spring.call(this,bodyA,bodyB,options),this.restAngle="number"==typeof options.restAngle?options.restAngle:bodyB.angle-bodyA.angle}var Spring=(_dereq_("../math/vec2"),_dereq_("./Spring"));module.exports=RotationalSpring,RotationalSpring.prototype=new Spring,RotationalSpring.prototype.applyForce=function(){var k=this.stiffness,d=this.damping,l=this.restAngle,bodyA=this.bodyA,bodyB=this.bodyB,x=bodyB.angle-bodyA.angle,u=bodyB.angularVelocity-bodyA.angularVelocity,torque=-k*(x-l)-d*u*0;bodyA.angularForce-=torque,bodyB.angularForce+=torque}}).call(this,_dereq_("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/objects/RotationalSpring.js","/objects")},{"../math/vec2":33,"./Spring":37,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],37:[function(_dereq_,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){function Spring(bodyA,bodyB,options){options=Utils.defaults(options,{stiffness:100,damping:1}),this.stiffness=options.stiffness,this.damping=options.damping,this.bodyA=bodyA,this.bodyB=bodyB}var Utils=(_dereq_("../math/vec2"),_dereq_("../utils/Utils"));module.exports=Spring,Spring.prototype.applyForce=function(){}}).call(this,_dereq_("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/objects/Spring.js","/objects")},{"../math/vec2":33,"../utils/Utils":52,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],38:[function(_dereq_,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){module.exports={AABB:_dereq_("./collision/AABB"),AngleLockEquation:_dereq_("./equations/AngleLockEquation"),Body:_dereq_("./objects/Body"),Broadphase:_dereq_("./collision/Broadphase"),Capsule:_dereq_("./shapes/Capsule"),Circle:_dereq_("./shapes/Circle"),Constraint:_dereq_("./constraints/Constraint"),ContactEquation:_dereq_("./equations/ContactEquation"),ContactMaterial:_dereq_("./material/ContactMaterial"),Convex:_dereq_("./shapes/Convex"),DistanceConstraint:_dereq_("./constraints/DistanceConstraint"),Equation:_dereq_("./equations/Equation"),EventEmitter:_dereq_("./events/EventEmitter"),FrictionEquation:_dereq_("./equations/FrictionEquation"),GearConstraint:_dereq_("./constraints/GearConstraint"),GridBroadphase:_dereq_("./collision/GridBroadphase"),GSSolver:_dereq_("./solver/GSSolver"),Heightfield:_dereq_("./shapes/Heightfield"),Line:_dereq_("./shapes/Line"),LockConstraint:_dereq_("./constraints/LockConstraint"),Material:_dereq_("./material/Material"),Narrowphase:_dereq_("./collision/Narrowphase"),NaiveBroadphase:_dereq_("./collision/NaiveBroadphase"),Particle:_dereq_("./shapes/Particle"),Plane:_dereq_("./shapes/Plane"),RevoluteConstraint:_dereq_("./constraints/RevoluteConstraint"),PrismaticConstraint:_dereq_("./constraints/PrismaticConstraint"),Rectangle:_dereq_("./shapes/Rectangle"),RotationalVelocityEquation:_dereq_("./equations/RotationalVelocityEquation"),SAPBroadphase:_dereq_("./collision/SAPBroadphase"),Shape:_dereq_("./shapes/Shape"),Solver:_dereq_("./solver/Solver"),Spring:_dereq_("./objects/Spring"),LinearSpring:_dereq_("./objects/LinearSpring"),RotationalSpring:_dereq_("./objects/RotationalSpring"),Utils:_dereq_("./utils/Utils"),World:_dereq_("./world/World"),vec2:_dereq_("./math/vec2"),version:_dereq_("../package.json").version}}).call(this,_dereq_("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/p2.js","/")},{"../package.json":10,"./collision/AABB":11,"./collision/Broadphase":12,"./collision/GridBroadphase":13,"./collision/NaiveBroadphase":14,"./collision/Narrowphase":15,"./collision/SAPBroadphase":16,"./constraints/Constraint":17,"./constraints/DistanceConstraint":18,"./constraints/GearConstraint":19,"./constraints/LockConstraint":20,"./constraints/PrismaticConstraint":21,"./constraints/RevoluteConstraint":22,"./equations/AngleLockEquation":23,"./equations/ContactEquation":24,"./equations/Equation":25,"./equations/FrictionEquation":26,"./equations/RotationalVelocityEquation":28,"./events/EventEmitter":29,"./material/ContactMaterial":30,"./material/Material":31,"./math/vec2":33,"./objects/Body":34,"./objects/LinearSpring":35,"./objects/RotationalSpring":36,"./objects/Spring":37,"./shapes/Capsule":39,"./shapes/Circle":40,"./shapes/Convex":41,"./shapes/Heightfield":42,"./shapes/Line":43,"./shapes/Particle":44,"./shapes/Plane":45,"./shapes/Rectangle":46,"./shapes/Shape":47,"./solver/GSSolver":48,"./solver/Solver":49,"./utils/Utils":52,"./world/World":56,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],39:[function(_dereq_,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){function Capsule(length,radius){this.length=length||1,this.radius=radius||1,Shape.call(this,Shape.CAPSULE)}var Shape=_dereq_("./Shape"),vec2=_dereq_("../math/vec2");module.exports=Capsule,Capsule.prototype=new Shape,Capsule.prototype.computeMomentOfInertia=function(mass){var r=this.radius,w=this.length+r,h=2*r;return mass*(h*h+w*w)/12},Capsule.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius+this.length/2},Capsule.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius+2*this.radius*this.length};var r=vec2.create();Capsule.prototype.computeAABB=function(out,position,angle){var radius=this.radius;vec2.set(r,this.length/2,0),0!==angle&&vec2.rotate(r,r,angle),vec2.set(out.upperBound,Math.max(r[0]+radius,-r[0]+radius),Math.max(r[1]+radius,-r[1]+radius)),vec2.set(out.lowerBound,Math.min(r[0]-radius,-r[0]-radius),Math.min(r[1]-radius,-r[1]-radius)),vec2.add(out.lowerBound,out.lowerBound,position),vec2.add(out.upperBound,out.upperBound,position)}}).call(this,_dereq_("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/shapes/Capsule.js","/shapes")},{"../math/vec2":33,"./Shape":47,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],40:[function(_dereq_,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){function Circle(radius){this.radius=radius||1,Shape.call(this,Shape.CIRCLE)}var Shape=_dereq_("./Shape"),vec2=_dereq_("../math/vec2");module.exports=Circle,Circle.prototype=new Shape,Circle.prototype.computeMomentOfInertia=function(mass){var r=this.radius;return mass*r*r/2},Circle.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius},Circle.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius},Circle.prototype.computeAABB=function(out,position,angle){var r=this.radius;vec2.set(out.upperBound,r,r),vec2.set(out.lowerBound,-r,-r),position&&(vec2.add(out.lowerBound,out.lowerBound,position),vec2.add(out.upperBound,out.upperBound,position))}}).call(this,_dereq_("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/shapes/Circle.js","/shapes")},{"../math/vec2":33,"./Shape":47,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],41:[function(_dereq_,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){function Convex(vertices,axes){this.vertices=[],this.axes=[];for(var i=0;i<vertices.length;i++){var v=vec2.create();vec2.copy(v,vertices[i]),this.vertices.push(v)}if(axes)for(var i=0;i<axes.length;i++){var axis=vec2.create();vec2.copy(axis,axes[i]),this.axes.push(axis)}else for(var i=0;i<vertices.length;i++){var worldPoint0=vertices[i],worldPoint1=vertices[(i+1)%vertices.length],normal=vec2.create();vec2.sub(normal,worldPoint1,worldPoint0),vec2.rotate90cw(normal,normal),vec2.normalize(normal,normal),this.axes.push(normal)}if(this.centerOfMass=vec2.fromValues(0,0),this.triangles=[],this.vertices.length&&(this.updateTriangles(),this.updateCenterOfMass()),this.boundingRadius=0,Shape.call(this,Shape.CONVEX),this.updateBoundingRadius(),this.updateArea(),this.area<0)throw new Error("Convex vertices must be given in conter-clockwise winding.")}var Shape=_dereq_("./Shape"),vec2=_dereq_("../math/vec2"),polyk=_dereq_("../math/polyk");_dereq_("poly-decomp");module.exports=Convex,Convex.prototype=new Shape;var tmpVec1=vec2.create(),tmpVec2=vec2.create();Convex.prototype.projectOntoLocalAxis=function(localAxis,result){for(var v,value,max=null,min=null,localAxis=tmpVec1,i=0;i<this.vertices.length;i++)v=this.vertices[i],value=vec2.dot(v,localAxis),(null===max||value>max)&&(max=value),(null===min||min>value)&&(min=value);if(min>max){var t=min;min=max,max=t}vec2.set(result,min,max)},Convex.prototype.projectOntoWorldAxis=function(localAxis,shapeOffset,shapeAngle,result){var worldAxis=tmpVec2;this.projectOntoLocalAxis(localAxis,result),0!==shapeAngle?vec2.rotate(worldAxis,localAxis,shapeAngle):worldAxis=localAxis;var offset=vec2.dot(shapeOffset,worldAxis);vec2.set(result,result[0]+offset,result[1]+offset)},Convex.prototype.updateTriangles=function(){this.triangles.length=0;for(var polykVerts=[],i=0;i<this.vertices.length;i++){var v=this.vertices[i];polykVerts.push(v[0],v[1])}for(var triangles=polyk.Triangulate(polykVerts),i=0;i<triangles.length;i+=3){var id1=triangles[i],id2=triangles[i+1],id3=triangles[i+2];this.triangles.push([id1,id2,id3])}};var updateCenterOfMass_centroid=vec2.create(),updateCenterOfMass_centroid_times_mass=vec2.create(),updateCenterOfMass_a=vec2.create(),updateCenterOfMass_b=vec2.create(),updateCenterOfMass_c=vec2.create();vec2.create(),vec2.create(),vec2.create(),vec2.create();Convex.prototype.updateCenterOfMass=function(){var triangles=this.triangles,verts=this.vertices,cm=this.centerOfMass,centroid=updateCenterOfMass_centroid,a=updateCenterOfMass_a,b=updateCenterOfMass_b,c=updateCenterOfMass_c,centroid_times_mass=updateCenterOfMass_centroid_times_mass;vec2.set(cm,0,0);for(var totalArea=0,i=0;i!==triangles.length;i++){var t=triangles[i],a=verts[t[0]],b=verts[t[1]],c=verts[t[2]];vec2.centroid(centroid,a,b,c);var m=Convex.triangleArea(a,b,c);totalArea+=m,vec2.scale(centroid_times_mass,centroid,m),vec2.add(cm,cm,centroid_times_mass)}vec2.scale(cm,cm,1/totalArea)},Convex.prototype.computeMomentOfInertia=function(mass){for(var denom=0,numer=0,N=this.vertices.length,j=N-1,i=0;N>i;j=i,i++){var p0=this.vertices[j],p1=this.vertices[i],a=Math.abs(vec2.crossLength(p0,p1)),b=vec2.dot(p1,p1)+vec2.dot(p1,p0)+vec2.dot(p0,p0);denom+=a*b,numer+=a}return mass/6*(denom/numer)},Convex.prototype.updateBoundingRadius=function(){for(var verts=this.vertices,r2=0,i=0;i!==verts.length;i++){var l2=vec2.squaredLength(verts[i]);l2>r2&&(r2=l2)}this.boundingRadius=Math.sqrt(r2)},Convex.triangleArea=function(a,b,c){return.5*((b[0]-a[0])*(c[1]-a[1])-(c[0]-a[0])*(b[1]-a[1]))},Convex.prototype.updateArea=function(){this.updateTriangles(),this.area=0;for(var triangles=this.triangles,verts=this.vertices,i=0;i!==triangles.length;i++){var t=triangles[i],a=verts[t[0]],b=verts[t[1]],c=verts[t[2]],m=Convex.triangleArea(a,b,c);this.area+=m}},Convex.prototype.computeAABB=function(out,position,angle){out.setFromPoints(this.vertices,position,angle,0)}}).call(this,_dereq_("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/shapes/Convex.js","/shapes")},{"../math/polyk":32,"../math/vec2":33,"./Shape":47,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1,"poly-decomp":9}],42:[function(_dereq_,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){function Heightfield(data,options){if(options=Utils.defaults(options,{maxValue:null,minValue:null,elementWidth:.1}),null===options.minValue||null===options.maxValue){options.maxValue=data[0],options.minValue=data[0];for(var i=0;i!==data.length;i++){var v=data[i];v>options.maxValue&&(options.maxValue=v),v<options.minValue&&(options.minValue=v)}}this.data=data,this.maxValue=options.maxValue,this.minValue=options.minValue,this.elementWidth=options.elementWidth,Shape.call(this,Shape.HEIGHTFIELD)}var Shape=_dereq_("./Shape"),Utils=(_dereq_("../math/vec2"),_dereq_("../utils/Utils"));module.exports=Heightfield,Heightfield.prototype=new Shape,Heightfield.prototype.computeMomentOfInertia=function(mass){return Number.MAX_VALUE},Heightfield.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},Heightfield.prototype.updateArea=function(){for(var data=this.data,area=0,i=0;i<data.length-1;i++)area+=(data[i]+data[i+1])/2*this.elementWidth;this.area=area},Heightfield.prototype.computeAABB=function(out,position,angle){out.upperBound[0]=this.elementWidth*this.data.length+position[0],out.upperBound[1]=this.maxValue+position[1],out.lowerBound[0]=position[0],out.lowerBound[1]=-Number.MAX_VALUE}}).call(this,_dereq_("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/shapes/Heightfield.js","/shapes")},{"../math/vec2":33,"../utils/Utils":52,"./Shape":47,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],43:[function(_dereq_,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){function Line(length){this.length=length||1,Shape.call(this,Shape.LINE)}var Shape=_dereq_("./Shape"),vec2=_dereq_("../math/vec2");module.exports=Line,Line.prototype=new Shape,Line.prototype.computeMomentOfInertia=function(mass){return mass*Math.pow(this.length,2)/12},Line.prototype.updateBoundingRadius=function(){this.boundingRadius=this.length/2};var points=[vec2.create(),vec2.create()];Line.prototype.computeAABB=function(out,position,angle){var l2=this.length/2;vec2.set(points[0],-l2,0),vec2.set(points[1],l2,0),out.setFromPoints(points,position,angle,0)}}).call(this,_dereq_("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/shapes/Line.js","/shapes")},{"../math/vec2":33,"./Shape":47,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],44:[function(_dereq_,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){function Particle(){Shape.call(this,Shape.PARTICLE)}var Shape=_dereq_("./Shape"),vec2=_dereq_("../math/vec2");module.exports=Particle,Particle.prototype=new Shape,Particle.prototype.computeMomentOfInertia=function(mass){return 0},Particle.prototype.updateBoundingRadius=function(){this.boundingRadius=0},Particle.prototype.computeAABB=function(out,position,angle){vec2.copy(out.lowerBound,position),vec2.copy(out.upperBound,position)}}).call(this,_dereq_("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/shapes/Particle.js","/shapes")},{"../math/vec2":33,"./Shape":47,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],45:[function(_dereq_,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){function Plane(){Shape.call(this,Shape.PLANE)}var Shape=_dereq_("./Shape"),vec2=_dereq_("../math/vec2");_dereq_("../utils/Utils");module.exports=Plane,Plane.prototype=new Shape,Plane.prototype.computeMomentOfInertia=function(mass){return 0},Plane.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},Plane.prototype.computeAABB=function(out,position,angle){var a=0,set=vec2.set;"number"==typeof angle&&(a=angle%(2*Math.PI)),0===a?(set(out.lowerBound,-Number.MAX_VALUE,-Number.MAX_VALUE),set(out.upperBound,Number.MAX_VALUE,0)):a===Math.PI/2?(set(out.lowerBound,0,-Number.MAX_VALUE),set(out.upperBound,Number.MAX_VALUE,Number.MAX_VALUE)):a===Math.PI?(set(out.lowerBound,-Number.MAX_VALUE,0),set(out.upperBound,Number.MAX_VALUE,Number.MAX_VALUE)):a===3*Math.PI/2?(set(out.lowerBound,-Number.MAX_VALUE,-Number.MAX_VALUE),set(out.upperBound,0,Number.MAX_VALUE)):(set(out.lowerBound,-Number.MAX_VALUE,-Number.MAX_VALUE),set(out.upperBound,Number.MAX_VALUE,Number.MAX_VALUE)),vec2.add(out.lowerBound,out.lowerBound,position),vec2.add(out.upperBound,out.upperBound,position)},Plane.prototype.updateArea=function(){this.area=Number.MAX_VALUE}}).call(this,_dereq_("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/shapes/Plane.js","/shapes");
},{"../math/vec2":33,"../utils/Utils":52,"./Shape":47,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],46:[function(_dereq_,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){function Rectangle(width,height){this.width=width||1,this.height=height||1;var verts=[vec2.fromValues(-width/2,-height/2),vec2.fromValues(width/2,-height/2),vec2.fromValues(width/2,height/2),vec2.fromValues(-width/2,height/2)],axes=[vec2.fromValues(1,0),vec2.fromValues(0,1)];Convex.call(this,verts,axes),this.type=Shape.RECTANGLE}var vec2=_dereq_("../math/vec2"),Shape=_dereq_("./Shape"),Convex=_dereq_("./Convex");module.exports=Rectangle,Rectangle.prototype=new Convex([]),Rectangle.prototype.computeMomentOfInertia=function(mass){var w=this.width,h=this.height;return mass*(h*h+w*w)/12},Rectangle.prototype.updateBoundingRadius=function(){var w=this.width,h=this.height;this.boundingRadius=Math.sqrt(w*w+h*h)/2};vec2.create(),vec2.create(),vec2.create(),vec2.create();Rectangle.prototype.computeAABB=function(out,position,angle){out.setFromPoints(this.vertices,position,angle,0)},Rectangle.prototype.updateArea=function(){this.area=this.width*this.height}}).call(this,_dereq_("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/shapes/Rectangle.js","/shapes")},{"../math/vec2":33,"./Convex":41,"./Shape":47,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],47:[function(_dereq_,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){function Shape(type){this.type=type,this.id=Shape.idCounter++,this.boundingRadius=0,this.collisionGroup=1,this.collisionMask=1,type&&this.updateBoundingRadius(),this.material=null,this.area=0,this.sensor=!1,this.updateArea()}module.exports=Shape,Shape.idCounter=0,Shape.CIRCLE=1,Shape.PARTICLE=2,Shape.PLANE=4,Shape.CONVEX=8,Shape.LINE=16,Shape.RECTANGLE=32,Shape.CAPSULE=64,Shape.HEIGHTFIELD=128,Shape.prototype.computeMomentOfInertia=function(mass){throw new Error("Shape.computeMomentOfInertia is not implemented in this Shape...")},Shape.prototype.updateBoundingRadius=function(){throw new Error("Shape.updateBoundingRadius is not implemented in this Shape...")},Shape.prototype.updateArea=function(){},Shape.prototype.computeAABB=function(out,position,angle){}}).call(this,_dereq_("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/shapes/Shape.js","/shapes")},{"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],48:[function(_dereq_,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){function GSSolver(options){Solver.call(this,options,Solver.GS),options=options||{},this.iterations=options.iterations||10,this.tolerance=options.tolerance||1e-10,this.arrayStep=30,this.lambda=new Utils.ARRAY_TYPE(this.arrayStep),this.Bs=new Utils.ARRAY_TYPE(this.arrayStep),this.invCs=new Utils.ARRAY_TYPE(this.arrayStep),this.useZeroRHS=!1,this.frictionIterations=0,this.usedIterations=0}function setArrayZero(array){for(var l=array.length;l--;)array[l]=0}var vec2=_dereq_("../math/vec2"),Solver=_dereq_("./Solver"),Utils=_dereq_("../utils/Utils"),FrictionEquation=_dereq_("../equations/FrictionEquation");module.exports=GSSolver,GSSolver.prototype=new Solver,GSSolver.prototype.solve=function(h,world){this.sortEquations();var iter=0,maxIter=this.iterations,maxFrictionIter=this.frictionIterations,equations=this.equations,Neq=equations.length,tolSquared=Math.pow(this.tolerance*Neq,2),bodies=world.bodies,Nbodies=world.bodies.length,useZeroRHS=(vec2.add,vec2.set,this.useZeroRHS),lambda=this.lambda;if(this.usedIterations=0,Neq)for(var i=0;i!==Nbodies;i++){var b=bodies[i];b.updateSolveMassProperties()}lambda.length<Neq&&(lambda=this.lambda=new Utils.ARRAY_TYPE(Neq+this.arrayStep),this.Bs=new Utils.ARRAY_TYPE(Neq+this.arrayStep),this.invCs=new Utils.ARRAY_TYPE(Neq+this.arrayStep)),setArrayZero(lambda);for(var invCs=this.invCs,Bs=this.Bs,lambda=this.lambda,i=0;i!==equations.length;i++){var c=equations[i];(c.timeStep!==h||c.needsUpdate)&&(c.timeStep=h,c.update()),Bs[i]=c.computeB(c.a,c.b,h),invCs[i]=c.computeInvC(c.epsilon)}var c,deltalambdaTot,i,j;if(0!==Neq){for(i=0;i!==Nbodies;i++){var b=bodies[i];b.resetConstraintVelocity()}if(maxFrictionIter){for(iter=0;iter!==maxFrictionIter;iter++){for(deltalambdaTot=0,j=0;j!==Neq;j++){c=equations[j];var deltalambda=GSSolver.iterateEquation(j,c,c.epsilon,Bs,invCs,lambda,useZeroRHS,h,iter);deltalambdaTot+=Math.abs(deltalambda)}if(this.usedIterations++,tolSquared>=deltalambdaTot*deltalambdaTot)break}for(GSSolver.updateMultipliers(equations,lambda,1/h),j=0;j!==Neq;j++){var eq=equations[j];if(eq instanceof FrictionEquation){for(var f=0,k=0;k!==eq.contactEquations.length;k++)f+=eq.contactEquations[k].multiplier;f*=eq.frictionCoefficient/eq.contactEquations.length,eq.maxForce=f,eq.minForce=-f}}}for(iter=0;iter!==maxIter;iter++){for(deltalambdaTot=0,j=0;j!==Neq;j++){c=equations[j];var deltalambda=GSSolver.iterateEquation(j,c,c.epsilon,Bs,invCs,lambda,useZeroRHS,h,iter);deltalambdaTot+=Math.abs(deltalambda)}if(this.usedIterations++,tolSquared>=deltalambdaTot*deltalambdaTot)break}for(i=0;i!==Nbodies;i++)bodies[i].addConstraintVelocity();GSSolver.updateMultipliers(equations,lambda,1/h)}},GSSolver.updateMultipliers=function(equations,lambda,invDt){for(var l=equations.length;l--;)equations[l].multiplier=lambda[l]*invDt},GSSolver.iterateEquation=function(j,eq,eps,Bs,invCs,lambda,useZeroRHS,dt,iter){var B=Bs[j],invC=invCs[j],lambdaj=lambda[j],GWlambda=eq.computeGWlambda(),maxForce=eq.maxForce,minForce=eq.minForce;useZeroRHS&&(B=0);var deltalambda=invC*(B-GWlambda-eps*lambdaj),lambdaj_plus_deltalambda=lambdaj+deltalambda;return minForce*dt>lambdaj_plus_deltalambda?deltalambda=minForce*dt-lambdaj:lambdaj_plus_deltalambda>maxForce*dt&&(deltalambda=maxForce*dt-lambdaj),lambda[j]+=deltalambda,eq.addToWlambda(deltalambda),deltalambda}}).call(this,_dereq_("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/solver/GSSolver.js","/solver")},{"../equations/FrictionEquation":26,"../math/vec2":33,"../utils/Utils":52,"./Solver":49,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],49:[function(_dereq_,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){function Solver(options,type){options=options||{},EventEmitter.call(this),this.type=type,this.equations=[],this.equationSortFunction=options.equationSortFunction||!1}var EventEmitter=(_dereq_("../utils/Utils"),_dereq_("../events/EventEmitter"));module.exports=Solver,Solver.prototype=new EventEmitter,Solver.prototype.solve=function(dt,world){throw new Error("Solver.solve should be implemented by subclasses!")};var mockWorld={bodies:[]};Solver.prototype.solveIsland=function(dt,island){this.removeAllEquations(),island.equations.length&&(this.addEquations(island.equations),mockWorld.bodies.length=0,island.getBodies(mockWorld.bodies),mockWorld.bodies.length&&this.solve(dt,mockWorld))},Solver.prototype.sortEquations=function(){this.equationSortFunction&&this.equations.sort(this.equationSortFunction)},Solver.prototype.addEquation=function(eq){eq.enabled&&this.equations.push(eq)},Solver.prototype.addEquations=function(eqs){for(var i=0,N=eqs.length;i!==N;i++){var eq=eqs[i];eq.enabled&&this.equations.push(eq)}},Solver.prototype.removeEquation=function(eq){var i=this.equations.indexOf(eq);-1!==i&&this.equations.splice(i,1)},Solver.prototype.removeAllEquations=function(){this.equations.length=0},Solver.GS=1,Solver.ISLAND=2}).call(this,_dereq_("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/solver/Solver.js","/solver")},{"../events/EventEmitter":29,"../utils/Utils":52,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],50:[function(_dereq_,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){function OverlapKeeper(){this.overlappingShapesLastState=new TupleDictionary,this.overlappingShapesCurrentState=new TupleDictionary,this.recordPool=[],this.tmpDict=new TupleDictionary,this.tmpArray1=[]}function OverlapKeeperRecord(bodyA,shapeA,bodyB,shapeB){this.shapeA=shapeA,this.shapeB=shapeB,this.bodyA=bodyA,this.bodyB=bodyB}var TupleDictionary=_dereq_("./TupleDictionary");_dereq_("./Utils");module.exports=OverlapKeeper,OverlapKeeper.prototype.tick=function(){for(var last=this.overlappingShapesLastState,current=this.overlappingShapesCurrentState,l=last.keys.length;l--;){var key=last.keys[l],lastObject=last.getByKey(key),currentObject=current.getByKey(key);lastObject&&!currentObject&&this.recordPool.push(lastObject)}last.reset(),last.copy(current),current.reset()},OverlapKeeper.prototype.setOverlapping=function(bodyA,shapeA,bodyB,shapeB){var current=(this.overlappingShapesLastState,this.overlappingShapesCurrentState);if(!current.get(shapeA.id,shapeB.id)){var data;this.recordPool.length?(data=this.recordPool.pop(),data.set(bodyA,shapeA,bodyB,shapeB)):data=new OverlapKeeperRecord(bodyA,shapeA,bodyB,shapeB),current.set(shapeA.id,shapeB.id,data)}},OverlapKeeper.prototype.getNewOverlaps=function(result){return this.getDiff(this.overlappingShapesLastState,this.overlappingShapesCurrentState,result)},OverlapKeeper.prototype.getEndOverlaps=function(result){return this.getDiff(this.overlappingShapesCurrentState,this.overlappingShapesLastState,result)},OverlapKeeper.prototype.bodiesAreOverlapping=function(bodyA,bodyB){for(var current=this.overlappingShapesCurrentState,l=current.keys.length;l--;){var key=current.keys[l],data=current.data[key];if(data.bodyA===bodyA&&data.bodyB===bodyB||data.bodyA===bodyB&&data.bodyB===bodyA)return!0}return!1},OverlapKeeper.prototype.getDiff=function(dictA,dictB,result){var result=result||[],last=dictA,current=dictB;result.length=0;for(var l=current.keys.length;l--;){var key=current.keys[l],data=current.data[key];if(!data)throw new Error("Key "+key+" had no data!");var lastData=last.data[key];lastData||result.push(data)}return result},OverlapKeeper.prototype.isNewOverlap=function(shapeA,shapeB){var idA=0|shapeA.id,idB=0|shapeB.id,last=this.overlappingShapesLastState,current=this.overlappingShapesCurrentState;return!last.get(idA,idB)&&!!current.get(idA,idB)},OverlapKeeper.prototype.getNewBodyOverlaps=function(result){this.tmpArray1.length=0;var overlaps=this.getNewOverlaps(this.tmpArray1);return this.getBodyDiff(overlaps,result)},OverlapKeeper.prototype.getEndBodyOverlaps=function(result){this.tmpArray1.length=0;var overlaps=this.getEndOverlaps(this.tmpArray1);return this.getBodyDiff(overlaps,result)},OverlapKeeper.prototype.getBodyDiff=function(overlaps,result){result=result||[];for(var accumulator=this.tmpDict,l=overlaps.length;l--;){var data=overlaps[l];accumulator.set(0|data.bodyA.id,0|data.bodyB.id,data)}for(l=accumulator.keys.length;l--;){var data=accumulator.getByKey(accumulator.keys[l]);data&&result.push(data.bodyA,data.bodyB)}return accumulator.reset(),result},OverlapKeeperRecord.prototype.set=function(bodyA,shapeA,bodyB,shapeB){OverlapKeeperRecord.call(this,bodyA,shapeA,bodyB,shapeB)}}).call(this,_dereq_("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/utils/OverlapKeeper.js","/utils")},{"./TupleDictionary":51,"./Utils":52,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],51:[function(_dereq_,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){function TupleDictionary(){this.data={},this.keys=[]}var Utils=_dereq_("./Utils");module.exports=TupleDictionary,TupleDictionary.prototype.getKey=function(id1,id2){return id1=0|id1,id2=0|id2,(0|id1)===(0|id2)?-1:0|((0|id1)>(0|id2)?id1<<16|65535&id2:id2<<16|65535&id1)},TupleDictionary.prototype.getByKey=function(key){return key=0|key,this.data[key]},TupleDictionary.prototype.get=function(i,j){return this.data[this.getKey(i,j)]},TupleDictionary.prototype.set=function(i,j,value){if(!value)throw new Error("No data!");var key=this.getKey(i,j);return this.data[key]||this.keys.push(key),this.data[key]=value,key},TupleDictionary.prototype.reset=function(){for(var data=this.data,keys=this.keys,l=keys.length;l--;)delete data[keys[l]];keys.length=0},TupleDictionary.prototype.copy=function(dict){this.reset(),Utils.appendArray(this.keys,dict.keys);for(var l=dict.keys.length;l--;){var key=dict.keys[l];this.data[key]=dict.data[key]}}}).call(this,_dereq_("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/utils/TupleDictionary.js","/utils")},{"./Utils":52,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],52:[function(_dereq_,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){function Utils(){}module.exports=Utils,Utils.appendArray=function(a,b){if(b.length<15e4)a.push.apply(a,b);else for(var i=0,len=b.length;i!==len;++i)a.push(b[i])},Utils.splice=function(array,index,howmany){howmany=howmany||1;for(var i=index,len=array.length-howmany;len>i;i++)array[i]=array[i+howmany];array.length=len},"undefined"!=typeof P2_ARRAY_TYPE?Utils.ARRAY_TYPE=P2_ARRAY_TYPE:"undefined"!=typeof Float32Array?Utils.ARRAY_TYPE=Float32Array:Utils.ARRAY_TYPE=Array,Utils.extend=function(a,b){for(var key in b)a[key]=b[key]},Utils.defaults=function(options,defaults){options=options||{};for(var key in defaults)key in options||(options[key]=defaults[key]);return options}}).call(this,_dereq_("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/utils/Utils.js","/utils")},{"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],53:[function(_dereq_,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){function Island(){this.equations=[],this.bodies=[]}var Body=_dereq_("../objects/Body");module.exports=Island,Island.prototype.reset=function(){this.equations.length=this.bodies.length=0};var bodyIds=[];Island.prototype.getBodies=function(result){var bodies=result||[],eqs=this.equations;bodyIds.length=0;for(var i=0;i!==eqs.length;i++){var eq=eqs[i];-1===bodyIds.indexOf(eq.bodyA.id)&&(bodies.push(eq.bodyA),bodyIds.push(eq.bodyA.id)),-1===bodyIds.indexOf(eq.bodyB.id)&&(bodies.push(eq.bodyB),bodyIds.push(eq.bodyB.id))}return bodies},Island.prototype.wantsToSleep=function(){for(var i=0;i<this.bodies.length;i++){var b=this.bodies[i];if(b.type===Body.DYNAMIC&&!b.wantsToSleep)return!1}return!0},Island.prototype.sleep=function(){for(var i=0;i<this.bodies.length;i++){var b=this.bodies[i];b.sleep()}return!0}}).call(this,_dereq_("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/world/Island.js","/world")},{"../objects/Body":34,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],54:[function(_dereq_,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){function IslandManager(options){this._nodePool=[],this._islandPool=[],this.equations=[],this.islands=[],this.nodes=[],this.queue=[]}var Island=(_dereq_("../math/vec2"),_dereq_("./Island")),IslandNode=_dereq_("./IslandNode"),Body=_dereq_("../objects/Body");module.exports=IslandManager,IslandManager.getUnvisitedNode=function(nodes){for(var Nnodes=nodes.length,i=0;i!==Nnodes;i++){var node=nodes[i];if(!node.visited&&node.body.type===Body.DYNAMIC)return node}return!1},IslandManager.prototype.visit=function(node,bds,eqs){bds.push(node.body);for(var Neqs=node.equations.length,i=0;i!==Neqs;i++){var eq=node.equations[i];-1===eqs.indexOf(eq)&&eqs.push(eq)}},IslandManager.prototype.bfs=function(root,bds,eqs){var queue=this.queue;for(queue.length=0,queue.push(root),root.visited=!0,this.visit(root,bds,eqs);queue.length;)for(var child,node=queue.pop();child=IslandManager.getUnvisitedNode(node.neighbors);)child.visited=!0,this.visit(child,bds,eqs),child.body.type===Body.DYNAMIC&&queue.push(child)},IslandManager.prototype.split=function(world){for(var bodies=world.bodies,nodes=this.nodes,equations=this.equations;nodes.length;)this._nodePool.push(nodes.pop());for(var i=0;i!==bodies.length;i++)if(this._nodePool.length){var node=this._nodePool.pop();node.reset(),node.body=bodies[i],nodes.push(node)}else nodes.push(new IslandNode(bodies[i]));for(var k=0;k!==equations.length;k++){var eq=equations[k],i=bodies.indexOf(eq.bodyA),j=bodies.indexOf(eq.bodyB),ni=nodes[i],nj=nodes[j];ni.neighbors.push(nj),nj.neighbors.push(ni),ni.equations.push(eq),nj.equations.push(eq)}for(var islands=this.islands;islands.length;){var island=islands.pop();island.reset(),this._islandPool.push(island)}for(var child;child=IslandManager.getUnvisitedNode(nodes);){var island=this._islandPool.length?this._islandPool.pop():new Island;this.bfs(child,island.bodies,island.equations),islands.push(island)}return islands}}).call(this,_dereq_("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/world/IslandManager.js","/world")},{"../math/vec2":33,"../objects/Body":34,"./Island":53,"./IslandNode":55,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],55:[function(_dereq_,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){function IslandNode(body){this.body=body,this.neighbors=[],this.equations=[],this.visited=!1}module.exports=IslandNode,IslandNode.prototype.reset=function(){this.equations.length=0,this.neighbors.length=0,this.visited=!1,this.body=null}}).call(this,_dereq_("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/world/IslandNode.js","/world")},{"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],56:[function(_dereq_,module,exports){(function(process,global,Buffer,__argument0,__argument1,__argument2,__argument3,__filename,__dirname){function World(options){EventEmitter.apply(this),options=options||{},this.springs=[],this.bodies=[],this.disabledBodyCollisionPairs=[],this.solver=options.solver||new GSSolver,this.narrowphase=new Narrowphase(this),this.islandManager=new IslandManager,this.gravity=vec2.fromValues(0,-9.78),options.gravity&&vec2.copy(this.gravity,options.gravity),this.frictionGravity=vec2.length(this.gravity)||10,this.useWorldGravityAsFrictionGravity=!0,this.useFrictionGravityOnZeroGravity=!0,this.doProfiling=options.doProfiling||!1,this.lastStepTime=0,this.broadphase=options.broadphase||new NaiveBroadphase,this.broadphase.setWorld(this),this.constraints=[],this.defaultMaterial=new Material,this.defaultContactMaterial=new ContactMaterial(this.defaultMaterial,this.defaultMaterial),this.lastTimeStep=1/60,this.applySpringForces=!0,this.applyDamping=!0,this.applyGravity=!0,this.solveConstraints=!0,this.contactMaterials=[],this.time=0,this.stepping=!1,this.bodiesToBeRemoved=[],this.fixedStepTime=0,this.islandSplit="undefined"!=typeof options.islandSplit?!!options.islandSplit:!1,this.emitImpactEvent=!0,this._constraintIdCounter=0,this._bodyIdCounter=0,this.postStepEvent={type:"postStep"},this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.addSpringEvent={type:"addSpring",spring:null},this.impactEvent={type:"impact",bodyA:null,bodyB:null,shapeA:null,shapeB:null,contactEquation:null},this.postBroadphaseEvent={type:"postBroadphase",pairs:null},this.sleepMode=World.NO_SLEEPING,this.beginContactEvent={type:"beginContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null,contactEquations:[]},this.endContactEvent={type:"endContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null},this.preSolveEvent={type:"preSolve",contactEquations:null,frictionEquations:null},this.overlappingShapesLastState={keys:[]},this.overlappingShapesCurrentState={keys:[]},this.overlapKeeper=new OverlapKeeper}var GSSolver=_dereq_("../solver/GSSolver"),NaiveBroadphase=(_dereq_("../solver/Solver"),_dereq_("../collision/NaiveBroadphase")),vec2=_dereq_("../math/vec2"),Circle=_dereq_("../shapes/Circle"),Convex=(_dereq_("../shapes/Rectangle"),_dereq_("../shapes/Convex")),Plane=(_dereq_("../shapes/Line"),_dereq_("../shapes/Plane")),Capsule=_dereq_("../shapes/Capsule"),Particle=_dereq_("../shapes/Particle"),EventEmitter=_dereq_("../events/EventEmitter"),Body=_dereq_("../objects/Body"),Material=(_dereq_("../shapes/Shape"),_dereq_("../objects/LinearSpring"),_dereq_("../material/Material")),ContactMaterial=_dereq_("../material/ContactMaterial"),Narrowphase=(_dereq_("../constraints/DistanceConstraint"),_dereq_("../constraints/Constraint"),_dereq_("../constraints/LockConstraint"),_dereq_("../constraints/RevoluteConstraint"),_dereq_("../constraints/PrismaticConstraint"),_dereq_("../constraints/GearConstraint"),_dereq_("../../package.json"),_dereq_("../collision/Broadphase"),_dereq_("../collision/SAPBroadphase"),_dereq_("../collision/Narrowphase")),Utils=_dereq_("../utils/Utils"),OverlapKeeper=_dereq_("../utils/OverlapKeeper"),IslandManager=_dereq_("./IslandManager");_dereq_("../objects/RotationalSpring");if(module.exports=World,"undefined"==typeof performance&&(performance={}),!performance.now){var nowOffset=Date.now();performance.timing&&performance.timing.navigationStart&&(nowOffset=performance.timing.navigationStart),performance.now=function(){return Date.now()-nowOffset}}World.prototype=new Object(EventEmitter.prototype),World.NO_SLEEPING=1,World.BODY_SLEEPING=2,World.ISLAND_SLEEPING=4,World.prototype.addConstraint=function(c){this.constraints.push(c)},World.prototype.addContactMaterial=function(contactMaterial){this.contactMaterials.push(contactMaterial)},World.prototype.removeContactMaterial=function(cm){var idx=this.contactMaterials.indexOf(cm);-1!==idx&&Utils.splice(this.contactMaterials,idx,1)},World.prototype.getContactMaterial=function(materialA,materialB){for(var cmats=this.contactMaterials,i=0,N=cmats.length;i!==N;i++){var cm=cmats[i];if(cm.materialA.id===materialA.id&&cm.materialB.id===materialB.id||cm.materialA.id===materialB.id&&cm.materialB.id===materialA.id)return cm}return!1},World.prototype.removeConstraint=function(c){var idx=this.constraints.indexOf(c);-1!==idx&&Utils.splice(this.constraints,idx,1)};var step_mg=(vec2.create(),vec2.create(),vec2.create(),vec2.create(),vec2.create(),vec2.create(),vec2.create()),xiw=vec2.fromValues(0,0),xjw=vec2.fromValues(0,0),interpvelo=(vec2.fromValues(0,0),vec2.fromValues(0,0));World.prototype.step=function(dt,timeSinceLastCalled,maxSubSteps){if(maxSubSteps=maxSubSteps||10,timeSinceLastCalled=timeSinceLastCalled||0,0===timeSinceLastCalled)this.internalStep(dt),this.time+=dt;else{var internalSteps=Math.floor((this.time+timeSinceLastCalled)/dt)-Math.floor(this.time/dt);internalSteps=Math.min(internalSteps,maxSubSteps);for(var t0=performance.now(),i=0;i!==internalSteps&&(this.internalStep(dt),!(performance.now()-t0>1e3*dt));i++);this.time+=timeSinceLastCalled;for(var h=this.time%dt,h_div_dt=h/dt,j=0;j!==this.bodies.length;j++){var b=this.bodies[j];b.type!==Body.STATIC&&b.sleepState!==Body.SLEEPING?(vec2.sub(interpvelo,b.position,b.previousPosition),vec2.scale(interpvelo,interpvelo,h_div_dt),vec2.add(b.interpolatedPosition,b.position,interpvelo),b.interpolatedAngle=b.angle+(b.angle-b.previousAngle)*h_div_dt):(vec2.copy(b.interpolatedPosition,b.position),b.interpolatedAngle=b.angle)}}};var endOverlaps=[];World.prototype.internalStep=function(dt){this.stepping=!0;var t0,t1,that=this,doProfiling=this.doProfiling,Nsprings=this.springs.length,springs=this.springs,bodies=this.bodies,g=this.gravity,solver=this.solver,Nbodies=this.bodies.length,broadphase=this.broadphase,np=this.narrowphase,constraints=this.constraints,mg=step_mg,add=(vec2.scale,vec2.add),islandManager=(vec2.rotate,this.islandManager);if(this.overlapKeeper.tick(),this.lastTimeStep=dt,doProfiling&&(t0=performance.now()),this.useWorldGravityAsFrictionGravity){var gravityLen=vec2.length(this.gravity);0===gravityLen&&this.useFrictionGravityOnZeroGravity||(this.frictionGravity=gravityLen)}if(this.applyGravity)for(var i=0;i!==Nbodies;i++){var b=bodies[i],fi=b.force;b.type===Body.DYNAMIC&&b.sleepState!==Body.SLEEPING&&(vec2.scale(mg,g,b.mass*b.gravityScale),add(fi,fi,mg))}if(this.applySpringForces)for(var i=0;i!==Nsprings;i++){var s=springs[i];s.applyForce()}if(this.applyDamping)for(var i=0;i!==Nbodies;i++){var b=bodies[i];b.type===Body.DYNAMIC&&b.applyDamping(dt)}for(var result=broadphase.getCollisionPairs(this),ignoredPairs=this.disabledBodyCollisionPairs,i=ignoredPairs.length-2;i>=0;i-=2)for(var j=result.length-2;j>=0;j-=2)(ignoredPairs[i]===result[j]&&ignoredPairs[i+1]===result[j+1]||ignoredPairs[i+1]===result[j]&&ignoredPairs[i]===result[j+1])&&result.splice(j,2);var Nconstraints=constraints.length;for(i=0;i!==Nconstraints;i++){var c=constraints[i];if(!c.collideConnected)for(var j=result.length-2;j>=0;j-=2)(c.bodyA===result[j]&&c.bodyB===result[j+1]||c.bodyB===result[j]&&c.bodyA===result[j+1])&&result.splice(j,2)}this.postBroadphaseEvent.pairs=result,this.emit(this.postBroadphaseEvent),np.reset(this);for(var i=0,Nresults=result.length;i!==Nresults;i+=2)for(var bi=result[i],bj=result[i+1],k=0,Nshapesi=bi.shapes.length;k!==Nshapesi;k++)for(var si=bi.shapes[k],xi=bi.shapeOffsets[k],ai=bi.shapeAngles[k],l=0,Nshapesj=bj.shapes.length;l!==Nshapesj;l++){var sj=bj.shapes[l],xj=bj.shapeOffsets[l],aj=bj.shapeAngles[l],cm=this.defaultContactMaterial;if(si.material&&sj.material){var tmp=this.getContactMaterial(si.material,sj.material);tmp&&(cm=tmp)}this.runNarrowphase(np,bi,si,xi,ai,bj,sj,xj,aj,cm,this.frictionGravity)}for(var i=0;i!==Nbodies;i++){var body=bodies[i];body._wakeUpAfterNarrowphase&&(body.wakeUp(),body._wakeUpAfterNarrowphase=!1)}if(this.has("endContact")){this.overlapKeeper.getEndOverlaps(endOverlaps);for(var e=this.endContactEvent,l=endOverlaps.length;l--;){var data=endOverlaps[l];e.shapeA=data.shapeA,e.shapeB=data.shapeB,e.bodyA=data.bodyA,e.bodyB=data.bodyB,this.emit(e)}}var preSolveEvent=this.preSolveEvent;preSolveEvent.contactEquations=np.contactEquations,preSolveEvent.frictionEquations=np.frictionEquations,this.emit(preSolveEvent);var Nconstraints=constraints.length;for(i=0;i!==Nconstraints;i++)constraints[i].update();if(np.contactEquations.length||np.frictionEquations.length||constraints.length)if(this.islandSplit){for(islandManager.equations.length=0,Utils.appendArray(islandManager.equations,np.contactEquations),Utils.appendArray(islandManager.equations,np.frictionEquations),i=0;i!==Nconstraints;i++)Utils.appendArray(islandManager.equations,constraints[i].equations);islandManager.split(this);for(var i=0;i!==islandManager.islands.length;i++){var island=islandManager.islands[i];island.equations.length&&solver.solveIsland(dt,island)}}else{for(solver.addEquations(np.contactEquations),solver.addEquations(np.frictionEquations),i=0;i!==Nconstraints;i++)solver.addEquations(constraints[i].equations);this.solveConstraints&&solver.solve(dt,this),solver.removeAllEquations()}for(var i=0;i!==Nbodies;i++){var body=bodies[i];body.sleepState!==Body.SLEEPING&&body.type!==Body.STATIC&&World.integrateBody(body,dt)}for(var i=0;i!==Nbodies;i++)bodies[i].setZeroForce();if(doProfiling&&(t1=performance.now(),that.lastStepTime=t1-t0),this.emitImpactEvent&&this.has("impact"))for(var ev=this.impactEvent,i=0;i!==np.contactEquations.length;i++){var eq=np.contactEquations[i];eq.firstImpact&&(ev.bodyA=eq.bodyA,ev.bodyB=eq.bodyB,ev.shapeA=eq.shapeA,ev.shapeB=eq.shapeB,ev.contactEquation=eq,this.emit(ev))}if(this.sleepMode===World.BODY_SLEEPING)for(i=0;i!==Nbodies;i++)bodies[i].sleepTick(this.time,!1,dt);else if(this.sleepMode===World.ISLAND_SLEEPING&&this.islandSplit){for(i=0;i!==Nbodies;i++)bodies[i].sleepTick(this.time,!0,dt);for(var i=0;i<this.islandManager.islands.length;i++){var island=this.islandManager.islands[i];island.wantsToSleep()&&island.sleep()}}if(this.stepping=!1,this.bodiesToBeRemoved.length){for(var i=0;i!==this.bodiesToBeRemoved.length;i++)this.removeBody(this.bodiesToBeRemoved[i]);this.bodiesToBeRemoved.length=0}this.emit(this.postStepEvent)};var ib_fhMinv=vec2.create(),ib_velodt=vec2.create();World.integrateBody=function(body,dt){var minv=body.invMass,f=body.force,pos=body.position,velo=body.velocity;vec2.copy(body.previousPosition,body.position),body.previousAngle=body.angle,body.fixedRotation||(body.angularVelocity+=body.angularForce*body.invInertia*dt,body.angle+=body.angularVelocity*dt),vec2.scale(ib_fhMinv,f,dt*minv),vec2.add(velo,ib_fhMinv,velo),vec2.scale(ib_velodt,velo,dt),vec2.add(pos,pos,ib_velodt),body.aabbNeedsUpdate=!0},World.prototype.runNarrowphase=function(np,bi,si,xi,ai,bj,sj,xj,aj,cm,glen){if(0!==(si.collisionGroup&sj.collisionMask)&&0!==(sj.collisionGroup&si.collisionMask)){vec2.rotate(xiw,xi,bi.angle),vec2.rotate(xjw,xj,bj.angle),vec2.add(xiw,xiw,bi.position),
vec2.add(xjw,xjw,bj.position);var aiw=ai+bi.angle,ajw=aj+bj.angle;np.enableFriction=cm.friction>0,np.frictionCoefficient=cm.friction;var reducedMass;reducedMass=bi.type===Body.STATIC||bi.type===Body.KINEMATIC?bj.mass:bj.type===Body.STATIC||bj.type===Body.KINEMATIC?bi.mass:bi.mass*bj.mass/(bi.mass+bj.mass),np.slipForce=cm.friction*glen*reducedMass,np.restitution=cm.restitution,np.surfaceVelocity=cm.surfaceVelocity,np.frictionStiffness=cm.frictionStiffness,np.frictionRelaxation=cm.frictionRelaxation,np.stiffness=cm.stiffness,np.relaxation=cm.relaxation,np.contactSkinSize=cm.contactSkinSize;var resolver=np[si.type|sj.type],numContacts=0;if(resolver){var sensor=si.sensor||sj.sensor,numFrictionBefore=np.frictionEquations.length;numContacts=si.type<sj.type?resolver.call(np,bi,si,xiw,aiw,bj,sj,xjw,ajw,sensor):resolver.call(np,bj,sj,xjw,ajw,bi,si,xiw,aiw,sensor);var numFrictionEquations=np.frictionEquations.length-numFrictionBefore;if(numContacts){if(bi.allowSleep&&bi.type===Body.DYNAMIC&&bi.sleepState===Body.SLEEPING&&bj.sleepState===Body.AWAKE&&bj.type!==Body.STATIC){var speedSquaredB=vec2.squaredLength(bj.velocity)+Math.pow(bj.angularVelocity,2),speedLimitSquaredB=Math.pow(bj.sleepSpeedLimit,2);speedSquaredB>=2*speedLimitSquaredB&&(bi._wakeUpAfterNarrowphase=!0)}if(bj.allowSleep&&bj.type===Body.DYNAMIC&&bj.sleepState===Body.SLEEPING&&bi.sleepState===Body.AWAKE&&bi.type!==Body.STATIC){var speedSquaredA=vec2.squaredLength(bi.velocity)+Math.pow(bi.angularVelocity,2),speedLimitSquaredA=Math.pow(bi.sleepSpeedLimit,2);speedSquaredA>=2*speedLimitSquaredA&&(bj._wakeUpAfterNarrowphase=!0)}if(this.overlapKeeper.setOverlapping(bi,si,bj,sj),this.has("beginContact")&&this.overlapKeeper.isNewOverlap(si,sj)){var e=this.beginContactEvent;if(e.shapeA=si,e.shapeB=sj,e.bodyA=bi,e.bodyB=bj,e.contactEquations.length=0,"number"==typeof numContacts)for(var i=np.contactEquations.length-numContacts;i<np.contactEquations.length;i++)e.contactEquations.push(np.contactEquations[i]);this.emit(e)}if("number"==typeof numContacts&&numFrictionEquations>1)for(var i=np.frictionEquations.length-numFrictionEquations;i<np.frictionEquations.length;i++){var f=np.frictionEquations[i];f.setSlipForce(f.getSlipForce()/numFrictionEquations)}}}}},World.prototype.addSpring=function(s){this.springs.push(s),this.addSpringEvent.spring=s,this.emit(this.addSpringEvent)},World.prototype.removeSpring=function(s){var idx=this.springs.indexOf(s);-1!==idx&&Utils.splice(this.springs,idx,1)},World.prototype.addBody=function(body){-1===this.bodies.indexOf(body)&&(this.bodies.push(body),body.world=this,this.addBodyEvent.body=body,this.emit(this.addBodyEvent))},World.prototype.removeBody=function(body){if(this.stepping)this.bodiesToBeRemoved.push(body);else{body.world=null;var idx=this.bodies.indexOf(body);-1!==idx&&(Utils.splice(this.bodies,idx,1),this.removeBodyEvent.body=body,body.resetConstraintVelocity(),this.emit(this.removeBodyEvent))}},World.prototype.getBodyById=function(id){for(var bodies=this.bodies,i=0;i<bodies.length;i++){var b=bodies[i];if(b.id===id)return b}return!1},World.prototype.disableBodyCollision=function(bodyA,bodyB){this.disabledBodyCollisionPairs.push(bodyA,bodyB)},World.prototype.enableBodyCollision=function(bodyA,bodyB){for(var pairs=this.disabledBodyCollisionPairs,i=0;i<pairs.length;i+=2)if(pairs[i]===bodyA&&pairs[i+1]===bodyB||pairs[i+1]===bodyA&&pairs[i]===bodyB)return void pairs.splice(i,2)},World.prototype.clear=function(){this.time=0,this.fixedStepTime=0,this.solver&&this.solver.equations.length&&this.solver.removeAllEquations();for(var cs=this.constraints,i=cs.length-1;i>=0;i--)this.removeConstraint(cs[i]);for(var bodies=this.bodies,i=bodies.length-1;i>=0;i--)this.removeBody(bodies[i]);for(var springs=this.springs,i=springs.length-1;i>=0;i--)this.removeSpring(springs[i]);for(var cms=this.contactMaterials,i=cms.length-1;i>=0;i--)this.removeContactMaterial(cms[i]);World.apply(this)},World.prototype.clone=function(){var world=new World;return world.fromJSON(this.toJSON()),world};var hitTest_tmp1=vec2.create(),hitTest_zero=vec2.fromValues(0,0),hitTest_tmp2=vec2.fromValues(0,0);World.prototype.hitTest=function(worldPoint,bodies,precision){precision=precision||0;var pb=new Body({position:worldPoint}),ps=new Particle,px=worldPoint,pa=0,x=hitTest_tmp1,zero=hitTest_zero,tmp=hitTest_tmp2;pb.addShape(ps);for(var n=this.narrowphase,result=[],i=0,N=bodies.length;i!==N;i++)for(var b=bodies[i],j=0,NS=b.shapes.length;j!==NS;j++){var s=b.shapes[j],offset=b.shapeOffsets[j]||zero,angle=b.shapeAngles[j]||0;vec2.rotate(x,offset,b.angle),vec2.add(x,x,b.position);var a=angle+b.angle;(s instanceof Circle&&n.circleParticle(b,s,x,a,pb,ps,px,pa,!0)||s instanceof Convex&&n.particleConvex(pb,ps,px,pa,b,s,x,a,!0)||s instanceof Plane&&n.particlePlane(pb,ps,px,pa,b,s,x,a,!0)||s instanceof Capsule&&n.particleCapsule(pb,ps,px,pa,b,s,x,a,!0)||s instanceof Particle&&vec2.squaredLength(vec2.sub(tmp,x,worldPoint))<precision*precision)&&result.push(b)}return result},World.prototype.setGlobalEquationParameters=function(parameters){parameters=parameters||{};for(var i=0;i!==this.constraints.length;i++)for(var c=this.constraints[i],j=0;j!==c.equations.length;j++){var eq=c.equations[j];"undefined"!=typeof parameters.stiffness&&(eq.stiffness=parameters.stiffness),"undefined"!=typeof parameters.relaxation&&(eq.relaxation=parameters.relaxation),eq.needsUpdate=!0}for(var i=0;i!==this.contactMaterials.length;i++){var c=this.contactMaterials[i];"undefined"!=typeof parameters.stiffness&&(c.stiffness=parameters.stiffness,c.frictionStiffness=parameters.stiffness),"undefined"!=typeof parameters.relaxation&&(c.relaxation=parameters.relaxation,c.frictionRelaxation=parameters.relaxation)}var c=this.defaultContactMaterial;"undefined"!=typeof parameters.stiffness&&(c.stiffness=parameters.stiffness,c.frictionStiffness=parameters.stiffness),"undefined"!=typeof parameters.relaxation&&(c.relaxation=parameters.relaxation,c.frictionRelaxation=parameters.relaxation)},World.prototype.setGlobalStiffness=function(stiffness){this.setGlobalEquationParameters({stiffness:stiffness})},World.prototype.setGlobalRelaxation=function(relaxation){this.setGlobalEquationParameters({relaxation:relaxation})}}).call(this,_dereq_("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/world/World.js","/world")},{"../../package.json":10,"../collision/Broadphase":12,"../collision/NaiveBroadphase":14,"../collision/Narrowphase":15,"../collision/SAPBroadphase":16,"../constraints/Constraint":17,"../constraints/DistanceConstraint":18,"../constraints/GearConstraint":19,"../constraints/LockConstraint":20,"../constraints/PrismaticConstraint":21,"../constraints/RevoluteConstraint":22,"../events/EventEmitter":29,"../material/ContactMaterial":30,"../material/Material":31,"../math/vec2":33,"../objects/Body":34,"../objects/LinearSpring":35,"../objects/RotationalSpring":36,"../shapes/Capsule":39,"../shapes/Circle":40,"../shapes/Convex":41,"../shapes/Line":43,"../shapes/Particle":44,"../shapes/Plane":45,"../shapes/Rectangle":46,"../shapes/Shape":47,"../solver/GSSolver":48,"../solver/Solver":49,"../utils/OverlapKeeper":50,"../utils/Utils":52,"./IslandManager":54,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}]},{},[38])(38)});var alex={VERSION:2.3986};console.log("alex.js - version "+alex.VERSION),alex.load={},alex.utils={},alex.display={},alex.ui={},alex.motion={},alex.screens={},alex.audio={},alex.game={},alex.statics={DEFAULT_W:568,DEFAULT_H:320,STAGE_W:568,STAGE_H:320,MIN_W:480,MIN_H:320,SCALE_FACTOR:1,PIXEL_RATIO:1,USE_WIDTH:!1,CONTENT_SCALE:1,FONT:"Arial",BG_COLOR:"#000000",IFRAME_MODE:2,RES_2_MIN_H:320,RES_2_MIN_W:640,MAX_RESOLUTON:2,LOG_ASSET_LOAD:!1,MUTE_STATE:!1,CHECK_ORIENTATION:!0,LOG_ENABLED:!0,FULLSCREEN_ENABLED:!0,DESKTOP_FULLSCREEN:!1,DESKTOP_RESIZE:!0,WEB_AUDIO_ENABLED:!0,WEB_GL_ENABLED:!0,AUDIO_ENABLED:!0,XHR_LOAD_ENABLED:!0,FORCE_SD:!1,copy:function(vars){for(var s in vars)vars.hasOwnProperty(s)&&(this[s]=vars[s]);vars.ROOT_DIR&&this.setRootDir(vars.ROOT_DIR)},setIpad:function(){this.DEFAULT_W=this.STAGE_W=512,this.DEFAULT_H=this.STAGE_H=384,this.MIN_W=512,this.MIN_H=288},setIphone:function(){this.DEFAULT_W=this.STAGE_W=568,this.DEFAULT_H=this.STAGE_H=320,this.MIN_W=480,this.MIN_H=320},setSD:function(){this.SCALE_FACTOR=.5,this.STAGE_H*=this.SCALE_FACTOR,this.STAGE_W*=this.SCALE_FACTOR},setHD:function(){this.SCALE_FACTOR=1,this.STAGE_H=this.DEFAULT_H,this.STAGE_W=this.DEFAULT_W,console.log("setHD!")},setRootDir:function(root){var lastChar=root.charAt(root.length-1);"/"!=lastChar&&(root+="/"),this.IMG_DIR=root+"img/",this.SND_DIR=root+"snd/",this.JSON_DIR=root+"json/",this.ANIM_DIR=root+"animation/",this.FONT_DIR=root+"font/"}},alex.statics.IMG_DIR="./img/",alex.statics.SND_DIR="./snd/",alex.statics.JSON_DIR="./json/",alex.statics.ANIM_DIR="./animation/",alex.statics.FONT_DIR="./font/",alex.events={NEXT_SCREEN:"next_screen",NEW_SCREEN:"new_screen",COMPLETE:"complete",LOADED:"loaded",PROGRESS:"progress",GAME_EVENT:"game_event"},game_shell.Keys={_pressed:{},LEFT_KEY:37,ENTER_KEY:13,UP_KEY:38,RIGHT_KEY:39,DOWN_KEY:40,SPACE_KEY:32,SHIFT_KEY:16,UP:0,JUST_PRESSED:1,DOWN:2,onKeydown:function(event){this._pressed[event.keyCode]||(this._pressed[event.keyCode]=this.JUST_PRESSED);var evt=event||window.event;void 0!==evt.stopPropagation?evt.stopPropagation():evt.cancelBubble=!0,evt.preventDefault&&evt.preventDefault()},onKeyup:function(event){delete this._pressed[event.keyCode];var evt=event||window.event;void 0!==evt.stopPropagation?evt.stopPropagation():evt.cancelBubble=!0,evt.preventDefault&&evt.preventDefault()},update:function(dt){for(var s in this._pressed)this._pressed.hasOwnProperty(s)&&this._pressed[s]===this.JUST_PRESSED&&(this._pressed[s]=this.DOWN)},clear:function(){for(var s in this._pressed)this._pressed.hasOwnProperty(s)&&delete this._pressed[s]},enable:function(bool){this.boundKeyUp||(this.boundKeyUp=this.onKeyup.bind(this)),this.boundKeyDown||(this.boundKeyDown=this.onKeydown.bind(this));var isIframe=window.parent!==window,w=isIframe?document:window;w.removeEventListener("keyup",this.boundKeyUp),w.removeEventListener("keydown",this.boundKeyDown),bool?(w.addEventListener("keyup",this.boundKeyUp,!1),w.addEventListener("keydown",this.boundKeyDown,!1),isIframe&&window.focus()):this.clear()},isDown:function(keyCode){return this._pressed[keyCode]>0},wasPressed:function(keyCode){return this._pressed[keyCode]===this.JUST_PRESSED},keyState:function(code){return this._pressed[code]||this.UP}},game_shell.KeyListener=function(){},game_shell.KeyListener.prototype=Object.create(game_shell.Keys),game_shell.KeyListener.prototype.constructor=game_shell.KeyListener,alex.utils.EventDispatcher=function(){},alex.utils.EventDispatcher.prototype={constructor:alex.utils.EventDispatcher,apply:function(object){object.addEventListener=alex.utils.EventDispatcher.prototype.addEventListener,object.on=alex.utils.EventDispatcher.prototype.addEventListener,object.hasEventListener=alex.utils.EventDispatcher.prototype.hasEventListener,object.has=alex.utils.EventDispatcher.prototype.hasEventListener,object.removeEventListener=alex.utils.EventDispatcher.prototype.removeEventListener,object.off=alex.utils.EventDispatcher.prototype.removeEventListener,object.removeEventListeners=alex.utils.EventDispatcher.prototype.removeEventListeners,object.offAll=alex.utils.EventDispatcher.prototype.removeEventListeners,object.dispatchEvent=alex.utils.EventDispatcher.prototype.dispatchEvent,object.emit=alex.utils.EventDispatcher.prototype.dispatchEvent},addEventListener:function(type,listener){void 0===this._listeners&&(this._listeners={});var listeners=this._listeners;void 0===listeners[type]&&(listeners[type]=[]),-1===listeners[type].indexOf(listener)&&listeners[type].push(listener)},hasEventListener:function(type,listener){if(void 0===this._listeners)return!1;var listeners=this._listeners;return void 0!==listeners[type]&&-1!==listeners[type].indexOf(listener)?!0:!1},removeEventListener:function(type,listener){if(void 0!==this._listeners){var listeners=this._listeners,index=listeners[type].indexOf(listener);-1!==index&&listeners[type].splice(index,1)}},removeEventListeners:function(){if(void 0!==this._listeners){var listeners=this._listeners;for(var s in listeners)delete listeners[s]}},dispatchEvent:function(event){if(void 0!==this._listeners){var listeners=this._listeners,listenerArray=listeners[event.type];if(void 0!==listenerArray){event.target=this;for(var i=0,l=listenerArray.length;l>i;i++)listenerArray[i].call(this,event)}}},dispose:function(){void 0!==this._listeners&&(this._listeners.length=0,this._listeners=null)}},alex.utils.EventDispatcher.prototype.on=alex.utils.EventDispatcher.prototype.addEventListener,alex.utils.EventDispatcher.prototype.emit=alex.utils.EventDispatcher.prototype.dispatchEvent,alex.utils.EventDispatcher.prototype.has=alex.utils.EventDispatcher.prototype.hasEventListener,alex.utils.EventDispatcher.prototype.off=alex.utils.EventDispatcher.prototype.removeEventListener,alex.utils.EventDispatcher.prototype.offAll=alex.utils.EventDispatcher.prototype.removeEventListeners,alex.utils.EventQueue=function(){alex.utils.EventDispatcher.call(this),this.queue=[],this.queueEvent=function(event){this.queue[this.queue.length]=event},this.dispatchQueuedEvents=this.update=function(delta){for(;this.queue.length>0;)this.dispatchEvent(this.queue.shift())}},alex.utils.EventQueue.prototype=Object.create(alex.utils.EventDispatcher.prototype),alex.utils.EventQueue.prototype.constructor=alex.utils.EventQueue,alex.utils.Randomise={HOLDER:[],randomise:function(p_list){this.HOLDER.length=0;var i,l_nItems=p_list.length;for(i=0;l_nItems>i;i++)this.HOLDER[i]=p_list[i];for(p_list.length=0;this.HOLDER.length>0;){var index=this.randomInt(this.HOLDER.length-1);p_list[p_list.length]=this.HOLDER.splice(index,1)[0]}},randomisedCopy:function(p_list){for(var randomised=[],list=p_list.slice();list.length>0;){var index=this.randomInt(list.length-1);randomised[randomised.length]=list.splice(index,1)[0]}return randomised},randomNumber:function(range){return Math.random()*range},randomInRange:function(p_min,p_max){var dif=p_max-p_min;return p_min+Math.random()*dif},randomInt:function(range){return Math.floor(Math.random()*(range+1))}},alex.utils.Timer=function(p_interval,p_repeat){alex.utils.EventDispatcher.call(this),this.interval=p_interval||1e3,"undefined"!=typeof p_repeat?this.repeat=p_repeat:this.repeat=-1,this.running=!1,this.currentTime=0,this.tickCount=0,this.evt={time:0,count:0},this.onTimer=function(p_count){},this.onTimerComplete=function(){}},alex.utils.Timer.prototype=Object.create(alex.utils.EventDispatcher.prototype),alex.utils.Timer.prototype.constructor=alex.utils.Timer,alex.utils.Timer.prototype.start=function(){this.running=!0,this.currentTime=0,this.tickCount=0},alex.utils.Timer.prototype.stop=function(){this.running=!1},alex.utils.Timer.prototype.resume=function(){this.running=!0},alex.utils.Timer.prototype.reset=function(){this.running=!1,this.currentTime=0,this.tickCount=0},Object.defineProperty(alex.utils.Timer.prototype,"isComplete",{get:function(){return this.tickCount===this.repeat},set:function(value){}}),Object.defineProperty(alex.utils.Timer.prototype,"remaining",{get:function(){return this.repeat-this.tickCount},set:function(value){}}),alex.utils.Timer.prototype.update=function(elapsed){this.running&&(this.currentTime+=elapsed,this.currentTime>this.interval&&this.tick())},alex.utils.Timer.prototype.tick=function(){this.currentTime-=this.interval,this.tickCount++,this.evt.time=this.currentTime,this.evt.count=this.tickCount,this.evt.countDown=this.repeat-this.tickCount,this.evt.type="timer",this.dispatchEvent(this.evt),this.onTimer(this.tickCount),this.tickCount===this.repeat&&(this.stop(),this.evt.type="complete",this.dispatchEvent(this.evt),this.onTimerComplete())},alex.utils.Timer.prototype.dispose=function(){this.onTimer=null,this.onTimerComplete=null,alex.utils.EventDispatcher.prototype.dispose.call(this)},alex.utils.RandomTimer=function(p_interval){p_interval||(p_interval=3e3),alex.utils.Timer.call(this,p_interval),this.baseInterval=this.interval},alex.utils.RandomTimer.prototype=Object.create(alex.utils.Timer.prototype),alex.utils.RandomTimer.constructor=alex.utils.RandomTimer,alex.utils.RandomTimer.prototype.start=function(){alex.utils.Timer.prototype.start.call(this),this.currentTime=Math.floor(Math.random()*this.baseInterval)},alex.utils.RandomTimer.prototype.tick=function(){alex.utils.Timer.prototype.tick.call(this),this.interval=this.baseInterval+Math.floor(Math.random()*this.baseInterval)},alex.utils.DelayedAction=function(poolSize){var size=poolSize||50;this.createPool(size),this._actions=[]},alex.utils.DelayedAction.prototype.createPool=function(size){for(this._pool=[];size>0;)this._pool[this._pool.length]={_targetTime:-1,_callback:null},size--},alex.utils.DelayedAction.prototype._next=function(){var item=this._pool.shift();return this._pool[this._pool.length]=item,item},alex.utils.DelayedAction.prototype.delay=function(p_callback,p_ms,p_scope){var action=this._next();return action._targetTime=p_ms||-1,"undefined"!=typeof p_scope?action._callback=function(){p_callback.call(p_scope)}:action._callback=p_callback||null,this._actions[this._actions.length]=action,action},alex.utils.DelayedAction.prototype.update=function(elapsedTime){var n=this._actions.length;if(n>0){var i,action;for(i=n-1;i>-1;i--)if(action=this._actions[i],action._targetTime>0&&action._callback&&(action._targetTime-=elapsedTime,action._targetTime<=0)){var callback=action._callback;action._callback=null,action._targetTime=-1,this._actions.splice(i,1),callback()}}},alex.utils.DelayedAction.prototype.clear=function(){var n=this._actions.length;if(n>0){var i,action;for(i=n-1;i>-1;i--)action=this._actions[i],action._callback=null,action._targetTime=-1}this._actions.length=0},alex.utils.DelayedAction.prototype.dispose=function(){this.clear(),this._pool=0},alex.utils.SystemInfo=function(){this.browser=-1,this.os=-1,this.device=-1,this.browserUnknown=-1,this.browserSafari=1,this.browserIE=2,this.browserFirefox=3,this.browserChrome=4,this.browserAndroidStock=5,this.browserKindleSilk=6,this.browserOpera=7,this.deviceUnknown=-1,this.deviceDesktop=1,this.deviceMobile=2,this.osUnknown=-1,this.osWindows=1,this.osOSX=2,this.osLinux=3,this.osIOS=4,this.osAndroid=5,this.osBlackberry=6,this.osVersion=-1,this.audioType="",this.webAudio=!1},alex.utils.SystemInfo.prototype.run=function(){this._checkDevice(),this._checkAudio()},alex.utils.SystemInfo.prototype._checkDevice=function(){var systemString=navigator.userAgent;if(systemString.length>0)if(null!==systemString.match(/mobile/i)?this.device=this.deviceMobile:null!==systemString.match(/tablet/i)?this.device=this.deviceMobile:null!==systemString.match(/android/i)?this.device=this.deviceMobile:this.device=this.deviceDesktop,null!==systemString.match(/windows/i)?this.os=this.osWindows:null!==systemString.match(/iphone os/i)?this.os=this.osIOS:null!==systemString.match(/ipad/i)?this.os=this.osIOS:null!==systemString.match(/mac os x/i)?this.device===this.deviceMobile?this.os=this.osIOS:this.os=this.osOSX:null!==systemString.match(/android/i)?this.os=this.osAndroid:null!==systemString.match(/linux/i)&&(this.os=this.osLinux),null!==systemString.match(/MSIE/i)||null!==systemString.match(/rv:11.0/i)?this.browser=this.browserIE:this.os!==this.osAndroid||null===systemString.match(/samsung/i)&&null===systemString.match(/534.30/i)&&null===systemString.match(/535.19/i)?null!==systemString.match(/silk/i)||null!==systemString.match(/kindle fire/i)?this.browser=this.browserKindleSilk:null!==systemString.match(/chrome/i)?this.browser=this.browserChrome:null!==systemString.match(/CriOS/i)?this.browser=this.browserChrome:null!==systemString.match(/Firefox/i)?this.browser=this.browserFirefox:null!==systemString.match(/safari/i)&&(this.browser=this.browserSafari):this.browser=this.browserAndroidStock,this.os===this.osIOS)null!==systemString.match(/iPhone OS 5/i)?this.osVersion=5:null!==systemString.match(/iPhone OS 6/i)?this.osVersion=6:null!==systemString.match(/(iPad|iPhone);.*CPU.*OS 7_\d/i)?this.osVersion=7:null!==systemString.match(/(iPad|iPhone);.*CPU.*OS 8_\d/i)&&(this.osVersion=8);else if(this.os===this.osAndroid)try{var androidVersionString=systemString.match(/Android [\d+(?:\.\d+]{3,5}/)[0].replace("Android ","");this.osVersion=parseFloat(androidVersionString)}catch(e){this.osVersion=-1}},alex.utils.SystemInfo.prototype._checkAudio=function(){var canPlayOgg=!0;if(this.isIOS||this.browser===this.browserSafari)canPlayOgg=!1;else{var a=document.createElement("audio");canPlayOgg=!(!a.canPlayType||!a.canPlayType('audio/ogg; codecs="vorbis"').replace(/no/,""))}canPlayOgg?this.audioType=".ogg":this.audioType=".m4a",window.AudioContext?this.webAudio=!0:window.webkitAudioContext?this.webAudio=!0:this.webAudio=!1},Object.defineProperty(alex.utils.SystemInfo.prototype,"isAndroidStock",{get:function(){return this.browser===this.browserAndroidStock}}),Object.defineProperty(alex.utils.SystemInfo.prototype,"isIOS",{get:function(){return this.os===this.osIOS}}),Object.defineProperty(alex.utils.SystemInfo.prototype,"isMobile",{get:function(){return this.device===this.deviceMobile}}),Object.defineProperty(alex.utils.SystemInfo.prototype,"isDesktop",{get:function(){return this.device===this.deviceDesktop}}),Object.defineProperty(alex.utils.SystemInfo.prototype,"isAndroid",{get:function(){return this.os===this.osAndroid}}),Object.defineProperty(alex.utils.SystemInfo.prototype,"isSafari",{get:function(){return this.browser===this.browserSafari}}),Object.defineProperty(alex.utils.SystemInfo.prototype,"isMobileSafari",{get:function(){return this.os===this.osIOS&&this.isSafari}}),Object.defineProperty(alex.utils.SystemInfo.prototype,"isIE",{get:function(){return this.browser===this.browserIE}}),alex.utils.FullscreenMgr=function(){this.canvas=null,this.isMobile=!1,this.fullScreenState=!1,this.isFullScreen=!1,this.fullscreenChanged=this._fullscreenChanged.bind(this),this.goFullscreen=this._goFullscreen.bind(this)},alex.utils.FullscreenMgr.prototype.init=function(config){this.canvas=config.canvas,this.isMobile=config.isMobile,this.isAvailable=this.checkAvailable(),this.activate(this.isAvailable)},alex.utils.FullscreenMgr.prototype.activate=function(state){this.fullScreenState=state,this.canvas.removeEventListener("click",this.goFullscreen),this.canvas.removeEventListener("touchstart",this.goFullscreen),state&&(this.canvas.addEventListener("click",this.goFullscreen,!1),this.canvas.addEventListener("touchstart",this.goFullscreen,!1))},alex.utils.FullscreenMgr.prototype._goFullscreen=function(){var gameDiv=document.documentElement;gameDiv.requestFullscreen?gameDiv.requestFullscreen():gameDiv.mozRequestFullScreen?gameDiv.mozRequestFullScreen():gameDiv.webkitRequestFullscreen?gameDiv.webkitRequestFullscreen():gameDiv.msRequestFullscreen&&gameDiv.msRequestFullscreen(),this.activate(!1)},alex.utils.FullscreenMgr.prototype.reactivate=function(){this.activate(!this.isFullScreen)},alex.utils.FullscreenMgr.prototype.checkAvailable=function(){var doc=document.documentElement;doc.allowfullscreen=!0;var available=doc.requestFullscreen||doc.webkitRequestFullscreen||doc.msRequestFullscreen||doc.mozRequestFullScreen;if(available){var self=this;document.onfullscreenchange=function(event){self.fullscreenChanged(event)},document.onwebkitfullscreenchange=function(event){self.fullscreenChanged(event)},document.onmozfullscreenchange=function(event){self.fullscreenChanged(event)},document.onmsfullscreenchange=function(event){self.fullscreenChanged(event)},document.onfullscreenerror=function(event){self.fullscreenError(event)},document.onmozfullscreenerror=function(event){self.fullscreenError(event)},document.onwebkitfullscreenerror=function(event){self.fullscreenError(event)},document.onmsfullscreenerror=function(event){self.fullscreenError(event)}}return available},alex.utils.FullscreenMgr.prototype._fullscreenChanged=function(e){var fullscreenElement=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement;this.isFullScreen=null!==fullscreenElement&&"undefined"!=typeof fullscreenElement,console.log("FullscreenMg -> fullscreenChanged -- isFullScreen: "+this.isFullScreen),this.isFullScreen||this.isMobile&&this.activate(!0)},alex.utils.FullscreenMgr.prototype.fullscreenError=function(event){console.log("* !!!! fullscreenError !!! * "+event),console.log("* event.message: "+event.message),this.fullscreenChanged(null)},alex.utils.RunLoop=function(fps){this.gameLoopId=-1,this.fps=fps||60,this.interval=1e3/this.fps,this.accumulator=0,this.currentTime=0,this.gameLoop=this._gameLoop.bind(this),this.start=function(){clearInterval(this.gameLoopId),this.currentTime=Date.now(),this.gameLoopId=setInterval(this.gameLoop,this.interval)},this.stop=function(){clearInterval(this.gameLoopId)},this.updateGame=function(p_time){}},alex.utils.RunLoop.prototype._gameLoop=function(){var newTime=Date.now(),elapsed=newTime-this.currentTime;this.currentTime=newTime,this.accumulator+=elapsed;for(var chunk=this.interval;this.accumulator>chunk;)this.accumulator-=chunk,this.updateGame(chunk)},alex.utils.RenderLoop=function(p_stage){var stage=p_stage,requestId=-1;this.start=function(){this.render()},this.stop=function(){cancelAnimationFrame(requestId)},this.render=function(){stage.draw(),requestId=requestAnimationFrame(this.render)}.bind(this)},alex.utils.RenderLoopStats=function(p_stage){var stage=p_stage,requestId=-1;this.start=function(){this.render()},this.stop=function(){cancelAnimationFrame(requestId)},this.render=function(){stats.begin(),stage.draw(),stats.end(),requestId=requestAnimationFrame(this.render)}.bind(this)},alex.utils.Resolution=function(){this.resolution=1,this.minHeight2=alex.statics.RES_2_MIN_H||320,this.minHeight4=2*this.minHeight2,this.minWidth2=alex.statics.RES_2_MIN_W||512,this.minWidth4=2*this.minWidth2,this.maxResolution=alex.statics.MAX_RESOLUTON,this.pixelRatio=window.devicePixelRatio||1},alex.utils.Resolution.prototype.init=function(config){this.forceResolution=config.forceResolution,this.renderer=config.renderer||{},this.interactionManager=config.interactionManager||{},this.forceResolution>-1&&(this.resolution=this.forceResolution)},alex.utils.Resolution.prototype.setByHeight=function(){if(this.forceResolution>-1)this.resolution=this.forceResolution;else{var size=Math.round(window.innerHeight*this.pixelRatio);size<=this.minHeight2?this.resolution=1:size<=this.minHeight4?this.resolution=2:this.resolution=this.maxResolution>2?4:2}console.log("Resolution -> setResolution: "+this.resolution),this.renderer.resolution=this.resolution},alex.utils.Resolution.prototype.setByWidth=function(){if(this.forceResolution>-1)this.resolution=this.forceResolution;else{var size=Math.round(window.innerWidth*this.pixelRatio);size<=this.minWidth2?this.resolution=1:size<=this.minWidth4?this.resolution=2:this.resolution=this.maxResolution>2?4:2}console.log("Resolution -> setResolution: "+this.resolution),this.renderer.resolution=this.resolution},alex.utils.Resolution.prototype.setResolution=function(min2,min4){},alex.utils.Viewport=function(){alex.utils.EventDispatcher.call(this)},alex.utils.Viewport.prototype=Object.create(alex.utils.EventDispatcher.prototype),alex.utils.Viewport.prototype.constructor=alex.utils.Viewport,alex.utils.Viewport.prototype.IFRAME_MODE_1=1,alex.utils.Viewport.prototype.IFRAME_MODE_2=2,alex.utils.Viewport.prototype.init=function(config){this.CHECK_ORIENTATION=config.CHECK_ORIENTATION,this.DESKTOP_RESIZE=config.DESKTOP_RESIZE,this.isMobile=config.isMobile,this.DEFAULT_W=config.DEFAULT_W,this.DEFAULT_H=config.DEFAULT_H,this.MIN_W=config.MIN_W,this.MIN_H=config.MIN_H,this.rotateImg=config.rotateImg,this.gameDiv=config.gameDiv,this.pixelRatio=window.devicePixelRatio||1,this.isIframe=window.parent!==window,this.iframeMode=config.iframeMode||this.IFRAME_MODE_2,this.createSettings(config),this.initResize(),this.setScaleMode(config.scaleMode||this.settings.SCALE_MATCH_HEIGHT)},alex.utils.Viewport.prototype.resize=function(){var settings=this.getSize(),wrongOrientation=null===settings;this.emit({type:"resize",wrongOrientation:wrongOrientation,settings:settings})},alex.utils.Viewport.prototype.initResize=function(){this.resize=alex.utils.Viewport.prototype.resize.bind(this),window.addEventListener("resize",this.resize,!1),window.addEventListener("orientationchange",this.resize,!1)},alex.utils.Viewport.prototype.setScaleMode=function(mode){switch(this.settings.scaleMode=mode,this.settings.scaleMode){case this.settings.SCALE_MATCH_HEIGHT:this.setAspect=this._matchHeight;break;case this.settings.SCALE_MATCH_WIDTH:this.setAspect=this._matchWidth}},alex.utils.Viewport.prototype.createSettings=function(config){this.settings={},this.settings.windowWidth=-1,this.settings.windowHeight=-1,this.settings.width=config.STAGE_W,this.settings.height=config.STAGE_H,this.settings.scale=1,this.settings.shouldResize=this.isMobile||this.DESKTOP_RESIZE?!0:!1,this.settings.ORIENTATION_PORTRAIT=1,this.settings.ORIENTATION_LANDSCAPE=2,this.settings.ORIENTATION_ANY=3,this.settings.orientation=config.orientation||this.settings.ORIENTATION_LANDSCAPE,this.settings.SCALE_MATCH_HEIGHT=1,this.settings.SCALE_MATCH_WIDTH=2,this.settings.scaleMode=-1},Object.defineProperty(alex.utils.Viewport.prototype,"height",{get:function(){return this.settings.height}}),Object.defineProperty(alex.utils.Viewport.prototype,"width",{get:function(){return this.settings.width}}),alex.utils.Viewport.prototype.getSize=function(){var dimensions=this.checkWindowSize(),showRotate=this.checkRotation(dimensions.ww,dimensions.hh);return showRotate?null:(this.setAspect(dimensions.dstW,dimensions.dstH),this.settings)},alex.utils.Viewport.prototype.checkWindowSize=function(){var dstW,dstH;try{dstW=window.innerWidth,dstH=window.innerHeight}catch(e){return this.restoreDefaults(),null}var ww,hh,win=this.isIframe&&1===this.iframeMode?window.parent:window;try{ww=win.innerWidth,hh=win.innerHeight,dstW=ww,dstH=hh}catch(e){ww=dstW,hh=dstH}return this.settings.windowWidth=dstW,this.settings.windowHeight=dstH,{dstW:dstW,dstH:dstH,ww:ww,hh:hh}},alex.utils.Viewport.prototype.restoreDefaults=function(){this.settings.pixelWidth=this.DEFAULT_W,this.settings.pointWidth=this.DEFAULT_W,this.settings.windowWidth=this.DEFAULT_W,this.settings.pixelHeight=this.DEFAULT_H,this.settings.pointHeight=this.DEFAULT_H,this.settings.windowHeight=this.DEFAULT_H},alex.utils.Viewport.prototype._matchWidth=function(dstW,dstH){var fullW=this.DEFAULT_W,fullH=this.DEFAULT_H;this.settings.shouldResize||(dstW=fullW,dstH=fullH);var maxRatio=fullW/this.MIN_H,aspectRatio=fullW/fullH,windowAspect=dstW/dstH;this.settings.targetH=Math.ceil(dstW/aspectRatio),windowAspect>aspectRatio&&(aspectRatio=maxRatio>=windowAspect?windowAspect:maxRatio);var w=dstW,h=dstH;if(this.settings.orientation===this.settings.ORIENTATION_LANDSCAPE){var targetH=Math.ceil(dstW/aspectRatio);dstH>targetH?h=targetH:w=Math.ceil(aspectRatio*dstH)}var scale=w/fullW,stageW=Math.floor(w/scale),stageH=Math.floor(h/scale);this.settings.pixelWidth=w,this.settings.pointWidth=stageW,this.settings.pixelHeight=h,this.settings.pointHeight=stageH,this.settings.scale=scale},alex.utils.Viewport.prototype._matchHeight=function(dstW,dstH){var fullW=this.DEFAULT_W,fullH=this.DEFAULT_H;this.settings.shouldResize||(dstW=fullW,dstH=fullH);var minRatio=this.MIN_W/fullH,aspectRatio=fullW/fullH,windowAspect=dstW/dstH;aspectRatio>windowAspect&&(aspectRatio=windowAspect>=minRatio?windowAspect:minRatio);var w=dstW,h=dstH;this.settings.orientation===this.settings.ORIENTATION_LANDSCAPE&&(dstW>aspectRatio*dstH?w=Math.ceil(aspectRatio*dstH):h=Math.ceil(dstW/aspectRatio));
var scale=h/fullH,stageW=Math.floor(w/scale),stageH=Math.floor(h/scale);this.settings.pixelWidth=w,this.settings.pointWidth=stageW,this.settings.pixelHeight=h,this.settings.pointHeight=stageH,this.settings.scale=scale},alex.utils.Viewport.prototype.checkRotation=function(ww,hh){var showRotate=!1;return this.CHECK_ORIENTATION&&(this.settings.orientation===this.settings.ORIENTATION_LANDSCAPE&&hh>ww?showRotate=!0:this.settings.orientation===this.settings.ORIENTATION_PORTRAIT&&ww>hh&&(showRotate=!0)),showRotate?(this.gameDiv.style.display="none",this.rotateImg.style.display="block"):(this.rotateImg.style.display="none",this.gameDiv.style.display="block"),showRotate},alex.utils.PauseGame=function(){this.isPaused=!1,this.wrongOrientation=!1,this.pause=this._pause.bind(this),this.onResized=this._resized.bind(this)},alex.utils.PauseGame.prototype.init=function(config){this.runLoop=config.runLoop,this.renderLoop=config.renderLoop,this.sndMgr=config.sndMgr,this.initPageHidden()},alex.utils.PauseGame.prototype.initPageHidden=function(){var self=this;window.addEventListener("blur",function(){self.pause.call(self,!0)},!1),window.addEventListener("focus",function(){self.pause.call(self,!1)},!1);var hidden,visibilityChange;"undefined"!=typeof document.hidden?(hidden="hidden",visibilityChange="visibilitychange"):"undefined"!=typeof document.mozHidden?(hidden="mozHidden",visibilityChange="mozvisibilitychange"):"undefined"!=typeof document.msHidden?(hidden="msHidden",visibilityChange="msvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(hidden="webkitHidden",visibilityChange="webkitvisibilitychange"),document.addEventListener(visibilityChange,function(e){document[hidden]?self.pause.call(self,!0):self.pause.call(self,!1)})},alex.utils.PauseGame.prototype._resized=function(event){event.wrongOrientation?this.isPaused||(this.pause(!0),this.wrongOrientation=!0):(this.wrongOrientation&&this.pause(!1),this.wrongOrientation=!1)},alex.utils.PauseGame.prototype._pause=function(p_state){p_state&&!this.isPaused?(console.log("PauseGame -> "+p_state),TWEEN.pause(),this.runLoop.stop(),this.renderLoop.stop(),this.sndMgr.mute(!0),this.isPaused=!0):!p_state&&this.isPaused&&(console.log("PauseGame -> "+p_state),TWEEN.unpause(),this.runLoop.start(),this.renderLoop.start(),this.sndMgr.mute(!1),this.isPaused=!1)},alex.utils.UpdateList=function(){this.updateItems=[],this.removeItems=[]},alex.utils.UpdateList.prototype.mixin=function(target){target.updateItems=[],target.removeItems=[],target.update=alex.utils.UpdateList.prototype.update,target.addUpdateItem=alex.utils.UpdateList.prototype.addUpdateItem,target.removeUpdateItem=alex.utils.UpdateList.prototype.removeUpdateItem,target.purge=alex.utils.UpdateList.prototype.purge},alex.utils.UpdateList.prototype.update=function(p_delta){for(var item,n=this.updateItems.length,i=n-1;i>-1;i--)item=this.updateItems[i],item.update(p_delta);if(n=this.removeItems.length,n>0){for(i=0;n>i;i++)item=this.removeItems[i],this._remove(item);this.removeItems.length=0}},alex.utils.UpdateList.prototype.purge=function(p_delta){this.updateItems.length=0,this.removeItems.length=0},alex.utils.UpdateList.prototype.addUpdateItem=alex.utils.UpdateList.prototype.add=function(p_item){-1===this.updateItems.indexOf(p_item)&&(this.updateItems[this.updateItems.length]=p_item)},alex.utils.UpdateList.prototype.removeUpdateItem=alex.utils.UpdateList.prototype.remove=function(p_item){this.removeItems[this.removeItems.length]=p_item},Object.defineProperty(alex.utils.UpdateList.prototype,"length",{get:function(){return this.updateItems.length}}),alex.utils.UpdateList.prototype.removeUpdateItem=alex.utils.UpdateList.prototype._remove=function(p_item){var index=this.updateItems.indexOf(p_item);index>-1&&this.updateItems.splice(index,1)},alex.utils.SpineUtils=function(){this.jsonCache=null,this.imageLoader=null},alex.utils.SpineUtils.prototype.init=function(config){this.jsonCache=config.jsonCache,this.imageLoader=config.imageLoader},alex.utils.SpineUtils.prototype.createSpineSprite=function(spineJsonId,atlasId,p_animScale){return PIXI.AnimCache.hasOwnProperty(spineJsonId)||(Array.isArray(atlasId)?this.createMultiAtlasSprite(spineJsonId,atlasId,p_animScale):this.createSingleAtlasSprite(spineJsonId,atlasId,p_animScale)),new PIXI.Spine(spineJsonId)},alex.utils.SpineUtils.prototype.createSingleAtlasSprite=function(spineJsonId,atlasId,p_animScale){var dataString=this.generateSingleAtlas(spineJsonId,atlasId),self=this,textureLoader={load:function(page,file){page.rendererObject=self.getBaseTextureByFileName(file)}},spineAtlas=new spine.Atlas(dataString,textureLoader),attachmentLoader=new spine.AtlasAttachmentLoader(spineAtlas),spineJsonParser=new spine.SkeletonJson(attachmentLoader);spineJsonParser.scale=p_animScale||.25,PIXI.AnimCache[spineJsonId]=spineJsonParser.readSkeletonData(this.jsonCache[spineJsonId])},alex.utils.SpineUtils.prototype.createMultiAtlasSprite=function(spineJsonId,atlasIdList,p_animScale){var dataString=this.generateMultiAtlas(spineJsonId,atlasIdList),self=this,textureLoader={load:function(page,file){page.rendererObject=page.rendererObject=self.getBaseTextureByFileName(file)}},spineAtlas=new spine.Atlas(dataString,textureLoader),attachmentLoader=new spine.AtlasAttachmentLoader(spineAtlas),spineJsonParser=new spine.SkeletonJson(attachmentLoader);spineJsonParser.scale=p_animScale||.25,PIXI.AnimCache[spineJsonId]=spineJsonParser.readSkeletonData(this.jsonCache[spineJsonId])},alex.utils.SpineUtils.prototype.generateMultiAtlas=function(spineJsonId,atlasIdList){var i,atlasId,dataString="",n=atlasIdList.length;for(i=0;n>i;i++)atlasId=atlasIdList[i],dataString+=this.generateSingleAtlas(spineJsonId,atlasId,!0);return dataString},alex.utils.SpineUtils.prototype.generateSingleAtlas=function(spineJsonId,atlasId,isMulti){var skinSet,spineJsonData=this.jsonCache[spineJsonId],atlasJson=this.jsonCache[atlasId],partsList=[],skins=spineJsonData.skins;for(var s in skins)skins.hasOwnProperty(s)&&(skinSet=skins[s],this.getPartNames(skinSet,partsList));return this.generateSpineAtlas(partsList,atlasJson,isMulti)},alex.utils.SpineUtils.prototype.purge=function(){for(var s in PIXI.AnimCache)if(PIXI.AnimCache.hasOwnProperty(s)){var skeletonData=PIXI.AnimCache[s];skeletonData.purge(),delete PIXI.AnimCache[s]}},alex.utils.SpineUtils.prototype.getBaseTextureByFileName=function(imgName){var baseTexture,imgSrc=game_shell.loader.urls.pathForFile(imgName);if(PIXI.BaseTextureCache.hasOwnProperty(imgSrc))baseTexture=PIXI.BaseTextureCache[imgSrc];else{var img=this.imageLoader.getAsset(imgName);baseTexture=new PIXI.BaseTexture(img,PIXI.scaleModes.DEFAULT),-1!==imgSrc.indexOf("@2x.")?baseTexture.resolution=2:-1!==imgSrc.indexOf("@4x.")&&(baseTexture.resolution=4),baseTexture.imageUrl=imgSrc,PIXI.BaseTextureCache[imgSrc]=baseTexture}return baseTexture},alex.utils.SpineUtils.prototype.getBaseTextureForAtlas=function(atlasId){var atlasJson=this.jsonCache[atlasId],imgName=atlasJson.meta.image;return this.getBaseTextureByFileName(imgName)},alex.utils.SpineUtils.prototype.generateSpineAtlas=function(parts,atlasJson,isMulti){var i,item,frame,size,name,file,imageName=atlasJson.meta.image,spineAtlas="\n"+imageName+"\nformat: RGBA8888\nfilter: Linear,Linear\nrepeat: none\n",indent="  ",type=".png",frames=atlasJson.frames,n=parts.length;for(i=0;n>i;i++)name=parts[i],file=name+type,frames.hasOwnProperty(file)?(item=frames[file],frame=item.frame,size=item.sourceSize,spineAtlas+=name+"\n",spineAtlas+=indent+"rotate: false\n",spineAtlas+=indent+"xy: "+frame.x+", "+frame.y+"\n",spineAtlas+=indent+"size: "+size.w+", "+size.h+"\n",spineAtlas+=indent+"orig: "+size.w+", "+size.h+"\n",spineAtlas+=indent+"offset: 0, 0\n",spineAtlas+=indent+"index: -1\n"):isMulti||console.log("!!! generateSpineAtlas -> Missing frame: "+name);return spineAtlas},alex.utils.SpineUtils.prototype.getPartNames=function(itemHash,inputParts){var parts=inputParts||[];for(var s1 in itemHash){var item=itemHash[s1];for(var s2 in item)-1===parts.indexOf(s2)&&(parts[parts.length]=s2)}return parts},spine.SkeletonData.prototype.purge=function(){this.bones.length=0,this.slots.length=0,this.skins.length=0,this.events.length=0,this.animations.length=0,this.ikConstraints.length=0},alex.utils.Sequence=function(stuff,randomise){this.list=[],stuff&&this.add(stuff,randomise)},alex.utils.Sequence.prototype.add=function(stuff,randomise){if(Array.isArray(stuff)){var i,n=stuff.length;for(i=0;n>i;i++)this.list[this.list.length]=stuff[i]}else this.list[this.list.length]=stuff;randomise&&this.randomise()},alex.utils.Sequence.prototype.remove=function(stuff){var index;if(Array.isArray(stuff)){var i,item,n=stuff.length;for(i=0;n>i;i++)item=stuff[i],index=this.list.indexOf(item),index>-1&&this.list.splice(index,1)}else index=this.list.indexOf(stuff),index>-1&&this.list.splice(index,1)},alex.utils.Sequence.prototype.randomise=function(){alex.utils.Randomise.randomise(this.list)},alex.utils.Sequence.prototype.next=function(){var item=null;return this.list.length>0&&(item=this.list.shift(),this.list[this.list.length]=item),item},Object.defineProperty(alex.utils.Sequence.prototype,"length",{get:function(){return this.list.length}}),alex.load.BootStrap=function(){this.resolution=2,this.stageW=568,this.stage=null,this.barColor=16777215},alex.load.BootStrap.prototype=Object.create(alex.utils.EventDispatcher.prototype),alex.load.BootStrap.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.bundle={json:[],images:[]},this.step=this.stageW/2,this.createLoadBar(),this.defineBundle()},alex.load.BootStrap.prototype.defineBundle=function(){},alex.load.BootStrap.prototype.start=function(){this.loadJson()},alex.load.BootStrap.prototype.addJson=function(item){this.bundle.json[this.bundle.json.length]=item},alex.load.BootStrap.prototype.addImage=function(item){this.bundle.images[this.bundle.images.length]=item},alex.load.BootStrap.prototype.loadJson=function(){var items=this.bundle.json;if(0===items.length)this.loadImages();else{var loader=new alex.load.JsonQueue,self=this;loader.on("loaded",function(event){game_shell.json[event.id]=event.jsonData,self.growBar()}),loader.on("complete",function(event){self.loadImages.call(self)}),loader.load(items);var i,item,n=items.length;for(i=0;n>i;i++)item=items[i],game_shell.loader.urls.add(item)}},alex.load.BootStrap.prototype.loadImages=function(){var items=this.bundle.images,n=items.length,self=this;if(this.loadedImages=0,0===n)this.finished();else for(var i=0;n>i;i++){var item=items[i],id=item.id;game_shell.loader.urls.add(item);var baseTexture=PIXI.BaseTexture.fromImage(item.src,!1);baseTexture.hasLoaded?this.imageLoaded(baseTexture,id):baseTexture.on("loaded",function(event){self.imageLoaded(baseTexture,id)})}},alex.load.BootStrap.prototype.imageLoaded=function(baseTexture,id){this.loadedImages++;for(var item,isAtlas=!1,json=this.bundle.json,n=json.length,i=0;n>i;i++)if(item=json[i],item.id===id){isAtlas=!0;break}if(isAtlas){var atlasJson=game_shell.json[id];alex.load.ImageLoadState.prototype.addAtlasData.call(this,baseTexture,atlasJson)}else PIXI.TextureCache[id]=new PIXI.Texture(baseTexture);this.loadedImages===this.bundle.images.length&&(this.growBar(),this.finished())},alex.load.BootStrap.prototype.createLoadBar=function(){var w=10,h=20;this.bar=new alex.display.Quad(w,h,this.barColor),this.bar.x=this.stageW*-.5,this.bar.y=0,this.stage.addChild(this.bar)},alex.load.BootStrap.prototype.growBar=function(){new TWEEN.Tween(this.bar).to({width:this.bar.width+this.step},50).start()},alex.load.BootStrap.prototype.finished=function(){this.stage.removeChild(this.bar),this.emit({type:"complete"})},alex.load.ImageLoader=function(){alex.utils.EventDispatcher.call(this),this.manifest=null,this._assets={},this._srcPaths={},window.URL=window.URL||window.webkitURL,this.useXHR=!0,this.debug=!1},alex.load.ImageLoader.prototype=Object.create(alex.utils.EventDispatcher.prototype),alex.load.ImageLoader.prototype.constructor=alex.load.ImageLoader,alex.load.ImageLoader.prototype.xhrLoadSupported=function(){var isSupported=!0;if("undefined"==typeof window.URL?isSupported=!1:"undefined"==typeof window.URL.createObjectURL&&(isSupported=!1),isSupported){var sys=alex.utils.system;sys.isAndroid&&sys.osVersion<=3?isSupported=!1:sys.isIOS&&sys.osVersion<6&&(isSupported=!1)}return isSupported},alex.load.ImageLoader.prototype.load=function(items,withXHR){"undefined"!=typeof withXHR&&(this.useXHR=withXHR?!0:!1),this.xhrLoadSupported()||(this.useXHR=!1),this.numTotal=items.length,this.numLoaded=0;var item,i;for(i=0;i<this.numTotal;i++)item=items[i],item.loadState=0,this._srcPaths[item.id]=item.src;this.manifest?this.manifest=this.manifest.concat(items):this.manifest=items,this.loadNext()},alex.load.ImageLoader.prototype.findNext=function(){for(var checkObj,assetData=null,n=this.manifest.length,i=0;n>i;i++)if(checkObj=this.manifest[i],0===checkObj.loadState){assetData=checkObj;break}return assetData},alex.load.ImageLoader.prototype.loadNext=function(){var assetData=this.findNext();assetData?(this.debug&&console.log("ImageLoader -> loadNext: "+assetData.src),this.useXHR?this.loadWithXHR(assetData):this.loadNormal(assetData)):(this.manifest.length=0,this.loadComplete())},alex.load.ImageLoader.prototype.loadNormal=function(assetData){var img=new Image,self=this;return img.onload=function(){self._assets[assetData.id]=img,assetData.loadState=1,self.imageLoaded(img,assetData)},img.onerror=function(){self._assets[assetData.id]=null,console.log("ERROR - image load failed: "+assetData.src),assetData.loadState=2,self.imageLoaded(null,assetData)},img.src=assetData.src,img},alex.load.ImageLoader.prototype.loadWithXHR=function(assetData){var img=null,self=this,xhr2=new XMLHttpRequest;return xhr2.open("GET",assetData.src,!0),xhr2.responseType="arraybuffer",xhr2.send(null),xhr2.onload=function(){if(200==this.status&&4==this.readyState){var fType=self.getFileType(assetData.src);img=self.imageBase64(this.response,fType),img.onload=function(e){self._assets[assetData.id]=img;try{window.URL.revokeObjectURL(img.src)}catch(e){console.log("got an error on revoke")}assetData.loadState=1,self.imageLoaded(img,assetData)}}else(404==this.status||403==this.status)&&(console.log("404 ERROR - MISSING IMAGE! "+assetData.src),self._assets[assetData.id]=null,assetData.loadState=2,self.imageLoaded(null,assetData))},xhr2.addEventListener("progress",function(evt){if(evt.lengthComputable){var percentComplete=evt.loaded/evt.total,amount=self.numLoaded+percentComplete,progress=amount/self.numTotal;self.dispatchEvent({type:"progress",progress:progress}),self.onLoadProgress&&self.onLoadProgress(progress)}},!1),xhr2.addEventListener("error",function(event){console.log("TRANSFER ERROR LOADING IMAGE! "+assetData.src),self._assets[assetData.id]=null,assetData.loadState=2,self.imageLoaded(null,assetData)},!1),img},alex.load.ImageLoader.prototype.imageLoaded=function(p_img,p_data){this.numLoaded++;var progress=this.numLoaded/this.numTotal,success=null!==p_img;this.emit({type:"loaded",progress:progress,img:p_img,success:success,src:p_data.src,data:p_data}),this.onLoadProgress&&this.onLoadProgress(progress),this.loadNext()},alex.load.ImageLoader.prototype.loadComplete=function(){this.emit({type:"complete"}),this.onLoadComplete&&this.onLoadComplete()},alex.load.ImageLoader.prototype.getFileType=function(path){var dot=path.lastIndexOf("."),ext=path.substr(dot+1);return"png"==ext?"image/png":"jpg"==ext?"image/jpg":void 0},alex.load.ImageLoader.prototype.imageBase64=function(response,fileType){for(var uInt8Array=new Uint8Array(response),i=uInt8Array.length,binaryString=new Array(i);i--;)binaryString[i]=String.fromCharCode(uInt8Array[i]);var data=binaryString.join(""),base64=window.btoa(data),img=document.createElement("img");return img.src="data:"+fileType+";base64,"+base64,img},alex.load.ImageLoader.prototype.getAsset=function(id){return this._assets[id]},alex.load.ImageLoader.prototype.setAsset=function(id,img){this._assets[id]=img},alex.load.ImageLoader.prototype.getAssetId=function(img){var id=null;for(var s in this._assets)if(this._assets.hasOwnProperty(s)&&this._assets[s]===img){id=s;break}return id},alex.load.ImageLoader.prototype.purge=function(){this._assets={}},alex.load.ImageLoader.prototype.unloadImage=function(id){delete this._assets[id];var src=this._srcPaths[id];delete this._srcPaths[id];var baseTexture=PIXI.BaseTextureCache[src];if(baseTexture){var tx;for(var s in PIXI.TextureCache)PIXI.TextureCache.hasOwnProperty(s)&&(tx=PIXI.TextureCache[s],tx.baseTexture===baseTexture&&delete PIXI.TextureCache[s]);delete PIXI.BaseTextureCache[src],baseTexture.destroy()}},alex.load.ImageLoader.prototype.unload=function(items){var i,id,n=items.length;for(i=0;n>i;i++)id=items[i],this.unloadImage(id);this.purge()},alex.load.ManifestLoadState=function(p_bulkLoader){this.bulkLoader=p_bulkLoader,this.resolution=this.bulkLoader.resolution,this.audioType=this.bulkLoader.audioType,this.audioFolder=this.bulkLoader.audioFolder,this.manifest=null},alex.load.ManifestLoadState.prototype.load=function(){var path=this.bulkLoader.manifestPath,loader=new alex.load.JsonLoader(path),self=this;loader.addEventListener("loaded",function(event){var jsonData=event.data;self.bulkLoader.emit({type:"manifest_json",data:jsonData}),self.parseConfig.call(self,jsonData),self.bulkLoader.flow.next()}),loader.load()},alex.load.ManifestLoadState.prototype.parseConfig=function(p_data){this.manifest=p_data;var res=this.resolution.toString()+"x",fallback=1===this.resolution?"sd":"hd",bulkLoader=this.bulkLoader;bulkLoader.jsonManifest=this.getManifestSection("json_",res,fallback),this.setRoot(bulkLoader.jsonManifest,alex.statics.IMG_DIR),bulkLoader.imgManifest=this.getManifestSection("img_",res,fallback),bulkLoader.fontManifest=this.getManifestSection("bm_font_",res,fallback),this.manifest.hasOwnProperty("json")&&(this.setRoot(this.manifest.json,alex.statics.JSON_DIR),bulkLoader.jsonManifest=bulkLoader.jsonManifest.concat(this.manifest.json)),bulkLoader.imgManifest=this.setRoot(bulkLoader.imgManifest,alex.statics.IMG_DIR),bulkLoader.fontManifest=this.setRoot(bulkLoader.fontManifest,alex.statics.FONT_DIR),bulkLoader.urls.storeLookup(bulkLoader.jsonManifest),bulkLoader.urls.storeLookup(bulkLoader.imgManifest),bulkLoader.urls.storeLookup(bulkLoader.fontManifest),bulkLoader.webAudioManifest=this.parseAudio(this.manifest.snd_webaudio),bulkLoader.audioSpriteManifest=this.manifest.snd_sprite||{}},alex.load.ManifestLoadState.prototype.setRoot=function(list,root){if(!list)return[];for(var item,n=list.length,i=0;n>i;i++)item=list[i],-1===item.src.indexOf(root)&&(item.src=root+item.src);return list},alex.load.ManifestLoadState.prototype.getManifestSection=function(name,res,fallback){var list=null,nameWithResolution=name+res;return this.manifest.hasOwnProperty(nameWithResolution)?list=this.manifest[nameWithResolution]:(nameWithResolution=name+fallback,this.manifest.hasOwnProperty(nameWithResolution)&&(list=this.manifest[nameWithResolution])),list},alex.load.ManifestLoadState.prototype.parseAudio=function(input){if(!input)return[];for(var item,folder=this.audioFolder,n=input.length,i=0;n>i;i++)item=input[i],item.src=folder+item.src+this.audioType;return input},alex.load.JSONLoadState=function(p_bulkLoader,jsonCache){this.bulkLoader=p_bulkLoader,this.jsonCache=jsonCache,this.jsonLoaded=this._jsonLoaded.bind(this),this.numLoaded=0,this.numTotal=0,this.debug=!1},alex.load.JSONLoadState.prototype.unload=function(ids){var i,id,n=ids.length;for(i=0;n>i;i++)id=ids[i],delete this.jsonCache[id]},alex.load.JSONLoadState.prototype.load=function(p_debug){this.debug=p_debug===!0,this.debug&&console.log("JSONLoadState -> load");var self=this;this.queue=new alex.load.JsonQueue,this.queue.on("complete",function(){self.bulkLoader.flow.next()}),this.queue.on("loaded",this.jsonLoaded),this.queue.load(this.bulkLoader.jsonManifest)},alex.load.JSONLoadState.prototype._jsonLoaded=function(event){var filePath=event.url,assetData=this.bulkLoader.urls.getAssetData(filePath);assetData.jsonData=event.jsonData,assetData.loaded=!0,this.jsonProgress(event.numLoaded,event.numTotal);var isAtlas=assetData.jsonData.hasOwnProperty("frames")&&assetData.jsonData.hasOwnProperty("meta")||"atlas"==assetData.type;isAtlas?this.addImageToQueue(assetData.id,assetData.jsonData,filePath):"skeleton"==assetData.type||"config"==assetData.type,this.jsonCache[assetData.id]=assetData.jsonData},alex.load.JSONLoadState.prototype.jsonProgress=function(numLoaded,total){this.bulkLoader.progressTracker.progressJSON=numLoaded/total,this.bulkLoader.loadProgress()},alex.load.JSONLoadState.prototype.toString=function(){return"[JSONLoadState]"},alex.load.JSONLoadState.prototype.addImageToQueue=function(id,jsonData,jsonFilePath){for(var imgFilename=jsonData.meta.image,imgManifest=this.bulkLoader.imgManifest,n=imgManifest.length,item=null,i=0;n>i;i++)if(item=imgManifest[i],item.src.indexOf(imgFilename)>-1)return void(item.atlasData=jsonData);var data={},lastSlash=jsonFilePath.lastIndexOf("/"),folderpath=jsonFilePath.substr(0,lastSlash+1);data.src=folderpath+imgFilename,data.id=id,data.atlasData=jsonData,imgManifest[imgManifest.length]=data,this.bulkLoader.urls.add(data)},alex.load.ImageLoadState=function(p_bulkLoader,useXHR){this.bulkLoader=p_bulkLoader,this.useXHR=useXHR,this.debug=!1,this.imageLoader=alex.load.imageLoader,this.toString=function(){return"[ImageLoadState]"}},alex.load.ImageLoadState.prototype.load=function(p_debug){this.debug=p_debug===!0;var self=this;this.debug&&console.log("ImageLoadState -> load");var files=this.bulkLoader.imgManifest;0===files.length?this.bulkLoader.flow.next():(this.imageLoader.addEventListener("loaded",function(event){var img=event.img,src=event.src,data=event.data;self.debug&&console.log("ImageLoadState -> loaded: "+event.src),data.hasOwnProperty("atlasData")?self.addAtlas(img,data.atlasData,src):self.addTexture(img,src),self.bulkLoader.progressTracker.progressImages=event.progress,self.bulkLoader.loadProgress()}),this.imageLoader.addEventListener("progress",function(event){self.bulkLoader.progressTracker.progressImages=event.progress,self.bulkLoader.loadProgress()}),this.imageLoader.addEventListener("complete",function(event){self.debug&&console.log("ImageLoadState -> complete"),self.imageLoader.offAll(),self.bulkLoader.flow.next()}),this.imageLoader.load(files,this.useXHR))},alex.load.ImageLoadState.prototype.addTexture=function(img,src){if(null!==img){var baseTexture=this.createBaseTexture(img,src),texture=new PIXI.Texture(baseTexture);PIXI.TextureCache[src]=texture}},alex.load.ImageLoadState.prototype.createBaseTexture=function(img,src){var scaleMode=PIXI.scaleModes.DEFAULT,prefix2x=PIXI.RETINA_PREFIX+"."||"@2x.",prefix4x="@4x.",baseTexture=new PIXI.BaseTexture(img,scaleMode);return-1!==src.indexOf(prefix2x)?baseTexture.resolution=2:-1!==src.indexOf(prefix4x)&&(baseTexture.resolution=4),baseTexture.imageUrl=src,PIXI.BaseTextureCache[src]=baseTexture,baseTexture},alex.load.ImageLoadState.prototype.addAtlas=function(p_img,p_json,p_src){var baseTexture=this.createBaseTexture(p_img,p_src);this.addAtlasData(baseTexture,p_json)},alex.load.ImageLoadState.prototype.addAtlasData=function(baseTexture,p_json){var frameData=p_json.frames,tx=null,i=0,rect=null;if(Array.isArray(frameData)){var n=frameData.length,frameId=null,fData=null;for(i=0;n>i;i++)fData=frameData[i],rect=fData.frame,rect&&(frameId=fData.filename,tx=new PIXI.Texture(baseTexture,{x:rect.x,y:rect.y,width:rect.w,height:rect.h}),PIXI.TextureCache[frameId]=tx,fData.trimmed&&(tx.realSize=fData.sourceSize,tx.trim=new PIXI.Point,tx.trim.x=0,tx.trim.y=0))}else for(i in frameData)rect=frameData[i].frame,rect&&(tx=new PIXI.Texture(baseTexture,{x:rect.x,y:rect.y,width:rect.w,height:rect.h}),PIXI.TextureCache[i]=tx,frameData[i].trimmed&&(tx.realSize=frameData[i].sourceSize,tx.trim=new PIXI.Point,tx.trim.x=0,tx.trim.y=0))},alex.load.AudioLoadState=function(p_bulkLoader){this.bulkLoader=p_bulkLoader,this.debug=!1,this.soundLoader=alex.load.soundLoader,this.toString=function(){return"[AudioLoadState]"}},alex.load.AudioLoadState.prototype.load=function(p_debug){this.debug=p_debug===!0;var bulkLoader=this.bulkLoader,soundLoader=this.soundLoader;this.debug&&console.log("AudioLoadState -> load"),0===bulkLoader.webAudioManifest.length?bulkLoader.flow.next():(soundLoader.on("progress",function(event){bulkLoader.progressTracker.progressSounds=event.value,bulkLoader.loadProgress()}),soundLoader.on("complete",function(event){soundLoader.offAll(),bulkLoader.progressTracker.progressSounds=1,bulkLoader.loadProgress(),bulkLoader.flow.next()}),soundLoader.load(bulkLoader.webAudioManifest.slice()))},alex.load.FontLoadState=function(loader){this.bulkLoader=loader,this.debug=!1,this.loadedFonts=[]},alex.load.FontLoadState.prototype.unload=function(){var i,font,n=this.loadedFonts.length;for(i=0;n>i;i++)font=this.loadedFonts[i],this.removeFont(font)},alex.load.FontLoadState.prototype.removeFont=function(fontName){if(PIXI.BitmapText.fonts.hasOwnProperty(fontName)){var fontData=PIXI.BitmapText.fonts[fontName],chars=fontData.chars;for(var charCode in chars)chars.hasOwnProperty(charCode)&&delete PIXI.TextureCache[charCode];delete PIXI.BitmapText.fonts[fontName]}},alex.load.FontLoadState.prototype.load=function(p_debug){this.debug=p_debug===!0,this.debug&&console.log("FontLoadState -> load");var files=this.bulkLoader.fontManifest,n=files.length;if(0===n)this.bulkLoader.flow.next();else for(var numLoaded=0,loader=null,dataItem=null,crossorigin=!1,bulkLoader=this.bulkLoader,self=this,i=0;n>i;i++)dataItem=files[i],loader=new PIXI.BitmapFontLoader(dataItem.src,crossorigin),loader.addEventListener("loaded",function(event){numLoaded++,bulkLoader.progressTracker.progressFonts=numLoaded/n,bulkLoader.loadProgress(),self.loadedFonts[self.loadedFonts.length]=loader.fontName,numLoaded===n&&bulkLoader.flow.next()}),loader.load()},alex.load.FontLoadState.prototype.toString=function(){return"[FontLoadState]"},alex.load.BulkLoader=function(){alex.utils.EventDispatcher.call(this),this.resolution=game_shell.resolution,this.system=alex.utils.system,this.statics=alex.statics,this.jsonCache=game_shell.json,this.audioType=this.system.audioType,this.audioFolder=this.statics.SND_DIR,this.webAudio=this.statics.WEB_AUDIO_ENABLED&&this.system.webAudio,this.useXHR=this.statics.XHR_LOAD_ENABLED,alex.load.imageLoader=new alex.load.ImageLoader,alex.load.soundLoader=new alex.audio.SoundLoader,this.manifestLoad=new alex.load.ManifestLoadState(this),this.jsonLoad=new alex.load.JSONLoadState(this,this.jsonCache),this.imageLoad=new alex.load.ImageLoadState(this,this.useXHR),this.audioLoad=new alex.load.AudioLoadState(this),this.fontLoad=new alex.load.FontLoadState(this),this.jsonManifest=null,this.imgManifest=null,this.fontManifest=null,this.webAudioManifest=null,this.audioSpriteManifest=null,this.flow=new alex.load.LoadFlowManager(this,this.webAudio),this.urls=new alex.utils.UrlLookup,this.progressTracker=new alex.load.ProgressTracker(this.webAudio),this.toString=function(){return"[BulkLoader]"}},alex.load.BulkLoader.constructor=alex.load.BulkLoader,alex.load.BulkLoader.prototype=Object.create(alex.utils.EventDispatcher.prototype),alex.load.BulkLoader.prototype.addFile=function(filepath,id,type){var manifest=this.getManifestByExtension(filepath),item=null;return null!==manifest&&(item={src:filepath,id:id},"undefined"!=typeof type&&(item.type=type),manifest[manifest.length]=item,this.urls.add(item)),item},alex.load.BulkLoader.prototype.getManifestByExtension=function(file){var ext=file.match(/\.(\w+)$/)[0],manifest=null;switch(ext){case".png":case".jpg":manifest=this.imgManifest;break;case".json":manifest=this.jsonManifest;break;case".fnt":case".xml":manifest=this.fontManifest;break;case".ogg":case".m4a":case".mp3":case".wav":manifest=this.webAudioManifest}return manifest},alex.load.BulkLoader.prototype.contains=function(file){var i,manifest=this.getManifestByExtension(file),item=null,n=manifest.length,itemFound=!1;for(i=0;n>i;i++)if(item=manifest[i],item.src.indexOf(file)>-1){itemFound=!0;break}return itemFound},alex.load.BulkLoader.prototype.containsId=function(id,fileType){var i,manifest=this.getManifestByExtension(fileType),item=null,n=manifest.length,itemFound=!1;for(i=0;n>i;i++)if(item=manifest[i],item.id.indexOf(id)>-1){itemFound=!0;break}return itemFound},alex.load.BulkLoader.prototype.load=function(p_manifestPath,p_debug){this.manifestPath=p_manifestPath,void 0!==p_debug&&(this.flow.debug=p_debug===!0),this.progressTracker.reset(),this.flow.reset(),this.flow.next()},alex.load.BulkLoader.prototype.loadProgress=function(){var overallProgress=this.progressTracker.overallProgress();this.dispatchEvent({type:"progress",value:overallProgress})},alex.load.BulkLoader.prototype.loadComplete=function(){this.flow.debug&&(this.flow.log+=this.progressTracker.debugLog()),this.dispatchEvent({type:"complete"}),this.offAll()},alex.load.BulkLoader.prototype.unload=function(){var jsonData=this.manifestLoad.manifest;jsonData&&(alex.load.imageLoader.unload(this.getIds(this.imgManifest)),alex.load.soundLoader.unload(this.getIds(this.webAudioManifest)),this.fontLoad.unload(),this.jsonLoad.unload(this.getIds(this.jsonManifest)),this.manifestLoad.manifest=null,this.jsonManifest=null,this.imgManifest=null,this.fontManifest=null,this.webAudioManifest=null,this.audioSpriteManifest=null)},alex.load.BulkLoader.prototype.getIds=function(data){var i,item,ids=[],n=data.length;for(i=0;n>i;i++)item=data[i],ids[i]=item.id;return ids},alex.load.LoadFlowManager=function(p_loader,webAudio){this.loader=p_loader,this.webAudio=webAudio,this.debug=!1,this.log="* LoadFlowManager \n\r",this.currentState=null},alex.load.LoadFlowManager.prototype.reset=function(){this.currentState=null},alex.load.LoadFlowManager.prototype.next=function(){switch(this.debug&&(null===this.currentState?console.log("LoadFlowManager -> next: null"):console.log("LoadFlowManager -> next: "+this.currentState.toString())),this.currentState){case null:this.currentState=this.loader.manifestLoad;break;case this.loader.manifestLoad:this.loader.emit({type:"manifest_loaded"}),this.currentState=this.loader.jsonLoad;break;case this.loader.jsonLoad:this.currentState=this.loader.imageLoad;break;case this.loader.imageLoad:this.currentState=this.loader.fontLoad;break;case this.loader.fontLoad:this.webAudio?this.currentState=this.loader.audioLoad:this.currentState=null;break;case this.loader.audioLoad:this.currentState=null}null!==this.currentState?this.currentState.load(this.debug):this.loader.loadComplete()},alex.utils.UrlLookup=function(){this.storeLookup=function(p_list){for(var item,n=p_list.length,i=0;n>i;i++)item=p_list[i],this.add(item)},this.add=function(item){this[item.src]=item,this[item.id]=item},this.getAssetData=function(key){return this[key]},this.getURL=function(key){var assetData=this[key];return assetData?assetData.src:(console.log("ERROR - no asset found for key  -> "+key),null)},this.pathForFile=function(fileName){var id,item,foundPath=null;for(id in this)if(this.hasOwnProperty(id)&&(item=this[id],item.hasOwnProperty("src")&&item.src.indexOf(fileName)>-1)){foundPath=item.src;break}return foundPath}},alex.load.ProgressTracker=function(webAudio){this.webAudio=webAudio,this.reset(),this.total=this.webAudio?4:3},alex.load.ProgressTracker.prototype.totalProgress=function(){var prg=this.progressJSON+this.progressImages+this.progressFonts;return this.webAudio&&(prg+=this.progressSounds),prg},alex.load.ProgressTracker.prototype.overallProgress=function(){var prg=this.totalProgress();return prg/this.total},alex.load.ProgressTracker.prototype.reset=function(){this.progressJSON=0,this.progressImages=0,this.progressSounds=0,this.progressFonts=0},alex.load.ProgressTracker.prototype.debugLog=function(){var s="* ProgressTracker: \n\r";return s+=" - total: "+this.total+" \n\r",s+=" - overall: "+this.totalProgress()+" \n\r",s+=" - progressJSON: "+this.progressJSON+" \n\r",
s+=" - progressImages: "+this.progressImages+" \n\r",s+=" - progressSounds: "+this.progressSounds+" \n\r",s+=" - progressFonts: "+this.progressFonts+" \n\r"},alex.load.JsonLoader=function(url){alex.utils.EventDispatcher.call(this),this.url=url,this.id},alex.load.JsonLoader.prototype=Object.create(alex.utils.EventDispatcher.prototype),alex.load.JsonLoader.prototype.constructor=alex.load.JsonLoader,alex.load.JsonLoader.prototype.load=function(){this.ajaxRequest=new PIXI.AjaxRequest;var scope=this;this.ajaxRequest.onreadystatechange=function(){scope.onJSONLoaded()},this.jsonData=null,this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/json"),this.ajaxRequest.send(null)},alex.load.JsonLoader.prototype.onJSONLoaded=function(){4===this.ajaxRequest.readyState&&(200===this.ajaxRequest.status?(this.responseText=this.ajaxRequest.responseText,this.jsonData=JSON.parse(this.responseText),this.dispatchEvent({type:"loaded",data:this.jsonData})):404===this.ajaxRequest.status?this.dispatchEvent({type:"error",data:null}):0===this.ajaxRequest.status&&this.dispatchEvent({type:"error",data:null}))},alex.load.JsonQueue=function(){alex.utils.EventDispatcher.call(this),this.queue=[],this.results={}},alex.load.JsonQueue.prototype=Object.create(alex.utils.EventDispatcher.prototype),alex.load.JsonQueue.prototype.constructor=alex.load.JsonQueue,alex.load.JsonQueue.prototype.load=function(p_manifest){this.queue=this.queue.concat(p_manifest),this.numTotal=this.queue.length,this.numLoaded=0,this.boundCallback=this._jsonLoaded.bind(this),this.loadNext()},alex.load.JsonQueue.prototype.loadNext=function(){if(this.queue.length>0){var obj=this.queue.shift(),id=obj.id,src=obj.src;this.results[id]=null;var loader=new alex.load.JsonLoader(src);loader.id=id,loader.on("loaded",this.boundCallback),loader.load()}else this.emit({type:"complete",results:this.results})},alex.load.JsonQueue.prototype._jsonLoaded=function(p_evt){var loader=p_evt.target,jsonData=loader.jsonData,id=loader.id;this.results[id]=jsonData,loader.removeEventListeners(),this.numLoaded++,this.emit({type:"loaded",id:id,url:loader.url,loader:loader,numLoaded:this.numLoaded,numTotal:this.numTotal,jsonData:jsonData}),this.loadNext()},alex.audio.MusicLoop=function(config){if(this.type=alex.audio.AudioModes.MUSIC_LOOP,config)for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.isMuted=!1,this.isPaused=!1,this.grp="music",this.volume=1},alex.audio.MusicLoop.prototype.init=function(config){this.sound=this.initSnd(config)},alex.audio.MusicLoop.prototype.initSnd=function(config){config.src+=config.audioType;var snd=document.createElement("audio");snd.preload="auto";var self=this;snd.addEventListener("loadeddata",function(){self.loadeddata=!0},!1),snd.addEventListener("canplay",function(){self.loadeddata=!0},!1),snd.loop=!0;var loopingSupported="boolean"==typeof(new Audio).loop;return loopingSupported||snd.addEventListener("ended",function(){snd.currentTime=0,snd.play()},!1),snd.autoplay=config.autoplay,snd.src=config.src,snd},alex.audio.MusicLoop.prototype.pause=function(b){this.isPaused=b,this.isPaused?this.sound.pause():this.sound.play()},alex.audio.MusicLoop.prototype.isPlaying=function(){return!this.isPaused},alex.audio.MusicLoop.prototype.update=function(elapsedTime){},alex.audio.MusicLoop.prototype.dispose=function(){null!==this.sound&&(this.sound.pause(),this.sound=null)},alex.audio.MusicLoop.prototype.mute=function(bool){this.isMuted=bool,this.sound.muted=bool,this.sound.volume=bool?0:this.volume},alex.audio.MusicLoop.prototype.muteGroup=function(grp,bool){grp==this.grp&&this.mute(bool)},alex.audio.MusicLoop.prototype.isGroupMuted=function(grp){return grp==this.grp?this.isMuted:!1},alex.audio.MusicLoop.prototype.play=function(p_id,p_vol,p_loop){this.sound.play()},alex.audio.MusicLoop.prototype.preload=function(p_id){},alex.audio.MusicLoop.prototype.stop=function(p_id){this.sound.pause()},alex.audio.MusicLoop.prototype.addSounds=function(p_id){},alex.audio.MusicLoop.prototype.stopAll=function(){},alex.audio.SndNone=function(){this.mute=function(b){},this.muteGroup=function(grp,b){},this.muteAllGroups=function(b){},this.isGroupMuted=function(blah){return!0},this.pause=function(b){},this.isPlaying=function(){return!1},this.update=function(elapsedTime){return!1},this.play=function(p_id,p_vol,p_loop){},this.stop=function(p_id){},this.stopAll=function(){},this.dispose=function(){}},alex.audio.SoundLoader=function(){alex.utils.EventDispatcher.call(this),this.assets={},this.manifest=null,this.context=null,this.numLoaded=0,this.evtProgress={type:"progress",value:0},this.evtComplete={type:"complete",value:1}},alex.audio.SoundLoader.prototype=Object.create(alex.utils.EventDispatcher.prototype),alex.audio.SoundLoader.prototype.constructor=alex.audio.SoundLoader,alex.audio.SoundLoader.prototype.load=function(items){this.context||this.initContext(),this.manifest?this.manifest=this.manifest.concat(items):this.manifest=items,this.loadNext()},alex.audio.SoundLoader.prototype.purge=function(){this.assets={}},alex.audio.SoundLoader.prototype.unloadSound=function(id){delete this.assets[id]},alex.audio.SoundLoader.prototype.unload=function(sounds){var i,id,n=sounds.length;for(i=0;n>i;i++)id=sounds[i],this.unloadSound(id)},alex.audio.SoundLoader.prototype.initContext=function(){window.AudioContext?this.context=new AudioContext:window.webkitAudioContext&&(this.context=new webkitAudioContext)},alex.audio.SoundLoader.prototype.nextItem=function(){for(var checkObj,foundObj=null,n=this.manifest.length,i=0;n>i;i++)if(checkObj=this.manifest[i],!this.assets.hasOwnProperty(checkObj.id)){foundObj=checkObj;break}return foundObj},alex.audio.SoundLoader.prototype.countLoaded=function(){var checkObj,n=this.manifest.length;this.numLoaded=0;for(var i=0;n>i;i++)checkObj=this.manifest[i],this.assets.hasOwnProperty(checkObj.id)&&this.numLoaded++},alex.audio.SoundLoader.prototype.loadNext=function(){function updateProgress(evt){if(evt.lengthComputable){var percentComplete=evt.loaded/evt.total;self.loadProgress(percentComplete)}}var itemData=this.nextItem();if(this.countLoaded(),itemData){var request=new XMLHttpRequest;request.open("GET",itemData.src,!0),request.responseType="arraybuffer";var self=this;request.onload=function(){self.onSoundLoaded.call(self,itemData,request)},request.onerror=function(){self.assets[itemData.id]=null,self.loadProgress(),self.loadNext()},request.addEventListener("progress",updateProgress,!1);try{request.send()}catch(e){console.log("SoundLoader: XHR error "+request.status)}}else this.manifest.length=0,this.loadComplete()},alex.audio.SoundLoader.prototype.onSoundLoaded=function(itemData,request){var self=this,id=itemData.id;"function"==typeof this.context.decodeAudioData?this.context.decodeAudioData(request.response,function(decodedBuffer){itemData.soundData=decodedBuffer,self.assets[id]=itemData,self.loadProgress(),self.loadNext()},function(){self.assets[id]=null,self.loadProgress(),self.loadNext()}):(200===request.status?(window.AudioContext?itemData.soundData=context.createBuffer(request.response,1,44100):itemData.soundData=context.createBuffer(request.response,!0),this.assets[id]=itemData):this.assets[id]=null,this.loadProgress(),this.loadNext())},alex.audio.SoundLoader.prototype.loadProgress=function(progress){void 0===progress&&(progress=0);var total=this.manifest.length,amount=(this.numLoaded+progress)/total;this.evtProgress.value=amount,this.emit(this.evtProgress)},alex.audio.SoundLoader.prototype.loadComplete=function(){this.emit(this.evtComplete)},alex.audio.SndSprite=function(config){alex.utils.EventDispatcher.call(this),this.type=alex.audio.AudioModes.AUDIO_SPRITE,this.endTime=-1,this.isMuted=!1,this.audioType=config.audioType,this.isReady=!1,this.bufferingComplete=!1,this.secondsBuffered=0,this.loadeddata=!1,this.SFX="sfx",this.MUSIC="music",this.soundGroups={},this.addSoundGroup(this.SFX),this.addSoundGroup(this.MUSIC),config&&config.src&&this.setSounds(config)},alex.audio.SndSprite.prototype=Object.create(alex.utils.EventDispatcher.prototype),alex.audio.SndSprite.prototype.constructor=alex.audio.SndSprite,alex.audio.SndSprite.prototype.addSoundGroup=function(p_id){var group=new alex.audio.SoundGroup(p_id);return this.soundGroups[p_id]=group,group},alex.audio.SndSprite.prototype.setSounds=function(config){this.sprites=this.parseManifest(config.sprites),this.sound=this.initSnd(config),config.isIOS||this.preload()},alex.audio.SndSprite.prototype.parseManifest=function(p_data){if(!p_data)return[];var obj,i,soundGroup,n=p_data.length,soundData=[];for(i=0;n>i;i++)obj=p_data[i],!obj.hasOwnProperty("end")&&obj.hasOwnProperty("duration")&&(obj.end=obj.start+obj.duration),obj.hasOwnProperty("grp")||(obj.grp=this.SFX),soundData[i]=obj,soundGroup=this.soundGroups[obj.grp],soundGroup.addSound(obj);return soundData},alex.audio.SndSprite.prototype.initSnd=function(config){if(!config.src)return null;config.src+=this.audioType;var snd=document.createElement("audio");snd.preload="auto";var self=this;return snd.addEventListener("loadeddata",function(){self.loadeddata=!0},!1),snd.addEventListener("canplay",function(){self.loadeddata=!0},!1),snd.src=config.src,this.bufferSupported=void 0!==snd.buffered,snd},alex.audio.SndSprite.prototype.preload=function(){this.sound&&(this.sound.autoplay=!0,this.endTime=2.5,this.sound.play())},alex.audio.SndSprite.prototype.play=function(p_id,p_vol,p_loop){if(!this.bufferingComplete)return!1;var duration=this.sound.duration;if(isNaN(duration)||2>duration)return!1;if(this.isMuted)return this.stop(),!1;if(!this.isGamePaused){var foundObj=this.getSpriteData(p_id);if(null!==foundObj){var grpId=foundObj.grp,soundGroup=this.soundGroups[grpId];if(soundGroup.isMuted)return!1;this.endTime=foundObj.end;var success=!0;try{this.sound.paused||this.sound.pause(),this.sound.currentTime=foundObj.start,this.sound.play()}catch(e){this.endTime=-1,success=!1}return success}return!1}},alex.audio.SndSprite.prototype.stop=function(p_id){this.sound&&(this.sound.pause(),this.endTime=-1)},alex.audio.SndSprite.prototype.stopAll=function(){this.sound&&(this.sound.pause(),this.endTime=-1)},alex.audio.SndSprite.prototype.dispose=function(){this.sound&&(this.sound.pause(),this.endTime=-1,this.sound=null)},alex.audio.SndSprite.prototype.getSpriteData=function(id){for(var obj,foundObj=null,n=this.sprites.length,i=0;n>i;i++)if(obj=this.sprites[i],obj.id===id){foundObj=obj;break}return foundObj},alex.audio.SndSprite.prototype.isPlaying=function(){return this.sound?!this.sound.paused:!1},alex.audio.SndSprite.prototype.update=function(elapsedTime){if(this.loadeddata)if(this.bufferingComplete)this.endTime>-1&&this.sound.currentTime>=this.endTime&&(this.sound.pause(),this.endTime=-1,this.bufferingComplete=!0);else{if(this.bufferSupported){var timeRange=this.sound.buffered;try{this.secondsBuffered=timeRange.end(0)}catch(e){this.secondsBuffered+=elapsedTime/10}}else this.secondsBuffered+=elapsedTime/10;this.sound.duration>0&&this.secondsBuffered>=this.sound.duration&&(this.bufferingComplete=!0,this.isReady=!0,this.emit({type:"ready"}))}},alex.audio.SndSprite.prototype.mute=function(bool){this.isMuted=bool,bool&&this.stop()},alex.audio.SndSprite.prototype.muteGroup=function(grp,bool){var soundGroup=this.soundGroups[grp];soundGroup.isMuted=bool},alex.audio.SndSprite.prototype.isGroupMuted=function(groupId){var soundGroup=this.soundGroups[groupId];return void 0===soundGroup?!1:soundGroup.isMuted},alex.audio.SndSprite.prototype.pause=function(b){self.isGamePaused=b,b&&self.stop()},alex.audio.SoundGroup=function(name){this.id=name,this.sounds=[],this.isMuted=!1,this.addSound=function(sndData){this.sounds[this.sounds.length]=sndData}},alex.audio.Channel=function(config){alex.utils.EventDispatcher.call(this),this.id=config.id,this.context=config.context,this.start=config.start||0,this.duration=config.duration||-1,this.createChannel(config),this.gainNode=this.createGainNode(),this.channel.connect(this.gainNode),this.muteNode=null,void 0!==config.volume&&(this.volume=config.volume),this.tw=null},alex.audio.Channel.prototype=Object.create(alex.utils.EventDispatcher.prototype),alex.audio.Channel.prototype.constructor=alex.audio.Channel,alex.audio.Channel.prototype.createChannel=function(config){var self=this;this.channel=this.context.createBufferSource(),this.channel.buffer=config.buffer,this.channel.loop=config.loop===!0?!0:!1,config.loop?(this.channel.loopStart=this.start,this.channel.loopEnd=this.start+this.duration):this.channel.onended=function(){self.emit({type:"complete"})}},alex.audio.Channel.prototype.createGainNode=function(){return this.context.createGainNode?this.context.createGainNode():this.context.createGain?this.context.createGain():null},alex.audio.Channel.prototype.connect=function(p_muteNode){this.muteNode=p_muteNode,this.gainNode.connect(this.muteNode)},alex.audio.Channel.prototype.play=function(){this.channel.start?this.duration>-1?this.channel.start(0,this.start,this.duration):this.channel.start(0):this.channel.noteOn&&(this.duration>-1?this.channel.noteGrainOn(0,this.start,this.duration):this.channel.noteOn())},alex.audio.Channel.prototype.stop=function(){if(null!==this.channel)try{this.channel.stop?this.channel.stop(0):this.channel.noteOff&&this.channel.noteOff(0),this.channel.numberOfOutputs>0&&this.channel.disconnect()}catch(e){console.log("sound channel error on stop: "+e.message)}},Object.defineProperty(alex.audio.Channel.prototype,"volume",{get:function(){return this.gainNode?this.gainNode.gain.value:0},set:function(value){this.gainNode&&(this.gainNode.gain.value=value)}}),alex.audio.Channel.prototype.fadeOut=function(p_time){var time=void 0===p_time?1e3:p_time;this.tw||this.createTween(),this.tw.to({volume:0},time).start()},alex.audio.Channel.prototype.fadeIn=function(p_vol,p_time){var time=void 0===p_time?1e3:p_time;p_vol>1&&(p_vol=1),this.tw||this.createTween(),this.tw.to({volume:p_vol},time).start()},alex.audio.Channel.prototype.fadeTo=function(p_vol,p_secs){this.gainNode.gain.linearRampToValueAtTime(p_vol,this.context.currentTime+p_secs)},alex.audio.Channel.prototype.createTween=function(){this.tw=new TWEEN.Tween(this);var self=this;this.tw.onComplete(function(){self.stop.call(self),self.emit({type:"complete"})})},alex.audio.Channel.prototype.dispose=function(){this.removeEventListeners(),this.tw&&(this.tw.stop(),this.tw=null),null!==this.context&&(this.stop(),this.channel=null,this.gainNode.disconnect(),this.muteNode=null,this.gainNode=null,this.context=null)},alex.audio.WebAudioMgr=function(config){this.type=alex.audio.AudioModes.WEB_AUDIO,this.context=config.context||this.createContext(),this.sounds={},this.channels={},this.soundGroups={},this.catalog={},this.globalMute=new alex.audio.WebAudioSoundGroup("master",this.createGainNode()),this.globalMute.connect(this.context.destination),this.SFX="sfx",this.MUSIC="music",this.addSoundGroup(this.SFX),this.addSoundGroup(this.MUSIC),config.assets&&this.addSounds(config.assets)},alex.audio.WebAudioMgr.prototype.createContext=function(){var ctx;return window.AudioContext?ctx=new AudioContext:window.webkitAudioContext&&(ctx=new webkitAudioContext),ctx},alex.audio.WebAudioMgr.prototype.createGainNode=function(){return this.context.createGainNode?this.context.createGainNode():this.context.createGain?this.context.createGain():null},alex.audio.WebAudioMgr.prototype.play=function(id,p_vol,p_loop){var audioData=this.catalog[id],channel=null;if(void 0===audioData)return channel;var buffer=audioData.soundData;if(null!==buffer&&void 0!==buffer){var vol=p_vol||audioData.volume||1,loop=p_loop||audioData.loop||!1,start=audioData.start||0,duration=audioData.duration||-1,config={id:id,context:this.context,buffer:buffer,loop:loop,start:start,duration:duration,volume:vol};channel=new alex.audio.Channel(config);var self=this;channel.on("complete",function(event){var channel=event.target;self.stopChannel(channel)});var group=this.soundGroups[audioData.grp];channel.connect(group.node),this.channels[id]=channel,channel.play()}return channel},alex.audio.WebAudioMgr.prototype.isPlaying=function(id){return this.channels[id]?!0:!1},alex.audio.WebAudioMgr.prototype.stop=function(id){if(this.channels.hasOwnProperty(id)){var channel=this.channels[id];this.stopChannel(channel)}},alex.audio.WebAudioMgr.prototype.stopAll=function(){var id,channel;for(id in this.channels)this.channels.hasOwnProperty(id)&&(channel=this.channels[id],this.stopChannel(channel))},alex.audio.WebAudioMgr.prototype.stopChannel=function(channel){var id=channel.id;this.channels[id]===channel&&delete this.channels[id],channel.dispose(),channel=null},alex.audio.WebAudioMgr.prototype.fadeOut=function(id,p_time){if(this.channels.hasOwnProperty(id)){var channel=this.channels[id],fadeTime=void 0===p_time?1e3:p_time;channel.fadeOut(fadeTime)}},alex.audio.WebAudioMgr.prototype.fadeIn=function(id,p_vol,p_time){if(this.channels.hasOwnProperty(id)){var channel=this.channels[id];if(channel){var fadeTime=void 0===p_time?1e3:p_time,fadeVol=void 0===p_vol?1:p_vol;channel.fadeIn(fadeVol,fadeTime)}}},alex.audio.WebAudioMgr.prototype.addSounds=function(p_assets){var audioData,jsonData,id;for(id in p_assets)p_assets.hasOwnProperty(id)&&(this.sounds.hasOwnProperty(id)||(jsonData=p_assets[id],null!==jsonData.soundData&&(audioData=new alex.audio.WebAudioData(jsonData),this.sounds[id]=audioData,this.addToCatalog(audioData))))},alex.audio.WebAudioMgr.prototype.removeSounds=function(webAudioManifest){var i,data,n=webAudioManifest.length;for(i=0;n>i;i++)data=webAudioManifest[i],this.sounds.hasOwnProperty(data.id)&&delete this.sounds[data.id]},alex.audio.WebAudioMgr.prototype.purge=function(){for(var s in this.sounds)this.sounds.hasOwnProperty(s)&&delete this.sounds[s]},alex.audio.WebAudioMgr.prototype.addToCatalog=function(audioData){if(audioData.sprites){var i,sprite,sprites=audioData.sprites,n=sprites.length;for(i=0;n>i;i++)sprite=sprites[i],this.catalog[sprite.id]=sprite}else this.catalog[audioData.id]=audioData},alex.audio.WebAudioData=function(config){if(this.src=config.src,this.soundData=config.soundData,this.id=config.id,this.grp=config.grp||"sfx",this.volume=config.volume||1,this.loop=config.hasOwnProperty("loop")?config.loop:!1,this.sprites=null,config.hasOwnProperty("sprites")){var i,item,grp,id,loop,n=config.sprites.length;if(n>0)for(this.sprites=[],i=0;n>i;i++)item=config.sprites[i],id=item.id,grp=item.grp,grp||(null!==id.match(/music/i)?(grp="music",loop=item.hasOwnProperty("loop")?item.loop:!0):(grp=this.grp,loop=item.hasOwnProperty("loop")?item.loop:!1)),this.sprites[i]={id:id,start:item.start,soundData:this.soundData,grp:grp,loop:loop,duration:item.duration}}},alex.audio.WebAudioMgr.prototype.addSoundGroup=function(p_id){var gainNode=this.createGainNode(),group=new alex.audio.WebAudioSoundGroup(p_id,gainNode);return group.connect(this.globalMute.node),this.soundGroups[p_id]=group,group},alex.audio.WebAudioMgr.prototype.isGroupMuted=function(groupId){var group=this.soundGroups[groupId];return void 0===group?!1:group.isMuted},alex.audio.WebAudioMgr.prototype.mute=function(b){this.globalMute.isMuted=b,this.globalMute.volume=b?0:1},alex.audio.WebAudioMgr.prototype.muteGroup=function(grp,b){var grpNode=this.soundGroups[grp];grpNode.volume=b?0:1,grpNode.isMuted=b},alex.audio.WebAudioMgr.prototype.muteAllGroups=function(b){for(var s in this.soundGroups)this.soundGroups.hasOwnProperty(s)&&this.muteGroup(s,b)},alex.audio.WebAudioMgr.prototype.pause=function(bool){bool?this.globalMute.volume=0:this.globalMute.isMuted||(this.globalMute.volume=1)},alex.audio.WebAudioMgr.prototype.update=function(delta){},alex.audio.WebAudioMgr.prototype.wakeAudioSystem=function(){var buffer=this.context.createBuffer(1,1,22050),source=this.context.createBufferSource();source.buffer=buffer,source.connect(this.context.destination),source.play?source.play(0):source.noteOn&&source.noteOn(0)},alex.audio.WebAudioSoundGroup=function(name,gainNode){this.id=name,this.node=gainNode,this.isMuted=!1,this.connect=function(dest){this.node.connect(dest)}},Object.defineProperty(alex.audio.WebAudioSoundGroup.prototype,"volume",{get:function(){return this.node.gain.value},set:function(value){this.node.gain.value=value}}),alex.audio.SndMgr=function(){this.snd=new alex.audio.SndNone,this.audioModes=alex.audio.AudioModes,this.audioType=null,this.mode=-1,this.isMuted=alex.statics.MUTE_STATE},alex.audio.AudioModes={NONE:0,WEB_AUDIO:1,AUDIO_SPRITE:2,MUSIC_LOOP:3},alex.audio.SndMgr.prototype.init=function(config){function touchStart(){canvas.removeEventListener(event,touchStart),self.prepare()}this.audioType=config.audioType;var isIOS=config.isIOS;if(alex.statics.AUDIO_ENABLED?alex.statics.WEB_AUDIO_ENABLED&&alex.utils.system.webAudio?(this.createWebAudio(config),isIOS||this.prepare()):this.createAudioSprite(config):this.initNone(),isIOS&&this.mode!==this.audioModes.NONE){var canvas=game_shell.pixiStage.renderer.view,self=this,event="touchstart";canvas.addEventListener(event,touchStart,!1)}return this.mode},alex.audio.SndMgr.prototype.addSounds=function(data){if(this.webAudio)this.snd.addSounds(data);else{data.audioType=this.audioType;var hasSprites=null!==data.sprites,hasSrc=null!==data.src;hasSrc?hasSprites?this.snd.type===this.audioModes.AUDIO_SPRITE?this.snd.setSounds(data):this.createAudioSprite(data):this.createAudioLoop(data):this.initNone()}},alex.audio.SndMgr.prototype.createWebAudio=function(config){this.snd=new alex.audio.WebAudioMgr(config),this.mode=this.audioModes.WEB_AUDIO},alex.audio.SndMgr.prototype.createAudioSprite=function(config){this.snd&&this.snd.dispose(),this.snd=new alex.audio.SndSprite(config),this.mode=this.audioModes.AUDIO_SPRITE},alex.audio.SndMgr.prototype.createAudioLoop=function(config){this.snd&&this.snd.dispose(),this.snd=new alex.audio.MusicLoop,this.snd.init(config),this.mode=this.audioModes.MUSIC_LOOP},alex.audio.SndMgr.prototype.pause=function(p_b){this.snd.pause(p_b)},alex.audio.SndMgr.prototype.play=function(p_id,p_vol,p_loop){return this.snd.play(p_id,p_vol,p_loop)},alex.audio.SndMgr.prototype.stop=function(id){this.snd.stop(id)},alex.audio.SndMgr.prototype.stopAll=function(){this.snd.stopAll()},alex.audio.SndMgr.prototype.playWithDelay=function(p_id,p_delay,p_vol,p_loop){var snd=this.snd;return new TWEEN.Tween({w:0}).to({w:1},p_delay).onComplete(function(){snd.play(p_id,p_vol,p_loop)}).start()},alex.audio.SndMgr.prototype.isPlaying=function(id){return this.webAudio?this.snd.isPlaying(id):this.snd.isPlaying()},alex.audio.SndMgr.prototype.update=function(delta){this.snd.update(delta)},alex.audio.SndMgr.prototype.fadeOut=function(id,time){this.webAudio&&this.snd.fadeOut(id,time)},alex.audio.SndMgr.prototype.fadeIn=function(id,time){this.webAudio?this.snd.fadeIn(id,time):this.snd.play(id)},alex.audio.SndMgr.prototype.mute=function(bool){this.isMuted=bool,this.snd.mute(bool)},alex.audio.SndMgr.prototype.muteGroup=function(grp,bool){this.snd.muteGroup(grp,bool)},alex.audio.SndMgr.prototype.isGroupMuted=function(groupId){return this.snd.isGroupMuted(groupId)},alex.audio.SndMgr.prototype.muteAllGroups=function(bool){this.webAudio?this.snd.muteAllGroups(b):this.snd.mute(bool)},alex.audio.SndMgr.prototype.prepare=function(){this.webAudio?this.snd.wakeAudioSystem():this.snd.preload()},alex.audio.SndMgr.prototype.removeSounds=function(data){this.webAudio&&data&&this.snd.removeSounds(data)},alex.audio.SndMgr.prototype.purge=function(){this.webAudio&&this.snd.purge()},alex.audio.SndMgr.prototype.initNone=function(){this.snd&&this.snd.dispose(),this.mode=this.audioModes.NONE,this.snd=new alex.audio.SndNone},alex.audio.SndMgr.prototype.checkReady=function(){return null!==this.snd},Object.defineProperty(alex.audio.SndMgr.prototype,"isReady",{get:function(){return this.checkReady()},set:function(value){}}),Object.defineProperty(alex.audio.SndMgr.prototype,"webAudio",{get:function(){return this.mode===alex.audio.AudioModes.WEB_AUDIO}}),alex.display.PixiStage=function(){this.centerV=!0},alex.display.PixiStage.prototype.draw=function(){this.renderer.render(this.stage)},alex.display.PixiStage.prototype.init=function(config){this.forceCanvas=config.forceCanvas,//!alex.statics.WEB_GL_ENABLED;
this.createStage(config.color),this.createRenderer(config.width,config.height,config),this.createHolder(.5*config.width),this.addToDOM()},alex.display.PixiStage.prototype.createRenderer=function(p_w,p_h,options){this.forceCanvas?this.renderer=new PIXI.CanvasRenderer(p_w,p_h,options):this.renderer=PIXI.autoDetectRecommendedRenderer(p_w,p_h,options)},alex.display.PixiStage.prototype.createStage=function(p_color){"undefined"==typeof p_color&&(p_color=16763904),this.stage=new PIXI.Stage(p_color)},alex.display.PixiStage.prototype.createHolder=function(p_x,p_y){this.content=new PIXI.DisplayObjectContainer,this.content.x=p_x,this.stage.addChild(this.content)},alex.display.PixiStage.prototype.addToDOM=function(){var view=this.renderer.view,gameDiv=document.getElementById("game");gameDiv.appendChild(view),view.style.marginLeft="auto",view.style.marginRight="auto",view.style.display="block"},alex.display.PixiStage.prototype.resize=function(settings){var resolution=this.renderer.resolution,pixelW=settings.pixelWidth/resolution,pixelH=settings.pixelHeight/resolution,scale=settings.scale;if(this.renderer.resize(pixelW,pixelH),2===settings.scaleMode){var dif=.5*(settings.windowHeight-settings.pixelHeight);if(dif>0){var view=this.renderer.view,top=dif+"px";view.style.position="absolute",view.style.top=top}this.content.y=.5*pixelH}else this.centerV&&(this.content.y=.5*pixelH);this.content.x=.5*pixelW,this.content.scale.x=this.content.scale.y=scale/resolution},alex.display.Quad=function(p_w,p_h,p_color,p_alpha){PIXI.Graphics.call(this),"undefined"==typeof p_color&&(p_color=16711680),this.tint=p_color,"undefined"==typeof p_h&&(p_h=100),"undefined"==typeof p_w&&(p_w=100),"object"==typeof p_w?this.fromRect(p_w):(this._width=p_w,this._height=p_h),this.drawQuad(),"undefined"==typeof p_alpha&&(p_alpha=1),this.alpha=p_alpha,this.hitArea=new PIXI.Rectangle(0,0,this._width,this._height)},alex.display.Quad.prototype=Object.create(PIXI.Graphics.prototype),alex.display.Quad.prototype.constructor=alex.display.Quad,alex.display.Quad.prototype.fromRect=function(rect){this._width=this.hitArea.width=rect.width,this._height=this.hitArea.height=rect.height,this.x=rect.x,this.y=rect.y,this.drawQuad()},alex.display.Quad.prototype.drawQuad=function(){this.clear(),this.beginFill(this.tint),this.drawRect(0,0,this._width,this._height),this.endFill()},Object.defineProperty(alex.display.Quad.prototype,"width",{get:function(){return this._width},set:function(value){this._width=value,this.drawQuad(),this.hitArea.width=value}}),Object.defineProperty(alex.display.Quad.prototype,"height",{get:function(){return this._height},set:function(value){this._height=value,this.drawQuad(),this.hitArea.height=value}}),alex.display.Circle=function(p_radius,p_color){PIXI.Graphics.call(this),this.tint="undefined"!=typeof p_color?p_color:16711680,this.radius="undefined"!=typeof p_radius?p_radius:50},alex.display.Circle.prototype=Object.create(PIXI.Graphics.prototype),alex.display.Circle.prototype.constructor=alex.display.Circle,Object.defineProperty(alex.display.Circle.prototype,"radius",{get:function(){return this._radius},set:function(value){this._radius=value,this.clear(),this.beginFill(this.tint),this.drawCircle(0,0,this._radius),this.endFill()}}),alex.display.Button=function(p_upImgId,p_downImgId,p_disabledImgId){this.txUp=PIXI.TextureCache[p_upImgId],PIXI.Sprite.call(this,this.txUp),alex.utils.EventDispatcher.prototype.apply(this),this.upScale=1,this._pressed=!1,this.evtPress={type:"press"},this.evtRelease={type:"release"},this.evtReleaseOutside={type:"release_outside"},this.mousedown=this.touchstart=this._touchstart,this.mouseup=this.touchend=this._touchend,this.mouseupoutside=this.touchendoutside=this._touchendoutside,this.enabled=!0,this.createHitArea(),p_downImgId&&"undefined"!=typeof p_downImgId?(this.txDown=PIXI.TextureCache[p_downImgId],this.downScale=1):(this.txDown=null,this.downScale=.95,this.pivot.x=.5*this.hitArea.width,this.pivot.y=.5*this.hitArea.height),this.txDisabled=p_disabledImgId?PIXI.TextureCache[p_disabledImgId]:null},alex.display.Button.prototype=Object.create(PIXI.Sprite.prototype),alex.display.Button.prototype.constructor=alex.display.Button,alex.display.Button.prototype.createHitArea=function(){this.resolution=this.txUp.baseTexture.resolution;var w=this.txUp.frame.width/this.resolution,h=this.txUp.frame.height/this.resolution;this.hitArea=new PIXI.Rectangle(0,0,w,h)},alex.display.Button.prototype._touchstart=function(data){this.txDown?this.setTexture(this.txDown):this.scale.x=this.scale.y=this.downScale,this._pressed=!0,this.emit(this.evtPress)},alex.display.Button.prototype._touchend=function(data){this._pressed&&(this._pressed=!1,this.restore(),this.emit(this.evtRelease))},alex.display.Button.prototype._touchendoutside=function(data){this._pressed&&(this._pressed=!1,this.restore(),this.emit(this.evtReleaseOutside))},alex.display.Button.prototype.restore=function(data){this.downScale<1&&(this.scale.x=this.scale.y=this.upScale),this.texture!==this.txUp&&this.setTexture(this.txUp)},Object.defineProperty(alex.display.Button.prototype,"enabled",{get:function(){return this.interactive},set:function(bool){this.interactive=bool,this.buttonMode=bool,this.txDisabled&&(bool?this.setTexture(this.txUp):this.setTexture(this.txDisabled))}}),alex.display.MaskJpeg=function(jpegImg,pngMask,callback){var txImg=jpegImg,txMask=pngMask,canvasImg=document.createElement("canvas");canvasImg.width=txImg.width,canvasImg.height=txImg.height;var ctxImg=canvasImg.getContext("2d");ctxImg.drawImage(txImg,0,0),ctxImg.globalCompositeOperation="xor",ctxImg.drawImage(txMask,0,0);var img=new Image;return callback&&(img.onload=function(){callback(img)}),img.src=canvasImg.toDataURL(),img},alex.display.Toggle=function(p_onImg,p_offImg,p_on){this.isOn=p_on===!1?!1:!0,this.txOn=PIXI.TextureCache[p_onImg],this.txOff=PIXI.TextureCache[p_offImg];var tx=this.isOn?this.txOn:this.txOff;PIXI.Sprite.call(this,tx),alex.utils.EventDispatcher.prototype.apply(this),this.mousedown=this.touchstart=this._touchstart,this.mouseup=this.touchend=this._touchend,this.mouseupoutside=this.touchendoutside=this._touchendoutside,this.enabled=!0,this.createHitArea()},alex.display.Toggle.prototype=Object.create(PIXI.Sprite.prototype),alex.display.Toggle.prototype.constructor=alex.display.Toggle,alex.display.Toggle.prototype.createHitArea=function(){this.resolution=this.txOn.baseTexture.resolution;var w=this.txOn.frame.width/this.resolution,h=this.txOn.frame.height/this.resolution;this.hitArea=new PIXI.Rectangle(0,0,w,h)},alex.display.Toggle.prototype._touchstart=function(data){this._pressed=!0},alex.display.Toggle.prototype._touchend=function(data){this._pressed&&(this._pressed=!1,this.toggle())},alex.display.Toggle.prototype._touchendoutside=function(data){this._pressed&&(this._pressed=!1)},alex.display.Toggle.prototype.toggle=function(){this.isOn=!this.isOn,this.isOn?this.setTexture(this.txOn):this.setTexture(this.txOff);var state=this.isOn;this.dispatchEvent({type:"toggle",state:state})},alex.display.Toggle.prototype.setOff=function(){this.setTexture(this.txOff),this.isOn=!1},alex.display.Toggle.prototype.setOn=function(){this.setTexture(this.txOn),this.isOn=!0},Object.defineProperty(alex.display.Toggle.prototype,"enabled",{get:function(){return this.interactive},set:function(value){this.interactive=value,this.buttonMode=value}}),alex.display.Toggle.prototype.dispose=function(){this.txOff=null,this.txOn=null},alex.screens.ScreenBase=function(p_config){PIXI.DisplayObjectContainer.call(this),alex.utils.EventDispatcher.prototype.apply(this),this.screenW=0,this.screenH=0,this.defaultW=0,this.defaultH=0,this.resolution=1,this.eventQueue=null,this.lastScreenId=null,this.config=null,this.snd=null;for(var s in p_config)p_config.hasOwnProperty(s)&&(this[s]=p_config[s]);alex.utils.UpdateList.prototype.mixin(this),this.delayedAction=new alex.utils.DelayedAction,this.addUpdateItem(this.delayedAction)},alex.screens.ScreenBase.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),alex.screens.ScreenBase.prototype.constructor=alex.screens.ScreenBase,alex.screens.ScreenBase.prototype.run=function(){},alex.screens.ScreenBase.prototype.toString=function(){return"[ScreenBase]"},alex.screens.ScreenBase.prototype.delay=function(callback,p_ms){this.delayedAction.delay(callback,p_ms)},alex.screens.ScreenBase.prototype.dispose=function(){this.parent&&this.parent.removeChild(this),this.updateItems.length=0,this.delayedAction.dispose(),this.removeEventListeners()},alex.screens.ScreenBase.prototype.resize=function(p_w,p_h){this.screenW=p_w,this.screenH=p_h},alex.screens.ScreenBase.prototype.newScreen=function(p_screenId){var eventObject;"string"==typeof p_screenId?eventObject={type:alex.events.NEW_SCREEN,screenId:p_screenId}:(eventObject=p_screenId,eventObject.type=alex.events.NEW_SCREEN),this.eventQueue.queueEvent(eventObject)},alex.screens.ScreenMgr=function(){this.currentScreen=null,this.lastScreenId=null,this.pixiStage=null},alex.screens.ScreenMgr.prototype=Object.create(alex.utils.EventDispatcher.prototype),alex.screens.ScreenMgr.prototype.constructor=alex.screens.ScreenMgr,alex.screens.ScreenMgr.prototype.init=function(vars){this.pixiStage=vars.stage,this.config=vars.config;var self=this;game_shell.eventQueue.addEventListener(alex.events.NEW_SCREEN,function(event){self.showScreen(event)})},alex.screens.ScreenMgr.prototype.resize=function(p_settings){if(null!==this.currentScreen){var pointW=p_settings.pointWidth,pointH=p_settings.pointHeight;this.currentScreen.resize(pointW,pointH)}},alex.screens.ScreenMgr.prototype.displayScreen=function(p_event){this.disposeScreen();var config=this.screenConfig(p_event);this.currentScreen=this.createScreen(config),this.pixiStage.content.addChild(this.currentScreen),this.currentScreen.run()},alex.screens.ScreenMgr.prototype.showScreen=function(data,callback){var config="string"==typeof data?{screenId:data}:data,screenId=config.screenId,manifest=this.getManifestPath(screenId);manifest&&this.currentManifest!=manifest?this.loadWithManifest(config,manifest,callback):this.displayScreen(config)},alex.screens.ScreenMgr.prototype.loadWithManifest=function(screenId,manifest,callback){this.unloadScreen(),this.currentManifest=manifest;var self=this;game_shell.loader.on("manifest_json",function(event){self.addToManifestJSON(screenId,event.data)}),game_shell.loader.on("manifest_loaded",function(){var data=game_shell.loader.manifestLoad.manifest;self.customizeManifest(screenId,data)}),game_shell.loader.on("complete",function(){self.addSounds(),"function"==typeof callback&&callback()}),game_shell.loader.load(manifest,alex.statics.LOG_ASSET_LOAD),game_shell.eventQueue.queueEvent({type:alex.events.NEW_SCREEN,screenId:"load",targetScreen:screenId})},alex.screens.ScreenMgr.prototype.getManifestPath=function(screenId){return alex.statics.JSON_DIR+"asset_manifest.json"},alex.screens.ScreenMgr.prototype.addToManifestJSON=function(screenId,jsonData){},alex.screens.ScreenMgr.prototype.customizeManifest=function(screenId,data){},alex.screens.ScreenMgr.prototype.addSounds=function(){var system=alex.utils.system,soundData={};if(alex.statics.WEB_AUDIO_ENABLED&&system.webAudio)soundData.assets=alex.load.soundLoader.assets,game_shell.sndMgr.addSounds(soundData.assets);else{var manifestData=game_shell.loader.audioSpriteManifest;soundData.autoplay=!0,soundData.sprites=manifestData.sprites?manifestData.sprites:null,soundData.src=null,manifestData.src&&(soundData.src=alex.statics.SND_DIR+manifestData.src),game_shell.sndMgr.addSounds(soundData)}},alex.screens.ScreenMgr.prototype.unloadScreen=function(){game_shell.spineUtils&&game_shell.spineUtils.purge(),game_shell.sndMgr.removeSounds(game_shell.loader.webAudioManifest),game_shell.loader.unload()},alex.screens.ScreenMgr.prototype.createScreen=function(p_event){return null},alex.screens.ScreenMgr.prototype.screenConfig=function(p_event){var config="string"==typeof p_event?{screenId:p_event}:p_event;return config.screenW=alex.statics.STAGE_W,config.screenH=alex.statics.STAGE_H,config.defaultW=alex.statics.DEFAULT_W,config.defaultH=alex.statics.DEFAULT_H,config.resolution=game_shell.resolution,config.eventQueue=game_shell.eventQueue,config.lastScreenId=this.lastScreenId,config.config=this.config,config.snd=game_shell.sndMgr,config},alex.screens.ScreenMgr.prototype.update=function(p_time){this.currentScreen&&this.currentScreen.update(p_time)},alex.screens.ScreenMgr.prototype.disposeScreen=function(){if(null!==this.currentScreen){"load"!=this.currentScreen.screenId&&(this.lastScreenId=this.currentScreen.screenId),this.currentScreen.dispose(),this.currentScreen=null;var spriteBatch=game_shell.pixiStage.renderer.renderSession.spriteBatch;spriteBatch&&(spriteBatch.currentBaseTexture=null,spriteBatch.dirty=!0,spriteBatch.lastIndexCount=0,spriteBatch.currentBatchSize=0,spriteBatch.textures.length=0,spriteBatch.sprites.length=0)}},alex.ui.LoadBar=function(p_w,p_h,p_color,p_color2){PIXI.DisplayObjectContainer.call(this);var c1=p_color||0,bg=new PIXI.Graphics;bg.beginFill(c1,1);var lineW=5,half=.5*lineW;bg.lineStyle(lineW,16777215,1),bg.drawRect(-half,-half,p_w+lineW,p_h+lineW),bg.endFill(),this.addChild(bg);var c2=p_color2||13408512,lineW=5,half=.5*lineW,barW=p_w+lineW,barH=p_h+lineW;this.fullW=barW;var prgBar=new alex.display.Quad(barW,barH,c2);prgBar.x=-half,prgBar.y=-half;var fg=new PIXI.Graphics;fg.beginFill(c1,0),fg.lineStyle(lineW,16777215,1),fg.moveTo(0,0),fg.lineTo(p_w,0),fg.lineTo(p_w,p_h),fg.lineTo(0,p_h),fg.lineTo(0,0),fg.endFill(),this.addChild(fg),this.progress=function(p_amount){prgBar.width=p_amount*this.fullW,1===p_amount&&this.complete()},this.complete=function(){prgBar.width=this.fullW,fg.visible=!1,bg.visible=!1},this.progress(0),this.addChild(prgBar)},alex.ui.LoadBar.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),alex.ui.LoadBar.prototype.constructor=alex.ui.LoadBar,alex.ui.PopupBase=function(){this.quadAlpha=.5,this.fadeTime=250,this.tweenTime=750,this.minScale=.001,this.eventOpen={type:"open"},this.eventShut={type:"shut"},this.states={HIDDEN:0,OPENING:1,SHOWN:2,CLOSING:3},this.state=this.states.HIDDEN,this.root=new PIXI.DisplayObjectContainer,this.bgQuad=this.createQuad(),this.content=this.createContentHolder(),this.tweenOpen=this.createTweenOpen(),this.tweenShut=this.createTweenShut(),this.tweenQuadIn=this.createTweenQuadIn(),this.tweenQuadOut=this.createTweenQuadOut()},alex.ui.PopupBase.prototype=Object.create(alex.utils.EventDispatcher.prototype),alex.ui.PopupBase.prototype.constructor=alex.ui.PopupBase,alex.ui.PopupBase.prototype.createQuad=function(){var w=alex.statics.DEFAULT_W+2,h=alex.statics.DEFAULT_H,bgQuad=new alex.display.Quad(w,h,0);return bgQuad.alpha=0,bgQuad.x=w*-.5,bgQuad.y=h*-.5,this.root.addChild(bgQuad),bgQuad},alex.ui.PopupBase.prototype.createContentHolder=function(){var content=(alex.statics.STAGE_W,alex.statics.STAGE_H,new PIXI.DisplayObjectContainer);return this.root.addChild(content),content},alex.ui.PopupBase.prototype.show=function(){this.state===this.states.HIDDEN&&(this.state=this.states.OPENING,this.bgQuad.alpha=0,this.content.scale.x=this.minScale,this.content.scale.y=this.minScale,this.tweenQuadIn.start(),this.tweenOpen.start())},alex.ui.PopupBase.prototype.createTweenQuadIn=function(){return new TWEEN.Tween(this.bgQuad).to({alpha:this.quadAlpha},this.fadeTime)},alex.ui.PopupBase.prototype.createTweenQuadOut=function(){return new TWEEN.Tween(this.bgQuad).to({alpha:0},this.fadeTime)},alex.ui.PopupBase.prototype.createTweenOpen=function(){var self=this,tw=new TWEEN.Tween(this.content.scale).to({x:1,y:1},this.tweenTime).easing(TWEEN.Easing.Back.Out).onComplete(function(){self.state=self.states.SHOWN,self.onShown()});return tw},alex.ui.PopupBase.prototype.onShown=function(){this.emit(this.eventOpen)},alex.ui.PopupBase.prototype.hide=function(){this.state!==this.states.CLOSING&&(this.state=this.states.CLOSING,this.tweenQuadOut.start(),this.tweenShut.start())},alex.ui.PopupBase.prototype.createTweenShut=function(){var self=this,tw=new TWEEN.Tween(this.content.scale).to({x:this.minScale,y:this.minScale},this.tweenTime).easing(TWEEN.Easing.Back.In).onComplete(function(){self.state=self.states.HIDDEN,self.onHidden()});return tw},alex.ui.PopupBase.prototype.onHidden=function(){this.emit(this.eventShut)},Object.defineProperty(alex.ui.PopupBase.prototype,"isShown",{get:function(){var isShownVar=this.state===this.states.SHOWN,isOpening=this.state===this.states.OPENING;return isShownVar||isOpening}}),alex.motion.Wiggle=function(p_displayObj,p_maxRotation){alex.utils.EventDispatcher.call(this),this.img=p_displayObj,this.baseR=p_displayObj.rotation,void 0===p_maxRotation&&(p_maxRotation=.15),this.maxR=Math.PI*p_maxRotation,this.speed=.017,this.counter=0,this.duration=30},alex.motion.Wiggle.prototype=Object.create(alex.utils.EventDispatcher.prototype),alex.motion.Wiggle.prototype.constructor=alex.motion.Wiggle,alex.motion.Wiggle.prototype.startWiggle=function(){this.counter=0},alex.motion.Wiggle.prototype.update=function(delta){this.wiggle(delta)},alex.motion.Wiggle.prototype.wiggle=function(time){this.counter+=this.speed*time;var l_nSin=Math.sin(this.counter),l_nNewRotation=this.baseR-l_nSin*this.maxR;return this.img.rotation=l_nNewRotation,l_nNewRotation},alex.motion.Twanger=function(p_displayObj,p_max){alex.motion.Wiggle.call(this,p_displayObj,p_max),this.scale=1,this.decay=.95,this.MAX_R=.349,this.maxR=0,this.minR=.017},alex.motion.Twanger.prototype=Object.create(alex.motion.Wiggle.prototype),alex.motion.Twanger.prototype.constructor=alex.motion.Twanger,alex.motion.Twanger.prototype.start=function(){this.maxR=this.MAX_R},Object.defineProperty(alex.motion.Twanger.prototype,"isTwanging",{get:function(){return this.maxR>0},set:function(value){}}),alex.motion.Twanger.prototype.update=function(time){var isMoving=!1;return this.maxR>this.minR&&(this.wiggle(time),this.maxR*=this.decay,this.maxR<1e-5&&(this.stopTwang(),this.dispatchEvent({type:"complete"})),isMoving=!0),isMoving},alex.motion.Twanger.prototype.wiggle=function(time){this.counter+=this.speed*time;var l_nSin=Math.sin(this.counter),l_nNewRotation=this.baseR-l_nSin*this.maxR;this.img.rotation=l_nNewRotation*this.scale},alex.motion.Twanger.prototype.stopTwang=function(){this.maxR=0,this.img.rotation=this.baseR},alex.motion.Oscillator=function(){this.speedX=5e-4,this.speedY=5e-4,this.time=0,this.x=0,this.y=0},alex.motion.Oscillator.prototype.init=function(config){config.speedX&&(this.speedX=config.speedX),config.speedY&&(this.speedY=config.speedY),config.time&&(this.time=config.time),config.x&&(this.x=config.x),config.y&&(this.y=config.y)},alex.motion.Oscillator.prototype.randomise=function(){this.speedX=5e-4+.001*Math.random(),this.speedY=5e-4+.001*Math.random()},alex.motion.Oscillator.prototype.reset=function(){this.time=0,this.x=0,this.y=0},alex.motion.Oscillator.prototype.update=function(p_delta){this.time+=p_delta,this.x=Math.cos(this.time*this.speedX),this.y=Math.sin(this.time*this.speedY)},alex.motion.SawTooth=function(){this._value=0,this._min=0,this._max=1,this.oscillationsPerSec=1},alex.motion.SawTooth.prototype.update=function(delta){var newValue=this._value+delta*this._step;newValue>this._max&&(newValue-=this._max),this._value=newValue},alex.motion.SawTooth.prototype.reset=function(){this._value=0},Object.defineProperty(alex.motion.SawTooth.prototype,"oscillationsPerSec",{set:function(oscillations){this._step=oscillations/1e3}}),Object.defineProperty(alex.motion.SawTooth.prototype,"value",{get:function(){return this._value}}),alex.motion.TriangleWave=function(){this._value=0,this._min=0,this._max=1,this.oscillationsPerSec=1},alex.motion.TriangleWave.prototype.update=function(delta){var newValue=this._value+delta*this._step;newValue>this._max?(this._value=this._max,this._step=-this._step):newValue<this._min?(this._value=this._min,this._step=-this._step):this._value=newValue},alex.motion.TriangleWave.prototype.reset=function(){this._value=0,this._step<0&&(this._step=-this._step)},Object.defineProperty(alex.motion.TriangleWave.prototype,"oscillationsPerSec",{set:function(oscillations){this._step=oscillations/500}}),Object.defineProperty(alex.motion.TriangleWave.prototype,"value",{get:function(){return this._value}}),alex.motion.ScreenShaker=function(p_target){alex.utils.EventDispatcher.call(this);var time=0;this.rootPt=new PIXI.Point,this.target=p_target,this.target&&(this.rootPt.x=this.target.x,this.rootPt.y=this.target.y),this.rangeX=10,this.pulse=.005,this.duration=3e3,this.init=function(config){config.hasOwnProperty("rangeX")&&(this.rangeX=config.rangeX),config.hasOwnProperty("duration")&&(this.duration=config.duration),config.hasOwnProperty("pulse")&&(this.pulse=config.pulse),config.hasOwnProperty("target")&&(this.target=config.target,this.rootPt.x=this.target.x,this.rootPt.y=this.target.y)},this.update=function(p_delta){if(this.isActive){time+=p_delta;var pulse=Math.sin(time*this.pulse),cos=Math.cos(time);this.target.x=this.rootPt.x+cos*this.rangeX*pulse,time>this.duration&&this.end()}},this.activate=function(){time=0,this.isActive=!0,this.rootPt.x=this.target.x,this.rootPt.y=this.target.y},this.end=function(){this.isActive=!1,this.target.x=this.rootPt.x,this.dispatchEvent({type:"complete"})}},alex.motion.ScreenShaker.prototype=Object.create(alex.utils.EventDispatcher.prototype),alex.motion.ScreenShaker.prototype.constructor=alex.motion.ScreenShaker,alex.motion.Pulsar=function(config){"undefined"!=typeof config&&this.init(config)},alex.motion.Pulsar.prototype.init=function(config){this.target=config.target,config.hasOwnProperty("target")?this.scale=config.target.scale:config.hasOwnProperty("scale")&&(this.scale=config.scale),this.maxScale=config.maxScale||1,this.minScale=config.minScale||.95,this.scaleAmount=this.maxScale-this.minScale;var startScale=config.hasOwnProperty("startScale")?config.startScale:this.minScale;this.scale.x=this.scale.y=startScale,this.rate=config.rate||.002,this.active=config.autostart||!1,this.count=startScale===this.maxScale?0:Math.PI},alex.motion.Pulsar.prototype.start=function(){this.active=!0},alex.motion.Pulsar.prototype.stop=function(){this.active=!1},alex.motion.Pulsar.prototype.reset=function(){this.count=0},alex.motion.Pulsar.prototype.update=function(delta){if(this.active){this.count+=delta*this.rate;var sin=Math.sin(this.count),scale=this.minScale+sin*this.scaleAmount;this.scale.x=this.scale.y=scale}},alex.game.HitTest={intersects:function(Object1,Object2){var overlap=this._intersection(Object1,Object2);return overlap>0},radius:function(pt1,pt2,radius){var dist=this._distance(pt1,pt2);return radius>dist},_intersection:function(Object1,Object2){var overlap=0,obj1R=Object1.x+Object1.width,obj2R=Object2.x+Object2.width,obj1B=Object1.y+Object1.height,obj2B=Object2.y+Object2.height;if(obj1R>Object2.x&&Object1.x<obj2R&&obj1B>Object2.y&&Object1.y<obj2B){var biggestX=Math.max(Object1.x,Object2.x),smallestR=Math.min(obj1R,obj2R),overlapX=smallestR-biggestX,biggestY=Math.max(Object1.y,Object2.y),smallestB=Math.min(obj1B,obj2B),overlapY=smallestB-biggestY;overlap=Math.max(overlapX,overlapY)}return overlap},_distance:function(pt1,pt2){var distX=Math.abs(pt2.x-pt1.x),distY=Math.abs(pt2.y-pt1.y);return Math.sqrt(distX*distX+distY*distY)}},alex.game.Camera=function(){this.maxY=0,this.minY=0,this.maxX=0,this.minX=0,this.trackX=0,this.trackY=0,this.moveY=!1},alex.game.Camera.prototype=Object.create(alex.game.HitTest),alex.game.Camera.prototype.init=function(config){this.oldX=-100,this.defaultTrackX=0,this.trackX=this.defaultTrackX;for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.maxX=this.bgW-.5*this.screenW,this.minX=-this.maxX,this.viewport=new PIXI.Rectangle(0,0,this.screenW,this.screenH),this.isInFrame=this._frameCheckRect,this.moveY?this.update=this._updateBoth:this.update=this._update},alex.game.Camera.prototype.reset=function(){this.trackX=this.defaultTrackX},alex.game.Camera.prototype._update=function(delta){this.move(this.tracking.x)},alex.game.Camera.prototype.move=function(px){px!==this.oldX&&(this.oldX=px,this.scrollX(px+this.trackX))},alex.game.Camera.prototype._updateBoth=function(delta){this.moveBoth(this.tracking)},alex.game.Camera.prototype.moveBoth=function(pt){pt.x!==this.oldX&&(this.oldX=pt.x,this.scrollX(pt.x+this.trackX)),pt.y!==this.oldY&&(this.oldY=pt.y,this.scrollY(pt.y+this.trackY))},alex.game.Camera.prototype.scrollX=function(px){px>this.maxX?px=this.maxX:px<this.minX&&(px=this.minX),this.scene.x=-px,this.viewport.x=px-.5*this.viewport.width},alex.game.Camera.prototype.scrollY=function(py){py>this.maxY?py=this.maxY:py<this.minY&&(py=this.minY),this.scene.y=-py,this.viewport.y=py-.5*this.viewport.height},alex.game.Camera.prototype._frameCheckPoint=function(x,y){if(this.moveY){var inX=x>this.viewport.x&&x<this.viewport.x+this.viewport.width;if(!inX)return!1;var inY=y>this.viewport.y&&y<this.viewport.y+this.viewport.height;return inX&&inY}return x>this.viewport.x&&x<this.viewport.x+this.viewport.width},alex.game.Camera.prototype._frameCheckRect=function(rect){if(this.moveY)return this.intersects(rect,this.viewport);var obj1R=rect.x+rect.width,obj2R=this.viewport.x+this.viewport.width;return obj1R>this.viewport.x&&rect.x<obj2R},alex.game.Camera.prototype.getX=function(){return this.scene.pivot.x},alex.game.Camera.prototype.getY=function(){return this.scene.pivot.y},alex.game.GameLoop=function(){this.gameObjects=[],this.itemsToRemove=[],this.cameraCulling=!1,this.userPreUpdate=!1,this.isPaused=!0},alex.game.GameLoop.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s])},alex.game.GameLoop.prototype.add=function(item){var i=this.gameObjects.length;return this.gameObjects[i]=item,i},alex.game.GameLoop.prototype.remove=function(item){this.itemsToRemove[this.itemsToRemove.length]=item},alex.game.GameLoop.prototype.start=function(){this.isPaused=!1},alex.game.GameLoop.prototype.stop=function(){this.isPaused=!0},alex.game.GameLoop.prototype.pause=function(bool){this.isPaused=bool},alex.game.GameLoop.prototype.update=function(p_delta){this.isPaused||(this.updateGameObjects(p_delta),this.postUpdate(p_delta),this.drawGameObjects(),this.input.check(p_delta))},alex.game.GameLoop.prototype.preUpdate=function(delta){},alex.game.GameLoop.prototype.updateGameObjects=function(p_delta){var i,obj,n=this.gameObjects.length;for(i=0;n>i;i++)obj=this.gameObjects[i],this.userPreUpdate&&obj.preUpdate(),obj.update(p_delta),obj.remove&&(this.itemsToRemove[this.itemsToRemove.length]=obj)},alex.game.GameLoop.prototype.postUpdate=function(p_delta){var i,obj,index,n=this.itemsToRemove.length;for(i=0;n>i;i++)obj=this.itemsToRemove[i],index=this.gameObjects.indexOf(obj),index>-1&&this.gameObjects.splice(index);if(this.itemsToRemove.length=0,n=this.gameObjects.length,this.cameraCulling)for(i=0;n>i;i++)obj=this.gameObjects[i],obj.graphics&&(obj.graphics.visible=this.camera.isInFrame(obj.frame))},alex.game.GameLoop.prototype.drawGameObjects=function(){var i,obj,n=this.gameObjects.length;for(i=0;n>i;i++)obj=this.gameObjects[i],obj.draw()},alex.GenericGame=function(){this.setup=function(){this.gameDiv=document.getElementById("game"),this.gameDiv.style.backgroundColor=alex.statics.BG_COLOR,alex.utils.system=new alex.utils.SystemInfo,alex.utils.system.run(!0),this.system=alex.utils.system,alex.statics.AUDIO_TYPE&&(this.system.audioType=alex.statics.AUDIO_TYPE),this.eventQueue=new alex.utils.EventQueue,this.eventQueue.addEventListener(alex.events.GAME_EVENT,this.onGameEvent.bind(this)),this.createStage(alex.statics),this.screenMgr=new alex.screens.ScreenMgr,this.screenMgr.init({stage:this.pixiStage,config:alex.statics}),"undefined"!=typeof stats?this.renderLoop=new alex.utils.RenderLoopStats(this.pixiStage):this.renderLoop=new alex.utils.RenderLoop(this.pixiStage),alex.GenericGame.prototype.createSoundManager.call(this),this.createRunLoop(),this.pauseGame=new alex.utils.PauseGame,this.pauseGame.init({runLoop:this.runLoop,renderLoop:this.renderLoop,sndMgr:this.sndMgr}),this.initFullscreen(),this.initResolution(),alex.GenericGame.prototype.createViewport.call(this),"function"==typeof this.onReady&&this.onReady(),this.renderLoop.start()},this.getURL=function(id){return this.loader.urls.getURL(id)},this.initFullscreen=function(){if(alex.utils.system.isMobile&&window.scrollTo(0,1),alex.statics.FULLSCREEN_ENABLED){var disabledOnDesktop=alex.utils.system.isDesktop&&!alex.statics.DESKTOP_FULLSCREEN;disabledOnDesktop||(this.fullscreenMgr=new alex.utils.FullscreenMgr,this.fullscreenMgr.init({canvas:this.pixiStage.renderer.view,isMobile:alex.utils.system.isMobile}))}},this.createStage=function(config){this.pixiStage=new alex.display.PixiStage,this.pixiStage.init({color:parseInt(config.BG_COLOR.substr(1),16),width:config.STAGE_W,height:config.STAGE_H,forceCanvas:!config.WEB_GL_ENABLED})},this.createRunLoop=function(){this.runLoop=new alex.utils.RunLoop,this.updateList=new alex.utils.UpdateList,this.runLoop.updateGame=this.updateGame.bind(this),this.runLoop.start()},this.initResolution=function(){this.resolutionController=new alex.utils.Resolution;var forceResolution=this.config.RESOLUTION||-1,system=alex.utils.system,version=system.osVersion;(system.isIOS&&6>version||system.isAndroid&&4>version||system.isAndroidStock)&&(forceResolution=1),this.resolutionController.init({forceResolution:forceResolution,renderer:this.pixiStage.renderer,interactionManager:this.pixiStage.stage.interactionManager}),2===alex.statics.SCALE_MODE?(alex.statics.setIpad(),this.resolutionController.setByWidth()):(alex.statics.setIphone(),this.resolutionController.setByHeight())},this.updateGame=function(delta){TWEEN.update(this.runLoop.currentTime),this.updateList.update(delta),this.screenMgr.update(delta),this.sndMgr.update(delta),this.eventQueue.dispatchQueuedEvents()}},alex.GenericGame.prototype.createSoundManager=function(){this.sndMgr=new alex.audio.SndMgr;var sndConfig={};sndConfig.isIOS=alex.utils.system.isIOS,sndConfig.context=null,sndConfig.audioType=game_shell.system.audioType,this.sndMgr.init(sndConfig)},alex.GenericGame.prototype.createViewport=function(){var statics=alex.statics,scaleMode=statics.SCALE_MODE||1,isMobile=alex.utils.system.isMobile;this.viewport=new alex.utils.Viewport,this.viewport.init({CHECK_ORIENTATION:statics.CHECK_ORIENTATION,DESKTOP_RESIZE:statics.DESKTOP_RESIZE,DEFAULT_W:statics.DEFAULT_W,DEFAULT_H:statics.DEFAULT_H,MIN_W:statics.MIN_W,MIN_H:statics.MIN_H,STAGE_W:statics.STAGE_W,STAGE_H:statics.STAGE_H,iframeMode:statics.IFRAME_MODE,orientation:statics.orientation,isMobile:isMobile,scaleMode:scaleMode,rotateImg:document.getElementById("rotate"),gameDiv:document.getElementById("game")});var self=this;this.viewport.addEventListener("resize",function(event){if(self.pauseGame.onResized.call(self.pauseGame,event),!event.wrongOrientation){var settings=event.settings;statics.STAGE_W=settings.pointWidth,statics.STAGE_H=settings.pointHeight,self.pixiStage.resize(settings),self.screenMgr.resize(settings)}isMobile&&window.scrollTo(0,1)}),this.viewport.resize()},PIXI.DisplayObject.prototype.removeFromParent=function(){this.parent&&this.parent.removeChild(this)},PIXI.DisplayObjectContainer.prototype.contains=function(child){return this.children.indexOf(child)>-1},PIXI.Text.prototype.numLines=1,PIXI.Text.prototype.wordWrap=function(text){this.numLines=1;for(var result="",lines=text.split("\n"),i=0;i<lines.length;i++){for(var spaceLeft=this.style.wordWrapWidth,words=lines[i].split(" "),j=0;j<words.length;j++){var wordWidth=this.context.measureText(words[j]).width,wordWidthWithSpace=wordWidth+this.context.measureText(" ").width;0===j||wordWidthWithSpace>spaceLeft?(j>0&&(result+="\n",this.numLines++),result+=words[j],spaceLeft=this.style.wordWrapWidth-wordWidth):(spaceLeft-=wordWidthWithSpace,result+=" "+words[j])}i<lines.length-1&&(result+="\n",this.numLines++)}return result},PIXI.BitmapText.prototype.numLines=1,PIXI.BitmapText.prototype.updateText=function(){this.characters||(this.characters=[]);
for(var data=PIXI.BitmapText.fonts[this.fontName],pos=new PIXI.Point,prevCharCode=null,chars=[],maxLineWidth=0,lineWidths=[],line=0,scale=this.fontSize/data.size,i=0;i<this.text.length;i++){var charCode=this.text.charCodeAt(i);if(/(?:\r\n|\r|\n)/.test(this.text.charAt(i)))lineWidths.push(pos.x),maxLineWidth=Math.max(maxLineWidth,pos.x),line++,pos.x=0,pos.y+=data.lineHeight,prevCharCode=null;else{var charData=data.chars[charCode];charData&&(prevCharCode&&charData.kerning[prevCharCode]&&(pos.x+=charData.kerning[prevCharCode]),chars.push({texture:charData.texture,line:line,charCode:charCode,position:new PIXI.Point(pos.x+charData.xOffset,pos.y+charData.yOffset)}),pos.x+=charData.xAdvance,prevCharCode=charCode)}}lineWidths.push(pos.x),maxLineWidth=Math.max(maxLineWidth,pos.x),this.numLines=line+1;var lineAlignOffsets=[];for(i=0;line>=i;i++){var alignOffset=0;"right"===this.style.align?alignOffset=maxLineWidth-lineWidths[i]:"center"===this.style.align&&(alignOffset=(maxLineWidth-lineWidths[i])/2),lineAlignOffsets.push(alignOffset)}var lenChildren=this.children.length,lenChars=chars.length,tint=this.tint||16777215;for(this.characters.length=0,i=0;lenChars>i;i++){var c=lenChildren>i?this.children[i]:this._pool.pop();c?c.setTexture(chars[i].texture):c=new PIXI.Sprite(chars[i].texture),c.position.x=(chars[i].position.x+lineAlignOffsets[chars[i].line])*scale,c.position.y=chars[i].position.y*scale,c.scale.x=c.scale.y=scale,c.tint=tint,c.parent||this.addChild(c),this.characters[i]=c}for(;this.children.length>lenChars;){var child=this.getChildAt(this.children.length-1);this._pool.push(child),this.removeChild(child)}this.textWidth=maxLineWidth*scale,this.textHeight=(pos.y+data.lineHeight)*scale},PIXI.Spine.prototype.updateTransform=function(){PIXI.DisplayObjectContainer.prototype.updateTransform.call(this)},PIXI.Spine.prototype.update=function(delta){if(!this.paused){this.state.update(.001*delta),this.state.apply(this.skeleton),this.skeleton.updateWorldTransform();for(var drawOrder=this.skeleton.drawOrder,i=0,n=drawOrder.length;n>i;i++){var slot=drawOrder[i],attachment=slot.attachment,slotContainer=this.slotContainers[i];if(attachment){var type=attachment.type;if(type===spine.AttachmentType.region){if(attachment.rendererObject&&(!slot.currentSpriteName||slot.currentSpriteName!==attachment.name)){var spriteName=attachment.rendererObject.name;if(void 0!==slot.currentSprite&&(slot.currentSprite.visible=!1),slot.sprites=slot.sprites||{},void 0!==slot.sprites[spriteName])slot.sprites[spriteName].visible=!0;else{var sprite=this.createSprite(slot,attachment);slotContainer.addChild(sprite)}slot.currentSprite=slot.sprites[spriteName],slot.currentSpriteName=spriteName}var bone=slot.bone;slotContainer.position.x=bone.worldX+attachment.x*bone.m00+attachment.y*bone.m01,slotContainer.position.y=bone.worldY+attachment.x*bone.m10+attachment.y*bone.m11,slotContainer.scale.x=bone.worldScaleX,slotContainer.scale.y=bone.worldScaleY,slotContainer.rotation=-(slot.bone.worldRotation*spine.degRad),slot.currentSprite.tint=PIXI.rgb2hex([slot.r,slot.g,slot.b])}else{if(type!==spine.AttachmentType.skinnedmesh){slotContainer.visible=!1;continue}if(!slot.currentMeshName||slot.currentMeshName!==attachment.name){var meshName=attachment.name;if(void 0!==slot.currentMesh&&(slot.currentMesh.visible=!1),slot.meshes=slot.meshes||{},void 0!==slot.meshes[meshName])slot.meshes[meshName].visible=!0;else{var mesh=this.createMesh(slot,attachment);slotContainer.addChild(mesh)}slot.currentMesh=slot.meshes[meshName],slot.currentMeshName=meshName}attachment.computeWorldVertices(slot.bone.skeleton.x,slot.bone.skeleton.y,slot,slot.currentMesh.vertices)}slotContainer.visible=!0,slotContainer.alpha=slot.a}else slotContainer.visible=!1}}},PIXI.BitmapFontLoader.prototype.onXMLLoaded=function(){if(4===this.ajaxRequest.readyState)if(404===this.ajaxRequest.status||0===this.ajaxRequest.status)this.onLoaded();else if(200===this.ajaxRequest.status||-1===window.location.protocol.indexOf("http")){var responseXML=this.ajaxRequest.responseXML;if(!responseXML||/MSIE 9/i.test(navigator.userAgent)||navigator.isCocoonJS)if("function"==typeof window.DOMParser){var domparser=new DOMParser;responseXML=domparser.parseFromString(this.ajaxRequest.responseText,"text/xml")}else{var div=document.createElement("div");div.innerHTML=this.ajaxRequest.responseText,responseXML=div}var imgFilename=responseXML.getElementsByTagName("page")[0].getAttribute("file"),textureUrl=this.baseUrl+imgFilename,image=new PIXI.ImageLoader(textureUrl,this.crossorigin);this.texture=image.texture.baseTexture;var data={},info=responseXML.getElementsByTagName("info")[0],common=responseXML.getElementsByTagName("common")[0];data.font=info.getAttribute("face"),this.fontName=data.font,this.fontData=data,data.size=parseInt(info.getAttribute("size"),10),data.lineHeight=parseInt(common.getAttribute("lineHeight"),10),data.chars={};for(var letters=responseXML.getElementsByTagName("char"),i=0;i<letters.length;i++){var charCode=parseInt(letters[i].getAttribute("id"),10),textureRect=new PIXI.Rectangle(parseInt(letters[i].getAttribute("x"),10),parseInt(letters[i].getAttribute("y"),10),parseInt(letters[i].getAttribute("width"),10),parseInt(letters[i].getAttribute("height"),10));data.chars[charCode]={xOffset:parseInt(letters[i].getAttribute("xoffset"),10),yOffset:parseInt(letters[i].getAttribute("yoffset"),10),xAdvance:parseInt(letters[i].getAttribute("xadvance"),10),kerning:{},texture:PIXI.TextureCache[charCode]=new PIXI.Texture(this.texture,textureRect)}}var kernings=responseXML.getElementsByTagName("kerning");for(i=0;i<kernings.length;i++){var first=parseInt(kernings[i].getAttribute("first"),10),second=parseInt(kernings[i].getAttribute("second"),10),amount=parseInt(kernings[i].getAttribute("amount"),10);data.chars[second].kerning[first]=amount}PIXI.BitmapText.fonts[data.font]=data,image.addEventListener("loaded",this.onLoaded.bind(this)),image.load()}},PIXI.MovieClip=function(textures){PIXI.Sprite.call(this,textures[0]),alex.utils.EventDispatcher.prototype.apply(this),this.textures=textures,this.loop=!0,this._fps=25,this.onComplete=null,this.currentFrame=0,this.currentTime=0,this.playing=!1,this.duration=0,this.lastFrame=0,this.setDuration()},PIXI.MovieClip.prototype=Object.create(PIXI.Sprite.prototype),PIXI.MovieClip.prototype.constructor=PIXI.MovieClip,Object.defineProperty(PIXI.MovieClip.prototype,"totalFrames",{get:function(){return this.textures.length}}),Object.defineProperty(PIXI.MovieClip.prototype,"fps",{get:function(){return this._fps},set:function(value){this._fps=value,this.setDuration()}}),PIXI.MovieClip.prototype.stop=function(){this.playing=!1},PIXI.MovieClip.prototype.play=function(){this.playing=!0},PIXI.MovieClip.prototype.setFPS=function(fps){this._fps=fps,this.setDuration()},PIXI.MovieClip.prototype.updateTransform=function(){PIXI.Sprite.prototype.updateTransform.call(this)},PIXI.MovieClip.prototype.setDuration=function(){var l=this.textures.length;this.duration=1e3/this._fps*l,this.lastFrame=l-1},PIXI.MovieClip.prototype.update=function(elapsed){if(this.playing){this.currentTime+=elapsed,this.currentTime>this.duration&&(this.loop?this.currentTime-=this.duration:(this.currentTime=this.duration,this.stop(),this.isComplete=!0,this.onComplete&&this.onComplete(),this.dispatchEvent({type:"complete"})));var frameIndex=Math.floor(this.currentTime/this.duration*(this.lastFrame+1));frameIndex>this.lastFrame&&(frameIndex=this.lastFrame),this.currentFrame=frameIndex,this.setTexture(this.textures[this.currentFrame])}},PIXI.MovieClip.prototype.gotoAndStop=function(frameNumber){this.playing=!1,this.currentTime=frameNumber*(1e3/this._fps),this.currentFrame=frameNumber;var round=this.currentFrame+.5|0;this.setTexture(this.textures[round%this.textures.length])},PIXI.MovieClip.prototype.gotoAndPlay=function(frameNumber){this.gotoAndStop(frameNumber),this.playing=!0},PIXI.BaseTexture.fromImage=function(imageUrl,crossorigin,scaleMode){var baseTexture=PIXI.BaseTextureCache[imageUrl];if(void 0===crossorigin&&-1===imageUrl.indexOf("data:")&&(crossorigin=!0),!baseTexture){var image=new Image;crossorigin&&(image.crossOrigin=""),image.src=imageUrl,baseTexture=new PIXI.BaseTexture(image,scaleMode),baseTexture.imageUrl=imageUrl,PIXI.BaseTextureCache[imageUrl]=baseTexture,-1!==imageUrl.indexOf(PIXI.RETINA_PREFIX+".")?baseTexture.resolution=2:-1!==imageUrl.indexOf("@4x.")&&(baseTexture.resolution=4)}return baseTexture},alex.utils.TweenGroup=function(){alex.utils.UpdateList.call(this)},alex.utils.TweenGroup.prototype=Object.create(alex.utils.UpdateList.prototype),alex.utils.TweenGroup.prototype.update=function(p_delta){for(var item,isComplete,n=this.updateItems.length,i=n-1;i>-1;i--)item=this.updateItems[i],isComplete=item.update(p_delta),isComplete&&(this.removeItems[this.removeItems.length]=item);if(n=this.removeItems.length,n>0){for(i=0;n>i;i++)item=this.removeItems[i],this._remove(item);this.removeItems.length=0}},void 0===Date.now&&(Date.now=function(){return(new Date).valueOf()});var TWEEN=TWEEN||function(){var _tweens=[];return{REVISION:"14",getAll:function(){return _tweens},removeAll:function(){_tweens=[]},pausedTweens:[],pauseTime:-1,pause:function(){this.pausedTweens=_tweens.slice(),this.removeAll(),this.pauseTime=Date.now()},unpause:function(){for(var tween,unpauseTime=Date.now(),pauseDuration=unpauseTime-this.pauseTime,numTweens=this.pausedTweens.length,i=0;numTweens>i;i++)tween=this.pausedTweens[i],tween.restart(pauseDuration),this.add(tween);this.pausedTweens.length=0},add:function(tween){_tweens.push(tween)},remove:function(tween){var i=_tweens.indexOf(tween);-1!==i&&_tweens.splice(i,1)},update:function(time){if(0===_tweens.length)return!1;for(var i=0;i<_tweens.length;)_tweens[i].update(time)?i++:_tweens.splice(i,1);return!0}}}();TWEEN.Tween=function(object){var _object=object,_valuesStart={},_valuesEnd={},_valuesStartRepeat={},_duration=1e3,_repeat=0,_yoyo=!1,_isPlaying=!1,_reversed=!1,_delayTime=0,_startTime=null,_easingFunction=TWEEN.Easing.Linear.None,_interpolationFunction=TWEEN.Interpolation.Linear,_chainedTweens=[],_onStartCallback=null,_onStartCallbackFired=!1,_onUpdateCallback=null,_onCompleteCallback=null,_onStopCallback=null;for(var field in object)_valuesStart[field]=parseFloat(object[field],10);this.to=function(properties,duration){return void 0!==duration&&(_duration=duration),_valuesEnd=properties,this},this.start=function(time){TWEEN.add(this),this._start(time)},this._start=function(time){_isPlaying=!0,_onStartCallbackFired=!1,_startTime=void 0!==time?time:Date.now(),_startTime+=_delayTime;for(var property in _valuesEnd){if(_valuesEnd[property]instanceof Array){if(0===_valuesEnd[property].length)continue;_valuesEnd[property]=[_object[property]].concat(_valuesEnd[property])}_valuesStart[property]=_object[property],_valuesStart[property]instanceof Array==!1&&(_valuesStart[property]*=1),_valuesStartRepeat[property]=_valuesStart[property]||0}return this},this.stop=function(){return _isPlaying?(TWEEN.remove(this),_isPlaying=!1,null!==_onStopCallback&&_onStopCallback.call(_object),this.stopChainedTweens(),this):this},this.stopChainedTweens=function(){for(var i=0,numChainedTweens=_chainedTweens.length;numChainedTweens>i;i++)_chainedTweens[i].stop()},this.delay=function(amount){return _delayTime=amount,this},this.repeat=function(times){return _repeat=times,this},this.yoyo=function(yoyo){return _yoyo=yoyo,this},this.easing=function(easing){return _easingFunction=easing,this},this.interpolation=function(interpolation){return _interpolationFunction=interpolation,this},this.chain=function(){return _chainedTweens=arguments,this},this.onStart=function(callback){return _onStartCallback=callback,this},this.onUpdate=function(callback){return _onUpdateCallback=callback,this},this.onComplete=function(callback){return _onCompleteCallback=callback,this},this.onStop=function(callback){return _onStopCallback=callback,this},this.restart=function(pause_duration){_startTime+=pause_duration},this.changeDuration=function(new_duration){_duration=new_duration},this.update=function(time){var property;if(_startTime>time)return!0;_onStartCallbackFired===!1&&(null!==_onStartCallback&&_onStartCallback.call(_object),_onStartCallbackFired=!0);var elapsed=(time-_startTime)/_duration;elapsed=elapsed>1?1:elapsed;var value=_easingFunction(elapsed);for(property in _valuesEnd){var start=_valuesStart[property]||0,end=_valuesEnd[property];end instanceof Array?_object[property]=_interpolationFunction(end,value):("string"==typeof end&&(end=start+parseFloat(end,10)),"number"==typeof end&&(_object[property]=start+(end-start)*value))}if(null!==_onUpdateCallback&&_onUpdateCallback.call(_object,value),1===elapsed){if(_repeat>0){isFinite(_repeat)&&_repeat--;for(property in _valuesStartRepeat){if("string"==typeof _valuesEnd[property]&&(_valuesStartRepeat[property]=_valuesStartRepeat[property]+parseFloat(_valuesEnd[property],10)),_yoyo){var tmp=_valuesStartRepeat[property];_valuesStartRepeat[property]=_valuesEnd[property],_valuesEnd[property]=tmp}_valuesStart[property]=_valuesStartRepeat[property]}return _yoyo&&(_reversed=!_reversed),_startTime=time+_delayTime,!0}null!==_onCompleteCallback&&_onCompleteCallback.call(_object);for(var i=0,numChainedTweens=_chainedTweens.length;numChainedTweens>i;i++)_chainedTweens[i].start(time);return!1}return!0}},TWEEN.UpdateTween=function(object){var self=TWEEN.Tween.call(this,object);return this.passedTime=0,this.isCompleted=!0,this.baseUpdate=this.update,this.baseStart=this._start,this.start=function(delta){return this.isCompleted=!1,this.passedTime=Date.now(),this.baseStart(),this},this.update=function(delta){return this.isCompleted||(this.passedTime+=delta,this.isCompleted=!this.baseUpdate(this.passedTime)),this.isCompleted,this.isCompleted},self},TWEEN.Easing={Linear:{None:function(k){return k}},Quadratic:{In:function(k){return k*k},Out:function(k){return k*(2-k)},InOut:function(k){return(k*=2)<1?.5*k*k:-.5*(--k*(k-2)-1)}},Cubic:{In:function(k){return k*k*k},Out:function(k){return--k*k*k+1},InOut:function(k){return(k*=2)<1?.5*k*k*k:.5*((k-=2)*k*k+2)}},Quartic:{In:function(k){return k*k*k*k},Out:function(k){return 1- --k*k*k*k},InOut:function(k){return(k*=2)<1?.5*k*k*k*k:-.5*((k-=2)*k*k*k-2)}},Quintic:{In:function(k){return k*k*k*k*k},Out:function(k){return--k*k*k*k*k+1},InOut:function(k){return(k*=2)<1?.5*k*k*k*k*k:.5*((k-=2)*k*k*k*k+2)}},Sinusoidal:{In:function(k){return 1-Math.cos(k*Math.PI/2)},Out:function(k){return Math.sin(k*Math.PI/2)},InOut:function(k){return.5*(1-Math.cos(Math.PI*k))}},Exponential:{In:function(k){return 0===k?0:Math.pow(1024,k-1)},Out:function(k){return 1===k?1:1-Math.pow(2,-10*k)},InOut:function(k){return 0===k?0:1===k?1:(k*=2)<1?.5*Math.pow(1024,k-1):.5*(-Math.pow(2,-10*(k-1))+2)}},Circular:{In:function(k){return 1-Math.sqrt(1-k*k)},Out:function(k){return Math.sqrt(1- --k*k)},InOut:function(k){return(k*=2)<1?-.5*(Math.sqrt(1-k*k)-1):.5*(Math.sqrt(1-(k-=2)*k)+1)}},Elastic:{In:function(k){var s,a=.1,p=.4;return 0===k?0:1===k?1:(!a||1>a?(a=1,s=p/4):s=p*Math.asin(1/a)/(2*Math.PI),-(a*Math.pow(2,10*(k-=1))*Math.sin(2*(k-s)*Math.PI/p)))},Out:function(k){var s,a=.1,p=.4;return 0===k?0:1===k?1:(!a||1>a?(a=1,s=p/4):s=p*Math.asin(1/a)/(2*Math.PI),a*Math.pow(2,-10*k)*Math.sin(2*(k-s)*Math.PI/p)+1)},InOut:function(k){var s,a=.1,p=.4;return 0===k?0:1===k?1:(!a||1>a?(a=1,s=p/4):s=p*Math.asin(1/a)/(2*Math.PI),(k*=2)<1?-.5*a*Math.pow(2,10*(k-=1))*Math.sin(2*(k-s)*Math.PI/p):a*Math.pow(2,-10*(k-=1))*Math.sin(2*(k-s)*Math.PI/p)*.5+1)}},Back:{In:function(k){var s=1.70158;return k*k*((s+1)*k-s)},Out:function(k){var s=1.70158;return--k*k*((s+1)*k+s)+1},InOut:function(k){var s=2.5949095;return(k*=2)<1?.5*k*k*((s+1)*k-s):.5*((k-=2)*k*((s+1)*k+s)+2)}},Bounce:{In:function(k){return 1-TWEEN.Easing.Bounce.Out(1-k)},Out:function(k){return 1/2.75>k?7.5625*k*k:2/2.75>k?7.5625*(k-=1.5/2.75)*k+.75:2.5/2.75>k?7.5625*(k-=2.25/2.75)*k+.9375:7.5625*(k-=2.625/2.75)*k+.984375},InOut:function(k){return.5>k?.5*TWEEN.Easing.Bounce.In(2*k):.5*TWEEN.Easing.Bounce.Out(2*k-1)+.5}}},TWEEN.Interpolation={Linear:function(v,k){var m=v.length-1,f=m*k,i=Math.floor(f),fn=TWEEN.Interpolation.Utils.Linear;return 0>k?fn(v[0],v[1],f):k>1?fn(v[m],v[m-1],m-f):fn(v[i],v[i+1>m?m:i+1],f-i)},Bezier:function(v,k){var i,b=0,n=v.length-1,pw=Math.pow,bn=TWEEN.Interpolation.Utils.Bernstein;for(i=0;n>=i;i++)b+=pw(1-k,n-i)*pw(k,i)*v[i]*bn(n,i);return b},CatmullRom:function(v,k){var m=v.length-1,f=m*k,i=Math.floor(f),fn=TWEEN.Interpolation.Utils.CatmullRom;return v[0]===v[m]?(0>k&&(i=Math.floor(f=m*(1+k))),fn(v[(i-1+m)%m],v[i],v[(i+1)%m],v[(i+2)%m],f-i)):0>k?v[0]-(fn(v[0],v[0],v[1],v[1],-f)-v[0]):k>1?v[m]-(fn(v[m],v[m],v[m-1],v[m-1],f-m)-v[m]):fn(v[i?i-1:0],v[i],v[i+1>m?m:i+1],v[i+2>m?m:i+2],f-i)},Utils:{Linear:function(p0,p1,t){return(p1-p0)*t+p0},Bernstein:function(n,i){var fc=TWEEN.Interpolation.Utils.Factorial;return fc(n)/fc(i)/fc(n-i)},Factorial:function(){var a=[1];return function(n){var i,s=1;if(a[n])return a[n];for(i=n;i>1;i--)s*=i;return a[n]=s}}(),CatmullRom:function(p0,p1,p2,p3,t){var v0=.5*(p2-p0),v1=.5*(p3-p1),t2=t*t,t3=t*t2;return(2*p1-2*p2+v0+v1)*t3+(-3*p1+3*p2-2*v0-v1)*t2+v0*t+p1}}},"undefined"!=typeof module&&module.exports&&(module.exports=TWEEN);var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __},dragonBones;!function(dragonBones){!function(geom){var Point=function(){function Point(x,y){"undefined"==typeof x&&(x=0),"undefined"==typeof y&&(y=0),this.x=x,this.y=y}return Point.prototype.toString=function(){return"[Point (x="+this.x+" y="+this.y+")]"},Point}();geom.Point=Point;var Rectangle=function(){function Rectangle(x,y,width,height){"undefined"==typeof x&&(x=0),"undefined"==typeof y&&(y=0),"undefined"==typeof width&&(width=0),"undefined"==typeof height&&(height=0),this.x=x,this.y=y,this.width=width,this.height=height}return Rectangle}();geom.Rectangle=Rectangle;var Matrix=function(){function Matrix(){this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0}return Matrix.prototype.invert=function(){var a1=this.a,b1=this.b,c1=this.c,d1=this.d,tx1=this.tx,n=a1*d1-b1*c1;this.a=d1/n,this.b=-b1/n,this.c=-c1/n,this.d=a1/n,this.tx=(c1*this.ty-d1*tx1)/n,this.ty=-(a1*this.ty-b1*tx1)/n},Matrix}();geom.Matrix=Matrix;var ColorTransform=function(){function ColorTransform(){this.alphaMultiplier=0,this.alphaOffset=0,this.blueMultiplier=0,this.blueOffset=0,this.greenMultiplier=0,this.greenOffset=0,this.redMultiplier=0,this.redOffset=0}return ColorTransform}();geom.ColorTransform=ColorTransform}(dragonBones.geom||(dragonBones.geom={}));var geom=dragonBones.geom;!function(events){var Event=function(){function Event(type){this.type=type}return Event}();events.Event=Event;var AnimationEvent=function(_super){function AnimationEvent(type){_super.call(this,type)}return __extends(AnimationEvent,_super),AnimationEvent.FADE_IN="fadeIn",AnimationEvent.FADE_OUT="fadeOut",AnimationEvent.START="start",AnimationEvent.COMPLETE="complete",AnimationEvent.LOOP_COMPLETE="loopComplete",AnimationEvent.FADE_IN_COMPLETE="fadeInComplete",AnimationEvent.FADE_OUT_COMPLETE="fadeOutComplete",AnimationEvent}(Event);events.AnimationEvent=AnimationEvent;var ArmatureEvent=function(_super){function ArmatureEvent(type){_super.call(this,type)}return __extends(ArmatureEvent,_super),ArmatureEvent.Z_ORDER_UPDATED="zOrderUpdated",ArmatureEvent}(Event);events.ArmatureEvent=ArmatureEvent;var FrameEvent=function(_super){function FrameEvent(type){_super.call(this,type)}return __extends(FrameEvent,_super),FrameEvent.ANIMATION_FRAME_EVENT="animationFrameEvent",FrameEvent.BONE_FRAME_EVENT="boneFrameEvent",FrameEvent}(Event);events.FrameEvent=FrameEvent;var SoundEvent=function(_super){function SoundEvent(type){_super.call(this,type)}return __extends(SoundEvent,_super),SoundEvent.SOUND="sound",SoundEvent.BONE_FRAME_EVENT="boneFrameEvent",SoundEvent}(Event);events.SoundEvent=SoundEvent;var EventDispatcher=function(){function EventDispatcher(){}return EventDispatcher.prototype.hasEventListener=function(type){return this._listenersMap&&this._listenersMap[type]?!0:!1},EventDispatcher.prototype.addEventListener=function(type,listener){if(type&&listener){this._listenersMap||(this._listenersMap={});var listeners=this._listenersMap[type];listeners&&this.removeEventListener(type,listener),listeners?listeners.push(listener):this._listenersMap[type]=[listener]}},EventDispatcher.prototype.removeEventListener=function(type,listener){if(this._listenersMap&&type&&listener){var listeners=this._listenersMap[type];if(listeners)for(var length=listeners.length,i=0;length>i;i++)listeners[i]==listener&&(1==length?(listeners.length=0,delete this._listenersMap[type]):listeners.splice(i,1))}},EventDispatcher.prototype.removeAllEventListeners=function(type){type?delete this._listenersMap[type]:this._listenersMap=null},EventDispatcher.prototype.dispatchEvent=function(event){if(event){var listeners=this._listenersMap[event.type];if(listeners){event.target=this;for(var listenersCopy=listeners.concat(),length=listeners.length,i=0;length>i;i++)listenersCopy[i](event)}}},EventDispatcher}();events.EventDispatcher=EventDispatcher;var SoundEventManager=function(_super){function SoundEventManager(){if(_super.call(this),SoundEventManager._instance)throw new Error("Singleton already constructed!")}return __extends(SoundEventManager,_super),SoundEventManager.getInstance=function(){return SoundEventManager._instance||(SoundEventManager._instance=new SoundEventManager),SoundEventManager._instance},SoundEventManager}(EventDispatcher);events.SoundEventManager=SoundEventManager}(dragonBones.events||(dragonBones.events={}));var events=dragonBones.events;!function(animation){var WorldClock=function(){function WorldClock(){this.timeScale=1,this.time=.001*(new Date).getTime(),this._animatableList=[]}return WorldClock.prototype.contains=function(animatable){return this._animatableList.indexOf(animatable)>=0},WorldClock.prototype.add=function(animatable){animatable&&-1==this._animatableList.indexOf(animatable)&&this._animatableList.push(animatable)},WorldClock.prototype.remove=function(animatable){var index=this._animatableList.indexOf(animatable);index>=0&&(this._animatableList[index]=null)},WorldClock.prototype.clear=function(){this._animatableList.length=0},WorldClock.prototype.advanceTime=function(passedTime){if(0>passedTime){var currentTime=.001*(new Date).getTime();passedTime=currentTime-this.time,this.time=currentTime}passedTime*=this.timeScale;var length=this._animatableList.length;if(0!=length){for(var currentIndex=0,i=0;length>i;i++){var animatable=this._animatableList[i];animatable&&(currentIndex!=i&&(this._animatableList[currentIndex]=animatable,this._animatableList[i]=null),animatable.advanceTime(passedTime),currentIndex++)}if(currentIndex!=i){for(length=this._animatableList.length;length>i;)this._animatableList[currentIndex++]=this._animatableList[i++];this._animatableList.length=currentIndex}}},WorldClock.clock=new WorldClock,WorldClock}();animation.WorldClock=WorldClock;var TimelineState=function(){function TimelineState(){this.transform=new objects.DBTransform,this.pivot=new geom.Point,this._durationTransform=new objects.DBTransform,this._durationPivot=new geom.Point,this._durationColor=new geom.ColorTransform}return TimelineState._borrowObject=function(){return 0==TimelineState._pool.length?new TimelineState:TimelineState._pool.pop()},TimelineState._returnObject=function(timeline){TimelineState._pool.indexOf(timeline)<0&&(TimelineState._pool[TimelineState._pool.length]=timeline),timeline.clear()},TimelineState._clear=function(){for(var i=TimelineState._pool.length;i--;)TimelineState._pool[i].clear();TimelineState._pool.length=0},TimelineState.getEaseValue=function(value,easing){if(easing>1){var valueEase=.5*(1-Math.cos(value*Math.PI))-value;easing-=1}else easing>0?valueEase=Math.sin(value*TimelineState.HALF_PI)-value:0>easing&&(valueEase=1-Math.cos(value*TimelineState.HALF_PI)-value,easing*=-1);return valueEase*easing+value},TimelineState.prototype.fadeIn=function(bone,animationState,timeline){switch(this._bone=bone,this._animationState=animationState,this._timeline=timeline,this._originTransform=this._timeline.originTransform,this._originPivot=this._timeline.originPivot,this._tweenTransform=!1,this._tweenColor=!1,this._totalTime=this._animationState.totalTime,this.transform.x=0,this.transform.y=0,this.transform.scaleX=0,this.transform.scaleY=0,this.transform.skewX=0,this.transform.skewY=0,this.pivot.x=0,this.pivot.y=0,this._durationTransform.x=0,this._durationTransform.y=0,this._durationTransform.scaleX=0,this._durationTransform.scaleY=0,this._durationTransform.skewX=0,this._durationTransform.skewY=0,this._durationPivot.x=0,this._durationPivot.y=0,this._currentFrame=null,this._timeline.getFrameList().length){case 0:this._bone._arriveAtFrame(null,this,this._animationState,!1),this._updateState=0;break;case 1:this._updateState=-1;break;default:this._updateState=1}},TimelineState.prototype.fadeOut=function(){this.transform.skewX=utils.TransformUtil.formatRadian(this.transform.skewX),this.transform.skewY=utils.TransformUtil.formatRadian(this.transform.skewY)},TimelineState.prototype.update=function(progress){if(this._updateState)if(this._updateState>0){0==this._timeline.scale?progress=1:progress/=this._timeline.scale,1==progress&&(progress=.99999999),progress+=this._timeline.offset;var loopCount=Math.floor(progress);progress-=loopCount;for(var frameIndex,playedTime=this._totalTime*progress,isArrivedFrame=!1;!this._currentFrame||playedTime>this._currentFramePosition+this._currentFrameDuration||playedTime<this._currentFramePosition;)isArrivedFrame&&this._bone._arriveAtFrame(this._currentFrame,this,this._animationState,!0),isArrivedFrame=!0,this._currentFrame?(frameIndex=this._timeline.getFrameList().indexOf(this._currentFrame)+1,frameIndex>=this._timeline.getFrameList().length&&(frameIndex=0),this._currentFrame=this._timeline.getFrameList()[frameIndex]):(frameIndex=0,this._currentFrame=this._timeline.getFrameList()[0]),this._currentFrameDuration=this._currentFrame.duration,this._currentFramePosition=this._currentFrame.position;if(isArrivedFrame){this.tweenActive=this._currentFrame.displayIndex>=0,frameIndex++,frameIndex>=this._timeline.getFrameList().length&&(frameIndex=0);var nextFrame=this._timeline.getFrameList()[frameIndex];0==frameIndex&&this._animationState.loop&&this._animationState.loopCount>=Math.abs(this._animationState.loop)-1&&((this._currentFramePosition+this._currentFrameDuration)/this._totalTime+loopCount-this._timeline.offset)*this._timeline.scale>.99999999?(this._updateState=0,this._tweenEasing=NaN):this._currentFrame.displayIndex<0||nextFrame.displayIndex<0||!this._animationState.tweenEnabled?this._tweenEasing=NaN:isNaN(this._animationState.clip.tweenEasing)?this._tweenEasing=this._currentFrame.tweenEasing:this._tweenEasing=this._animationState.clip.tweenEasing,isNaN(this._tweenEasing)?(this._tweenTransform=!1,this._tweenColor=!1):(this._durationTransform.x=nextFrame.transform.x-this._currentFrame.transform.x,this._durationTransform.y=nextFrame.transform.y-this._currentFrame.transform.y,this._durationTransform.skewX=nextFrame.transform.skewX-this._currentFrame.transform.skewX,this._durationTransform.skewY=nextFrame.transform.skewY-this._currentFrame.transform.skewY,this._durationTransform.scaleX=nextFrame.transform.scaleX-this._currentFrame.transform.scaleX,this._durationTransform.scaleY=nextFrame.transform.scaleY-this._currentFrame.transform.scaleY,0==frameIndex&&(this._durationTransform.skewX=utils.TransformUtil.formatRadian(this._durationTransform.skewX),this._durationTransform.skewY=utils.TransformUtil.formatRadian(this._durationTransform.skewY)),this._durationPivot.x=nextFrame.pivot.x-this._currentFrame.pivot.x,this._durationPivot.y=nextFrame.pivot.y-this._currentFrame.pivot.y,0!=this._durationTransform.x||0!=this._durationTransform.y||0!=this._durationTransform.skewX||0!=this._durationTransform.skewY||0!=this._durationTransform.scaleX||0!=this._durationTransform.scaleY||0!=this._durationPivot.x||0!=this._durationPivot.y?this._tweenTransform=!0:this._tweenTransform=!1,this._currentFrame.color&&nextFrame.color?(this._durationColor.alphaOffset=nextFrame.color.alphaOffset-this._currentFrame.color.alphaOffset,this._durationColor.redOffset=nextFrame.color.redOffset-this._currentFrame.color.redOffset,this._durationColor.greenOffset=nextFrame.color.greenOffset-this._currentFrame.color.greenOffset,this._durationColor.blueOffset=nextFrame.color.blueOffset-this._currentFrame.color.blueOffset,this._durationColor.alphaMultiplier=nextFrame.color.alphaMultiplier-this._currentFrame.color.alphaMultiplier,this._durationColor.redMultiplier=nextFrame.color.redMultiplier-this._currentFrame.color.redMultiplier,this._durationColor.greenMultiplier=nextFrame.color.greenMultiplier-this._currentFrame.color.greenMultiplier,this._durationColor.blueMultiplier=nextFrame.color.blueMultiplier-this._currentFrame.color.blueMultiplier,0!=this._durationColor.alphaOffset||0!=this._durationColor.redOffset||0!=this._durationColor.greenOffset||0!=this._durationColor.blueOffset||0!=this._durationColor.alphaMultiplier||0!=this._durationColor.redMultiplier||0!=this._durationColor.greenMultiplier||0!=this._durationColor.blueMultiplier?this._tweenColor=!0:this._tweenColor=!1):this._currentFrame.color?(this._tweenColor=!0,this._durationColor.alphaOffset=-this._currentFrame.color.alphaOffset,this._durationColor.redOffset=-this._currentFrame.color.redOffset,this._durationColor.greenOffset=-this._currentFrame.color.greenOffset,this._durationColor.blueOffset=-this._currentFrame.color.blueOffset,this._durationColor.alphaMultiplier=1-this._currentFrame.color.alphaMultiplier,this._durationColor.redMultiplier=1-this._currentFrame.color.redMultiplier,this._durationColor.greenMultiplier=1-this._currentFrame.color.greenMultiplier,this._durationColor.blueMultiplier=1-this._currentFrame.color.blueMultiplier):nextFrame.color?(this._tweenColor=!0,this._durationColor.alphaOffset=nextFrame.color.alphaOffset,this._durationColor.redOffset=nextFrame.color.redOffset,this._durationColor.greenOffset=nextFrame.color.greenOffset,this._durationColor.blueOffset=nextFrame.color.blueOffset,this._durationColor.alphaMultiplier=nextFrame.color.alphaMultiplier-1,this._durationColor.redMultiplier=nextFrame.color.redMultiplier-1,this._durationColor.greenMultiplier=nextFrame.color.greenMultiplier-1,this._durationColor.blueMultiplier=nextFrame.color.blueMultiplier-1):this._tweenColor=!1),this._tweenTransform||(this._animationState.blend?(this.transform.x=this._originTransform.x+this._currentFrame.transform.x,this.transform.y=this._originTransform.y+this._currentFrame.transform.y,this.transform.skewX=this._originTransform.skewX+this._currentFrame.transform.skewX,this.transform.skewY=this._originTransform.skewY+this._currentFrame.transform.skewY,this.transform.scaleX=this._originTransform.scaleX+this._currentFrame.transform.scaleX,this.transform.scaleY=this._originTransform.scaleY+this._currentFrame.transform.scaleY,this.pivot.x=this._originPivot.x+this._currentFrame.pivot.x,this.pivot.y=this._originPivot.y+this._currentFrame.pivot.y):(this.transform.x=this._currentFrame.transform.x,this.transform.y=this._currentFrame.transform.y,this.transform.skewX=this._currentFrame.transform.skewX,this.transform.skewY=this._currentFrame.transform.skewY,this.transform.scaleX=this._currentFrame.transform.scaleX,this.transform.scaleY=this._currentFrame.transform.scaleY,this.pivot.x=this._currentFrame.pivot.x,this.pivot.y=this._currentFrame.pivot.y)),this._tweenColor||(this._currentFrame.color?this._bone._updateColor(this._currentFrame.color.alphaOffset,this._currentFrame.color.redOffset,this._currentFrame.color.greenOffset,this._currentFrame.color.blueOffset,this._currentFrame.color.alphaMultiplier,this._currentFrame.color.redMultiplier,this._currentFrame.color.greenMultiplier,this._currentFrame.color.blueMultiplier,!0):this._bone._isColorChanged&&this._bone._updateColor(0,0,0,0,1,1,1,1,!1)),
this._bone._arriveAtFrame(this._currentFrame,this,this._animationState,!1)}if((this._tweenTransform||this._tweenColor)&&(progress=(playedTime-this._currentFramePosition)/this._currentFrameDuration,this._tweenEasing&&(progress=TimelineState.getEaseValue(progress,this._tweenEasing))),this._tweenTransform){var currentTransform=this._currentFrame.transform,currentPivot=this._currentFrame.pivot;this._animationState.blend?(this.transform.x=this._originTransform.x+currentTransform.x+this._durationTransform.x*progress,this.transform.y=this._originTransform.y+currentTransform.y+this._durationTransform.y*progress,this.transform.skewX=this._originTransform.skewX+currentTransform.skewX+this._durationTransform.skewX*progress,this.transform.skewY=this._originTransform.skewY+currentTransform.skewY+this._durationTransform.skewY*progress,this.transform.scaleX=this._originTransform.scaleX+currentTransform.scaleX+this._durationTransform.scaleX*progress,this.transform.scaleY=this._originTransform.scaleY+currentTransform.scaleY+this._durationTransform.scaleY*progress,this.pivot.x=this._originPivot.x+currentPivot.x+this._durationPivot.x*progress,this.pivot.y=this._originPivot.y+currentPivot.y+this._durationPivot.y*progress):(this.transform.x=currentTransform.x+this._durationTransform.x*progress,this.transform.y=currentTransform.y+this._durationTransform.y*progress,this.transform.skewX=currentTransform.skewX+this._durationTransform.skewX*progress,this.transform.skewY=currentTransform.skewY+this._durationTransform.skewY*progress,this.transform.scaleX=currentTransform.scaleX+this._durationTransform.scaleX*progress,this.transform.scaleY=currentTransform.scaleY+this._durationTransform.scaleY*progress,this.pivot.x=currentPivot.x+this._durationPivot.x*progress,this.pivot.y=currentPivot.y+this._durationPivot.y*progress)}this._tweenColor&&(this._currentFrame.color?this._bone._updateColor(this._currentFrame.color.alphaOffset+this._durationColor.alphaOffset*progress,this._currentFrame.color.redOffset+this._durationColor.redOffset*progress,this._currentFrame.color.greenOffset+this._durationColor.greenOffset*progress,this._currentFrame.color.blueOffset+this._durationColor.blueOffset*progress,this._currentFrame.color.alphaMultiplier+this._durationColor.alphaMultiplier*progress,this._currentFrame.color.redMultiplier+this._durationColor.redMultiplier*progress,this._currentFrame.color.greenMultiplier+this._durationColor.greenMultiplier*progress,this._currentFrame.color.blueMultiplier+this._durationColor.blueMultiplier*progress,!0):this._bone._updateColor(this._durationColor.alphaOffset*progress,this._durationColor.redOffset*progress,this._durationColor.greenOffset*progress,this._durationColor.blueOffset*progress,1+this._durationColor.alphaMultiplier*progress,1+this._durationColor.redMultiplier*progress,1+this._durationColor.greenMultiplier*progress,1+this._durationColor.blueMultiplier*progress,!0))}else this._updateState=0,this._animationState.blend?(this.transform.copy(this._originTransform),this.pivot.x=this._originPivot.x,this.pivot.y=this._originPivot.y):(this.transform.x=this.transform.y=this.transform.skewX=this.transform.skewY=this.transform.scaleX=this.transform.scaleY=0,this.pivot.x=0,this.pivot.y=0),this._currentFrame=this._timeline.getFrameList()[0],this.tweenActive=this._currentFrame.displayIndex>=0,this._currentFrame.color?this._bone._updateColor(this._currentFrame.color.alphaOffset,this._currentFrame.color.redOffset,this._currentFrame.color.greenOffset,this._currentFrame.color.blueOffset,this._currentFrame.color.alphaMultiplier,this._currentFrame.color.redMultiplier,this._currentFrame.color.greenMultiplier,this._currentFrame.color.blueMultiplier,!0):this._bone._updateColor(0,0,0,0,1,1,1,1,!1),this._bone._arriveAtFrame(this._currentFrame,this,this._animationState,!1)},TimelineState.prototype.clear=function(){this._updateState=0,this._bone=null,this._animationState=null,this._timeline=null,this._currentFrame=null,this._originTransform=null,this._originPivot=null},TimelineState.HALF_PI=.5*Math.PI,TimelineState._pool=[],TimelineState}();animation.TimelineState=TimelineState;var AnimationState=function(){function AnimationState(){this.loop=0,this.layer=0,this._timelineStates={}}return AnimationState._borrowObject=function(){return 0==AnimationState._pool.length?new AnimationState:AnimationState._pool.pop()},AnimationState._returnObject=function(animationState){AnimationState._pool.indexOf(animationState)<0&&(AnimationState._pool[AnimationState._pool.length]=animationState),animationState.clear()},AnimationState._clear=function(){for(var i=AnimationState._pool.length;i--;)AnimationState._pool[i].clear();AnimationState._pool.length=0},AnimationState.prototype.fadeIn=function(armature,clip,fadeInTime,timeScale,loop,layer,displayControl,pauseBeforeFadeInComplete){this.layer=layer,this.clip=clip,this.name=this.clip.name,this.totalTime=this.clip.duration,this._armature=armature,Math.round(this.clip.duration*this.clip.frameRate)<2||timeScale==1/0?(this.timeScale=1,this.currentTime=this.totalTime,this.loop>=0?this.loop=1:this.loop=-1):(this.timeScale=timeScale,this.currentTime=0,this.loop=loop),this._pauseBeforeFadeInComplete=pauseBeforeFadeInComplete,this._fadeInTime=fadeInTime*this.timeScale,this._fadeState=1,this._fadeOutBeginTime=0,this._fadeOutWeight=-1,this._fadeWeight=0,this._fadeIn=!0,this._fadeOut=!1,this.loopCount=-1,this.displayControl=displayControl,this.isPlaying=!0,this.isComplete=!1,this.weight=1,this.blend=!0,this.enabled=!0,this.tweenEnabled=!0,this.updateTimelineStates()},AnimationState.prototype.fadeOut=function(fadeOutTime,pause){if("undefined"==typeof pause&&(pause=!1),this._armature&&!(this._fadeOutWeight>=0)){this._fadeState=-1,this._fadeOutWeight=this._fadeWeight,this._fadeOutTime=fadeOutTime*this.timeScale,this._fadeOutBeginTime=this.currentTime,this._fadeOut=!0,this.isPlaying=!pause,this.displayControl=!1;for(var index in this._timelineStates)this._timelineStates[index].fadeOut();this.enabled=!0}},AnimationState.prototype.play=function(){this.isPlaying=!0},AnimationState.prototype.stop=function(){this.isPlaying=!1},AnimationState.prototype.getMixingTransform=function(timelineName){return this._mixingTransforms?Number(this._mixingTransforms[timelineName]):-1},AnimationState.prototype.addMixingTransform=function(timelineName,type,recursive){if("undefined"==typeof type&&(type=2),"undefined"==typeof recursive&&(recursive=!0),!this.clip||!this.clip.getTimeline(timelineName))throw new Error;if(this._mixingTransforms||(this._mixingTransforms={}),recursive)for(var bone,currentBone,i=this._armature._boneList.length;i--;)bone=this._armature._boneList[i],bone.name==timelineName&&(currentBone=bone),currentBone&&(currentBone==bone||currentBone.contains(bone))&&(this._mixingTransforms[bone.name]=type);else this._mixingTransforms[timelineName]=type;this.updateTimelineStates()},AnimationState.prototype.removeMixingTransform=function(timelineName,recursive){if("undefined"==typeof timelineName&&(timelineName=null),"undefined"==typeof recursive&&(recursive=!0),timelineName){if(recursive)for(var bone,currentBone,i=this._armature._boneList.length;i--;)bone=this._armature._boneList[i],bone.name==timelineName&&(currentBone=bone),currentBone&&(currentBone==bone||currentBone.contains(bone))&&delete this._mixingTransforms[bone.name];else delete this._mixingTransforms[timelineName];for(var index in this._mixingTransforms){var hasMixing=!0;break}hasMixing||(this._mixingTransforms=null)}else this._mixingTransforms=null;this.updateTimelineStates()},AnimationState.prototype.advanceTime=function(passedTime){if(!this.enabled)return!1;var event,isComplete;if(this._fadeIn&&(this._fadeIn=!1,this._armature.hasEventListener(events.AnimationEvent.FADE_IN)&&(event=new events.AnimationEvent(events.AnimationEvent.FADE_IN),event.animationState=this,this._armature._eventList.push(event))),this._fadeOut&&(this._fadeOut=!1,this._armature.hasEventListener(events.AnimationEvent.FADE_OUT)&&(event=new events.AnimationEvent(events.AnimationEvent.FADE_OUT),event.animationState=this,this._armature._eventList.push(event))),this.currentTime+=passedTime*this.timeScale,this.isPlaying&&!this.isComplete){var progress,currentLoopCount;this._pauseBeforeFadeInComplete?(this._pauseBeforeFadeInComplete=!1,this.isPlaying=!1,progress=0,currentLoopCount=Math.floor(progress)):(progress=this.currentTime/this.totalTime,currentLoopCount=Math.floor(progress),currentLoopCount!=this.loopCount&&(-1==this.loopCount&&this._armature.hasEventListener(events.AnimationEvent.START)&&(event=new events.AnimationEvent(events.AnimationEvent.START),event.animationState=this,this._armature._eventList.push(event)),this.loopCount=currentLoopCount,this.loopCount&&(this.loop&&this.loopCount*this.loopCount>=this.loop*this.loop-1?(isComplete=!0,progress=1,currentLoopCount=0,this._armature.hasEventListener(events.AnimationEvent.COMPLETE)&&(event=new events.AnimationEvent(events.AnimationEvent.COMPLETE),event.animationState=this,this._armature._eventList.push(event))):this._armature.hasEventListener(events.AnimationEvent.LOOP_COMPLETE)&&(event=new events.AnimationEvent(events.AnimationEvent.LOOP_COMPLETE),event.animationState=this,this._armature._eventList.push(event)))));for(var index in this._timelineStates)this._timelineStates[index].update(progress);var frameList=this.clip.getFrameList();if(frameList.length>0){for(var frameIndex,playedTime=this.totalTime*(progress-currentLoopCount),isArrivedFrame=!1;!this._currentFrame||playedTime>this._currentFrame.position+this._currentFrame.duration||playedTime<this._currentFrame.position;)isArrivedFrame&&this._armature._arriveAtFrame(this._currentFrame,null,this,!0),isArrivedFrame=!0,this._currentFrame?(frameIndex=frameList.indexOf(this._currentFrame),frameIndex++,frameIndex>=frameList.length&&(frameIndex=0),this._currentFrame=frameList[frameIndex]):this._currentFrame=frameList[0];isArrivedFrame&&this._armature._arriveAtFrame(this._currentFrame,null,this,!1)}}if(this._fadeState>0)0==this._fadeInTime?(this._fadeWeight=1,this._fadeState=0,this.isPlaying=!0,this._armature.hasEventListener(events.AnimationEvent.FADE_IN_COMPLETE)&&(event=new events.AnimationEvent(events.AnimationEvent.FADE_IN_COMPLETE),event.animationState=this,this._armature._eventList.push(event))):(this._fadeWeight=this.currentTime/this._fadeInTime,this._fadeWeight>=1&&(this._fadeWeight=1,this._fadeState=0,this.isPlaying||(this.currentTime-=this._fadeInTime),this.isPlaying=!0,this._armature.hasEventListener(events.AnimationEvent.FADE_IN_COMPLETE)&&(event=new events.AnimationEvent(events.AnimationEvent.FADE_IN_COMPLETE),event.animationState=this,this._armature._eventList.push(event))));else if(this._fadeState<0){if(0==this._fadeOutTime)return this._fadeWeight=0,this._fadeState=0,this._armature.hasEventListener(events.AnimationEvent.FADE_OUT_COMPLETE)&&(event=new events.AnimationEvent(events.AnimationEvent.FADE_OUT_COMPLETE),event.animationState=this,this._armature._eventList.push(event)),!0;if(this._fadeWeight=(1-(this.currentTime-this._fadeOutBeginTime)/this._fadeOutTime)*this._fadeOutWeight,this._fadeWeight<=0)return this._fadeWeight=0,this._fadeState=0,this._armature.hasEventListener(events.AnimationEvent.FADE_OUT_COMPLETE)&&(event=new events.AnimationEvent(events.AnimationEvent.FADE_OUT_COMPLETE),event.animationState=this,this._armature._eventList.push(event)),!0}return isComplete&&(this.isComplete=!0,this.loop<0&&this.fadeOut((this._fadeOutWeight||this._fadeInTime)/this.timeScale,!0)),!1},AnimationState.prototype.updateTimelineStates=function(){if(this._mixingTransforms){for(var timelineName in this._timelineStates)null==this._mixingTransforms[timelineName]&&this.removeTimelineState(timelineName);for(timelineName in this._mixingTransforms)this._timelineStates[timelineName]||this.addTimelineState(timelineName)}else for(timelineName in this.clip.getTimelines())this._timelineStates[timelineName]||this.addTimelineState(timelineName)},AnimationState.prototype.addTimelineState=function(timelineName){var bone=this._armature.getBone(timelineName);if(bone){var timelineState=TimelineState._borrowObject(),timeline=this.clip.getTimeline(timelineName);timelineState.fadeIn(bone,this,timeline),this._timelineStates[timelineName]=timelineState}},AnimationState.prototype.removeTimelineState=function(timelineName){TimelineState._returnObject(this._timelineStates[timelineName]),delete this._timelineStates[timelineName]},AnimationState.prototype.clear=function(){this.clip=null,this.enabled=!1,this._armature=null,this._currentFrame=null,this._mixingTransforms=null;for(var timelineName in this._timelineStates)this.removeTimelineState(timelineName)},AnimationState._pool=[],AnimationState}();animation.AnimationState=AnimationState;var Animation=function(){function Animation(armature){this._armature=armature,this._animationLayer=[],this._isPlaying=!1,this.animationNameList=[],this.tweenEnabled=!0,this.timeScale=1}return Animation.prototype.getLastAnimationName=function(){return this._lastAnimationState?this._lastAnimationState.name:null},Animation.prototype.getLastAnimationState=function(){return this._lastAnimationState},Animation.prototype.getAnimationDataList=function(){return this._animationDataList},Animation.prototype.setAnimationDataList=function(value){this._animationDataList=value,this.animationNameList.length=0;for(var index in this._animationDataList)this.animationNameList[this.animationNameList.length]=this._animationDataList[index].name},Animation.prototype.getIsPlaying=function(){return this._isPlaying&&!this.getIsComplete()},Animation.prototype.getIsComplete=function(){if(this._lastAnimationState){if(!this._lastAnimationState.isComplete)return!1;for(var j=this._animationLayer.length;j--;)for(var animationStateList=this._animationLayer[j],i=animationStateList.length;i--;)if(!animationStateList[i].isComplete)return!1;return!0}return!1},Animation.prototype.dispose=function(){if(this._armature){this.stop();for(var i=this._animationLayer.length;i--;){for(var animationStateList=this._animationLayer[i],j=animationStateList.length;j--;)AnimationState._returnObject(animationStateList[j]);animationStateList.length=0}this._animationLayer.length=0,this.animationNameList.length=0,this._armature=null,this._animationLayer=null,this._animationDataList=null,this.animationNameList=null}},Animation.prototype.gotoAndStop=function(animationName){this.gotoAndPlay(animationName,-1,-1,NaN,0,null,Animation.NONE),this.advanceTime(1e-5),this._isPlaying=!1},Animation.prototype.gotoAndPlay=function(animationName,fadeInTime,duration,loop,layer,group,fadeOutMode,displayControl,pauseFadeOut,pauseFadeIn){if("undefined"==typeof fadeInTime&&(fadeInTime=-1),"undefined"==typeof duration&&(duration=-1),"undefined"==typeof loop&&(loop=NaN),"undefined"==typeof layer&&(layer=0),"undefined"==typeof group&&(group=null),"undefined"==typeof fadeOutMode&&(fadeOutMode=Animation.SAME_LAYER_AND_GROUP),"undefined"==typeof displayControl&&(displayControl=!0),"undefined"==typeof pauseFadeOut&&(pauseFadeOut=!0),"undefined"==typeof pauseFadeIn&&(pauseFadeIn=!0),!this._animationDataList)return null;for(var animationData,i=this._animationDataList.length;i--;)if(this._animationDataList[i].name==animationName){animationData=this._animationDataList[i];break}if(!animationData)return null;this._isPlaying=!0,fadeInTime=0>fadeInTime?animationData.fadeInTime<0?.3:animationData.fadeInTime:fadeInTime;var durationScale;durationScale=0>duration?animationData.scale<0?1:animationData.scale:duration/animationData.duration,loop=isNaN(loop)?animationData.loop:loop,layer=this.addLayer(layer);var animationState,animationStateList;switch(fadeOutMode){case Animation.NONE:break;case Animation.SAME_LAYER:for(animationStateList=this._animationLayer[layer],i=animationStateList.length;i--;)animationState=animationStateList[i],animationState.fadeOut(fadeInTime,pauseFadeOut);break;case Animation.SAME_GROUP:for(j=this._animationLayer.length;j--;)for(animationStateList=this._animationLayer[j],i=animationStateList.length;i--;)animationState=animationStateList[i],animationState.group==group&&animationState.fadeOut(fadeInTime,pauseFadeOut);break;case Animation.ALL:for(var j=this._animationLayer.length;j--;)for(animationStateList=this._animationLayer[j],i=animationStateList.length;i--;)animationState=animationStateList[i],animationState.fadeOut(fadeInTime,pauseFadeOut);break;case Animation.SAME_LAYER_AND_GROUP:default:for(animationStateList=this._animationLayer[layer],i=animationStateList.length;i--;)animationState=animationStateList[i],animationState.group==group&&animationState.fadeOut(fadeInTime,pauseFadeOut)}this._lastAnimationState=AnimationState._borrowObject(),this._lastAnimationState.group=group,this._lastAnimationState.tweenEnabled=this.tweenEnabled,this._lastAnimationState.fadeIn(this._armature,animationData,fadeInTime,1/durationScale,loop,layer,displayControl,pauseFadeIn),this.addState(this._lastAnimationState);var slot,childArmature,slotList=this._armature._slotList;for(i=slotList.length;i--;)slot=slotList[i],childArmature=slot.getChildArmature(),childArmature&&childArmature.animation.gotoAndPlay(animationName,fadeInTime);return this._lastAnimationState},Animation.prototype.play=function(){this._animationDataList&&0!=this._animationDataList.length&&(this._lastAnimationState?this._isPlaying?this.gotoAndPlay(this._lastAnimationState.name):this._isPlaying=!0:this.gotoAndPlay(this._animationDataList[0].name))},Animation.prototype.stop=function(){this._isPlaying=!1},Animation.prototype.getState=function(name,layer){"undefined"==typeof layer&&(layer=0);var l=this._animationLayer.length;if(0==l)return null;layer>=l&&(layer=l-1);var animationStateList=this._animationLayer[layer];if(!animationStateList)return null;for(var i=animationStateList.length;i--;)if(animationStateList[i].name==name)return animationStateList[i];return null},Animation.prototype.hasAnimation=function(animationName){for(var i=this._animationDataList.length;i--;)if(this._animationDataList[i].name==animationName)return!0;return!1},Animation.prototype.advanceTime=function(passedTime){if(this._isPlaying){passedTime*=this.timeScale;var i,j,stateListLength,bone,boneName,weigthLeft,x,y,skewX,skewY,scaleX,scaleY,pivotX,pivotY,layerTotalWeight,animationStateList,animationState,timelineState,weight,transform,pivot,l=this._armature._boneList.length,k=l;for(l--;k--;){for(bone=this._armature._boneList[k],boneName=bone.name,weigthLeft=1,x=0,y=0,skewX=0,skewY=0,scaleX=0,scaleY=0,pivotX=0,pivotY=0,i=this._animationLayer.length;i--;){for(layerTotalWeight=0,animationStateList=this._animationLayer[i],stateListLength=animationStateList.length,j=0;stateListLength>j;j++)animationState=animationStateList[j],k==l&&animationState.advanceTime(passedTime)?(this.removeState(animationState),j--,stateListLength--):(timelineState=animationState._timelineStates[boneName],timelineState&&timelineState.tweenActive&&(weight=animationState._fadeWeight*animationState.weight*weigthLeft,transform=timelineState.transform,pivot=timelineState.pivot,x+=transform.x*weight,y+=transform.y*weight,skewX+=transform.skewX*weight,skewY+=transform.skewY*weight,scaleX+=transform.scaleX*weight,scaleY+=transform.scaleY*weight,pivotX+=pivot.x*weight,pivotY+=pivot.y*weight,layerTotalWeight+=weight));if(layerTotalWeight>=weigthLeft)break;weigthLeft-=layerTotalWeight}transform=bone.tween,pivot=bone._tweenPivot,transform.x=x,transform.y=y,transform.skewX=skewX,transform.skewY=skewY,transform.scaleX=scaleX,transform.scaleY=scaleY,pivot.x=pivotX,pivot.y=pivotY}}},Animation.prototype.addLayer=function(layer){return layer>=this._animationLayer.length&&(layer=this._animationLayer.length,this._animationLayer[layer]=[]),layer},Animation.prototype.addState=function(animationState){var animationStateList=this._animationLayer[animationState.layer];animationStateList.push(animationState)},Animation.prototype.removeState=function(animationState){var layer=animationState.layer,animationStateList=this._animationLayer[layer];animationStateList.splice(animationStateList.indexOf(animationState),1),AnimationState._returnObject(animationState),0==animationStateList.length&&layer==this._animationLayer.length-1&&this._animationLayer.length--},Animation.NONE="none",Animation.SAME_LAYER="sameLayer",Animation.SAME_GROUP="sameGroup",Animation.SAME_LAYER_AND_GROUP="sameLayerAndGroup",Animation.ALL="all",Animation}();animation.Animation=Animation}(dragonBones.animation||(dragonBones.animation={}));var animation=dragonBones.animation;!function(objects){var DBTransform=function(){function DBTransform(){this.x=0,this.y=0,this.skewX=0,this.skewY=0,this.scaleX=1,this.scaleY=1}return DBTransform.prototype.getRotation=function(){return this.skewX},DBTransform.prototype.setRotation=function(value){this.skewX=this.skewY=value},DBTransform.prototype.copy=function(transform){this.x=transform.x,this.y=transform.y,this.skewX=transform.skewX,this.skewY=transform.skewY,this.scaleX=transform.scaleX,this.scaleY=transform.scaleY},DBTransform.prototype.toString=function(){return"[DBTransform (x="+this.x+" y="+this.y+" skewX="+this.skewX+" skewY="+this.skewY+" scaleX="+this.scaleX+" scaleY="+this.scaleY+")]"},DBTransform}();objects.DBTransform=DBTransform;var Frame=function(){function Frame(){this.position=0,this.duration=0}return Frame.prototype.dispose=function(){},Frame}();objects.Frame=Frame;var TransformFrame=function(_super){function TransformFrame(){_super.call(this),this.tweenEasing=0,this.tweenRotate=0,this.displayIndex=0,this.zOrder=NaN,this.visible=!0,this.global=new DBTransform,this.transform=new DBTransform,this.pivot=new geom.Point}return __extends(TransformFrame,_super),TransformFrame.prototype.dispose=function(){_super.prototype.dispose.call(this),this.global=null,this.transform=null,this.pivot=null,this.color=null},TransformFrame}(Frame);objects.TransformFrame=TransformFrame;var Timeline=function(){function Timeline(){this._frameList=[],this.duration=0,this.scale=1}return Timeline.prototype.getFrameList=function(){return this._frameList},Timeline.prototype.dispose=function(){for(var i=this._frameList.length;i--;)this._frameList[i].dispose();this._frameList.length=0,this._frameList=null},Timeline.prototype.addFrame=function(frame){if(!frame)throw new Error;if(!(this._frameList.indexOf(frame)<0))throw new Error;this._frameList[this._frameList.length]=frame},Timeline}();objects.Timeline=Timeline;var TransformTimeline=function(_super){function TransformTimeline(){_super.call(this),this.originTransform=new DBTransform,this.originPivot=new geom.Point,this.offset=0,this.transformed=!1}return __extends(TransformTimeline,_super),TransformTimeline.prototype.dispose=function(){this!=TransformTimeline.HIDE_TIMELINE&&(_super.prototype.dispose.call(this),this.originTransform=null,this.originPivot=null)},TransformTimeline.HIDE_TIMELINE=new TransformTimeline,TransformTimeline}(Timeline);objects.TransformTimeline=TransformTimeline;var AnimationData=function(_super){function AnimationData(){_super.call(this),this.frameRate=0,this.loop=0,this.tweenEasing=NaN,this.fadeInTime=0,this._timelines={}}return __extends(AnimationData,_super),AnimationData.prototype.getTimelines=function(){return this._timelines},AnimationData.prototype.dispose=function(){_super.prototype.dispose.call(this);for(var timelineName in this._timelines)this._timelines[timelineName].dispose();this._timelines=null},AnimationData.prototype.getTimeline=function(timelineName){return this._timelines[timelineName]},AnimationData.prototype.addTimeline=function(timeline,timelineName){if(!timeline)throw new Error;this._timelines[timelineName]=timeline},AnimationData}(Timeline);objects.AnimationData=AnimationData;var DisplayData=function(){function DisplayData(){this.transform=new DBTransform}return DisplayData.prototype.dispose=function(){this.transform=null,this.pivot=null},DisplayData.ARMATURE="armature",DisplayData.IMAGE="image",DisplayData}();objects.DisplayData=DisplayData;var SlotData=function(){function SlotData(){this._displayDataList=[],this.zOrder=0}return SlotData.prototype.getDisplayDataList=function(){return this._displayDataList},SlotData.prototype.dispose=function(){for(var i=this._displayDataList.length;i--;)this._displayDataList[i].dispose();this._displayDataList.length=0,this._displayDataList=null},SlotData.prototype.addDisplayData=function(displayData){if(!displayData)throw new Error;if(!(this._displayDataList.indexOf(displayData)<0))throw new Error;this._displayDataList[this._displayDataList.length]=displayData},SlotData.prototype.getDisplayData=function(displayName){for(var i=this._displayDataList.length;i--;)if(this._displayDataList[i].name==displayName)return this._displayDataList[i];return null},SlotData}();objects.SlotData=SlotData;var BoneData=function(){function BoneData(){this.length=0,this.global=new DBTransform,this.transform=new DBTransform}return BoneData.prototype.dispose=function(){this.global=null,this.transform=null},BoneData}();objects.BoneData=BoneData;var SkinData=function(){function SkinData(){this._slotDataList=[]}return SkinData.prototype.getSlotDataList=function(){return this._slotDataList},SkinData.prototype.dispose=function(){for(var i=this._slotDataList.length;i--;)this._slotDataList[i].dispose();this._slotDataList.length=0,this._slotDataList=null},SkinData.prototype.getSlotData=function(slotName){for(var i=this._slotDataList.length;i--;)if(this._slotDataList[i].name==slotName)return this._slotDataList[i];return null},SkinData.prototype.addSlotData=function(slotData){if(!slotData)throw new Error;if(!(this._slotDataList.indexOf(slotData)<0))throw new Error;this._slotDataList[this._slotDataList.length]=slotData},SkinData}();objects.SkinData=SkinData;var ArmatureData=function(){function ArmatureData(){this._boneDataList=[],this._skinDataList=[],this._animationDataList=[]}return ArmatureData.prototype.getBoneDataList=function(){return this._boneDataList},ArmatureData.prototype.getSkinDataList=function(){return this._skinDataList},ArmatureData.prototype.getAnimationDataList=function(){return this._animationDataList},ArmatureData.prototype.dispose=function(){for(var i=this._boneDataList.length;i--;)this._boneDataList[i].dispose();for(i=this._skinDataList.length;i--;)this._skinDataList[i].dispose();for(i=this._animationDataList.length;i--;)this._animationDataList[i].dispose();this._boneDataList.length=0,this._skinDataList.length=0,this._animationDataList.length=0,this._boneDataList=null,this._skinDataList=null,this._animationDataList=null},ArmatureData.prototype.getBoneData=function(boneName){for(var i=this._boneDataList.length;i--;)if(this._boneDataList[i].name==boneName)return this._boneDataList[i];return null},ArmatureData.prototype.getSkinData=function(skinName){if(!skinName)return this._skinDataList[0];for(var i=this._skinDataList.length;i--;)if(this._skinDataList[i].name==skinName)return this._skinDataList[i];return null},ArmatureData.prototype.getAnimationData=function(animationName){for(var i=this._animationDataList.length;i--;)if(this._animationDataList[i].name==animationName)return this._animationDataList[i];return null},ArmatureData.prototype.addBoneData=function(boneData){if(!boneData)throw new Error;if(!(this._boneDataList.indexOf(boneData)<0))throw new Error;this._boneDataList[this._boneDataList.length]=boneData},ArmatureData.prototype.addSkinData=function(skinData){if(!skinData)throw new Error;if(!(this._skinDataList.indexOf(skinData)<0))throw new Error;this._skinDataList[this._skinDataList.length]=skinData},ArmatureData.prototype.addAnimationData=function(animationData){if(!animationData)throw new Error;this._animationDataList.indexOf(animationData)<0&&(this._animationDataList[this._animationDataList.length]=animationData)},ArmatureData.prototype.sortBoneDataList=function(){var i=this._boneDataList.length;if(0!=i){for(var helpArray=[];i--;){for(var boneData=this._boneDataList[i],level=0,parentData=boneData;parentData&&parentData.parent;)level++,parentData=this.getBoneData(parentData.parent);helpArray[i]={level:level,boneData:boneData}}for(helpArray.sort(this.sortBoneData),i=helpArray.length;i--;)this._boneDataList[i]=helpArray[i].boneData}},ArmatureData.prototype.sortBoneData=function(object1,object2){return object1.level>object2.level?1:-1},ArmatureData}();objects.ArmatureData=ArmatureData;var SkeletonData=function(){function SkeletonData(){this._armatureDataList=[],this._subTexturePivots={}}return SkeletonData.prototype.getArmatureNames=function(){var nameList=[];for(var armatureDataIndex in this._armatureDataList)nameList[nameList.length]=this._armatureDataList[armatureDataIndex].name;return nameList},SkeletonData.prototype.getArmatureDataList=function(){return this._armatureDataList},SkeletonData.prototype.dispose=function(){for(var armatureDataIndex in this._armatureDataList)this._armatureDataList[armatureDataIndex].dispose();this._armatureDataList.length=0,this._armatureDataList=null,this._subTexturePivots=null},SkeletonData.prototype.getArmatureData=function(armatureName){for(var i=this._armatureDataList.length;i--;)if(this._armatureDataList[i].name==armatureName)return this._armatureDataList[i];return null},SkeletonData.prototype.addArmatureData=function(armatureData){if(!armatureData)throw new Error;if(!(this._armatureDataList.indexOf(armatureData)<0))throw new Error;this._armatureDataList[this._armatureDataList.length]=armatureData},SkeletonData.prototype.removeArmatureData=function(armatureData){var index=this._armatureDataList.indexOf(armatureData);index>=0&&this._armatureDataList.splice(index,1)},SkeletonData.prototype.removeArmatureDataByName=function(armatureName){for(var i=this._armatureDataList.length;i--;)this._armatureDataList[i].name==armatureName&&this._armatureDataList.splice(i,1)},SkeletonData.prototype.getSubTexturePivot=function(subTextureName){return this._subTexturePivots[subTextureName]},SkeletonData.prototype.addSubTexturePivot=function(x,y,subTextureName){var point=this._subTexturePivots[subTextureName];return point?(point.x=x,point.y=y):this._subTexturePivots[subTextureName]=point=new geom.Point(x,y),point},SkeletonData.prototype.removeSubTexturePivot=function(subTextureName){if(subTextureName)delete this._subTexturePivots[subTextureName];else for(subTextureName in this._subTexturePivots)delete this._subTexturePivots[subTextureName]},SkeletonData}();objects.SkeletonData=SkeletonData;var DataParser=function(){function DataParser(){}return DataParser.parseTextureAtlasData=function(rawData,scale){if("undefined"==typeof scale&&(scale=1),!rawData)throw new Error;var textureAtlasData={};textureAtlasData.__name=rawData[utils.ConstValues.A_NAME];var subTextureList=rawData[utils.ConstValues.SUB_TEXTURE];for(var index in subTextureList){var subTextureObject=subTextureList[index],subTextureName=subTextureObject[utils.ConstValues.A_NAME],subTextureData=new geom.Rectangle(Number(subTextureObject[utils.ConstValues.A_X])/scale,Number(subTextureObject[utils.ConstValues.A_Y])/scale,Number(subTextureObject[utils.ConstValues.A_WIDTH])/scale,Number(subTextureObject[utils.ConstValues.A_HEIGHT])/scale);textureAtlasData[subTextureName]=subTextureData}return textureAtlasData},DataParser.parseSkeletonData=function(rawData){if(!rawData)throw new Error;var frameRate=Number(rawData[utils.ConstValues.A_FRAME_RATE]),data=new SkeletonData;data.name=rawData[utils.ConstValues.A_NAME];var armatureObjectList=rawData[utils.ConstValues.ARMATURE];for(var index in armatureObjectList){var armatureObject=armatureObjectList[index];data.addArmatureData(DataParser.parseArmatureData(armatureObject,data,frameRate))}return data},DataParser.parseArmatureData=function(armatureObject,data,frameRate){var armatureData=new ArmatureData;armatureData.name=armatureObject[utils.ConstValues.A_NAME];var boneObjectList=armatureObject[utils.ConstValues.BONE];for(var index in boneObjectList){var boneObject=boneObjectList[index];armatureData.addBoneData(DataParser.parseBoneData(boneObject))}var skinObjectList=armatureObject[utils.ConstValues.SKIN];
for(var index in skinObjectList){var skinObject=skinObjectList[index];armatureData.addSkinData(DataParser.parseSkinData(skinObject,data))}utils.DBDataUtil.transformArmatureData(armatureData),armatureData.sortBoneDataList();var animationObjectList=armatureObject[utils.ConstValues.ANIMATION];for(var index in animationObjectList){var animationObject=animationObjectList[index];armatureData.addAnimationData(DataParser.parseAnimationData(animationObject,armatureData,frameRate))}return armatureData},DataParser.parseBoneData=function(boneObject){var boneData=new BoneData;return boneData.name=boneObject[utils.ConstValues.A_NAME],boneData.parent=boneObject[utils.ConstValues.A_PARENT],boneData.length=Number(boneObject[utils.ConstValues.A_LENGTH])||0,DataParser.parseTransform(boneObject[utils.ConstValues.TRANSFORM],boneData.global),boneData.transform.copy(boneData.global),boneData},DataParser.parseSkinData=function(skinObject,data){var skinData=new SkinData;skinData.name=skinObject[utils.ConstValues.A_NAME];var slotObjectList=skinObject[utils.ConstValues.SLOT];for(var index in slotObjectList){var slotObject=slotObjectList[index];skinData.addSlotData(DataParser.parseSlotData(slotObject,data))}return skinData},DataParser.parseSlotData=function(slotObject,data){var slotData=new SlotData;slotData.name=slotObject[utils.ConstValues.A_NAME],slotData.parent=slotObject[utils.ConstValues.A_PARENT],slotData.zOrder=Number(slotObject[utils.ConstValues.A_Z_ORDER]);var displayObjectList=slotObject[utils.ConstValues.DISPLAY];for(var index in displayObjectList){var displayObject=displayObjectList[index];slotData.addDisplayData(DataParser.parseDisplayData(displayObject,data))}return slotData},DataParser.parseDisplayData=function(displayObject,data){var displayData=new DisplayData;return displayData.name=displayObject[utils.ConstValues.A_NAME],displayData.type=displayObject[utils.ConstValues.A_TYPE],displayData.pivot=data.addSubTexturePivot(0,0,displayData.name),DataParser.parseTransform(displayObject[utils.ConstValues.TRANSFORM],displayData.transform,displayData.pivot),displayData},DataParser.parseAnimationData=function(animationObject,armatureData,frameRate){var animationData=new AnimationData;if(animationData.name=animationObject[utils.ConstValues.A_NAME],animationData.frameRate=frameRate,animationData.loop=Number(animationObject[utils.ConstValues.A_LOOP])||0,animationData.fadeInTime=Number(animationObject[utils.ConstValues.A_FADE_IN_TIME]),animationData.duration=Number(animationObject[utils.ConstValues.A_DURATION])/frameRate,animationData.scale=Number(animationObject[utils.ConstValues.A_SCALE]),animationObject.hasOwnProperty(utils.ConstValues.A_TWEEN_EASING)){var tweenEase=animationObject[utils.ConstValues.A_TWEEN_EASING];void 0==tweenEase||null==tweenEase?animationData.tweenEasing=NaN:animationData.tweenEasing=Number(tweenEase)}else animationData.tweenEasing=NaN;DataParser.parseTimeline(animationObject,animationData,DataParser.parseMainFrame,frameRate);var timeline,timelineName,timelineObjectList=animationObject[utils.ConstValues.TIMELINE];for(var index in timelineObjectList){var timelineObject=timelineObjectList[index];timeline=DataParser.parseTransformTimeline(timelineObject,animationData.duration,frameRate),timelineName=timelineObject[utils.ConstValues.A_NAME],animationData.addTimeline(timeline,timelineName)}return utils.DBDataUtil.addHideTimeline(animationData,armatureData),utils.DBDataUtil.transformAnimationData(animationData,armatureData),animationData},DataParser.parseTimeline=function(timelineObject,timeline,frameParser,frameRate){var frame,position=0,frameObjectList=timelineObject[utils.ConstValues.FRAME];for(var index in frameObjectList){var frameObject=frameObjectList[index];frame=frameParser(frameObject,frameRate),frame.position=position,timeline.addFrame(frame),position+=frame.duration}frame&&(frame.duration=timeline.duration-frame.position)},DataParser.parseTransformTimeline=function(timelineObject,duration,frameRate){var timeline=new TransformTimeline;return timeline.duration=duration,DataParser.parseTimeline(timelineObject,timeline,DataParser.parseTransformFrame,frameRate),timeline.scale=Number(timelineObject[utils.ConstValues.A_SCALE]),timeline.offset=Number(timelineObject[utils.ConstValues.A_OFFSET]),timeline},DataParser.parseFrame=function(frameObject,frame,frameRate){frame.duration=Number(frameObject[utils.ConstValues.A_DURATION])/frameRate,frame.action=frameObject[utils.ConstValues.A_ACTION],frame.event=frameObject[utils.ConstValues.A_EVENT],frame.sound=frameObject[utils.ConstValues.A_SOUND]},DataParser.parseMainFrame=function(frameObject,frameRate){var frame=new Frame;return DataParser.parseFrame(frameObject,frame,frameRate),frame},DataParser.parseTransformFrame=function(frameObject,frameRate){var frame=new TransformFrame;if(DataParser.parseFrame(frameObject,frame,frameRate),frame.visible=1!=Number(frameObject[utils.ConstValues.A_HIDE]),frameObject.hasOwnProperty(utils.ConstValues.A_TWEEN_EASING)){var tweenEase=frameObject[utils.ConstValues.A_TWEEN_EASING];void 0==tweenEase||null==tweenEase?frame.tweenEasing=NaN:frame.tweenEasing=Number(tweenEase)}else frame.tweenEasing=0;frame.tweenRotate=Number(frameObject[utils.ConstValues.A_TWEEN_ROTATE])||0,frame.displayIndex=Number(frameObject[utils.ConstValues.A_DISPLAY_INDEX])||0,frame.zOrder=Number(frameObject[utils.ConstValues.A_Z_ORDER])||0,DataParser.parseTransform(frameObject[utils.ConstValues.TRANSFORM],frame.global,frame.pivot),frame.transform.copy(frame.global);var colorTransformObject=frameObject[utils.ConstValues.COLOR_TRANSFORM];return colorTransformObject&&(frame.color=new geom.ColorTransform,frame.color.alphaOffset=Number(colorTransformObject[utils.ConstValues.A_ALPHA_OFFSET]),frame.color.redOffset=Number(colorTransformObject[utils.ConstValues.A_RED_OFFSET]),frame.color.greenOffset=Number(colorTransformObject[utils.ConstValues.A_GREEN_OFFSET]),frame.color.blueOffset=Number(colorTransformObject[utils.ConstValues.A_BLUE_OFFSET]),frame.color.alphaMultiplier=.01*Number(colorTransformObject[utils.ConstValues.A_ALPHA_MULTIPLIER]),frame.color.redMultiplier=.01*Number(colorTransformObject[utils.ConstValues.A_RED_MULTIPLIER]),frame.color.greenMultiplier=.01*Number(colorTransformObject[utils.ConstValues.A_GREEN_MULTIPLIER]),frame.color.blueMultiplier=.01*Number(colorTransformObject[utils.ConstValues.A_BLUE_MULTIPLIER])),frame},DataParser.parseTransform=function(transformObject,transform,pivot){"undefined"==typeof pivot&&(pivot=null),transformObject&&(transform&&(transform.x=Number(transformObject[utils.ConstValues.A_X]),transform.y=Number(transformObject[utils.ConstValues.A_Y]),transform.skewX=Number(transformObject[utils.ConstValues.A_SKEW_X])*utils.ConstValues.ANGLE_TO_RADIAN,transform.skewY=Number(transformObject[utils.ConstValues.A_SKEW_Y])*utils.ConstValues.ANGLE_TO_RADIAN,transform.scaleX=Number(transformObject[utils.ConstValues.A_SCALE_X]),transform.scaleY=Number(transformObject[utils.ConstValues.A_SCALE_Y])),pivot&&(pivot.x=Number(transformObject[utils.ConstValues.A_PIVOT_X]),pivot.y=Number(transformObject[utils.ConstValues.A_PIVOT_Y])))},DataParser}();objects.DataParser=DataParser}(dragonBones.objects||(dragonBones.objects={}));var objects=dragonBones.objects;!function(factorys){var BaseFactory=function(_super){function BaseFactory(){_super.call(this),this._dataDic={},this._textureAtlasDic={},this._textureAtlasLoadingDic={}}return __extends(BaseFactory,_super),BaseFactory.prototype.getSkeletonData=function(name){return this._dataDic[name]},BaseFactory.prototype.addSkeletonData=function(data,name){if(!data)throw new Error;if(name=name||data.name,!name)throw new Error("Unnamed data!");this._dataDic[name],this._dataDic[name]=data},BaseFactory.prototype.removeSkeletonData=function(name){delete this._dataDic[name]},BaseFactory.prototype.getTextureAtlas=function(name){return this._textureAtlasDic[name]},BaseFactory.prototype.addTextureAtlas=function(textureAtlas,name){if(!textureAtlas)throw new Error;if(name=name||textureAtlas.name,!name)throw new Error("Unnamed data!");this._textureAtlasDic[name],this._textureAtlasDic[name]=textureAtlas},BaseFactory.prototype.removeTextureAtlas=function(name){delete this._textureAtlasDic[name]},BaseFactory.prototype.dispose=function(disposeData){if("undefined"==typeof disposeData&&(disposeData=!0),disposeData){for(var i in this._dataDic)this._dataDic[i].dispose();for(var i in this._textureAtlasDic)this._textureAtlasDic[i].dispose()}this._dataDic=null,this._textureAtlasDic=null,this._textureAtlasLoadingDic=null,this._currentDataName=null,this._currentTextureAtlasName=null},BaseFactory.prototype.buildArmature=function(armatureName,animationName,skeletonName,textureAtlasName,skinName){if(skeletonName){var data=this._dataDic[skeletonName];if(data)var armatureData=data.getArmatureData(armatureName)}else for(skeletonName in this._dataDic)if(data=this._dataDic[skeletonName],armatureData=data.getArmatureData(armatureName))break;if(!armatureData)return null;this._currentDataName=skeletonName,this._currentTextureAtlasName=textureAtlasName||skeletonName;var armature=this._generateArmature();armature.name=armatureName;var bone,boneData,boneDataList=armatureData.getBoneDataList();for(var index in boneDataList)boneData=boneDataList[index],bone=new dragonBones.Bone,bone.name=boneData.name,bone.origin.copy(boneData.transform),armatureData.getBoneData(boneData.parent)?armature.addChild(bone,boneData.parent):armature.addChild(bone,null);if(animationName&&animationName!=armatureName){var animationArmatureData=data.getArmatureData(animationName);if(!animationArmatureData)for(skeletonName in this._dataDic)if(data=this._dataDic[skeletonName],animationArmatureData=data.getArmatureData(animationName))break}animationArmatureData?armature.animation.setAnimationDataList(animationArmatureData.getAnimationDataList()):armature.animation.setAnimationDataList(armatureData.getAnimationDataList());var skinData=armatureData.getSkinData(skinName);if(!skinData)throw new Error;var slot,displayData,childArmature,i,slotData,displayDataList,helpArray=[],slotDataList=skinData.getSlotDataList();for(var index in slotDataList)if(slotData=slotDataList[index],bone=armature.getBone(slotData.parent)){for(displayDataList=slotData.getDisplayDataList(),slot=this._generateSlot(),slot.name=slotData.name,slot._originZOrder=slotData.zOrder,slot._dislayDataList=displayDataList,helpArray.length=0,i=displayDataList.length;i--;)switch(displayData=displayDataList[i],displayData.type){case objects.DisplayData.ARMATURE:childArmature=this.buildArmature(displayData.name,null,this._currentDataName,this._currentTextureAtlasName,null),childArmature&&(helpArray[i]=childArmature);break;case objects.DisplayData.IMAGE:default:helpArray[i]=this._generateDisplay(this._textureAtlasDic[this._currentTextureAtlasName],displayData.name,displayData.pivot.x,displayData.pivot.y)}slot.setDisplayList(helpArray),slot._changeDisplay(0),bone.addChild(slot)}return armature._slotsZOrderChanged=!0,armature.advanceTime(0),armature},BaseFactory.prototype.getTextureDisplay=function(textureName,textureAtlasName,pivotX,pivotY){if(textureAtlasName)var textureAtlas=this._textureAtlasDic[textureAtlasName];if(!textureAtlas&&!textureAtlasName)for(textureAtlasName in this._textureAtlasDic){if(textureAtlas=this._textureAtlasDic[textureAtlasName],textureAtlas.getRegion(textureName))break;textureAtlas=null}if(textureAtlas){if(isNaN(pivotX)||isNaN(pivotY)){var data=this._dataDic[textureAtlasName];if(data){var pivot=data.getSubTexturePivot(textureName);pivot&&(pivotX=pivot.x,pivotY=pivot.y)}}return this._generateDisplay(textureAtlas,textureName,pivotX,pivotY)}return null},BaseFactory.prototype._generateArmature=function(){return null},BaseFactory.prototype._generateSlot=function(){return null},BaseFactory.prototype._generateDisplay=function(textureAtlas,fullName,pivotX,pivotY){return null},BaseFactory}(events.EventDispatcher);factorys.BaseFactory=BaseFactory}(dragonBones.factorys||(dragonBones.factorys={}));dragonBones.factorys;!function(utils){var ConstValues=function(){function ConstValues(){}return ConstValues.ANGLE_TO_RADIAN=Math.PI/180,ConstValues.DRAGON_BONES="dragonBones",ConstValues.ARMATURE="armature",ConstValues.SKIN="skin",ConstValues.BONE="bone",ConstValues.SLOT="slot",ConstValues.DISPLAY="display",ConstValues.ANIMATION="animation",ConstValues.TIMELINE="timeline",ConstValues.FRAME="frame",ConstValues.TRANSFORM="transform",ConstValues.COLOR_TRANSFORM="colorTransform",ConstValues.TEXTURE_ATLAS="TextureAtlas",ConstValues.SUB_TEXTURE="SubTexture",ConstValues.A_VERSION="version",ConstValues.A_IMAGE_PATH="imagePath",ConstValues.A_FRAME_RATE="frameRate",ConstValues.A_NAME="name",ConstValues.A_PARENT="parent",ConstValues.A_LENGTH="length",ConstValues.A_TYPE="type",ConstValues.A_FADE_IN_TIME="fadeInTime",ConstValues.A_DURATION="duration",ConstValues.A_SCALE="scale",ConstValues.A_OFFSET="offset",ConstValues.A_LOOP="loop",ConstValues.A_EVENT="event",ConstValues.A_SOUND="sound",ConstValues.A_ACTION="action",ConstValues.A_HIDE="hide",ConstValues.A_TWEEN_EASING="tweenEasing",ConstValues.A_TWEEN_ROTATE="tweenRotate",ConstValues.A_DISPLAY_INDEX="displayIndex",ConstValues.A_Z_ORDER="z",ConstValues.A_WIDTH="width",ConstValues.A_HEIGHT="height",ConstValues.A_X="x",ConstValues.A_Y="y",ConstValues.A_SKEW_X="skX",ConstValues.A_SKEW_Y="skY",ConstValues.A_SCALE_X="scX",ConstValues.A_SCALE_Y="scY",ConstValues.A_PIVOT_X="pX",ConstValues.A_PIVOT_Y="pY",ConstValues.A_ALPHA_OFFSET="aO",ConstValues.A_RED_OFFSET="rO",ConstValues.A_GREEN_OFFSET="gO",ConstValues.A_BLUE_OFFSET="bO",ConstValues.A_ALPHA_MULTIPLIER="aM",ConstValues.A_RED_MULTIPLIER="rM",ConstValues.A_GREEN_MULTIPLIER="gM",ConstValues.A_BLUE_MULTIPLIER="bM",ConstValues}();utils.ConstValues=ConstValues;var TransformUtil=function(){function TransformUtil(){}return TransformUtil.transformPointWithParent=function(transform,parent){var helpMatrix=TransformUtil._helpMatrix;TransformUtil.transformToMatrix(parent,helpMatrix),helpMatrix.invert();var x=transform.x,y=transform.y;transform.x=helpMatrix.a*x+helpMatrix.c*y+helpMatrix.tx,transform.y=helpMatrix.d*y+helpMatrix.b*x+helpMatrix.ty,transform.skewX=TransformUtil.formatRadian(transform.skewX-parent.skewX),transform.skewY=TransformUtil.formatRadian(transform.skewY-parent.skewY)},TransformUtil.transformToMatrix=function(transform,matrix){matrix.a=transform.scaleX*Math.cos(transform.skewY),matrix.b=transform.scaleX*Math.sin(transform.skewY),matrix.c=-transform.scaleY*Math.sin(transform.skewX),matrix.d=transform.scaleY*Math.cos(transform.skewX),matrix.tx=transform.x,matrix.ty=transform.y},TransformUtil.formatRadian=function(radian){return radian%=TransformUtil.DOUBLE_PI,radian>Math.PI&&(radian-=TransformUtil.DOUBLE_PI),radian<-Math.PI&&(radian+=TransformUtil.DOUBLE_PI),radian},TransformUtil.DOUBLE_PI=2*Math.PI,TransformUtil._helpMatrix=new geom.Matrix,TransformUtil}();utils.TransformUtil=TransformUtil;var DBDataUtil=function(){function DBDataUtil(){}return DBDataUtil.transformArmatureData=function(armatureData){for(var boneData,parentBoneData,boneDataList=armatureData.getBoneDataList(),i=boneDataList.length;i--;)boneData=boneDataList[i],boneData.parent&&(parentBoneData=armatureData.getBoneData(boneData.parent),parentBoneData&&(boneData.transform.copy(boneData.global),TransformUtil.transformPointWithParent(boneData.transform,parentBoneData.global)))},DBDataUtil.transformArmatureDataAnimations=function(armatureData){for(var animationDataList=armatureData.getAnimationDataList(),i=animationDataList.length;i--;)DBDataUtil.transformAnimationData(animationDataList[i],armatureData)},DBDataUtil.transformAnimationData=function(animationData,armatureData){for(var boneData,timeline,slotData,parentTimeline,frameList,originTransform,originPivot,prevFrame,frame,frameListLength,skinData=armatureData.getSkinData(null),boneDataList=armatureData.getBoneDataList(),slotDataList=skinData.getSlotDataList(),i=boneDataList.length;i--;)if(boneData=boneDataList[i],timeline=animationData.getTimeline(boneData.name)){slotData=null;for(var slotIndex in slotDataList)if(slotData=slotDataList[slotIndex],slotData.parent==boneData.name)break;parentTimeline=boneData.parent?animationData.getTimeline(boneData.parent):null,frameList=timeline.getFrameList(),originTransform=null,originPivot=null,prevFrame=null,frameListLength=frameList.length;for(var j=0;frameListLength>j;j++){if(frame=frameList[j],parentTimeline?(DBDataUtil._helpTransform1.copy(frame.global),DBDataUtil.getTimelineTransform(parentTimeline,frame.position,DBDataUtil._helpTransform2),TransformUtil.transformPointWithParent(DBDataUtil._helpTransform1,DBDataUtil._helpTransform2),frame.transform.copy(DBDataUtil._helpTransform1)):frame.transform.copy(frame.global),frame.transform.x-=boneData.transform.x,frame.transform.y-=boneData.transform.y,frame.transform.skewX-=boneData.transform.skewX,frame.transform.skewY-=boneData.transform.skewY,frame.transform.scaleX-=boneData.transform.scaleX,frame.transform.scaleY-=boneData.transform.scaleY,timeline.transformed||slotData&&(frame.zOrder-=slotData.zOrder),originTransform||(originTransform=timeline.originTransform,originTransform.copy(frame.transform),originTransform.skewX=TransformUtil.formatRadian(originTransform.skewX),originTransform.skewY=TransformUtil.formatRadian(originTransform.skewY),originPivot=timeline.originPivot,originPivot.x=frame.pivot.x,originPivot.y=frame.pivot.y),frame.transform.x-=originTransform.x,frame.transform.y-=originTransform.y,frame.transform.skewX=TransformUtil.formatRadian(frame.transform.skewX-originTransform.skewX),frame.transform.skewY=TransformUtil.formatRadian(frame.transform.skewY-originTransform.skewY),frame.transform.scaleX-=originTransform.scaleX,frame.transform.scaleY-=originTransform.scaleY,timeline.transformed||(frame.pivot.x-=originPivot.x,frame.pivot.y-=originPivot.y),prevFrame){var dLX=frame.transform.skewX-prevFrame.transform.skewX;prevFrame.tweenRotate?prevFrame.tweenRotate>0?(0>dLX&&(frame.transform.skewX+=2*Math.PI,frame.transform.skewY+=2*Math.PI),prevFrame.tweenRotate>1&&(frame.transform.skewX+=2*Math.PI*(prevFrame.tweenRotate-1),frame.transform.skewY+=2*Math.PI*(prevFrame.tweenRotate-1))):(dLX>0&&(frame.transform.skewX-=2*Math.PI,frame.transform.skewY-=2*Math.PI),prevFrame.tweenRotate<1&&(frame.transform.skewX+=2*Math.PI*(prevFrame.tweenRotate+1),frame.transform.skewY+=2*Math.PI*(prevFrame.tweenRotate+1))):(frame.transform.skewX=prevFrame.transform.skewX+TransformUtil.formatRadian(frame.transform.skewX-prevFrame.transform.skewX),frame.transform.skewY=prevFrame.transform.skewY+TransformUtil.formatRadian(frame.transform.skewY-prevFrame.transform.skewY))}prevFrame=frame}timeline.transformed=!0}},DBDataUtil.getTimelineTransform=function(timeline,position,retult){for(var currentFrame,tweenEasing,progress,nextFrame,frameList=timeline.getFrameList(),i=frameList.length;i--;)if(currentFrame=frameList[i],currentFrame.position<=position&&currentFrame.position+currentFrame.duration>position){tweenEasing=currentFrame.tweenEasing,i==frameList.length-1||isNaN(tweenEasing)||position==currentFrame.position?retult.copy(currentFrame.global):(progress=(position-currentFrame.position)/currentFrame.duration,tweenEasing&&(progress=animation.TimelineState.getEaseValue(progress,tweenEasing)),nextFrame=frameList[i+1],retult.x=currentFrame.global.x+(nextFrame.global.x-currentFrame.global.x)*progress,retult.y=currentFrame.global.y+(nextFrame.global.y-currentFrame.global.y)*progress,retult.skewX=TransformUtil.formatRadian(currentFrame.global.skewX+(nextFrame.global.skewX-currentFrame.global.skewX)*progress),retult.skewY=TransformUtil.formatRadian(currentFrame.global.skewY+(nextFrame.global.skewY-currentFrame.global.skewY)*progress),retult.scaleX=currentFrame.global.scaleX+(nextFrame.global.scaleX-currentFrame.global.scaleX)*progress,retult.scaleY=currentFrame.global.scaleY+(nextFrame.global.scaleY-currentFrame.global.scaleY)*progress);break}},DBDataUtil.addHideTimeline=function(animationData,armatureData){for(var boneData,boneName,boneDataList=armatureData.getBoneDataList(),i=boneDataList.length;i--;)boneData=boneDataList[i],boneName=boneData.name,animationData.getTimeline(boneName)||animationData.addTimeline(objects.TransformTimeline.HIDE_TIMELINE,boneName)},DBDataUtil._helpTransform1=new objects.DBTransform,DBDataUtil._helpTransform2=new objects.DBTransform,DBDataUtil}();utils.DBDataUtil=DBDataUtil}(dragonBones.utils||(dragonBones.utils={}));var utils=dragonBones.utils,DBObject=function(){function DBObject(){this.global=new objects.DBTransform,this.origin=new objects.DBTransform,this.offset=new objects.DBTransform,this.tween=new objects.DBTransform,this.tween.scaleX=this.tween.scaleY=0,this._globalTransformMatrix=new geom.Matrix,this._visible=!0,this._isColorChanged=!1,this._isDisplayOnStage=!1,this._scaleType=0,this.fixedRotation=!1}return DBObject.prototype.getVisible=function(){return this._visible},DBObject.prototype.setVisible=function(value){this._visible=value},DBObject.prototype._setParent=function(value){this.parent=value},DBObject.prototype._setArmature=function(value){this.armature&&this.armature._removeDBObject(this),this.armature=value,this.armature&&this.armature._addDBObject(this)},DBObject.prototype.dispose=function(){this.parent=null,this.armature=null,this.global=null,this.origin=null,this.offset=null,this.tween=null,this._globalTransformMatrix=null},DBObject.prototype._update=function(){if(this.global.scaleX=(this.origin.scaleX+this.tween.scaleX)*this.offset.scaleX,this.global.scaleY=(this.origin.scaleY+this.tween.scaleY)*this.offset.scaleY,this.parent){var x=this.origin.x+this.offset.x+this.tween.x,y=this.origin.y+this.offset.y+this.tween.y,parentMatrix=this.parent._globalTransformMatrix;this._globalTransformMatrix.tx=this.global.x=parentMatrix.a*x+parentMatrix.c*y+parentMatrix.tx,this._globalTransformMatrix.ty=this.global.y=parentMatrix.d*y+parentMatrix.b*x+parentMatrix.ty,this.fixedRotation?(this.global.skewX=this.origin.skewX+this.offset.skewX+this.tween.skewX,this.global.skewY=this.origin.skewY+this.offset.skewY+this.tween.skewY):(this.global.skewX=this.origin.skewX+this.offset.skewX+this.tween.skewX+this.parent.global.skewX,this.global.skewY=this.origin.skewY+this.offset.skewY+this.tween.skewY+this.parent.global.skewY),this.parent.scaleMode>=this._scaleType&&(this.global.scaleX*=this.parent.global.scaleX,this.global.scaleY*=this.parent.global.scaleY)}else this._globalTransformMatrix.tx=this.global.x=this.origin.x+this.offset.x+this.tween.x,this._globalTransformMatrix.ty=this.global.y=this.origin.y+this.offset.y+this.tween.y,this.global.skewX=this.origin.skewX+this.offset.skewX+this.tween.skewX,this.global.skewY=this.origin.skewY+this.offset.skewY+this.tween.skewY;this._globalTransformMatrix.a=this.global.scaleX*Math.cos(this.global.skewY),this._globalTransformMatrix.b=this.global.scaleX*Math.sin(this.global.skewY),this._globalTransformMatrix.c=-this.global.scaleY*Math.sin(this.global.skewX),this._globalTransformMatrix.d=this.global.scaleY*Math.cos(this.global.skewX)},DBObject}();dragonBones.DBObject=DBObject;var Slot=function(_super){function Slot(displayBrideg){_super.call(this),this._displayBridge=displayBrideg,this._displayList=[],this._displayIndex=-1,this._scaleType=1,this._originZOrder=0,this._tweenZorder=0,this._offsetZOrder=0,this._isDisplayOnStage=!1,this._isHideDisplay=!1}return __extends(Slot,_super),Slot.prototype.getZOrder=function(){return this._originZOrder+this._tweenZorder+this._offsetZOrder},Slot.prototype.setZOrder=function(value){this.getZOrder()!=value&&(this._offsetZOrder=value-this._originZOrder-this._tweenZorder,this.armature&&(this.armature._slotsZOrderChanged=!0))},Slot.prototype.getDisplay=function(){var display=this._displayList[this._displayIndex];return display instanceof Armature?display.getDisplay():display},Slot.prototype.setDisplay=function(value){this._displayList[this._displayIndex]=value,this._setDisplay(value)},Slot.prototype.getChildArmature=function(){var display=this._displayList[this._displayIndex];return display instanceof Armature?display:null},Slot.prototype.setChildArmature=function(value){this._displayList[this._displayIndex]=value,value&&this._setDisplay(value.getDisplay())},Slot.prototype.getDisplayList=function(){return this._displayList},Slot.prototype.setDisplayList=function(value){if(!value)throw new Error;for(var i=this._displayList.length=value.length;i--;)this._displayList[i]=value[i];if(this._displayIndex>=0){var displayIndexBackup=this._displayIndex;this._displayIndex=-1,this._changeDisplay(displayIndexBackup)}},Slot.prototype._setDisplay=function(display){this._displayBridge.getDisplay()?this._displayBridge.setDisplay(display):(this._displayBridge.setDisplay(display),this.armature&&(this._displayBridge.addDisplay(this.armature.getDisplay(),-1),this.armature._slotsZOrderChanged=!0)),this.updateChildArmatureAnimation(),!this._isHideDisplay&&this._displayBridge.getDisplay()?this._isDisplayOnStage=!0:this._isDisplayOnStage=!1},Slot.prototype._changeDisplay=function(displayIndex){if(0>displayIndex)this._isHideDisplay||(this._isHideDisplay=!0,this._displayBridge.removeDisplay(),this.updateChildArmatureAnimation());else{if(this._isHideDisplay){this._isHideDisplay=!1;var changeShowState=!0;this.armature&&(this._displayBridge.addDisplay(this.armature.getDisplay(),-1),this.armature._slotsZOrderChanged=!0)}var length=this._displayList.length;if(displayIndex>=length&&length>0&&(displayIndex=length-1),this._displayIndex!=displayIndex){this._displayIndex=displayIndex;var display=this._displayList[this._displayIndex];display instanceof Armature?this._setDisplay(display.getDisplay()):this._setDisplay(display),this._dislayDataList&&this._displayIndex<=this._dislayDataList.length&&this.origin.copy(this._dislayDataList[this._displayIndex].transform)}else changeShowState&&this.updateChildArmatureAnimation()}!this._isHideDisplay&&this._displayBridge.getDisplay()?this._isDisplayOnStage=!0:this._isDisplayOnStage=!1},Slot.prototype.setVisible=function(value){value!=this._visible&&(this._visible=value,this._updateVisible(this._visible))},Slot.prototype._setArmature=function(value){_super.prototype._setArmature.call(this,value),this.armature?(this.armature._slotsZOrderChanged=!0,this._displayBridge.addDisplay(this.armature.getDisplay(),-1)):this._displayBridge.removeDisplay()},Slot.prototype.dispose=function(){this._displayBridge&&(_super.prototype.dispose.call(this),this._displayBridge.dispose(),this._displayList.length=0,this._displayBridge=null,this._displayList=null,this._dislayDataList=null)},Slot.prototype._update=function(){if(_super.prototype._update.call(this),this._isDisplayOnStage){var pivotX=this.parent._tweenPivot.x,pivotY=this.parent._tweenPivot.y;if(pivotX||pivotY){var parentMatrix=this.parent._globalTransformMatrix;this._globalTransformMatrix.tx+=parentMatrix.a*pivotX+parentMatrix.c*pivotY,this._globalTransformMatrix.ty+=parentMatrix.b*pivotX+parentMatrix.d*pivotY}this._displayBridge.updateTransform(this._globalTransformMatrix,this.global)}},Slot.prototype._updateVisible=function(value){this._displayBridge.setVisible(this.parent.getVisible()&&this._visible&&value)},Slot.prototype.updateChildArmatureAnimation=function(){var childArmature=this.getChildArmature();if(childArmature)if(this._isHideDisplay)childArmature.animation.stop(),childArmature.animation._lastAnimationState=null;else{var lastAnimationName=this.armature?this.armature.animation.getLastAnimationName():null;lastAnimationName&&childArmature.animation.hasAnimation(lastAnimationName)?childArmature.animation.gotoAndPlay(lastAnimationName):childArmature.animation.play()}},Slot}(DBObject);dragonBones.Slot=Slot;var Bone=function(_super){function Bone(){_super.call(this),this._children=[],this._scaleType=2,this._tweenPivot=new geom.Point,this.scaleMode=1}return __extends(Bone,_super),Bone.prototype.setVisible=function(value){if(this._visible!=value){this._visible=value;for(var i=this._children.length;i--;){var child=this._children[i];child instanceof Slot&&child._updateVisible(this._visible)}}},Bone.prototype._setArmature=function(value){_super.prototype._setArmature.call(this,value);for(var i=this._children.length;i--;)this._children[i]._setArmature(this.armature)},Bone.prototype.dispose=function(){if(this._children){_super.prototype.dispose.call(this);for(var i=this._children.length;i--;)this._children[i].dispose();this._children.length=0,this._children=null,this._tweenPivot=null,this.slot=null}},Bone.prototype.contains=function(child){if(!child)throw new Error;if(child==this)return!1;for(var ancestor=child;ancestor!=this&&null!=ancestor;)ancestor=ancestor.parent;return ancestor==this},Bone.prototype.addChild=function(child){if(!child)throw new Error;if(child==this||child instanceof Bone&&child.contains(this))throw new Error("An Bone cannot be added as a child to itself or one of its children (or children's children, etc.)");child.parent&&child.parent.removeChild(child),this._children[this._children.length]=child,child._setParent(this),child._setArmature(this.armature),!this.slot&&child instanceof Slot&&(this.slot=child)},Bone.prototype.removeChild=function(child){if(!child)throw new Error;var index=this._children.indexOf(child);if(!(index>=0))throw new Error;this._children.splice(index,1),child._setParent(null),child._setArmature(null),child==this.slot&&(this.slot=null)},Bone.prototype.getSlots=function(){for(var slotList=[],i=this._children.length;i--;)this._children[i]instanceof Slot&&slotList.unshift(this._children[i]);return slotList},Bone.prototype._arriveAtFrame=function(frame,timelineState,animationState,isCross){if(frame){var mixingType=animationState.getMixingTransform(name);if(!(!animationState.displayControl||2!=mixingType&&-1!=mixingType||this.displayController&&this.displayController!=animationState.name)){var tansformFrame=frame;if(this.slot){var displayIndex=tansformFrame.displayIndex;displayIndex>=0&&(isNaN(tansformFrame.zOrder)||tansformFrame.zOrder==this.slot._tweenZorder||(this.slot._tweenZorder=tansformFrame.zOrder,this.armature._slotsZOrderChanged=!0)),this.slot._changeDisplay(displayIndex),this.slot._updateVisible(tansformFrame.visible)}}if(frame.event&&this.armature.hasEventListener(events.FrameEvent.BONE_FRAME_EVENT)){var frameEvent=new events.FrameEvent(events.FrameEvent.BONE_FRAME_EVENT);frameEvent.bone=this,frameEvent.animationState=animationState,frameEvent.frameLabel=frame.event,this.armature._eventList.push(frameEvent)}if(frame.sound&&Bone._soundManager.hasEventListener(events.SoundEvent.SOUND)){var soundEvent=new events.SoundEvent(events.SoundEvent.SOUND);soundEvent.armature=this.armature,soundEvent.animationState=animationState,soundEvent.sound=frame.sound,Bone._soundManager.dispatchEvent(soundEvent)}if(frame.action)for(var index in this._children)if(this._children[index]instanceof Slot){var childArmature=this._children[index].getChildArmature();childArmature&&childArmature.animation.gotoAndPlay(frame.action)}}else this.slot&&this.slot._changeDisplay(-1)},Bone.prototype._updateColor=function(aOffset,rOffset,gOffset,bOffset,aMultiplier,rMultiplier,gMultiplier,bMultiplier,isColorChanged){(isColorChanged||this._isColorChanged)&&this.slot._displayBridge.updateColor(aOffset,rOffset,gOffset,bOffset,aMultiplier,rMultiplier,gMultiplier,bMultiplier),this._isColorChanged=isColorChanged},Bone._soundManager=events.SoundEventManager.getInstance(),Bone}(DBObject);dragonBones.Bone=Bone;var Armature=function(_super){function Armature(display){_super.call(this),this.animation=new animation.Animation(this),this._display=display,this._slotsZOrderChanged=!1,this._slotList=[],this._boneList=[],this._eventList=[]}return __extends(Armature,_super),Armature.prototype.getDisplay=function(){return this._display},Armature.prototype.dispose=function(){if(this.animation){dragonBones.animation.WorldClock.clock.remove(this),this.animation.dispose();for(var i=this._slotList.length;i--;)this._slotList[i].dispose();
for(i=this._boneList.length;i--;)this._boneList[i].dispose();this._slotList.length=0,this._boneList.length=0,this._eventList.length=0,this._slotList=null,this._boneList=null,this._eventList=null,this._display=null,this.animation=null}},Armature.prototype.advanceTime=function(passedTime){this.animation.advanceTime(passedTime),passedTime*=this.animation.timeScale;for(var i=this._boneList.length;i--;)this._boneList[i]._update();i=this._slotList.length;for(var slot;i--;)if(slot=this._slotList[i],slot._update(),slot._isDisplayOnStage){var childArmature=slot.getChildArmature();childArmature&&childArmature.advanceTime(passedTime)}if(this._slotsZOrderChanged&&(this.updateSlotsZOrder(),this.hasEventListener(events.ArmatureEvent.Z_ORDER_UPDATED)&&this.dispatchEvent(new events.ArmatureEvent(events.ArmatureEvent.Z_ORDER_UPDATED))),this._eventList.length){var length=this._eventList.length;for(i=0;length>i;i++)this.dispatchEvent(this._eventList[i]);this._eventList.length=0}},Armature.prototype.getSlots=function(returnCopy){return"undefined"==typeof returnCopy&&(returnCopy=!0),returnCopy?this._slotList.concat():this._slotList},Armature.prototype.getBones=function(returnCopy){return"undefined"==typeof returnCopy&&(returnCopy=!0),returnCopy?this._boneList.concat():this._boneList},Armature.prototype.getSlot=function(slotName){for(var i=this._slotList.length;i--;)if(this._slotList[i].name==slotName)return this._slotList[i];return null},Armature.prototype.getSlotByDisplay=function(display){if(display)for(var i=this._slotList.length;i--;)if(this._slotList[i].getDisplay()==display)return this._slotList[i];return null},Armature.prototype.removeSlot=function(slot){if(!slot)throw new Error;if(!(this._slotList.indexOf(slot)>=0))throw new Error;slot.parent.removeChild(slot)},Armature.prototype.removeSlotByName=function(slotName){if(slotName){var slot=this.getSlot(slotName);slot&&this.removeSlot(slot)}},Armature.prototype.getBone=function(boneName){for(var i=this._boneList.length;i--;)if(this._boneList[i].name==boneName)return this._boneList[i];return null},Armature.prototype.getBoneByDisplay=function(display){var slot=this.getSlotByDisplay(display);return slot?slot.parent:null},Armature.prototype.removeBone=function(bone){if(!bone)throw new Error;if(!(this._boneList.indexOf(bone)>=0))throw new Error;bone.parent?bone.parent.removeChild(bone):bone._setArmature(null)},Armature.prototype.removeBoneByName=function(boneName){if(boneName){var bone=this.getBone(boneName);bone&&this.removeBone(bone)}},Armature.prototype.addChild=function(object,parentName){if(!object)throw new Error;if(parentName){var boneParent=this.getBone(parentName);if(!boneParent)throw new Error;boneParent.addChild(object)}else object.parent&&object.parent.removeChild(object),object._setArmature(this)},Armature.prototype.updateSlotsZOrder=function(){this._slotList.sort(this.sortSlot);for(var slot,i=this._slotList.length;i--;)slot=this._slotList[i],slot._isDisplayOnStage&&slot._displayBridge.addDisplay(this._display,-1);this._slotsZOrderChanged=!1},Armature.prototype._addDBObject=function(object){if(object instanceof Slot){var slot=object;this._slotList.indexOf(slot)<0&&(this._slotList[this._slotList.length]=slot)}else if(object instanceof Bone){var bone=object;this._boneList.indexOf(bone)<0&&(this._boneList[this._boneList.length]=bone,this._sortBoneList())}},Armature.prototype._removeDBObject=function(object){if(object instanceof Slot){var slot=object,index=this._slotList.indexOf(slot);index>=0&&this._slotList.splice(index,1)}else if(object instanceof Bone){var bone=object;index=this._boneList.indexOf(bone),index>=0&&this._boneList.splice(index,1)}},Armature.prototype._sortBoneList=function(){var i=this._boneList.length;if(0!=i){for(var level,bone,boneParent,helpArray=[];i--;){for(level=0,bone=this._boneList[i],boneParent=bone;boneParent;)level++,boneParent=boneParent.parent;helpArray[i]={level:level,bone:bone}}for(helpArray.sort(this.sortBone),i=helpArray.length;i--;)this._boneList[i]=helpArray[i].bone}},Armature.prototype._arriveAtFrame=function(frame,timelineState,animationState,isCross){if(frame.event&&this.hasEventListener(events.FrameEvent.ANIMATION_FRAME_EVENT)){var frameEvent=new events.FrameEvent(events.FrameEvent.ANIMATION_FRAME_EVENT);frameEvent.animationState=animationState,frameEvent.frameLabel=frame.event,this._eventList.push(frameEvent)}if(frame.sound&&Armature._soundManager.hasEventListener(events.SoundEvent.SOUND)){var soundEvent=new events.SoundEvent(events.SoundEvent.SOUND);soundEvent.armature=this,soundEvent.animationState=animationState,soundEvent.sound=frame.sound,Armature._soundManager.dispatchEvent(soundEvent)}frame.action&&animationState.isPlaying&&this.animation.gotoAndPlay(frame.action)},Armature.prototype.sortSlot=function(slot1,slot2){return slot1.getZOrder()<slot2.getZOrder()?1:-1},Armature.prototype.sortBone=function(object1,object2){return object1.level<object2.level?1:-1},Armature._soundManager=events.SoundEventManager.getInstance(),Armature}(events.EventDispatcher);dragonBones.Armature=Armature}(dragonBones||(dragonBones={}));var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __},dragonBones;!function(dragonBones){!function(display){var PixiDisplayBridge=function(){function PixiDisplayBridge(resolution){this.resolution=resolution}return PixiDisplayBridge.prototype.getVisible=function(){return this._display?this._display.visible:!1},PixiDisplayBridge.prototype.setVisible=function(value){this._display&&(this._display.visible=value)},PixiDisplayBridge.prototype.getDisplay=function(){return this._display},PixiDisplayBridge.prototype.setDisplay=function(value){if(this._display!=value){var index=-1;if(this._display){var parent=this._display.parent;parent&&(index=this._display.parent.children.indexOf(this._display)),this.removeDisplay()}this._display=value,this.addDisplay(parent,index)}},PixiDisplayBridge.prototype.dispose=function(){this._display=null},PixiDisplayBridge.prototype.updateTransform=function(matrix,transform){this._display.x=matrix.tx,this._display.y=matrix.ty,this._display.rotation=transform.skewX,this._display.scale.x=transform.scaleX,this._display.scale.y=transform.scaleY},PixiDisplayBridge.prototype.updateColor=function(aOffset,rOffset,gOffset,bOffset,aMultiplier,rMultiplier,gMultiplier,bMultiplier){this._display&&(this._display.alpha=aMultiplier)},PixiDisplayBridge.prototype.addDisplay=function(container,index){var parent=container;parent&&this._display&&(0>index?parent.addChild(this._display):parent.addChildAt(this._display,Math.min(index,parent.children.length)))},PixiDisplayBridge.prototype.removeDisplay=function(){this._display&&this._display.parent&&this._display.parent.removeChild(this._display)},PixiDisplayBridge.RADIAN_TO_ANGLE=180/Math.PI,PixiDisplayBridge}();display.PixiDisplayBridge=PixiDisplayBridge}(dragonBones.display||(dragonBones.display={}));var display=dragonBones.display;!function(textures){var PixiTextureAtlas=function(){function PixiTextureAtlas(image,textureAtlasRawData,scale){"undefined"==typeof scale&&(scale=1),this._regions={},this.image=image,this.scale=scale,this.parseData(textureAtlasRawData)}return PixiTextureAtlas.prototype.dispose=function(){this.image=null,this._regions=null},PixiTextureAtlas.prototype.getRegion=function(subTextureName){return this._regions[subTextureName]},PixiTextureAtlas.prototype.parseData=function(textureAtlasRawData){var textureAtlasData=dragonBones.objects.DataParser.parseTextureAtlasData(textureAtlasRawData,this.scale);this.name=textureAtlasData.__name,delete textureAtlasData.__name;for(var subTextureName in textureAtlasData)this._regions[subTextureName]=textureAtlasData[subTextureName]},PixiTextureAtlas}();textures.PixiTextureAtlas=PixiTextureAtlas}(dragonBones.textures||(dragonBones.textures={}));dragonBones.textures;!function(factorys){var PixiFactory=function(_super){function PixiFactory(resolution){_super.call(this),this.resolution=resolution}return __extends(PixiFactory,_super),PixiFactory.prototype._generateArmature=function(){var armature=new dragonBones.Armature(new PIXI.DisplayObjectContainer);return armature},PixiFactory.prototype._generateSlot=function(){var slot=new dragonBones.Slot(new display.PixiDisplayBridge(this.resolution));return slot},PixiFactory.prototype._generateDisplay=function(textureAtlas,fullName,pivotX,pivotY){var texture=PIXI.TextureCache[fullName+".png"],image=new PIXI.Sprite(texture);return image.pivot.x=pivotX,image.pivot.y=pivotY,image},PixiFactory}(factorys.BaseFactory);factorys.PixiFactory=PixiFactory}(dragonBones.factorys||(dragonBones.factorys={}));dragonBones.factorys}(dragonBones||(dragonBones={})),dragonBones.parseJSONAtlas=function(atlasJson,name,partsList){function createFrame(txData,p_partName){var frame=txData.frame,subTexture={name:p_partName};subTexture.x=frame.x,subTexture.y=frame.y,subTexture.width=frame.w,subTexture.height=frame.h,bonesAtlas.SubTexture[i]=subTexture}var bonesAtlas={};bonesAtlas.name=name,bonesAtlas.SubTexture=[];var n=partsList.length,subTextures=atlasJson.frames,isArray=Array.isArray(subTextures),k=0;isArray&&(k=subTextures.length);for(var partName,txData,filename,hasExtension,i=0;n>i;i++)if(partName=partsList[i],hasExtension=null!==partName.match(/.png/i),hasExtension?(filename=partName,partName=filename.substr(-4)):filename=partName+".png",isArray){for(var j=0;k>j;j++)if(txData=subTextures[j],txData.filename==filename){createFrame(txData,partName);break}}else for(var s in subTextures)if(s==filename){createFrame(subTextures[s],partName);break}return bonesAtlas},dragonBones.fadeTime=0,dragonBones.makeArmaturePIXI=function(config,skeletonJSON,atlasJson,texture){var skeletonId=config.skeletonId,armatureName=config.armatureName,animationId=config.animationId,atlasJson=config.atlasJson||atlasJson,skeletonJSON=config.skeletonJSON||skeletonJSON,partsList=config.partsList,textureData=dragonBones.parseJSONAtlas(atlasJson,skeletonId,partsList);texture||(texture=null);var factory=new dragonBones.factorys.PixiFactory(game_shell.resolution),skeletonData=dragonBones.objects.DataParser.parseSkeletonData(skeletonJSON);factory.addSkeletonData(skeletonData);var atlas=new dragonBones.textures.PixiTextureAtlas(texture,textureData);return factory.addTextureAtlas(atlas),factory.buildArmature(armatureName,animationId,skeletonId)},dragonBones.BonesSprite=function(){this.armatureData=null,this.armature=null,this.bonesBase=null,this.root=null,this.fadeTime=dragonBones.fadeTime,this.eventComplete={type:"complete",timeline:null}},dragonBones.BonesSprite.prototype=Object.create(alex.utils.EventDispatcher.prototype),dragonBones.BonesSprite.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.root=new PIXI.DisplayObjectContainer,this.createArmature(this.armatureData,config.x,config.y)},dragonBones.BonesSprite.prototype.dispose=function(){this.armature&&this.armature.dispose(),this.armature=null,this.bonesBase=null},dragonBones.BonesSprite.prototype.createArmature=function(armatureData,x,y){this.armature=dragonBones.makeArmaturePIXI(armatureData),this.bonesBase=this.armature.getDisplay(),this.bonesBase.x=x||0,this.bonesBase.y=y||0,this.root.addChild(this.bonesBase);var evt=dragonBones.events.AnimationEvent.COMPLETE,self=this;this.armature.addEventListener(evt,function(event){self.animationComplete(event)}),dragonBones.animation.WorldClock.clock.add(this.armature),this.play(armatureData.animationId),this.armature.animation.advanceTime(.001),this.armature.animation.stop()},dragonBones.BonesSprite.prototype.play=function(id){return id||(id="idle"),this.armature.animation.gotoAndPlay(id,this.fadeTime)},dragonBones.BonesSprite.prototype.stop=function(){this.armature.animation.stop()},dragonBones.BonesSprite.prototype.gotoAndStop=function(label){this.armature.animation.gotoAndStop(label)},dragonBones.BonesSprite.prototype.animationComplete=function(event){this.eventComplete.timeline=event.animationState.name,this.emit(this.eventComplete)},/*!
 * Proton v1.0.1
 * https://github.com/a-jie/Proton
 *
 * Copyright 2011-2013, A-JIE
 * Licensed under the MIT license
 * http://www.opensource.org/licenses/mit-license
 *
 */
function(window,undefined){function Proton(proParticleCount,integrationType){this.proParticleCount=Proton.Util.initValue(proParticleCount,Proton.POOL_MAX),this.integrationType=Proton.Util.initValue(integrationType,Proton.EULER),this.emitters=[],this.renderers=[],this.time=0,this.oldTime=0,Proton.pool=new Proton.ParticlePool(this.proParticleCount),Proton.integrator=new Proton.NumericalIntegration(this.integrationType)}function EventDispatcher(){this.initialize()}function Event(pObj){this.type=pObj.type,this.particle=pObj.particle,this.emitter=pObj.emitter}function MStack(){this.mats=[],this.size=0;for(var i=0;20>i;i++)this.mats.push(Proton.Mat3.create([0,0,0,0,0,0,0,0,0]))}function Particle(pOBJ){this.id="particle_"+Particle.ID++,this.reset(!0),Proton.Util.setPrototypeByObject(this,pOBJ)}function ParticlePool(num,releaseTime){this.proParticleCount=Proton.Util.initValue(num,0),this.releaseTime=Proton.Util.initValue(releaseTime,-1),this.poolList=[],this.timeoutID=0;for(var i=0;i<this.proParticleCount;i++)this.add();this.releaseTime>0&&(this.timeoutID=setTimeout(this.release,this.releaseTime/1e3))}function Span(a,b,center){this.isArray=!1,Proton.Util.isArray(a)?(this.isArray=!0,this.a=a):(this.a=Proton.Util.initValue(a,1),this.b=Proton.Util.initValue(b,this.a),this.center=Proton.Util.initValue(center,!1))}function ColorSpan(color){Proton.Util.isArray(color)?this.colorArr=color:this.colorArr=[color]}function Rectangle(x,y,w,h){this.x=x,this.y=y,this.width=w,this.height=h,this.bottom=this.y+this.height,this.right=this.x+this.width}function Behaviour(life,easing){this.id="Behaviour_"+Behaviour.id++,this.life=Proton.Util.initValue(life,1/0),this.easing=Proton.ease.setEasingByName(easing),this.age=0,this.energy=1,this.dead=!1,this.parents=[],this.name="Behaviour"}function Rate(numpan,timepan){this.numPan=Proton.Util.initValue(numpan,1),this.timePan=Proton.Util.initValue(timepan,1),this.numPan=Proton.Util.setSpanValue(this.numPan),this.timePan=Proton.Util.setSpanValue(this.timePan),this.startTime=0,this.nextTime=0,this.init()}function Initialize(){}function Life(a,b,c){Life._super_.call(this),this.lifePan=Proton.Util.setSpanValue(a,b,c)}function Position(zone){Position._super_.call(this),this.zone=Proton.Util.initValue(zone,new Proton.PointZone)}function Velocity(rpan,thapan,type){Velocity._super_.call(this),this.rPan=Proton.Util.setSpanValue(rpan),this.thaPan=Proton.Util.setSpanValue(thapan),this.type=Proton.Util.initValue(type,"vector")}function Mass(a,b,c){Mass._super_.call(this),this.massPan=Proton.Util.setSpanValue(a,b,c)}function Radius(a,b,c){Radius._super_.call(this),this.radius=Proton.Util.setSpanValue(a,b,c)}function ImageTarget(image,w,h){ImageTarget._super_.call(this),this.image=this.setSpanValue(image),this.w=Proton.Util.initValue(w,20),this.h=Proton.Util.initValue(h,this.w)}function Force(fx,fy,life,easing){Force._super_.call(this,life,easing),this.force=this.normalizeForce(new Proton.Vector2D(fx,fy)),this.name="Force"}function Attraction(targetPosition,force,radius,life,easing){Attraction._super_.call(this,life,easing),this.targetPosition=Proton.Util.initValue(targetPosition,new Proton.Vector2D),this.radius=Proton.Util.initValue(radius,1e3),this.force=Proton.Util.initValue(this.normalizeValue(force),100),this.radiusSq=this.radius*this.radius,this.attractionForce=new Proton.Vector2D,this.lengthSq=0,this.name="Attraction"}function RandomDrift(driftX,driftY,delay,life,easing){RandomDrift._super_.call(this,life,easing),this.reset(driftX,driftY,delay),this.time=0,this.name="RandomDrift"}function Repulsion(targetPosition,force,radius,life,easing){Repulsion._super_.call(this,targetPosition,force,radius,life,easing),this.force*=-1,this.name="Repulsion"}function Gravity(g,life,easing){Gravity._super_.call(this,0,g,life,easing),this.name="Gravity"}function Collision(emitter,mass,callback,life,easing){Collision._super_.call(this,life,easing),this.reset(emitter,mass,callback),this.name="Collision"}function CrossZone(zone,crossType,life,easing){CrossZone._super_.call(this,life,easing),this.reset(zone,crossType),this.name="CrossZone"}function Alpha(a,b,life,easing){Alpha._super_.call(this,life,easing),this.reset(a,b),this.name="Alpha"}function Scale(a,b,life,easing){Scale._super_.call(this,life,easing),this.reset(a,b),this.name="Scale"}function Rotate(a,b,style,life,easing){Rotate._super_.call(this,life,easing),this.reset(a,b,style),this.name="Rotate"}function Color(color1,color2,life,easing){Color._super_.call(this,life,easing),this.reset(color1,color2),this.name="Color"}function GravityWell(centerPoint,force,life,easing){GravityWell._super_.call(this,life,easing),this.distanceVec=new Proton.Vector2D,this.centerPoint=Proton.Util.initValue(centerPoint,new Proton.Vector2D),this.force=Proton.Util.initValue(this.normalizeValue(force),100),this.name="GravityWell"}function Emitter(pObj){this.initializes=[],this.particles=[],this.behaviours=[],this.emitTime=0,this.emitTotalTimes=-1,this.damping=.006,this.bindEmitter=!0,this.rate=new Proton.Rate(1,.1),Emitter._super_.call(this,pObj),this.id="emitter_"+Emitter.ID++}function BehaviourEmitter(pObj){this.selfBehaviours=[],BehaviourEmitter._super_.call(this,pObj)}function FollowEmitter(mouseTarget,ease,pObj){this.mouseTarget=Proton.Util.initValue(mouseTarget,window),this.ease=Proton.Util.initValue(ease,.7),this._allowEmitting=!1,this.initEventHandler(),FollowEmitter._super_.call(this,pObj)}function Renderer(type,proton,element){this.element=element,this.type=Proton.Util.initValue(type,"canvas"),this.proton=proton,this.renderer=this.getRenderer()}function BaseRender(proton,element,stroke){this.proton=proton,this.element=element,this.stroke=stroke}function DomRender(proton,element){DomRender._super_.call(this,proton,element),this.stroke=null}function EaselRender(proton,element,stroke){EaselRender._super_.call(this,proton,element),this.stroke=stroke}function CanvasRender(proton,element){CanvasRender._super_.call(this,proton,element),this.stroke=null,this.context=this.element.getContext("2d"),this.bufferCache={}}function PixelRender(proton,element,rectangle){PixelRender._super_.call(this,proton,element),this.context=this.element.getContext("2d"),this.imageData=null,this.rectangle=null,this.rectangle=rectangle,this.createImageData(rectangle)}function WebGLRender(proton,element){WebGLRender._super_.call(this,proton,element),this.gl=this.element.getContext("experimental-webgl",{antialias:!0,stencil:!1,depth:!1}),this.gl||alert("Sorry your browser do not suppest WebGL!"),this.initVar(),this.setMaxRadius(),this.initShaders(),this.initBuffers(),this.gl.blendEquation(this.gl.FUNC_ADD),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.enable(this.gl.BLEND)}function Zone(){this.vector=new Proton.Vector2D(0,0),this.random=0,this.crossType="dead",this.alert=!0}function LineZone(x1,y1,x2,y2,direction){LineZone._super_.call(this),x2-x1>=0?(this.x1=x1,this.y1=y1,this.x2=x2,this.y2=y2):(this.x1=x2,this.y1=y2,this.x2=x1,this.y2=y1),this.dx=this.x2-this.x1,this.dy=this.y2-this.y1,this.minx=Math.min(this.x1,this.x2),this.miny=Math.min(this.y1,this.y2),this.maxx=Math.max(this.x1,this.x2),this.maxy=Math.max(this.y1,this.y2),this.dot=this.x2*this.y1-this.x1*this.y2,this.xxyy=this.dx*this.dx+this.dy*this.dy,this.gradient=this.getGradient(),this.length=this.getLength(),this.direction=Proton.Util.initValue(direction,">")}function CircleZone(x,y,radius){CircleZone._super_.call(this),this.x=x,this.y=y,this.radius=radius,this.angle=0,this.center={x:this.x,y:this.y}}function PointZone(x,y){PointZone._super_.call(this),this.x=x,this.y=y}function RectZone(x,y,width,height){RectZone._super_.call(this),this.x=x,this.y=y,this.width=width,this.height=height}function ImageZone(imageData,x,y,d){ImageZone._super_.call(this),this.reset(imageData,x,y,d)}Proton.POOL_MAX=1e3,Proton.TIME_STEP=60,Proton.MEASURE=100,Proton.EULER="euler",Proton.RK2="runge-kutta2",Proton.RK4="runge-kutta4",Proton.VERLET="verlet",Proton.PARTICLE_CREATED="partilcleCreated",Proton.PARTICLE_UPDATE="partilcleUpdate",Proton.PARTICLE_SLEEP="particleSleep",Proton.PARTICLE_DEAD="partilcleDead",Proton.PROTON_UPDATE="protonUpdate",Proton.PROTON_UPDATE_AFTER="protonUpdateAfter",Proton.EMITTER_ADDED="emitterAdded",Proton.EMITTER_REMOVED="emitterRemoved",Proton.amendChangeTabsBug=!0,Proton.TextureBuffer={},Proton.TextureCanvasBuffer={},Proton.prototype={addRender:function(render){render.proton=this,this.renderers.push(render.proton)},addEmitter:function(emitter){this.emitters.push(emitter),emitter.parent=this,this.dispatchEvent(new Proton.Event({type:Proton.EMITTER_ADDED,emitter:emitter}))},removeEmitter:function(emitter){var index=this.emitters.indexOf(emitter);this.emitters.splice(index,1),emitter.parent=null,this.dispatchEvent(new Proton.Event({type:Proton.EMITTER_REMOVED,emitter:emitter}))},update:function(delta){if(this.dispatchEvent(new Proton.Event({type:Proton.PROTON_UPDATE})),delta)this.elapsed=delta/1e3;else{this.oldTime||(this.oldTime=(new Date).getTime());var time=(new Date).getTime();this.elapsed=(time-this.oldTime)/1e3,Proton.amendChangeTabsBug&&this.amendChangeTabsBug(),this.oldTime=time}if(this.elapsed>0)for(var i=0;i<this.emitters.length;i++)this.emitters[i].update(this.elapsed);this.dispatchEvent(new Proton.Event({type:Proton.PROTON_UPDATE_AFTER}))},amendChangeTabsBug:function(){this.elapsed>.5&&(this.oldTime=(new Date).getTime(),this.elapsed=0)},getCount:function(){for(var total=0,length=this.emitters.length,i=0;length>i;i++)total+=this.emitters[i].particles.length;return total},destroy:function(){for(var length=this.emitters.length,i=0;length>i;i++)this.emitters[i].destory(),delete this.emitters[i];this.emitters=[],this.time=0,this.oldTime=0,Proton.pool.release()}},window.Proton=Proton;var p=EventDispatcher.prototype;EventDispatcher.initialize=function(target){target.addEventListener=p.addEventListener,target.removeEventListener=p.removeEventListener,target.removeAllEventListeners=p.removeAllEventListeners,target.hasEventListener=p.hasEventListener,target.dispatchEvent=p.dispatchEvent},p._listeners=null,p.initialize=function(){},p.addEventListener=function(type,listener){var listeners=this._listeners;listeners?this.removeEventListener(type,listener):listeners=this._listeners={};var arr=listeners[type];return arr||(arr=listeners[type]=[]),arr.push(listener),listener},p.removeEventListener=function(type,listener){var listeners=this._listeners;if(listeners){var arr=listeners[type];if(arr)for(var i=0,l=arr.length;l>i;i++)if(arr[i]==listener){1==l?delete listeners[type]:arr.splice(i,1);break}}},p.removeAllEventListeners=function(type){type?this._listeners&&delete this._listeners[type]:this._listeners=null},p.dispatchEvent=function(eventObj,target){var ret=!1,listeners=this._listeners;if(eventObj&&listeners){"string"==typeof eventObj&&(eventObj={type:eventObj});var arr=listeners[eventObj.type];if(!arr)return ret;eventObj.target=target||this,arr=arr.slice();for(var i=0,l=arr.length;l>i;i++){var o=arr[i];ret=o.handleEvent?ret||o.handleEvent(eventObj):ret||o(eventObj)}}return!!ret},p.hasEventListener=function(type){var listeners=this._listeners;return!(!listeners||!listeners[type])},Proton.EventDispatcher=EventDispatcher,Proton.EventDispatcher.initialize(Proton.prototype),Event.PARTICLE_CREATED=Proton.PARTICLE_CREATED,Event.PARTICLE_UPDATA=Proton.PARTICLE_UPDATA,Event.PARTICLE_SLEEP=Proton.PARTICLE_SLEEP,Event.PARTICLE_DEAD=Proton.PARTICLE_DEAD,Proton.Event=Event;var Util=Util||{initValue:function(value,defaults){var value=null!=value&&value!=undefined?value:defaults;return value},isArray:function(value){return"object"==typeof value&&value.hasOwnProperty("length")},destroyArray:function(array){array.length=0},destroyObject:function(obj){for(var o in obj)delete obj[o]},getVector2D:function(postionOrX,y){if("object"==typeof postionOrX)return postionOrX;var vector2d=new Proton.Vector2D(postionOrX,y);return vector2d},judgeVector2D:function(pOBJ){var result="";return(pOBJ.hasOwnProperty("x")||pOBJ.hasOwnProperty("y")||pOBJ.hasOwnProperty("p")||pOBJ.hasOwnProperty("position"))&&(result+="p"),(pOBJ.hasOwnProperty("vx")||pOBJ.hasOwnProperty("vx")||pOBJ.hasOwnProperty("v")||pOBJ.hasOwnProperty("velocity"))&&(result+="v"),(pOBJ.hasOwnProperty("ax")||pOBJ.hasOwnProperty("ax")||pOBJ.hasOwnProperty("a")||pOBJ.hasOwnProperty("accelerate"))&&(result+="a"),result},setVector2DByObject:function(target,pOBJ){pOBJ.hasOwnProperty("x")&&(target.p.x=pOBJ.x),pOBJ.hasOwnProperty("y")&&(target.p.y=pOBJ.y),pOBJ.hasOwnProperty("vx")&&(target.v.x=pOBJ.vx),pOBJ.hasOwnProperty("vy")&&(target.v.y=pOBJ.vy),pOBJ.hasOwnProperty("ax")&&(target.a.x=pOBJ.ax),pOBJ.hasOwnProperty("ay")&&(target.a.y=pOBJ.ay),pOBJ.hasOwnProperty("p")&&particle.p.copy(pOBJ.p),pOBJ.hasOwnProperty("v")&&particle.v.copy(pOBJ.v),pOBJ.hasOwnProperty("a")&&particle.a.copy(pOBJ.a),pOBJ.hasOwnProperty("position")&&particle.p.copy(pOBJ.position),pOBJ.hasOwnProperty("velocity")&&particle.v.copy(pOBJ.velocity),pOBJ.hasOwnProperty("accelerate")&&particle.a.copy(pOBJ.accelerate)},addPrototypeByObject:function(target,prototypeObject,filters){for(var singlePrototype in prototypeObject)filters?filters.indexOf(singlePrototype)<0&&(target[singlePrototype]=Proton.Util.getSpanValue(prototypeObject[singlePrototype])):target[singlePrototype]=Proton.Util.getSpanValue(prototypeObject[singlePrototype]);return target},setPrototypeByObject:function(target,prototypeObject,filters){for(var singlePrototype in prototypeObject)target.hasOwnProperty(singlePrototype)&&(filters?filters.indexOf(singlePrototype)<0&&(target[singlePrototype]=Proton.Util.getSpanValue(prototypeObject[singlePrototype])):target[singlePrototype]=Proton.Util.getSpanValue(prototypeObject[singlePrototype]));return target},setSpanValue:function(a,b,c){return a instanceof Proton.Span?a:b?c?new Proton.Span(a,b,c):new Proton.Span(a,b):new Proton.Span(a)},getSpanValue:function(pan){return pan instanceof Proton.Span?pan.getValue():pan},inherits:function(subClass,superClass){if(subClass._super_=superClass,Object.create)subClass.prototype=Object.create(superClass.prototype,{constructor:{value:superClass}});else{var F=function(){};F.prototype=superClass.prototype,subClass.prototype=new F,subClass.prototype.constructor=subClass}},getImageData:function(context,image,rect){context.drawImage(image,rect.x,rect.y);var imagedata=context.getImageData(rect.x,rect.y,rect.width,rect.height);return context.clearRect(rect.x,rect.y,rect.width,rect.height),imagedata},getImage:function(img,particle,drawCanvas,fun){"string"==typeof img?this.loadAndSetImage(img,particle,drawCanvas,fun):"object"==typeof img?this.loadAndSetImage(img.src,particle,drawCanvas,fun):img instanceof Image&&this.loadedImage(img.src,particle,drawCanvas,fun,img)},loadedImage:function(src,particle,drawCanvas,fun,target){if(particle.target=target,particle.transform.src=src,Proton.TextureBuffer[src]||(Proton.TextureBuffer[src]=particle.target),drawCanvas)if(Proton.TextureCanvasBuffer[src])particle.transform.canvas=Proton.TextureCanvasBuffer[src];else{var _width=Proton.WebGLUtil.nhpot(particle.target.width),_height=Proton.WebGLUtil.nhpot(particle.target.height);particle.transform.canvas=Proton.DomUtil.createCanvas("canvas"+src,_width,_height);var context=particle.transform.canvas.getContext("2d");context.drawImage(particle.target,0,0,particle.target.width,particle.target.height),Proton.TextureCanvasBuffer[src]=particle.transform.canvas}fun&&fun(particle)},loadAndSetImage:function(src,particle,drawCanvas,fun){if(Proton.TextureBuffer[src])this.loadedImage(src,particle,drawCanvas,fun,Proton.TextureBuffer[src]);else{var self=this,myImage=new Image;myImage.onload=function(e){self.loadedImage(src,particle,drawCanvas,fun,e.target)},myImage.src=src}},hexToRGB:function(h){var hex16="#"==h.charAt(0)?h.substring(1,7):h,r=parseInt(hex16.substring(0,2),16),g=parseInt(hex16.substring(2,4),16),b=parseInt(hex16.substring(4,6),16);return{r:r,g:g,b:b}},rgbToHex:function(rbg){return"rgb("+rbg.r+", "+rbg.g+", "+rbg.b+")"}};Proton.Util=Util;var WebGLUtil=WebGLUtil||{ipot:function(length){return 0==(length&length-1)},nhpot:function(length){--length;for(var i=1;32>i;i<<=1)length|=length>>i;return length+1},makeTranslation:function(tx,ty){return[1,0,0,0,1,0,tx,ty,1]},makeRotation:function(angleInRadians){var c=Math.cos(angleInRadians),s=Math.sin(angleInRadians);return[c,-s,0,s,c,0,0,0,1]},makeScale:function(sx,sy){return[sx,0,0,0,sy,0,0,0,1]},matrixMultiply:function(a,b){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8],b00=b[0],b01=b[1],b02=b[2],b10=b[3],b11=b[4],b12=b[5],b20=b[6],b21=b[7],b22=b[8];return[a00*b00+a01*b10+a02*b20,a00*b01+a01*b11+a02*b21,a00*b02+a01*b12+a02*b22,a10*b00+a11*b10+a12*b20,a10*b01+a11*b11+a12*b21,a10*b02+a11*b12+a12*b22,a20*b00+a21*b10+a22*b20,a20*b01+a21*b11+a22*b21,a20*b02+a21*b12+a22*b22]}};Proton.WebGLUtil=WebGLUtil;var DomUtil=DomUtil||{createCanvas:function($id,$width,$height,$position){var element=document.createElement("canvas"),position=$position?$position:"absolute";return element.id=$id,element.width=$width,element.height=$height,element.style.position=position,element.style.opacity=0,this.transformDom(element,-500,-500,0,0),element},transformDom:function($div,$x,$y,$scale,$rotate){$div.style.WebkitTransform="translate("+$x+"px, "+$y+"px) scale("+$scale+") rotate("+$rotate+"deg)",$div.style.MozTransform="translate("+$x+"px, "+$y+"px) scale("+$scale+") rotate("+$rotate+"deg)",$div.style.OTransform="translate("+$x+"px, "+$y+"px) scale("+$scale+") rotate("+$rotate+"deg)",$div.style.msTransform="translate("+$x+"px, "+$y+"px) scale("+$scale+") rotate("+$rotate+"deg)",$div.style.transform="translate("+$x+"px, "+$y+"px) scale("+$scale+") rotate("+$rotate+"deg)"}};Proton.DomUtil=DomUtil,MStack.prototype.set=function(m,i){0==i?Proton.Mat3.set(m,this.mats[0]):Proton.Mat3.multiply(this.mats[i-1],m,this.mats[i]),this.size=Math.max(this.size,i+1)},MStack.prototype.push=function(m){0==this.size?Proton.Mat3.set(m,this.mats[0]):Proton.Mat3.multiply(this.mats[this.size-1],m,this.mats[this.size]),this.size++},MStack.prototype.pop=function(){this.size>0&&this.size--},MStack.prototype.top=function(){return this.mats[this.size-1]},Proton.MStack=MStack,Particle.ID=0,Particle.prototype={getDirection:function(){return Math.atan2(this.v.x,-this.v.y)*(180/Math.PI)},reset:function(init){return this.life=1/0,this.age=0,this.energy=1,this.dead=!1,this.sleep=!1,this.target=null,this.sprite=null,this.parent=null,this.mass=1,this.radius=10,this.alpha=1,this.scale=1,this.rotation=0,this.color=null,this.easing=Proton.ease.setEasingByName(Proton.easeLinear),init?(this.transform={},this.p=new Proton.Vector2D,this.v=new Proton.Vector2D,this.a=new Proton.Vector2D,this.old={p:new Proton.Vector2D,v:new Proton.Vector2D,a:new Proton.Vector2D},this.behaviours=[]):(Proton.Util.destroyObject(this.transform),this.p.set(0,0),this.v.set(0,0),this.a.set(0,0),this.old.p.set(0,0),this.old.v.set(0,0),this.old.a.set(0,0),this.removeAllBehaviours()),this.transform.rgb={r:255,g:255,b:255},this},update:function(time,index){if(!this.sleep){this.age+=time;var i,length=this.behaviours.length;for(i=0;length>i;i++)this.behaviours[i]&&this.behaviours[i].applyBehaviour(this,time,index)}if(this.age>=this.life)this.destory();else{var scale=this.easing(this.age/this.life);this.energy=Math.max(1-scale,0)}},addBehaviour:function(behaviour){this.behaviours.push(behaviour),behaviour.hasOwnProperty("parents")&&behaviour.parents.push(this),behaviour.initialize(this)},addBehaviours:function(behaviours){var i,length=behaviours.length;for(i=0;length>i;i++)this.addBehaviour(behaviours[i])},removeBehaviour:function(behaviour){var index=this.behaviours.indexOf(behaviour);if(index>-1){var behaviour=this.behaviours.splice(index,1);behaviour.parents=null}},removeAllBehaviours:function(){Proton.Util.destroyArray(this.behaviours)},destory:function(){this.removeAllBehaviours(),this.energy=0,this.dead=!0,this.parent=null}},Proton.Particle=Particle,ParticlePool.prototype={create:function(newTypeParticleClass){return newTypeParticleClass?new newTypeParticle:new Proton.Particle},getCount:function(){return this.poolList.length},add:function(){return this.poolList.push(this.create())},get:function(){return 0===this.poolList.length?this.create():this.poolList.pop().reset()},set:function(particle){return this.poolList.length<Proton.POOL_MAX?this.poolList.push(particle):void 0},release:function(){for(var i=0;i<this.poolList.length;i++)this.poolList[i].destory&&this.poolList[i].destory(),delete this.poolList[i];this.poolList=[]}},Proton.ParticlePool=ParticlePool;var MathUtils={randomAToB:function(a,b,INT){return INT?Math.floor(Math.random()*(b-a))+a:a+Math.random()*(b-a)},randomFloating:function(center,f,INT){return MathUtils.randomAToB(center-f,center+f,INT)},randomZone:function(display){},degreeTransform:function(a){return a*Math.PI/180},toColor16:function(num){return"#"+num.toString(16)},randomColor:function(){return"#"+("00000"+(16777216*Math.random()<<0).toString(16)).slice(-6)}};Proton.MathUtils=MathUtils;var NumericalIntegration=function(type){this.type=Proton.Util.initValue(type,Proton.EULER)};NumericalIntegration.prototype={integrate:function(particles,time,damping){this.eulerIntegrate(particles,time,damping)},eulerIntegrate:function(particle,time,damping){particle.sleep||(particle.old.p.copy(particle.p),particle.old.v.copy(particle.v),particle.a.multiplyScalar(1/particle.mass),particle.v.add(particle.a.multiplyScalar(time)),particle.p.add(particle.old.v.multiplyScalar(time)),damping&&particle.v.multiplyScalar(damping),particle.a.clear())}},Proton.NumericalIntegration=NumericalIntegration;var Vector2D=function(x,y){this.x=x||0,this.y=y||0};Vector2D.prototype={set:function(x,y){return this.x=x,this.y=y,this},setX:function(x){return this.x=x,this},setY:function(y){return this.y=y,this},setComponent:function(index,value){switch(index){case 0:this.x=value;break;case 1:this.y=value;break;default:throw new Error("index is out of range: "+index)}},getGradient:function(){return 0!=this.x?Math.atan2(this.y,this.x):this.y>0?Math.PI/2:this.y<0?-Math.PI/2:void 0},getComponent:function(index){switch(index){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+index)}},copy:function(v){return this.x=v.x,this.y=v.y,this},add:function(v,w){return w!==undefined?this.addVectors(v,w):(this.x+=v.x,this.y+=v.y,this)},addXY:function(a,b){return this.x+=a,this.y+=b,this},addVectors:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this},addScalar:function(s){return this.x+=s,this.y+=s,this},sub:function(v,w){return w!==undefined?this.subVectors(v,w):(this.x-=v.x,this.y-=v.y,this)},subVectors:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this},multiplyScalar:function(s){return this.x*=s,this.y*=s,this},divideScalar:function(s){return 0!==s?(this.x/=s,this.y/=s):this.set(0,0),this},min:function(v){return this.x>v.x&&(this.x=v.x),this.y>v.y&&(this.y=v.y),this},max:function(v){return this.x<v.x&&(this.x=v.x),this.y<v.y&&(this.y=v.y),this},clamp:function(min,max){return this.x<min.x?this.x=min.x:this.x>max.x&&(this.x=max.x),this.y<min.y?this.y=min.y:this.y>max.y&&(this.y=max.y),this},negate:function(){return this.multiplyScalar(-1)},dot:function(v){return this.x*v.x+this.y*v.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(v){return Math.sqrt(this.distanceToSquared(v))},rotate:function(tha){var x=this.x,y=this.y;return this.x=x*Math.cos(tha)+y*Math.sin(tha),this.y=-x*Math.sin(tha)+y*Math.cos(tha),this},distanceToSquared:function(v){var dx=this.x-v.x,dy=this.y-v.y;return dx*dx+dy*dy},setLength:function(l){var oldLength=this.length();return 0!==oldLength&&l!==oldLength&&this.multiplyScalar(l/oldLength),this},lerp:function(v,alpha){return this.x+=(v.x-this.x)*alpha,this.y+=(v.y-this.y)*alpha,this},equals:function(v){return v.x===this.x&&v.y===this.y},toArray:function(){return[this.x,this.y]},clear:function(){return this.x=0,this.y=0,this},clone:function(){return new Proton.Vector2D(this.x,this.y)}},Proton.Vector2D=Vector2D;var Polar2D=function(r,tha){this.r=Math.abs(r)||0,this.tha=tha||0};Polar2D.prototype={set:function(r,tha){return this.r=r,this.tha=tha,this},setR:function(r){return this.r=r,this},setTha:function(tha){return this.tha=tha,this},copy:function(p){return this.r=p.r,this.tha=p.tha,this},toVector:function(){return new Proton.Vector2D(this.getX(),this.getY())},getX:function(){return this.r*Math.sin(this.tha)},getY:function(){return-this.r*Math.cos(this.tha)},normalize:function(){return this.r=1,this},equals:function(v){return v.r===this.r&&v.tha===this.tha},toArray:function(){return[this.r,this.tha]},clear:function(){return this.r=0,this.tha=0,this},clone:function(){return new Proton.Polar2D(this.r,this.tha)}},Proton.Polar2D=Polar2D,Span.prototype={getValue:function(INT){return this.isArray?this.a[Math.floor(this.a.length*Math.random())]:this.center?Proton.MathUtils.randomFloating(this.a,this.b,INT):Proton.MathUtils.randomAToB(this.a,this.b,INT)}},Proton.Span=Span,Proton.getSpan=function(a,b,center){return new Proton.Span(a,b,center)},Proton.Util.inherits(ColorSpan,Proton.Span),ColorSpan.prototype.getValue=function(){var color=this.colorArr[Math.floor(this.colorArr.length*Math.random())];return"random"==color||"Random"==color?Proton.MathUtils.randomColor():color},Proton.ColorSpan=ColorSpan,Rectangle.prototype={contains:function(x,y){return x<=this.right&&x>=this.x&&y<=this.bottom&&y>=this.y?!0:!1}},Proton.Rectangle=Rectangle;var Mat3=Mat3||{create:function(mat3){var mat=new Float32Array(9);return mat3&&this.set(mat3,mat),mat},set:function(mat1,mat2){for(var i=0;9>i;i++)mat2[i]=mat1[i];return mat2},multiply:function(mat,mat2,mat3){var a00=mat[0],a01=mat[1],a02=mat[2],a10=mat[3],a11=mat[4],a20=mat[6],a21=mat[7],b00=mat2[0],b01=mat2[1],b02=mat2[2],b10=mat2[3],b11=mat2[4],b20=mat2[6],b21=mat2[7];return mat3[0]=b00*a00+b01*a10,mat3[1]=b00*a01+b01*a11,mat3[2]=a02*b02,mat3[3]=b10*a00+b11*a10,mat3[4]=b10*a01+b11*a11,mat3[6]=b20*a00+b21*a10+a20,mat3[7]=b20*a01+b21*a11+a21,mat3},inverse:function(mat,mat3){var id,a00=mat[0],a01=mat[1],a10=mat[3],a11=mat[4],a20=mat[6],a21=mat[7],b01=a11,b11=-a10,b21=a21*a10-a11*a20,d=a00*b01+a01*b11;return id=1/d,mat3[0]=b01*id,mat3[1]=-a01*id,mat3[3]=b11*id,mat3[4]=a00*id,mat3[6]=b21*id,mat3[7]=(-a21*a00+a01*a20)*id,mat3},multiplyVec2:function(m,vec,mat3){var x=vec[0],y=vec[1];return mat3[0]=x*m[0]+y*m[3]+m[6],mat3[1]=x*m[1]+y*m[4]+m[7],mat3}};Proton.Mat3=Mat3,Behaviour.id=0,Behaviour.prototype={reset:function(life,easing){this.life=Proton.Util.initValue(life,1/0),this.easing=Proton.Util.initValue(easing,Proton.ease.setEasingByName(Proton.easeLinear))},normalizeForce:function(force){return force.multiplyScalar(Proton.MEASURE)},normalizeValue:function(value){return value*Proton.MEASURE},initialize:function(particle){},applyBehaviour:function(particle,time,index){if(this.age+=time,this.age>=this.life||this.dead)this.energy=0,this.dead=!0,this.destory();else{var scale=this.easing(particle.age/particle.life);this.energy=Math.max(1-scale,0)}},destory:function(){var i,length=this.parents.length;for(i=0;length>i;i++)this.parents[i].removeBehaviour(this);this.parents=[]}},Proton.Behaviour=Behaviour,Rate.prototype={init:function(){this.startTime=0,this.nextTime=this.timePan.getValue()},getValue:function(time){return this.startTime+=time,this.startTime>=this.nextTime?(this.startTime=0,this.nextTime=this.timePan.getValue(),1==this.numPan.b?this.numPan.getValue(!1)>.5?1:0:this.numPan.getValue(!0)):0}},Proton.Rate=Rate,Initialize.prototype.reset=function(){},Initialize.prototype.init=function(emitter,particle){particle?this.initialize(particle):this.initialize(emitter)},Initialize.prototype.initialize=function(target){},Proton.Initialize=Initialize;var InitializeUtil={initialize:function(emitter,particle,initializes){var i,length=initializes.length;for(i=0;length>i;i++)initializes[i]instanceof Proton.Initialize?initializes[i].init(emitter,particle):Proton.InitializeUtil.init(emitter,particle,initializes[i]);Proton.InitializeUtil.bindEmitter(emitter,particle)},init:function(emitter,particle,initialize){Proton.Util.setPrototypeByObject(particle,initialize),Proton.Util.setVector2DByObject(particle,initialize)},bindEmitter:function(emitter,particle){emitter.bindEmitter&&(particle.p.add(emitter.p),particle.v.add(emitter.v),particle.a.add(emitter.a),particle.v.rotate(Proton.MathUtils.degreeTransform(emitter.rotation)))}};Proton.InitializeUtil=InitializeUtil,Proton.Util.inherits(Life,Proton.Initialize),Life.prototype.initialize=function(target){this.lifePan.a==1/0?target.life=1/0:target.life=this.lifePan.getValue()},Proton.Life=Life,Proton.Util.inherits(Position,Proton.Initialize),Position.prototype.reset=function(zone){this.zone=Proton.Util.initValue(zone,new Proton.PointZone)},Position.prototype.initialize=function(target){this.zone.getPosition(),target.p.x=this.zone.vector.x,target.p.y=this.zone.vector.y},Proton.Position=Position,Proton.P=Position,Proton.Util.inherits(Velocity,Proton.Initialize),Velocity.prototype.reset=function(rpan,thapan,type){this.rPan=Proton.Util.setSpanValue(rpan),this.thaPan=Proton.Util.setSpanValue(thapan),this.type=Proton.Util.initValue(type,"vector")},Velocity.prototype.normalizeVelocity=function(vr){return vr*Proton.MEASURE},Velocity.prototype.initialize=function(target){if("p"==this.type||"P"==this.type||"polar"==this.type){var polar2d=new Proton.Polar2D(this.normalizeVelocity(this.rPan.getValue()),this.thaPan.getValue()*Math.PI/180);target.v.x=polar2d.getX(),target.v.y=polar2d.getY()}else target.v.x=this.normalizeVelocity(this.rPan.getValue()),target.v.y=this.normalizeVelocity(this.thaPan.getValue())},Proton.Velocity=Velocity,Proton.V=Velocity,Proton.Util.inherits(Mass,Proton.Initialize),Mass.prototype.initialize=function(target){target.mass=this.massPan.getValue()},Proton.Mass=Mass,Proton.Util.inherits(Radius,Proton.Initialize),Radius.prototype.reset=function(a,b,c){this.radius=Proton.Util.setSpanValue(a,b,c)},Radius.prototype.initialize=function(particle){particle.radius=this.radius.getValue(),particle.transform.oldRadius=particle.radius},Proton.Radius=Radius,Proton.Util.inherits(ImageTarget,Proton.Initialize),ImageTarget.prototype.initialize=function(particle){var imagetarget=this.image.getValue();"string"==typeof imagetarget?particle.target={width:this.w,height:this.h,src:imagetarget}:particle.target=imagetarget},ImageTarget.prototype.setSpanValue=function(color){return color instanceof Proton.ColorSpan?color:new Proton.ColorSpan(color)},Proton.ImageTarget=ImageTarget,Proton.Util.inherits(Force,Proton.Behaviour),Force.prototype.reset=function(fx,fy,life,easing){this.force=this.normalizeForce(new Proton.Vector2D(fx,fy)),life&&Force._super_.prototype.reset.call(this,life,easing)},Force.prototype.applyBehaviour=function(particle,time,index){Force._super_.prototype.applyBehaviour.call(this,particle,time,index),particle.a.add(this.force)},Proton.Force=Force,Proton.F=Force,Proton.Util.inherits(Attraction,Proton.Behaviour),Attraction.prototype.reset=function(targetPosition,force,radius,life,easing){this.targetPosition=Proton.Util.initValue(targetPosition,new Proton.Vector2D),this.radius=Proton.Util.initValue(radius,1e3),this.force=Proton.Util.initValue(this.normalizeValue(force),100),this.radiusSq=this.radius*this.radius,this.attractionForce=new Proton.Vector2D,this.lengthSq=0,life&&Attraction._super_.prototype.reset.call(this,life,easing)},Attraction.prototype.applyBehaviour=function(particle,time,index){Attraction._super_.prototype.applyBehaviour.call(this,particle,time,index),this.attractionForce.copy(this.targetPosition),this.attractionForce.sub(particle.p),this.lengthSq=this.attractionForce.lengthSq(),this.lengthSq>4e-6&&this.lengthSq<this.radiusSq&&(this.attractionForce.normalize(),this.attractionForce.multiplyScalar(1-this.lengthSq/this.radiusSq),
this.attractionForce.multiplyScalar(this.force),particle.a.add(this.attractionForce))},Proton.Attraction=Attraction,Proton.Util.inherits(RandomDrift,Proton.Behaviour),RandomDrift.prototype.reset=function(driftX,driftY,delay,life,easing){this.panFoce=new Proton.Vector2D(driftX,driftY),this.panFoce=this.normalizeForce(this.panFoce),this.delay=delay,life&&RandomDrift._super_.prototype.reset.call(this,life,easing)},RandomDrift.prototype.applyBehaviour=function(particle,time,index){RandomDrift._super_.prototype.applyBehaviour.call(this,particle,time,index),this.time+=time,this.time>=this.delay&&(particle.a.addXY(Proton.MathUtils.randomAToB(-this.panFoce.x,this.panFoce.x),Proton.MathUtils.randomAToB(-this.panFoce.y,this.panFoce.y)),this.time=0)},Proton.RandomDrift=RandomDrift,Proton.Util.inherits(Repulsion,Proton.Attraction),Repulsion.prototype.reset=function(targetPosition,force,radius,life,easing){Repulsion._super_.prototype.reset.call(this,targetPosition,force,radius,life,easing),this.force*=-1},Proton.Repulsion=Repulsion,Proton.Util.inherits(Gravity,Proton.Force),Gravity.prototype.reset=function(g,life,easing){Gravity._super_.prototype.reset.call(this,0,g,life,easing)},Proton.Gravity=Gravity,Proton.G=Gravity,Proton.Util.inherits(Collision,Proton.Behaviour),Collision.prototype.reset=function(emitter,mass,callback,life,easing){this.emitter=Proton.Util.initValue(emitter,null),this.mass=Proton.Util.initValue(mass,!0),this.callback=Proton.Util.initValue(callback,null),this.collisionPool=[],this.delta=new Proton.Vector2D,life&&Collision._super_.prototype.reset.call(this,life,easing)},Collision.prototype.applyBehaviour=function(particle,time,index){for(var otherParticle,lengthSq,overlap,averageMass1,averageMass2,newPool=this.emitter?this.emitter.particles.slice(index):this.pool.slice(index),length=newPool.length,i=0;length>i;i++)otherParticle=newPool[i],otherParticle!==particle&&(this.delta.copy(otherParticle.p),this.delta.sub(particle.p),lengthSq=this.delta.lengthSq(),distance=particle.radius+otherParticle.radius,lengthSq<=distance*distance&&(overlap=distance-Math.sqrt(lengthSq),overlap+=.5,totalMass=particle.mass+otherParticle.mass,averageMass1=this.mass?otherParticle.mass/totalMass:.5,averageMass2=this.mass?particle.mass/totalMass:.5,particle.p.add(this.delta.clone().normalize().multiplyScalar(overlap*-averageMass1)),otherParticle.p.add(this.delta.normalize().multiplyScalar(overlap*averageMass2)),this.callback&&this.callback(particle,otherParticle)))},Proton.Collision=Collision,Proton.Util.inherits(CrossZone,Proton.Behaviour),CrossZone.prototype.reset=function(zone,crossType,life,easing){this.zone=zone,this.zone.crossType=Proton.Util.initValue(crossType,"dead"),life&&CrossZone._super_.prototype.reset.call(this,life,easing)},CrossZone.prototype.applyBehaviour=function(particle,time,index){CrossZone._super_.prototype.applyBehaviour.call(this,particle,time,index),this.zone.crossing(particle)},Proton.CrossZone=CrossZone,Proton.Util.inherits(Alpha,Proton.Behaviour),Alpha.prototype.reset=function(a,b,life,easing){null==b||b==undefined?this.same=!0:this.same=!1,this.a=Proton.Util.setSpanValue(Proton.Util.initValue(a,1)),this.b=Proton.Util.setSpanValue(b),life&&Alpha._super_.prototype.reset.call(this,life,easing)},Alpha.prototype.initialize=function(particle){particle.transform.alphaA=this.a.getValue(),this.same?particle.transform.alphaB=particle.transform.alphaA:particle.transform.alphaB=this.b.getValue()},Alpha.prototype.applyBehaviour=function(particle,time,index){Alpha._super_.prototype.applyBehaviour.call(this,particle,time,index),particle.alpha=particle.transform.alphaB+(particle.transform.alphaA-particle.transform.alphaB)*this.energy,particle.alpha<.001&&(particle.alpha=0)},Proton.Alpha=Alpha,Proton.Util.inherits(Scale,Proton.Behaviour),Scale.prototype.reset=function(a,b,life,easing){null==b||b==undefined?this.same=!0:this.same=!1,this.a=Proton.Util.setSpanValue(Proton.Util.initValue(a,1)),this.b=Proton.Util.setSpanValue(b),life&&Scale._super_.prototype.reset.call(this,life,easing)},Scale.prototype.initialize=function(particle){particle.transform.scaleA=this.a.getValue(),particle.transform.oldRadius=particle.radius,this.same?particle.transform.scaleB=particle.transform.scaleA:particle.transform.scaleB=this.b.getValue()},Scale.prototype.applyBehaviour=function(particle,time,index){Scale._super_.prototype.applyBehaviour.call(this,particle,time,index),particle.scale=particle.transform.scaleB+(particle.transform.scaleA-particle.transform.scaleB)*this.energy,particle.scale<1e-4&&(particle.scale=0),particle.radius=particle.transform.oldRadius*particle.scale},Proton.Scale=Scale,Proton.Util.inherits(Rotate,Proton.Behaviour),Rotate.prototype.reset=function(a,b,style,life,easing){null==b||b==undefined?this.same=!0:this.same=!1,this.a=Proton.Util.setSpanValue(Proton.Util.initValue(a,"Velocity")),this.b=Proton.Util.setSpanValue(Proton.Util.initValue(b,0)),this.style=Proton.Util.initValue(style,"to"),life&&Rotate._super_.prototype.reset.call(this,life,easing)},Rotate.prototype.initialize=function(particle){particle.rotation=this.a.getValue(),particle.transform.rotationA=this.a.getValue(),this.same||(particle.transform.rotationB=this.b.getValue())},Rotate.prototype.applyBehaviour=function(particle,time,index){Rotate._super_.prototype.applyBehaviour.call(this,particle,time,index),this.same?("V"==this.a.a||"Velocity"==this.a.a||"v"==this.a.a)&&(particle.rotation=particle.getDirection()):"to"==this.style||"TO"==this.style||"_"==this.style?particle.rotation+=particle.transform.rotationB+(particle.transform.rotationA-particle.transform.rotationB)*this.energy:particle.rotation+=particle.transform.rotationB},Proton.Rotate=Rotate,Proton.Util.inherits(Color,Proton.Behaviour),Color.prototype.reset=function(color1,color2,life,easing){this.color1=this.setSpanValue(color1),this.color2=this.setSpanValue(color2),life&&Color._super_.prototype.reset.call(this,life,easing)},Color.prototype.initialize=function(particle){particle.color=this.color1.getValue(),particle.transform.beginRGB=Proton.Util.hexToRGB(particle.color),this.color2&&(particle.transform.endRGB=Proton.Util.hexToRGB(this.color2.getValue()))},Color.prototype.applyBehaviour=function(particle,time,index){this.color2?(Color._super_.prototype.applyBehaviour.call(this,particle,time,index),particle.transform.rgb.r=particle.transform.endRGB.r+(particle.transform.beginRGB.r-particle.transform.endRGB.r)*this.energy,particle.transform.rgb.g=particle.transform.endRGB.g+(particle.transform.beginRGB.g-particle.transform.endRGB.g)*this.energy,particle.transform.rgb.b=particle.transform.endRGB.b+(particle.transform.beginRGB.b-particle.transform.endRGB.b)*this.energy,particle.transform.rgb.r=parseInt(particle.transform.rgb.r,10),particle.transform.rgb.g=parseInt(particle.transform.rgb.g,10),particle.transform.rgb.b=parseInt(particle.transform.rgb.b,10)):(particle.transform.rgb.r=particle.transform.beginRGB.r,particle.transform.rgb.g=particle.transform.beginRGB.g,particle.transform.rgb.b=particle.transform.beginRGB.b)},Color.prototype.setSpanValue=function(color){return color?color instanceof Proton.ColorSpan?color:new Proton.ColorSpan(color):null},Proton.Color=Color,Proton.Util.inherits(GravityWell,Proton.Behaviour),GravityWell.prototype.reset=function(centerPoint,force,life,easing){this.distanceVec=new Proton.Vector2D,this.centerPoint=Proton.Util.initValue(centerPoint,new Proton.Vector2D),this.force=Proton.Util.initValue(this.normalizeValue(force),100),life&&GravityWell._super_.prototype.reset.call(this,life,easing)},GravityWell.prototype.initialize=function(particle){},GravityWell.prototype.applyBehaviour=function(particle,time,index){this.distanceVec.set(this.centerPoint.x-particle.p.x,this.centerPoint.y-particle.p.y);var distanceSq=this.distanceVec.lengthSq();if(0!=distanceSq){var distance=this.distanceVec.length(),factor=this.force*time/(distanceSq*distance);particle.v.x+=factor*this.distanceVec.x,particle.v.y+=factor*this.distanceVec.y}},Proton.GravityWell=GravityWell,Emitter.ID=0,Proton.Util.inherits(Emitter,Proton.Particle),Proton.EventDispatcher.initialize(Emitter.prototype),Emitter.prototype.emit=function(emitTime,life){this.emitTime=0,this.emitTotalTimes=Proton.Util.initValue(emitTime,1/0),1==life||"life"==life||"destroy"==life?"once"==emitTime?this.life=1:this.life=this.emitTotalTimes:isNaN(life)||(this.life=life),this.rate.init()},Emitter.prototype.stopEmit=function(){this.emitTotalTimes=-1,this.emitTime=0},Emitter.prototype.removeAllParticles=function(){for(var i=0;i<this.particles.length;i++)this.particles[i].dead=!0},Emitter.prototype.createParticle=function(initialize,behaviour){var particle=Proton.pool.get();return this.setupParticle(particle,initialize,behaviour),this.dispatchEvent(new Proton.Event({type:Proton.PARTICLE_CREATED,particle:particle})),particle},Emitter.prototype.addSelfInitialize=function(pObj){pObj.init?pObj.init(this):this.initAll()},Emitter.prototype.addInitialize=function(){var i,length=arguments.length;for(i=0;length>i;i++)this.initializes.push(arguments[i])},Emitter.prototype.removeInitialize=function(initializer){var index=this.initializes.indexOf(initializer);index>-1&&this.initializes.splice(index,1)},Emitter.prototype.removeInitializers=function(){Proton.Util.destroyArray(this.initializes)},Emitter.prototype.addBehaviour=function(){var i,length=arguments.length;for(i=0;length>i;i++)this.behaviours.push(arguments[i]),arguments[i].hasOwnProperty("parents")&&arguments[i].parents.push(this)},Emitter.prototype.removeBehaviour=function(behaviour){var index=this.behaviours.indexOf(behaviour);index>-1&&this.behaviours.splice(index,1)},Emitter.prototype.removeAllBehaviours=function(){Proton.Util.destroyArray(this.behaviours)},Emitter.prototype.integrate=function(time){var damping=1-this.damping;Proton.integrator.integrate(this,time,damping);var i,length=this.particles.length;for(i=0;length>i;i++){var particle=this.particles[i];particle.update(time,i),Proton.integrator.integrate(particle,time,damping),this.dispatchEvent(new Proton.Event({type:Proton.PARTICLE_UPDATE,particle:particle}))}},Emitter.prototype.emitting=function(time){if("once"==this.emitTotalTimes){var i,length=this.rate.getValue(99999);for(i=0;length>i;i++)this.createParticle();this.emitTotalTimes="none"}else if(!isNaN(this.emitTotalTimes)&&(this.emitTime+=time,this.emitTime<this.emitTotalTimes)){var i,length=this.rate.getValue(time);for(i=0;length>i;i++)this.createParticle()}},Emitter.prototype.update=function(time){this.age+=time,(this.age>=this.life||this.dead)&&this.destroy(),this.emitting(time),this.integrate(time);var particle,k,length=this.particles.length;for(k=length-1;k>=0;k--)particle=this.particles[k],particle.dead&&(Proton.pool.set(particle),this.particles.splice(k,1),this.dispatchEvent(new Proton.Event({type:Proton.PARTICLE_DEAD,particle:particle})))},Emitter.prototype.setupParticle=function(particle,initialize,behaviour){var initializes=this.initializes,behaviours=this.behaviours;initialize&&(initializes=initialize instanceof Array?initialize:[initialize]),behaviour&&(behaviours=behaviour instanceof Array?behaviour:[behaviour]),Proton.InitializeUtil.initialize(this,particle,initializes),particle.addBehaviours(behaviours),particle.parent=this,this.particles.push(particle)},Emitter.prototype.destroy=function(){this.dead=!0,this.emitTotalTimes=-1,0==this.particles.length&&(this.removeInitializers(),this.removeAllBehaviours(),this.parent&&this.parent.removeEmitter(this))},Proton.Emitter=Emitter,Proton.Util.inherits(BehaviourEmitter,Proton.Emitter),BehaviourEmitter.prototype.addSelfBehaviour=function(){var i,length=arguments.length;for(i=0;length>i;i++)this.selfBehaviours.push(arguments[i])},BehaviourEmitter.prototype.removeSelfBehaviour=function(behaviour){var index=this.selfBehaviours.indexOf(behaviour);index>-1&&this.selfBehaviours.splice(index,1)},BehaviourEmitter.prototype.update=function(time){if(BehaviourEmitter._super_.prototype.update.call(this,time),!this.sleep){var i,length=this.selfBehaviours.length;for(i=0;length>i;i++)this.selfBehaviours[i].applyBehaviour(this,time,i)}},Proton.BehaviourEmitter=BehaviourEmitter,Proton.Util.inherits(FollowEmitter,Proton.Emitter),FollowEmitter.prototype.initEventHandler=function(){var self=this;this.mousemoveHandler=function(e){self.mousemove.call(self,e)},this.mousedownHandler=function(e){self.mousedown.call(self,e)},this.mouseupHandler=function(e){self.mouseup.call(self,e)},this.mouseTarget.addEventListener("mousemove",this.mousemoveHandler,!1)},FollowEmitter.prototype.emit=function(){this._allowEmitting=!0},FollowEmitter.prototype.stopEmit=function(){this._allowEmitting=!1},FollowEmitter.prototype.mousemove=function(e){e.layerX||0==e.layerX?(this.p.x+=(e.layerX-this.p.x)*this.ease,this.p.y+=(e.layerY-this.p.y)*this.ease):(e.offsetX||0==e.offsetX)&&(this.p.x+=(e.offsetX-this.p.x)*this.ease,this.p.y+=(e.offsetY-this.p.y)*this.ease),this._allowEmitting&&FollowEmitter._super_.prototype.emit.call(this,"once")},FollowEmitter.prototype.destroy=function(){FollowEmitter._super_.prototype.destroy.call(this),this.mouseTarget.removeEventListener("mousemove",this.mousemoveHandler,!1)},Proton.FollowEmitter=FollowEmitter;var ease=ease||{easeLinear:function(value){return value},easeInQuad:function(value){return Math.pow(value,2)},easeOutQuad:function(value){return-(Math.pow(value-1,2)-1)},easeInOutQuad:function(value){return(value/=.5)<1?.5*Math.pow(value,2):-.5*((value-=2)*value-2)},easeInCubic:function(value){return Math.pow(value,3)},easeOutCubic:function(value){return Math.pow(value-1,3)+1},easeInOutCubic:function(value){return(value/=.5)<1?.5*Math.pow(value,3):.5*(Math.pow(value-2,3)+2)},easeInQuart:function(value){return Math.pow(value,4)},easeOutQuart:function(value){return-(Math.pow(value-1,4)-1)},easeInOutQuart:function(value){return(value/=.5)<1?.5*Math.pow(value,4):-.5*((value-=2)*Math.pow(value,3)-2)},easeInSine:function(value){return-Math.cos(value*(Math.PI/2))+1},easeOutSine:function(value){return Math.sin(value*(Math.PI/2))},easeInOutSine:function(value){return-.5*(Math.cos(Math.PI*value)-1)},easeInExpo:function(value){return 0===value?0:Math.pow(2,10*(value-1))},easeOutExpo:function(value){return 1===value?1:-Math.pow(2,-10*value)+1},easeInOutExpo:function(value){return 0===value?0:1===value?1:(value/=.5)<1?.5*Math.pow(2,10*(value-1)):.5*(-Math.pow(2,-10*--value)+2)},easeInCirc:function(value){return-(Math.sqrt(1-value*value)-1)},easeOutCirc:function(value){return Math.sqrt(1-Math.pow(value-1,2))},easeInOutCirc:function(value){return(value/=.5)<1?-.5*(Math.sqrt(1-value*value)-1):.5*(Math.sqrt(1-(value-=2)*value)+1)},easeInBack:function(value){var s=1.70158;return value*value*((s+1)*value-s)},easeOutBack:function(value){var s=1.70158;return(value-=1)*value*((s+1)*value+s)+1},easeInOutBack:function(value){var s=1.70158;return(value/=.5)<1?.5*value*value*(((s*=1.525)+1)*value-s):.5*((value-=2)*value*(((s*=1.525)+1)*value+s)+2)},setEasingByName:function(name){switch(name){case"easeLinear":return Proton.ease.easeLinear;case"easeInQuad":return Proton.ease.easeInQuad;case"easeOutQuad":return Proton.ease.easeOutQuad;case"easeInOutQuad":return Proton.ease.easeInOutQuad;case"easeInCubic":return Proton.ease.easeInCubic;case"easeOutCubic":return Proton.ease.easeOutCubic;case"easeInOutCubic":return Proton.ease.easeInOutCubic;case"easeInQuart":return Proton.ease.easeInQuart;case"easeOutQuart":return Proton.ease.easeOutQuart;case"easeInOutQuart":return Proton.ease.easeInOutQuart;case"easeInSine":return Proton.ease.easeInSine;case"easeOutSine":return Proton.ease.easeOutSine;case"easeInOutSine":return Proton.ease.easeInOutSine;case"easeInExpo":return Proton.ease.easeInExpo;case"easeOutExpo":return Proton.ease.easeOutExpo;case"easeInOutExpo":return Proton.ease.easeInOutExpo;case"easeInCirc":return Proton.ease.easeInCirc;case"easeOutCirc":return Proton.ease.easeOutCirc;case"easeInOutCirc":return Proton.ease.easeInOutCirc;case"easeInBack":return Proton.ease.easeInBack;case"easeOutBack":return Proton.ease.easeOutBack;case"easeInOutBack":return Proton.ease.easeInOutBack;default:return Proton.ease.easeLinear}}};Proton.ease=ease,Proton.easeLinear="easeLinear",Proton.easeInQuad="easeInQuad",Proton.easeOutQuad="easeOutQuad",Proton.easeInOutQuad="easeInOutQuad",Proton.easeInCubic="easeInCubic",Proton.easeOutCubic="easeOutCubic",Proton.easeInOutCubic="easeInOutCubic",Proton.easeInQuart="easeInQuart",Proton.easeOutQuart="easeOutQuart",Proton.easeInOutQuart="easeInOutQuart",Proton.easeInSine="easeInSine",Proton.easeOutSine="easeOutSine",Proton.easeInOutSine="easeInOutSine",Proton.easeInExpo="easeInExpo",Proton.easeOutExpo="easeOutExpo",Proton.easeInOutExpo="easeInOutExpo",Proton.easeInCirc="easeInCirc",Proton.easeOutCirc="easeOutCirc",Proton.easeInOutCirc="easeInOutCirc",Proton.easeInBack="easeInBack",Proton.easeOutBack="easeOutBack",Proton.easeInOutBack="easeInOutBack",Renderer.prototype={start:function(){this.addEventHandler(),this.renderer.start()},stop:function(){this.renderer.stop()},resize:function(width,height){this.renderer.resize(width,height)},setStroke:function(color,thinkness){this.renderer.hasOwnProperty("stroke")?this.renderer.setStroke(color,thinkness):alert("Sorry this renderer do not suppest stroke method!")},createImageData:function(data){this.renderer instanceof Proton.PixelRender&&this.renderer.createImageData(data)},setMaxRadius:function(radius){this.renderer instanceof Proton.WebGLRender&&this.renderer.setMaxRadius(radius)},blendEquation:function(A){this.renderer instanceof Proton.WebGLRender&&this.renderer.blendEquation(A)},blendFunc:function(A,B){this.renderer instanceof Proton.WebGLRender&&this.renderer.blendFunc(A,B)},setType:function(type){this.type=type,this.renderer=this.getRenderer()},getRenderer:function(){switch(this.type){case"dom":return new Proton.DomRender(this.proton,this.element);case"canvas":return new Proton.CanvasRender(this.proton,this.element);case"webgl":return new Proton.WebGLRender(this.proton,this.element);case"easel":return new Proton.EaselRender(this.proton,this.element);case"easeljs":return new Proton.EaselRender(this.proton,this.element);case"pixel":return new Proton.PixelRender(this.proton,this.element);default:return new Proton.BaseRender(this.proton,this.element)}},render:function(callback){this.renderer.render(callback)},addEventHandler:function(){this.onProtonUpdate&&(this.renderer.onProtonUpdate=this.onProtonUpdate),this.onParticleCreated&&(this.renderer.onParticleCreated=this.onParticleCreated),this.onParticleUpdate&&(this.renderer.onParticleUpdate=this.onParticleUpdate),this.onParticleDead&&(this.renderer.onParticleDead=this.onParticleDead)}},Proton.Renderer=Renderer,BaseRender.prototype={start:function(){var self=this;this.proton.addEventListener(Proton.PROTON_UPDATE,function(e){self.onProtonUpdate.call(self)}),this.proton.addEventListener(Proton.PROTON_UPDATE_AFTER,function(e){self.onProtonUpdateAfter.call(self)}),this.proton.addEventListener(Proton.EMITTER_ADDED,function(e){self.onEmitterAdded.call(self,e.emitter)}),this.proton.addEventListener(Proton.EMITTER_REMOVED,function(e){self.onEmitterRemoved.call(self,e.emitter)});var i,length=this.proton.emitters.length;for(i=0;length>i;i++){var emitter=this.proton.emitters[i];this.addEmitterListener(emitter)}},resize:function(width,height){},addEmitterListener:function(emitter){var self=this;emitter.addEventListener(Proton.PARTICLE_CREATED,function(e){self.onParticleCreated.call(self,e.particle)}),emitter.addEventListener(Proton.PARTICLE_UPDATE,function(e){self.onParticleUpdate.call(self,e.particle)}),emitter.addEventListener(Proton.PARTICLE_DEAD,function(e){self.onParticleDead.call(self,e.particle)})},stop:function(){var i,length=this.proton.emitters.length;for(this.proton.removeAllEventListeners(),i=0;length>i;i++){var emitter=this.proton.emitters[i];emitter.removeAllEventListeners()}},onEmitterAdded:function(emitter){this.addEmitterListener(emitter)},onEmitterRemoved:function(emitter){emitter.removeAllEventListeners()},onProtonUpdate:function(){},onProtonUpdateAfter:function(){},onParticleCreated:function(particle){},onParticleUpdate:function(particle){},onParticleDead:function(particle){}},Proton.BaseRender=BaseRender,Proton.Util.inherits(DomRender,Proton.BaseRender),DomRender.prototype.start=function(){DomRender._super_.prototype.start.call(this)},DomRender.prototype.setStroke=function(color,thinkness){color=Proton.Util.initValue(color,"#000000"),thinkness=Proton.Util.initValue(thinkness,1),this.stroke={color:color,thinkness:thinkness}},DomRender.prototype.onProtonUpdate=function(){},DomRender.prototype.onParticleCreated=function(particle){if(particle.target){var self=this;Proton.Util.getImage(particle.target,particle,!1,function(particle){self.setImgInDIV.call(self,particle)})}else particle.transform.canvas=Proton.DomUtil.createCanvas(particle.id+"_canvas",particle.radius+1,particle.radius+1,"absolute"),particle.transform.bakOldRadius=particle.radius,this.stroke?(particle.transform.canvas.width=2*particle.radius+2*this.stroke.thinkness,particle.transform.canvas.height=2*particle.radius+2*this.stroke.thinkness):(particle.transform.canvas.width=2*particle.radius+1,particle.transform.canvas.height=2*particle.radius+1),particle.transform.context=particle.transform.canvas.getContext("2d"),particle.transform.context.fillStyle=particle.color,particle.transform.context.beginPath(),particle.transform.context.arc(particle.radius,particle.radius,particle.radius,0,2*Math.PI,!0),this.stroke&&(particle.transform.context.strokeStyle=this.stroke.color,particle.transform.context.lineWidth=this.stroke.thinkness,particle.transform.context.stroke()),particle.transform.context.closePath(),particle.transform.context.fill(),this.element.appendChild(particle.transform.canvas)},DomRender.prototype.onParticleUpdate=function(particle){particle.target?particle.target instanceof Image&&(particle.transform.canvas.style.opacity=particle.alpha,Proton.DomUtil.transformDom(particle.transform.canvas,particle.p.x-particle.target.width/2,particle.p.y-particle.target.height/2,particle.scale,particle.rotation)):(particle.transform.canvas.style.opacity=particle.alpha,particle.transform.oldRadius?Proton.DomUtil.transformDom(particle.transform.canvas,particle.p.x-particle.transform.oldRadius,particle.p.y-particle.transform.oldRadius,particle.scale,particle.rotation):Proton.DomUtil.transformDom(particle.transform.canvas,particle.p.x-particle.transform.bakOldRadius,particle.p.y-particle.transform.bakOldRadius,particle.scale,particle.rotation))},DomRender.prototype.onParticleDead=function(particle){particle.transform.canvas&&this.element.removeChild(particle.transform.canvas)},DomRender.prototype.setImgInDIV=function(particle){particle.transform.canvas=Proton.DomUtil.createCanvas(particle.id+"_canvas",particle.target.width+1,particle.target.height+1,"absolute",particle.p.x-particle.radius,particle.p.y-particle.radius),particle.transform.context=particle.transform.canvas.getContext("2d"),particle.transform.context.drawImage(particle.target,0,0,particle.target.width,particle.target.height),this.element.appendChild(particle.transform.canvas)},Proton.DomRender=DomRender,Proton.Util.inherits(EaselRender,Proton.BaseRender),EaselRender.prototype.resize=function(width,height){},EaselRender.prototype.start=function(){EaselRender._super_.prototype.start.call(this)},EaselRender.prototype.onProtonUpdate=function(){},EaselRender.prototype.onParticleCreated=function(particle){if(particle.target)particle.target=particle.target.clone(),particle.target.parent||(particle.target.image&&(particle.target.regX=particle.target.image.width/2,particle.target.regY=particle.target.image.height/2),this.element.addChild(particle.target));else{var graphics=new createjs.Graphics;this.stroke&&(1==this.stroke?graphics.beginStroke("#000000"):this.stroke instanceof String&&graphics.beginStroke(this.stroke)),graphics.beginFill(particle.color).drawCircle(0,0,particle.radius);var shape=new createjs.Shape(graphics);particle.target=shape,this.element.addChild(particle.target)}},EaselRender.prototype.onParticleUpdate=function(particle){particle.target&&(particle.target.x=particle.p.x,particle.target.y=particle.p.y,particle.target.alpha=particle.alpha,particle.target.scaleX=particle.target.scaleY=particle.scale,particle.target.rotation=particle.rotation)},EaselRender.prototype.onParticleDead=function(particle){particle.target&&particle.target.parent&&particle.target.parent.removeChild(particle.target)},Proton.EaselRender=EaselRender,Proton.Util.inherits(CanvasRender,Proton.BaseRender),CanvasRender.prototype.resize=function(width,height){this.element.width=width,this.element.height=height},CanvasRender.prototype.start=function(){CanvasRender._super_.prototype.start.call(this)},CanvasRender.prototype.setStroke=function(color,thinkness){color=Proton.Util.initValue(color,"#000000"),thinkness=Proton.Util.initValue(thinkness,1),this.stroke={color:color,thinkness:thinkness}},CanvasRender.prototype.onProtonUpdate=function(){this.context.clearRect(0,0,this.element.width,this.element.height)},CanvasRender.prototype.onParticleCreated=function(particle){particle.target?Proton.Util.getImage(particle.target,particle,!1):particle.color=particle.color?particle.color:"#ff0000"},CanvasRender.prototype.onParticleUpdate=function(particle){if(particle.target){if(particle.target instanceof Image){var w=particle.target.width*particle.scale|0,h=particle.target.height*particle.scale|0,x=particle.p.x-w/2,y=particle.p.y-h/2;if(particle.color){particle.transform.buffer||(particle.transform.buffer=this.getBuffer(particle.target));var bufferContext=particle.transform.buffer.getContext("2d");bufferContext.clearRect(0,0,particle.transform.buffer.width,particle.transform.buffer.height),bufferContext.globalAlpha=particle.alpha,bufferContext.drawImage(particle.target,0,0),bufferContext.globalCompositeOperation="source-atop",bufferContext.fillStyle=Proton.Util.rgbToHex(particle.transform.rgb),bufferContext.fillRect(0,0,particle.transform.buffer.width,particle.transform.buffer.height),bufferContext.globalCompositeOperation="source-over",bufferContext.globalAlpha=1,this.context.drawImage(particle.transform.buffer,0,0,particle.transform.buffer.width,particle.transform.buffer.height,x,y,w,h)}else this.context.save(),this.context.globalAlpha=particle.alpha,this.context.translate(particle.p.x,particle.p.y),this.context.rotate(Proton.MathUtils.degreeTransform(particle.rotation)),this.context.translate(-particle.p.x,-particle.p.y),this.context.drawImage(particle.target,0,0,particle.target.width,particle.target.height,x,y,w,h),this.context.globalAlpha=1,this.context.restore()}}else particle.transform.rgb?this.context.fillStyle="rgba("+particle.transform.rgb.r+","+particle.transform.rgb.g+","+particle.transform.rgb.b+","+particle.alpha+")":this.context.fillStyle=particle.color,this.context.beginPath(),this.context.arc(particle.p.x,particle.p.y,particle.radius,0,2*Math.PI,!0),this.stroke&&(this.context.strokeStyle=this.stroke.color,this.context.lineWidth=this.stroke.thinkness,this.context.stroke()),this.context.closePath(),this.context.fill()},CanvasRender.prototype.onParticleDead=function(particle){},CanvasRender.prototype.getBuffer=function(image){if(image instanceof Image){var size=image.width+"_"+image.height,canvas=this.bufferCache[size];return canvas||(canvas=document.createElement("canvas"),canvas.width=image.width,canvas.height=image.height,this.bufferCache[size]=canvas),canvas}},Proton.CanvasRender=CanvasRender,Proton.Util.inherits(PixelRender,Proton.BaseRender),PixelRender.prototype.resize=function(width,height){this.element.width=width,this.element.height=height},PixelRender.prototype.createImageData=function(rectangle){rectangle?this.rectangle=rectangle:this.rectangle=new Proton.Rectangle(0,0,this.element.width,this.element.height),this.imageData=this.context.createImageData(this.rectangle.width,this.rectangle.height),this.context.putImageData(this.imageData,this.rectangle.x,this.rectangle.y)},PixelRender.prototype.start=function(){PixelRender._super_.prototype.start.call(this)},PixelRender.prototype.onProtonUpdate=function(){this.context.clearRect(this.rectangle.x,this.rectangle.y,this.rectangle.width,this.rectangle.height),this.imageData=this.context.getImageData(this.rectangle.x,this.rectangle.y,this.rectangle.width,this.rectangle.height)},PixelRender.prototype.onProtonUpdateAfter=function(){this.context.putImageData(this.imageData,this.rectangle.x,this.rectangle.y)},PixelRender.prototype.onParticleCreated=function(particle){},PixelRender.prototype.onParticleUpdate=function(particle){this.imageData&&this.setPixel(this.imageData,Math.floor(particle.p.x-this.rectangle.x),Math.floor(particle.p.y-this.rectangle.y),particle)},PixelRender.prototype.setPixel=function(imagedata,x,y,particle){var rgb=particle.transform.rgb;if(!(0>x||x>this.element.width||0>y||y>this.elementwidth)){var i=4*((y>>0)*imagedata.width+(x>>0));imagedata.data[i]=rgb.r,imagedata.data[i+1]=rgb.g,imagedata.data[i+2]=rgb.b,imagedata.data[i+3]=255*particle.alpha}},PixelRender.prototype.onParticleDead=function(particle){},Proton.PixelRender=PixelRender,Proton.Util.inherits(WebGLRender,Proton.BaseRender),WebGLRender.prototype.resize=function(width,height){this.umat[4]=-2,this.umat[7]=1,this.smat[0]=1/width,this.smat[4]=1/height,this.mstack.set(this.umat,0),this.mstack.set(this.smat,1),this.gl.viewport(0,0,width,height),this.element.width=width,this.element.height=height},WebGLRender.prototype.setMaxRadius=function(radius){this.circleCanvasURL=this.createCircle(radius)},WebGLRender.prototype.getVertexShader=function(){var vsSource=["uniform vec2 viewport;","attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 tMat;","varying vec2 vTextureCoord;","varying float alpha;","void main() {","vec3 v = tMat * vec3(aVertexPosition, 1.0);","gl_Position = vec4(v.x, v.y, 0, 1);","vTextureCoord = aTextureCoord;","alpha = tMat[0][2];","}"].join("\n");return vsSource},WebGLRender.prototype.getFragmentShader=function(){var fsSource=["precision mediump float;","varying vec2 vTextureCoord;","varying float alpha;","uniform sampler2D uSampler;","uniform vec4 color;","uniform bool useTexture;","uniform vec3 uColor;","void main() {","vec4 textureColor = texture2D(uSampler, vTextureCoord);","gl_FragColor = textureColor * vec4(uColor, 1.0);","gl_FragColor.w *= alpha;","}"].join("\n");return fsSource},WebGLRender.prototype.initVar=function(){this.mstack=new Proton.MStack,this.umat=Proton.Mat3.create([2,0,1,0,-2,0,-1,1,1]),this.smat=Proton.Mat3.create([.01,0,1,0,.01,0,0,0,1]),this.texturebuffers={}},WebGLRender.prototype.start=function(){WebGLRender._super_.prototype.start.call(this),this.resize(this.element.width,this.element.height)},WebGLRender.prototype.blendEquation=function(A){this.gl.blendEquation(this.gl[A])},WebGLRender.prototype.blendFunc=function(A,B){this.gl.blendFunc(this.gl[A],this.gl[B])},WebGLRender.prototype.getShader=function(gl,str,fs){var shader;return shader=fs?gl.createShader(gl.FRAGMENT_SHADER):gl.createShader(gl.VERTEX_SHADER),gl.shaderSource(shader,str),gl.compileShader(shader),gl.getShaderParameter(shader,gl.COMPILE_STATUS)?shader:(alert(gl.getShaderInfoLog(shader)),null)},WebGLRender.prototype.initShaders=function(){var fragmentShader=this.getShader(this.gl,this.getFragmentShader(),!0),vertexShader=this.getShader(this.gl,this.getVertexShader(),!1);this.sprogram=this.gl.createProgram(),this.gl.attachShader(this.sprogram,vertexShader),this.gl.attachShader(this.sprogram,fragmentShader),this.gl.linkProgram(this.sprogram),this.gl.getProgramParameter(this.sprogram,this.gl.LINK_STATUS)||alert("Could not initialise shaders"),this.gl.useProgram(this.sprogram),this.sprogram.vpa=this.gl.getAttribLocation(this.sprogram,"aVertexPosition"),this.sprogram.tca=this.gl.getAttribLocation(this.sprogram,"aTextureCoord"),this.gl.enableVertexAttribArray(this.sprogram.tca),this.gl.enableVertexAttribArray(this.sprogram.vpa),
this.sprogram.tMatUniform=this.gl.getUniformLocation(this.sprogram,"tMat"),this.sprogram.samplerUniform=this.gl.getUniformLocation(this.sprogram,"uSampler"),this.sprogram.useTex=this.gl.getUniformLocation(this.sprogram,"useTexture"),this.sprogram.color=this.gl.getUniformLocation(this.sprogram,"uColor"),this.gl.uniform1i(this.sprogram.useTex,1)},WebGLRender.prototype.initBuffers=function(){this.unitIBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.unitIBuffer);var vs=[0,3,1,0,2,3];this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(vs),this.gl.STATIC_DRAW);for(var ids=[],i=0;100>i;i++)ids.push(i);for(idx=new Uint16Array(ids),this.unitI33=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.unitI33),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,idx,this.gl.STATIC_DRAW),ids=[],i=0;100>i;i++)ids.push(i,i+1,i+2);idx=new Uint16Array(ids),this.stripBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.stripBuffer),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,idx,this.gl.STATIC_DRAW)},WebGLRender.prototype.createCircle=function(raidus){this.circleCanvasRadius=Proton.WebGLUtil.nhpot(Proton.Util.initValue(raidus,32));var canvas=Proton.DomUtil.createCanvas("circle_canvas",2*this.circleCanvasRadius,2*this.circleCanvasRadius),context=canvas.getContext("2d");return context.beginPath(),context.arc(this.circleCanvasRadius,this.circleCanvasRadius,this.circleCanvasRadius,0,2*Math.PI,!0),context.closePath(),context.fillStyle="#FFF",context.fill(),canvas.toDataURL()},WebGLRender.prototype.setImgInCanvas=function(particle){var _w=particle.target.width,_h=particle.target.height,_width=Proton.WebGLUtil.nhpot(particle.target.width),_height=Proton.WebGLUtil.nhpot(particle.target.height),_scaleX=particle.target.width/_width,_scaleY=particle.target.height/_height;this.texturebuffers[particle.transform.src]||(this.texturebuffers[particle.transform.src]=[this.gl.createTexture(),this.gl.createBuffer(),this.gl.createBuffer()]),particle.transform.texture=this.texturebuffers[particle.transform.src][0],particle.transform.vcBuffer=this.texturebuffers[particle.transform.src][1],particle.transform.tcBuffer=this.texturebuffers[particle.transform.src][2],this.gl.bindBuffer(this.gl.ARRAY_BUFFER,particle.transform.tcBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([0,0,_scaleX,0,0,_scaleY,_scaleY,_scaleY]),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,particle.transform.vcBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([0,0,_w,0,0,_h,_w,_h]),this.gl.STATIC_DRAW);var context=particle.transform.canvas.getContext("2d"),data=context.getImageData(0,0,_width,_height);this.gl.bindTexture(this.gl.TEXTURE_2D,particle.transform.texture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,data),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR_MIPMAP_NEAREST),this.gl.generateMipmap(this.gl.TEXTURE_2D),particle.transform.textureLoaded=!0,particle.transform.textureWidth=_w,particle.transform.textureHeight=_h},WebGLRender.prototype.setStroke=function(color,thinkness){},WebGLRender.prototype.onProtonUpdate=function(){},WebGLRender.prototype.onParticleCreated=function(particle){var self=this;particle.transform.textureLoaded=!1,particle.transform.tmat=Proton.Mat3.create(),particle.transform.tmat[8]=1,particle.transform.imat=Proton.Mat3.create(),particle.transform.imat[8]=1,particle.target?Proton.Util.getImage(particle.target,particle,!0,function(particle){self.setImgInCanvas.call(self,particle),particle.transform.oldScale=1}):Proton.Util.getImage(this.circleCanvasURL,particle,!0,function(particle){self.setImgInCanvas.call(self,particle),particle.transform.oldScale=particle.radius/self.circleCanvasRadius})},WebGLRender.prototype.onParticleUpdate=function(particle){particle.transform.textureLoaded&&(this.updateMatrix(particle),this.gl.uniform3f(this.sprogram.color,particle.transform.rgb.r/255,particle.transform.rgb.g/255,particle.transform.rgb.b/255),this.gl.uniformMatrix3fv(this.sprogram.tMatUniform,!1,this.mstack.top()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,particle.transform.vcBuffer),this.gl.vertexAttribPointer(this.sprogram.vpa,2,this.gl.FLOAT,!1,0,0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,particle.transform.tcBuffer),this.gl.vertexAttribPointer(this.sprogram.tca,2,this.gl.FLOAT,!1,0,0),this.gl.bindTexture(this.gl.TEXTURE_2D,particle.transform.texture),this.gl.uniform1i(this.sprogram.samplerUniform,0),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.unitIBuffer),this.gl.drawElements(this.gl.TRIANGLES,6,this.gl.UNSIGNED_SHORT,0),this.mstack.pop())},WebGLRender.prototype.onParticleDead=function(particle){},WebGLRender.prototype.updateMatrix=function(particle){var moveOriginMatrix=Proton.WebGLUtil.makeTranslation(-particle.transform.textureWidth/2,-particle.transform.textureHeight/2),translationMatrix=Proton.WebGLUtil.makeTranslation(particle.p.x,particle.p.y),angel=particle.rotation*(Math.PI/180),rotationMatrix=Proton.WebGLUtil.makeRotation(angel),scale=particle.scale*particle.transform.oldScale,scaleMatrix=Proton.WebGLUtil.makeScale(scale,scale),matrix=Proton.WebGLUtil.matrixMultiply(moveOriginMatrix,scaleMatrix);matrix=Proton.WebGLUtil.matrixMultiply(matrix,rotationMatrix),matrix=Proton.WebGLUtil.matrixMultiply(matrix,translationMatrix),Proton.Mat3.inverse(matrix,particle.transform.imat),matrix[2]=particle.alpha,this.mstack.push(matrix)},Proton.WebGLRender=WebGLRender,Zone.prototype={getPosition:function(){},crossing:function(particle){}},Proton.Zone=Zone,Proton.Util.inherits(LineZone,Proton.Zone),LineZone.prototype.getPosition=function(){return this.random=Math.random(),this.vector.x=this.x1+this.random*this.length*Math.cos(this.gradient),this.vector.y=this.y1+this.random*this.length*Math.sin(this.gradient),this.vector},LineZone.prototype.getDirection=function(x,y){var A=this.dy,B=-this.dx,C=this.dot,D=0==B?1:B;return(A*x+B*y+C)*D>0?!0:!1},LineZone.prototype.getDistance=function(x,y){var A=this.dy,B=-this.dx,C=this.dot,D=A*x+B*y+C;return D/Math.sqrt(this.xxyy)},LineZone.prototype.getSymmetric=function(v){var tha2=v.getGradient(),tha1=this.getGradient(),tha=2*(tha1-tha2),oldx=v.x,oldy=v.y;return v.x=oldx*Math.cos(tha)-oldy*Math.sin(tha),v.y=oldx*Math.sin(tha)+oldy*Math.cos(tha),v},LineZone.prototype.getGradient=function(){return Math.atan2(this.dy,this.dx)},LineZone.prototype.getRange=function(particle,fun){var angle=Math.abs(this.getGradient());angle<=Math.PI/4?particle.p.x<this.maxx&&particle.p.x>this.minx&&fun():particle.p.y<this.maxy&&particle.p.y>this.miny&&fun()},LineZone.prototype.getLength=function(){return Math.sqrt(this.dx*this.dx+this.dy*this.dy)},LineZone.prototype.crossing=function(particle){var self=this;"dead"==this.crossType?">"==this.direction||"R"==this.direction||"right"==this.direction||"down"==this.direction?this.getRange(particle,function(){self.getDirection(particle.p.x,particle.p.y)&&(particle.dead=!0)}):this.getRange(particle,function(){self.getDirection(particle.p.x,particle.p.y)||(particle.dead=!0)}):"bound"==this.crossType?this.getRange(particle,function(){self.getDistance(particle.p.x,particle.p.y)<=particle.radius&&(0==self.dx?particle.v.x*=-1:0==self.dy?particle.v.y*=-1:self.getSymmetric(particle.v))}):"cross"==this.crossType&&this.alert&&(alert("Sorry lineZone does not support cross method"),this.alert=!1)},Proton.LineZone=LineZone,Proton.Util.inherits(CircleZone,Proton.Zone),CircleZone.prototype.getPosition=function(){return this.random=Math.random(),this.angle=2*Math.PI*Math.random(),this.vector.x=this.x+this.random*this.radius*Math.cos(this.angle),this.vector.y=this.y+this.random*this.radius*Math.sin(this.angle),this.vector},CircleZone.prototype.setCenter=function(x,y){this.center.x=x,this.center.y=y},CircleZone.prototype.crossing=function(particle){var d=particle.p.distanceTo(this.center);"dead"==this.crossType?d-particle.radius>this.radius&&(particle.dead=!0):"bound"==this.crossType?d+particle.radius>=this.radius&&this.getSymmetric(particle):"cross"==this.crossType&&this.alert&&(alert("Sorry CircleZone does not support cross method"),this.alert=!1)},CircleZone.prototype.getSymmetric=function(particle){var tha2=particle.v.getGradient(),tha1=this.getGradient(particle),tha=2*(tha1-tha2),oldx=particle.v.x,oldy=particle.v.y;particle.v.x=oldx*Math.cos(tha)-oldy*Math.sin(tha),particle.v.y=oldx*Math.sin(tha)+oldy*Math.cos(tha)},CircleZone.prototype.getGradient=function(particle){return-Math.PI/2+Math.atan2(particle.p.y-this.center.y,particle.p.x-this.center.x)},Proton.CircleZone=CircleZone,Proton.Util.inherits(PointZone,Proton.Zone),PointZone.prototype.getPosition=function(){return this.vector.x=this.x,this.vector.y=this.y,this.vector},PointZone.prototype.crossing=function(particle){this.alert&&(alert("Sorry PointZone does not support crossing method"),this.alert=!1)},Proton.PointZone=PointZone,Proton.Util.inherits(RectZone,Proton.Zone),RectZone.prototype.getPosition=function(){return this.vector.x=this.x+Math.random()*this.width,this.vector.y=this.y+Math.random()*this.height,this.vector},RectZone.prototype.crossing=function(particle){"dead"==this.crossType?(particle.p.x+particle.radius<this.x?particle.dead=!0:particle.p.x-particle.radius>this.x+this.width&&(particle.dead=!0),particle.p.y+particle.radius<this.y?particle.dead=!0:particle.p.y-particle.radius>this.y+this.height&&(particle.dead=!0)):"bound"==this.crossType?(particle.p.x-particle.radius<this.x?(particle.p.x=this.x+particle.radius,particle.v.x*=-1):particle.p.x+particle.radius>this.x+this.width&&(particle.p.x=this.x+this.width-particle.radius,particle.v.x*=-1),particle.p.y-particle.radius<this.y?(particle.p.y=this.y+particle.radius,particle.v.y*=-1):particle.p.y+particle.radius>this.y+this.height&&(particle.p.y=this.y+this.height-particle.radius,particle.v.y*=-1)):"cross"==this.crossType&&(particle.p.x+particle.radius<this.x&&particle.v.x<=0?particle.p.x=this.x+this.width+particle.radius:particle.p.x-particle.radius>this.x+this.width&&particle.v.x>=0&&(particle.p.x=this.x-particle.radius),particle.p.y+particle.radius<this.y&&particle.v.y<=0?particle.p.y=this.y+this.height+particle.radius:particle.p.y-particle.radius>this.y+this.height&&particle.v.y>=0&&(particle.p.y=this.y-particle.radius))},Proton.RectZone=RectZone,Proton.Util.inherits(ImageZone,Proton.Zone),ImageZone.prototype.reset=function(imageData,x,y,d){this.imageData=imageData,this.x=Proton.Util.initValue(x,0),this.y=Proton.Util.initValue(y,0),this.d=Proton.Util.initValue(d,2),this.vectors=[],this.setVectors()},ImageZone.prototype.setVectors=function(){var i,j,length1=this.imageData.width,length2=this.imageData.height;for(i=0;length1>i;i+=this.d)for(j=0;length2>j;j+=this.d){var index=4*((j>>0)*length1+(i>>0));this.imageData.data[index+3]>0&&this.vectors.push({x:i+this.x,y:j+this.y})}return this.vector},ImageZone.prototype.getBound=function(x,y){var index=4*((y>>0)*this.imageData.width+(x>>0));return this.imageData.data[index+3]>0?!0:!1},ImageZone.prototype.getPosition=function(){return this.vector.copy(this.vectors[Math.floor(Math.random()*this.vectors.length)])},ImageZone.prototype.getColor=function(x,y){x-=this.x,y-=this.y;var i=4*((y>>0)*this.imageData.width+(x>>0));return{r:this.imageData.data[i],g:this.imageData.data[i+1],b:this.imageData.data[i+2],a:this.imageData.data[i+3]}},ImageZone.prototype.crossing=function(particle){"dead"==this.crossType?this.getBound(particle.p.x-this.x,particle.p.y-this.y)?particle.dead=!0:particle.dead=!1:"bound"==this.crossType&&(this.getBound(particle.p.x-this.x,particle.p.y-this.y)||particle.v.negate())},Proton.ImageZone=ImageZone;var log=function(){if(window.console&&window.console.log){var arg=arguments;if("string"==typeof arguments[0])if(0==arguments[0].indexOf("+")){var n=parseInt(arguments[0]);log.once<n&&(delete arg[0],console.log(arg),log.once++)}else console.log(arg);else console.log(arg)}};log.once=0,Proton.log=log;var Debug=Debug||{addEventListener:function(proton,fun){proton.addEventListener(Proton.PROTON_UPDATE,function(e){fun()})},setStyle:function(c){var color=c||"#ff0000",rgb=Proton.Util.hexToRGB(color),style="rgba("+rgb.r+","+rgb.g+","+rgb.b+",0.5)";return style},drawZone:function(proton,canvas,zone,clear){var context=canvas.getContext("2d"),style=this.setStyle();this.addEventListener(proton,function(){clear&&context.clearRect(0,0,canvas.width,canvas.height),zone instanceof Proton.PointZone?(context.beginPath(),context.fillStyle=style,context.arc(zone.x,zone.y,10,0,2*Math.PI,!0),context.fill(),context.closePath()):zone instanceof Proton.LineZone?(context.beginPath(),context.strokeStyle=style,context.moveTo(zone.x1,zone.y1),context.lineTo(zone.x2,zone.y2),context.stroke(),context.closePath()):zone instanceof Proton.RectZone?(context.beginPath(),context.strokeStyle=style,context.drawRect(zone.x,zone.y,zone.width,zone.height),context.stroke(),context.closePath()):zone instanceof Proton.CircleZone&&(context.beginPath(),context.strokeStyle=style,context.arc(zone.x,zone.y,zone.radius,0,2*Math.PI,!0),context.stroke(),context.closePath())})},drawEmitter:function(proton,canvas,emitter,clear){var context=canvas.getContext("2d"),style=this.setStyle();this.addEventListener(proton,function(){clear&&context.clearRect(0,0,canvas.width,canvas.height),context.beginPath(),context.fillStyle=style,context.arc(emitter.p.x,emitter.p.y,10,0,2*Math.PI,!0),context.fill(),context.closePath()})},test:{},setTest:function(id,value){this.test[id]=value},getTest:function(id){return this.test.hasOwnProperty(id)?this.test[id]:!1}};Proton.Debug=Debug}(window),function(){for(var lastTime=0,vendors=["ms","moz","webkit","o"],x=0;x<vendors.length&&!window.requestAnimationFrame;++x)window.requestAnimationFrame=window[vendors[x]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[vendors[x]+"CancelAnimationFrame"]||window[vendors[x]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(callback,element){var currTime=(new Date).getTime(),timeToCall=Math.max(0,16-(currTime-lastTime)),id=window.setTimeout(function(){callback(currTime+timeToCall)},timeToCall);return lastTime=currTime+timeToCall,id}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(id){clearTimeout(id)})}();